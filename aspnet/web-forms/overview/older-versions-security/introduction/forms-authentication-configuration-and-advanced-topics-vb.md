---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
title: Configuración de la autenticación formularios y temas avanzados (VB) | Microsoft Docs
author: rick-anderson
description: En este tutorial examinaremos las distintas configuraciones de autenticación de formularios y vea cómo modificarlos mediante el elemento de formularios. Esto supondrá una detallada...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: 829d2f56-5c48-445b-b826-3418a450c788
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
msc.type: authoredcontent
ms.openlocfilehash: 45e924559a88317950ae9fb8a596d3ee373dd661
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/06/2019
ms.locfileid: "65127840"
---
# <a name="forms-authentication-configuration-and-advanced-topics-vb"></a><span data-ttu-id="9f6d0-104">Configuración de la autenticación de formularios y temas avanzados (VB)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-104">Forms Authentication Configuration and Advanced Topics (VB)</span></span>

<span data-ttu-id="9f6d0-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9f6d0-106">[Descargar código](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) o [descargar PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span></span>

> <span data-ttu-id="9f6d0-107">En este tutorial examinaremos las distintas configuraciones de autenticación de formularios y vea cómo modificarlos mediante el elemento de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="9f6d0-108">Esto supondrá una visión detallada de personalizar el valor de tiempo de espera del vale de autenticación de formularios, con una página de inicio de sesión con una dirección URL personalizada (por ejemplo, SignIn.aspx en lugar de Login.aspx) y vales de autenticación de formularios sin cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>

## <a name="introduction"></a><span data-ttu-id="9f6d0-109">Introducción</span><span class="sxs-lookup"><span data-stu-id="9f6d0-109">Introduction</span></span>

<span data-ttu-id="9f6d0-110">En el [tutorial anterior](an-overview-of-forms-authentication-vb.md) analizamos los pasos necesarios para implementar la autenticación de formularios en una aplicación ASP.NET, especificar la configuración de Web.config a la creación de un registro en la página para mostrar diferentes contenido para usuarios autenticados y anónimos.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-110">In the [previous tutorial](an-overview-of-forms-authentication-vb.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="9f6d0-111">Recuerde que hemos configurado el sitio Web para usar autenticación de formularios estableciendo el atributo de modo de la &lt;autenticación&gt; elemento a los formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="9f6d0-112">El &lt;autenticación&gt; elemento puede incluir opcionalmente un &lt;formularios&gt; elemento secundario, a través del cual se puede especificar una gran variedad de opciones de autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="9f6d0-113">En este tutorial examinaremos las distintas configuraciones de autenticación de formularios y vea cómo modificarlos a través de la &lt;formularios&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="9f6d0-114">Esto supondrá una visión detallada de personalizar el valor de tiempo de espera del vale de autenticación de formularios, con una página de inicio de sesión con una dirección URL personalizada (por ejemplo, SignIn.aspx en lugar de Login.aspx) y vales de autenticación de formularios sin cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="9f6d0-115">También examinaremos más detenidamente la composición del vale de autenticación de formularios y vea las precauciones que ASP.NET toma para asegurarse de que los datos del vale están seguros contra inspección y manipulación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="9f6d0-116">Por último, veremos cómo almacenar datos de usuario adicional en el vale de autenticación de formularios y cómo modelar estos datos a través de un objeto principal personalizado.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="9f6d0-117">Paso 1: Examinar el &lt;formularios&gt; opciones de configuración</span><span class="sxs-lookup"><span data-stu-id="9f6d0-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="9f6d0-118">El sistema de autenticación de formularios de ASP.NET ofrece una serie de opciones de configuración que se pueden personalizar en la aplicación por aplicación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="9f6d0-119">Esto incluye opciones como: la duración de la autenticación de formularios de vale; ¿Qué tipo de protección se aplica al vale; en la autenticación sin cookies qué condiciones se usan vales; la ruta de acceso a la página de inicio de sesión; y otra información.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="9f6d0-120">Para modificar los valores predeterminados, agregue un [ &lt;formularios&gt; elemento](https://msdn.microsoft.com/library/1d3t3c61.aspx) como elemento secundario de la [ &lt;autenticación&gt; elemento](https://msdn.microsoft.com/library/532aee0e.aspx), especificando la propiedad de esos los valores que desee personalizar como atributos XML la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample1.xml)]

<span data-ttu-id="9f6d0-121">La tabla 1 resume las propiedades que se pueden personalizar mediante la &lt;formularios&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="9f6d0-122">Puesto que el archivo Web.config es un archivo XML, los nombres de atributo en la columna izquierda distinguen mayúsculas de minúsculas.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="9f6d0-123"><strong>Attribute</strong></span><span class="sxs-lookup"><span data-stu-id="9f6d0-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="9f6d0-124"><strong>Descripción</strong></span><span class="sxs-lookup"><span data-stu-id="9f6d0-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="9f6d0-125">sin cookies</span><span class="sxs-lookup"><span data-stu-id="9f6d0-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="9f6d0-126">Este atributo especifica bajo qué condiciones el vale de autenticación se almacena en una cookie en comparación con la que se incrusta en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="9f6d0-127">Valores permitidos son: UseCookies; UseUri; Detección automática; y UseDeviceProfile (predeterminado).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="9f6d0-128">Paso 2 examina esta configuración con más detalle.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="9f6d0-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="9f6d0-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="9f6d0-130">Indica la dirección URL que se redirigen a los usuarios después de iniciar sesión en la página de inicio de sesión si no hay ningún valor de URL de redireccionamiento especificado en la cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="9f6d0-131">El valor predeterminado es default.aspx.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="9f6d0-132">dominio</span><span class="sxs-lookup"><span data-stu-id="9f6d0-132">domain</span></span>           | <span data-ttu-id="9f6d0-133">Cuando se utiliza vales de autenticación basada en cookies, esta configuración especifica el valor de dominio de la cookie s.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-133">When using cookie-based authentication tickets, this setting specifies the cookie s domain value.</span></span> <span data-ttu-id="9f6d0-134">El valor predeterminado es una cadena vacía, lo que hace que el explorador usar el dominio desde el que se emitió (por ejemplo, www.yourdomain.com).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="9f6d0-135">En este caso, la cookie le <strong>no</strong> enviarse al realizar solicitudes a subdominios, como admin.yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="9f6d0-136">Si desea que la cookie que se pasará a todos los subdominios que necesita para personalizar el atributo de dominio si se establece en sudominio.com.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="9f6d0-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="9f6d0-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="9f6d0-138">Un valor booleano que indica si los usuarios autenticados se memorizan al redirigir a direcciones URL de otras aplicaciones web en el mismo servidor.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="9f6d0-139">El valor predeterminado es false.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="9f6d0-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="9f6d0-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="9f6d0-141">La dirección URL de la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-141">The URL of the login page.</span></span> <span data-ttu-id="9f6d0-142">El valor predeterminado es login.aspx.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="9f6d0-143">name</span><span class="sxs-lookup"><span data-stu-id="9f6d0-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="9f6d0-144">Cuando se usan vales de autenticación basada en cookies, el nombre de la cookie.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="9f6d0-145">El valor predeterminado es. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="9f6d0-146">ruta de acceso</span><span class="sxs-lookup"><span data-stu-id="9f6d0-146">path</span></span>            |                                                                             <span data-ttu-id="9f6d0-147">Cuando se utiliza vales de autenticación basada en cookies, esta configuración especifica el atributo de ruta de acceso de la cookie s.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-147">When using cookie-based authentication tickets, this setting specifies the cookie s path attribute.</span></span> <span data-ttu-id="9f6d0-148">El atributo de ruta de acceso permite que un desarrollador limitar el ámbito de una cookie para una jerarquía de directorios concreta.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="9f6d0-149">El valor predeterminado es /, que indica al explorador para enviar la cookie de vale de autenticación a cualquier solicitud realizada al dominio.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="9f6d0-150">protección</span><span class="sxs-lookup"><span data-stu-id="9f6d0-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="9f6d0-151">Indica las técnicas que se usan para proteger el vale de autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="9f6d0-152">Los valores permitidos son: Todos (predeterminado); Cifrado; Ninguno; y la validación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="9f6d0-153">Estas opciones se describen en detalle en el paso 3.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="9f6d0-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="9f6d0-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="9f6d0-155">Un valor booleano que indica si se requiere una conexión SSL para transmitir la cookie de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="9f6d0-156">El valor predeterminado es false.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="9f6d0-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="9f6d0-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="9f6d0-158">Un valor booleano que indica que si el tiempo de espera de s de la cookie de autenticación se restablece cada vez que el usuario visita el sitio durante una sola sesión.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-158">A Boolean value that indicates whether the authentication cookie s timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="9f6d0-159">El valor predeterminado es true.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-159">The default value is true.</span></span> <span data-ttu-id="9f6d0-160">La directiva de tiempo de espera de vale de autenticación se describe con más detalle en la especificación el s sección con el valor de tiempo de espera de vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="9f6d0-161">tiempo de espera</span><span class="sxs-lookup"><span data-stu-id="9f6d0-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="9f6d0-162">Especifica el tiempo, en minutos, tras el cual expira la cookie del vale de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="9f6d0-163">El valor predeterminado es 30.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-163">The default value is 30.</span></span> <span data-ttu-id="9f6d0-164">La directiva de tiempo de espera de vale de autenticación se describe con más detalle en la especificación el s sección con el valor de tiempo de espera de vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="9f6d0-165">**Tabla 1**: Un resumen de la &lt;formularios&gt; atributos del elemento</span><span class="sxs-lookup"><span data-stu-id="9f6d0-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="9f6d0-166">En ASP.NET 2.0 y versiones posteriores, el valor predeterminado los valores de autenticación de formularios están codificados en la clase FormsAuthenticationConfiguration en .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="9f6d0-167">Cada aplicación por aplicación en el archivo Web.config se deben aplicar las modificaciones.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="9f6d0-168">Esto difiere de ASP.NET 1.x, donde los valores de autenticación de formularios predeterminados se almacenaron en el archivo machine.config (y, por tanto, podrían modificarse mediante la edición de machine.config).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="9f6d0-169">En el tema de ASP.NET 1.x, merece la pena mencionar que un número de la configuración del sistema de autenticación de formularios tiene valores predeterminados diferentes en ASP.NET 2.0 y más allá de lo que en ASP.NET 1.x.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="9f6d0-170">Si la aplicación va a migrar desde un entorno de ASP.NET 1.x, es importante tener en cuenta estas diferencias.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="9f6d0-171">Consulte [el &lt;formularios&gt; documentación técnica de elemento](https://msdn.microsoft.com/library/1d3t3c61.aspx) para obtener una lista de las diferencias.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-172">Varias opciones de autenticación de formularios, como el tiempo de espera, el dominio y la ruta de acceso, especifican los detalles de la cookie de vale de autenticación de formularios resultante.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="9f6d0-173">Para obtener más información sobre las cookies, cómo funcionan y sus diversas propiedades, lea [este tutorial Cookies](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>

### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="9f6d0-174">Especifica el valor de tiempo de espera del vale</span><span class="sxs-lookup"><span data-stu-id="9f6d0-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="9f6d0-175">El vale de autenticación de formularios es un token que representa una identidad.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="9f6d0-176">Con los vales de autenticación basada en cookies, este token se mantiene en forma de una cookie y se envían al servidor web en cada solicitud.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="9f6d0-177">Posesión del token, en esencia, se declara, pues soy *username*, ya ha iniciado sesión y se usa para que la identidad de un usuario se puede guardar todas las visitas de la página.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="9f6d0-178">El vale de autenticación de formularios no sólo incluye la identidad del usuario, sino que también contiene información para ayudar a garantizar la integridad y seguridad del token.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="9f6d0-179">Después de todo, no queremos un usuario para poder crear un token falsificado, o para modificar un token que de alguna manera underhanded fraudulento.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="9f6d0-180">Un bit de este tipo de información incluida en el vale es un *expiración*, que es la fecha y hora ya no es válido el vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="9f6d0-181">Cada vez que FormsAuthenticationModule inspecciona un vale de autenticación, se asegura de que expire del vale todavía no ha pasado.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="9f6d0-182">Si es así, no tiene en cuenta el vale e identifica el usuario es anónimo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="9f6d0-183">Esta medida de seguridad ayuda a protegerse contra los ataques de reproducción.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="9f6d0-184">Sin una fecha de expiración, si un hacker era capaz de obtener sus manos en el vale de autenticación válido de un usuario - quizás por obtener acceso físico a su equipo y la raíz a través de sus cookies, podría enviar una solicitud al servidor con este vale de autenticación robada y Obtenga la entrada.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="9f6d0-185">Aunque la expiración no impide que este escenario, limita la ventana durante el cual puede tener éxito este tipo de ataque.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-186">Paso 3 detalles adicionales técnicas usadas por el sistema de autenticación de formularios para proteger el vale de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>

<span data-ttu-id="9f6d0-187">Al crear el vale de autenticación, el sistema de autenticación de formularios determina su expiración consultando la configuración de tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="9f6d0-188">Como se indicó en la tabla 1, el tiempo de espera de establecer los valores predeterminados en 30 minutos, lo que significa que cuando se crea el vale de autenticación de formularios su expiración se establece en una fecha y hora, 30 minutos en el futuro.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="9f6d0-189">La expiración define un tiempo absoluto en el futuro cuando expira el vale de autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="9f6d0-190">Pero normalmente los desarrolladores desean implementar una expiración deslizante, que se restablece cada vez que el usuario vuelve a visitar el sitio.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="9f6d0-191">Este comportamiento viene determinada por la configuración de slidingExpiration.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="9f6d0-192">Si establece en true (valor predeterminado), cada vez FormsAuthenticationModule autentica un usuario, actualiza expiración del vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="9f6d0-193">Si se establece en false, la expiración no se actualiza en cada solicitud, lo que provoca el vale para expirar exactamente el tiempo de espera número de minutos transcurridos tras cuando el vale fue el primero creado.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-194">La expiración que se almacenan en el vale de autenticación es una fecha absoluta y el valor de tiempo, como el 2 de agosto de 2008 11:34 AM.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="9f6d0-195">Además, la fecha y hora son con respecto a la hora de local del servidor web.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="9f6d0-196">Esta decisión de diseño puede tener algunos efectos interesantes alrededor del horario de verano (DST), que es cuando los relojes de los Estados Unidos se adelanta una hora (suponiendo que el servidor web se hospeda en una configuración regional donde se observa el horario de verano).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="9f6d0-197">Tenga en cuenta lo que sucedería para un sitio Web ASP.NET con una expiración de 30 minutos cerca del momento en que comienza el horario de verano (que es a las 2:00 A.M.).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="9f6d0-198">Imagine que un visitante inicia sesión en el sitio del 11 de marzo de 2008 a las 1:55 AM.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="9f6d0-199">Esto generaría un vale de autenticación de formularios que expira a las 11 de marzo de 2008 a 2:25 a. M. (30 minutos en el futuro).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="9f6d0-200">Sin embargo, una vez RTM 2:00 A.M., el reloj salta a 3:00 A.M. a causa de horario de verano.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="9f6d0-201">Cuando el usuario cargue una nueva página de seis minutos después de iniciar sesión (a las 3:01 AM), FormsAuthenticationModule observa que el vale ha caducado y redirige al usuario a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="9f6d0-202">Para obtener una explicación más completa sobre esto y otras rarezas de tiempo de espera de vale de autenticación, así como soluciones alternativas, adquiera un ejemplar de Stefan Schackow *Professional ASP.NET 2.0 seguridad pertenencia y administración de roles* (ISBN: 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>

<span data-ttu-id="9f6d0-203">Figura 1 ilustra el flujo de trabajo cuando slidingExpiration se establece en false y el tiempo de espera se establece en 30.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="9f6d0-204">Tenga en cuenta que el vale de autenticación que se generan en el inicio de sesión contiene la fecha de expiración, y este valor no se actualiza en las solicitudes subsiguientes.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="9f6d0-205">Si FormsAuthenticationModule detecta que el vale ha caducado, se descarta y trata la solicitud como anónimo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>

<span data-ttu-id="9f6d0-206">[![Una representación gráfica de slidingExpiration de expiración cuando del vale autenticación de formularios es false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span></span>

<span data-ttu-id="9f6d0-207">**Figura 01**: Una representación gráfica de slidingExpiration de expiración cuando del vale autenticación de formularios es false ([haga clic aquí para ver imagen en tamaño completo](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="9f6d0-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span></span>

<span data-ttu-id="9f6d0-208">La figura 2 muestra el flujo de trabajo cuando slidingExpiration se establece en true y el tiempo de espera se establece en 30.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="9f6d0-209">Cuando se recibe una solicitud autenticada (con un vale no hayan caducado) se actualiza su expiración en tiempo de espera número de minutos en el futuro.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>

<span data-ttu-id="9f6d0-210">[![Una representación gráfica del vale de autenticación de formularios cuando slidingExpiration es true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span></span>

<span data-ttu-id="9f6d0-211">**Figura 02**: Una representación gráfica del vale de autenticación de formularios cuando es true slidingExpiration ([haga clic aquí para ver imagen en tamaño completo](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9f6d0-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span></span>

<span data-ttu-id="9f6d0-212">Cuando se utiliza vales de autenticación basada en cookies (el valor predeterminado), esta explicación se convierte en un poco más confusa porque las cookies también pueden tener sus propios expirados especificados.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="9f6d0-213">Expiración de una cookie (o falta de preparación) indica al explorador cuando se debe destruir la cookie.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="9f6d0-214">Si la cookie no tiene una fecha de expiración, se destruye cuando se cierra el explorador.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="9f6d0-215">Si una fecha de expiración está presente, sin embargo, la cookie permanece almacenada en el equipo del usuario hasta la fecha y ha pasado el tiempo especificado en la expiración.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="9f6d0-216">Cuando se destruye una cookie del explorador, ya no se envía al servidor web.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="9f6d0-217">Por lo tanto, la destrucción de una cookie es análoga al usuario cerrar la sesión en el sitio.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-218">Por supuesto, un usuario puede quitar proactivamente las cookies almacenadas en su equipo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="9f6d0-219">En Internet Explorer 7, podría ir a herramientas, opciones y haga clic en el botón Eliminar en la sección de historial de exploración.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="9f6d0-220">Desde allí, haga clic en el botón de eliminar las cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-220">From there, click the Delete cookies button.</span></span>

<span data-ttu-id="9f6d0-221">El sistema de autenticación de formularios crea cookies de sesión o expiración dependiendo del valor pasado a la *persistCookie* parámetro.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="9f6d0-222">Recuerde que los métodos de la clase FormsAuthentication GetAuthCookie SetAuthCookie y RedirectFromLoginPage toman dos parámetros de entrada: *username* y *persistCookie*.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="9f6d0-223">La página de inicio de sesión que se creó en el tutorial anterior incluye una casilla Recordar mi cuenta, que determina si se creó una cookie persistente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="9f6d0-224">Las cookies persistentes son basado en expiración; las cookies no persistentes son basados en sesión.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="9f6d0-225">Los conceptos de tiempo de espera y slidingExpiration que se discutió aplican el mismo para ambos cookies basadas en sesión y expiración.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="9f6d0-226">Hay solo una pequeña diferencia entre en ejecución: al usar cookies de expiración con slidingTimeout establecido en true, expiración de la cookie solo se actualiza cuando más que ha transcurrido la mitad del tiempo especificado.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="9f6d0-227">Vamos a actualizar directivas de tiempo de espera de vale de autenticación de nuestro sitio Web, por lo vales de tiempo de espera después de una hora (60 minutos), con una expiración variable.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="9f6d0-228">Para efectuar este cambio, actualice el archivo Web.config, agregar un &lt;formularios&gt; elemento a la &lt;autenticación&gt; elemento con el siguiente marcado:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="9f6d0-229">Uso de una dirección URL de página de inicio de sesión que no sean Login.aspx</span><span class="sxs-lookup"><span data-stu-id="9f6d0-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="9f6d0-230">Puesto que FormsAuthenticationModule redirige automáticamente los usuarios no autorizados a la página de inicio de sesión, debe saber la dirección URL de la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="9f6d0-231">Esta dirección URL especificada por el atributo loginUrl en el &lt;formularios&gt; elemento y el valor predeterminado es login.aspx.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="9f6d0-232">Si va a trasladar a través de un sitio Web existente, es posible que ya tiene una página de inicio de sesión con una dirección URL diferente, uno que ya se ha colocado un marcador e indizado por los motores de búsqueda.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="9f6d0-233">En lugar de cambiar el nombre de la página de inicio de sesión existente a login.aspx e interrupción de vínculos y los marcadores de los usuarios, en su lugar, puede modificar el atributo loginUrl para que apunte a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="9f6d0-234">Por ejemplo, si la página de inicio de sesión se denominaba SignIn.aspx y se encuentra en el directorio de usuarios, podría señalar el ajuste de configuración loginUrl ~/Users/SignIn.aspx así:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample3.xml)]

<span data-ttu-id="9f6d0-235">Dado que nuestra aplicación actual ya tiene una página de inicio de sesión llamada Login.aspx, no es necesario especificar un valor personalizado en el &lt;formularios&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="9f6d0-236">Paso 2: Uso sin cookies vales de autenticación de formularios</span><span class="sxs-lookup"><span data-stu-id="9f6d0-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="9f6d0-237">De forma predeterminada el sistema de autenticación de formularios determina si se almacenan sus vales de autenticación en la colección de cookies o incrustarlos en la dirección URL basada en el agente de usuario visita el sitio.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="9f6d0-238">Todos los exploradores de escritorio convencionales como Internet Explorer, Firefox, Opera y Safari, las cookies de soporte técnico, pero no todos los dispositivos móviles.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="9f6d0-239">La directiva de cookie utilizada por el sistema de autenticación de formularios depende de la configuración sin cookies en el &lt;formularios&gt; elemento, que se puede asignar uno de cuatro valores:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="9f6d0-240">UseCookies: Especifica que siempre se usará los vales de autenticación basada en cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="9f6d0-241">UseUri - indica que nunca se usará los vales de autenticación basada en cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="9f6d0-242">No se utiliza la detección automática: si el perfil de dispositivo no es compatible con las cookies, vales de autenticación basada en cookies; Si el perfil de dispositivo admite cookies, se utiliza un mecanismo de sondeo para determinar si las cookies están habilitadas.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="9f6d0-243">UseDeviceProfile - el valor predeterminado; vales de autenticación basada en cookies se utiliza sólo si el perfil de dispositivo admite cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="9f6d0-244">No se usa ningún mecanismo de sondeo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-244">No probing mechanism is used.</span></span>

<span data-ttu-id="9f6d0-245">La configuración de detección automática y UseDeviceProfile se basan en un *perfil de dispositivo* en determinar si se debe usar los vales de autenticación sin cookies o basada en cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="9f6d0-246">ASP.NET mantiene una base de datos de varios dispositivos y sus capacidades, por ejemplo, si son compatibles con las cookies, ¿qué versión de JavaScript que admiten y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="9f6d0-247">Cada vez que un dispositivo solicita una página web desde un servidor web envía a lo largo de un *usuario-agente* encabezado HTTP que identifica el tipo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="9f6d0-248">ASP.NET hace coincidir automáticamente la cadena user-agent proporcionado con el correspondiente perfil especificado en su base de datos.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-249">Esta base de datos de las capacidades del dispositivo se almacena en un número de archivos XML que cumplen el [esquema de archivo de definición de explorador](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="9f6d0-250">Los archivos de perfil de dispositivo de forma predeterminada se encuentran en % WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="9f6d0-251">También puede agregar archivos personalizados a la aplicación de la aplicación\_carpeta exploradores.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="9f6d0-252">Para obtener más información, vea el tema sobre [cómo Detectar tipos de exploradores de ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>

<span data-ttu-id="9f6d0-253">Dado que el valor predeterminado es UseDeviceProfile, vales de autenticación de formularios sin cookies se usará cuando se visita el sitio de un dispositivo cuyo perfil notifica que no es compatible con las cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="9f6d0-254">El vale de autenticación en la dirección URL de codificación</span><span class="sxs-lookup"><span data-stu-id="9f6d0-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="9f6d0-255">Las cookies son un medio natural para incluir información desde el explorador en cada solicitud a un determinado sitio Web, que es la razón por la configuración de autenticación de formularios de forma predeterminada usa cookies si el dispositivo visitando es compatible con ellos.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="9f6d0-256">Si no se admiten cookies, es indispensable utilizar medios alternativos para pasar el vale de autenticación del cliente al servidor.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="9f6d0-257">Es una solución común usada en entornos sin cookies codificar los datos de la cookie en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="9f6d0-258">Es la mejor forma de ver cómo se puede incrustar esa información en la dirección URL forzar que el sitio utilice vales de autenticación sin cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="9f6d0-259">Esto puede realizarse estableciendo el valor de configuración sin cookies en UseUri:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample4.xml)]

<span data-ttu-id="9f6d0-260">Una vez que haya realizado este cambio, visite el sitio mediante un explorador.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="9f6d0-261">Cuando se visita como usuario anónimo, las direcciones URL será exactamente como lo hacían antes.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="9f6d0-262">Por ejemplo, cuando se visita la página Default.aspx barra de direcciones de mi explorador muestra la dirección URL siguiente:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="9f6d0-263">Sin embargo, al iniciar sesión en, el vale de autenticación de formularios se incrusta en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="9f6d0-264">Por ejemplo, después de visitar la página de inicio de sesión e iniciar sesión como Sam, estoy volverá a la página Default.aspx, pero esta vez de la dirección URL es:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="9f6d0-265">El vale de autenticación de formularios se ha incrustado dentro de la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="9f6d0-266">La cadena (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv rfezq0gKadKX0YPZCkA2) representa la información del vale de autenticación con codificación hexadecimal, y son los mismos datos que normalmente se almacenan en una cookie.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="9f6d0-267">Para los vales de autenticación sin cookies para que funcione, el sistema debe codificar todas las direcciones URL en la página para incluir los datos del vale de autenticación, en caso contrario, se perderá el vale de autenticación cuando el usuario hace clic en un vínculo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="9f6d0-268">Afortunadamente, esta lógica de inserción se realiza automáticamente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="9f6d0-269">Para demostrar esta funcionalidad, abra la página Default.aspx y agregue un control de hipervínculo, establecer sus propiedades NavigateUrl y de texto para probar vínculo y SomePage.aspx, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="9f6d0-270">No importa que realmente no hay una página en el proyecto denominada SomePage.aspx.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="9f6d0-271">Guardar los cambios a Default.aspx y, a continuación, se visita a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="9f6d0-272">Inicie sesión en el sitio para que el vale de autenticación de formularios se incrusta en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="9f6d0-273">A continuación, en Default.aspx, haga clic en el vínculo Probar vínculo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="9f6d0-274">¿Qué ocurre?</span><span class="sxs-lookup"><span data-stu-id="9f6d0-274">What happened?</span></span> <span data-ttu-id="9f6d0-275">Si no existe ninguna página denominada SomePage.aspx, a continuación, se ha producido un error 404, pero no es lo que es importante aquí.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="9f6d0-276">En su lugar, se centran en la barra de direcciones del explorador.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="9f6d0-277">Tenga en cuenta que incluye el vale de autenticación de formularios en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="9f6d0-278">La dirección URL SomePage.aspx en el vínculo se convierte automáticamente en una dirección URL que incluye el vale de autenticación: no hemos tenido que escribir ni una pizca de código!</span><span class="sxs-lookup"><span data-stu-id="9f6d0-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="9f6d0-279">El vale de autenticación de formulario se incrustan automáticamente en la dirección URL de los hipervínculos que no empiecen por http:// o /.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with http:// or /.</span></span> <span data-ttu-id="9f6d0-280">No importa si el hipervínculo que aparece en una llamada para Response.Redirect, en un control de hipervínculo o en un elemento delimitador HTML (es decir, &lt;un href = "..."&gt;... &lt;/a&gt;).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., &lt;a href="..."&gt;...&lt;/a&gt;).</span></span> <span data-ttu-id="9f6d0-281">Siempre que la dirección URL no es algo parecido a http://www.someserver.com/SomePage.aspx o /SomePage.aspx, los formularios se incrustará el vale de autenticación para nosotros.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-281">As long as the URL isn't something like http://www.someserver.com/SomePage.aspx or /SomePage.aspx, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-282">Vales de autenticación de formularios sin cookies cumplen las mismas directivas de tiempo de espera que los vales de autenticación basada en cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="9f6d0-283">Sin embargo, los vales de autenticación sin cookies son más propensas a ataques de reproducción, puesto que el vale de autenticación está incrustado directamente en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="9f6d0-284">Imagine un usuario que visita un sitio Web, inicia sesión y, a continuación, se pega la dirección URL en un correo electrónico a un compañero de trabajo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="9f6d0-285">Si su compañero hace clic en ese vínculo antes de alcanza la expiración, iniciará sesión en que el usuario que envió el correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>

## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="9f6d0-286">Paso 3: Proteger el vale de autenticación</span><span class="sxs-lookup"><span data-stu-id="9f6d0-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="9f6d0-287">El vale de autenticación de formularios se transmite a través de la conexión en una cookie o incrustados directamente en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="9f6d0-288">Además de información de identidad, el vale de autenticación también puede incluir datos de usuario (como veremos en el paso 4).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="9f6d0-289">Por lo tanto, es importante que se cifren los datos del vale de ojos espía y (incluso más importante) que el sistema de autenticación de formularios puede garantizar que no se ha alterado el vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="9f6d0-290">Para garantizar la privacidad de los datos del vale, el sistema de autenticación de formularios puede cifrar los datos del vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="9f6d0-291">Error al cifrar los datos del vale envía información potencialmente confidencial a través de la red en texto sin formato.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="9f6d0-292">Para garantizar la autenticidad de un vale, el sistema de autenticación de formularios debe *validar* el vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="9f6d0-293">La validación es el acto de garantizar que no se ha modificado un elemento de datos determinado y se logra a través de un  *[de mensajes (MAC) del código de autenticación](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="9f6d0-294">En pocas palabras, el equipo MAC es un pequeño fragmento de información que identifica los datos que necesita ser validada (en este caso, el vale).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="9f6d0-295">Si se modifican los datos representados por el equipo MAC, a continuación, el equipo MAC y los datos no coincidirá con.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="9f6d0-296">Además, es difícil computacionalmente para un pirata informático tanto modificar los datos y generar su propio equipo MAC para que se correspondan con los datos modificados.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="9f6d0-297">Al crear (o modificar) una incidencia, el sistema de autenticación de formularios crea un equipo MAC y lo adjunta a los datos del vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="9f6d0-298">Cuando llega una solicitud posterior, el sistema de autenticación de formularios compara los datos de MAC y el vale para validar la autenticidad de los datos del vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="9f6d0-299">Figura 3 ilustra gráficamente este flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-299">Figure 3 illustrates this workflow graphically.</span></span>

<span data-ttu-id="9f6d0-300">[![Se garantiza la autenticidad del vale a través de un equipo MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span></span>

<span data-ttu-id="9f6d0-301">**Figura 03**: Se garantiza la autenticidad del vale a través de un equipo MAC ([haga clic aquí para ver imagen en tamaño completo](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="9f6d0-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span></span>

<span data-ttu-id="9f6d0-302">¿Qué medidas de seguridad se aplican al vale de autenticación depende de la configuración de protección en el &lt;formularios&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="9f6d0-303">La configuración de protección puede asignarse a uno de los tres valores siguientes:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="9f6d0-304">Todo: el vale está cifrado y firmado digitalmente (el valor predeterminado).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="9f6d0-305">Cifrado: cifrado solo se aplica: no se genera ningún equipo MAC.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="9f6d0-306">: El vale se cifran ni firmado digitalmente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="9f6d0-307">Se genera la validación: un equipo MAC, pero los datos del vale se envían a través de la conexión en texto sin formato.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="9f6d0-308">Microsoft recomienda utilizar la configuración de todos.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="9f6d0-309">Establecimiento de la validación y las claves de descifrado</span><span class="sxs-lookup"><span data-stu-id="9f6d0-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="9f6d0-310">El cifrado y hash algoritmos usados por el sistema de autenticación de formularios para cifrar y validar el vale de autenticación son personalizables a través de la [ &lt;machineKey&gt; elemento](https://msdn.microsoft.com/library/w8h3skw9.aspx) en el archivo Web.config. Tabla 2 contornos el &lt;machineKey&gt; atributos del elemento y sus valores posibles.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="9f6d0-311">**Attribute**</span><span class="sxs-lookup"><span data-stu-id="9f6d0-311">**Attribute**</span></span> | <span data-ttu-id="9f6d0-312">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="9f6d0-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="9f6d0-313">descifrado</span><span class="sxs-lookup"><span data-stu-id="9f6d0-313">decryption</span></span> | <span data-ttu-id="9f6d0-314">Indica el algoritmo utilizado para el cifrado.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="9f6d0-315">Este atributo puede tener uno de los siguientes cuatro valores: - Auto - el valor predeterminado; Determina el algoritmo que se basa en la longitud del atributo decryptionKey.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="9f6d0-316">-AES - utiliza el [estándar de cifrado avanzado (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algoritmo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="9f6d0-317">-DES - utiliza el [estándar de cifrado de datos (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) este algoritmo se considera computacionalmente débil y no debe usarse.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="9f6d0-318">-3DES - utiliza el [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algoritmo, que aplica el algoritmo DES triple.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="9f6d0-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="9f6d0-319">decryptionKey</span></span> | <span data-ttu-id="9f6d0-320">La clave secreta usada por el algoritmo de cifrado.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="9f6d0-321">Este valor debe ser una cadena hexadecimal de la longitud apropiada (según el valor de descifrado), generar automáticamente o cualquiera de los valores anexada, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="9f6d0-322">Agregar IsolateApps indica a ASP.NET que utilice un valor único para cada aplicación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="9f6d0-323">El valor predeterminado es AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="9f6d0-324">validación</span><span class="sxs-lookup"><span data-stu-id="9f6d0-324">validation</span></span> | <span data-ttu-id="9f6d0-325">Indica el algoritmo utilizado para la validación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="9f6d0-326">Este atributo puede tener uno de los siguientes cuatro valores: - AES - utiliza el algoritmo estándar de cifrado avanzado (AES).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="9f6d0-327">-MD5 - utiliza el [síntesis del mensaje 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algoritmo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="9f6d0-328">-SHA1 - utiliza el [SHA1](http://en.wikipedia.org/wiki/Sha1) algoritmo (el valor predeterminado).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="9f6d0-329">-3DES - utiliza el algoritmo Triple DES.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="9f6d0-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="9f6d0-330">validationKey</span></span> | <span data-ttu-id="9f6d0-331">La clave secreta usada por el algoritmo de validación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="9f6d0-332">Este valor debe ser una cadena hexadecimal de la longitud apropiada (según el valor en la validación), generar automáticamente o cualquiera de los valores anexada, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="9f6d0-333">Agregar IsolateApps indica a ASP.NET que utilice un valor único para cada aplicación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="9f6d0-334">El valor predeterminado es AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="9f6d0-335">**Tabla 2**: El &lt;machineKey&gt; atributos del elemento</span><span class="sxs-lookup"><span data-stu-id="9f6d0-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="9f6d0-336">Una discusión detallada de estas opciones de cifrado y validación y las ventajas y desventajas de los diversos algoritmos, queda fuera del ámbito de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="9f6d0-337">Para buscar información detallada en estos problemas, incluidas instrucciones sobre qué algoritmos de cifrado y validación que se utilizan, qué longitudes de clave para usar y la mejor manera de generar estas claves, consulte *Professional ASP.NET 2.0 seguridad pertenencia y administración de roles* .</span><span class="sxs-lookup"><span data-stu-id="9f6d0-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="9f6d0-338">De forma predeterminada, las claves utilizadas para el cifrado y validación se generan automáticamente para cada aplicación, y dichas claves están almacenadas en la autoridad de seguridad Local (LSA).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="9f6d0-339">En resumen, la configuración predeterminada garantiza las claves únicas en un servidor web de web-server y la aplicación por aplicación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="9f6d0-340">Por lo tanto, este comportamiento predeterminado no funcionará para los dos escenarios siguientes:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="9f6d0-341">**Granja de servidores Web** : en un [granja de servidores web](http://en.wikipedia.org/wiki/Web_farm) escenario, una sola aplicación web se hospeda en varios servidores web para los fines de redundancia y escalabilidad.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="9f6d0-342">Cada solicitud entrante se envía a un servidor en la granja de servidores, lo que significa que durante la vigencia de una sesión de usuario, los servidores diferentes se pueden utilizar para controlar sus varias solicitudes.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="9f6d0-343">Por lo tanto, cada servidor debe usar las mismas claves de cifrado y validación para que cree el vale de autenticación de formularios, cifrado y validado en un servidor puede descifrar y validar en un servidor diferente en la granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="9f6d0-344">**Cruzar el vale de uso compartido de aplicaciones** -un único servidor web puede hospedar varias aplicaciones de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="9f6d0-345">Si necesita para que estas aplicaciones diferentes compartir un vale de autenticación de formularios único, es imperativo que coinciden con sus claves de cifrado y validación de.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="9f6d0-346">Cuando se trabaja en una granja de servidores web, configuración o vales de autenticación de uso compartido entre aplicaciones en el mismo servidor, deberá configurar el &lt;machineKey&gt; elemento en las aplicaciones afectadas para que sus decryptionKey y los valores de validationKey coinciden.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="9f6d0-347">Aunque ninguno de los escenarios anteriores se aplica a nuestra aplicación de ejemplo, aún podemos especificar los valores de validationKey y decryptionKey explícita y definir los algoritmos que se usará.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="9f6d0-348">Agregar un &lt;machineKey&gt; si se establece en el archivo Web.config:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample5.xml)]

<span data-ttu-id="9f6d0-349">Para obtener más información consulte [How To: Configurar MachineKey en ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-350">Los valores decryptionKey y validationKey se realizaron desde [Steve Gibson](http://www.grc.com/stevegibson.htm)del [perfecto contraseñas web página](https://www.grc.com/passwords.htm), lo que genera 64 caracteres hexadecimales aleatorios cada vez que visito página.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="9f6d0-351">Para reducir la probabilidad de que estas claves incorporarlas a sus aplicaciones de producción, se recomienda reemplazar las claves anteriores junto con generado aleatoriamente que desde la página de contraseñas perfecto.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>

## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="9f6d0-352">Paso 4: Almacenar datos de usuario adicionales en el vale</span><span class="sxs-lookup"><span data-stu-id="9f6d0-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="9f6d0-353">Muchas aplicaciones web mostrar información sobre o mostrar la página de base en el usuario ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="9f6d0-354">Por ejemplo, una página web puede mostrar el nombre de usuario y la fecha por última vez que inició sesión en la esquina superior de cada página.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="9f6d0-355">El vale de autenticación de formularios almacena el nombre de usuario del usuario ha iniciado sesión actualmente, pero cuando se necesita cualquier otra información, la página debe ir a la tienda de usuario - normalmente una base de datos - para buscar la información no almacenada en el vale de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="9f6d0-356">Con un poco de código podemos almacenar información adicional del usuario en el vale de autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="9f6d0-357">Estos datos se pueden expresar mediante la [clase FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)del [propiedad UserData](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="9f6d0-358">Se trata de un lugar útil para colocar pequeñas cantidades de información sobre el usuario que normalmente se necesita.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="9f6d0-359">El valor especificado en la propiedad se incluye como parte de la cookie de vale de autenticación y, al igual que los demás campos vale, se cifran y validado de UserData según la configuración del sistema de autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="9f6d0-360">De forma predeterminada, UserData es una cadena vacía.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="9f6d0-361">Para almacenar datos de usuario en el vale de autenticación, se debe escribir un fragmento de código en la página de inicio de sesión que toma la información específica del usuario y lo almacena en el vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="9f6d0-362">Puesto que UserData es una propiedad de tipo cadena, se deben serializar correctamente los datos almacenados en ella como una cadena.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-362">Since UserData is a property of type String, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="9f6d0-363">Por ejemplo, imagine que nuestro almacén de usuario incluye la fecha de nacimiento de cada usuario y el nombre de su empleador y queríamos almacenar valores de estas dos propiedades en el vale de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="9f6d0-364">Nos podríamos serializar estos valores en una cadena mediante la concatenación de fecha del usuario de cadena del nacimiento con una barra vertical (|), seguido del nombre de la empresa.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="9f6d0-365">Para un usuario nacido en el 15 de agosto de 1974 que funciona para Northwind Traders, se asigna la propiedad UserData la cadena: 1974-08-15 | Northwind Traders.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="9f6d0-366">Cada vez que se necesita tener acceso a los datos almacenados en el vale, podemos hacerlo; para hacerlo FormsAuthenticationTicket de la solicitud actual y deserializar la propiedad UserData.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="9f6d0-367">En el caso de la fecha de nacimiento y el empresario ejemplo de nombre, se podría dividir la cadena de UserData en dos subcadenas según el delimitador (|).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>

<span data-ttu-id="9f6d0-368">[![Información adicional del usuario se puede almacenar en el vale de autenticación](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span></span>

<span data-ttu-id="9f6d0-369">**Figura 04**: Adicionales usuario información puede almacenarse en el vale de autenticación ([haga clic aquí para ver imagen en tamaño completo](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="9f6d0-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span></span>

### <a name="writing-information-to-userdata"></a><span data-ttu-id="9f6d0-370">Escribir información en UserData</span><span class="sxs-lookup"><span data-stu-id="9f6d0-370">Writing Information to UserData</span></span>

<span data-ttu-id="9f6d0-371">Lamentablemente, no es tan sencillo como uno podría esperar agregar información específica del usuario a un vale de autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="9f6d0-372">La propiedad UserData de la clase FormsAuthenticationTicket es de solo lectura y solo se puede especificar a través del constructor de clase FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="9f6d0-373">Al especificar la propiedad UserData en el constructor, también se debe proporcionar el vale 's otros valores: el nombre de usuario, la fecha de emisión, la expiración y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="9f6d0-374">Cuando se creó la página de inicio de sesión en el tutorial anterior, esto se todos controló por nosotros la clase FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="9f6d0-375">Al agregar UserData a FormsAuthenticationTicket, necesitamos escribir código para replicar muchas de las funcionalidades ya proporciona la clase FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="9f6d0-376">Vamos a examinar el código necesario para trabajar con datos del usuario mediante la actualización de la página Login.aspx para registrar información adicional sobre el usuario para el vale de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="9f6d0-377">Supongamos que nuestro almacén de usuario contiene información acerca de la empresa trabaja el usuario y su título, y que queremos capturar esta información en el vale de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="9f6d0-378">Actualice el controlador de eventos LoginButton haga clic en la página Login.aspx por lo que el código tenga un aspecto similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample6.vb)]

<span data-ttu-id="9f6d0-379">Vamos a recorrer este código de línea a la vez.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="9f6d0-380">El método comienza definiendo cuatro matrices de cadenas: los usuarios, contraseñas, companyName y titleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="9f6d0-381">Estas matrices contienen los nombres de usuario, contraseñas, nombres de compañía y títulos de las cuentas de usuario en el sistema, de que existen tres: Scott, Jisun y Sam.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="9f6d0-382">En una aplicación real, se podrían consultar estos valores desde el almacén de usuario, no codificados de forma rígida en el código fuente de la página.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="9f6d0-383">En el tutorial anterior, si las credenciales proporcionadas son válidas se denomina simplemente FormsAuthentication.RedirectFromLoginPage (UserName.Text, RememberMe.Checked), que realiza los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="9f6d0-384">Crea los formularios de vale de autenticación</span><span class="sxs-lookup"><span data-stu-id="9f6d0-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="9f6d0-385">El vale se escribió en el almacén adecuado.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="9f6d0-386">Para los vales de autenticación basada en cookies, se usa la colección de cookies del explorador; para los vales de autenticación sin cookies, se serializan los datos de entradas en la dirección URL</span><span class="sxs-lookup"><span data-stu-id="9f6d0-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="9f6d0-387">Redirige al usuario a la página adecuada</span><span class="sxs-lookup"><span data-stu-id="9f6d0-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="9f6d0-388">Estos pasos se replican en el código anterior.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="9f6d0-389">En primer lugar, la cadena que se almacenará en la propiedad UserData finalmente se forma combinando el nombre de la empresa y el título, la delimitación de los dos valores con un carácter de barra vertical (|).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="9f6d0-390">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span><span class="sxs-lookup"><span data-stu-id="9f6d0-390">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span></span>

<span data-ttu-id="9f6d0-391">A continuación, el FormsAuthentication.GetAuthCookie se invoca al método, que crea el vale de autenticación, cifra y lo valida según los valores de configuración y lo coloca en un objeto HttpCookie.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="9f6d0-392">Dim authCookie como HttpCookie = FormsAuthentication.GetAuthCookie (UserName.Text, RememberMe.Checked)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-392">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span></span>

<span data-ttu-id="9f6d0-393">Para trabajar con el FormAuthenticationTicket incrustada dentro de la cookie, es necesario llamar a la clase FormAuthentication [descifrar método](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), pasando el valor de cookie.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="9f6d0-394">Dim vale FormsAuthenticationTicket como = FormsAuthentication.Decrypt(authCookie.Value)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-394">Dim ticket As FormsAuthenticationTicket = FormsAuthentication.Decrypt(authCookie.Value)</span></span>

<span data-ttu-id="9f6d0-395">A continuación, creamos un *nuevo* FormsAuthenticationTicket instancia según los valores del objeto FormsAuthenticationTicket existente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="9f6d0-396">Sin embargo, este nuevo vale incluye la información específica del usuario (userDataString).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="9f6d0-397">Dim newTicket como FormsAuthenticationTicket = FormsAuthenticationTicket(ticket. nuevo Versión, vale. Nombre, vale. IssueDate, vale. Caducidad, vale. IsPersistent, userDataString)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-397">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString)</span></span>

<span data-ttu-id="9f6d0-398">Nosotros, a continuación, cifrar (y validar) la nueva instancia de objeto FormsAuthenticationTicket mediante una llamada a la [cifrar método](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)y se vuelven a poner estos datos cifrados (y validados) en authCookie.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="9f6d0-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span></span>

<span data-ttu-id="9f6d0-400">Por último, authCookie se agrega a la colección Response.Cookies y se llama al método de GetRedirectUrl para determinar la página adecuada para enviar al usuario.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample7.vb)]

<span data-ttu-id="9f6d0-401">Todo este código es necesario porque la propiedad UserData es de solo lectura y la clase FormsAuthentication no proporciona ningún método para especificar la información de UserData en sus métodos GetAuthCookie, SetAuthCookie o RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-402">El código que simplemente examinamos almacena información específica del usuario en un vale de autenticación basada en cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="9f6d0-403">El responsable de serializar el vale de autenticación de formularios a la dirección URL de las clases son internas a .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="9f6d0-404">Larga historia breve, no se puede almacenar datos de usuario en un vale de autenticación de formularios sin cookies.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>

### <a name="accessing-the-userdata-information"></a><span data-ttu-id="9f6d0-405">Acceso a la información de UserData</span><span class="sxs-lookup"><span data-stu-id="9f6d0-405">Accessing the UserData Information</span></span>

<span data-ttu-id="9f6d0-406">En este momento el nombre de la empresa y el título de cada usuario se almacena en UserData propiedad del vale autenticación de formularios cuando inicie sesión.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="9f6d0-407">Esta información puede obtenerse desde el vale de autenticación en cualquier página sin necesidad de un viaje en el almacén de usuario.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="9f6d0-408">Para ilustrar cómo se puede recuperar esta información de la propiedad UserData, vamos a actualizar Default.aspx para que su mensaje de bienvenida incluye no sólo el nombre del usuario, pero también la compañía que trabajan para y su título.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="9f6d0-409">Actualmente, Default.aspx contiene un AuthenticatedMessagePanel Panel con un control de etiqueta denominado WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="9f6d0-410">Este Panel solo se muestra a los usuarios autenticados.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="9f6d0-411">Actualice el código en la página del Default.aspx\_cargar el controlador de eventos para que tenga un aspecto similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample8.vb)]

<span data-ttu-id="9f6d0-412">Si Request.IsAuthenticated es True, entonces la propiedad de texto del WelcomeBackMessage se establece primero en Bienvenido de nuevo, *username*.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-412">If Request.IsAuthenticated is True, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="9f6d0-413">A continuación, la propiedad User.Identity se convierte en un objeto FormsIdentity para que podamos acceder a FormsAuthenticationTicket subyacente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="9f6d0-414">Una vez que tenemos FormsAuthenticationTicket, se deserializa la propiedad UserData en el nombre de la empresa y el título.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="9f6d0-415">Esto se consigue mediante la división de la cadena en el carácter de barra vertical.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="9f6d0-416">El nombre de la empresa y el título se muestran a continuación, en la etiqueta WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="9f6d0-417">Figura 5 muestra una captura de pantalla de esta presentación en acción.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="9f6d0-418">Inicie sesión como Scott muestra un mensaje de back-Bienvenido que incluye la empresa y el título de Scott.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>

<span data-ttu-id="9f6d0-419">[![Empresa actualmente ha iniciado en del usuario y el título se muestran](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span></span>

<span data-ttu-id="9f6d0-420">**Figura 05**: Empresa actualmente ha iniciado en del usuario y el título se muestran ([haga clic aquí para ver imagen en tamaño completo](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="9f6d0-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-421">Propiedad de UserData del vale de autenticación actúa como una memoria caché para el almacén del usuario.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="9f6d0-422">Al igual que cualquier caché, debe actualizarse cuando se modifican los datos subyacentes.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="9f6d0-423">Por ejemplo, si hay una página web desde el que los usuarios pueden actualizar su perfil, los campos almacenados en caché en la propiedad UserData deben actualizarse para reflejar los cambios realizados por el usuario.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>

## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="9f6d0-424">Paso 5: Uso de una entidad personalizada</span><span class="sxs-lookup"><span data-stu-id="9f6d0-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="9f6d0-425">En cada solicitud entrante FormsAuthenticationModule intenta autenticar al usuario.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="9f6d0-426">Si está presente un vale de autenticación no expiradas, FormsAuthenticationModule asigna la propiedad HttpContext.User a un nuevo objeto GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="9f6d0-427">Este objeto GenericPrincipal tiene una identidad de tipo FormsIdentity, que incluye una referencia al vale de autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="9f6d0-428">La clase GenericPrincipal contiene la funcionalidad mínima operativo necesaria para una clase que implementa IPrincipal: solo tiene una propiedad de identidad y un método IsInRole.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="9f6d0-429">El objeto principal tiene dos responsabilidades: para indicar qué roles que pertenece el usuario y para proporcionar información de identidad.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="9f6d0-430">Esto se logra a través de IsInRole la interfaz IPrincipal (*roleName*) método y propiedad de identidad, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="9f6d0-431">La clase GenericPrincipal permite una matriz de cadenas de nombres de función para especificarse a través de su constructor; su IsInRole (*roleName*) método simplemente comprueba si ha pasado en *roleName* existe dentro de la matriz de cadenas.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="9f6d0-432">Cuando FormsAuthenticationModule crea el objeto GenericPrincipal, pasa una matriz de cadena vacía al constructor de GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="9f6d0-433">Por lo tanto, cualquier llamada a IsInRole siempre devolverá False.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-433">Consequently, any call to IsInRole will always return False.</span></span>

<span data-ttu-id="9f6d0-434">La clase GenericPrincipal satisface las necesidades para escenarios de autenticación basada en formularios mayoría donde no se usan los roles.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="9f6d0-435">En aquellas situaciones donde el tratamiento del rol predeterminado no es suficiente o cuando necesite asociar un objeto IIdentity personalizado con el usuario, puede crear un objeto IPrincipal personalizado durante el flujo de trabajo de autenticación y asignarla a la propiedad HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-436">Como veremos en el futuro tutoriales, cuando ASP. Está habilitada framework de Roles de .NET crea un objeto principal personalizado del tipo [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) y sobrescribe el objeto GenericPrincipal creado para la autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="9f6d0-437">Lo hace para personalizar el método IsInRole de la entidad de seguridad para interactuar con la API de .NET framework de Roles.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>

<span data-ttu-id="9f6d0-438">Puesto que nos hemos no le preocupa nosotros mismos roles aún, la única razón que para crear a una entidad personalizada en ese momento, tendríamos sería asociar un objeto IIdentity personalizado a la entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="9f6d0-439">En el paso 4 analizamos almacenar información adicional del usuario en la propiedad UserData del vale de autenticación, en particular, su título y el nombre de la empresa del usuario.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="9f6d0-440">Sin embargo, la información de UserData solo es accesible mediante el vale de autenticación y, a continuación, solo como una cadena serializada, lo que significa que, cuando queremos ver la información de usuario almacenada en el vale se necesita analizar la propiedad UserData.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="9f6d0-441">Podemos mejorar la experiencia del desarrollador mediante la creación de una clase que implementa IIdentity e incluye las propiedades de título y CompanyName.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="9f6d0-442">De este modo, un desarrollador puede tener acceso a nombre de la empresa del usuario ha iniciado sesión actualmente, y título directamente a través de las propiedades de título y CompanyName sin que sea necesario saber cómo analizar la propiedad UserData.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="9f6d0-443">Creación de la identidad personalizada y las clases de entidad de seguridad</span><span class="sxs-lookup"><span data-stu-id="9f6d0-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="9f6d0-444">Para este tutorial, vamos a crear los objetos principal e identity personalizados en la aplicación\_carpeta de código.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="9f6d0-445">Empiece por agregar una aplicación\_carpeta al proyecto de código: haga doble clic en el nombre del proyecto en el Explorador de soluciones, seleccione la opción de Agregar carpeta ASP.NET y elija aplicación\_código.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="9f6d0-446">La aplicación\_carpeta de código es una carpeta especial de ASP.NET que contiene archivos específico para el sitio Web de clase.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="9f6d0-447">La aplicación\_carpeta de código solo debe usarse al administrar el proyecto mediante el modelo de proyecto de sitio Web.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="9f6d0-448">Si usas el [modelo de proyecto de aplicación Web](https://msdn.microsoft.com/asp.net/Aa336618.aspx), cree una carpeta estándar y agregue las clases a la.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="9f6d0-449">Por ejemplo, podría agregar una carpeta nueva denominada clases y colocar el código allí.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-449">For example, you could add a new folder named Classes, and place your code there.</span></span>

<span data-ttu-id="9f6d0-450">A continuación, agregue dos nuevos archivos de clase a la aplicación\_carpeta de código, una CustomIdentity.vb con nombre y otra denominan CustomPrincipal.vb.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.vb and one named CustomPrincipal.vb.</span></span>

<span data-ttu-id="9f6d0-451">[![Agregue las clases de CustomPrincipal y CustomIdentity al proyecto](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span></span>

<span data-ttu-id="9f6d0-452">**Figura 06**: Agregar las clases de CustomPrincipal y CustomIdentity a su proyecto ([haga clic aquí para ver imagen en tamaño completo](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="9f6d0-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span></span>

<span data-ttu-id="9f6d0-453">La clase CustomIdentity es responsable de implementar la interfaz de IIdentity, que define las propiedades de nombre, IsAuthenticated y AuthenticationType.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="9f6d0-454">Además de las propiedades necesarias, estamos interesados en exponer el subyacente vale de autenticación de formularios, así como propiedades de nombre de la empresa y el título del usuario.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="9f6d0-455">Escriba el código siguiente en la clase CustomIdentity.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample9.vb)]

<span data-ttu-id="9f6d0-456">Tenga en cuenta que la clase incluye una variable de miembro FormsAuthenticationTicket (\_vale) y que se debe proporcionar esta información del vale a través del constructor.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="9f6d0-457">Estos datos de vale se utilizan para devolver el nombre de identidad; su propiedad UserData se analiza para devolver los valores de las propiedades de título y CompanyName.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="9f6d0-458">A continuación, cree la clase CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="9f6d0-459">Puesto que no se preocupan los roles en ese momento, el constructor de la clase CustomPrincipal acepta solo un objeto CustomIdentity; su método IsInRole siempre devuelve False.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns False.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample10.vb)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="9f6d0-460">Asignación de un objeto CustomPrincipal al contexto de seguridad de la solicitud entrante</span><span class="sxs-lookup"><span data-stu-id="9f6d0-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="9f6d0-461">Ahora tenemos una clase que extiende la especificación de IIdentity predeterminado para incluir propiedades de título y CompanyName, así como una clase entidad personalizada que usa la identidad personalizada.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="9f6d0-462">Se está preparados para ir a la canalización de ASP.NET y se asigna el objeto principal personalizado al contexto de seguridad de la solicitud entrante.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="9f6d0-463">La canalización de ASP.NET toma una solicitud entrante y lo procesa mediante una serie de pasos.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="9f6d0-464">En cada paso, se genera un evento determinado, lo que permite a los desarrolladores aprovechar la canalización de ASP.NET y modifique la solicitud en ciertos puntos de su ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="9f6d0-465">FormsAuthenticationModule, por ejemplo, se espera para que ASP.NET genere la [evento AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), momento en que examina las solicitudes entrantes de un vale de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="9f6d0-466">Si se encuentra un vale de autenticación, se crea un objeto GenericPrincipal y se asigna a la propiedad HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="9f6d0-467">Después del evento AuthenticateRequest, la canalización de ASP.NET genera el [PostAuthenticateRequest eventos](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), que es donde podemos reemplazar el objeto GenericPrincipal creado por FormsAuthenticationModule con una instancia de nuestra Objeto CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="9f6d0-468">Figura 7 muestra este flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-468">Figure 7 depicts this workflow.</span></span>

<span data-ttu-id="9f6d0-469">[![El objeto GenericPrincipal se sustituye por un CustomPrincipal en el evento PostAuthenticationRequest](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span></span>

<span data-ttu-id="9f6d0-470">**Figura 07**: El objeto GenericPrincipal se sustituye por un CustomPrincipal en el evento PostAuthenticationRequest ([haga clic aquí para ver imagen en tamaño completo](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="9f6d0-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span></span>

<span data-ttu-id="9f6d0-471">Para ejecutar código en respuesta a un evento de la canalización ASP.NET, nos podemos crear el controlador de eventos apropiado en Global.asax o crear nuestro propio módulo HTTP.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="9f6d0-472">En este tutorial vamos a crear el controlador de eventos en Global.asax.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="9f6d0-473">Empiece agregando Global.asax a su sitio Web.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="9f6d0-474">Haga doble clic en el nombre del proyecto en el Explorador de soluciones y agregue un elemento de tipo de clase de aplicación Global denominada Global.asax.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>

<span data-ttu-id="9f6d0-475">[![Agregue un archivo Global.asax para su sitio Web](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span></span>

<span data-ttu-id="9f6d0-476">**Figura 08**: Agregue un archivo Global.asax para su sitio Web ([haga clic aquí para ver imagen en tamaño completo](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="9f6d0-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span></span>

<span data-ttu-id="9f6d0-477">La plantilla predeterminada de Global.asax incluye controladores de eventos para un número de los eventos de canalización ASP.NET, incluido el inicio, fin y [evento de Error](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), entre otros.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="9f6d0-478">No dude en quitar estos controladores de eventos, ya no se necesita para esta aplicación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="9f6d0-479">El evento que nos interesa es PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="9f6d0-480">Actualice el archivo Global.asax para que su marcado tiene un aspecto similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample11.aspx)]

<span data-ttu-id="9f6d0-481">La aplicación\_OnPostAuthenticateRequest método ejecuta cada vez que el tiempo de ejecución ASP.NET genera el evento PostAuthenticateRequest, lo que sucede una vez en cada solicitud entrante de la página.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="9f6d0-482">El controlador de eventos se inicia y comprueba si el usuario se autentica y se autenticó mediante la autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="9f6d0-483">Si es así, se crea un nuevo objeto de CustomIdentity y se pasa el vale de autenticación de la solicitud actual en su constructor.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="9f6d0-484">A continuación, un objeto CustomPrincipal se crea y se pasa el objeto CustomIdentity acaba de crear en su constructor.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="9f6d0-485">Por último, se asigna el contexto de seguridad de la solicitud actual para el objeto CustomPrincipal recién creado.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="9f6d0-486">Tenga en cuenta que el último paso: asociar el objeto CustomPrincipal con contexto de seguridad de la solicitud - asigna a la entidad a dos propiedades: HttpContext.User y Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="9f6d0-487">Estas dos asignaciones son necesarias debido a la manera en que se administran los contextos de seguridad en ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="9f6d0-488">.NET Framework se asocia un contexto de seguridad a cada subproceso en ejecución; Esta información está disponible como un objeto IPrincipal a través de la [objeto Thread](https://msdn.microsoft.com/library/system.threading.thread.aspx)del [propiedad CurrentPrincipal](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="9f6d0-489">¿Qué es un tipo de confusión es que ASP.NET tiene su propia información de contexto de seguridad (HttpContext.User).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="9f6d0-490">En determinados escenarios, se examina la propiedad Thread.CurrentPrincipal al determinar el contexto de seguridad; en otros escenarios, se usa HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="9f6d0-491">Por ejemplo, existen características de seguridad de .NET que permiten a los desarrolladores mediante declaración indicar qué usuarios o roles pueden crear una instancia de una clase o invocar métodos específicos (consulte [agregar reglas de autorización de negocio y capas de datos con PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="9f6d0-492">Interiormente, estas técnicas declarativas determinan el contexto de seguridad a través de la propiedad Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="9f6d0-493">En otros escenarios, se usa la propiedad HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="9f6d0-494">Por ejemplo, en el tutorial anterior se utiliza esta propiedad para mostrar el nombre de usuario del usuario ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="9f6d0-495">Claramente, a continuación, es imprescindible que la información de contexto de seguridad en las propiedades de Thread.CurrentPrincipal y HttpContext.User coincide.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="9f6d0-496">El tiempo de ejecución ASP.NET sincroniza automáticamente estos valores de propiedad para nosotros.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="9f6d0-497">Sin embargo, la sincronización se produce después del evento AuthenticateRequest, pero *antes* el evento PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="9f6d0-498">Por lo tanto, al agregar una entidad de seguridad personalizada en el evento PostAuthenticateRequest debemos estar seguro de que asignar manualmente Thread.CurrentPrincipal o bien Thread.CurrentPrincipal y HttpContext.User estarán sincronizados. Consulte [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) para obtener una explicación más detallada sobre este problema.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="9f6d0-499">Acceso a CompanyName y propiedades del título</span><span class="sxs-lookup"><span data-stu-id="9f6d0-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="9f6d0-500">Cada vez que se recibe una solicitud y se envía al motor de ASP.NET, la aplicación\_se activará el controlador de eventos OnPostAuthenticateRequest en Global.asax.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="9f6d0-501">Si la solicitud se ha autenticado correctamente por FormsAuthenticationModule, el controlador de eventos creará un nuevo objeto CustomPrincipal con un objeto de CustomIdentity basado en el vale de autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="9f6d0-502">Con esta lógica en su lugar, tener acceso a información sobre el nombre de la empresa del usuario ha iniciado sesión actualmente y el título es increíblemente sencillo.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="9f6d0-503">Volver a la página\_controlador de eventos de carga en Default.aspx, donde en el paso 4 que escribimos código para recuperar el vale de autenticación de formulario y analizar la propiedad UserData con el fin de mostrar el nombre de la empresa y el título del usuario.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="9f6d0-504">Con los objetos CustomPrincipal y CustomIdentity en uso ahora, no hay ninguna necesidad para analizar los valores de propiedad de UserData del vale.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="9f6d0-505">En su lugar, sólo tiene que obtener una referencia al objeto CustomIdentity y utilizar sus propiedades CompanyName y el título:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample12.vb)]

## <a name="summary"></a><span data-ttu-id="9f6d0-506">Resumen</span><span class="sxs-lookup"><span data-stu-id="9f6d0-506">Summary</span></span>

<span data-ttu-id="9f6d0-507">En este tutorial hemos visto cómo personalizar la configuración del sistema de autenticación de formularios a través de Web.config. Hemos visto cómo se controla la caducidad del vale de autenticación y cómo se usan las medidas de seguridad de cifrado y validación para proteger el vale de inspección y modificación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="9f6d0-508">Por último, le explicamos cómo utilizar la propiedad UserData del vale de autenticación para almacenar información adicional del usuario en el propio vale y cómo usar objetos principal e identity personalizados para exponer esta información de un modo más sencillo para los desarrolladores.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="9f6d0-509">En este tutorial concluye nuestro examen de autenticación de formularios en ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="9f6d0-510">El siguiente tutorial inicia nuestro viaje en el marco de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="9f6d0-511">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="9f6d0-512">Información adicional</span><span class="sxs-lookup"><span data-stu-id="9f6d0-512">Further Reading</span></span>

<span data-ttu-id="9f6d0-513">Para obtener más información sobre los temas tratados en este tutorial, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="9f6d0-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="9f6d0-514">Si examinamos la autenticación de formularios</span><span class="sxs-lookup"><span data-stu-id="9f6d0-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="9f6d0-515">Se explica: Autenticación de formularios en ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="9f6d0-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="9f6d0-516">Cómo: Proteger la autenticación de formularios en ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="9f6d0-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="9f6d0-517">[Professional ASP.NET 2.0 seguridad, la pertenencia y administración de roles](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="9f6d0-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="9f6d0-518">Protección de los controles de inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="9f6d0-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="9f6d0-519">El &lt;autenticación&gt; elemento</span><span class="sxs-lookup"><span data-stu-id="9f6d0-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="9f6d0-520">El &lt;formularios&gt; (elemento) para &lt;autenticación&gt;</span><span class="sxs-lookup"><span data-stu-id="9f6d0-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="9f6d0-521">El &lt;machineKey&gt; elemento</span><span class="sxs-lookup"><span data-stu-id="9f6d0-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="9f6d0-522">Descripción del vale de autenticación de formularios y cookies</span><span class="sxs-lookup"><span data-stu-id="9f6d0-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="9f6d0-523">En los temas contenidos en este Tutorial en vídeo</span><span class="sxs-lookup"><span data-stu-id="9f6d0-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="9f6d0-524">Cómo cambiar las propiedades de autenticación de formularios</span><span class="sxs-lookup"><span data-stu-id="9f6d0-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="9f6d0-525">Cómo se instale y Use la autenticación sin cookies en una aplicación ASP.NET</span><span class="sxs-lookup"><span data-stu-id="9f6d0-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="9f6d0-526">Reubicación del inicio de sesión de los formularios ASP</span><span class="sxs-lookup"><span data-stu-id="9f6d0-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="9f6d0-527">Configuración de claves personalizadas de inicio de sesión de los formularios</span><span class="sxs-lookup"><span data-stu-id="9f6d0-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="9f6d0-528">Agregar datos personalizados al método de autenticación</span><span class="sxs-lookup"><span data-stu-id="9f6d0-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="9f6d0-529">Usar objetos de entidad de seguridad personalizados</span><span class="sxs-lookup"><span data-stu-id="9f6d0-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="9f6d0-530">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="9f6d0-530">About the Author</span></span>

<span data-ttu-id="9f6d0-531">Scott Mitchell, autor de varios libros sobre ASP/ASP.NET y fundador de 4GuysFromRolla.com, ha estado trabajando con tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9f6d0-532">Scott trabaja como consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9f6d0-533">Su último libro es *[SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="9f6d0-534">Puede ponerse en contacto Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) o a través de su blog en [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="9f6d0-535">Agradecimientos especiales a</span><span class="sxs-lookup"><span data-stu-id="9f6d0-535">Special Thanks To</span></span>

<span data-ttu-id="9f6d0-536">Esta serie de tutoriales ha sido revisada por muchos revisores útiles.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9f6d0-537">Revisor de clientes potencial para este tutorial era Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="9f6d0-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="9f6d0-538">¿Está interesado en leer mi próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="9f6d0-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9f6d0-539">Si es así, envíeme una línea en [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="9f6d0-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="9f6d0-540">Anterior</span><span class="sxs-lookup"><span data-stu-id="9f6d0-540">Previous</span></span>](an-overview-of-forms-authentication-vb.md)
