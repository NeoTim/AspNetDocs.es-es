---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Desconectar aplicaciones Web con Web implementarán | Microsoft Docs
author: jrjlee
description: Este tema describe cómo tomar una aplicación web sin conexión para la duración de una implementación automatizada mediante el Administrador de implementaciones de Web de Internet Information Services (IIS)...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: ba54454bcb6f5e4ceb269b128a6b72a4b75f64be
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131410"
---
# <a name="taking-web-applications-offline-with-web-deploy"></a><span data-ttu-id="ddc08-103">Desconectar aplicaciones web con Web Deploy</span><span class="sxs-lookup"><span data-stu-id="ddc08-103">Taking Web Applications Offline with Web Deploy</span></span>

<span data-ttu-id="ddc08-104">por [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="ddc08-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="ddc08-105">Descargar PDF</span><span class="sxs-lookup"><span data-stu-id="ddc08-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="ddc08-106">Este tema describe cómo tomar una aplicación web sin conexión para la duración de una implementación automatizada mediante la herramienta de implementación Web de Internet Information Services (IIS) (Web Deploy).</span><span class="sxs-lookup"><span data-stu-id="ddc08-106">This topic describes how to take a web application offline for the duration of an automated deployment using the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="ddc08-107">Los usuarios que vaya a la aplicación web se redirigen a un *aplicación\_offline.htm* archivo hasta que se complete la implementación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-107">Users who browse to the web application are redirected to an *App\_offline.htm* file until the deployment is complete.</span></span>

<span data-ttu-id="ddc08-108">En este tema forma parte de una serie de tutoriales que se basa en los requisitos de implementación empresarial de una compañía ficticia denominada Fabrikam, Inc. Esta serie de tutoriales usa una solución de ejemplo&#x2014;el [solución Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;para representar una aplicación web con un nivel realista de complejidad, incluida una aplicación ASP.NET MVC 3, una comunicación de Windows Servicio Foundation (WCF) y un proyecto de base de datos.</span><span class="sxs-lookup"><span data-stu-id="ddc08-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="ddc08-109">El método de implementación en el corazón de estos tutoriales se basa en el enfoque de archivo de proyecto de división descrito en [descripción del archivo de proyecto](../web-deployment-in-the-enterprise/understanding-the-project-file.md), en que el proceso de compilación se controla mediante dos archivos de proyecto&#x2014;uno que contenga instrucciones que se aplican a todos los entornos de destino y que contiene la configuración de compilación e implementación específica del entorno de compilación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="ddc08-110">En tiempo de compilación, se combina el archivo de proyecto específicos del entorno en el archivo de proyecto independiente del entorno para formar un conjunto completo de las instrucciones de compilación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="ddc08-111">Información general de tarea</span><span class="sxs-lookup"><span data-stu-id="ddc08-111">Task Overview</span></span>

<span data-ttu-id="ddc08-112">En muchos escenarios, desea desconectar una aplicación web mientras realiza cambios en los componentes relacionados, como las bases de datos o servicios web.</span><span class="sxs-lookup"><span data-stu-id="ddc08-112">In a lot of scenarios, you'll want to take a web application offline while you make changes to related components, like databases or web services.</span></span> <span data-ttu-id="ddc08-113">Normalmente, en IIS y ASP.NET, para ello, coloque un archivo denominado *aplicación\_offline.htm* en la carpeta raíz de la aplicación web o sitio Web de IIS.</span><span class="sxs-lookup"><span data-stu-id="ddc08-113">Typically, in IIS and ASP.NET, you accomplish this by placing a file named *App\_offline.htm* in the root folder of the IIS website or web application.</span></span> <span data-ttu-id="ddc08-114">El *aplicación\_offline.htm* archivo es un archivo HTML estándar y normalmente contendrá un simple mensaje advierte al usuario que el sitio está disponible temporalmente debido a mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="ddc08-114">The *App\_offline.htm* file is a standard HTML file and will usually contain a simple message advising the user that the site is temporarily unavailable due to maintenance.</span></span> <span data-ttu-id="ddc08-115">Mientras el *aplicación\_offline.htm* el archivo existe en la carpeta raíz del sitio Web, IIS le redireccionará automáticamente las solicitudes en el archivo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-115">While the *App\_offline.htm* file exists in the root folder of the website, IIS will automatically redirect any requests to the file.</span></span> <span data-ttu-id="ddc08-116">Cuando haya terminado de realizar actualizaciones, quita el *aplicación\_offline.htm* reanuda el archivo y el sitio Web que atienden solicitudes como de costumbre.</span><span class="sxs-lookup"><span data-stu-id="ddc08-116">When you've finished making updates, you remove the *App\_offline.htm* file and the website resumes serving requests as usual.</span></span>

<span data-ttu-id="ddc08-117">Al usar Web Deploy para realizar implementaciones automatizadas o paso a paso para un entorno de destino, es posible que desea incorporar agregando y quitando la *aplicación\_offline.htm* archivo en el proceso de implementación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-117">When you use Web Deploy to perform automated or single-step deployments to a target environment, you may want to incorporate adding and removing the *App\_offline.htm* file into your deployment process.</span></span> <span data-ttu-id="ddc08-118">Para ello, necesita completar estas tareas de alto nivel:</span><span class="sxs-lookup"><span data-stu-id="ddc08-118">To do this, you'll need to complete these high-level tasks:</span></span>

- <span data-ttu-id="ddc08-119">En el archivo de proyecto de Microsoft Build Engine (MSBuild) que usa para controlar el proceso de implementación, cree un destino de MSBuild que copia un *aplicación\_offline.htm* archivo al servidor de destino antes de las tareas de implementación comenzar.</span><span class="sxs-lookup"><span data-stu-id="ddc08-119">In the Microsoft Build Engine (MSBuild) project file that you use to control the deployment process, create an MSBuild target that copies an *App\_offline.htm* file to the destination server before any deployment tasks begin.</span></span>
- <span data-ttu-id="ddc08-120">Agregue otro destino de MSBuild que quita el *aplicación\_offline.htm* archivo desde el servidor de destino cuando se completan todas las tareas de implementación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-120">Add another MSBuild target that removes the *App\_offline.htm* file from the destination server when all deployment tasks are complete.</span></span>
- <span data-ttu-id="ddc08-121">En el proyecto de aplicación web, cree un *. wpp.targets* archivo que se asegura de que un *aplicación\_offline.htm* archivo se agrega al paquete de implementación cuando se invoca Web Deploy.</span><span class="sxs-lookup"><span data-stu-id="ddc08-121">In the web application project, create a *.wpp.targets* file that ensures that an *App\_offline.htm* file is added to the deployment package when Web Deploy is invoked.</span></span>

<span data-ttu-id="ddc08-122">En este tema le mostrará cómo realizar estos procedimientos.</span><span class="sxs-lookup"><span data-stu-id="ddc08-122">This topic will show you how to perform these procedures.</span></span> <span data-ttu-id="ddc08-123">Las tareas y los tutoriales en este tema se suponen que ya ha creado una solución que contenga al menos un proyecto de aplicación web, y que utilice un archivo de proyecto personalizadas para controlar el proceso de implementación como se describe en [implementación Web en el Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span><span class="sxs-lookup"><span data-stu-id="ddc08-123">The tasks and walkthroughs in this topic assume that you've already created a solution that contains at least one web application project, and that you use a custom project file to control the deployment process as described in [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="ddc08-124">Como alternativa, puede usar el [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) solución para seguir los ejemplos en el tema de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-124">Alternatively, you can use the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution to follow the examples in the topic.</span></span>

## <a name="adding-an-appoffline-file-to-a-web-application-project"></a><span data-ttu-id="ddc08-125">Agregar una aplicación\_archivos sin conexión a un proyecto de aplicación Web</span><span class="sxs-lookup"><span data-stu-id="ddc08-125">Adding an App\_Offline File to a Web Application Project</span></span>

<span data-ttu-id="ddc08-126">La primera tarea es preciso completar consiste en Agregar un *aplicación\_sin conexión* archivo al proyecto de aplicación web:</span><span class="sxs-lookup"><span data-stu-id="ddc08-126">The first task you need to complete is to add an *App\_offline* file to your web application project:</span></span>

- <span data-ttu-id="ddc08-127">Para evitar que el archivo interfiera con el proceso de desarrollo (no desea la aplicación esté permanentemente sin conexión), debe llamarlo algo distinto *aplicación\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="ddc08-127">To prevent the file from interfering with the development process (you don't want your application to be permanently offline), you should call it something other than *App\_offline.htm*.</span></span> <span data-ttu-id="ddc08-128">Por ejemplo, podría denominar el archivo *aplicación\_sin conexión template.htm*.</span><span class="sxs-lookup"><span data-stu-id="ddc08-128">For example, you could name the file *App\_offline-template.htm*.</span></span>
- <span data-ttu-id="ddc08-129">Para evitar que el archivo que se implementa como-es, debe establecer la acción de compilación en **ninguno**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-129">To prevent the file from being deployed as-is, you should set the build action to **None**.</span></span>

<span data-ttu-id="ddc08-130">**Para agregar una aplicación\_archivos sin conexión a un proyecto de aplicación web**</span><span class="sxs-lookup"><span data-stu-id="ddc08-130">**To add an App\_offline file to a web application project**</span></span>

1. <span data-ttu-id="ddc08-131">Abra la solución en Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="ddc08-131">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="ddc08-132">En el **el Explorador de soluciones** ventana, haga clic en el proyecto de aplicación web, elija **agregar**y, a continuación, haga clic en **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-132">In the **Solution Explorer** window, right-click your web application project, point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="ddc08-133">En el **Agregar nuevo elemento** cuadro de diálogo, seleccione **página HTML**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-133">In the **Add New Item** dialog box, select **HTML Page**.</span></span>
4. <span data-ttu-id="ddc08-134">En el **nombre** , escriba **aplicación\_sin conexión template.htm**y, a continuación, haga clic en **agregar**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-134">In the **Name** box, type **App\_offline-template.htm**, and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. <span data-ttu-id="ddc08-135">Agregar algún HTML simple para informar a los usuarios que la aplicación no está disponible y, a continuación, guarde el archivo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-135">Add some simple HTML to inform users that the application is unavailable, and then save the file.</span></span> <span data-ttu-id="ddc08-136">No se incluyen las etiquetas de servidor (por ejemplo, las etiquetas que tienen el prefijo "asp:").</span><span class="sxs-lookup"><span data-stu-id="ddc08-136">Do not include any server-side tags (for example, any tags that are prefixed with "asp:").</span></span> 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. <span data-ttu-id="ddc08-137">En el **el Explorador de soluciones** , haga clic en el archivo nuevo y, a continuación, haga clic en **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-137">In the **Solution Explorer** window, right-click the new file, and then click **Properties**.</span></span>
7. <span data-ttu-id="ddc08-138">En el **propiedades** ventana, en el **acción de compilación** fila, seleccione **ninguno**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-138">In the **Properties** window, in the **Build Action** row, select **None**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-appoffline-file"></a><span data-ttu-id="ddc08-139">Implementación y la eliminación de una aplicación\_archivos sin conexión</span><span class="sxs-lookup"><span data-stu-id="ddc08-139">Deploying and Deleting an App\_Offline File</span></span>

<span data-ttu-id="ddc08-140">El paso siguiente es modificar la lógica de implementación para copiar el archivo en el servidor de destino al principio del proceso de implementación y quitarlo al final.</span><span class="sxs-lookup"><span data-stu-id="ddc08-140">The next step is to modify your deployment logic to copy the file to the destination server at the start of the deployment process and remove it at the end.</span></span>

> [!NOTE]
> <span data-ttu-id="ddc08-141">El siguiente procedimiento se da por supuesto que está usando un archivo de proyecto de MSBuild personalizado para controlar el proceso de implementación, como se describe en [descripción del archivo de proyecto](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="ddc08-141">The next procedure assumes that you're using a custom MSBuild project file to control your deployment process, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span> <span data-ttu-id="ddc08-142">Si va a implementar directamente desde Visual Studio, deberá usar un enfoque diferente.</span><span class="sxs-lookup"><span data-stu-id="ddc08-142">If you're deploying direct from Visual Studio, you'll need to use a different approach.</span></span> <span data-ttu-id="ddc08-143">Sayed Ibrahim Hashimi describe uno de estos métodos en [cómo tomar su aplicación sin conexión durante la publicación en Web](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span><span class="sxs-lookup"><span data-stu-id="ddc08-143">Sayed Ibrahim Hashimi describes one such approach in [How to Take Your Web App Offline During Publishing](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span></span>

<span data-ttu-id="ddc08-144">Para implementar un *aplicación\_sin conexión* archivo a un sitio Web IIS de destino, deberá invocar MSDeploy.exe mediante el [Web Deploy **contentPath** proveedor](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span><span class="sxs-lookup"><span data-stu-id="ddc08-144">To deploy an *App\_offline* file to a destination IIS website, you need to invoke MSDeploy.exe using the [Web Deploy **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span></span> <span data-ttu-id="ddc08-145">El **contentPath** proveedor es compatible con las rutas de acceso del directorio físico y rutas de aplicación o sitio Web IIS, lo que facilita la elección ideal para la sincronización de un archivo de una carpeta de proyecto de Visual Studio y una aplicación web IIS.</span><span class="sxs-lookup"><span data-stu-id="ddc08-145">The **contentPath** provider supports both physical directory paths and IIS website or application paths, which makes it the ideal choice for synchronizing a file between a Visual Studio project folder and an IIS web application.</span></span> <span data-ttu-id="ddc08-146">Para implementar el archivo, el comando MSDeploy debería parecerse a esto:</span><span class="sxs-lookup"><span data-stu-id="ddc08-146">To deploy the file, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]

<span data-ttu-id="ddc08-147">Para quitar el archivo desde el sitio de destino al final del proceso de implementación, el comando MSDeploy debería parecerse a esto:</span><span class="sxs-lookup"><span data-stu-id="ddc08-147">To remove the file from the destination site at the end of the deployment process, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]

<span data-ttu-id="ddc08-148">Para automatizar estos comandos como parte de un proceso de compilación e implementación, deberá integrarlos en el archivo de proyecto de MSBuild personalizado.</span><span class="sxs-lookup"><span data-stu-id="ddc08-148">To automate these commands as part of a build and deployment process, you need to integrate them into your custom MSBuild project file.</span></span> <span data-ttu-id="ddc08-149">El procedimiento siguiente describe cómo hacerlo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-149">The next procedure describes how to do this.</span></span>

<span data-ttu-id="ddc08-150">**Para implementar y eliminar una aplicación\_archivos sin conexión**</span><span class="sxs-lookup"><span data-stu-id="ddc08-150">**To deploy and delete an App\_offline file**</span></span>

1. <span data-ttu-id="ddc08-151">En Visual Studio 2010, abra el archivo de proyecto de MSBuild que controla el proceso de implementación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-151">In Visual Studio 2010, open the MSBuild project file that controls your deployment process.</span></span> <span data-ttu-id="ddc08-152">En el [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) solución de ejemplo, se trata la *Publish.proj* archivo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-152">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, this is the *Publish.proj* file.</span></span>
2. <span data-ttu-id="ddc08-153">En la raíz **proyecto** elemento, cree un nuevo **PropertyGroup** elemento para almacenar las variables para el *aplicación\_sin conexión* implementación:</span><span class="sxs-lookup"><span data-stu-id="ddc08-153">In the root **Project** element, create a new **PropertyGroup** element to store variables for the *App\_offline* deployment:</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. <span data-ttu-id="ddc08-154">El **SourceRoot** propiedad está definida en otro lugar en el *Publish.proj* archivo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-154">The **SourceRoot** property is defined elsewhere in the *Publish.proj* file.</span></span> <span data-ttu-id="ddc08-155">Indica la ubicación de la carpeta raíz para el contenido de origen en relación con la ruta de acceso actual&#x2014;en otras palabras, con respecto a la ubicación de la *Publish.proj* archivo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-155">It indicates the location of the root folder for the source content relative to the current path&#x2014;in other words, relative to the location of the *Publish.proj* file.</span></span>
4. <span data-ttu-id="ddc08-156">El **contentPath** proveedor no aceptará las rutas de acceso relativa de archivo, por lo que necesita obtener una ruta de acceso absoluta al archivo de origen antes de implementarla.</span><span class="sxs-lookup"><span data-stu-id="ddc08-156">The **contentPath** provider will not accept relative file paths, so you need to get an absolute path to your source file before you can deploy it.</span></span> <span data-ttu-id="ddc08-157">Puede usar el [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) tarea para hacer esto.</span><span class="sxs-lookup"><span data-stu-id="ddc08-157">You can use the [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) task to do this.</span></span>
5. <span data-ttu-id="ddc08-158">Agregue un nuevo **destino** elemento denominado **GetAppOfflineAbsolutePath**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-158">Add a new **Target** element named **GetAppOfflineAbsolutePath**.</span></span> <span data-ttu-id="ddc08-159">Dentro de este destino, utilice el **ConvertToAbsolutePath** tarea para obtener una ruta de acceso absoluta a la *aplicación\_sin conexión de la plantilla* archivo en la carpeta del proyecto.</span><span class="sxs-lookup"><span data-stu-id="ddc08-159">Within this target, use the **ConvertToAbsolutePath** task to get an absolute path to the *App\_offline-template* file in your project folder.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. <span data-ttu-id="ddc08-160">Este destino toma la ruta de acceso relativa a la *aplicación\_sin conexión plantilla* archivo en la carpeta del proyecto y lo guarda en una nueva propiedad como una ruta de acceso absoluta del archivo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-160">This target takes the relative path to the *App\_offline-template* file in your project folder and saves it to a new property as an absolute file path.</span></span> <span data-ttu-id="ddc08-161">El **BeforeTargets** atributo especifica que desea que este destino se ejecute antes de la **DeployAppOffline** destino, que se creará en el paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="ddc08-161">The **BeforeTargets** attribute specifies that you want this target to execute before the **DeployAppOffline** target, which you'll create in the next step.</span></span>
7. <span data-ttu-id="ddc08-162">Agregar un nuevo destino denominado **DeployAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-162">Add a new target named **DeployAppOffline**.</span></span> <span data-ttu-id="ddc08-163">Dentro de este destino, invocar el comando MSDeploy.exe que implementa su *aplicación\_sin conexión* archivo al servidor web de destino.</span><span class="sxs-lookup"><span data-stu-id="ddc08-163">Within this target, invoke the MSDeploy.exe command that deploys your *App\_offline* file to the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. <span data-ttu-id="ddc08-164">En este ejemplo, el **ContactManagerIisPath** propiedad está definida en otro lugar en el archivo de proyecto.</span><span class="sxs-lookup"><span data-stu-id="ddc08-164">In this example, the **ContactManagerIisPath** property is defined elsewhere in the project file.</span></span> <span data-ttu-id="ddc08-165">Esto es simplemente una ruta de aplicación IIS, en el formulario *[nombre del sitio Web de IIS] / [nombre de la aplicación]*.</span><span class="sxs-lookup"><span data-stu-id="ddc08-165">This is simply an IIS application path, in the form *[IIS Website Name]/[Application Name]*.</span></span> <span data-ttu-id="ddc08-166">Incluye una condición de destino permite a los usuarios cambiar la *aplicación\_sin conexión* o desactivar la implementación cambiando un valor de propiedad o al proporcionar un parámetro de línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="ddc08-166">Including a condition in the target enables users to switch the *App\_offline* deployment on or off by changing a property value or providing a command-line parameter.</span></span>
9. <span data-ttu-id="ddc08-167">Agregar un nuevo destino denominado **DeleteAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-167">Add a new target named **DeleteAppOffline**.</span></span> <span data-ttu-id="ddc08-168">Dentro de este destino, invocar el comando MSDeploy.exe que quita su *aplicación\_sin conexión* archivo desde el servidor web de destino.</span><span class="sxs-lookup"><span data-stu-id="ddc08-168">Within this target, invoke the MSDeploy.exe command that removes your *App\_offline* file from the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. <span data-ttu-id="ddc08-169">La tarea final consiste en invocar estos nuevos destinos en los lugares adecuados durante la ejecución del archivo del proyecto.</span><span class="sxs-lookup"><span data-stu-id="ddc08-169">The final task is to invoke these new targets at appropriate points during the execution of your project file.</span></span> <span data-ttu-id="ddc08-170">Puede hacerlo de varias maneras.</span><span class="sxs-lookup"><span data-stu-id="ddc08-170">You can do this in various ways.</span></span> <span data-ttu-id="ddc08-171">Por ejemplo, en el *Publish.proj* archivo, el **FullPublishDependsOn** propiedad especifica una lista de destinos que se deben ejecutar en pedido cuando la **FullPublish** predeterminada se invoca al destino.</span><span class="sxs-lookup"><span data-stu-id="ddc08-171">For example, in the *Publish.proj* file, the **FullPublishDependsOn** property specifies a list of targets that must be executed in order when the **FullPublish** default target is invoked.</span></span>
11. <span data-ttu-id="ddc08-172">Modificar el archivo de proyecto de MSBuild para invocar el **DeployAppOffline** y **DeleteAppOffline** destinos en los lugares adecuados del proceso de publicación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-172">Modify your MSBuild project file to invoke the **DeployAppOffline** and **DeleteAppOffline** targets at appropriate points in the publishing process.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

<span data-ttu-id="ddc08-173">Al ejecutar el archivo de proyecto de MSBuild personalizado, el *aplicación\_sin conexión* archivo se implementará en el servidor inmediatamente después de una compilación correcta.</span><span class="sxs-lookup"><span data-stu-id="ddc08-173">When you run your custom MSBuild project file, the *App\_offline* file will be deployed to the server immediately after a successful build.</span></span> <span data-ttu-id="ddc08-174">A continuación, se eliminará del servidor una vez que finalizan todas las tareas de implementación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-174">It will then be deleted from the server once all the deployment tasks are complete.</span></span>

## <a name="adding-an-appoffline-file-to-deployment-packages"></a><span data-ttu-id="ddc08-175">Agregar una aplicación\_archivos sin conexión para los paquetes de implementación</span><span class="sxs-lookup"><span data-stu-id="ddc08-175">Adding an App\_Offline File to Deployment Packages</span></span>

<span data-ttu-id="ddc08-176">Según cómo configure la implementación, cualquier contenido existente en el destino de IIS de aplicaciones web&#x2014;como el *aplicación\_offline.htm* archivo&#x2014;pueden eliminarse automáticamente cuando se implementa un sitio web paquete para el destino.</span><span class="sxs-lookup"><span data-stu-id="ddc08-176">Depending on how you configure your deployment, any existing content at the destination IIS web application&#x2014;like the *App\_offline.htm* file&#x2014;may be deleted automatically when you deploy a web package to the destination.</span></span> <span data-ttu-id="ddc08-177">Para asegurarse de que el *aplicación\_offline.htm* archivo permanece vigente durante la implementación, deberá incluir el archivo dentro del propio paquete de implementación web además de implementar el archivo directamente en el inicio de el proceso de implementación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-177">To ensure that the *App\_offline.htm* file remains in place for the duration of the deployment, you need to include the file within the web deployment package itself in addition to deploying the file directly at the start of the deployment process.</span></span>

- <span data-ttu-id="ddc08-178">Si ha seguido las tareas anteriores de este tema, habrá agregado el *aplicación\_offline.htm* archivo al proyecto de aplicación web en un nombre de archivo diferente (hemos usado *aplicación\_ sin conexión template.htm*) y habrá establecido la acción de compilación como **ninguno**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-178">If you've followed the previous tasks in this topic, you'll have added the *App\_offline.htm* file to your web application project under a different filename (we used *App\_offline-template.htm*) and you'll have set the build action to **None**.</span></span> <span data-ttu-id="ddc08-179">Estos cambios son necesarios para evitar que el archivo de interferir con el desarrollo y depuración.</span><span class="sxs-lookup"><span data-stu-id="ddc08-179">These changes are necessary to prevent the file from interfering with development and debugging.</span></span> <span data-ttu-id="ddc08-180">Como resultado, debe personalizar el proceso de empaquetado para asegurarse de que el *aplicación\_offline.htm* archivo está incluido en el paquete de implementación web.</span><span class="sxs-lookup"><span data-stu-id="ddc08-180">As a result, you need to customize the packaging process to ensure that the *App\_offline.htm* file is included in the web deployment package.</span></span>

<span data-ttu-id="ddc08-181">La canalización de publicación de Web (WPP) usa una lista de elementos denominada **FilesForPackagingFromProject** para generar una lista de archivos que deben incluirse en el paquete de implementación web.</span><span class="sxs-lookup"><span data-stu-id="ddc08-181">The Web Publishing Pipeline (WPP) uses an item list named **FilesForPackagingFromProject** to build a list of files that should be included in the web deployment package.</span></span> <span data-ttu-id="ddc08-182">Puede personalizar el contenido de los paquetes de web agregando sus propios elementos a esta lista.</span><span class="sxs-lookup"><span data-stu-id="ddc08-182">You can customize the contents of your web packages by adding your own items to this list.</span></span> <span data-ttu-id="ddc08-183">Para ello, deberá completar estos pasos generales:</span><span class="sxs-lookup"><span data-stu-id="ddc08-183">To do this, you need to complete these high-level steps:</span></span>

1. <span data-ttu-id="ddc08-184">Cree un archivo de proyecto personalizado denominado *.wpp.targets [nombre de proyecto]* en la misma carpeta que el archivo de proyecto.</span><span class="sxs-lookup"><span data-stu-id="ddc08-184">Create a custom project file named *[project name].wpp.targets* in the same folder as your project file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="ddc08-185">El *. wpp.targets* archivo debe ir en la misma carpeta que el archivo de proyecto de aplicación web&#x2014;por ejemplo, *ContactManager.Mvc.csproj*&#x2014;en lugar de en la misma carpeta que cualquier personalizado archivos de proyecto que se usan para controlar el proceso de compilación e implementación.</span><span class="sxs-lookup"><span data-stu-id="ddc08-185">The *.wpp.targets* file needs to go in the same folder as your web application project file&#x2014;for example, *ContactManager.Mvc.csproj*&#x2014;rather than in the same folder as any custom project files you use to control the build and deployment process.</span></span>
2. <span data-ttu-id="ddc08-186">En el *. wpp.targets* , cree un nuevo destino de MSBuild que ejecuta *antes* el **CopyAllFilesToSingleFolderForPackage** destino.</span><span class="sxs-lookup"><span data-stu-id="ddc08-186">In the *.wpp.targets* file, create a new MSBuild target that executes *before* the **CopyAllFilesToSingleFolderForPackage** target.</span></span> <span data-ttu-id="ddc08-187">Éste es el objetivo WPP que genera una lista de aspectos que se deben incluir en el paquete.</span><span class="sxs-lookup"><span data-stu-id="ddc08-187">This is the WPP target that builds a list of things to include in the package.</span></span>
3. <span data-ttu-id="ddc08-188">En el nuevo destino, cree un **ItemGroup** elemento.</span><span class="sxs-lookup"><span data-stu-id="ddc08-188">In the new target, create an **ItemGroup** element.</span></span>
4. <span data-ttu-id="ddc08-189">En el **ItemGroup** elemento, agregue un **FilesForPackagingFromProject** de elemento y especifique el *aplicación\_offline.htm* archivo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-189">In the **ItemGroup** element, add a **FilesForPackagingFromProject** item and specify the *App\_offline.htm* file.</span></span>

<span data-ttu-id="ddc08-190">El *. wpp.targets* archivo debe ser similar a esto:</span><span class="sxs-lookup"><span data-stu-id="ddc08-190">The *.wpp.targets* file should resemble this:</span></span>

[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]

<span data-ttu-id="ddc08-191">Estos son los puntos clave de interés en este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="ddc08-191">These are the key points of note in this example:</span></span>

- <span data-ttu-id="ddc08-192">El **BeforeTargets** inserciones de atributos de este destino en el WPP especificando que se debe ejecutar inmediatamente antes de la **CopyAllFilesToSingleFolderForPackage** destino.</span><span class="sxs-lookup"><span data-stu-id="ddc08-192">The **BeforeTargets** attribute inserts this target into the WPP by specifying that it should be executed immediately before the **CopyAllFilesToSingleFolderForPackage** target.</span></span>
- <span data-ttu-id="ddc08-193">El **FilesForPackagingFromProject** elemento utiliza la **DestinationRelativePath** valor de metadatos para cambiar el nombre del archivo de *aplicación\_sin conexión template.htm* para *aplicación\_offline.htm* cuando se agrega a la lista.</span><span class="sxs-lookup"><span data-stu-id="ddc08-193">The **FilesForPackagingFromProject** item uses the **DestinationRelativePath** metadata value to rename the file from *App\_offline-template.htm* to *App\_offline.htm* as it's added to the list.</span></span>

<span data-ttu-id="ddc08-194">El procedimiento siguiente muestra cómo agregar esto *. wpp.targets* archivo a un proyecto de aplicación web.</span><span class="sxs-lookup"><span data-stu-id="ddc08-194">The next procedure shows you how to add this *.wpp.targets* file to a web application project.</span></span>

<span data-ttu-id="ddc08-195">**Para agregar un. archivos de destino.WPP en un paquete de implementación web**</span><span class="sxs-lookup"><span data-stu-id="ddc08-195">**To add a .wpp.targets file to a web deployment package**</span></span>

1. <span data-ttu-id="ddc08-196">Abra la solución en Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="ddc08-196">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="ddc08-197">En el **el Explorador de soluciones** ventana, haga clic en el nodo del proyecto de aplicación web (por ejemplo, **ContactManager.Mvc**), seleccione **agregar**y, a continuación, haga clic en **Nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-197">In the **Solution Explorer** window, right-click your web application project node (for example, **ContactManager.Mvc**), point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="ddc08-198">En el **Agregar nuevo elemento** cuadro de diálogo, seleccione el **archivo XML** plantilla.</span><span class="sxs-lookup"><span data-stu-id="ddc08-198">In the **Add New Item** dialog box, select the **XML File** template.</span></span>
4. <span data-ttu-id="ddc08-199">En el **nombre** , escriba \*[nombre de proyecto] \***.wpp.targets** (por ejemplo, **ContactManager.Mvc.wpp.targets**) y, a continuación, haga clic en **agregar**.</span><span class="sxs-lookup"><span data-stu-id="ddc08-199">In the **Name** box, type *[project name]\*\*\*.wpp.targets*\* (for example, **ContactManager.Mvc.wpp.targets**), and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > <span data-ttu-id="ddc08-200">Si agrega un nuevo elemento en el nodo raíz de un proyecto, se crea el archivo en la misma carpeta que el archivo de proyecto.</span><span class="sxs-lookup"><span data-stu-id="ddc08-200">If you add a new item to the root node of a project, the file is created in the same folder as the project file.</span></span> <span data-ttu-id="ddc08-201">Puede comprobarlo abriendo la carpeta en el Explorador de Windows.</span><span class="sxs-lookup"><span data-stu-id="ddc08-201">You can verify this by opening the folder in Windows Explorer.</span></span>
5. <span data-ttu-id="ddc08-202">En el archivo, agregue el marcado de MSBuild que se ha descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="ddc08-202">In the file, add the MSBuild markup described previously.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. <span data-ttu-id="ddc08-203">Guarde y cierre el *.wpp.targets [nombre de proyecto]* archivo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-203">Save and close the *[project name].wpp.targets* file.</span></span>

<span data-ttu-id="ddc08-204">La próxima vez que creación y empaquetado el proyecto de aplicación web, el WPP detectará automáticamente el *. wpp.targets* archivo.</span><span class="sxs-lookup"><span data-stu-id="ddc08-204">The next time you build and package your web application project, the WPP will automatically detect the *.wpp.targets* file.</span></span> <span data-ttu-id="ddc08-205">El *aplicación\_sin conexión template.htm* archivo se incluirá en el paquete de implementación web resultante como *aplicación\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="ddc08-205">The *App\_offline-template.htm* file will be included in the resulting web deployment package as *App\_offline.htm*.</span></span>

> [!NOTE]
> <span data-ttu-id="ddc08-206">Si se produce un error en la implementación, el *aplicación\_offline.htm* archivo seguirá estando en su lugar y la aplicación permanecerá sin conexión.</span><span class="sxs-lookup"><span data-stu-id="ddc08-206">If your deployment fails, the *App\_offline.htm* file will remain in place and your application will remain offline.</span></span> <span data-ttu-id="ddc08-207">Esto suele ser el comportamiento deseado.</span><span class="sxs-lookup"><span data-stu-id="ddc08-207">This is typically the desired behavior.</span></span> <span data-ttu-id="ddc08-208">Para conectar la aplicación en línea, puede eliminar el *aplicación\_offline.htm* archivo desde el servidor web.</span><span class="sxs-lookup"><span data-stu-id="ddc08-208">To bring your application back online, you can delete the *App\_offline.htm* file from your web server.</span></span> <span data-ttu-id="ddc08-209">Como alternativa, si se corrija los errores y ejecuta una implementación correcta, el *aplicación\_offline.htm* archivo se quitará.</span><span class="sxs-lookup"><span data-stu-id="ddc08-209">Alternatively, if you correct any errors and run a successful deployment, the *App\_offline.htm* file will be removed.</span></span>

## <a name="conclusion"></a><span data-ttu-id="ddc08-210">Conclusión</span><span class="sxs-lookup"><span data-stu-id="ddc08-210">Conclusion</span></span>

<span data-ttu-id="ddc08-211">En este tema se describe cómo tomar una aplicación web sin conexión para la duración de una implementación, mediante la publicación una *aplicación\_offline.htm* de archivos al servidor de destino al principio del proceso de implementación y eliminación en el fin.</span><span class="sxs-lookup"><span data-stu-id="ddc08-211">This topic described how to take a web application offline for the duration of a deployment, by publishing an *App\_offline.htm* file to the destination server at the start of the deployment process and removing it at the end.</span></span> <span data-ttu-id="ddc08-212">También se ha descrito cómo incluir un *aplicación\_offline.htm* archivo en un paquete de implementación web.</span><span class="sxs-lookup"><span data-stu-id="ddc08-212">It also covered how to include an *App\_offline.htm* file in a web deployment package.</span></span>

## <a name="further-reading"></a><span data-ttu-id="ddc08-213">Información adicional</span><span class="sxs-lookup"><span data-stu-id="ddc08-213">Further Reading</span></span>

<span data-ttu-id="ddc08-214">Para obtener más información sobre el empaquetado y el proceso de implementación, consulte [compilar y empaquetar proyectos de aplicación Web](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [configurar parámetros para la implementación del paquete Web](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), y [ Implementar paquetes Web](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span><span class="sxs-lookup"><span data-stu-id="ddc08-214">For more information on the packaging and deployment process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Configuring Parameters for Web Package Deployment](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), and [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="ddc08-215">Si publica sus aplicaciones web directamente desde Visual Studio, en lugar de con el enfoque de archivos de proyecto de MSBuild personalizado se describe en estos tutoriales, necesitará utilizar un enfoque ligeramente diferente para aprovechar la aplicación sin conexión durante la publicación proceso.</span><span class="sxs-lookup"><span data-stu-id="ddc08-215">If you publish your web applications directly from Visual Studio, rather than using the custom MSBuild project file approach described in these tutorials, you'll need to use a slightly different approach to take your application offline during the publishing process.</span></span> <span data-ttu-id="ddc08-216">Para obtener más información, consulte [cómo aprovechar la aplicación web sin conexión durante la publicación](https://go.microsoft.com/?linkid=9805135) (entrada de blog).</span><span class="sxs-lookup"><span data-stu-id="ddc08-216">For more information, see [How to take your web app offline during publishing](https://go.microsoft.com/?linkid=9805135) (blog post).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ddc08-217">[Anterior](excluding-files-and-folders-from-deployment.md)
> [Siguiente](running-windows-powershell-scripts-from-msbuild-project-files.md)</span><span class="sxs-lookup"><span data-stu-id="ddc08-217">[Previous](excluding-files-and-folders-from-deployment.md)
[Next](running-windows-powershell-scripts-from-msbuild-project-files.md)</span></span>
