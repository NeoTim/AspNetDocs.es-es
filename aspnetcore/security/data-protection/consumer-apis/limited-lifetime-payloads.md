---
title: Limite la duración de cargas protegidas en ASP.NET Core
author: rick-anderson
description: Aprenda a limitar la duración de una carga protegida mediante las API de protección de datos de ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
uid: security/data-protection/consumer-apis/limited-lifetime-payloads
ms.openlocfilehash: 8dc3b856ec67477ec8ae777749c9bf3107eb4eda
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/01/2019
ms.locfileid: "57039592"
---
# <a name="limit-the-lifetime-of-protected-payloads-in-aspnet-core"></a><span data-ttu-id="2529a-103">Limite la duración de cargas protegidas en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2529a-103">Limit the lifetime of protected payloads in ASP.NET Core</span></span>

<span data-ttu-id="2529a-104">Hay escenarios donde el desarrollador de aplicaciones desea crear una carga protegida que expira después de un período de tiempo establecido.</span><span class="sxs-lookup"><span data-stu-id="2529a-104">There are scenarios where the application developer wants to create a protected payload that expires after a set period of time.</span></span> <span data-ttu-id="2529a-105">Por ejemplo, la carga protegida podría representar un token de restablecimiento de contraseña que solo debe ser válido durante una hora.</span><span class="sxs-lookup"><span data-stu-id="2529a-105">For instance, the protected payload might represent a password reset token that should only be valid for one hour.</span></span> <span data-ttu-id="2529a-106">Es ciertamente posible para el desarrollador crear su propio formato de carga que contiene una fecha de expiración incrustados, y los desarrolladores avanzados que desee hacer esto de todos modos, pero para la mayoría de los desarrolladores administrar la caducidad de estas puede crecer tedioso.</span><span class="sxs-lookup"><span data-stu-id="2529a-106">It's certainly possible for the developer to create their own payload format that contains an embedded expiration date, and advanced developers may wish to do this anyway, but for the majority of developers managing these expirations can grow tedious.</span></span>

<span data-ttu-id="2529a-107">Para facilitar esta tarea para nuestra audiencia de desarrolladores, el paquete [Microsoft.AspNetCore.DataProtection.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contiene API de la utilidad para crear cargas que expiran automáticamente tras un período de tiempo establecido.</span><span class="sxs-lookup"><span data-stu-id="2529a-107">To make this easier for our developer audience, the package [Microsoft.AspNetCore.DataProtection.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contains utility APIs for creating payloads that automatically expire after a set period of time.</span></span> <span data-ttu-id="2529a-108">Estas API de bloqueo de la `ITimeLimitedDataProtector` tipo.</span><span class="sxs-lookup"><span data-stu-id="2529a-108">These APIs hang off of the `ITimeLimitedDataProtector` type.</span></span>

## <a name="api-usage"></a><span data-ttu-id="2529a-109">Uso de la API</span><span class="sxs-lookup"><span data-stu-id="2529a-109">API usage</span></span>

<span data-ttu-id="2529a-110">El `ITimeLimitedDataProtector` es la interfaz principal para proteger y desproteger las cargas de tiempo limitado / expiración automática.</span><span class="sxs-lookup"><span data-stu-id="2529a-110">The `ITimeLimitedDataProtector` interface is the core interface for protecting and unprotecting time-limited / self-expiring payloads.</span></span> <span data-ttu-id="2529a-111">Para crear una instancia de un `ITimeLimitedDataProtector`, primero tendrá que una instancia de normal [IDataProtector](xref:security/data-protection/consumer-apis/overview) construido con un propósito específico.</span><span class="sxs-lookup"><span data-stu-id="2529a-111">To create an instance of an `ITimeLimitedDataProtector`, you'll first need an instance of a regular [IDataProtector](xref:security/data-protection/consumer-apis/overview) constructed with a specific purpose.</span></span> <span data-ttu-id="2529a-112">Una vez el `IDataProtector` instancia está disponible, llame a la `IDataProtector.ToTimeLimitedDataProtector` método de extensión para obtener un protector de vuelta con capacidades integradas de expiración.</span><span class="sxs-lookup"><span data-stu-id="2529a-112">Once the `IDataProtector` instance is available, call the `IDataProtector.ToTimeLimitedDataProtector` extension method to get back a protector with built-in expiration capabilities.</span></span>

<span data-ttu-id="2529a-113">`ITimeLimitedDataProtector` expone los métodos de extensión y de superficie de API siguientes:</span><span class="sxs-lookup"><span data-stu-id="2529a-113">`ITimeLimitedDataProtector` exposes the following API surface and extension methods:</span></span>

* <span data-ttu-id="2529a-114">CreateProtector (fin de cadena): ITimeLimitedDataProtector - esta API es similar a la existente `IDataProtectionProvider.CreateProtector` en que se puede usar para crear [finalidad cadenas](xref:security/data-protection/consumer-apis/purpose-strings) desde un protector de tiempo limitado de raíz.</span><span class="sxs-lookup"><span data-stu-id="2529a-114">CreateProtector(string purpose) : ITimeLimitedDataProtector - This API is similar to the existing `IDataProtectionProvider.CreateProtector` in that it can be used to create [purpose chains](xref:security/data-protection/consumer-apis/purpose-strings) from a root time-limited protector.</span></span>

* <span data-ttu-id="2529a-115">Proteger (byte [] texto simple, expiración DateTimeOffset): byte]</span><span class="sxs-lookup"><span data-stu-id="2529a-115">Protect(byte[] plaintext, DateTimeOffset expiration) : byte[]</span></span>

* <span data-ttu-id="2529a-116">Proteger (texto simple de byte [], duración del intervalo de tiempo): byte]</span><span class="sxs-lookup"><span data-stu-id="2529a-116">Protect(byte[] plaintext, TimeSpan lifetime) : byte[]</span></span>

* <span data-ttu-id="2529a-117">Proteger (como texto simple de byte []): byte]</span><span class="sxs-lookup"><span data-stu-id="2529a-117">Protect(byte[] plaintext) : byte[]</span></span>

* <span data-ttu-id="2529a-118">Proteger (texto simple de cadena, expiración DateTimeOffset): cadena</span><span class="sxs-lookup"><span data-stu-id="2529a-118">Protect(string plaintext, DateTimeOffset expiration) : string</span></span>

* <span data-ttu-id="2529a-119">Proteger (texto simple de cadena, duración del intervalo de tiempo): cadena</span><span class="sxs-lookup"><span data-stu-id="2529a-119">Protect(string plaintext, TimeSpan lifetime) : string</span></span>

* <span data-ttu-id="2529a-120">Proteger (texto simple de cadena): cadena</span><span class="sxs-lookup"><span data-stu-id="2529a-120">Protect(string plaintext) : string</span></span>

<span data-ttu-id="2529a-121">Además de los principales `Protect` métodos que admiten solo el texto sin formato, hay nuevas sobrecargas que permiten especificar la fecha de expiración de la carga.</span><span class="sxs-lookup"><span data-stu-id="2529a-121">In addition to the core `Protect` methods which take only the plaintext, there are new overloads which allow specifying the payload's expiration date.</span></span> <span data-ttu-id="2529a-122">La fecha de expiración se puede especificar como una fecha absoluta (a través de un `DateTimeOffset`) o como una hora relativa (desde el sistema actual tiempo a través de un `TimeSpan`).</span><span class="sxs-lookup"><span data-stu-id="2529a-122">The expiration date can be specified as an absolute date (via a `DateTimeOffset`) or as a relative time (from the current system time, via a `TimeSpan`).</span></span> <span data-ttu-id="2529a-123">Si se llama a una sobrecarga que no tiene una fecha de expiración, la carga se supone que nunca expiran.</span><span class="sxs-lookup"><span data-stu-id="2529a-123">If an overload which doesn't take an expiration is called, the payload is assumed never to expire.</span></span>

* <span data-ttu-id="2529a-124">Desproteger (byte [] protectedData, out DateTimeOffset expiración): byte]</span><span class="sxs-lookup"><span data-stu-id="2529a-124">Unprotect(byte[] protectedData, out DateTimeOffset expiration) : byte[]</span></span>

* <span data-ttu-id="2529a-125">Desproteger (byte [] protectedData): byte]</span><span class="sxs-lookup"><span data-stu-id="2529a-125">Unprotect(byte[] protectedData) : byte[]</span></span>

* <span data-ttu-id="2529a-126">Desproteger (cadena protectedData, out DateTimeOffset expiración): cadena</span><span class="sxs-lookup"><span data-stu-id="2529a-126">Unprotect(string protectedData, out DateTimeOffset expiration) : string</span></span>

* <span data-ttu-id="2529a-127">Desproteger (cadena protectedData): cadena</span><span class="sxs-lookup"><span data-stu-id="2529a-127">Unprotect(string protectedData) : string</span></span>

<span data-ttu-id="2529a-128">El `Unprotect` métodos devuelven los datos originales sin protección.</span><span class="sxs-lookup"><span data-stu-id="2529a-128">The `Unprotect` methods return the original unprotected data.</span></span> <span data-ttu-id="2529a-129">Si aún no ha expirado la carga, la expiración absoluta se devuelve como un parámetro junto con los datos originales sin protección de salida opcionales.</span><span class="sxs-lookup"><span data-stu-id="2529a-129">If the payload hasn't yet expired, the absolute expiration is returned as an optional out parameter along with the original unprotected data.</span></span> <span data-ttu-id="2529a-130">Si la carga ha caducado, todas las sobrecargas del método Unprotect producirá CryptographicException.</span><span class="sxs-lookup"><span data-stu-id="2529a-130">If the payload is expired, all overloads of the Unprotect method will throw CryptographicException.</span></span>

>[!WARNING]
> <span data-ttu-id="2529a-131">No se recomienda utilizar estas API para proteger las cargas que requieren la persistencia a largo plazo o indefinida.</span><span class="sxs-lookup"><span data-stu-id="2529a-131">It's not advised to use these APIs to protect payloads which require long-term or indefinite persistence.</span></span> <span data-ttu-id="2529a-132">"¿Puedo permitirme para que las cargas protegidas que recuperarse después de un mes?"</span><span class="sxs-lookup"><span data-stu-id="2529a-132">"Can I afford for the protected payloads to be permanently unrecoverable after a month?"</span></span> <span data-ttu-id="2529a-133">puede actuar como una buena regla general; Si la respuesta es no a los desarrolladores a continuación, considere la API alternativas.</span><span class="sxs-lookup"><span data-stu-id="2529a-133">can serve as a good rule of thumb; if the answer is no then developers should consider alternative APIs.</span></span>

<span data-ttu-id="2529a-134">El ejemplo siguiente se usa el [las rutas de código que no sean de DI](xref:security/data-protection/configuration/non-di-scenarios) para instanciar el sistema de protección de datos.</span><span class="sxs-lookup"><span data-stu-id="2529a-134">The sample below uses the [non-DI code paths](xref:security/data-protection/configuration/non-di-scenarios) for instantiating the data protection system.</span></span> <span data-ttu-id="2529a-135">Para ejecutar este ejemplo, asegúrese de que primero ha agregado una referencia al paquete Microsoft.AspNetCore.DataProtection.Extensions.</span><span class="sxs-lookup"><span data-stu-id="2529a-135">To run this sample, ensure that you have first added a reference to the Microsoft.AspNetCore.DataProtection.Extensions package.</span></span>

[!code-csharp[](limited-lifetime-payloads/samples/limitedlifetimepayloads.cs)]
