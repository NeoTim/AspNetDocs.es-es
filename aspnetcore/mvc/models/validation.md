---
title: Validación de modelos en ASP.NET Core MVC
author: tdykstra
description: Obtenga información sobre la validación de modelos en ASP.NET Core MVC.
ms.author: riande
ms.custom: mvc
ms.date: 01/14/2019
uid: mvc/models/validation
ms.openlocfilehash: ca7ee54b8e6b6ae5091b0cb133e448ad9c04da8f
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/01/2019
ms.locfileid: "57049072"
---
# <a name="model-validation-in-aspnet-core-mvc"></a><span data-ttu-id="f5d81-103">Validación de modelos en ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="f5d81-103">Model validation in ASP.NET Core MVC</span></span>

<span data-ttu-id="f5d81-104">Por [Rachel Appel](https://github.com/rachelappel)</span><span class="sxs-lookup"><span data-stu-id="f5d81-104">By [Rachel Appel](https://github.com/rachelappel)</span></span>

## <a name="introduction-to-model-validation"></a><span data-ttu-id="f5d81-105">Introducción a la validación de modelos</span><span class="sxs-lookup"><span data-stu-id="f5d81-105">Introduction to model validation</span></span>

<span data-ttu-id="f5d81-106">Antes de que una aplicación almacene datos en una base de datos, dicha aplicación debe validar los datos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-106">Before an app stores data in a database, the app must validate the data.</span></span> <span data-ttu-id="f5d81-107">Es necesario comprobar los datos para detectar posibles amenazas de seguridad, verificar que su formato es adecuado para el tipo y el tamaño y que se ajustan a las reglas.</span><span class="sxs-lookup"><span data-stu-id="f5d81-107">Data must be checked for potential security threats, verified that it's appropriately formatted by type and size, and it must conform to your rules.</span></span> <span data-ttu-id="f5d81-108">La validación es necesaria aunque su implementación puede resultar tediosa y redundante.</span><span class="sxs-lookup"><span data-stu-id="f5d81-108">Validation is necessary although it can be redundant and tedious to implement.</span></span> <span data-ttu-id="f5d81-109">En MVC, la validación se produce en el cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="f5d81-109">In MVC, validation happens on both the client and server.</span></span>

<span data-ttu-id="f5d81-110">Por suerte, .NET ha abstraído la validación en atributos de validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-110">Fortunately, .NET has abstracted validation into validation attributes.</span></span> <span data-ttu-id="f5d81-111">Estos atributos contienen el código de validación, lo que reduce la cantidad de código que debe escribirse.</span><span class="sxs-lookup"><span data-stu-id="f5d81-111">These attributes contain validation code, thereby reducing the amount of code you must write.</span></span>

<span data-ttu-id="f5d81-112">En ASP.NET Core 2.2 y versiones posteriores, el tiempo de ejecución de ASP.NET Core cortocircuita (omite) la validación si puede determinar que un gráfico de modelos determinado no requiere la validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-112">In ASP.NET Core 2.2 and later, the ASP.NET Core runtime short-circuits (skips) validation if it can determine that a given model graph doesn't require validation.</span></span> <span data-ttu-id="f5d81-113">Omitir la validación puede proporcionar importantes mejoras de rendimiento al validar los modelos que no pueden tener o no tienen ningún validador asociado.</span><span class="sxs-lookup"><span data-stu-id="f5d81-113">Skipping validation can provide significant performance improvements when validating models that cannot or do not have any associated validators.</span></span> <span data-ttu-id="f5d81-114">La validación omitida incluye objetos como colecciones de primitivos (`byte[]`, `string[]`, `Dictionary<string, string>`, etc.) o gráficos de objetos complejos sin validadores.</span><span class="sxs-lookup"><span data-stu-id="f5d81-114">The skipped validation includes objects such as collections of primitives (`byte[]`, `string[]`, `Dictionary<string, string>`, etc.), or complex object graphs without any validators.</span></span>

<span data-ttu-id="f5d81-115">[Vea o descargue el ejemplo de GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span><span class="sxs-lookup"><span data-stu-id="f5d81-115">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span></span>

## <a name="validation-attributes"></a><span data-ttu-id="f5d81-116">Atributos de validación</span><span class="sxs-lookup"><span data-stu-id="f5d81-116">Validation Attributes</span></span>

<span data-ttu-id="f5d81-117">Los atributos de validación son una forma de configurar la validación del modelo, por lo que conceptualmente es similar a la validación en campos de tablas de base de datos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-117">Validation attributes are a way to configure model validation so it's similar conceptually to validation on fields in database tables.</span></span> <span data-ttu-id="f5d81-118">Esto incluye las restricciones, como la asignación de tipos de datos o los campos obligatorios.</span><span class="sxs-lookup"><span data-stu-id="f5d81-118">This includes constraints such as assigning data types or required fields.</span></span> <span data-ttu-id="f5d81-119">Entre otros tipos de validación se encuentran el de aplicar patrones a datos para aplicar reglas de negocio, como tarjetas de crédito, números de teléfono o direcciones de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="f5d81-119">Other types of validation include applying patterns to data to enforce business rules, such as a credit card, phone number, or email address.</span></span> <span data-ttu-id="f5d81-120">Con los atributos de validación, es mucho más sencillo aplicar estos requisitos y son más fáciles de usar.</span><span class="sxs-lookup"><span data-stu-id="f5d81-120">Validation attributes make enforcing these requirements much simpler and easier to use.</span></span>

<span data-ttu-id="f5d81-121">Los atributos de validación se especifican en el nivel de propiedad:</span><span class="sxs-lookup"><span data-stu-id="f5d81-121">Validation attributes are specified at the property level:</span></span> 

```csharp
[Required]
public string MyProperty { get; set; }
```

<span data-ttu-id="f5d81-122">Aquí mostramos un modelo `Movie` anotado desde una aplicación que almacena información sobre películas y programas de TV.</span><span class="sxs-lookup"><span data-stu-id="f5d81-122">Below is an annotated `Movie` model from an app that stores information about movies and TV shows.</span></span> <span data-ttu-id="f5d81-123">La mayoría de las propiedades son obligatorias y varias propiedades de cadena tienen requisitos de longitud.</span><span class="sxs-lookup"><span data-stu-id="f5d81-123">Most of the properties are required and several string properties have length requirements.</span></span> <span data-ttu-id="f5d81-124">Además, hay una restricción de rango numérico para la propiedad `Price` de 0 a 999,99 $, junto con un atributo de validación personalizado.</span><span class="sxs-lookup"><span data-stu-id="f5d81-124">Additionally, there's a numeric range restriction in place for the `Price` property from 0 to $999.99, along with a custom validation attribute.</span></span>

[!code-csharp[](validation/sample/Movie.cs?range=6-29)]

<span data-ttu-id="f5d81-125">Con solo leer el modelo se pueden detectar las reglas sobre los datos para esta aplicación, lo que facilita mantener el código.</span><span class="sxs-lookup"><span data-stu-id="f5d81-125">Simply reading through the model reveals the rules about data for this app, making it easier to maintain the code.</span></span> <span data-ttu-id="f5d81-126">Aquí tenemos varios atributos de validación integradas conocidos:</span><span class="sxs-lookup"><span data-stu-id="f5d81-126">Below are several popular built-in validation attributes:</span></span>

* <span data-ttu-id="f5d81-127">`[CreditCard]`: Valida que la propiedad tenga formato de tarjeta de crédito.</span><span class="sxs-lookup"><span data-stu-id="f5d81-127">`[CreditCard]`: Validates the property has a credit card format.</span></span>

* <span data-ttu-id="f5d81-128">`[Compare]`: Valida dos propiedades en una coincidencia de modelos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-128">`[Compare]`: Validates two properties in a model match.</span></span>

* <span data-ttu-id="f5d81-129">`[EmailAddress]`: Valida que la propiedad tenga formato de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="f5d81-129">`[EmailAddress]`: Validates the property has an email format.</span></span>

* <span data-ttu-id="f5d81-130">`[Phone]`: Valida que la propiedad tenga formato de teléfono.</span><span class="sxs-lookup"><span data-stu-id="f5d81-130">`[Phone]`: Validates the property has a telephone format.</span></span>

* <span data-ttu-id="f5d81-131">`[Range]`: Valida que el valor de propiedad se encuentre dentro del intervalo especificado.</span><span class="sxs-lookup"><span data-stu-id="f5d81-131">`[Range]`: Validates the property value falls within the given range.</span></span>

* <span data-ttu-id="f5d81-132">`[RegularExpression]`: Valida que los datos coincidan con la expresión regular especificada.</span><span class="sxs-lookup"><span data-stu-id="f5d81-132">`[RegularExpression]`: Validates that the data matches the specified regular expression.</span></span>

* <span data-ttu-id="f5d81-133">`[Required]`: Hace que una propiedad sea obligatoria.</span><span class="sxs-lookup"><span data-stu-id="f5d81-133">`[Required]`: Makes a property required.</span></span>

* <span data-ttu-id="f5d81-134">`[StringLength]`: Valida que una propiedad de cadena tenga como mucho la longitud máxima determinada.</span><span class="sxs-lookup"><span data-stu-id="f5d81-134">`[StringLength]`: Validates that a string property has at most the given maximum length.</span></span>

* <span data-ttu-id="f5d81-135">`[Url]`: Valida que la propiedad tenga un formato de URL.</span><span class="sxs-lookup"><span data-stu-id="f5d81-135">`[Url]`: Validates the property has a URL format.</span></span>

<span data-ttu-id="f5d81-136">MVC admite cualquier atributo que se derive de `ValidationAttribute` a efectos de validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-136">MVC supports any attribute that derives from `ValidationAttribute` for validation purposes.</span></span> <span data-ttu-id="f5d81-137">En el espacio de nombres [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations) pueden encontrarse muchos atributos de validación útiles.</span><span class="sxs-lookup"><span data-stu-id="f5d81-137">Many useful validation attributes can be found in the [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations) namespace.</span></span>

<span data-ttu-id="f5d81-138">Puede haber instancias en las que necesite más características de las que proporcionan los atributos integrados.</span><span class="sxs-lookup"><span data-stu-id="f5d81-138">There may be instances where you need more features than built-in attributes provide.</span></span> <span data-ttu-id="f5d81-139">En estos casos, puede crear atributos de validación personalizados derivando a partir de `ValidationAttribute` o cambiando el modelo para implementar `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-139">For those times, you can create custom validation attributes by deriving from `ValidationAttribute` or changing your model to implement `IValidatableObject`.</span></span>

## <a name="notes-on-the-use-of-the-required-attribute"></a><span data-ttu-id="f5d81-140">Notas sobre el uso del atributo Required</span><span class="sxs-lookup"><span data-stu-id="f5d81-140">Notes on the use of the Required attribute</span></span>

<span data-ttu-id="f5d81-141">Los [tipos de valor](/dotnet/csharp/language-reference/keywords/value-types) que no aceptan valores NULL (como `decimal`, `int`, `float` y `DateTime`) son intrínsecamente necesarios y no necesitan el atributo `Required`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-141">Non-nullable [value types](/dotnet/csharp/language-reference/keywords/value-types) (such as `decimal`, `int`, `float`, and `DateTime`) are inherently required and don't need the `Required` attribute.</span></span> <span data-ttu-id="f5d81-142">La aplicación no realiza ninguna comprobación de validación del lado servidor para los tipos que no aceptan valores NULL que están marcados como `Required`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-142">The app performs no server-side validation checks for non-nullable types that are marked `Required`.</span></span>

<span data-ttu-id="f5d81-143">El enlace de modelos de MVC, que no está relacionado con la validación y los atributos de validación, rechaza el envío de un campo de formulario que contenga un valor que falta o un espacio en blanco para un tipo que no acepta valores NULL.</span><span class="sxs-lookup"><span data-stu-id="f5d81-143">MVC model binding, which isn't concerned with validation and validation attributes, rejects a form field submission containing a missing value or whitespace for a non-nullable type.</span></span> <span data-ttu-id="f5d81-144">En ausencia de un atributo `BindRequired` en la propiedad de destino, el enlace de modelos omite datos que faltan para los tipos que no aceptan valores NULL, donde el campo de formulario está ausente en los datos entrantes del formulario.</span><span class="sxs-lookup"><span data-stu-id="f5d81-144">In the absence of a `BindRequired` attribute on the target property, model binding ignores missing data for non-nullable types, where the form field is absent from the incoming form data.</span></span>

<span data-ttu-id="f5d81-145">El [atributo BindRequired](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (vea también <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) es útil para garantizar que los datos de formulario están completos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-145">The [BindRequired attribute](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (also see <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) is useful to ensure form data is complete.</span></span> <span data-ttu-id="f5d81-146">Cuando se aplica a una propiedad, el sistema de enlace de modelos requiere un valor para esa propiedad.</span><span class="sxs-lookup"><span data-stu-id="f5d81-146">When applied to a property, the model binding system requires a value for that property.</span></span> <span data-ttu-id="f5d81-147">Cuando se aplica a un tipo, el sistema de enlace de modelos requiere valores para todas las propiedades de ese tipo.</span><span class="sxs-lookup"><span data-stu-id="f5d81-147">When applied to a type, the model binding system requires values for all of the properties of that type.</span></span>

<span data-ttu-id="f5d81-148">Cuando se usa un tipo [Nullable\<T >](/dotnet/csharp/programming-guide/nullable-types/) (por ejemplo, `decimal?` o `System.Nullable<decimal>`) y se marca como `Required`, se realiza una comprobación de validación del lado servidor como si la propiedad fuera un tipo que acepta valores NULL estándar (por ejemplo, un `string`).</span><span class="sxs-lookup"><span data-stu-id="f5d81-148">When you use a [Nullable\<T> type](/dotnet/csharp/programming-guide/nullable-types/) (for example, `decimal?` or `System.Nullable<decimal>`) and mark it `Required`, a server-side validation check is performed as if the property were a standard nullable type (for example, a `string`).</span></span>

<span data-ttu-id="f5d81-149">La validación del lado cliente requiere un valor para un campo de formulario que se corresponda con una propiedad del modelo que se haya marcado como `Required` y para una propiedad de tipo que no acepta valores NULL que no ha marcado como `Required`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-149">Client-side validation requires a value for a form field that corresponds to a model property that you've marked `Required` and for a non-nullable type property that you haven't marked `Required`.</span></span> <span data-ttu-id="f5d81-150">`Required` puede usarse para controlar el mensaje de error de validación del lado cliente.</span><span class="sxs-lookup"><span data-stu-id="f5d81-150">`Required` can be used to control the client-side validation error message.</span></span>

::: moniker range=">= aspnetcore-2.1"

## <a name="top-level-node-validation"></a><span data-ttu-id="f5d81-151">Validación de nodo de nivel superior</span><span class="sxs-lookup"><span data-stu-id="f5d81-151">Top-level node validation</span></span>

<span data-ttu-id="f5d81-152">Los nodos de nivel superior incluyen lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f5d81-152">Top-level nodes include:</span></span>

* <span data-ttu-id="f5d81-153">Parámetros de acción</span><span class="sxs-lookup"><span data-stu-id="f5d81-153">Action parameters</span></span>
* <span data-ttu-id="f5d81-154">Propiedades de controlador</span><span class="sxs-lookup"><span data-stu-id="f5d81-154">Controller properties</span></span>
* <span data-ttu-id="f5d81-155">Parámetros de controlador de página</span><span class="sxs-lookup"><span data-stu-id="f5d81-155">Page handler parameters</span></span>
* <span data-ttu-id="f5d81-156">Propiedades de modelo de página</span><span class="sxs-lookup"><span data-stu-id="f5d81-156">Page model properties</span></span>

<span data-ttu-id="f5d81-157">Los nodos de nivel superior enlazados al modelo se validan además de la validación de las propiedades del modelo.</span><span class="sxs-lookup"><span data-stu-id="f5d81-157">Model-bound top-level nodes are validated in addition to validating model properties.</span></span> <span data-ttu-id="f5d81-158">En el ejemplo siguiente de la aplicación de muestra, el método `VerifyPhone` usa <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> para validar los datos de usuario en el campo Teléfono de un formulario:</span><span class="sxs-lookup"><span data-stu-id="f5d81-158">In the following example from the sample app, the `VerifyPhone` method uses the <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> to validate the user data in the Phone field of a form:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyPhone)]

<span data-ttu-id="f5d81-159">Los nodos de nivel superior pueden usar <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> con atributos de validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-159">Top-level nodes can use <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> with validation attributes.</span></span> <span data-ttu-id="f5d81-160">En el ejemplo siguiente de la aplicación de muestra, el método `CheckAge` especifica que el parámetro `age` debe estar enlazado desde la cadena de consulta al enviar el formulario:</span><span class="sxs-lookup"><span data-stu-id="f5d81-160">In the following example from the sample app, the `CheckAge` method specifies that the `age` parameter must be bound from the query string when the form is submitted:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_CheckAge)]

<span data-ttu-id="f5d81-161">En la página Comprobar edad (*CheckAge.cshtml*), hay dos formularios.</span><span class="sxs-lookup"><span data-stu-id="f5d81-161">In the Check Age page (*CheckAge.cshtml*), there are two forms.</span></span> <span data-ttu-id="f5d81-162">El primer formulario envía un valor `Age` de `99` como una cadena de consulta: `https://localhost:5001/Users/CheckAge?Age=99`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-162">The first form submits an `Age` value of `99` as a query string: `https://localhost:5001/Users/CheckAge?Age=99`.</span></span>

<span data-ttu-id="f5d81-163">Al enviar un parámetro `age` con un formato correcto desde la cadena de consulta, el formulario se valida.</span><span class="sxs-lookup"><span data-stu-id="f5d81-163">When a properly formatted `age` parameter from the query string is submitted, the form validates.</span></span>

<span data-ttu-id="f5d81-164">El segundo formulario de la página Comprobar edad envía el valor `Age` en el cuerpo de la solicitud, y se produce un error de validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-164">The second form on the Check Age page submits the `Age` value in the body of the request, and validation fails.</span></span> <span data-ttu-id="f5d81-165">Se produce un error en el enlace porque el parámetro `age` debe provenir de una cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="f5d81-165">Binding fails because the `age` parameter must come from a query string.</span></span>

<span data-ttu-id="f5d81-166">La validación está habilitada de forma predeterminada y controlada por la propiedad <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> de <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span><span class="sxs-lookup"><span data-stu-id="f5d81-166">Validation is enabled by default and controlled by the <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> property of <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span></span> <span data-ttu-id="f5d81-167">Para deshabilitar la validación del nodo de nivel superior, establezca `AllowValidatingTopLevelNodes` en `false` en las opciones de MVC (`Startup.ConfigureServices`):</span><span class="sxs-lookup"><span data-stu-id="f5d81-167">To disable top-level node validation, set `AllowValidatingTopLevelNodes` to `false` in MVC options (`Startup.ConfigureServices`):</span></span>

[!code-csharp[](validation/sample_snapshot/Startup.cs?name=snippet_AddMvc&highlight=4)]

::: moniker-end

## <a name="model-state"></a><span data-ttu-id="f5d81-168">Estado del modelo</span><span class="sxs-lookup"><span data-stu-id="f5d81-168">Model State</span></span>

<span data-ttu-id="f5d81-169">El estado del modelo representa los errores de validación en valores de formulario HTML enviados.</span><span class="sxs-lookup"><span data-stu-id="f5d81-169">Model state represents validation errors in submitted HTML form values.</span></span>

<span data-ttu-id="f5d81-170">MVC seguirá validando campos hasta que alcance el número máximo de errores (200 de forma predeterminada).</span><span class="sxs-lookup"><span data-stu-id="f5d81-170">MVC will continue validating fields until it reaches the maximum number of errors (200 by default).</span></span> <span data-ttu-id="f5d81-171">Puede configurar este número con el siguiente código en `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="f5d81-171">You can configure this number with the following code in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](validation/sample/Startup.cs?name=snippet_MaxModelValidationErrors)]

## <a name="handle-model-state-errors"></a><span data-ttu-id="f5d81-172">Controlar los errores de estado del modelo</span><span class="sxs-lookup"><span data-stu-id="f5d81-172">Handle Model State errors</span></span>

<span data-ttu-id="f5d81-173">La validación del modelo se produce antes de la ejecución de una acción de controlador.</span><span class="sxs-lookup"><span data-stu-id="f5d81-173">Model validation occurs before the execution of a controller action.</span></span> <span data-ttu-id="f5d81-174">La acción es responsable de inspeccionar `ModelState.IsValid` y reaccionar de manera apropiada.</span><span class="sxs-lookup"><span data-stu-id="f5d81-174">It's the action's responsibility to inspect `ModelState.IsValid` and react appropriately.</span></span> <span data-ttu-id="f5d81-175">En muchos casos, la reacción adecuada consiste en devolver una respuesta de error. Lo ideal sería que detallara el motivo por el motivo del error de validación del modelo.</span><span class="sxs-lookup"><span data-stu-id="f5d81-175">In many cases, the appropriate reaction is to return an error response, ideally detailing the reason why model validation failed.</span></span>

::: moniker range=">= aspnetcore-2.1"

<span data-ttu-id="f5d81-176">Cuando `ModelState.IsValid` se evalúa como `false` en los controladores de la API web con el atributo `[ApiController]`, se devuelve una respuesta HTTP 400 automática que contiene los detalles del problema.</span><span class="sxs-lookup"><span data-stu-id="f5d81-176">When `ModelState.IsValid` evaluates to `false` in web API controllers using the `[ApiController]` attribute, an automatic HTTP 400 response containing issue details is returned.</span></span> <span data-ttu-id="f5d81-177">Para obtener más información, consulte [Respuestas HTTP 400 automáticas](xref:web-api/index#automatic-http-400-responses).</span><span class="sxs-lookup"><span data-stu-id="f5d81-177">For more information, see [Automatic HTTP 400 responses](xref:web-api/index#automatic-http-400-responses).</span></span>

::: moniker-end

<span data-ttu-id="f5d81-178">Algunas aplicaciones optarán por seguir una convención estándar para tratar los errores de validación de modelos, en cuyo caso un filtro podría ser el lugar adecuado para implementar esta directiva.</span><span class="sxs-lookup"><span data-stu-id="f5d81-178">Some apps will choose to follow a standard convention for dealing with model validation errors, in which case a filter may be an appropriate place to implement such a policy.</span></span> <span data-ttu-id="f5d81-179">Debe probar cómo se comportan las acciones con estados de modelo válidos y no válidos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-179">You should test how your actions behave with valid and invalid model states.</span></span>

## <a name="manual-validation"></a><span data-ttu-id="f5d81-180">Validación manual</span><span class="sxs-lookup"><span data-stu-id="f5d81-180">Manual validation</span></span>

<span data-ttu-id="f5d81-181">Después de completarse la validación y el enlace de modelos, es posible que quiera repetir partes de estos procesos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-181">After model binding and validation are complete, you may want to repeat parts of it.</span></span> <span data-ttu-id="f5d81-182">Por ejemplo, puede que un usuario haya escrito texto en un campo esperando recibir un entero, o puede que necesite calcular un valor para la propiedad del modelo.</span><span class="sxs-lookup"><span data-stu-id="f5d81-182">For example, a user may have entered text in a field expecting an integer, or you may need to compute a value for a model's property.</span></span>

<span data-ttu-id="f5d81-183">Es posible que tenga que ejecutar manualmente la validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-183">You may need to run validation manually.</span></span> <span data-ttu-id="f5d81-184">Para ello, llame al método `TryValidateModel`, como se muestra aquí:</span><span class="sxs-lookup"><span data-stu-id="f5d81-184">To do so, call the `TryValidateModel` method, as shown here:</span></span>

[!code-csharp[](validation/sample/MoviesController.cs?name=snippet_TryValidateModel)]

## <a name="custom-validation"></a><span data-ttu-id="f5d81-185">Validación personalizada</span><span class="sxs-lookup"><span data-stu-id="f5d81-185">Custom validation</span></span>

<span data-ttu-id="f5d81-186">Los atributos de validación funcionan para la mayoría de las necesidades validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-186">Validation attributes work for most validation needs.</span></span> <span data-ttu-id="f5d81-187">Pero algunas reglas de validación son específicas de su negocio.</span><span class="sxs-lookup"><span data-stu-id="f5d81-187">However, some validation rules are specific to your business.</span></span> <span data-ttu-id="f5d81-188">Es posible que las reglas no sean técnicas de validación de datos comunes, como asegurarse de que un campo es obligatorio o se ajusta a un rango de valores.</span><span class="sxs-lookup"><span data-stu-id="f5d81-188">Your rules might not be common data validation techniques such as ensuring a field is required or that it conforms to a range of values.</span></span> <span data-ttu-id="f5d81-189">Para estos escenarios, los atributos de validación personalizados son una excelente solución.</span><span class="sxs-lookup"><span data-stu-id="f5d81-189">For these scenarios, custom validation attributes are a great solution.</span></span> <span data-ttu-id="f5d81-190">Es muy fácil crear sus propios atributos de validación personalizados en MVC.</span><span class="sxs-lookup"><span data-stu-id="f5d81-190">Creating your own custom validation attributes in MVC is easy.</span></span> <span data-ttu-id="f5d81-191">Solo tiene que heredar de `ValidationAttribute` e invalidar el método `IsValid`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-191">Just inherit from the `ValidationAttribute`, and override the `IsValid` method.</span></span> <span data-ttu-id="f5d81-192">El método `IsValid` acepta dos parámetros: el primero es un objeto denominado *value* y el segundo es un objeto `ValidationContext` denominado *validationContext*.</span><span class="sxs-lookup"><span data-stu-id="f5d81-192">The `IsValid` method accepts two parameters, the first is an object named *value* and the second is a `ValidationContext` object named *validationContext*.</span></span> <span data-ttu-id="f5d81-193">El objeto *value* hace referencia al valor real del campo que va a validar el validador personalizado.</span><span class="sxs-lookup"><span data-stu-id="f5d81-193">*Value* refers to the actual value from the field that your custom validator is validating.</span></span>

<span data-ttu-id="f5d81-194">En el ejemplo siguiente, una regla de negocio indica que los usuarios no pueden especificar el género *Classic* para una película estrenada después de 1960.</span><span class="sxs-lookup"><span data-stu-id="f5d81-194">In the following sample, a business rule states that users may not set the genre to *Classic* for a movie released after 1960.</span></span> <span data-ttu-id="f5d81-195">El atributo `[ClassicMovie]` comprueba primero el género y, si es un clásico, comprueba que la fecha de estreno es posterior a 1960.</span><span class="sxs-lookup"><span data-stu-id="f5d81-195">The `[ClassicMovie]` attribute checks the genre first, and if it's a classic, then it checks the release date to see that it's later than 1960.</span></span> <span data-ttu-id="f5d81-196">Si se estrenó después de 1960, se produce un error de validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-196">If it's released after 1960, validation fails.</span></span> <span data-ttu-id="f5d81-197">El atributo acepta un parámetro de entero que representa el año que puede usar para validar los datos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-197">The attribute accepts an integer parameter representing the year that you can use to validate data.</span></span> <span data-ttu-id="f5d81-198">Puede capturar el valor del parámetro en el constructor del atributo, como se muestra aquí:</span><span class="sxs-lookup"><span data-stu-id="f5d81-198">You can capture the value of the parameter in the attribute's constructor, as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_ClassicMovieAttribute)]

<span data-ttu-id="f5d81-199">La variable `movie` anterior representa un objeto `Movie` que contiene los datos del envío del formulario para validarlos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-199">The `movie` variable above represents a `Movie` object that contains the data from the form submission to validate.</span></span> <span data-ttu-id="f5d81-200">En este caso, el código de validación comprueba la fecha y el género en el método `IsValid` de la clase `ClassicMovieAttribute` según las reglas.</span><span class="sxs-lookup"><span data-stu-id="f5d81-200">In this case, the validation code checks the date and genre in the `IsValid` method of the `ClassicMovieAttribute` class as per the rules.</span></span> <span data-ttu-id="f5d81-201">Si la validación es correcta, `IsValid` devuelve un código `ValidationResult.Success`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-201">Upon successful validation ,`IsValid` returns a `ValidationResult.Success` code.</span></span> <span data-ttu-id="f5d81-202">Si se produce un error de validación, se devuelve un `ValidationResult` con un mensaje de error:</span><span class="sxs-lookup"><span data-stu-id="f5d81-202">When validation fails, a `ValidationResult` with an error message is returned:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_GetErrorMessage)]

<span data-ttu-id="f5d81-203">Cuando un usuario modifica el campo `Genre` y envía el formulario, el método `IsValid` de `ClassicMovieAttribute` comprueba si la película es un clásico.</span><span class="sxs-lookup"><span data-stu-id="f5d81-203">When a user modifies the `Genre` field and submits the form, the `IsValid` method of the `ClassicMovieAttribute` will verify whether the movie is a classic.</span></span> <span data-ttu-id="f5d81-204">Al igual que con cualquier atributo integrado, aplique `ClassicMovieAttribute` a una propiedad como `ReleaseDate` para asegurarse de que se produce la validación, tal como se muestra en el ejemplo de código anterior.</span><span class="sxs-lookup"><span data-stu-id="f5d81-204">Like any built-in attribute, apply the `ClassicMovieAttribute` to a property such as `ReleaseDate` to ensure validation happens, as shown in the previous code sample.</span></span> <span data-ttu-id="f5d81-205">Puesto que el ejemplo solo funciona con tipos `Movie`, una mejor opción es usar `IValidatableObject` tal y como se muestra en el párrafo siguiente.</span><span class="sxs-lookup"><span data-stu-id="f5d81-205">Since the example works only with `Movie` types, a better option is to use `IValidatableObject` as shown in the following paragraph.</span></span>

<span data-ttu-id="f5d81-206">Si lo prefiere, puede colocar este mismo código en el modelo, implementando el método `Validate` en la interfaz `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-206">Alternatively, this same code could be placed in the model by implementing the `Validate` method on the `IValidatableObject` interface.</span></span> <span data-ttu-id="f5d81-207">Aunque los atributos de validación personalizada funcionan bien para validar propiedades individuales, puede implementar `IValidatableObject` para implementar la validación de nivel de clase:</span><span class="sxs-lookup"><span data-stu-id="f5d81-207">While custom validation attributes work well for validating individual properties, implementing `IValidatableObject` can be used to implement class-level validation:</span></span>

[!code-csharp[](validation/sample/MovieIValidatable.cs?name=snippet&highlight=1,26-34)]

## <a name="client-side-validation"></a><span data-ttu-id="f5d81-208">Validación del lado cliente</span><span class="sxs-lookup"><span data-stu-id="f5d81-208">Client side validation</span></span>

<span data-ttu-id="f5d81-209">La validación del lado cliente es una gran ventaja para los usuarios.</span><span class="sxs-lookup"><span data-stu-id="f5d81-209">Client side validation is a great convenience for users.</span></span> <span data-ttu-id="f5d81-210">Permite ahorrar tiempo que, de lo contrario, pasarían esperando un recorrido de ida y vuelta al servidor.</span><span class="sxs-lookup"><span data-stu-id="f5d81-210">It saves time they would otherwise spend waiting for a round trip to the server.</span></span> <span data-ttu-id="f5d81-211">En términos comerciales, incluso unas pocas fracciones de segundos multiplicadas por cientos de veces al día suman una gran cantidad de tiempo, gastos y frustración.</span><span class="sxs-lookup"><span data-stu-id="f5d81-211">In business terms, even a few fractions of seconds multiplied hundreds of times each day adds up to be a lot of time, expense, and frustration.</span></span> <span data-ttu-id="f5d81-212">La validación inmediata y sencilla permite a los usuarios trabajar de forma más eficiente y generar una entrada y salida de datos de mayor calidad.</span><span class="sxs-lookup"><span data-stu-id="f5d81-212">Straightforward and immediate validation enables users to work more efficiently and produce better quality input and output.</span></span>

<span data-ttu-id="f5d81-213">Debe tener una vista con las referencias de script de JavaScript adecuadas para que la validación del lado cliente funcione como se ve aquí.</span><span class="sxs-lookup"><span data-stu-id="f5d81-213">You must have a view with the proper JavaScript script references in place for client-side validation to work as you see here.</span></span>

[!code-cshtml[](validation/sample/Views/Shared/_Layout.cshtml?name=snippet_ScriptTag)]

[!code-cshtml[](validation/sample/Views/Shared/_ValidationScriptsPartial.cshtml)]

<span data-ttu-id="f5d81-214">El script [Validación discreta de jQuery](https://github.com/aspnet/jquery-validation-unobtrusive) es una biblioteca front-end personalizada de Microsoft que se basa en el conocido complemento [Validación de jQuery](https://jqueryvalidation.org/).</span><span class="sxs-lookup"><span data-stu-id="f5d81-214">The [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive) script is a custom Microsoft front-end library that builds on the popular [jQuery Validate](https://jqueryvalidation.org/) plugin.</span></span> <span data-ttu-id="f5d81-215">Si no usa Validación discreta de jQuery, deberá codificar la misma lógica de validación dos veces: una vez en los atributos de validación del lado servidor en las propiedades del modelo y luego en los scripts del lado cliente (los ejemplos del método [`validate()`](https://jqueryvalidation.org/validate/) de Validación de jQuery muestran lo complejo que podría resultar).</span><span class="sxs-lookup"><span data-stu-id="f5d81-215">Without jQuery Unobtrusive Validation, you would have to code the same validation logic in two places: once in the server side validation attributes on model properties, and then again in client side scripts (the examples for jQuery Validate's [`validate()`](https://jqueryvalidation.org/validate/) method shows how complex this could become).</span></span> <span data-ttu-id="f5d81-216">En su lugar, los [asistentes de etiquetas](xref:mvc/views/tag-helpers/intro) y los [asistentes de HTML](xref:mvc/views/overview) de MVC pueden usar los atributos de validación y escribir metadatos de las propiedades del modelo para representar [atributos de datos](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) HTML 5 en los elementos de formulario que necesitan validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-216">Instead, MVC's [Tag Helpers](xref:mvc/views/tag-helpers/intro) and [HTML helpers](xref:mvc/views/overview) are able to use the validation attributes and type metadata from model properties to render HTML 5 [data- attributes](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) in the form elements that need validation.</span></span> <span data-ttu-id="f5d81-217">MVC genera los atributos `data-` para los atributos integrados y los personalizados.</span><span class="sxs-lookup"><span data-stu-id="f5d81-217">MVC generates the `data-` attributes for both built-in and custom attributes.</span></span> <span data-ttu-id="f5d81-218">La Validación discreta de jQuery analiza después los atributos `data-` y pasa la lógica a Validación de jQuery. De este modo, la lógica de validación del lado servidor se "copia" de manera eficaz en el cliente.</span><span class="sxs-lookup"><span data-stu-id="f5d81-218">jQuery Unobtrusive Validation then parses the `data-` attributes and passes the logic to jQuery Validate, effectively "copying" the server side validation logic to the client.</span></span> <span data-ttu-id="f5d81-219">Puede mostrar errores de validación en el cliente usando los asistentes de etiquetas relevantes, como se muestra aquí:</span><span class="sxs-lookup"><span data-stu-id="f5d81-219">You can display validation errors on the client using the relevant tag helpers as shown here:</span></span>

[!code-cshtml[](validation/sample/Views/Movies/Create.cshtml?name=snippet_ReleaseDate&highlight=4-5)]

<span data-ttu-id="f5d81-220">Los anteriores asistentes de etiquetas representan el código HTML siguiente.</span><span class="sxs-lookup"><span data-stu-id="f5d81-220">The tag helpers above render the HTML below.</span></span> <span data-ttu-id="f5d81-221">Tenga en cuenta que los atributos `data-` en los resultados HTML corresponden a los atributos de validación para la propiedad `ReleaseDate`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-221">Notice that the `data-` attributes in the HTML output correspond to the validation attributes for the `ReleaseDate` property.</span></span> <span data-ttu-id="f5d81-222">El atributo `data-val-required` siguiente contiene un mensaje de error que se muestra si el usuario no rellena el campo de fecha de estreno.</span><span class="sxs-lookup"><span data-stu-id="f5d81-222">The `data-val-required` attribute below contains an error message to display if the user doesn't fill in the release date field.</span></span> <span data-ttu-id="f5d81-223">La Validación discreta de jQuery pasa este valor al método [`required()`](https://jqueryvalidation.org/required-method/) de la Validación de jQuery, que muestra un mensaje en el elemento **\<span>** que lo acompaña.</span><span class="sxs-lookup"><span data-stu-id="f5d81-223">jQuery Unobtrusive Validation passes this value to the jQuery Validate [`required()`](https://jqueryvalidation.org/required-method/) method, which then displays that message in the accompanying **\<span>** element.</span></span>

```html
<form action="/Movies/Create" method="post">
    <div class="form-horizontal">
        <h4>Movie</h4>
        <div class="text-danger"></div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="ReleaseDate">ReleaseDate</label>
            <div class="col-md-10">
                <input class="form-control" type="datetime"
                data-val="true" data-val-required="The ReleaseDate field is required."
                id="ReleaseDate" name="ReleaseDate" value="" />
                <span class="text-danger field-validation-valid"
                data-valmsg-for="ReleaseDate" data-valmsg-replace="true"></span>
            </div>
        </div>
    </div>
</form>
```

<span data-ttu-id="f5d81-224">La validación del lado cliente impide realizar el envío hasta que el formulario sea válido.</span><span class="sxs-lookup"><span data-stu-id="f5d81-224">Client-side validation prevents submission until the form is valid.</span></span> <span data-ttu-id="f5d81-225">El botón Enviar ejecuta JavaScript para enviar el formulario o mostrar mensajes de error.</span><span class="sxs-lookup"><span data-stu-id="f5d81-225">The Submit button runs JavaScript that either submits the form or displays error messages.</span></span>

<span data-ttu-id="f5d81-226">MVC determina los valores de atributo de tipo según el tipo de datos de .NET de una propiedad, posiblemente invalidada usando los atributos `[DataType]`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-226">MVC determines type attribute values based on the .NET data type of a property, possibly overridden using `[DataType]` attributes.</span></span> <span data-ttu-id="f5d81-227">El atributo `[DataType]` de base no realiza ninguna validación en el lado servidor.</span><span class="sxs-lookup"><span data-stu-id="f5d81-227">The base `[DataType]` attribute does no real server-side validation.</span></span> <span data-ttu-id="f5d81-228">Los exploradores eligen sus propios mensajes de error y muestran estos errores cuando quieren, si bien el paquete Validación discreta de jQuery puede invalidar esos mensajes y mostrarlos de manera coherente con otros.</span><span class="sxs-lookup"><span data-stu-id="f5d81-228">Browsers choose their own error messages and display those errors as they wish, however the jQuery Validation Unobtrusive package can override the messages and display them consistently with others.</span></span> <span data-ttu-id="f5d81-229">Esto es más evidente cuando los usuarios aplican subclases de `[DataType]`, como por ejemplo, `[EmailAddress]`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-229">This happens most obviously when users apply `[DataType]` subclasses such as `[EmailAddress]`.</span></span>

### <a name="add-validation-to-dynamic-forms"></a><span data-ttu-id="f5d81-230">Agregar validación a formularios dinámicos</span><span class="sxs-lookup"><span data-stu-id="f5d81-230">Add Validation to Dynamic Forms</span></span>

<span data-ttu-id="f5d81-231">Como la Validación discreta de jQuery pasa la lógica de validación a Validación de jQuery cuando la página se carga por primera vez, los formularios generados dinámicamente no exhiben la validación automáticamente.</span><span class="sxs-lookup"><span data-stu-id="f5d81-231">Because jQuery Unobtrusive Validation passes validation logic and parameters to jQuery Validate when the page first loads, dynamically generated forms won't automatically exhibit validation.</span></span> <span data-ttu-id="f5d81-232">En su lugar, hay que indicar a Validación discreta de jQuery que analice el formulario dinámico inmediatamente después de crearlo.</span><span class="sxs-lookup"><span data-stu-id="f5d81-232">Instead, you must tell jQuery Unobtrusive Validation to parse the dynamic form immediately after creating it.</span></span> <span data-ttu-id="f5d81-233">Por ejemplo, en este código se muestra cómo es posible configurar la validación del lado cliente en un formulario agregado mediante AJAX.</span><span class="sxs-lookup"><span data-stu-id="f5d81-233">For example, the code below shows how you might set up client side validation on a form added via AJAX.</span></span>

```js
$.get({
    url: "https://url/that/returns/a/form",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add form. " + errorThrown);
    },
    success: function(newFormHTML) {
        var container = document.getElementById("form-container");
        container.insertAdjacentHTML("beforeend", newFormHTML);
        var forms = container.getElementsByTagName("form");
        var newForm = forms[forms.length - 1];
        $.validator.unobtrusive.parse(newForm);
    }
})
```

<span data-ttu-id="f5d81-234">El método `$.validator.unobtrusive.parse()` acepta un selector de jQuery para su único argumento.</span><span class="sxs-lookup"><span data-stu-id="f5d81-234">The `$.validator.unobtrusive.parse()` method accepts a jQuery selector for its one argument.</span></span> <span data-ttu-id="f5d81-235">Este método indica a Validación discreta de jQuery que analice los atributos `data-` de formularios dentro de ese selector.</span><span class="sxs-lookup"><span data-stu-id="f5d81-235">This method tells jQuery Unobtrusive Validation to parse the `data-` attributes of forms within that selector.</span></span> <span data-ttu-id="f5d81-236">Los valores de estos atributos se pasan al complemento Validación de jQuery para que el formulario muestre las reglas de validación del lado cliente que quiera.</span><span class="sxs-lookup"><span data-stu-id="f5d81-236">The values of those attributes are then passed to the jQuery Validate plugin so that the form exhibits the desired client side validation rules.</span></span>

### <a name="add-validation-to-dynamic-controls"></a><span data-ttu-id="f5d81-237">Agregar validación a controles dinámicos</span><span class="sxs-lookup"><span data-stu-id="f5d81-237">Add Validation to Dynamic Controls</span></span>

<span data-ttu-id="f5d81-238">También puede actualizar las reglas de validación en un formulario cuando se generan dinámicamente controles individuales, como `<input/>`s y `<select/>`s.</span><span class="sxs-lookup"><span data-stu-id="f5d81-238">You can also update the validation rules on a form when individual controls, such as `<input/>`s and `<select/>`s, are dynamically generated.</span></span> <span data-ttu-id="f5d81-239">No se pueden pasar directamente selectores para estos elementos al método `parse()` porque el formulario adyacente ya se ha analizado y no se actualiza.</span><span class="sxs-lookup"><span data-stu-id="f5d81-239">You cannot pass selectors for these elements to the `parse()` method directly because the surrounding form has already been parsed and won't update.</span></span> <span data-ttu-id="f5d81-240">En lugar de esto, quite primero los datos de validación existentes y vuelva a analizar todo el formulario, como se muestra aquí:</span><span class="sxs-lookup"><span data-stu-id="f5d81-240">Instead, you first remove the existing validation data, then reparse the entire form, as shown below:</span></span>

```js
$.get({
    url: "https://url/that/returns/a/control",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add control. " + errorThrown);
    },
    success: function(newInputHTML) {
        var form = document.getElementById("my-form");
        form.insertAdjacentHTML("beforeend", newInputHTML);
        $(form).removeData("validator")    // Added by jQuery Validate
               .removeData("unobtrusiveValidation");   // Added by jQuery Unobtrusive Validation
        $.validator.unobtrusive.parse(form);
    }
})
```

## <a name="iclientmodelvalidator"></a><span data-ttu-id="f5d81-241">IClientModelValidator</span><span class="sxs-lookup"><span data-stu-id="f5d81-241">IClientModelValidator</span></span>

<span data-ttu-id="f5d81-242">Puede crear lógica del lado cliente para el atributo personalizado y [Validación discreta](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html), que crea un adaptador para la [validación de jQuery](http://jqueryvalidation.org/documentation/), la ejecutará en el cliente automáticamente como parte de la validación.</span><span class="sxs-lookup"><span data-stu-id="f5d81-242">You may create client side logic for your custom attribute, and [unobtrusive validation](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) which creates an adapter to [jquery validation](http://jqueryvalidation.org/documentation/) will execute it on the client for you automatically as part of validation.</span></span> <span data-ttu-id="f5d81-243">El primer paso consiste en controlar qué atributos de datos se agregan mediante la implementación de la interfaz `IClientModelValidator`, como se muestra aquí:</span><span class="sxs-lookup"><span data-stu-id="f5d81-243">The first step is to control what data- attributes are added by implementing the `IClientModelValidator` interface as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_AddValidation)]

<span data-ttu-id="f5d81-244">Los atributos que implementan esta interfaz pueden agregar atributos HTML a los campos generados.</span><span class="sxs-lookup"><span data-stu-id="f5d81-244">Attributes that implement this interface can add HTML attributes to generated fields.</span></span> <span data-ttu-id="f5d81-245">Al examinar la salida del elemento `ReleaseDate` muestra que el HTML es similar al ejemplo anterior, excepto que ahora hay un atributo `data-val-classicmovie` que se definió en el método `AddValidation` de `IClientModelValidator`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-245">Examining the output for the `ReleaseDate` element reveals HTML that's similar to the previous example, except now there's a `data-val-classicmovie` attribute that was defined in the `AddValidation` method of `IClientModelValidator`.</span></span>

```html
<input class="form-control" type="datetime"
    data-val="true"
    data-val-classicmovie="Classic movies must have a release year earlier than 1960."
    data-val-classicmovie-year="1960"
    data-val-required="The ReleaseDate field is required."
    id="ReleaseDate" name="ReleaseDate" value="" />
```

<span data-ttu-id="f5d81-246">La validación discreta usa los datos en los atributos `data-` para mostrar mensajes de error.</span><span class="sxs-lookup"><span data-stu-id="f5d81-246">Unobtrusive validation uses the data in the `data-` attributes to display error messages.</span></span> <span data-ttu-id="f5d81-247">Pero jQuery no sabe nada de reglas o mensajes hasta que estas se agregan al objeto `validator` de jQuery.</span><span class="sxs-lookup"><span data-stu-id="f5d81-247">However, jQuery doesn't know about rules or messages until you add them to jQuery's `validator` object.</span></span> <span data-ttu-id="f5d81-248">Esto se muestra en el ejemplo siguiente, que agrega un método de validación de cliente `classicmovie` personalizado para el objeto `validator` de jQuery.</span><span class="sxs-lookup"><span data-stu-id="f5d81-248">This is shown in the following example, which adds a custom `classicmovie` client validation method to the jQuery `validator` object.</span></span> <span data-ttu-id="f5d81-249">Para una explicación del método `unobtrusive.adapters.add`, consulte [Unobtrusive Client Validation in ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) (Validación discreta de cliente en ASP.NET MVC).</span><span class="sxs-lookup"><span data-stu-id="f5d81-249">For an explanation of the `unobtrusive.adapters.add` method, see [Unobtrusive Client Validation in ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span></span>

[!code-javascript[](validation/sample/Views/Movies/Create.cshtml?name=snippet_UnobtrusiveValidation)]

<span data-ttu-id="f5d81-250">Con el código anterior, el método `classicmovie` realiza la validación del lado cliente en la fecha de lanzamiento de la película.</span><span class="sxs-lookup"><span data-stu-id="f5d81-250">With the preceding code, the `classicmovie` method performs client-side validation on the movie release date.</span></span> <span data-ttu-id="f5d81-251">El mensaje de error aparece si el método devuelve `false`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-251">The error message displays if the method returns `false`.</span></span>

## <a name="remote-validation"></a><span data-ttu-id="f5d81-252">Validación remota</span><span class="sxs-lookup"><span data-stu-id="f5d81-252">Remote validation</span></span>

<span data-ttu-id="f5d81-253">La validación remota es una característica excelente que se usa cuando necesita validar los datos del cliente con datos del servidor.</span><span class="sxs-lookup"><span data-stu-id="f5d81-253">Remote validation is a great feature to use when you need to validate data on the client against data on the server.</span></span> <span data-ttu-id="f5d81-254">Por ejemplo, puede que la aplicación necesite comprobar si ya se está usando un nombre de usuario o una dirección de correo, y debe consultar una gran cantidad de datos para hacerlo.</span><span class="sxs-lookup"><span data-stu-id="f5d81-254">For example, your app may need to verify whether an email or user name is already in use, and it must query a large amount of data to do so.</span></span> <span data-ttu-id="f5d81-255">El hecho de descargar grandes conjuntos de datos para validar un campo o unos pocos campos consume demasiados recursos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-255">Downloading large sets of data for validating one or a few fields consumes too many resources.</span></span> <span data-ttu-id="f5d81-256">También podría exponer información confidencial.</span><span class="sxs-lookup"><span data-stu-id="f5d81-256">It may also expose sensitive information.</span></span> <span data-ttu-id="f5d81-257">Una alternativa a esto consiste en realizar una solicitud de ida y vuelta para validar un campo.</span><span class="sxs-lookup"><span data-stu-id="f5d81-257">An alternative is to make a round-trip request to validate a field.</span></span>

<span data-ttu-id="f5d81-258">Puede implementar la validación remota en un proceso de dos pasos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-258">You can implement remote validation in a two step process.</span></span> <span data-ttu-id="f5d81-259">Primero, debe anotar el modelo con el atributo `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-259">First, you must annotate your model with the `[Remote]` attribute.</span></span> <span data-ttu-id="f5d81-260">El atributo `[Remote]` acepta varias sobrecargas que puede usar para dirigir el JavaScript del lado cliente al código adecuado al que se debe llamar.</span><span class="sxs-lookup"><span data-stu-id="f5d81-260">The `[Remote]` attribute accepts multiple overloads you can use to direct client side JavaScript to the appropriate code to call.</span></span> <span data-ttu-id="f5d81-261">El ejemplo siguiente señala al método de acción `VerifyEmail` del controlador `Users`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-261">The example below points to the `VerifyEmail` action method of the `Users` controller.</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserEmailProperty)]

<span data-ttu-id="f5d81-262">El segundo paso consiste en colocar el código de validación en el método de acción correspondiente, tal como se define en el atributo `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-262">The second step is putting the validation code in the corresponding action method as defined in the `[Remote]` attribute.</span></span> <span data-ttu-id="f5d81-263">Según la documentación del método [remoto](https://jqueryvalidation.org/remote-method/) de Validación de jQuery, la respuesta del servidor debe ser una cadena JSON que puede ser:</span><span class="sxs-lookup"><span data-stu-id="f5d81-263">According to the jQuery Validate [remote](https://jqueryvalidation.org/remote-method/) method documentation, the server response must be a JSON string that's either:</span></span>

* <span data-ttu-id="f5d81-264">`"true"` para elementos válidos.</span><span class="sxs-lookup"><span data-stu-id="f5d81-264">`"true"` for valid elements.</span></span>
* <span data-ttu-id="f5d81-265">`"false"`, `undefined` o `null` para elementos no válidos, usando el mensaje de error predeterminado.</span><span class="sxs-lookup"><span data-stu-id="f5d81-265">`"false"`, `undefined`, or `null` for invalid elements, using the default error message.</span></span>

<span data-ttu-id="f5d81-266">Si la respuesta del servidor es una cadena (por ejemplo, `"That name is already taken, try peter123 instead"`), la cadena se muestra como un mensaje de error personalizado en lugar de la cadena predeterminada.</span><span class="sxs-lookup"><span data-stu-id="f5d81-266">If the server response is a string (for example, `"That name is already taken, try peter123 instead"`), the string is displayed as a custom error message in place of the default string.</span></span>

<span data-ttu-id="f5d81-267">La definición del método `VerifyEmail` sigue estas reglas, tal y como se muestra abajo.</span><span class="sxs-lookup"><span data-stu-id="f5d81-267">The definition of the `VerifyEmail` method follows these rules, as shown below.</span></span> <span data-ttu-id="f5d81-268">Devuelve un mensaje de error de validación si la dirección de correo ya existe o muestra `true` si la dirección de correo está disponible, y ajusta el resultado en un objeto `JsonResult`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-268">It returns a validation error message if the email is taken, or `true` if the email is free, and wraps the result in a `JsonResult` object.</span></span> <span data-ttu-id="f5d81-269">Después, el lado cliente puede usar el valor devuelto para continuar o mostrar el error si es necesario.</span><span class="sxs-lookup"><span data-stu-id="f5d81-269">The client side can then use the returned value to proceed or display the error if needed.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyEmail)]

<span data-ttu-id="f5d81-270">Cuando los usuarios escriben una dirección de correo, JavaScript en la vista hace una llamada remota para comprobar si esa dirección ya existe y, de ser así, se muestra el mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="f5d81-270">Now when users enter an email, JavaScript in the view makes a remote call to see if that email has been taken and, if so, displays the error message.</span></span> <span data-ttu-id="f5d81-271">En caso contrario, el usuario puede enviar el formulario como de costumbre.</span><span class="sxs-lookup"><span data-stu-id="f5d81-271">Otherwise, the user can submit the form as usual.</span></span>

<span data-ttu-id="f5d81-272">La propiedad `AdditionalFields` del atributo `[Remote]` es útil para validar combinaciones de campos con los datos del servidor.</span><span class="sxs-lookup"><span data-stu-id="f5d81-272">The `AdditionalFields` property of the `[Remote]` attribute is useful for validating combinations of fields against data on the server.</span></span> <span data-ttu-id="f5d81-273">Por ejemplo, si el modelo `User` anterior tenía dos propiedades adicionales llamadas `FirstName` y `LastName`, recomendamos comprobar que ningún usuario actual tenga ya ese par de nombres.</span><span class="sxs-lookup"><span data-stu-id="f5d81-273">For example, if the `User` model from above had two additional properties called `FirstName` and `LastName`, you might want to verify that no existing users already have that pair of names.</span></span> <span data-ttu-id="f5d81-274">Tendrá que definir las nuevas propiedades como se muestra en el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="f5d81-274">You define the new properties as shown in the following code:</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserNameProperties)]

<span data-ttu-id="f5d81-275">`AdditionalFields` podría haberse configurado explícitamente para las cadenas `"FirstName"` y `"LastName"`, pero al usar el operador [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) de este modo se simplifica la refactorización posterior.</span><span class="sxs-lookup"><span data-stu-id="f5d81-275">`AdditionalFields` could've been set explicitly to the strings `"FirstName"` and `"LastName"`, but using the [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) operator like this simplifies later refactoring.</span></span> <span data-ttu-id="f5d81-276">El método de acción para realizar la validación debe aceptar dos argumentos, uno para el valor de `FirstName` y otro para el valor de `LastName`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-276">The action method to perform the validation must then accept two arguments, one for the value of `FirstName` and one for the value of `LastName`.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyName)]

<span data-ttu-id="f5d81-277">Cuando los usuarios escriben su nombre y sus apellidos, JavaScript hace lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f5d81-277">Now when users enter a first and last name, JavaScript:</span></span>

* <span data-ttu-id="f5d81-278">Realiza una llamada remota para comprobar si ese par de nombres ya se está usando.</span><span class="sxs-lookup"><span data-stu-id="f5d81-278">Makes a remote call to see if that pair of names has been taken.</span></span>
* <span data-ttu-id="f5d81-279">Si el par de nombres ya existe, se muestra un mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="f5d81-279">If the pair has been taken, an error message is displayed.</span></span>
* <span data-ttu-id="f5d81-280">Si está disponible, el usuario puede enviar el formulario.</span><span class="sxs-lookup"><span data-stu-id="f5d81-280">If not taken, the user can submit the form.</span></span>

<span data-ttu-id="f5d81-281">Si necesita validar dos o más campos adicionales con el atributo `[Remote]`, proporciónelos como una lista delimitada por comas.</span><span class="sxs-lookup"><span data-stu-id="f5d81-281">If you need to validate two or more additional fields with the `[Remote]` attribute, you provide them as a comma-delimited list.</span></span> <span data-ttu-id="f5d81-282">Por ejemplo, para agregar una `MiddleName` propiedad en el modelo, establezca el `[Remote]` atributo tal como se muestra en el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="f5d81-282">For example, to add a `MiddleName` property to the model, set the `[Remote]` attribute as shown in the following code:</span></span>

```cs
[Remote(action: "VerifyName", controller: "Users", AdditionalFields = nameof(FirstName) + "," + nameof(LastName))]
public string MiddleName { get; set; }
```

<span data-ttu-id="f5d81-283">`AdditionalFields`, al igual que todos los argumentos de atributo, debe ser una expresión constante.</span><span class="sxs-lookup"><span data-stu-id="f5d81-283">`AdditionalFields`, like all attribute arguments, must be a constant expression.</span></span> <span data-ttu-id="f5d81-284">Por lo tanto, no se debe usar una [cadena interpolada](/dotnet/csharp/language-reference/keywords/interpolated-strings) ni llamar a <xref:System.String.Join*> para inicializar `AdditionalFields`.</span><span class="sxs-lookup"><span data-stu-id="f5d81-284">Therefore, you must not use an [interpolated string](/dotnet/csharp/language-reference/keywords/interpolated-strings) or call <xref:System.String.Join*> to initialize `AdditionalFields`.</span></span> <span data-ttu-id="f5d81-285">Para cada campo adicional que agregue al atributo `[Remote]`, debe agregar otro argumento al método de acción de controlador correspondiente.</span><span class="sxs-lookup"><span data-stu-id="f5d81-285">For every additional field that you add to the `[Remote]` attribute, you must add another argument to the corresponding controller action method.</span></span>
