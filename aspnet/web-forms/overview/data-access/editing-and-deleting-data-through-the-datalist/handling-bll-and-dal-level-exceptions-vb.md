---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
title: Controlar las excepciones de nivel BLL y DAL (VB) | Microsoft Docs
author: rick-anderson
description: En este tutorial, veremos cómo tactfully controlar las excepciones que se producen durante un flujo de trabajo de actualización de DataList editable.
ms.author: riande
ms.date: 10/30/2006
ms.assetid: ca665073-b379-4239-9404-f597663ca65e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: 319ab44f2e65afc77f6f89ca8aa58c529f40d05c
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/28/2019
ms.locfileid: "74624259"
---
# <a name="handling-bll--and-dal-level-exceptions-vb"></a><span data-ttu-id="a70a0-103">Controlar las excepciones de nivel BLL y DAL (VB)</span><span class="sxs-lookup"><span data-stu-id="a70a0-103">Handling BLL- and DAL-Level Exceptions (VB)</span></span>

<span data-ttu-id="a70a0-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a70a0-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a70a0-105">[Descarga](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) de la aplicación de ejemplo o [descarga de PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a70a0-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span></span>

> <span data-ttu-id="a70a0-106">En este tutorial, veremos cómo tactfully controlar las excepciones que se producen durante un flujo de trabajo de actualización de DataList editable.</span><span class="sxs-lookup"><span data-stu-id="a70a0-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>

## <a name="introduction"></a><span data-ttu-id="a70a0-107">Introducción</span><span class="sxs-lookup"><span data-stu-id="a70a0-107">Introduction</span></span>

<span data-ttu-id="a70a0-108">En la [información general sobre la edición y eliminación de datos en el](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial de DataList, creamos una lista de datos que ofrecía capacidades sencillas de edición y eliminación.</span><span class="sxs-lookup"><span data-stu-id="a70a0-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="a70a0-109">Aunque es totalmente funcional, apenas es fácil de utilizar, ya que los errores que se produjeron durante el proceso de edición o eliminación dieron lugar a una excepción no controlada.</span><span class="sxs-lookup"><span data-stu-id="a70a0-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="a70a0-110">Por ejemplo, si se omite el nombre del producto o, cuando se edita un producto, al escribir un valor de precio de muy asequible, se produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="a70a0-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="a70a0-111">Puesto que esta excepción no se detecta en el código, se propaga hasta el tiempo de ejecución de ASP.NET, que muestra los detalles de la excepción en la Página Web.</span><span class="sxs-lookup"><span data-stu-id="a70a0-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="a70a0-112">Como vimos en la administración de las [excepciones de nivel BLL y Dal en un tutorial de página de ASP.net](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) , si se genera una excepción a partir de las profundidades de las capas de lógica de negocios o de acceso a datos, los detalles de la excepción se devuelven a ObjectDataSource y luego a GridView.</span><span class="sxs-lookup"><span data-stu-id="a70a0-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="a70a0-113">Vimos cómo controlar correctamente estas excepciones creando `Updated` o `RowUpdated` controladores de eventos para ObjectDataSource o GridView, comprobando una excepción y, a continuación, indicando que se controló la excepción.</span><span class="sxs-lookup"><span data-stu-id="a70a0-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="a70a0-114">Sin embargo, nuestros tutoriales de DataList no usan ObjectDataSource para actualizar y eliminar datos.</span><span class="sxs-lookup"><span data-stu-id="a70a0-114">Our DataList tutorials, however, aren't using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="a70a0-115">En su lugar, estamos trabajando directamente con el BLL.</span><span class="sxs-lookup"><span data-stu-id="a70a0-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="a70a0-116">Para detectar las excepciones que se originan en BLL o DAL, es necesario implementar el código de control de excepciones en el código subyacente de la página de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a70a0-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="a70a0-117">En este tutorial, veremos cómo más tactfully controlar las excepciones que se producen durante un flujo de trabajo de actualización de DataList editable.</span><span class="sxs-lookup"><span data-stu-id="a70a0-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="a70a0-118">En la *información general de la edición y eliminación de datos en el* tutorial de DataList se han analizado diferentes técnicas para editar y eliminar datos de la lista de datos, algunas técnicas implicadas en el uso de ObjectDataSource para actualizar y eliminar.</span><span class="sxs-lookup"><span data-stu-id="a70a0-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="a70a0-119">Si emplea estas técnicas, puede controlar las excepciones de BLL o DAL a través de los controladores de eventos `Updated` o `Deleted` de ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="a70a0-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>

## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="a70a0-120">Paso 1: crear una lista de DataList modificable</span><span class="sxs-lookup"><span data-stu-id="a70a0-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="a70a0-121">Antes de preocuparnos por el control de las excepciones que se producen durante el flujo de trabajo de actualización, primero debe crear una lista de controles editable.</span><span class="sxs-lookup"><span data-stu-id="a70a0-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="a70a0-122">Abra la página `ErrorHandling.aspx` de la carpeta `EditDeleteDataList`, agregue una lista de propiedades al diseñador, establezca su propiedad `ID` en `Products`y agregue un nuevo ObjectDataSource denominado `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="a70a0-123">Configure ObjectDataSource para usar el método `ProductsBLL` Class s `GetProducts()` para seleccionar registros; establezca las listas desplegables de las pestañas insertar, actualizar y eliminar en (ninguna).</span><span class="sxs-lookup"><span data-stu-id="a70a0-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="a70a0-124">[![devolver la información del producto mediante el método GetProducts ()](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a70a0-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span></span>

<span data-ttu-id="a70a0-125">**Figura 1**: devolver la información del producto mediante el método `GetProducts()` ([haga clic para ver la imagen de tamaño completo](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="a70a0-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span></span>

<span data-ttu-id="a70a0-126">Después de completar el Asistente de ObjectDataSource, Visual Studio creará automáticamente una `ItemTemplate` para la lista de objetos.</span><span class="sxs-lookup"><span data-stu-id="a70a0-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="a70a0-127">Reemplácelo por un `ItemTemplate` que muestre el nombre y el precio de cada producto e incluya un botón Editar.</span><span class="sxs-lookup"><span data-stu-id="a70a0-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="a70a0-128">A continuación, cree un `EditItemTemplate` con un control Web de cuadro de texto para los botones nombre y precio, y actualizar y cancelar.</span><span class="sxs-lookup"><span data-stu-id="a70a0-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="a70a0-129">Por último, establezca la propiedad DataList s `RepeatColumns` en 2.</span><span class="sxs-lookup"><span data-stu-id="a70a0-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="a70a0-130">Después de estos cambios, el marcado declarativo de la página debe ser similar al siguiente.</span><span class="sxs-lookup"><span data-stu-id="a70a0-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="a70a0-131">Haga doble comprobación para asegurarse de que los botones editar, cancelar y actualizar tienen sus propiedades `CommandName` establecidas en editar, cancelar y actualizar, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="a70a0-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="a70a0-132">En este tutorial, se debe habilitar el estado de vista DataList s.</span><span class="sxs-lookup"><span data-stu-id="a70a0-132">For this tutorial the DataList s view state must be enabled.</span></span>

<span data-ttu-id="a70a0-133">Dedique un momento a ver nuestro progreso a través de un explorador (consulte la figura 2).</span><span class="sxs-lookup"><span data-stu-id="a70a0-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>

<span data-ttu-id="a70a0-134">[![cada producto incluye un botón Editar](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a70a0-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span></span>

<span data-ttu-id="a70a0-135">**Figura 2**: cada producto incluye un botón Editar ([haga clic para ver la imagen de tamaño completo](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a70a0-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span></span>

<span data-ttu-id="a70a0-136">En la actualidad, el botón Editar solo produce un postback, pero el producto no se puede modificar.</span><span class="sxs-lookup"><span data-stu-id="a70a0-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="a70a0-137">Para habilitar la edición, es necesario crear controladores de eventos para los eventos `EditCommand`, `CancelCommand`y `UpdateCommand` de DataList.</span><span class="sxs-lookup"><span data-stu-id="a70a0-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="a70a0-138">Los eventos `EditCommand` y `CancelCommand` simplemente actualizan la propiedad DataList s `EditItemIndex` y vuelve a enlazar los datos a DataList:</span><span class="sxs-lookup"><span data-stu-id="a70a0-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="a70a0-139">El controlador de eventos `UpdateCommand` es un poco más complicado.</span><span class="sxs-lookup"><span data-stu-id="a70a0-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="a70a0-140">Debe leer en los `ProductID` de productos editados de la colección de `DataKeys` junto con el nombre y el precio del producto en los cuadros de texto de la `EditItemTemplate`y, a continuación, llamar al método de la clase `ProductsBLL` s `UpdateProduct` antes de devolver el estado de la lista de objetos a su estado anterior a la edición.</span><span class="sxs-lookup"><span data-stu-id="a70a0-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="a70a0-141">Por ahora, vamos a usar el mismo código exacto del controlador de eventos `UpdateCommand` en la *información general sobre la edición y eliminación de datos en el* tutorial de DataList.</span><span class="sxs-lookup"><span data-stu-id="a70a0-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="a70a0-142">Agregaremos el código para controlar correctamente las excepciones en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="a70a0-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="a70a0-143">En el caso de una entrada no válida que puede tener el formato de un precio por unidad con un formato incorrecto, un valor de precio unitario no válido como-$5,00 o la omisión del nombre del producto se generará una excepción.</span><span class="sxs-lookup"><span data-stu-id="a70a0-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="a70a0-144">Dado que el controlador de eventos `UpdateCommand` no incluye ningún código de control de excepciones en este momento, la excepción se propagará hasta el tiempo de ejecución de ASP.NET, donde se mostrará al usuario final (vea la figura 3).</span><span class="sxs-lookup"><span data-stu-id="a70a0-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>

![Cuando se produce una excepción no controlada, el usuario final ve una página de error](handling-bll-and-dal-level-exceptions-vb/_static/image7.png)

<span data-ttu-id="a70a0-146">**Figura 3**: cuando se produce una excepción no controlada, el usuario final ve una página de error</span><span class="sxs-lookup"><span data-stu-id="a70a0-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>

## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="a70a0-147">Paso 2: controlar las excepciones correctamente en el controlador de eventos UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="a70a0-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="a70a0-148">Durante el flujo de trabajo de actualización, pueden producirse excepciones en el controlador de eventos `UpdateCommand`, el BLL o el DAL.</span><span class="sxs-lookup"><span data-stu-id="a70a0-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="a70a0-149">Por ejemplo, si un usuario especifica un precio de demasiado caro, la instrucción `Decimal.Parse` del controlador de eventos `UpdateCommand` producirá una excepción `FormatException`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="a70a0-150">Si el usuario omite el nombre del producto o si el precio tiene un valor negativo, el DAL producirá una excepción.</span><span class="sxs-lookup"><span data-stu-id="a70a0-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="a70a0-151">Cuando se produce una excepción, queremos mostrar un mensaje informativo dentro de la propia página.</span><span class="sxs-lookup"><span data-stu-id="a70a0-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="a70a0-152">Agregue un control Web de etiqueta a la página cuya `ID` esté establecida en `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="a70a0-153">Configure el texto de la etiqueta para que se muestre en una fuente roja, extra grande, negrita y cursiva asignando su `CssClass` propiedad a la clase `Warning` CSS, que se define en el archivo `Styles.css`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="a70a0-154">Cuando se produce un error, solo queremos que la etiqueta se muestre una vez.</span><span class="sxs-lookup"><span data-stu-id="a70a0-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="a70a0-155">Es decir, en postbacks posteriores, el mensaje de advertencia etiqueta s debería desaparecer.</span><span class="sxs-lookup"><span data-stu-id="a70a0-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="a70a0-156">Esto puede realizarse mediante la eliminación de la propiedad etiqueta s `Text` o la configuración de su propiedad `Visible` en `False` en el controlador de eventos `Page_Load` (como hemos vuelto en el control de las [excepciones de nivel BLL y Dal en un tutorial de página de ASP.net](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) ) o deshabilitando la etiqueta compatibilidad con el estado de vista.</span><span class="sxs-lookup"><span data-stu-id="a70a0-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="a70a0-157">Dejar que use la última opción.</span><span class="sxs-lookup"><span data-stu-id="a70a0-157">Let s use the latter option.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample4.aspx)]

<span data-ttu-id="a70a0-158">Cuando se produzca una excepción, asignaremos los detalles de la excepción a la propiedad `ExceptionDetails` Label control s `Text`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="a70a0-159">Puesto que su estado de vista está deshabilitado, en los postbacks subsiguientes se perderán los cambios de programación de la propiedad `Text` s y se revertirá al texto predeterminado (una cadena vacía), lo que ocultará el mensaje de advertencia.</span><span class="sxs-lookup"><span data-stu-id="a70a0-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="a70a0-160">Para determinar cuándo se ha producido un error con el fin de mostrar un mensaje útil en la página, es necesario agregar un bloque `Try ... Catch` al controlador de eventos `UpdateCommand`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="a70a0-161">La parte `Try` contiene código que puede conducir a una excepción, mientras que el bloque de `Catch` contiene código que se ejecuta en el caso de una excepción.</span><span class="sxs-lookup"><span data-stu-id="a70a0-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="a70a0-162">Consulte la sección [aspectos básicos del control de excepciones](https://msdn.microsoft.com/library/2w8f0bss.aspx) en la documentación de .NET Framework para obtener más información sobre el bloque de `Try ... Catch`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="a70a0-163">Cuando se produce una excepción de cualquier tipo mediante el código dentro del bloque `Try`, se iniciará la ejecución del código del `Catch` bloque s.</span><span class="sxs-lookup"><span data-stu-id="a70a0-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="a70a0-164">El tipo de excepción que se produce `DbException`, `NoNullAllowedException`, `ArgumentException`, etc. depende de lo que, exactamente, ha precipitado el error en primer lugar.</span><span class="sxs-lookup"><span data-stu-id="a70a0-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="a70a0-165">Si hay un problema en el nivel de base de datos, se producirá una `DbException`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="a70a0-166">Si se especifica un valor no válido para los campos `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`o `ReorderLevel`, se producirá una `ArgumentException`, como hemos agregado código para validar estos valores de campo en la clase `ProductsDataTable` (consulte el tutorial [creación de una capa de lógica de negocios](../introduction/creating-a-business-logic-layer-vb.md) ).</span><span class="sxs-lookup"><span data-stu-id="a70a0-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial).</span></span>

<span data-ttu-id="a70a0-167">Podemos proporcionar una explicación más útil al usuario final al basar el texto del mensaje en el tipo de excepción detectada.</span><span class="sxs-lookup"><span data-stu-id="a70a0-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="a70a0-168">El siguiente código que se usó en un formulario prácticamente idéntico en el [control de excepciones de nivel BLL y Dal en un](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial de página de ASP.net proporciona este nivel de detalle:</span><span class="sxs-lookup"><span data-stu-id="a70a0-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial provides this level of detail:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample6.vb)]

<span data-ttu-id="a70a0-169">Para completar este tutorial, basta con llamar al método `DisplayExceptionDetails` desde el bloque `Catch` pasando la instancia de `Exception` detectada (`ex`).</span><span class="sxs-lookup"><span data-stu-id="a70a0-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="a70a0-170">Con el bloque `Try ... Catch` en su lugar, a los usuarios se les presenta un mensaje de error más informativo, como se muestra en las figuras 4 y 5.</span><span class="sxs-lookup"><span data-stu-id="a70a0-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="a70a0-171">Tenga en cuenta que, en el caso de una excepción, el DataList permanece en modo de edición.</span><span class="sxs-lookup"><span data-stu-id="a70a0-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="a70a0-172">Esto se debe a que, una vez que se produce la excepción, el flujo de control se redirige inmediatamente al bloque `Catch`, omitiendo el código que devuelve la lista de controles de bits a su estado de edición previa.</span><span class="sxs-lookup"><span data-stu-id="a70a0-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="a70a0-173">[![se muestra un mensaje de error si un usuario omite un campo obligatorio](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="a70a0-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span></span>

<span data-ttu-id="a70a0-174">**Figura 4**: se muestra un mensaje de error si un usuario omite un campo obligatorio ([haga clic para ver la imagen de tamaño completo](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="a70a0-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span></span>

<span data-ttu-id="a70a0-175">[![se muestra un mensaje de error al especificar un precio negativo](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a70a0-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span></span>

<span data-ttu-id="a70a0-176">**Figura 5**: se muestra un mensaje de error al escribir un precio negativo ([haga clic para ver la imagen de tamaño completo](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="a70a0-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span></span>

## <a name="summary"></a><span data-ttu-id="a70a0-177">Resumen</span><span class="sxs-lookup"><span data-stu-id="a70a0-177">Summary</span></span>

<span data-ttu-id="a70a0-178">GridView y ObjectDataSource proporcionan controladores de eventos de nivel posterior que incluyen información sobre las excepciones que se generaron durante el flujo de trabajo de actualización y eliminación, así como las propiedades que se pueden establecer para indicar si la excepción se ha reciben.</span><span class="sxs-lookup"><span data-stu-id="a70a0-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="a70a0-179">Sin embargo, estas características no están disponibles cuando se trabaja con DataList y se usa la capa BLL directamente.</span><span class="sxs-lookup"><span data-stu-id="a70a0-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="a70a0-180">En su lugar, somos responsables de implementar el control de excepciones.</span><span class="sxs-lookup"><span data-stu-id="a70a0-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="a70a0-181">En este tutorial, vimos cómo agregar el control de excepciones a un flujo de trabajo de actualización de DataList editable agregando un bloque `Try ... Catch` al controlador de eventos `UpdateCommand`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="a70a0-182">Si se produce una excepción durante el flujo de trabajo de actualización, el `Catch` bloquear s código se ejecuta y muestra información útil en la etiqueta de `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="a70a0-183">En este momento, la lista de DataList no realiza ningún esfuerzo para impedir que se produzcan excepciones en el primer lugar.</span><span class="sxs-lookup"><span data-stu-id="a70a0-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="a70a0-184">Aunque sabemos que un precio negativo producirá una excepción, todavía no hemos agregado ninguna funcionalidad para impedir proactivamente que un usuario escriba dicha entrada no válida.</span><span class="sxs-lookup"><span data-stu-id="a70a0-184">Even though we know that a negative price will result in an exception, we haven't yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="a70a0-185">En el siguiente tutorial, veremos cómo ayudar a reducir las excepciones producidas por la entrada de usuario no válida agregando controles de validación en el `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="a70a0-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="a70a0-186">¡ Feliz programación!</span><span class="sxs-lookup"><span data-stu-id="a70a0-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="a70a0-187">Información adicional</span><span class="sxs-lookup"><span data-stu-id="a70a0-187">Further Reading</span></span>

<span data-ttu-id="a70a0-188">Para obtener más información sobre los temas descritos en este tutorial, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="a70a0-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="a70a0-189">Instrucciones de diseño de excepciones</span><span class="sxs-lookup"><span data-stu-id="a70a0-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="a70a0-190">[Módulos y controladores de registro de errores (ELMAH)](http://workspaces.gotdotnet.com/elmah) (una biblioteca de código abierto para registrar errores)</span><span class="sxs-lookup"><span data-stu-id="a70a0-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="a70a0-191">[Enterprise Library para .NET Framework 2,0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (incluye el bloque de aplicaciones de administración de excepciones)</span><span class="sxs-lookup"><span data-stu-id="a70a0-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a70a0-192">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="a70a0-192">About the Author</span></span>

<span data-ttu-id="a70a0-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros de ASP/ASP. net y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha estado trabajando con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="a70a0-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a70a0-194">Scott funciona como consultor, profesor y redactor independiente.</span><span class="sxs-lookup"><span data-stu-id="a70a0-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a70a0-195">Su último libro se [*enseña a ASP.NET 2,0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a70a0-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a70a0-196">Puede ponerse en contacto con usted en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a70a0-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a70a0-197">o a través de su blog, que encontrará en [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a70a0-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a70a0-198">Agradecimiento especial a</span><span class="sxs-lookup"><span data-stu-id="a70a0-198">Special Thanks To</span></span>

<span data-ttu-id="a70a0-199">Muchos revisores útiles revisaron esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="a70a0-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a70a0-200">El revisor responsable de este tutorial fue Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="a70a0-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="a70a0-201">¿Está interesado en revisar los próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="a70a0-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a70a0-202">En caso afirmativo, suéltelo en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a70a0-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a70a0-203">[Anterior](performing-batch-updates-vb.md)
> [Siguiente](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span><span class="sxs-lookup"><span data-stu-id="a70a0-203">[Previous](performing-batch-updates-vb.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span></span>
