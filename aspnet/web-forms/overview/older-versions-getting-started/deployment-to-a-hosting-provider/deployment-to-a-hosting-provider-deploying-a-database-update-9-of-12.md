---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12
title: 'Implementar una aplicación Web de ASP.NET con SQL Server Compact con Visual Studio o Visual Web Developer: implementar una base de datos Update-9 de 12 | Microsoft Docs'
author: tdykstra
description: En esta serie de tutoriales se muestra cómo implementar (publicar) un proyecto de aplicación Web de ASP.NET que incluye una base de datos de SQL Server Compact mediante Visual Stu...
ms.author: riande
ms.date: 11/17/2011
ms.assetid: a8d776af-4735-4612-87f6-9f326587f2d3
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12
msc.type: authoredcontent
ms.openlocfilehash: 3385e1019d9e7a9263fd9513c39b25eb85febbb5
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/28/2019
ms.locfileid: "74582020"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-deploying-a-database-update---9-of-12"></a><span data-ttu-id="e6061-103">Implementar una aplicación Web de ASP.NET con SQL Server Compact con Visual Studio o Visual Web Developer: implementar una base de datos Update-9 de 12</span><span class="sxs-lookup"><span data-stu-id="e6061-103">Deploying an ASP.NET Web Application with SQL Server Compact using Visual Studio or Visual Web Developer: Deploying a Database Update - 9 of 12</span></span>

<span data-ttu-id="e6061-104">por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="e6061-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="e6061-105">Descargar el proyecto de inicio</span><span class="sxs-lookup"><span data-stu-id="e6061-105">Download Starter Project</span></span>](https://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> <span data-ttu-id="e6061-106">En esta serie de tutoriales se muestra cómo implementar (publicar) un proyecto de aplicación Web ASP.NET que incluye una base de datos SQL Server Compact mediante Visual Studio 2012 RC o Visual Studio Express 2012 RC para Web.</span><span class="sxs-lookup"><span data-stu-id="e6061-106">This series of tutorials shows you how to deploy (publish) an ASP.NET web application project that includes a SQL Server Compact database by using Visual Studio 2012 RC or Visual Studio Express 2012 RC for Web.</span></span> <span data-ttu-id="e6061-107">También puede usar Visual Studio 2010 si instala la actualización de publicación Web.</span><span class="sxs-lookup"><span data-stu-id="e6061-107">You can also use Visual Studio 2010 if you install the Web Publish Update.</span></span> <span data-ttu-id="e6061-108">Para obtener una introducción a la serie, vea [el primer tutorial de la serie](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="e6061-108">For an introduction to the series, see [the first tutorial in the series](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span></span>
> 
> <span data-ttu-id="e6061-109">Para ver un tutorial que muestra las características de implementación que se introdujeron después de la versión RC de Visual Studio 2012, muestra cómo implementar SQL Server ediciones distintas de SQL Server Compact y muestra cómo realizar la implementación en Azure App Service Web Apps, vea [implementación web de ASP.net con Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span><span class="sxs-lookup"><span data-stu-id="e6061-109">For a tutorial that shows deployment features introduced after the RC release of Visual Studio 2012, shows how to deploy SQL Server editions other than SQL Server Compact, and shows how to deploy to Azure App Service Web Apps, see [ASP.NET Web Deployment using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="e6061-110">Información general del</span><span class="sxs-lookup"><span data-stu-id="e6061-110">Overview</span></span>

<span data-ttu-id="e6061-111">En este tutorial, realizará un cambio en la base de datos y los cambios en el código relacionado, probará los cambios en Visual Studio y, a continuación, implementará la actualización en los entornos de prueba y producción.</span><span class="sxs-lookup"><span data-stu-id="e6061-111">In this tutorial, you make a database change and related code changes, test the changes in Visual Studio, then deploy the update to both the test and production environments.</span></span>

<span data-ttu-id="e6061-112">Aviso: Si recibe un mensaje de error o algo no funciona a medida que avanza en el tutorial, asegúrese de consultar la [Página de solución de problemas](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="e6061-112">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the [troubleshooting page](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span></span>

## <a name="adding-a-new-column-to-a-table"></a><span data-ttu-id="e6061-113">Agregar una nueva columna a una tabla</span><span class="sxs-lookup"><span data-stu-id="e6061-113">Adding a New Column to a Table</span></span>

<span data-ttu-id="e6061-114">En esta sección, agregará una columna de fecha de nacimiento a la clase base `Person` para las entidades `Student` y `Instructor`.</span><span class="sxs-lookup"><span data-stu-id="e6061-114">In this section, you add a birth date column to the `Person` base class for the `Student` and `Instructor` entities.</span></span> <span data-ttu-id="e6061-115">A continuación, actualice la página que muestra los datos del instructor para que muestren la nueva columna.</span><span class="sxs-lookup"><span data-stu-id="e6061-115">Then you update the page that displays instructor data so that it displays the new column.</span></span>

<span data-ttu-id="e6061-116">En el proyecto *ContosoUniversity. Dal* , Abra *Person.CS* y agregue la siguiente propiedad al final de la clase `Person` (debe haber dos llaves de cierre después):</span><span class="sxs-lookup"><span data-stu-id="e6061-116">In the *ContosoUniversity.DAL* project, open *Person.cs* and add the following property at the end of the `Person` class (there should be two closing curly braces following it):</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample1.cs)]

<span data-ttu-id="e6061-117">A continuación, actualice el método de inicialización para que proporcione un valor para la nueva columna.</span><span class="sxs-lookup"><span data-stu-id="e6061-117">Next, update the Seed method so that it provides a value for the new column.</span></span> <span data-ttu-id="e6061-118">Abra *Migrations\Configuration.CS* y reemplace el bloque de código que comienza `var instructors = new List<Instructor>` por el siguiente bloque de código que incluye la información de fecha de nacimiento:</span><span class="sxs-lookup"><span data-stu-id="e6061-118">Open *Migrations\Configuration.cs* and replace the code block that begins `var instructors = new List<Instructor>` with the following code block which includes birth date information:</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample2.cs)]

<span data-ttu-id="e6061-119">En el proyecto ContosoUniversity, Abra *instructors. aspx* y agregue un nuevo campo plantilla para mostrar la fecha de nacimiento.</span><span class="sxs-lookup"><span data-stu-id="e6061-119">In the ContosoUniversity project, open *Instructors.aspx* and add a new template field to display the birth date.</span></span> <span data-ttu-id="e6061-120">Agréguelo entre los de la fecha de contratación y la asignación de la oficina:</span><span class="sxs-lookup"><span data-stu-id="e6061-120">Add it between the ones for hire date and office assignment:</span></span>

[!code-aspx[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample3.aspx)]

<span data-ttu-id="e6061-121">(Si la sangría de código no está sincronizada, puede presionar CTRL-K y, a continuación, CTRL + D para cambiar el formato del archivo automáticamente).</span><span class="sxs-lookup"><span data-stu-id="e6061-121">(If code indentation gets out of sync, you can press CTRL-K and then CTRL-D to automatically reformat the file.)</span></span>

<span data-ttu-id="e6061-122">Compile la solución y, a continuación, abra la ventana **consola del administrador de paquetes** .</span><span class="sxs-lookup"><span data-stu-id="e6061-122">Build the solution, and then open the **Package Manager Console** window.</span></span> <span data-ttu-id="e6061-123">Asegúrese de que ContosoUniversity. DAL sigue seleccionado como **proyecto predeterminado**.</span><span class="sxs-lookup"><span data-stu-id="e6061-123">Make sure that ContosoUniversity.DAL is still selected as the **Default project**.</span></span>

<span data-ttu-id="e6061-124">En la ventana de la **consola del administrador de paquetes** , seleccione **ContosoUniversity. Dal** como **proyecto predeterminado**y, a continuación, escriba el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="e6061-124">In the **Package Manager Console** window, select **ContosoUniversity.DAL** as the **Default project**, and then enter the following command:</span></span>

[!code-powershell[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample4.ps1)]

<span data-ttu-id="e6061-125">Cuando finaliza este comando, Visual Studio abre el archivo de clase que define la nueva clase de `DbMigration` y, en el método `Up`, puede ver el código que crea la nueva columna.</span><span class="sxs-lookup"><span data-stu-id="e6061-125">When this command finishes, Visual Studio opens the class file that defines the new `DbMigration` class, and in the `Up` method you can see the code that creates the new column.</span></span>

![AddBirthDate_migration_code](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image1.png)

<span data-ttu-id="e6061-127">Compile la solución y, a continuación, escriba el siguiente comando en la ventana de la **consola del administrador de paquetes** (Asegúrese de que el proyecto CONTOSOUNIVERSITY. Dal todavía está seleccionado):</span><span class="sxs-lookup"><span data-stu-id="e6061-127">Build the solution, and then enter the following command in the **Package Manager Console** window (make sure the ContosoUniversity.DAL project is still selected):</span></span>

[!code-powershell[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample5.ps1)]

<span data-ttu-id="e6061-128">Cuando finalice el comando, ejecute la aplicación y seleccione la página instructors.</span><span class="sxs-lookup"><span data-stu-id="e6061-128">When the command finishes, run the application and select the Instructors page.</span></span> <span data-ttu-id="e6061-129">Cuando se cargue la página, verá que tiene el nuevo campo de fecha de nacimiento.</span><span class="sxs-lookup"><span data-stu-id="e6061-129">When the page loads, you see that it has the new birth date field.</span></span>

<span data-ttu-id="e6061-130">[![Instructors_page_with_birth_date](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image3.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="e6061-130">[![Instructors_page_with_birth_date](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image3.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image2.png)</span></span>

## <a name="deploying-the-database-update-to-the-test-environment"></a><span data-ttu-id="e6061-131">Implementar la actualización de la base de datos en el entorno de prueba</span><span class="sxs-lookup"><span data-stu-id="e6061-131">Deploying the Database Update to the Test Environment</span></span>

<span data-ttu-id="e6061-132">En **Explorador de soluciones** Seleccione el proyecto ContosoUniversity.</span><span class="sxs-lookup"><span data-stu-id="e6061-132">In **Solution Explorer** select the ContosoUniversity project.</span></span>

<span data-ttu-id="e6061-133">En la barra de herramientas de **publicación de un solo clic** , seleccione el perfil de publicación de **prueba** y, a continuación, haga clic en **publicar web**.</span><span class="sxs-lookup"><span data-stu-id="e6061-133">In the **Web One Click Publish** toolbar, select the **Test** publish profile, and then click **Publish Web**.</span></span> <span data-ttu-id="e6061-134">(Si la barra de herramientas está deshabilitada, seleccione el proyecto ContosoUniversity en **Explorador de soluciones**).</span><span class="sxs-lookup"><span data-stu-id="e6061-134">(If the toolbar is disabled, select the ContosoUniversity project in **Solution Explorer**.)</span></span>

<span data-ttu-id="e6061-135">Visual Studio implementa la aplicación actualizada y el explorador se abre en la Página principal.</span><span class="sxs-lookup"><span data-stu-id="e6061-135">Visual Studio deploys the updated application, and the browser opens to the home page.</span></span> <span data-ttu-id="e6061-136">Ejecute la página instructores para comprobar que la actualización se ha implementado correctamente.</span><span class="sxs-lookup"><span data-stu-id="e6061-136">Run the Instructors page to verify that the update was successfully deployed.</span></span> <span data-ttu-id="e6061-137">Cuando la aplicación intenta obtener acceso a la base de datos de esta página, Code First actualiza el esquema de la base de datos y ejecuta el método `Seed`.</span><span class="sxs-lookup"><span data-stu-id="e6061-137">When the application tries to access the database for this page, Code First updates the database schema and runs the `Seed` method.</span></span> <span data-ttu-id="e6061-138">Cuando se muestre la página, verá la columna **fecha de nacimiento** esperada con fechas.</span><span class="sxs-lookup"><span data-stu-id="e6061-138">When the page displays, you see the expected **Birth Date** column with dates in it.</span></span>

<span data-ttu-id="e6061-139">[![Instructors_page_with_birth_date_Test](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e6061-139">[![Instructors_page_with_birth_date_Test](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image4.png)</span></span>

## <a name="deploying-the-database-update-to-the-production-environment"></a><span data-ttu-id="e6061-140">Implementación de la actualización de la base de datos en el entorno de producción</span><span class="sxs-lookup"><span data-stu-id="e6061-140">Deploying the Database Update to the Production Environment</span></span>

<span data-ttu-id="e6061-141">Ahora puede realizar la implementación en producción.</span><span class="sxs-lookup"><span data-stu-id="e6061-141">You can now deploy to production.</span></span> <span data-ttu-id="e6061-142">La única diferencia es que usará *app\_. htm sin conexión* para evitar que los usuarios accedan al sitio y, por tanto, actualicen la base de datos mientras se implementan los cambios.</span><span class="sxs-lookup"><span data-stu-id="e6061-142">The only difference is that you'll use *app\_offline.htm* to prevent users from accessing the site and thus updating the database while you're deploying changes.</span></span> <span data-ttu-id="e6061-143">Para la implementación de producción, realice los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="e6061-143">For production deployment perform the following steps:</span></span>

- <span data-ttu-id="e6061-144">Cargue la *aplicación\_archivo. htm sin conexión* en el sitio de producción.</span><span class="sxs-lookup"><span data-stu-id="e6061-144">Upload the *app\_offline.htm* file to the production site.</span></span>
- <span data-ttu-id="e6061-145">En Visual Studio, elija el perfil de producción en la barra de herramientas de **publicación en Web** y haga clic en **publicar web**.</span><span class="sxs-lookup"><span data-stu-id="e6061-145">In Visual Studio, choose the Production profile in the **Web One Click Publish** toolbar and click **Publish Web**.</span></span>
- <span data-ttu-id="e6061-146">Elimine la *aplicación\_archivo. htm sin conexión* del sitio de producción.</span><span class="sxs-lookup"><span data-stu-id="e6061-146">Delete the *app\_offline.htm* file from the production site.</span></span>

> [!NOTE]
> <span data-ttu-id="e6061-147">Mientras la aplicación está en uso en el entorno de producción, debe implementar un plan de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="e6061-147">While your application is in use in the production environment you should be implementing a backup plan.</span></span> <span data-ttu-id="e6061-148">Es decir, debe copiar periódicamente los archivos *School-Prod. sdf* y *ASPNET-Prod. sdf* desde el sitio de producción a una ubicación de almacenamiento segura, y debe mantener varias generaciones de dichas copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="e6061-148">That is, you should be periodically copying the *School-Prod.sdf* and *aspnet-Prod.sdf* files from the production site to a secure storage location, and you should be keeping several generations of such backups.</span></span> <span data-ttu-id="e6061-149">Al actualizar la base de datos, debe realizar una copia de seguridad inmediatamente antes del cambio.</span><span class="sxs-lookup"><span data-stu-id="e6061-149">When you update the database, you should make a backup copy from immediately before the change.</span></span> <span data-ttu-id="e6061-150">Después, si comete un error y no lo detecta hasta después de implementarlo en producción, podrá recuperar la base de datos al estado en que se encontraba antes de que se dañara.</span><span class="sxs-lookup"><span data-stu-id="e6061-150">Then, if you make a mistake and don't discover it until after you have deployed it to production, you will still be able to recover the database to the state it was in before it became corrupted.</span></span>

<span data-ttu-id="e6061-151">Cuando Visual Studio abre la dirección URL de la Página principal en el explorador, se muestra la página *\_la aplicación offline. htm* .</span><span class="sxs-lookup"><span data-stu-id="e6061-151">When Visual Studio opens the home page URL in the browser, the *app\_offline.htm* page is displayed.</span></span> <span data-ttu-id="e6061-152">Después de eliminar la *aplicación\_archivo. htm sin conexión* , puede ir a la Página principal de nuevo para comprobar que la actualización se ha implementado correctamente.</span><span class="sxs-lookup"><span data-stu-id="e6061-152">After you delete the *app\_offline.htm* file, you can browse to your home page again to verify that the update was successfully deployed.</span></span>

<span data-ttu-id="e6061-153">[![Instructors_page_with_birth_date_Prod](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image7.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="e6061-153">[![Instructors_page_with_birth_date_Prod](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image7.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image6.png)</span></span>

<span data-ttu-id="e6061-154">Ahora ha implementado una actualización de la aplicación que incluía un cambio en la base de datos de prueba y producción.</span><span class="sxs-lookup"><span data-stu-id="e6061-154">You've now deployed an application update that included a database change to both test and production.</span></span> <span data-ttu-id="e6061-155">En el siguiente tutorial se muestra cómo migrar la base de datos de SQL Server Compact a SQL Server Express y SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e6061-155">The next tutorial shows you how to migrate your database from SQL Server Compact to SQL Server Express and SQL Server.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e6061-156">[Anterior](deployment-to-a-hosting-provider-deploying-a-code-only-update-8-of-12.md)
> [Siguiente](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12.md)</span><span class="sxs-lookup"><span data-stu-id="e6061-156">[Previous](deployment-to-a-hosting-provider-deploying-a-code-only-update-8-of-12.md)
[Next](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12.md)</span></span>
