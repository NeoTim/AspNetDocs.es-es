---
uid: identity/overview/extensibility/implementing-a-custom-mysql-aspnet-identity-storage-provider
title: 'Implementación de un proveedor de almacenamiento de ASP.NET Identity MySQL personalizado: ASP.NET 4. x'
author: raquelsa
description: ASP.NET Identity es un sistema extensible que le permite crear su propio proveedor de almacenamiento y conectarlo a la aplicación sin tener que volver a trabajar con las aplicaciones...
ms.author: riande
ms.date: 05/22/2015
ms.assetid: 248f5fe7-39ba-40ea-ab1e-71a69b0bd649
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/extensibility/implementing-a-custom-mysql-aspnet-identity-storage-provider
msc.type: authoredcontent
ms.openlocfilehash: 2f0b47d45bce82c71d1864536309f9e2ffed2d63
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78500071"
---
# <a name="implementing-a-custom-mysql-aspnet-identity-storage-provider"></a><span data-ttu-id="1d77d-103">Implementar un proveedor de almacenamiento personalizado de ASP.NET Identity de MySQL</span><span class="sxs-lookup"><span data-stu-id="1d77d-103">Implementing a Custom MySQL ASP.NET Identity Storage Provider</span></span>

<span data-ttu-id="1d77d-104">por [Raquel Soares de Almeida](https://github.com/raquelsa), [Suhas Joshi](https://github.com/suhasj), [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="1d77d-104">by [Raquel Soares De Almeida](https://github.com/raquelsa), [Suhas Joshi](https://github.com/suhasj), [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="1d77d-105">ASP.NET Identity es un sistema extensible que le permite crear su propio proveedor de almacenamiento y conectarlo a la aplicación sin tener que volver a trabajar con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1d77d-105">ASP.NET Identity is an extensible system which enables you to create your own storage provider and plug it into your application without re-working the application.</span></span> <span data-ttu-id="1d77d-106">En este tema se describe cómo crear un proveedor de almacenamiento de MySQL para ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="1d77d-106">This topic describes how to create a MySQL storage provider for ASP.NET Identity.</span></span> <span data-ttu-id="1d77d-107">Para obtener información general sobre la creación de proveedores de almacenamiento personalizados, consulte [información general de proveedores de almacenamiento personalizados para ASP.net Identity](overview-of-custom-storage-providers-for-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="1d77d-107">For an overview of creating custom storage providers, see [Overview of Custom Storage Providers for ASP.NET Identity](overview-of-custom-storage-providers-for-aspnet-identity.md).</span></span>
> 
> <span data-ttu-id="1d77d-108">Para completar este tutorial, debe tener Visual Studio 2013 con Update 2.</span><span class="sxs-lookup"><span data-stu-id="1d77d-108">To complete this tutorial, you must have Visual Studio 2013 with Update 2.</span></span>
> 
> <span data-ttu-id="1d77d-109">Este tutorial hará lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="1d77d-109">This tutorial will:</span></span>
> 
> - <span data-ttu-id="1d77d-110">Muestre cómo crear una instancia de base de datos MySQL en Azure.</span><span class="sxs-lookup"><span data-stu-id="1d77d-110">Show how to create a MySQL database instance on Azure.</span></span>
> - <span data-ttu-id="1d77d-111">Muestre cómo usar una herramienta de cliente de MySQL (MySQL Workbench) para crear tablas y administrar la base de datos remota en Azure.</span><span class="sxs-lookup"><span data-stu-id="1d77d-111">Show how to use a MySQL client tool (MySQL Workbench) to create tables and manage your remote database on Azure.</span></span>
> - <span data-ttu-id="1d77d-112">Muestre cómo reemplazar la implementación de almacenamiento de ASP.NET Identity predeterminada con nuestra implementación personalizada en un proyecto de aplicación MVC.</span><span class="sxs-lookup"><span data-stu-id="1d77d-112">Show how to replace the default ASP.NET Identity storage implementation with our custom implementation on a MVC application project.</span></span>
> 
> <span data-ttu-id="1d77d-113">Este tutorial fue escrito originalmente por Raquel Soares de Almeida y Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="1d77d-113">This tutorial was originally written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span> <span data-ttu-id="1d77d-114">El proyecto de ejemplo se actualizó para la identidad 2,0 de Suhas Joshi.</span><span class="sxs-lookup"><span data-stu-id="1d77d-114">The sample project was updated for Identity 2.0 by Suhas Joshi.</span></span> <span data-ttu-id="1d77d-115">El tema se actualizó para la identidad 2,0 por Tom FitzMacken.</span><span class="sxs-lookup"><span data-stu-id="1d77d-115">The topic was updated for Identity 2.0 by Tom FitzMacken.</span></span>

## <a name="download-completed-project"></a><span data-ttu-id="1d77d-116">Descargar proyecto completado</span><span class="sxs-lookup"><span data-stu-id="1d77d-116">Download completed project</span></span>

<span data-ttu-id="1d77d-117">Al final de este tutorial, tendrá un proyecto de aplicación MVC con ASP.NET Identity trabajando con una base de datos MySQL hospedada en Azure.</span><span class="sxs-lookup"><span data-stu-id="1d77d-117">At the end of this tutorial, you will have an MVC application project with ASP.NET Identity working with a MySQL database hosted on Azure.</span></span>

<span data-ttu-id="1d77d-118">Puede descargar el proveedor de almacenamiento de MySQL completado en [Aspnet. Identity. MySQL (GitHub)](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/AspNet.Identity.MySQL).</span><span class="sxs-lookup"><span data-stu-id="1d77d-118">You can download the completed MySQL storage provider at [AspNet.Identity.MySQL (GitHub)](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/AspNet.Identity.MySQL).</span></span>

## <a name="the-steps-you-will-perform"></a><span data-ttu-id="1d77d-119">Los pasos que realizará</span><span class="sxs-lookup"><span data-stu-id="1d77d-119">The steps you will perform</span></span>

<span data-ttu-id="1d77d-120">En este tutorial, aprenderá lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="1d77d-120">In this tutorial you will:</span></span>

1. <span data-ttu-id="1d77d-121">Crear una base de datos MySQL en Azure</span><span class="sxs-lookup"><span data-stu-id="1d77d-121">Create a MySQL database on Azure</span></span>
2. <span data-ttu-id="1d77d-122">Crear las tablas de ASP.NET Identity en MySQL</span><span class="sxs-lookup"><span data-stu-id="1d77d-122">Create the ASP.NET Identity tables in MySQL</span></span>
3. <span data-ttu-id="1d77d-123">Crear una aplicación MVC y configurarla para que use el proveedor de MySQL</span><span class="sxs-lookup"><span data-stu-id="1d77d-123">Create an MVC application and configure it to use the MySQL provider</span></span>
4. <span data-ttu-id="1d77d-124">Ejecutar la aplicación</span><span class="sxs-lookup"><span data-stu-id="1d77d-124">Run the app</span></span>

<span data-ttu-id="1d77d-125">En este tema no se trata la arquitectura de ASP.NET Identity y las decisiones que debe tomar al implementar un proveedor de almacenamiento de cliente.</span><span class="sxs-lookup"><span data-stu-id="1d77d-125">This topic does not cover the architecture of ASP.NET Identity and the decisions you must make when implementing a customer storage provider.</span></span> <span data-ttu-id="1d77d-126">Para obtener esa información, consulte [información general de los proveedores de almacenamiento personalizados para ASP.net Identity](overview-of-custom-storage-providers-for-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="1d77d-126">For that information, see [Overview of Custom Storage Providers for ASP.NET Identity](overview-of-custom-storage-providers-for-aspnet-identity.md).</span></span>

## <a name="review-mysql-storage-provider-classes"></a><span data-ttu-id="1d77d-127">Revisar las clases de proveedor de almacenamiento de MySQL</span><span class="sxs-lookup"><span data-stu-id="1d77d-127">Review MySQL storage provider classes</span></span>

<span data-ttu-id="1d77d-128">Antes de ir a los pasos para crear el proveedor de almacenamiento de MySQL, echemos un vistazo a las clases que componen el proveedor de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="1d77d-128">Before jumping into the steps to create the MySQL storage provider, let's look at the classes that make up the storage provider.</span></span> <span data-ttu-id="1d77d-129">Necesitará clases que administren las operaciones de base de datos y las clases a las que se llama desde la aplicación para administrar usuarios y roles.</span><span class="sxs-lookup"><span data-stu-id="1d77d-129">You will need classes that manage the database operations and classes that are called from the application to manage users and roles.</span></span>

### <a name="storage-classes"></a><span data-ttu-id="1d77d-130">Clases de almacenamiento</span><span class="sxs-lookup"><span data-stu-id="1d77d-130">Storage classes</span></span>

- <span data-ttu-id="1d77d-131">[IdentityUser](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/IdentityUser.cs) : contiene propiedades para el usuario.</span><span class="sxs-lookup"><span data-stu-id="1d77d-131">[IdentityUser](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/IdentityUser.cs) - contains properties for the user.</span></span>
- <span data-ttu-id="1d77d-132">[UserStore](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserStore.cs) : contiene las operaciones para agregar, actualizar o recuperar usuarios.</span><span class="sxs-lookup"><span data-stu-id="1d77d-132">[UserStore](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserStore.cs) - contains operations for adding, updating or retrieving users.</span></span>
- <span data-ttu-id="1d77d-133">[IdentityRole](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/IdentityRole.cs) : contiene las propiedades de los roles.</span><span class="sxs-lookup"><span data-stu-id="1d77d-133">[IdentityRole](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/IdentityRole.cs) - contains properties for roles.</span></span>
- <span data-ttu-id="1d77d-134">[RoleStore](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/RoleStore.cs) : contiene las operaciones para agregar, eliminar, actualizar y recuperar roles.</span><span class="sxs-lookup"><span data-stu-id="1d77d-134">[RoleStore](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/RoleStore.cs) - contains operations for adding, deleting, updating and retrieving roles.</span></span>

### <a name="data-access-layer-classes"></a><span data-ttu-id="1d77d-135">Clases de capa de acceso a datos</span><span class="sxs-lookup"><span data-stu-id="1d77d-135">Data access layer classes</span></span>

<span data-ttu-id="1d77d-136">En este ejemplo, las clases de capa de acceso a datos contienen instrucciones SQL para trabajar con las tablas; sin embargo, en el código podría querer usar la asignación relacional de objetos (ORM) como Entity Framework o NHibernate.</span><span class="sxs-lookup"><span data-stu-id="1d77d-136">For this example, the data access layer classes contain SQL statements for working with the tables; however, in your code you might want to use object-relational mapping (ORM) such as Entity Framework or NHibernate.</span></span> <span data-ttu-id="1d77d-137">En concreto, la aplicación puede experimentar un rendimiento deficiente sin un ORM que incluye la carga diferida y el almacenamiento en caché de objetos.</span><span class="sxs-lookup"><span data-stu-id="1d77d-137">In particular, your application may experience poor performance without an ORM that includes lazy loading and object caching.</span></span> <span data-ttu-id="1d77d-138">Para obtener más información, consulte [ASP.NET Identity 2,0 sin Entity Framework?](https://aspnetidentity.codeplex.com/discussions/561828)</span><span class="sxs-lookup"><span data-stu-id="1d77d-138">For more information, see [ASP.NET Identity 2.0 without Entity Framework?](https://aspnetidentity.codeplex.com/discussions/561828)</span></span>

- <span data-ttu-id="1d77d-139">[MySQLDatabase](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/MySQLDatabase.cs) : contiene la conexión de base de datos MySQL y los métodos para realizar operaciones de base de datos.</span><span class="sxs-lookup"><span data-stu-id="1d77d-139">[MySQLDatabase](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/MySQLDatabase.cs) - contains the MySQL database connection and methods for performing database operations.</span></span> <span data-ttu-id="1d77d-140">Se crean instancias de UserStore y RoleStore con una instancia de esta clase.</span><span class="sxs-lookup"><span data-stu-id="1d77d-140">UserStore and RoleStore are both instantiated with an instance of this class.</span></span>
- <span data-ttu-id="1d77d-141">[RoleTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/RoleTable.cs) : contiene las operaciones de base de datos para la tabla que almacena roles.</span><span class="sxs-lookup"><span data-stu-id="1d77d-141">[RoleTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/RoleTable.cs) - contains database operations for the table that stores roles.</span></span>
- <span data-ttu-id="1d77d-142">[UserClaimsTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserClaimsTable.cs) : contiene las operaciones de base de datos para la tabla que almacena notificaciones de usuario.</span><span class="sxs-lookup"><span data-stu-id="1d77d-142">[UserClaimsTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserClaimsTable.cs) - contains database operations for the table that stores user claims.</span></span>
- <span data-ttu-id="1d77d-143">[UserLoginsTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserLoginsTable.cs) : contiene las operaciones de base de datos para la tabla que almacena la información de inicio de sesión del usuario.</span><span class="sxs-lookup"><span data-stu-id="1d77d-143">[UserLoginsTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserLoginsTable.cs) - contains database operations for the table that stores user login information.</span></span>
- <span data-ttu-id="1d77d-144">[UserRoleTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserRoleTable.cs) : contiene las operaciones de base de datos para la tabla que almacena los usuarios a los que se asignan los roles.</span><span class="sxs-lookup"><span data-stu-id="1d77d-144">[UserRoleTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserRoleTable.cs) - contains database operations for the table that stores which users are assigned to which roles.</span></span>
- <span data-ttu-id="1d77d-145">[UserTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserTable.cs) : contiene las operaciones de base de datos para la tabla que almacena los usuarios.</span><span class="sxs-lookup"><span data-stu-id="1d77d-145">[UserTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserTable.cs) - contains database operations for the table that stores users.</span></span>

## <a name="create-a-mysql-database-instance-on-azure"></a><span data-ttu-id="1d77d-146">Creación de una instancia de base de datos MySQL en Azure</span><span class="sxs-lookup"><span data-stu-id="1d77d-146">Create a MySQL database instance on Azure</span></span>

1. <span data-ttu-id="1d77d-147">Inicie sesión en [Azure Portal](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="1d77d-147">Log in to the [Azure Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="1d77d-148">Haga clic en **+ nuevo** en la parte inferior de la página y, a continuación, seleccione **tienda**.</span><span class="sxs-lookup"><span data-stu-id="1d77d-148">Click **+NEW** at the bottom of the page, and then select **STORE**.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image1.png)
3. <span data-ttu-id="1d77d-149">En el asistente **elegir y complemento** , seleccione base de **datos MySQL ClearDB** y haga clic en la flecha siguiente situada en la parte inferior derecha del cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="1d77d-149">In the **Choose and Add-on** wizard, select **ClearDB MySQL Database** and click on the next arrow at the bottom right of the dialog.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image2.png)
4. <span data-ttu-id="1d77d-150">Mantenga el plan **gratuito** predeterminado y cambie el **nombre** a **IdentityMySQLDatabase**.</span><span class="sxs-lookup"><span data-stu-id="1d77d-150">Keep the default **Free** plan and change the **Name** to **IdentityMySQLDatabase**.</span></span> <span data-ttu-id="1d77d-151">Seleccione la región más cercana y, a continuación, haga clic en la flecha siguiente.</span><span class="sxs-lookup"><span data-stu-id="1d77d-151">Select the region nearest you and then click the next arrow.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image3.png)
5. <span data-ttu-id="1d77d-152">Haga clic en la marca de verificación para completar la creación de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="1d77d-152">Click the checkmark to complete the database creation.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image4.png)
6. <span data-ttu-id="1d77d-153">Una vez que se ha creado la base de datos, puede administrarla desde la pestaña **COMPLEMENTOS** del Portal de administración.</span><span class="sxs-lookup"><span data-stu-id="1d77d-153">After your database has been created, you can manage it from the **ADD-ONS** tab in the management portal.</span></span>   
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image5.png)
7. <span data-ttu-id="1d77d-154">Puede obtener la información de conexión de la base de datos haciendo clic en **información de conexión** en la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="1d77d-154">You can get the database connection information by clicking on **CONNECTION INFO** at the bottom of the page.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image6.png)
8. <span data-ttu-id="1d77d-155">Copie la cadena de conexión haciendo clic en el botón copiar y guárdela para poder usarlo más adelante en la aplicación MVC.</span><span class="sxs-lookup"><span data-stu-id="1d77d-155">Copy the connection string by clicking on the copy button and save it so you can use later in your MVC application.</span></span>   
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image7.png)

## <a name="create-the-aspnet-identity-tables-in-a-mysql-database"></a><span data-ttu-id="1d77d-156">Crear las tablas de ASP.NET Identity en una base de datos MySQL</span><span class="sxs-lookup"><span data-stu-id="1d77d-156">Create the ASP.NET Identity tables in a MySQL database</span></span>

### <a name="install-mysql-workbench-tool-to-connect-and-manage-mysql-database"></a><span data-ttu-id="1d77d-157">Instalación de la herramienta MySQL Workbench para conectarse y administrar la base de datos MySQL</span><span class="sxs-lookup"><span data-stu-id="1d77d-157">Install MySQL Workbench tool to connect and manage MySQL database</span></span>

1. <span data-ttu-id="1d77d-158">Instalación de la herramienta **MySQL Workbench** desde la [Página de descargas de MySQL](http://dev.mysql.com/downloads/windows/installer/)</span><span class="sxs-lookup"><span data-stu-id="1d77d-158">Install the **MySQL Workbench** tool from the [MySQL downloads page](http://dev.mysql.com/downloads/windows/installer/)</span></span>
2. <span data-ttu-id="1d77d-159">Inicie la aplicación y haga clic en el botón **MySQLConnections +** para agregar una nueva conexión.</span><span class="sxs-lookup"><span data-stu-id="1d77d-159">Launch the app and add click on the **MySQLConnections +** button to add a new connection.</span></span> <span data-ttu-id="1d77d-160">Use los datos de la cadena de conexión que ha copiado de la base de datos MySQL de Azure que creó anteriormente en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="1d77d-160">Use the connection string data you copied from the Azure MySQL database you created earlier in this tutorial.</span></span>
3. <span data-ttu-id="1d77d-161">Después de establecer la conexión, abra una nueva pestaña de **consulta** ; pegue los comandos de [MySQLIdentity. SQL](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/MySQLIdentity.sql) en la consulta y ejecútelo para crear las tablas de base de datos.</span><span class="sxs-lookup"><span data-stu-id="1d77d-161">After establishing the connection, open a new **Query** tab; paste the commands from [MySQLIdentity.sql](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/MySQLIdentity.sql) into the query and execute it in order to create the database tables.</span></span>
4. <span data-ttu-id="1d77d-162">Ahora tiene todas las tablas necesarias de ASP.NET Identity creadas en una base de datos MySQL hospedada en Azure, como se muestra a continuación.</span><span class="sxs-lookup"><span data-stu-id="1d77d-162">You now have all the ASP.NET Identity necessary tables created on a MySQL database hosted on Azure as shown below.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image1.jpg)

## <a name="create-an-mvc-application-project-from-template-and-configure-it-to-use-mysql-provider"></a><span data-ttu-id="1d77d-163">Crear un proyecto de aplicación de MVC a partir de una plantilla y configurarlo para usar el proveedor de MySQL</span><span class="sxs-lookup"><span data-stu-id="1d77d-163">Create an MVC application project from template and configure it to use MySQL provider</span></span>

<span data-ttu-id="1d77d-164">Si es necesario, instale [Visual Studio Express 2013 para web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566) con Update 2.</span><span class="sxs-lookup"><span data-stu-id="1d77d-164">If needed, install either [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566) with Update 2.</span></span>

### <a name="download-the-aspnetidentitymysql-project-from-github"></a><span data-ttu-id="1d77d-165">Descargar el proyecto ASP. NET. Identity. MySQL de GitHub</span><span class="sxs-lookup"><span data-stu-id="1d77d-165">Download the ASP.NET.Identity.MySQL project from GitHub</span></span>

1. <span data-ttu-id="1d77d-166">Vaya a la dirección URL del repositorio en [Aspnet. Identity. MySQL (GitHub)](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/AspNet.Identity.MySQL/).</span><span class="sxs-lookup"><span data-stu-id="1d77d-166">Browse to the repository URL at [AspNet.Identity.MySQL (GitHub)](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/AspNet.Identity.MySQL/).</span></span>
2. <span data-ttu-id="1d77d-167">Descargue el código fuente.</span><span class="sxs-lookup"><span data-stu-id="1d77d-167">Download the source code.</span></span>
3. <span data-ttu-id="1d77d-168">Extraiga el archivo. zip en una carpeta local.</span><span class="sxs-lookup"><span data-stu-id="1d77d-168">Extract the .zip file into a local folder.</span></span>
4. <span data-ttu-id="1d77d-169">Abra la solución AspNet. Identity. MySQL y genérelo.</span><span class="sxs-lookup"><span data-stu-id="1d77d-169">Open the AspNet.Identity.MySQL solution and build it.</span></span>

### <a name="create-a-new-mvc-application-project-from-template"></a><span data-ttu-id="1d77d-170">Crear un nuevo proyecto de aplicación de MVC a partir de una plantilla</span><span class="sxs-lookup"><span data-stu-id="1d77d-170">Create a new MVC application project from template</span></span>

1. <span data-ttu-id="1d77d-171">Haga clic con el botón derecho en la solución **Aspnet. Identity. MySQL** y **agregue**, **nuevo proyecto**</span><span class="sxs-lookup"><span data-stu-id="1d77d-171">Right click the **AspNet.Identity.MySQL** solution and **Add**, **New Project**</span></span>
2. <span data-ttu-id="1d77d-172">En el cuadro de diálogo **Agregar nuevo proyecto** , seleccione  **C# visual** a la izquierda, luego **Web** y, a continuación, seleccione **aplicación Web de ASP.net**.</span><span class="sxs-lookup"><span data-stu-id="1d77d-172">In the **Add New Project** Dialog select **Visual C#** on the left, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="1d77d-173">Asigne al proyecto el nombre **IdentityMySQLDemo**; y, a continuación, haga clic en Aceptar.</span><span class="sxs-lookup"><span data-stu-id="1d77d-173">Name your project **IdentityMySQLDemo**; and then click OK.</span></span>  
  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image2.jpg)
3. <span data-ttu-id="1d77d-174">En el cuadro de diálogo **nuevo proyecto ASP.net** , seleccione la plantilla MVC con las opciones predeterminadas (que incluye **las cuentas de usuario individuales** como método de autenticación) y haga clic en **Aceptar**.![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image3.jpg)</span><span class="sxs-lookup"><span data-stu-id="1d77d-174">In the **New ASP.NET Project** dialog, select the MVC template with the default options (that includes **Individual User Accounts** as authentication method) and click **OK**.![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image3.jpg)</span></span>
4. <span data-ttu-id="1d77d-175">En Explorador de soluciones, haga clic con el botón derecho en el proyecto IdentityMySQLDemo y seleccione **administrar paquetes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="1d77d-175">In Solution Explorer, right-click your IdentityMySQLDemo project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="1d77d-176">En el cuadro de diálogo Buscar cuadro de texto, escriba **Identity. EntityFramework**.</span><span class="sxs-lookup"><span data-stu-id="1d77d-176">In the search text box dialog, type **Identity.EntityFramework**.</span></span> <span data-ttu-id="1d77d-177">Seleccione este paquete en la lista de resultados y haga clic en **desinstalar**.</span><span class="sxs-lookup"><span data-stu-id="1d77d-177">Select this package in the list of results and click **Uninstall**.</span></span> <span data-ttu-id="1d77d-178">Se le pedirá que desinstale el paquete de dependencia EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="1d77d-178">You will be prompted to uninstall the dependency package EntityFramework.</span></span> <span data-ttu-id="1d77d-179">Haga clic en sí, ya que ya no vamos a usar este paquete en esta aplicación.</span><span class="sxs-lookup"><span data-stu-id="1d77d-179">Click on Yes as we will no longer this package on this application.</span></span>
5. <span data-ttu-id="1d77d-180">Haga clic con el botón derecho en el proyecto IdentityMySQLDemo, seleccione **Agregar**, **referencia, solución, proyectos,** Seleccione el proyecto Aspnet. Identity. MySQL y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="1d77d-180">Right click the IdentityMySQLDemo project, select **Add**, **Reference, Solution, Projects;** select the AspNet.Identity.MySQL project and click **OK**.</span></span>
6. <span data-ttu-id="1d77d-181">En el proyecto IdentityMySQLDemo, reemplace todas las referencias a</span><span class="sxs-lookup"><span data-stu-id="1d77d-181">In the IdentityMySQLDemo project, replace all references to</span></span>  
    `using Microsoft.AspNet.Identity.EntityFramework;`  
   <span data-ttu-id="1d77d-182">with</span><span class="sxs-lookup"><span data-stu-id="1d77d-182">with</span></span>  
     `using AspNet.Identity.MySQL;`
7. <span data-ttu-id="1d77d-183">En IdentityModels.cs, establezca **ApplicationDbContext** para que se derive de **MySqlDatabase** e incluya un constructor que tome un único parámetro con el nombre de la conexión.</span><span class="sxs-lookup"><span data-stu-id="1d77d-183">In IdentityModels.cs, set **ApplicationDbContext** to derive from **MySqlDatabase** and include a constructor that take a single parameter with the connection name.</span></span>  

    [!code-csharp[Main](implementing-a-custom-mysql-aspnet-identity-storage-provider/samples/sample1.cs)]
8. <span data-ttu-id="1d77d-184">Abra el archivo IdentityConfig.cs.</span><span class="sxs-lookup"><span data-stu-id="1d77d-184">Open the IdentityConfig.cs file.</span></span> <span data-ttu-id="1d77d-185">En el método **ApplicationUserManager. Create** , reemplace la creación de instancias de UserManager con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="1d77d-185">In the **ApplicationUserManager.Create** method, replace instantiating UserManager with the following code:</span></span>  

    [!code-csharp[Main](implementing-a-custom-mysql-aspnet-identity-storage-provider/samples/sample2.cs)]
9. <span data-ttu-id="1d77d-186">Abra el archivo Web. config y reemplace la cadena DefaultConnection por esta entrada reemplazando los valores resaltados por la cadena de conexión de la base de datos MySQL que creó en los pasos anteriores:</span><span class="sxs-lookup"><span data-stu-id="1d77d-186">Open the web.config file and replace the DefaultConnection string with this entry replacing the highlighted values with the connection string of the MySQL database you created on previous steps:</span></span>  

    [!code-xml[Main](implementing-a-custom-mysql-aspnet-identity-storage-provider/samples/sample3.xml?highlight=2)]

## <a name="run-the-app-and-connect-to-the-mysql-db"></a><span data-ttu-id="1d77d-187">Ejecutar la aplicación y conectarse a la base de</span><span class="sxs-lookup"><span data-stu-id="1d77d-187">Run the app and connect to the MySQL DB</span></span>

1. <span data-ttu-id="1d77d-188">Haga clic con el botón derecho en el proyecto **IdentityMySQLDemo** y seleccione **establecer como proyecto de inicio** .</span><span class="sxs-lookup"><span data-stu-id="1d77d-188">Right click the **IdentityMySQLDemo** project and select **Set as Startup Project**</span></span>
2. <span data-ttu-id="1d77d-189">Presione **Ctrl + F5** para compilar y ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1d77d-189">Press **Ctrl + F5** to build and run the app.</span></span>
3. <span data-ttu-id="1d77d-190">Haga clic en la pestaña **registro** en la parte superior de la página.</span><span class="sxs-lookup"><span data-stu-id="1d77d-190">Click on **Register** tab on the top of the page.</span></span>
4. <span data-ttu-id="1d77d-191">Escriba un nombre de usuario y una contraseña nuevos y, a continuación, haga clic en **registrar**.</span><span class="sxs-lookup"><span data-stu-id="1d77d-191">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image8.png)
5. <span data-ttu-id="1d77d-192">El nuevo usuario se ha registrado y ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="1d77d-192">The new user is now registered and logged in.</span></span>  
  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image9.png)
6. <span data-ttu-id="1d77d-193">Vuelva a la herramienta MySQL Workbench e inspeccione el contenido de la tabla **IdentityMySQLDatabase** .</span><span class="sxs-lookup"><span data-stu-id="1d77d-193">Go back to the MySQL Workbench tool and inspect the **IdentityMySQLDatabase** table's contents.</span></span> <span data-ttu-id="1d77d-194">Inspeccione las entradas de la tabla usuarios para registrar nuevos usuarios.</span><span class="sxs-lookup"><span data-stu-id="1d77d-194">Inspect the users table for the entries as you register new users.</span></span>  
  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image10.png)

## <a name="next-steps"></a><span data-ttu-id="1d77d-195">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="1d77d-195">Next Steps</span></span>

<span data-ttu-id="1d77d-196">Para obtener más información sobre cómo habilitar otros métodos de autenticación en esta aplicación, consulte [creación de una aplicación de ASP.NET MVC 5 con el inicio de sesión de Facebook y Google OAuth2 y OpenID](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="1d77d-196">For more information on how to enable other authentication methods on this app, refer to [Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>

<span data-ttu-id="1d77d-197">Para obtener información sobre cómo integrar la base de de con OAuth y configurar roles para limitar el acceso de los usuarios a la aplicación, consulte [implementación de una aplicación ASP.NET MVC 5 segura con pertenencia, OAuth y SQL Database en Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="1d77d-197">To learn how to integrate your DB with OAuth and to set up roles to limit users access to your app, see [Deploy a Secure ASP.NET MVC 5 app with Membership, OAuth, and SQL Database to Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span>
