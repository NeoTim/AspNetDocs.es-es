---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-vb
title: Autorización basada en usuario (VB) | Microsoft Docs
author: rick-anderson
description: En este tutorial, veremos cómo limitar el acceso a las páginas y restringir la funcionalidad de nivel de página a través de diversas técnicas.
ms.author: riande
ms.date: 01/18/2008
ms.assetid: bc937e9d-5c14-4fc4-aec7-440da924dd18
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-vb
msc.type: authoredcontent
ms.openlocfilehash: dfac0c6fa955e59c6ea996533f2447e89ec8d468
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78516379"
---
# <a name="user-based-authorization-vb"></a><span data-ttu-id="1ebc0-103">Autorización basada en usuario (VB)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-103">User-Based Authorization (VB)</span></span>

<span data-ttu-id="1ebc0-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="1ebc0-105">[Descargar código](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) o [Descargar PDF](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-105">[Download Code](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) or [Download PDF](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span></span>

> <span data-ttu-id="1ebc0-106">En este tutorial, veremos cómo limitar el acceso a las páginas y restringir la funcionalidad de nivel de página a través de diversas técnicas.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>

## <a name="introduction"></a><span data-ttu-id="1ebc0-107">Introducción</span><span class="sxs-lookup"><span data-stu-id="1ebc0-107">Introduction</span></span>

<span data-ttu-id="1ebc0-108">La mayoría de las aplicaciones web que ofrecen cuentas de usuario lo hacen en parte para impedir que determinados visitantes tengan acceso a determinadas páginas del sitio.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="1ebc0-109">En la mayoría de los sitios de Messageboard en línea, por ejemplo, todos los usuarios (anónimos y autenticados) pueden ver las entradas de Messageboard, pero solo los usuarios autenticados pueden visitar la página web para crear una nueva publicación.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="1ebc0-110">Y puede haber páginas administrativas que solo sean accesibles para un usuario determinado (o un conjunto determinado de usuarios).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="1ebc0-111">Además, la funcionalidad en el nivel de página puede variar en función del usuario.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="1ebc0-112">Al ver una lista de entradas, se muestra a los usuarios autenticados una interfaz para clasificar cada entrada, mientras que esta interfaz no está disponible para los visitantes anónimos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="1ebc0-113">ASP.NET facilita la definición de reglas de autorización basadas en el usuario.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="1ebc0-114">Con tan solo un poco de marcado en `Web.config`, las páginas web específicas o los directorios completos se pueden bloquear para que solo se pueda tener acceso a ellas en un subconjunto especificado de usuarios.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="1ebc0-115">La funcionalidad en el nivel de página puede activarse o desactivarse en función del usuario que ha iniciado sesión actualmente a través de medios mediante programación y declarativos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="1ebc0-116">En este tutorial, veremos cómo limitar el acceso a las páginas y restringir la funcionalidad de nivel de página a través de diversas técnicas.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="1ebc0-117">Comencemos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="1ebc0-118">Un vistazo al flujo de trabajo de autorización de URL</span><span class="sxs-lookup"><span data-stu-id="1ebc0-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="1ebc0-119">Como se describe en el tutorial [*de información general sobre la autenticación de formularios*](../introduction/an-overview-of-forms-authentication-vb.md) , cuando el tiempo de ejecución de ASP.net procesa una solicitud de un recurso ASP.net, la solicitud genera una serie de eventos durante su ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="1ebc0-120">Los *módulos http* son clases administradas cuyo código se ejecuta como respuesta a un evento determinado en el ciclo de vida de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="1ebc0-121">ASP.NET se suministra con varios módulos HTTP que realizan tareas esenciales en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="1ebc0-122">Uno de estos módulos HTTP es [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="1ebc0-123">Como se explicó en los tutoriales anteriores, la función principal de la `FormsAuthenticationModule` es determinar la identidad de la solicitud actual.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="1ebc0-124">Esto se logra mediante la inspección del vale de autenticación de formularios, que se encuentra en una cookie o se inserta en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="1ebc0-125">Esta identificación tiene lugar durante el [evento`AuthenticateRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="1ebc0-126">Otro módulo HTTP importante es el [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), que se genera en respuesta al [evento`AuthorizeRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (que se produce después del evento `AuthenticateRequest`).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="1ebc0-127">El `UrlAuthorizationModule` examina el marcado de configuración en `Web.config` para determinar si la identidad actual tiene autoridad para visitar la página especificada.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="1ebc0-128">Este proceso se conoce como *autorización de dirección URL*.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="1ebc0-129">Examinaremos la sintaxis de las reglas de autorización de URL en el paso 1, pero primero veamos lo que hace el `UrlAuthorizationModule` en función de si la solicitud está autorizada o no.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="1ebc0-130">Si el `UrlAuthorizationModule` determina que la solicitud está autorizada, no hace nada y la solicitud continúa a lo largo de su ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="1ebc0-131">Sin embargo, si la solicitud *no* está autorizada, la `UrlAuthorizationModule` anula el ciclo de vida e indica al objeto `Response` que devuelva un estado [no autorizado http 401](http://www.checkupdown.com/status/E401.html) .</span><span class="sxs-lookup"><span data-stu-id="1ebc0-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="1ebc0-132">Al utilizar la autenticación de formularios, este estado HTTP 401 nunca se devuelve al cliente porque si el `FormsAuthenticationModule` detecta un Estado HTTP 401, lo modifica en una [redirección http 302](http://www.checkupdown.com/status/E302.html) a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="1ebc0-133">La figura 1 muestra el flujo de trabajo de la canalización ASP.NET, el `FormsAuthenticationModule`y el `UrlAuthorizationModule` cuando llega una solicitud no autorizada.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="1ebc0-134">En concreto, la ilustración 1 muestra una solicitud por parte de un visitante anónimo de `ProtectedPage.aspx`, que es una página que deniega el acceso a los usuarios anónimos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="1ebc0-135">Puesto que el visitante es anónimo, el `UrlAuthorizationModule` anula la solicitud y devuelve un estado no autorizado HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="1ebc0-136">A continuación, el `FormsAuthenticationModule` convierte el estado 401 en un redireccionamiento de 302 a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="1ebc0-137">Una vez que el usuario se ha autenticado a través de la página de inicio de sesión, se le redirige a `ProtectedPage.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="1ebc0-138">Esta vez, el `FormsAuthenticationModule` identifica al usuario en función de su vale de autenticación.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="1ebc0-139">Ahora que el visitante está autenticado, el `UrlAuthorizationModule` permite el acceso a la página.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>

<span data-ttu-id="1ebc0-140">[![el flujo de trabajo de autenticación de formularios y autorización de URL](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span></span>

<span data-ttu-id="1ebc0-141">**Figura 1**: flujo de trabajo de autenticación de formularios y autorización de URL ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-vb/_static/image3.png))</span></span>

<span data-ttu-id="1ebc0-142">La figura 1 muestra la interacción que se produce cuando un visitante anónimo intenta tener acceso a un recurso que no está disponible para los usuarios anónimos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="1ebc0-143">En tal caso, el visitante anónimo se redirige a la página de inicio de sesión con la página que ha intentado visitar especificado en la cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="1ebc0-144">Una vez que el usuario haya iniciado sesión correctamente, se le redirigirá automáticamente al recurso que estaba intentando ver inicialmente.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="1ebc0-145">Cuando un usuario anónimo realiza la solicitud no autorizada, este flujo de trabajo es sencillo y es fácil para el visitante comprender lo que ha sucedido y por qué.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="1ebc0-146">Sin embargo, tenga en cuenta que el `FormsAuthenticationModule` *redirigirá a los usuarios* no autorizados a la página de inicio de sesión, aunque la solicitud la realice un usuario autenticado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="1ebc0-147">Esto puede dar lugar a una experiencia de usuario confusa si un usuario autenticado intenta visitar una página para la que carece de autoridad.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="1ebc0-148">Imagine que el sitio web tenía sus reglas de autorización de URL configuradas de forma que la `OnlyTito.aspx` página ASP.NET solo era accesible a Tito.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="1ebc0-149">Ahora, Imagine que Sam visita el sitio, inicia sesión y, a continuación, intenta visitar `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="1ebc0-150">El `UrlAuthorizationModule` detendrá el ciclo de vida de la solicitud y devolverá un estado no autorizado HTTP 401, que el `FormsAuthenticationModule` detectará y redirigirá a Sam a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="1ebc0-151">A pesar de que Sam ya ha iniciado sesión, es posible que se pregunte por qué se ha enviado a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="1ebc0-152">Es posible que tenga en que las credenciales de inicio de sesión se han perdido de algún modo o que ha especificado credenciales no válidas.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="1ebc0-153">Si Sam vuelve a escribir sus credenciales desde la página de inicio de sesión, se iniciará sesión (de nuevo) y se le redirigirá a `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="1ebc0-154">El `UrlAuthorizationModule` detectará que Sam no puede visitar esta página y se le devolverá a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="1ebc0-155">En la ilustración 2 se muestra este flujo de trabajo confuso.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-155">Figure 2 depicts this confusing workflow.</span></span>

<span data-ttu-id="1ebc0-156">[![el flujo de trabajo predeterminado puede conducir a un ciclo confuso](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span></span>

<span data-ttu-id="1ebc0-157">**Figura 2**: el flujo de trabajo predeterminado puede conducir a un ciclo confuso ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-vb/_static/image6.png))</span></span>

<span data-ttu-id="1ebc0-158">El flujo de trabajo que se muestra en la figura 2 puede befuddle rápidamente incluso el visitante más experimentado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="1ebc0-159">Veremos maneras de evitar este ciclo confuso en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="1ebc0-160">ASP.NET usa dos mecanismos para determinar si el usuario actual puede tener acceso a una página web determinada: autorización de URL y autorización de archivo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="1ebc0-161">La autorización de archivos se implementa mediante el [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), que determina la autoridad mediante la consulta de las ACL de los archivos solicitados.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="1ebc0-162">La autorización de archivos se usa normalmente con la autenticación de Windows, ya que las ACL son permisos que se aplican a las cuentas de Windows.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="1ebc0-163">Al utilizar la autenticación de formularios, todas las solicitudes de sistema operativo y de nivel de sistema de archivos se ejecutan con la misma cuenta de Windows, independientemente de que el usuario visite el sitio.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="1ebc0-164">Dado que esta serie de tutoriales se centra en la autenticación de formularios, no hablaremos de la autorización de archivos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>

### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="1ebc0-165">El ámbito de autorización de URL</span><span class="sxs-lookup"><span data-stu-id="1ebc0-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="1ebc0-166">El `UrlAuthorizationModule` es código administrado que forma parte del tiempo de ejecución de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="1ebc0-167">Antes de la versión 7 del servidor Web de [Internet Information Services (IIS)](https://www.iis.net/) de Microsoft, había una barrera distinta entre la CANALización http de IIS y la canalización del tiempo de ejecución de ASP.net.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="1ebc0-168">En Resumen, en IIS 6 y versiones anteriores, ASP. La `UrlAuthorizationModule` de red solo se ejecuta cuando se delega una solicitud desde IIS al tiempo de ejecución de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="1ebc0-169">De forma predeterminada, IIS procesa contenido estático en sí mismo, como páginas HTML y archivos CSS, JavaScript y de imagen, y solo entrega solicitudes al tiempo de ejecución de ASP.NET cuando se solicita una página con una extensión de `.aspx`, `.asmx`o `.ashx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="1ebc0-170">Sin embargo, IIS 7 permite canalizaciones integradas de IIS y ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="1ebc0-171">Con algunas opciones de configuración, puede configurar IIS 7 para que invoque el `UrlAuthorizationModule` para *todas* las solicitudes, lo que significa que se pueden definir reglas de autorización de URL para los archivos de cualquier tipo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="1ebc0-172">Además, IIS 7 incluye su propio motor de autorización de URL.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="1ebc0-173">Para obtener más información acerca de la integración de ASP.NET y la funcionalidad de autorización de URL nativa de IIS 7, consulte [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="1ebc0-174">Para obtener una visión más detallada de la integración de ASP.NET e IIS 7, seleccione una copia del libro de Shahram Khosravi, *Professional IIS 7 y ASP.net Integrated Programming* (ISBN: 978-0470152539).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="1ebc0-175">En pocas palabras, en las versiones anteriores a IIS 7, las reglas de autorización de direcciones URL solo se aplican a los recursos administrados por el tiempo de ejecución de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="1ebc0-176">Pero con IIS 7 es posible usar la característica de autorización de URL nativa de IIS o integrar ASP. La `UrlAuthorizationModule` de red en la canalización HTTP de IIS, con lo que se amplía esta funcionalidad a todas las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="1ebc0-177">Hay algunas diferencias sutiles pero importantes en el modo en que ASP. La característica de autorización de URL de la `UrlAuthorizationModule` de red y de IIS 7 procesa las reglas de autorización.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="1ebc0-178">En este tutorial no se examina la funcionalidad de autorización de URL de IIS 7 ni las diferencias en la forma en que analiza las reglas de autorización en comparación con la `UrlAuthorizationModule`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="1ebc0-179">Para obtener más información sobre estos temas, consulte la documentación de IIS 7 en MSDN o en [www.IIS.net](https://www.iis.net/).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>

## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="1ebc0-180">Paso 1: definición de las reglas de autorización de URL en`Web.config`</span><span class="sxs-lookup"><span data-stu-id="1ebc0-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="1ebc0-181">El `UrlAuthorizationModule` determina si se debe conceder o denegar el acceso a un recurso solicitado para una identidad determinada en función de las reglas de autorización de URL definidas en la configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="1ebc0-182">Las reglas de autorización se escriben en el [elemento`<authorization>`](https://msdn.microsoft.com/library/8d82143t.aspx) en forma de `<allow>` y `<deny>` elementos secundarios.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="1ebc0-183">Cada `<allow>` y `<deny>` elemento secundario pueden especificar:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="1ebc0-184">Un usuario determinado</span><span class="sxs-lookup"><span data-stu-id="1ebc0-184">A particular user</span></span>
- <span data-ttu-id="1ebc0-185">Una lista delimitada por comas de usuarios</span><span class="sxs-lookup"><span data-stu-id="1ebc0-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="1ebc0-186">Todos los usuarios anónimos, indicados por un signo de interrogación (?)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="1ebc0-187">Todos los usuarios, indicados por un asterisco (\*)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="1ebc0-188">En el marcado siguiente se muestra cómo usar las reglas de autorización de URL para permitir a los usuarios Tito y Scott y denegar todos los demás:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample1.xml)]

<span data-ttu-id="1ebc0-189">El elemento `<allow>` define qué usuarios están permitidos-Tito y Scott-mientras que el elemento `<deny>` indica que se deniegan *todos* los usuarios.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="1ebc0-190">Los elementos `<allow>` y `<deny>` también pueden especificar las reglas de autorización para los roles.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="1ebc0-191">Examinaremos la autorización basada en roles en un tutorial futuro.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-191">We will examine role-based authorization in a future tutorial.</span></span>

<span data-ttu-id="1ebc0-192">La configuración siguiente concede acceso a cualquier persona que no sea Sam (incluidos los visitantes anónimos):</span><span class="sxs-lookup"><span data-stu-id="1ebc0-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample2.xml)]

<span data-ttu-id="1ebc0-193">Para permitir solo usuarios autenticados, use la configuración siguiente, que deniega el acceso a todos los usuarios anónimos:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample3.xml)]

<span data-ttu-id="1ebc0-194">Las reglas de autorización se definen en el elemento `<system.web>` de `Web.config` y se aplican a todos los recursos ASP.NET de la aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="1ebc0-195">A menudo, una aplicación tiene distintas reglas de autorización para diferentes secciones.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="1ebc0-196">Por ejemplo, en un sitio de comercio electrónico, todos los visitantes pueden consultar los productos, ver las revisiones del producto, buscar en el catálogo, etc.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="1ebc0-197">Sin embargo, solo los usuarios autenticados pueden tener acceso a la desprotección o las páginas para administrar el historial de envíos de un.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="1ebc0-198">Además, puede haber partes del sitio a las que solo puedan acceder los usuarios seleccionados, como los administradores del sitio.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="1ebc0-199">ASP.NET facilita la definición de distintas reglas de autorización para diferentes archivos y carpetas en el sitio.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="1ebc0-200">Las reglas de autorización especificadas en el archivo de `Web.config` de la carpeta raíz se aplican a todos los recursos de ASP.NET del sitio.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="1ebc0-201">Sin embargo, estos valores de autorización predeterminados se pueden invalidar para una carpeta determinada agregando una `Web.config` con una `<authorization>` sección.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="1ebc0-202">Vamos a actualizar nuestro sitio web para que solo los usuarios autenticados puedan visitar las páginas de ASP.NET en la carpeta `Membership`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="1ebc0-203">Para ello, es necesario agregar un archivo de `Web.config` a la carpeta de `Membership` y establecer su configuración de autorización para denegar a los usuarios anónimos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="1ebc0-204">Haga clic con el botón secundario en la carpeta `Membership` del Explorador de soluciones, elija el menú Agregar nuevo elemento en el menú contextual y agregue un nuevo archivo de configuración Web denominado `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>

<span data-ttu-id="1ebc0-205">[![agregar un archivo Web. config a la carpeta de pertenencia](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span></span>

<span data-ttu-id="1ebc0-206">**Figura 3**: agregar un archivo de `Web.config` a la carpeta `Membership` ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-vb/_static/image9.png))</span></span>

<span data-ttu-id="1ebc0-207">En este momento, el proyecto debe contener dos archivos de `Web.config`: uno en el directorio raíz y otro en la carpeta `Membership`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>

<span data-ttu-id="1ebc0-208">[![la aplicación ahora debe contener dos archivos Web. config](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span></span>

<span data-ttu-id="1ebc0-209">**Figura 4**: la aplicación ahora debe contener dos archivos de `Web.config` ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-vb/_static/image12.png))</span></span>

<span data-ttu-id="1ebc0-210">Actualice el archivo de configuración en la carpeta `Membership` para que prohíba el acceso a los usuarios anónimos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample4.xml)]

<span data-ttu-id="1ebc0-211">Así de simple.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-211">That's all there is to it!</span></span>

<span data-ttu-id="1ebc0-212">Para probar este cambio, visite la Página principal en un explorador y asegúrese de que ha cerrado la sesión. Dado que el comportamiento predeterminado de una aplicación ASP.NET es permitir a todos los visitantes, y como no realizamos ninguna modificación de autorización en el archivo `Web.config` del directorio raíz, podemos visitar los archivos del directorio raíz como visitante anónimo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="1ebc0-213">Haga clic en el vínculo crear cuentas de usuario que se encuentra en la columna izquierda.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="1ebc0-214">Esto le llevará a la `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="1ebc0-215">Puesto que el archivo de `Web.config` de la carpeta `Membership` define reglas de autorización para prohibir el acceso anónimo, el `UrlAuthorizationModule` anula la solicitud y devuelve un estado no autorizado HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="1ebc0-216">El `FormsAuthenticationModule` lo modifica en un estado de redireccionamiento 302 y lo envía a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="1ebc0-217">Tenga en cuenta que la página a la que intentamos acceder (`CreatingUserAccounts.aspx`) se pasa a la página de inicio de sesión a través del parámetro QueryString `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>

<span data-ttu-id="1ebc0-218">[![dado que las reglas de autorización de URL prohíben el acceso anónimo, se le redirigirá a la página de inicio de sesión.](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span></span>

<span data-ttu-id="1ebc0-219">**Figura 5**: dado que las reglas de autorización de URL prohíben el acceso anónimo, se le redirigirá a la página de inicio de sesión ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-vb/_static/image15.png))</span></span>

<span data-ttu-id="1ebc0-220">Tras iniciar sesión correctamente, se le redirigirá a la página `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="1ebc0-221">Esta vez, el `UrlAuthorizationModule` permite el acceso a la página porque ya no somos anónimos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="1ebc0-222">Aplicar reglas de autorización de URL a una ubicación específica</span><span class="sxs-lookup"><span data-stu-id="1ebc0-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="1ebc0-223">Los valores de autorización definidos en la sección `<system.web>` de `Web.config` se aplican a todos los recursos de ASP.NET de ese directorio y sus subdirectorios (hasta que otro archivo de `Web.config` invalida de otro modo).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="1ebc0-224">Sin embargo, en algunos casos, es posible que quiera que todos los recursos de ASP.NET de un directorio determinado tengan una configuración de autorización determinada, excepto para una o dos páginas específicas.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="1ebc0-225">Esto puede lograrse agregando un elemento de `<location>` en `Web.config`, apuntando al archivo cuyas reglas de autorización difieren y definiendo las reglas de autorización únicas que contiene.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="1ebc0-226">Para ilustrar el uso del elemento `<location>` para invalidar la configuración de un recurso específico, vamos a personalizar la configuración de autorización para que solo Tito pueda visitar `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="1ebc0-227">Para ello, agregue un elemento `<location>` al archivo `Web.config` de la carpeta de `Membership` y actualice su marcado para que tenga el aspecto siguiente:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample5.xml)]

<span data-ttu-id="1ebc0-228">El elemento `<authorization>` de `<system.web>` define las reglas de autorización de direcciones URL predeterminadas para los recursos de ASP.NET en la carpeta `Membership` y sus subcarpetas.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="1ebc0-229">El elemento `<location>` nos permite invalidar estas reglas para un recurso determinado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="1ebc0-230">En el marcado anterior, el elemento `<location>` hace referencia a la página `CreatingUserAccounts.aspx` y especifica sus reglas de autorización, como permitir Tito, pero denegar a todos los demás.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="1ebc0-231">Para probar este cambio de autorización, empiece por visitar el sitio web como usuario anónimo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="1ebc0-232">Si intenta visitar cualquier página de la carpeta `Membership`, como `UserBasedAuthorization.aspx`, el `UrlAuthorizationModule` denegará la solicitud y se le redirigirá a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="1ebc0-233">Después de iniciar sesión como, por ejemplo, Scott, puede visitar cualquier página de la carpeta `Membership`, *excepto* `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="1ebc0-234">Si intenta visitar `CreatingUserAccounts.aspx` sesión iniciada como cualquiera pero Tito, se producirá un intento de acceso no autorizado y se le redirigirá a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="1ebc0-235">El elemento `<location>` debe aparecer fuera del elemento `<system.web>` de la configuración.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="1ebc0-236">Debe usar un elemento de `<location>` independiente para cada recurso cuya configuración de autorización desea reemplazar.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>

### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="1ebc0-237">Un vistazo a cómo el`UrlAuthorizationModule`utiliza las reglas de autorización para conceder o denegar el acceso</span><span class="sxs-lookup"><span data-stu-id="1ebc0-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="1ebc0-238">El `UrlAuthorizationModule` determina si se va a autorizar una identidad determinada para una dirección URL determinada mediante el análisis de las reglas de autorización de dirección URL de una en una, empezando por la primera y trabajando hasta el final.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="1ebc0-239">En cuanto se encuentra una coincidencia, se concede o se deniega el acceso al usuario, en función de si se encontró la coincidencia en un elemento `<allow>` o `<deny>`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="1ebc0-240"><strong>Si no se encuentra ninguna coincidencia, se concede al usuario acceso.</strong></span><span class="sxs-lookup"><span data-stu-id="1ebc0-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="1ebc0-241">Por consiguiente, si desea restringir el acceso, es imperativo que use un elemento `<deny>` como el último elemento en la configuración de autorización de la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="1ebc0-242"><strong>Si omite un</strong> <strong>elemento`<deny>`, se concederá acceso a todos los usuarios.</strong></span><span class="sxs-lookup"><span data-stu-id="1ebc0-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="1ebc0-243">Para entender mejor el proceso utilizado por el `UrlAuthorizationModule` para determinar la autoridad, tenga en cuenta las reglas de autorización de URL de ejemplo que hemos visto anteriormente en este paso.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="1ebc0-244">La primera regla es un elemento `<allow>` que permite el acceso a Tito y a Scott.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="1ebc0-245">La segunda regla es un elemento `<deny>` que deniega el acceso a todos los usuarios.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="1ebc0-246">Si un usuario anónimo visita, el `UrlAuthorizationModule` empieza por preguntar, ¿es anónimo Scott o Tito?</span><span class="sxs-lookup"><span data-stu-id="1ebc0-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="1ebc0-247">Obviamente, la respuesta es no, por lo que pasa a la segunda regla.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="1ebc0-248">¿Es anónimo en el conjunto de todos?</span><span class="sxs-lookup"><span data-stu-id="1ebc0-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="1ebc0-249">Como la respuesta aquí es sí, la regla de `<deny>` se aplica y el visitante se redirige a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="1ebc0-250">Del mismo modo, si Jisun está visitando, el `UrlAuthorizationModule` empieza por preguntar, ¿Jisun Scott o Tito?</span><span class="sxs-lookup"><span data-stu-id="1ebc0-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="1ebc0-251">Como no es así, el `UrlAuthorizationModule` continúa con la segunda pregunta, ¿está Jisun en el conjunto de todos?</span><span class="sxs-lookup"><span data-stu-id="1ebc0-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="1ebc0-252">También se le deniega el acceso a ella.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="1ebc0-253">Por último, si Tito visita, la primera pregunta planteada por el `UrlAuthorizationModule` es una respuesta afirmativa, de modo que se concede el acceso a Tito.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="1ebc0-254">Dado que el `UrlAuthorizationModule` procesa las reglas de autorización de arriba abajo y se detiene en cualquier coincidencia, es importante tener las reglas más específicas antes que las menos específicas.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="1ebc0-255">Es decir, para definir reglas de autorización que prohíban a los usuarios de Jisun y anónimos, pero que permitan a todos los demás usuarios autenticados, comenzaría con la regla más específica (la que afectó a Jisun) y, a continuación, continuaría con las reglas menos específicas, que permitían todas las demás usuarios autenticados, pero denegar a todos los usuarios anónimos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="1ebc0-256">Las siguientes reglas de autorización de dirección URL implementan esta directiva denegando primero Jisun y denegando después cualquier usuario anónimo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="1ebc0-257">Se concederá acceso a cualquier usuario autenticado que no sea JISUN, ya que ninguna de estas instrucciones `<deny>` coincidirá.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="1ebc0-258">Paso 2: corregir el flujo de trabajo de usuarios autenticados y no autorizados</span><span class="sxs-lookup"><span data-stu-id="1ebc0-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="1ebc0-259">Como se explicó anteriormente en este tutorial, en la sección un vistazo al flujo de trabajo de autorización de URL, cada vez que se transcurrió una solicitud no autorizada, la `UrlAuthorizationModule` anula la solicitud y devuelve un estado no autorizado HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="1ebc0-260">El estado 401 lo modifica el `FormsAuthenticationModule` en un estado de redirección de 302 que envía al usuario a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="1ebc0-261">Este flujo de trabajo se produce en cualquier solicitud no autorizada, incluso si el usuario está autenticado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="1ebc0-262">Es probable que la devolución de un usuario autenticado a la página de inicio de sesión se confunda, ya que ya han iniciado sesión en el sistema.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="1ebc0-263">Con un poco de trabajo, podemos mejorar este flujo de trabajo redirigiendo a los usuarios autenticados que realizan solicitudes no autorizadas a una página en la que se explica que han intentado tener acceso a una página restringida.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="1ebc0-264">Empiece por crear una nueva página de ASP.NET en la carpeta raíz de la aplicación web denominada `UnauthorizedAccess.aspx`; no olvide asociar esta página con la página maestra de `Site.master`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="1ebc0-265">Después de crear esta página, quite el control de contenido que hace referencia a la `LoginContent` ContentPlaceHolder para que se muestre el contenido predeterminado de la página maestra.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="1ebc0-266">Después, agregue un mensaje que explique la situación, es decir, que el usuario intentó tener acceso a un recurso protegido.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="1ebc0-267">Después de agregar este tipo de mensaje, el marcado declarativo de la página `UnauthorizedAccess.aspx` debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample7.aspx)]

<span data-ttu-id="1ebc0-268">Ahora es necesario modificar el flujo de trabajo para que, si un usuario autenticado realiza una solicitud no autorizada, se envíe a la página `UnauthorizedAccess.aspx` en lugar de a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="1ebc0-269">La lógica que redirige las solicitudes no autorizadas a la página de inicio de sesión está oculta dentro de un método privado de la clase `FormsAuthenticationModule`, por lo que no se puede personalizar este comportamiento.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="1ebc0-270">Sin embargo, lo que podemos hacer es agregar nuestra propia lógica a la página de inicio de sesión que redirige al usuario a `UnauthorizedAccess.aspx`, si es necesario.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="1ebc0-271">Cuando el `FormsAuthenticationModule` redirige un visitante no autorizado a la página de inicio de sesión, anexa la dirección URL solicitada y no autorizada a la cadena de entrada con el nombre `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="1ebc0-272">Por ejemplo, si un usuario no autorizado intenta visitar `OnlyTito.aspx`, el `FormsAuthenticationModule` los redirigirá a `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="1ebc0-273">Por lo tanto, si un usuario autenticado obtiene acceso a la página de inicio de sesión con una cadena de consulta que incluye el parámetro `ReturnUrl`, sabemos que este usuario no autenticado acaba de intentar visitar una página que no está autorizado a ver.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="1ebc0-274">En tal caso, queremos redirigirlo a `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="1ebc0-275">Para ello, agregue el código siguiente al controlador de eventos `Page_Load` de la página de inicio de sesión:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample8.vb)]

<span data-ttu-id="1ebc0-276">En el código anterior se redirige a los usuarios autenticados y no autorizados a la página `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="1ebc0-277">Para ver esta lógica en acción, visite el sitio como visitante anónimo y haga clic en el vínculo crear cuentas de usuario en la columna izquierda.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="1ebc0-278">Esto le llevará a la página `~/Membership/CreatingUserAccounts.aspx`, que en el paso 1 se configuró para permitir solo el acceso a Tito.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="1ebc0-279">Dado que los usuarios anónimos están prohibidos, el `FormsAuthenticationModule` redirige US de nuevo a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="1ebc0-280">En este momento, somos anónimos, por lo que `Request.IsAuthenticated` devuelve `False` y no se le redirigirá a `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `False` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="1ebc0-281">En su lugar, se muestra la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="1ebc0-282">Inicie sesión como un usuario que no sea Tito, como Bruce.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="1ebc0-283">Después de escribir las credenciales adecuadas, la página de inicio de sesión redirigirá a `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="1ebc0-284">Sin embargo, dado que esta página solo es accesible para Tito, no se autoriza para verla y se devuelve rápidamente a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="1ebc0-285">Sin embargo, esta vez `Request.IsAuthenticated` devuelve `True` (y el parámetro `ReturnUrl` QueryString existe), por lo que se le redirigirá a la página de `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-285">This time, however, `Request.IsAuthenticated` returns `True` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>

<span data-ttu-id="1ebc0-286">[![autenticado, los usuarios no autorizados se redirigen a UnauthorizedAccess. aspx.](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span></span>

<span data-ttu-id="1ebc0-287">**Figura 6**: los usuarios autenticados y no autorizados se redirigen a `UnauthorizedAccess.aspx` ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-vb/_static/image18.png))</span></span>

<span data-ttu-id="1ebc0-288">Este flujo de trabajo personalizado presenta una experiencia de usuario más sensata y sencilla al cortocircuitar el ciclo representado en la figura 2.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="1ebc0-289">Paso 3: limitar la funcionalidad basada en el usuario que ha iniciado sesión actualmente</span><span class="sxs-lookup"><span data-stu-id="1ebc0-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="1ebc0-290">La autorización de URL facilita la especificación de reglas de autorización generales.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="1ebc0-291">Como vimos en el paso 1, con la autorización de dirección URL podemos indicar brevemente qué identidades se permiten y cuáles se deniegan para ver una página determinada o todas las páginas de una carpeta.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="1ebc0-292">Sin embargo, en algunos escenarios, es posible que desee permitir que todos los usuarios visiten una página, pero limiten la funcionalidad de la página en función del usuario que la visite.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="1ebc0-293">Considere el caso de un sitio web de comercio electrónico que permita a los visitantes autenticados revisar sus productos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="1ebc0-294">Cuando un usuario anónimo visita la página de un producto, verá solo la información del producto y no se le ofrecerá la oportunidad de salir de una revisión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="1ebc0-295">Sin embargo, un usuario autenticado que visita la misma página verá la interfaz de revisión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="1ebc0-296">Si el usuario autenticado todavía no ha revisado este producto, la interfaz les permitiría enviar una revisión; de lo contrario, se mostrarán las revisiones enviadas previamente.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="1ebc0-297">Para llevar a cabo este escenario un paso más, la página del producto podría mostrar información adicional y ofrecer características ampliadas para los usuarios que trabajan para la empresa de comercio electrónico.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="1ebc0-298">Por ejemplo, la página del producto podría mostrar el inventario en existencias e incluir opciones para editar el precio y la descripción del producto cuando lo visite un empleado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="1ebc0-299">Estas reglas de autorización detalladas se pueden implementar de forma declarativa o mediante programación (o a través de alguna combinación de los dos).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="1ebc0-300">En la sección siguiente, veremos cómo implementar la autorización específica a través del control LoginView.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="1ebc0-301">A continuación, exploraremos las técnicas de programación.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="1ebc0-302">Sin embargo, antes de que podamos ver cómo aplicar reglas de autorización detalladas, primero debemos crear una página cuya funcionalidad depende del usuario que la visita.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="1ebc0-303">Vamos a crear una página que muestra los archivos de un directorio determinado dentro de un control GridView.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="1ebc0-304">Además de mostrar el nombre, el tamaño y otra información de cada archivo, GridView incluirá dos columnas de LinkButtons: una denominada vista y otra titulada eliminar.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="1ebc0-305">Si se hace clic en la vista de LinkButton, se mostrará el contenido del archivo seleccionado; Si se hace clic en la eliminación de LinkButton, se eliminará el archivo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="1ebc0-306">Vamos a crear inicialmente esta página de forma que su funcionalidad de vista y eliminación esté disponible para todos los usuarios.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="1ebc0-307">En el uso del control LoginView y la limitación mediante programación de las secciones de funcionalidad, veremos cómo habilitar o deshabilitar estas características en función del usuario que visita la página.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="1ebc0-308">La página ASP.NET que se va a compilar usa un control GridView para mostrar una lista de archivos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="1ebc0-309">Dado que esta serie de tutoriales se centra en la autenticación de formularios, la autorización, las cuentas de usuario y los roles, no deseo gastar demasiado tiempo en hablar sobre el funcionamiento interno del control GridView.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="1ebc0-310">Aunque en este tutorial se proporcionan instrucciones paso a paso específicas para configurar esta página, no profundiza en los detalles del motivo por el que se realizaron ciertas opciones o el efecto que tienen determinadas propiedades en la salida representada.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="1ebc0-311">Para un examen exhaustivo del control GridView, consulte mi *[trabajo con datos en la serie de tutoriales de ASP.NET 2,0](../../data-access/index.md)* .</span><span class="sxs-lookup"><span data-stu-id="1ebc0-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="1ebc0-312">Comience abriendo el archivo `UserBasedAuthorization.aspx` en la carpeta `Membership` y agregando un control GridView a la página denominada `FilesGrid`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="1ebc0-313">En la etiqueta inteligente de GridView, haga clic en el vínculo editar columnas para abrir el cuadro de diálogo campos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="1ebc0-314">Desde aquí, desactive la casilla generar automáticamente campos en la esquina inferior izquierda.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="1ebc0-315">Después, agregue un botón seleccionar, un botón eliminar y dos BoundFields desde la esquina superior izquierda (los botones seleccionar y eliminar se pueden encontrar en el tipo CommandField).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="1ebc0-316">Establezca la propiedad `SelectText` del botón seleccionar en ver y las propiedades `HeaderText` y `DataField` del primer BoundField en Name.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="1ebc0-317">Establezca la propiedad `HeaderText` de la segunda BoundField en size en bytes, su propiedad `DataField` en length, su propiedad `DataFormatString` en {0:N0} y su propiedad `HtmlEncode` en false.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="1ebc0-318">Después de configurar las columnas de GridView, haga clic en Aceptar para cerrar el cuadro de diálogo campos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="1ebc0-319">En el ventana Propiedades, establezca la propiedad `DataKeyNames` de GridView en `FullName`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="1ebc0-320">En este momento, el marcado declarativo de GridView debería tener un aspecto similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample9.aspx)]

<span data-ttu-id="1ebc0-321">Con el marcado de GridView creado, estamos preparados para escribir el código que recuperará los archivos en un directorio determinado y enlazarlos a GridView.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="1ebc0-322">Agregue el código siguiente al controlador de eventos de `Page_Load` de la página:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample10.vb)]

<span data-ttu-id="1ebc0-323">En el código anterior se usa la [clase`DirectoryInfo`](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) para obtener una lista de los archivos de la carpeta raíz de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="1ebc0-324">El [método`GetFiles()`](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) devuelve todos los archivos del directorio como una matriz de [objetos`FileInfo`](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), que después se enlaza a GridView.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="1ebc0-325">El objeto `FileInfo` tiene una serie de propiedades, como `Name`, `Length`y `IsReadOnly`, entre otras.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="1ebc0-326">Como puede ver en su marcado declarativo, GridView muestra solo las propiedades `Name` y `Length`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="1ebc0-327">Las clases `DirectoryInfo` y `FileInfo` se encuentran en el [espacio de nombres`System.IO`](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="1ebc0-328">Por lo tanto, tendrá que anteponer estos nombres de clase con sus nombres de espacio de nombres o tener el espacio de nombres importado en el archivo de clase (a través de `Imports System.IO`).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `Imports System.IO`).</span></span>

<span data-ttu-id="1ebc0-329">Dedique un momento a visitar esta página a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="1ebc0-330">Se mostrará la lista de archivos que residen en el directorio raíz de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="1ebc0-331">Al hacer clic en cualquiera de las LinkButtons de vista o de eliminación, se producirá un postback, pero no se producirá ninguna acción porque todavía se han creado los controladores de eventos necesarios.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>

<span data-ttu-id="1ebc0-332">[![GridView muestra los archivos en el directorio raíz de la aplicación Web](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span></span>

<span data-ttu-id="1ebc0-333">**Figura 7**: el control GridView muestra los archivos en el directorio raíz de la aplicación web ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-vb/_static/image21.png))</span></span>

<span data-ttu-id="1ebc0-334">Necesitamos un medio para mostrar el contenido del archivo seleccionado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="1ebc0-335">Vuelva a Visual Studio y agregue un cuadro de texto denominado `FileContents` sobre GridView.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="1ebc0-336">Establezca su propiedad `TextMode` en `MultiLine` y sus propiedades `Columns` y `Rows` en 95% y 10, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample11.aspx)]

<span data-ttu-id="1ebc0-337">A continuación, cree un controlador de eventos para el [evento de`SelectedIndexChanged`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) de GridView y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample12.vb)]

<span data-ttu-id="1ebc0-338">Este código usa la propiedad `SelectedValue` de GridView para determinar el nombre de archivo completo del archivo seleccionado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="1ebc0-339">Internamente, se hace referencia a la colección de `DataKeys` para obtener el `SelectedValue`, por lo que es imperativo establecer la propiedad `DataKeyNames` de GridView en Name, como se describió anteriormente en este paso.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="1ebc0-340">La [clase`File`](https://msdn.microsoft.com/library/system.io.file.aspx) se utiliza para leer el contenido del archivo seleccionado en una cadena, que se asigna a la propiedad `Text` del cuadro de `FileContents`, con lo que se muestra el contenido del archivo seleccionado en la página.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>

<span data-ttu-id="1ebc0-341">[![el contenido del archivo seleccionado se muestra en el cuadro de texto](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span></span>

<span data-ttu-id="1ebc0-342">**Figura 8**: el contenido del archivo seleccionado se muestra en el cuadro de texto ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-vb/_static/image24.png))</span></span>

> [!NOTE]
> <span data-ttu-id="1ebc0-343">Si ve el contenido de un archivo que contiene marcado HTML y, a continuación, intenta ver o eliminar un archivo, recibirá un error de `HttpRequestValidationException`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="1ebc0-344">Esto se debe a que, en el postback, el contenido del cuadro de texto se envía de vuelta al servidor Web.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="1ebc0-345">De forma predeterminada, ASP.NET genera un error `HttpRequestValidationException` cada vez que se detecta contenido de postback potencialmente peligroso, como el marcado HTML.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="1ebc0-346">Para impedir que se produzca este error, desactive la validación de solicitudes de la página agregando `ValidateRequest="false"` a la Directiva `@Page`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="1ebc0-347">Para obtener más información sobre las ventajas de la validación de solicitudes, así como sobre las precauciones que debe tomar al deshabilitarla, consulte [validación de solicitudes de lectura: prevención de ataques de scripts](https://asp.net/learn/whitepapers/request-validation/).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>

<span data-ttu-id="1ebc0-348">Por último, agregue un controlador de eventos con el siguiente código para el [evento`RowDeleting`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx)de GridView:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample13.vb)]

<span data-ttu-id="1ebc0-349">El código simplemente muestra el nombre completo del archivo que se va a eliminar en el cuadro de texto `FileContents` *sin* eliminar realmente el archivo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>

<span data-ttu-id="1ebc0-350">[![hacer clic en el botón eliminar no elimina realmente el archivo](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span></span>

<span data-ttu-id="1ebc0-351">**Figura 9**: al hacer clic en el botón eliminar, realmente no se elimina el archivo ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-vb/_static/image27.png))</span></span>

<span data-ttu-id="1ebc0-352">En el paso 1, se han configurado las reglas de autorización de URL para impedir que los usuarios anónimos vean las páginas de la carpeta `Membership`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="1ebc0-353">Con el fin de mejorar la autenticación precisa, vamos a permitir a los usuarios anónimos visitar la página `UserBasedAuthorization.aspx`, pero con una funcionalidad limitada.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="1ebc0-354">Para abrir esta página hasta que todos los usuarios puedan tener acceso a ella, agregue el siguiente elemento de `<location>` al archivo de `Web.config` en la carpeta `Membership`:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample14.xml)]

<span data-ttu-id="1ebc0-355">Después de agregar este elemento de `<location>`, pruebe las nuevas reglas de autorización de URL cerrando el sitio.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="1ebc0-356">Como usuario anónimo, debe tener permiso para visitar la página `UserBasedAuthorization.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="1ebc0-357">Actualmente, cualquier usuario autenticado o anónimo puede visitar la página `UserBasedAuthorization.aspx` y ver o eliminar archivos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="1ebc0-358">Vamos a hacerlo para que solo los usuarios autenticados puedan ver el contenido de un archivo y solo Tito puedan eliminar un archivo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="1ebc0-359">Estas reglas de autorización específicas se pueden aplicar mediante declaración, mediante programación o a través de una combinación de ambos métodos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="1ebc0-360">Vamos a usar el enfoque declarativo para limitar quién puede ver el contenido de un archivo. usaremos el enfoque de programación para limitar quién puede eliminar un archivo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="1ebc0-361">Usar el control LoginView</span><span class="sxs-lookup"><span data-stu-id="1ebc0-361">Using the LoginView Control</span></span>

<span data-ttu-id="1ebc0-362">Como hemos visto en los tutoriales anteriores, el control LoginView es útil para mostrar diferentes interfaces para usuarios autenticados y anónimos, y ofrece una manera sencilla de ocultar funciones que no son accesibles para los usuarios anónimos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="1ebc0-363">Puesto que los usuarios anónimos no pueden ver ni eliminar archivos, solo es necesario mostrar el cuadro de texto `FileContents` cuando un usuario autenticado visita la página.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="1ebc0-364">Para ello, agregue un control LoginView a la página, asígnele el nombre `LoginViewForFileContentsTextBox`y mueva el marcado declarativo del cuadro de texto `FileContents` al `LoggedInTemplate`del control LoginView.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample15.aspx)]

<span data-ttu-id="1ebc0-365">Los controles Web de las plantillas de LoginView ya no son accesibles directamente desde la clase de código subyacente.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="1ebc0-366">Por ejemplo, la `FilesGrid` los controladores de eventos `SelectedIndexChanged` y `RowDeleting` de GridView hacen referencia actualmente al control TextBox `FileContents` con código como el siguiente:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample16.aspx)]

<span data-ttu-id="1ebc0-367">Sin embargo, este código ya no es válido.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-367">However, this code is no longer valid.</span></span> <span data-ttu-id="1ebc0-368">Al mover el cuadro de texto `FileContents` al `LoggedInTemplate` no se puede tener acceso directamente al cuadro de texto.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="1ebc0-369">En su lugar, se debe usar el método `FindControl("controlId")` para hacer referencia al control mediante programación.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="1ebc0-370">Actualice los controladores de eventos `FilesGrid` para hacer referencia al cuadro de texto de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample17.vb)]

<span data-ttu-id="1ebc0-371">Después de mover el cuadro de texto a la `LoggedInTemplate` de LoginView y actualizar el código de la página para hacer referencia al cuadro de texto mediante el patrón de `FindControl("controlId")`, visite la página como un usuario anónimo.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="1ebc0-372">Como se muestra en la figura 10, no se muestra el cuadro de texto `FileContents`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="1ebc0-373">Sin embargo, se sigue mostrando la vista LinkButton.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-373">However, the View LinkButton is still displayed.</span></span>

<span data-ttu-id="1ebc0-374">[![el control LoginView solo representa el cuadro de texto FileContents para los usuarios autenticados](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span></span>

<span data-ttu-id="1ebc0-375">**Figura 10**: el control LoginView solo representa el cuadro de texto `FileContents` para los usuarios autenticados ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-vb/_static/image30.png))</span></span>

<span data-ttu-id="1ebc0-376">Una manera de ocultar el botón ver para los usuarios anónimos es convertir el campo GridView en TemplateField.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="1ebc0-377">Se generará una plantilla que contiene el marcado declarativo para la vista LinkButton.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="1ebc0-378">A continuación, podemos agregar un control LoginView a TemplateField y colocar el control LinkButton en el `LoggedInTemplate`de LoginView, ocultando así el botón ver de los visitantes anónimos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="1ebc0-379">Para ello, haga clic en el vínculo editar columnas de la etiqueta inteligente de GridView para abrir el cuadro de diálogo campos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="1ebc0-380">A continuación, seleccione el botón seleccionar de la lista en la esquina inferior izquierda y, a continuación, haga clic en el vínculo convertir este campo en un TemplateField.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="1ebc0-381">Al hacerlo, se modificará el marcado declarativo del campo desde:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample18.aspx)]

 <span data-ttu-id="1ebc0-382">A:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample19.aspx)]

 <span data-ttu-id="1ebc0-383">En este momento, podemos agregar un LoginView a TemplateField.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="1ebc0-384">El marcado siguiente muestra la vista LinkButton solo para los usuarios autenticados.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-384">The following markup displays the View LinkButton only for authenticated users.</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample20.aspx)]

<span data-ttu-id="1ebc0-385">Como se muestra en la figura 11, el resultado final no es que, al igual que la columna de vista, se sigue mostrando aunque se oculte la vista LinkButtons dentro de la columna.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="1ebc0-386">Veremos cómo ocultar la columna de GridView completa (y no solo el control LinkButton) en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>

<span data-ttu-id="1ebc0-387">[![el control LoginView oculta la vista LinkButtons para los visitantes anónimos](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span></span>

<span data-ttu-id="1ebc0-388">**Figura 11**: el control LoginView oculta la vista LinkButtons para los visitantes anónimos ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-vb/_static/image33.png))</span></span>

### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="1ebc0-389">Limitar la funcionalidad mediante programación</span><span class="sxs-lookup"><span data-stu-id="1ebc0-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="1ebc0-390">En algunas circunstancias, las técnicas declarativas no son suficientes para limitar la funcionalidad a una página.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="1ebc0-391">Por ejemplo, la disponibilidad de determinada funcionalidad de página puede depender de criterios que van más allá de si el usuario que visita la página es anónimo o autenticado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="1ebc0-392">En tales casos, los distintos elementos de la interfaz de usuario se pueden mostrar u ocultar a través de promedios mediante programación.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="1ebc0-393">Para limitar la funcionalidad mediante programación, es necesario realizar dos tareas:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="1ebc0-394">Determine si el usuario que visita la página puede acceder a la funcionalidad y</span><span class="sxs-lookup"><span data-stu-id="1ebc0-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="1ebc0-395">Modifique mediante programación la interfaz de usuario en función de si el usuario tiene acceso a la funcionalidad en cuestión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="1ebc0-396">Para mostrar la aplicación de estas dos tareas, vamos a permitir que Tito elimine archivos de GridView.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="1ebc0-397">La primera tarea, a continuación, es determinar si está Tito visitando la página.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="1ebc0-398">Una vez que se ha determinado, es necesario ocultar (o mostrar) la columna de eliminación de GridView.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="1ebc0-399">Se puede tener acceso a las columnas de GridView a través de su propiedad `Columns`; una columna solo se representa si su propiedad `Visible` está establecida en `True` (valor predeterminado).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `True` (the default).</span></span>

<span data-ttu-id="1ebc0-400">Agregue el código siguiente al controlador de eventos `Page_Load` antes de enlazar los datos a GridView:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample21.vb)]

<span data-ttu-id="1ebc0-401">Como se explicó en el tutorial [*de introducción a la autenticación de formularios*](../introduction/an-overview-of-forms-authentication-vb.md) , `User.Identity.Name` devuelve el nombre de la identidad.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="1ebc0-402">Esto corresponde al nombre de usuario especificado en el control de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="1ebc0-403">Si Tito visita la página, la propiedad `Visible` de la segunda columna de GridView está establecida en `True`; de lo contrario, se establece en `False`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `True`; otherwise, it is set to `False`.</span></span> <span data-ttu-id="1ebc0-404">El resultado neto es que cuando alguien que no sea Tito visita la página, ya sea otro usuario autenticado o un usuario anónimo, la columna eliminar no se representa (vea la figura 12). sin embargo, cuando Tito visita la página, la columna eliminar está presente (vea la figura 13).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>

<span data-ttu-id="1ebc0-405">[![la columna eliminar no se representará cuando la visiten otros usuarios que no sean Tito (como Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span></span>

<span data-ttu-id="1ebc0-406">**Figura 12**: la columna eliminar no se representa cuando la visita alguien que no sea Tito (por ejemplo, Bruce) ([haga clic para ver la imagen a tamaño completo](user-based-authorization-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-vb/_static/image36.png))</span></span>

<span data-ttu-id="1ebc0-407">[![se representa la columna delete para Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-407">[![The Delete Column is Rendered for Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span></span>

<span data-ttu-id="1ebc0-408">**Figura 13**: la columna Delete se representa para Tito ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-vb/_static/image39.png))</span></span>

## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="1ebc0-409">Paso 4: aplicar reglas de autorización a clases y métodos</span><span class="sxs-lookup"><span data-stu-id="1ebc0-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="1ebc0-410">En el paso 3, no permitimos que los usuarios anónimos puedan ver el contenido de un archivo y que todos los usuarios se Tito de eliminar archivos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="1ebc0-411">Esto se logra ocultando los elementos de la interfaz de usuario asociados a los visitantes no autorizados a través de técnicas declarativas y de programación.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="1ebc0-412">En nuestro sencillo ejemplo, la ocultación correcta de los elementos de la interfaz de usuario era sencilla, pero ¿qué ocurre con sitios más complejos en los que puede haber muchas formas diferentes de realizar la misma funcionalidad?</span><span class="sxs-lookup"><span data-stu-id="1ebc0-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="1ebc0-413">Al limitar esa funcionalidad a usuarios no autorizados, ¿qué ocurre si se olvida de ocultar o deshabilitar todos los elementos de la interfaz de usuario aplicables?</span><span class="sxs-lookup"><span data-stu-id="1ebc0-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="1ebc0-414">Una manera sencilla de asegurarse de que un usuario no autorizado no pueda acceder a una parte determinada de la funcionalidad es decorar esa clase o método con el [`PrincipalPermission` atributo](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="1ebc0-415">Cuando el tiempo de ejecución de .NET usa una clase o ejecuta uno de sus métodos, comprueba para asegurarse de que el contexto de seguridad actual tiene permiso para usar la clase o ejecutar el método.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="1ebc0-416">El atributo `PrincipalPermission` proporciona un mecanismo a través del cual se pueden definir estas reglas.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="1ebc0-417">Vamos a mostrar el uso del atributo `PrincipalPermission` en los controladores de eventos `SelectedIndexChanged` y `RowDeleting` de GridView para prohibir la ejecución por parte de usuarios anónimos y usuarios que no sean Tito, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="1ebc0-418">Lo único que debemos hacer es agregar el atributo adecuado sobre cada definición de función:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample22.vb)]

<span data-ttu-id="1ebc0-419">El atributo del controlador de eventos `SelectedIndexChanged` determina que solo los usuarios autenticados pueden ejecutar el controlador de eventos, donde como el atributo del controlador de eventos `RowDeleting` limita la ejecución a Tito.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

> [!NOTE]
> <span data-ttu-id="1ebc0-420">Un atributo se puede aplicar a una clase, método, propiedad o evento.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-420">An attribute can be applied to a class, method, property, or event.</span></span> <span data-ttu-id="1ebc0-421">Al agregar un atributo, debe formar parte de la instrucción de declaración de clase, método, propiedad o evento.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-421">When adding an attribute, it must be part of the class, method, property, or event declaration statement.</span></span> <span data-ttu-id="1ebc0-422">Como Visual Basic usa saltos de línea como delimitadores de instrucciones, los atributos deben aparecer en la misma línea que la declaración o directamente encima de él con un carácter de continuación de línea (el carácter de subrayado).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-422">Since Visual Basic uses line breaks as statement delimiters, attributes must either appear on the same line as the declaration or directly above it with a line continuation character (the underscore).</span></span> <span data-ttu-id="1ebc0-423">En el fragmento de código anterior, el carácter de continuación de línea se usa para colocar el atributo en una línea y la declaración del método en otro.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-423">In the code snippet above, the line continuation character is used to place the attribute on one line and the method declaration on another.</span></span>

<span data-ttu-id="1ebc0-424">Si, de algún modo, un usuario que no sea Tito intenta ejecutar el controlador de eventos `RowDeleting` o un usuario no autenticado intenta ejecutar el controlador de eventos `SelectedIndexChanged`, el tiempo de ejecución de .NET generará una `SecurityException`.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-424">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>

<span data-ttu-id="1ebc0-425">[![si el contexto de seguridad no está autorizado para ejecutar el método, se produce una excepción SecurityException](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-425">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span></span>

<span data-ttu-id="1ebc0-426">**Figura 14**: Si el contexto de seguridad no está autorizado para ejecutar el método, se produce una `SecurityException` ([haga clic para ver la imagen de tamaño completo](user-based-authorization-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="1ebc0-426">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-vb/_static/image42.png))</span></span>

> [!NOTE]
> <span data-ttu-id="1ebc0-427">Para permitir que varios contextos de seguridad tengan acceso a una clase o método, decore la clase o el método con un atributo `PrincipalPermission` para cada contexto de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-427">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="1ebc0-428">Es decir, para permitir que Tito y Bruce ejecuten el controlador de eventos `RowDeleting`, agregue *dos* atributos `PrincipalPermission`:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-428">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample23.vb)]

<span data-ttu-id="1ebc0-429">Además de las páginas de ASP.NET, muchas aplicaciones también tienen una arquitectura que incluye varias capas, como las capas de lógica de negocios y de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-429">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="1ebc0-430">Estas capas se implementan normalmente como bibliotecas de clases y ofrecen clases y métodos para realizar la lógica empresarial y la funcionalidad relacionada con los datos.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-430">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="1ebc0-431">El atributo `PrincipalPermission` es útil para aplicar reglas de autorización a estas capas.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-431">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="1ebc0-432">Para obtener más información sobre el uso del atributo `PrincipalPermission` para definir reglas de autorización en clases y métodos, consulte la entrada de blog de [Scott Guthrie](https://weblogs.asp.net/scottgu/)sobre cómo [agregar reglas de autorización a las capas de datos y empresariales mediante `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-432">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="1ebc0-433">Resumen</span><span class="sxs-lookup"><span data-stu-id="1ebc0-433">Summary</span></span>

<span data-ttu-id="1ebc0-434">En este tutorial, hemos examinado cómo aplicar reglas de autorización basadas en el usuario.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-434">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="1ebc0-435">Comenzamos con una mirada a ASP. Marco de autorización de dirección URL de la red.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-435">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="1ebc0-436">En cada solicitud, el `UrlAuthorizationModule` del motor de ASP.NET inspecciona las reglas de autorización de URL definidas en la configuración de la aplicación para determinar si la identidad está autorizada para tener acceso al recurso solicitado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-436">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="1ebc0-437">En Resumen, la autorización de direcciones URL facilita la especificación de reglas de autorización para una página específica o para todas las páginas de un directorio determinado.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-437">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="1ebc0-438">El marco de autorización de URL aplica las reglas de autorización cada página.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-438">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="1ebc0-439">Con la autorización de URL, la identidad solicitante está autorizada para tener acceso a un recurso determinado o no.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-439">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="1ebc0-440">Sin embargo, muchos escenarios llaman a para las reglas de autorización más granulares.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-440">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="1ebc0-441">En lugar de definir quién tiene permiso para acceder a una página, es posible que necesitemos permitir que todos tengan acceso a una página, pero para Mostrar datos diferentes o para ofrecer una funcionalidad diferente en función del usuario que visita la página.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-441">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="1ebc0-442">La autorización en el nivel de página normalmente implica Ocultar elementos específicos de la interfaz de usuario para evitar que usuarios no autorizados tengan acceso a la funcionalidad prohibida.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-442">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="1ebc0-443">Además, es posible utilizar atributos para restringir el acceso a las clases y la ejecución de sus métodos para determinados usuarios.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-443">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="1ebc0-444">¡ Feliz programación!</span><span class="sxs-lookup"><span data-stu-id="1ebc0-444">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="1ebc0-445">Información adicional</span><span class="sxs-lookup"><span data-stu-id="1ebc0-445">Further Reading</span></span>

<span data-ttu-id="1ebc0-446">Para obtener más información sobre los temas descritos en este tutorial, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="1ebc0-446">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="1ebc0-447">Adición de reglas de autorización a las capas de negocio y de datos con `PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="1ebc0-447">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="1ebc0-448">Autorización de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="1ebc0-448">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="1ebc0-449">Cambios entre la seguridad de IIS6 y IIS7</span><span class="sxs-lookup"><span data-stu-id="1ebc0-449">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="1ebc0-450">Configuración de archivos y subdirectorios específicos</span><span class="sxs-lookup"><span data-stu-id="1ebc0-450">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="1ebc0-451">Limitar la funcionalidad de modificación de datos basada en el usuario</span><span class="sxs-lookup"><span data-stu-id="1ebc0-451">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb.md)
- [<span data-ttu-id="1ebc0-452">Inicios rápidos del control LoginView</span><span class="sxs-lookup"><span data-stu-id="1ebc0-452">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="1ebc0-453">Descripción de la autorización de URL de IIS7</span><span class="sxs-lookup"><span data-stu-id="1ebc0-453">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="1ebc0-454">`UrlAuthorizationModule` documentación técnica</span><span class="sxs-lookup"><span data-stu-id="1ebc0-454">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="1ebc0-455">Trabajar con datos en ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="1ebc0-455">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="1ebc0-456">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="1ebc0-456">About the Author</span></span>

<span data-ttu-id="1ebc0-457">Scott Mitchell, autor de varios libros de ASP/ASP. NET y fundador de 4GuysFromRolla.com, ha estado trabajando con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-457">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="1ebc0-458">Scott funciona como consultor, profesor y redactor independiente.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-458">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="1ebc0-459">Su último libro se *[enseña a ASP.NET 2,0 en 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="1ebc0-459">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="1ebc0-460">Se puede acceder a Scott en [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) o a través de su blog en [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-460">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="1ebc0-461">Agradecimiento especial a</span><span class="sxs-lookup"><span data-stu-id="1ebc0-461">Special Thanks To</span></span>

<span data-ttu-id="1ebc0-462">Muchos revisores útiles revisaron esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="1ebc0-462">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="1ebc0-463">¿Está interesado en revisar los próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="1ebc0-463">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="1ebc0-464">En caso afirmativo, suéltelo en [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="1ebc0-464">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1ebc0-465">[Anterior](validating-user-credentials-against-the-membership-user-store-vb.md)
> [Siguiente](storing-additional-user-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="1ebc0-465">[Previous](validating-user-credentials-against-the-membership-user-store-vb.md)
[Next](storing-additional-user-information-vb.md)</span></span>
