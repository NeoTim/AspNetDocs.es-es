---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: Crear una aplicación de formularios Web Forms ASP.NET segura con el registro de usuario, por correo electrónico de confirmación y restablecimiento de contraseña (C#) | Microsoft Docs
author: Erikre
description: Este tutorial muestra cómo compilar una aplicación de formularios Web Forms ASP.NET con registro de usuario, confirmación por correo electrónico y restablecimiento de contraseña mediante el miembro de la identidad de ASP.NET...
ms.author: riande
ms.date: 10/02/2014
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: 3df728891103de9c8e461ab9507237c9b14e8251
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/17/2019
ms.locfileid: "59390693"
---
# <a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="e02f2-103">Crear una aplicación segura de formularios Web Forms de ASP.NET con registro de usuario, confirmación por correo electrónico y restablecimiento de contraseña (C#)</span><span class="sxs-lookup"><span data-stu-id="e02f2-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="e02f2-104">por [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="e02f2-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="e02f2-105">Este tutorial muestra cómo compilar una aplicación de formularios Web Forms ASP.NET con registro de usuario, confirmación por correo electrónico y restablecimiento de contraseña mediante el sistema de pertenencia de ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="e02f2-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="e02f2-106">Este tutorial se basa en de Rick Anderson [tutorial de MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="e02f2-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>


## <a name="introduction"></a><span data-ttu-id="e02f2-107">Introducción</span><span class="sxs-lookup"><span data-stu-id="e02f2-107">Introduction</span></span>

<span data-ttu-id="e02f2-108">Este tutorial le guiará por los pasos necesarios para crear una aplicación de formularios Web Forms de ASP.NET con Visual Studio y ASP.NET 4.5 para crear una aplicación de formularios Web con el registro de usuario, correo electrónico de confirmación y restablecimiento de contraseña.</span><span class="sxs-lookup"><span data-stu-id="e02f2-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="e02f2-109">Tareas del tutorial y obtener información:</span><span class="sxs-lookup"><span data-stu-id="e02f2-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="e02f2-110">Crear una ASP.NET Web Forms app</span><span class="sxs-lookup"><span data-stu-id="e02f2-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="e02f2-111">Enlazar SendGrid</span><span class="sxs-lookup"><span data-stu-id="e02f2-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="e02f2-112">Requerir confirmación por correo electrónico antes del inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="e02f2-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="e02f2-113">Restablecimiento y recuperación de contraseñas</span><span class="sxs-lookup"><span data-stu-id="e02f2-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="e02f2-114">Vínculo de confirmación de correo electrónico de reenvío</span><span class="sxs-lookup"><span data-stu-id="e02f2-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="e02f2-115">Solución de problemas de la aplicación</span><span class="sxs-lookup"><span data-stu-id="e02f2-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="e02f2-116">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="e02f2-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="e02f2-117">Crear una aplicación de ASP.NET Web Forms</span><span class="sxs-lookup"><span data-stu-id="e02f2-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="e02f2-118">Comience por instalar y ejecutar [Visual Studio Express 2013 para Web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="e02f2-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="e02f2-119">Instalar [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) o versiones posteriores también.</span><span class="sxs-lookup"><span data-stu-id="e02f2-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="e02f2-120">Advertencia: Debe instalar [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) o superior para completar este tutorial.</span><span class="sxs-lookup"><span data-stu-id="e02f2-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>


1. <span data-ttu-id="e02f2-121">Cree un nuevo proyecto (**archivo**  - &gt; **nuevo proyecto**) y seleccione el **aplicación Web ASP.NET** plantilla y la versión más reciente de .NET Framework versión de la **nuevo proyecto** cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="e02f2-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="e02f2-122">Desde el **nuevo proyecto ASP.NET** cuadro de diálogo, seleccione el **formularios Web Forms** plantilla.</span><span class="sxs-lookup"><span data-stu-id="e02f2-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="e02f2-123">Deje la autenticación predeterminada como **cuentas de usuario individuales**.</span><span class="sxs-lookup"><span data-stu-id="e02f2-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="e02f2-124">Si desea hospedar la aplicación en Azure, deje el **Host en la nube** activada la casilla de verificación.</span><span class="sxs-lookup"><span data-stu-id="e02f2-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="e02f2-125">A continuación, haga clic en **Aceptar** para crear el nuevo proyecto.</span><span class="sxs-lookup"><span data-stu-id="e02f2-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="e02f2-126">![Cuadro de diálogo nuevo proyecto de ASP.NET](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e02f2-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="e02f2-127">Habilitar capa de Sockets seguros (SSL) para el proyecto.</span><span class="sxs-lookup"><span data-stu-id="e02f2-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="e02f2-128">Siga los pasos descritos en la **habilitar SSL para el proyecto** sección de la [Introducción a serie de tutoriales de formularios Web Forms](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="e02f2-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="e02f2-129">Ejecute la aplicación, haga clic en el **registrar** vincular y registrar un nuevo usuario.</span><span class="sxs-lookup"><span data-stu-id="e02f2-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="e02f2-130">En este momento, la única validación en el correo electrónico se basa en el [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) atributo para asegurarse de que la dirección de correo electrónico está bien formada.</span><span class="sxs-lookup"><span data-stu-id="e02f2-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="e02f2-131">Modificará el código para agregar la confirmación por correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="e02f2-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="e02f2-132">Cierre la ventana del explorador.</span><span class="sxs-lookup"><span data-stu-id="e02f2-132">Close the browser window.</span></span>
5. <span data-ttu-id="e02f2-133">En **Explorador de servidores** de Visual Studio (**vista**  - &gt; **Explorador de servidores**), vaya a **Connections\ de datos DefaultConnection\Tables\AspNetUsers**, haga clic y seleccione **Abrir definición de tabla**.</span><span class="sxs-lookup"><span data-stu-id="e02f2-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="e02f2-134">La siguiente imagen muestra la `AspNetUsers` esquema de tabla:</span><span class="sxs-lookup"><span data-stu-id="e02f2-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Esquema de la tabla AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="e02f2-136">En **Explorador de servidores**, haga doble clic en el **AspNetUsers** de tabla y seleccione **mostrar datos de tabla**.</span><span class="sxs-lookup"><span data-stu-id="e02f2-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Datos de la tabla AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="e02f2-138">En este momento, no se ha confirmado el correo electrónico para el usuario registrado.</span><span class="sxs-lookup"><span data-stu-id="e02f2-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="e02f2-139">Haga clic en la fila y seleccione Eliminar para eliminar el usuario.</span><span class="sxs-lookup"><span data-stu-id="e02f2-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="e02f2-140">Deberá agregar este correo electrónico nuevo en el paso siguiente y enviar un mensaje de confirmación a la dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="e02f2-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="e02f2-141">Confirmación por correo electrónico</span><span class="sxs-lookup"><span data-stu-id="e02f2-141">Email Confirmation</span></span>

<span data-ttu-id="e02f2-142">Es una práctica recomendada para confirmar el correo electrónico durante el registro de un nuevo usuario para comprobar que no están suplantando persona (es decir, se hayan registrado con el correo electrónico de otra persona).</span><span class="sxs-lookup"><span data-stu-id="e02f2-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="e02f2-143">Supongamos que tenemos un foro de discusión, ¿puede evitar `"bob@cpandl.com"` registrar como `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="e02f2-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="e02f2-144">Sin confirmación por correo electrónico, `"joe@contoso.com"` podría obtener correo electrónico no deseado de su aplicación.</span><span class="sxs-lookup"><span data-stu-id="e02f2-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="e02f2-145">Supongamos que Bob accidentalmente registrado como `"bib@cpandl.com"` y se había dado cuenta, no sería capaz de usar la recuperación de contraseña porque la aplicación no tiene su correo electrónico correcta.</span><span class="sxs-lookup"><span data-stu-id="e02f2-145">Suppose Bob accidentally registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="e02f2-146">Confirmación por correo electrónico proporciona una protección limitada solo desde los bots y no proporciona protección de correo basura determinado.</span><span class="sxs-lookup"><span data-stu-id="e02f2-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="e02f2-147">Por lo general desea impedir que todos los datos del sitio Web de registro antes de que se han confirmado por cualquier correo electrónico, un mensaje de texto SMS u otro mecanismo de nuevos usuarios.</span><span class="sxs-lookup"><span data-stu-id="e02f2-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="e02f2-148">En las secciones siguientes, se habilitará la confirmación por correo electrónico y modifique el código para evitar que los usuarios recién registrados iniciar sesión hasta que se ha confirmado el correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="e02f2-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="e02f2-149">En este tutorial, usará el servicio de correo electrónico SendGrid.</span><span class="sxs-lookup"><span data-stu-id="e02f2-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="e02f2-150">Enlazar SendGrid</span><span class="sxs-lookup"><span data-stu-id="e02f2-150">Hook up SendGrid</span></span>

<span data-ttu-id="e02f2-151">SendGrid ha cambiado su API desde que se escribió este tutorial.</span><span class="sxs-lookup"><span data-stu-id="e02f2-151">SendGrid has changed it's API since this tutorial was written.</span></span> <span data-ttu-id="e02f2-152">Para obtener instrucciones de SendGrid actuales, vea [SendGrid](http://sendgrid.com/) o [habilitar la recuperación de confirmación y la contraseña de cuenta](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span><span class="sxs-lookup"><span data-stu-id="e02f2-152">For current SendGrid instructions, see [SendGrid](http://sendgrid.com/) or [Enable account confirmation and password recovery](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span></span>

<span data-ttu-id="e02f2-153">Aunque este tutorial solo muestra cómo agregar la notificación de correo electrónico a través de [SendGrid](http://sendgrid.com/), puede enviar correo electrónico mediante SMTP y otros mecanismos (consulte [recursos adicionales](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="e02f2-153">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="e02f2-154">En Visual Studio, abra el **Package Manager Console** (**herramientas**  - &gt; **Administrador de paquetes de NuGet**  - &gt; **Package Manager Console**) y escriba el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="e02f2-154">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="e02f2-155">Vaya a la [página de registro de SendGrid de Azure](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) y registrar de forma gratuita la cuenta de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="e02f2-155">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="e02f2-156">Puede también registrarse para obtener una cuenta gratuita de SendGrid directamente en [sitio de SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="e02f2-156">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="e02f2-157">Desde **el Explorador de soluciones** abrir el *IdentityConfig.cs* de archivos en el *aplicación\_iniciar* carpeta y agregue el siguiente código resaltado en amarillo en la `EmailService` clase para configurar **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="e02f2-157">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="e02f2-158">Además, agregue el siguiente `using` instrucciones al principio de la *IdentityConfig.cs* archivo:</span><span class="sxs-lookup"><span data-stu-id="e02f2-158">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="e02f2-159">Para simplificar este ejemplo, va a almacenar los valores de cuenta de servicio de correo electrónico en el `appSettings` sección de la *web.config* archivo.</span><span class="sxs-lookup"><span data-stu-id="e02f2-159">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="e02f2-160">Agregue el código XML siguiente resaltado en amarillo en la *web.config* archivo en la raíz del proyecto:</span><span class="sxs-lookup"><span data-stu-id="e02f2-160">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="e02f2-161">Seguridad: nunca almacene de datos confidenciales en el código fuente.</span><span class="sxs-lookup"><span data-stu-id="e02f2-161">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="e02f2-162">En este ejemplo, la cuenta y las credenciales se almacenan en el **appSetting** sección de la *Web.config* archivo.</span><span class="sxs-lookup"><span data-stu-id="e02f2-162">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="e02f2-163">En Azure, puede almacenar con seguridad estos valores en el **[configurar](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** ficha en el portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="e02f2-163">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="e02f2-164">Para obtener información relacionada, vea tema de Rick Anderson [procedimientos recomendados para implementar contraseñas y otros datos confidenciales en ASP.NET y Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="e02f2-164">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="e02f2-165">Agregue los valores de servicio de correo electrónico para reflejar los valores de autenticación de SendGrid (nombre de usuario y contraseña) para que pueda correcta enviar correo electrónico desde la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e02f2-165">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="e02f2-166">Asegúrese de utilizar el nombre de cuenta de SendGrid en lugar de la dirección de correo electrónico que proporcionó SendGrid.</span><span class="sxs-lookup"><span data-stu-id="e02f2-166">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="e02f2-167">Habilitar la confirmación de correo electrónico</span><span class="sxs-lookup"><span data-stu-id="e02f2-167">Enable Email Confirmation</span></span>

 <span data-ttu-id="e02f2-168">Para habilitar la confirmación por correo electrónico, deberá modificar el código de registro mediante los pasos siguientes.</span><span class="sxs-lookup"><span data-stu-id="e02f2-168">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  
 

1. <span data-ttu-id="e02f2-169">En el *cuenta* carpeta, abra el *Register.aspx.cs* código subyacente y actualizar el `CreateUser_Click` método para habilitar los cambios resaltados siguientes:</span><span class="sxs-lookup"><span data-stu-id="e02f2-169">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="e02f2-170">En **el Explorador de soluciones**, haga clic en *Default.aspx* y seleccione **establecer como página principal**.</span><span class="sxs-lookup"><span data-stu-id="e02f2-170">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="e02f2-171">Ejecute la aplicación presionando **F5.**</span><span class="sxs-lookup"><span data-stu-id="e02f2-171">Run the app by pressing **F5.**</span></span> <span data-ttu-id="e02f2-172">Cuando se muestre la página, haga clic en el **registrar** vínculo para mostrar la página de registro.</span><span class="sxs-lookup"><span data-stu-id="e02f2-172">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="e02f2-173">Escriba su correo electrónico y contraseña, a continuación, haga clic en el **registrar** botón para enviar un mensaje de correo electrónico a través de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="e02f2-173">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
   <span data-ttu-id="e02f2-174">El estado actual de su proyecto y código permitirá al usuario iniciar sesión una vez que complete el formulario de registro, aunque aún no ha confirmado que su cuenta.</span><span class="sxs-lookup"><span data-stu-id="e02f2-174">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="e02f2-175">Compruebe su cuenta de correo electrónico y haga clic en el vínculo para confirmar su correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="e02f2-175">Check your email account and click on the link to confirm your email.</span></span>  
   <span data-ttu-id="e02f2-176">Una vez que envíe el formulario de registro, se registrará.</span><span class="sxs-lookup"><span data-stu-id="e02f2-176">Once you submit the registration form, you will be logged in.</span></span>  
    ![Sitio Web de ejemplo - iniciada](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="e02f2-178">Requerir confirmación por correo electrónico antes del inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="e02f2-178">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="e02f2-179">Aunque haya confirmado la cuenta de correo electrónico, en este momento no sería necesario hacer clic en el vínculo de contenido en el correo electrónico de comprobación se ha iniciado sesión completamente.</span><span class="sxs-lookup"><span data-stu-id="e02f2-179">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="e02f2-180">En la siguiente sección, modificará el código que requieren nuevos usuarios para que tenga un correo electrónico de confirmación antes de registrarse (autenticado).</span><span class="sxs-lookup"><span data-stu-id="e02f2-180">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="e02f2-181">En **el Explorador de soluciones** de Visual Studio, actualice el `CreateUser_Click` eventos en el *Register.aspx.cs* código contenido en el *cuentas* carpeta con el cambios resaltados siguientes:</span><span class="sxs-lookup"><span data-stu-id="e02f2-181">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="e02f2-182">Actualización de la `LogIn` método en el *Login.aspx.cs* código subyacente con los cambios resaltados siguientes:</span><span class="sxs-lookup"><span data-stu-id="e02f2-182">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="e02f2-183">Ejecutar la aplicación</span><span class="sxs-lookup"><span data-stu-id="e02f2-183">Run the Application</span></span>

 <span data-ttu-id="e02f2-184">Ahora que ha implementado el código para comprobar si se ha confirmado la dirección de correo electrónico de un usuario, puede comprobar la funcionalidad tanto en el **registrar** y **inicio de sesión** páginas.</span><span class="sxs-lookup"><span data-stu-id="e02f2-184">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="e02f2-185">Elimine las cuentas en el **AspNetUsers** tabla que contenga el alias de correo electrónico que desea probar.</span><span class="sxs-lookup"><span data-stu-id="e02f2-185">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="e02f2-186">Ejecute la aplicación (**F5**) y compruebe que no se puede registrar como un usuario hasta que haya confirmado la dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="e02f2-186">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="e02f2-187">Antes de confirmar la nueva cuenta a través del correo electrónico que acaba de enviar, intenta iniciar sesión con la nueva cuenta.</span><span class="sxs-lookup"><span data-stu-id="e02f2-187">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="e02f2-188">Verá que no es posible iniciar sesión y que debe tener una cuenta de correo electrónico confirmado.</span><span class="sxs-lookup"><span data-stu-id="e02f2-188">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="e02f2-189">Una vez que confirme su dirección de correo electrónico, inicie sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e02f2-189">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="e02f2-190">Restablecimiento y recuperación de contraseñas</span><span class="sxs-lookup"><span data-stu-id="e02f2-190">Password Recovery and Reset</span></span>

1. <span data-ttu-id="e02f2-191">En Visual Studio, quite los caracteres de comentario de la `Forgot` método en el *Forgot.aspx.cs* código contenido en el *cuenta* carpeta, por lo que el método aparece como sigue:</span><span class="sxs-lookup"><span data-stu-id="e02f2-191">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="e02f2-192">Abra el *Login.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="e02f2-192">Open the *Login.aspx* page.</span></span> <span data-ttu-id="e02f2-193">Reemplace el marcado cerca del final de la **loginForm** sección tal como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="e02f2-193">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="e02f2-194">Abra el *Login.aspx.cs* código subyacente y elimine la siguiente línea de código resaltado en amarillo de la `Page_Load` controlador de eventos:</span><span class="sxs-lookup"><span data-stu-id="e02f2-194">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="e02f2-195">Ejecute la aplicación presionando **F5.**</span><span class="sxs-lookup"><span data-stu-id="e02f2-195">Run the app by pressing **F5.**</span></span> <span data-ttu-id="e02f2-196">Cuando se muestre la página, haga clic en el **iniciarla** vínculo.</span><span class="sxs-lookup"><span data-stu-id="e02f2-196">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="e02f2-197">Haga clic en el **¿olvidó su contraseña?** vínculo para mostrar el **contraseña olvidada** página.</span><span class="sxs-lookup"><span data-stu-id="e02f2-197">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="e02f2-198">Escriba su dirección de correo electrónico y haga clic en el **enviar** botón para enviar un correo electrónico a la dirección que le permitirá restablecer su contraseña.</span><span class="sxs-lookup"><span data-stu-id="e02f2-198">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
   <span data-ttu-id="e02f2-199">Compruebe su cuenta de correo electrónico y haga clic en el vínculo para mostrar el **restablecer contraseña** página.</span><span class="sxs-lookup"><span data-stu-id="e02f2-199">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="e02f2-200">En el **restablecer contraseña** , escriba su correo electrónico, la contraseña y la contraseña confirmada.</span><span class="sxs-lookup"><span data-stu-id="e02f2-200">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="e02f2-201">A continuación, presione el **restablecer** botón.</span><span class="sxs-lookup"><span data-stu-id="e02f2-201">Then, press the **Reset** button.</span></span>  
   <span data-ttu-id="e02f2-202">Cuando se restableció correctamente su contraseña, el **cambiar contraseña** se mostrará la página.</span><span class="sxs-lookup"><span data-stu-id="e02f2-202">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="e02f2-203">Ahora puede iniciar sesión con la nueva contraseña.</span><span class="sxs-lookup"><span data-stu-id="e02f2-203">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="e02f2-204">Vínculo de confirmación de correo electrónico de reenvío</span><span class="sxs-lookup"><span data-stu-id="e02f2-204">Resend Email Confirmation Link</span></span>

<span data-ttu-id="e02f2-205">Una vez que un usuario crea una nueva cuenta local, reciben un correo electrónico un vínculo de confirmación deben usar antes de que puedan iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="e02f2-205">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="e02f2-206">Si el usuario elimina accidentalmente el correo electrónico de confirmación o nunca llega el correo electrónico, deben volverá a enviar el vínculo de confirmación.</span><span class="sxs-lookup"><span data-stu-id="e02f2-206">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="e02f2-207">Los cambios de código siguientes muestran cómo habilitarlo.</span><span class="sxs-lookup"><span data-stu-id="e02f2-207">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="e02f2-208">En Visual Studio, abra el **Login.aspx.cs** código subyacente y agregue el siguiente controlador de eventos después de la `LogIn` controlador de eventos:</span><span class="sxs-lookup"><span data-stu-id="e02f2-208">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="e02f2-209">Modificar el `LogIn` controlador de eventos en el *Login.aspx.cs* código cambiando el código resaltado en amarillo como sigue:</span><span class="sxs-lookup"><span data-stu-id="e02f2-209">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="e02f2-210">Actualización de la *Login.aspx* página agregando el código resaltado en amarillo como sigue:</span><span class="sxs-lookup"><span data-stu-id="e02f2-210">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="e02f2-211">Elimine las cuentas en el **AspNetUsers** tabla que contenga el alias de correo electrónico que desea probar.</span><span class="sxs-lookup"><span data-stu-id="e02f2-211">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="e02f2-212">Ejecute la aplicación (**F5**) y registrar su dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="e02f2-212">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="e02f2-213">Antes de confirmar la nueva cuenta a través del correo electrónico que acaba de enviar, intenta iniciar sesión con la nueva cuenta.</span><span class="sxs-lookup"><span data-stu-id="e02f2-213">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
   <span data-ttu-id="e02f2-214">Verá que no es posible iniciar sesión y que debe tener una cuenta de correo electrónico confirmado.</span><span class="sxs-lookup"><span data-stu-id="e02f2-214">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="e02f2-215">Además, ahora puede reenviar un mensaje de confirmación a su cuenta de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="e02f2-215">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="e02f2-216">Escriba su dirección de correo electrónico y contraseña, a continuación, presione el **Enviar confirmación** botón.</span><span class="sxs-lookup"><span data-stu-id="e02f2-216">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="e02f2-217">Una vez que confirme su dirección de correo electrónico basada en el mensaje recién enviado por correo electrónico, inicie sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e02f2-217">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="e02f2-218">Solución de problemas de la aplicación</span><span class="sxs-lookup"><span data-stu-id="e02f2-218">Troubleshooting the App</span></span>

<span data-ttu-id="e02f2-219">Si no recibe un correo electrónico que contiene el vínculo para comprobar las credenciales:</span><span class="sxs-lookup"><span data-stu-id="e02f2-219">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="e02f2-220">Compruebe la carpeta correo no deseado o spam.</span><span class="sxs-lookup"><span data-stu-id="e02f2-220">Check your junk or spam folder.</span></span>
- <span data-ttu-id="e02f2-221">Inicie sesión en su cuenta de SendGrid y haga clic en el [vínculo de la actividad de correo electrónico](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="e02f2-221">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="e02f2-222">Asegúrese de que usa el nombre de cuenta de usuario de SendGrid como una *Web.config* valor en lugar de su dirección de correo electrónico de la cuenta de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="e02f2-222">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="e02f2-223">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="e02f2-223">Additional Resources</span></span>

- [<span data-ttu-id="e02f2-224">Recursos recomendados de vínculos a ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="e02f2-224">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="e02f2-225">Confirmación de la cuenta y contraseña de recuperación con ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="e02f2-225">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="e02f2-226">Serie de tutoriales de formularios Web Forms ASP.NET: agregar un proveedor de OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="e02f2-226">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="e02f2-227">Implementar una aplicación de formularios Web ASP.NET segura con pertenencia, OAuth y SQL Database en Azure App Service</span><span class="sxs-lookup"><span data-stu-id="e02f2-227">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="e02f2-228">Serie de tutoriales de formularios Web Forms ASP.NET - habilitar SSL para el proyecto</span><span class="sxs-lookup"><span data-stu-id="e02f2-228">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
