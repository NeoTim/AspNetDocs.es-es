---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: 'Uso de Entity Framework 4.0 y el Control ObjectDataSource, parte 1: Introducción | Microsoft Docs'
author: tdykstra
description: Esta serie de tutoriales se basa en la aplicación web de Contoso University establecen que se crea mediante la introducción a la serie de tutoriales de Entity Framework. Si yo...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 5eaeaa0aa474e1aed86954e6c10dd1703b938944
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/01/2019
ms.locfileid: "57065412"
---
<a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="66bd9-104">Uso de Entity Framework 4.0 y el Control ObjectDataSource, parte 1: Introducción</span><span class="sxs-lookup"><span data-stu-id="66bd9-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>
====================
<span data-ttu-id="66bd9-105">por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="66bd9-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="66bd9-106">Esta serie de tutoriales se basa en la aplicación web de Contoso University creado por el [Introducción a Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="66bd9-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="66bd9-107">Si no has completado los tutoriales anteriores, como un punto de partida para este tutorial puede [descargar la aplicación](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) que puede haberla creado.</span><span class="sxs-lookup"><span data-stu-id="66bd9-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="66bd9-108">También puede [descargar la aplicación](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) creado por la serie de tutoriales completa.</span><span class="sxs-lookup"><span data-stu-id="66bd9-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="66bd9-109">La aplicación web de Contoso University muestra cómo crear aplicaciones de formularios Web Forms de ASP.NET con el Entity Framework 4.0 y Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="66bd9-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="66bd9-110">La aplicación de ejemplo es un sitio Web de una universidad ficticia, Contoso University.</span><span class="sxs-lookup"><span data-stu-id="66bd9-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="66bd9-111">Incluye funciones como la admisión de estudiantes, la creación de cursos y asignaciones de instructores.</span><span class="sxs-lookup"><span data-stu-id="66bd9-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="66bd9-112">El tutorial muestra ejemplos en C#.</span><span class="sxs-lookup"><span data-stu-id="66bd9-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="66bd9-113">El [ejemplo descargable](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contiene código en C# y Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="66bd9-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="66bd9-114">En primer lugar la base de datos</span><span class="sxs-lookup"><span data-stu-id="66bd9-114">Database First</span></span>
> 
> <span data-ttu-id="66bd9-115">Hay tres maneras de que trabajar con datos en Entity Framework: *Primero la base de datos*, *Model First*, y *Code First*.</span><span class="sxs-lookup"><span data-stu-id="66bd9-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="66bd9-116">Este tutorial es para la primera base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-116">This tutorial is for Database First.</span></span> <span data-ttu-id="66bd9-117">Para obtener información sobre las diferencias entre estos flujos de trabajo e instrucciones sobre cómo elegir el mejor método para su escenario, consulte [flujos de trabajo de desarrollo de Entity Framework](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="66bd9-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="66bd9-118">Formularios Web Forms</span><span class="sxs-lookup"><span data-stu-id="66bd9-118">Web Forms</span></span>
> 
> <span data-ttu-id="66bd9-119">Al igual que la serie de introducción, esta serie de tutoriales utiliza el modelo de formularios Web Forms de ASP.NET y se supone que sabe cómo trabajar con formularios Web Forms de ASP.NET en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="66bd9-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="66bd9-120">Si no, ve [Introducción a ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span><span class="sxs-lookup"><span data-stu-id="66bd9-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="66bd9-121">Si prefiere trabajar con el marco de MVC de ASP.NET, vea [Introducción a Entity Framework con ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="66bd9-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="66bd9-122">Versiones de software</span><span class="sxs-lookup"><span data-stu-id="66bd9-122">Software versions</span></span>
> 
> | <span data-ttu-id="66bd9-123">**Se muestra en el tutorial**</span><span class="sxs-lookup"><span data-stu-id="66bd9-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="66bd9-124">**También funciona con**</span><span class="sxs-lookup"><span data-stu-id="66bd9-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="66bd9-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="66bd9-125">Windows 7</span></span> | <span data-ttu-id="66bd9-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="66bd9-126">Windows 8</span></span> |
> | <span data-ttu-id="66bd9-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="66bd9-127">Visual Studio 2010</span></span> | <span data-ttu-id="66bd9-128">Visual Studio 2010 Express para Web.</span><span class="sxs-lookup"><span data-stu-id="66bd9-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="66bd9-129">El tutorial no se ha probado con las versiones posteriores de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="66bd9-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="66bd9-130">Existen muchas diferencias en las selecciones de menú, cuadros de diálogo y plantillas.</span><span class="sxs-lookup"><span data-stu-id="66bd9-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="66bd9-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="66bd9-131">.NET 4</span></span> | <span data-ttu-id="66bd9-132">.NET 4.5 es compatible con .NET 4, pero el tutorial no se ha probado con .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="66bd9-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="66bd9-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="66bd9-133">Entity Framework 4</span></span> | <span data-ttu-id="66bd9-134">El tutorial no se ha probado con las versiones posteriores de Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="66bd9-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="66bd9-135">A partir de Entity Framework 5, EF usa de forma predeterminada el `DbContext API` que se introdujo con EF 4.1.</span><span class="sxs-lookup"><span data-stu-id="66bd9-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="66bd9-136">El control EntityDataSource se diseñó para usar el `ObjectContext` API.</span><span class="sxs-lookup"><span data-stu-id="66bd9-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="66bd9-137">Para obtener información sobre cómo usar EntityDataSource control con el `DbContext` API, consulte [esta entrada de blog](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span><span class="sxs-lookup"><span data-stu-id="66bd9-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="66bd9-138">Preguntas</span><span class="sxs-lookup"><span data-stu-id="66bd9-138">Questions</span></span>
> 
> <span data-ttu-id="66bd9-139">Si tiene preguntas que no están directamente relacionados con el tutorial, puede publicarlos en el [foro de ASP.NET Entity Framework](https://forums.asp.net/1227.aspx), [Entity Framework y LINQ al foro de entidades](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), o [ StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="66bd9-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>


<span data-ttu-id="66bd9-140">El `EntityDataSource` control le permite crear una aplicación muy rápidamente, pero normalmente requiere mantener una cantidad significativa de lógica de negocios y la lógica de acceso a datos en su *.aspx* páginas.</span><span class="sxs-lookup"><span data-stu-id="66bd9-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="66bd9-141">Si espera que su aplicación aumenta la complejidad y que requieren mantenimiento continuo, puede invertir más tiempo de desarrollo por adelantado con el fin de crear un *n niveles* o *superpuesto* estructura de la aplicación que es más fácil de mantener.</span><span class="sxs-lookup"><span data-stu-id="66bd9-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="66bd9-142">Para implementar esta arquitectura, se separa la capa de presentación de la capa de lógica empresarial (BLL) y la capa de acceso a datos (DAL).</span><span class="sxs-lookup"><span data-stu-id="66bd9-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="66bd9-143">Una forma de implementar esta estructura es usar el `ObjectDataSource` control en lugar de la `EntityDataSource` control.</span><span class="sxs-lookup"><span data-stu-id="66bd9-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="66bd9-144">Cuando se usa el `ObjectDataSource` (control), implementar su propio código de acceso a datos y, a continuación, invóquelo en *.aspx* páginas mediante un control que tiene muchas de las mismas características que otros controles de origen de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="66bd9-145">Esto le permite combinar las ventajas de un enfoque de n niveles con las ventajas de usar un control de formularios Web Forms para el acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="66bd9-146">El `ObjectDataSource` control ofrece más flexibilidad en otras maneras.</span><span class="sxs-lookup"><span data-stu-id="66bd9-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="66bd9-147">Puesto que escribir su propio código de acceso a datos, es más fácil para algo más que leer, insertar, actualizar o eliminar un tipo de entidad concreto, que son las tareas que el `EntityDataSource` control está diseñado para realizar.</span><span class="sxs-lookup"><span data-stu-id="66bd9-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="66bd9-148">Por ejemplo, puede realizar el registro cada vez que se actualiza una entidad, archivar los datos cada vez que se elimina una entidad, o automáticamente comprobación y actualización de datos relacionados, según sea necesario cuando se inserta una fila con un valor de clave externa.</span><span class="sxs-lookup"><span data-stu-id="66bd9-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="66bd9-149">Lógica de negocios y clases de repositorio</span><span class="sxs-lookup"><span data-stu-id="66bd9-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="66bd9-150">Un `ObjectDataSource` funciona mediante la invocación de una clase que crea el control.</span><span class="sxs-lookup"><span data-stu-id="66bd9-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="66bd9-151">La clase incluye métodos que recuperen y actualicen los datos y proporcionar los nombres de los métodos a los `ObjectDataSource` control en el marcado.</span><span class="sxs-lookup"><span data-stu-id="66bd9-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="66bd9-152">Durante la representación o procesamiento de la devolución, el `ObjectDataSource` llama a los métodos que ha especificado.</span><span class="sxs-lookup"><span data-stu-id="66bd9-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="66bd9-153">Además de operaciones CRUD básicas, la clase que se cree para usarlos con la `ObjectDataSource` control es posible que deba ejecutar lógica de negocios cuando el `ObjectDataSource` lee o actualiza datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="66bd9-154">Por ejemplo, cuando se actualiza un departamento, es posible que deba validar que no hay otros departamentos tienen el mismo administrador dado que una persona no puede ser administrador del departamento de más de un.</span><span class="sxs-lookup"><span data-stu-id="66bd9-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="66bd9-155">En algunos `ObjectDataSource` documentación, como el [información general de clases de ObjectDataSource](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), el control llama a una clase que se conoce como un *objeto comercial* que incluye la lógica de negocios y lógica de acceso a datos .</span><span class="sxs-lookup"><span data-stu-id="66bd9-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="66bd9-156">En este tutorial creará clases independientes para lógica de negocios y para la lógica de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="66bd9-157">La clase que encapsula la lógica de acceso a datos se denomina un *repositorio*.</span><span class="sxs-lookup"><span data-stu-id="66bd9-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="66bd9-158">La clase de lógica de negocios incluye métodos de lógica de negocios y los métodos de acceso a datos, pero el repositorio para llevar a cabo tareas de acceso a datos de llamar a los métodos de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="66bd9-159">También creará una capa de abstracción entre el BLL y DAL que facilita unitarias automatizadas las pruebas de la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="66bd9-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="66bd9-160">Esta capa de abstracción se implementa mediante la creación de una interfaz y mediante la interfaz cuando se crean instancias del repositorio en la clase de lógica de negocios.</span><span class="sxs-lookup"><span data-stu-id="66bd9-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="66bd9-161">Esto permite proporcionar la clase de lógica de negocios con una referencia a cualquier objeto que implementa la interfaz del repositorio.</span><span class="sxs-lookup"><span data-stu-id="66bd9-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="66bd9-162">Para el funcionamiento normal, proporcionar un objeto de repositorio que funciona con Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="66bd9-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="66bd9-163">Para las pruebas, proporcionar un objeto de repositorio que funciona con los datos almacenados de forma que se puede manipular fácilmente, como las variables de clase que se definen como colecciones.</span><span class="sxs-lookup"><span data-stu-id="66bd9-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="66bd9-164">La siguiente ilustración muestra la diferencia entre una clase de lógica de negocios que incluye la lógica de acceso a datos sin un repositorio y otra que usa un repositorio.</span><span class="sxs-lookup"><span data-stu-id="66bd9-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="66bd9-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="66bd9-166">Se iniciará mediante la creación de páginas web en el que el `ObjectDataSource` control se enlaza directamente a un repositorio, ya que sólo realiza las tareas básicas de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="66bd9-167">En el siguiente tutorial creará una clase de lógica de negocios con lógica de validación y enlazar el `ObjectDataSource` control a esa clase en lugar de a la clase de repositorio.</span><span class="sxs-lookup"><span data-stu-id="66bd9-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="66bd9-168">También creará pruebas unitarias para la lógica de validación.</span><span class="sxs-lookup"><span data-stu-id="66bd9-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="66bd9-169">En el tercer tutorial de esta serie agregará ordenar y filtrar la funcionalidad a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="66bd9-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="66bd9-170">Las páginas que crea en este tutorial funcionan con el `Departments` conjunto de entidades del modelo de datos que creó en el [serie de tutoriales de introducción a](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="66bd9-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="66bd9-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="66bd9-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="66bd9-173">Actualización de la base de datos y el modelo de datos</span><span class="sxs-lookup"><span data-stu-id="66bd9-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="66bd9-174">Para empezar este tutorial, realizar dos cambios en la base de datos que requieren los cambios correspondientes en el modelo de datos que creó en el [Introducción a Entity Framework y formularios Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutoriales.</span><span class="sxs-lookup"><span data-stu-id="66bd9-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="66bd9-175">En uno de estos tutoriales, ha realizado cambios en el diseñador manualmente para sincronizar el modelo de datos con la base de datos después de un cambio de base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="66bd9-176">En este tutorial, usará el diseñador **actualizar modelo desde la base de datos** herramienta para actualizar automáticamente el modelo de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="66bd9-177">Agregar una relación a la base de datos</span><span class="sxs-lookup"><span data-stu-id="66bd9-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="66bd9-178">En Visual Studio, abra la aplicación web de Contoso University establecen que creó en el [Introducción a Entity Framework y formularios Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) serie de tutoriales y, a continuación, abra el `SchoolDiagram` diagrama de base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="66bd9-179">Si observa la `Department` tabla en el diagrama de base de datos, verá que tiene un `Administrator` columna.</span><span class="sxs-lookup"><span data-stu-id="66bd9-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="66bd9-180">Esta columna es una clave externa para el `Person` tabla pero ninguna relación de clave externa se define en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="66bd9-181">Deberá crear la relación y actualizar el modelo de datos para que Entity Framework puede controlar automáticamente esta relación.</span><span class="sxs-lookup"><span data-stu-id="66bd9-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="66bd9-182">En el diagrama de base de datos, haga clic en el `Department` de tabla y seleccione **relaciones**.</span><span class="sxs-lookup"><span data-stu-id="66bd9-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="66bd9-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="66bd9-184">En el **relaciones de clave externa** clic en el cuadro **agregar**, a continuación, haga clic en el botón de puntos suspensivos para **especificación de tablas y columnas**.</span><span class="sxs-lookup"><span data-stu-id="66bd9-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="66bd9-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="66bd9-186">En el **tablas y columnas** diálogo cuadro, establezca la tabla de clave principal y de campos para `Person` y `PersonID`y establezca la tabla de clave externa y el campo a `Department` y `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="66bd9-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="66bd9-187">(Al hacer esto, cambiará el nombre de la relación de `FK_Department_Department` a `FK_Department_Person`.)</span><span class="sxs-lookup"><span data-stu-id="66bd9-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="66bd9-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="66bd9-189">Haga clic en **Aceptar** en el **tablas y columnas** cuadro, haga clic en **cerrar** en el **relaciones de clave externa** cuadro y guarde los cambios.</span><span class="sxs-lookup"><span data-stu-id="66bd9-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="66bd9-190">Si se le pregunta si desea guardar el `Person` y `Department` tablas, haga clic en **Sí**.</span><span class="sxs-lookup"><span data-stu-id="66bd9-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="66bd9-191">Si ha eliminado `Person` filas que corresponden a los datos que ya está en la `Administrator` columna, no podrá guardar este cambio.</span><span class="sxs-lookup"><span data-stu-id="66bd9-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="66bd9-192">En ese caso, use el editor de tablas en **Explorador de servidores** para asegurarse de que el `Administrator` valor en cada `Department` fila contiene el identificador de un registro que existe realmente en el `Person` tabla.</span><span class="sxs-lookup"><span data-stu-id="66bd9-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="66bd9-193">Después de guardar el cambio, no podrá eliminar una fila de la `Person` si esa persona es un administrador del departamento de la tabla.</span><span class="sxs-lookup"><span data-stu-id="66bd9-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="66bd9-194">En una aplicación de producción, proporcionaría un mensaje de error específico cuando una restricción de la base de datos evita una eliminación o se especificaría una eliminación en cascada.</span><span class="sxs-lookup"><span data-stu-id="66bd9-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="66bd9-195">Para obtener un ejemplo de cómo especificar una eliminación en cascada, consulte [a Entity Framework y ASP.NET: Introducción a parte 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span><span class="sxs-lookup"><span data-stu-id="66bd9-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>


### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="66bd9-196">Agregar una vista a la base de datos</span><span class="sxs-lookup"><span data-stu-id="66bd9-196">Adding a View to the Database</span></span>

<span data-ttu-id="66bd9-197">En el nuevo *Departments.aspx* página que se va a crear, desea proporcionar una lista desplegable de instructores, con los nombres de formato "apellido, nombre" para que los usuarios pueden seleccionar administradores de departamento.</span><span class="sxs-lookup"><span data-stu-id="66bd9-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="66bd9-198">Para que sea más fácil de hacerlo, creará una vista en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="66bd9-199">La vista consistirá simplemente los datos necesarios para la lista desplegable: el nombre completo (correctamente con formato) y la clave de registro.</span><span class="sxs-lookup"><span data-stu-id="66bd9-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="66bd9-200">En **Explorador de servidores**, expanda *School.mdf*, haga clic en el **vistas** carpeta y seleccione **agregar nueva vista**.</span><span class="sxs-lookup"><span data-stu-id="66bd9-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="66bd9-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="66bd9-202">Haga clic en **cerrar** cuando el **Agregar tabla** aparecerá el cuadro de diálogo y pegue la siguiente instrucción SQL en el panel SQL:</span><span class="sxs-lookup"><span data-stu-id="66bd9-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="66bd9-203">Guardar la vista como `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="66bd9-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="66bd9-204">Actualizando el modelo de datos</span><span class="sxs-lookup"><span data-stu-id="66bd9-204">Updating the Data Model</span></span>

<span data-ttu-id="66bd9-205">En el *DAL* carpeta, abra el *SchoolModel.edmx* de archivos, haga clic en la superficie de diseño y seleccione **actualizar modelo desde base de datos**.</span><span class="sxs-lookup"><span data-stu-id="66bd9-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="66bd9-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="66bd9-207">En el **elija los objetos de base de datos** cuadro de diálogo, seleccione el **agregar** pestaña y seleccione la vista que acaba de crear.</span><span class="sxs-lookup"><span data-stu-id="66bd9-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="66bd9-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="66bd9-209">Haga clic en **Finalizar**.</span><span class="sxs-lookup"><span data-stu-id="66bd9-209">Click **Finish**.</span></span>

<span data-ttu-id="66bd9-210">En el diseñador, verá que la herramienta crea un `vInstructorName` entidad y una nueva asociación entre el `Department` y `Person` entidades.</span><span class="sxs-lookup"><span data-stu-id="66bd9-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="66bd9-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="66bd9-212">En el **salida** y **lista de errores** clave puede aparecer un mensaje de advertencia que le informa de que la herramienta crea automáticamente un elemento principal de windows para el nuevo `vInstructorName` vista.</span><span class="sxs-lookup"><span data-stu-id="66bd9-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="66bd9-213">Este es el comportamiento normal.</span><span class="sxs-lookup"><span data-stu-id="66bd9-213">This is expected behavior.</span></span>


<span data-ttu-id="66bd9-214">Cuando se hace referencia a la nueva `vInstructorName` entidad en el código, no desea utilizar la convención de base de datos de un prefijo "v" en minúsculas a él.</span><span class="sxs-lookup"><span data-stu-id="66bd9-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="66bd9-215">Por lo tanto, se cambiará el nombre de la entidad y un conjunto de entidades en el modelo.</span><span class="sxs-lookup"><span data-stu-id="66bd9-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="66bd9-216">Abra el **modelar Browser**.</span><span class="sxs-lookup"><span data-stu-id="66bd9-216">Open the **Model Browser**.</span></span> <span data-ttu-id="66bd9-217">Verá `vInstructorName` aparece como un tipo de entidad y una vista.</span><span class="sxs-lookup"><span data-stu-id="66bd9-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="66bd9-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="66bd9-219">En **SchoolModel** (no **SchoolModel.Store**), haga clic en **vInstructorName** y seleccione **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="66bd9-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="66bd9-220">En el **propiedades** ventana, cambie el **nombre** propiedad a "InstructorName" y cambie el **nombre del conjunto de entidades** propiedad en "InstructorNames".</span><span class="sxs-lookup"><span data-stu-id="66bd9-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="66bd9-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="66bd9-222">Guarde y cierre el modelo de datos y, a continuación, recompile el proyecto.</span><span class="sxs-lookup"><span data-stu-id="66bd9-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="66bd9-223">Uso de una clase de repositorio y un Control ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="66bd9-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="66bd9-224">Cree un nuevo archivo de clase en el *DAL* carpeta, asígnele el nombre *SchoolRepository.cs*y reemplace el código existente por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="66bd9-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="66bd9-225">Este código proporciona un único `GetDepartments` método que devuelve todas las entidades en el `Departments` conjunto de entidades.</span><span class="sxs-lookup"><span data-stu-id="66bd9-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="66bd9-226">Dado que sabe que se accederá a la `Person` propiedad de navegación para cada fila devuelta, especificar la carga diligente de esa propiedad mediante el uso de la `Include` método.</span><span class="sxs-lookup"><span data-stu-id="66bd9-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="66bd9-227">La clase también implementa el `IDisposable` interfaz para asegurarse de que la conexión de base de datos se libera cuando se desecha el objeto.</span><span class="sxs-lookup"><span data-stu-id="66bd9-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="66bd9-228">Una práctica común es crear una clase de repositorio para cada tipo de entidad.</span><span class="sxs-lookup"><span data-stu-id="66bd9-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="66bd9-229">En este tutorial, se usa una clase de repositorio para varios tipos de entidad.</span><span class="sxs-lookup"><span data-stu-id="66bd9-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="66bd9-230">Para obtener más información sobre el modelo de repositorio, consulte las publicaciones en [blog del equipo de Entity Framework](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) y [blog de Julie](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span><span class="sxs-lookup"><span data-stu-id="66bd9-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>


<span data-ttu-id="66bd9-231">El `GetDepartments` método devuelve un `IEnumerable` objeto en lugar de un `IQueryable` objeto con el fin de asegurarse de que la colección devuelta es utilizable incluso después de desecha el propio objeto de repositorio.</span><span class="sxs-lookup"><span data-stu-id="66bd9-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="66bd9-232">Un `IQueryable` objeto puede provocar el acceso de la base de datos cada vez que se tiene acceso a, pero se podría desechar el objeto de repositorio en el momento en que un control enlazado a datos que intenta presentar los datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="66bd9-233">Podría devolver otro tipo de colección, como un `IList` en lugar del objeto un `IEnumerable` objeto.</span><span class="sxs-lookup"><span data-stu-id="66bd9-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="66bd9-234">Sin embargo, devolviendo un `IEnumerable` objeto garantiza que puede realizar tareas de procesamiento de la lista típica de solo lectura, como `foreach` bucles y consultas LINQ, pero no se puede agregar a o quitar elementos de la colección, que parece indicar que dichos cambios sería se conservan en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="66bd9-235">Crear un *Departments.aspx* página que usa el *Site.Master* página principal y agregue el siguiente marcado en el `Content` control denominado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="66bd9-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="66bd9-236">Este marcado crea un `ObjectDataSource` control que usa la clase de repositorio que acaba de crear, y un `GridView` control para mostrar los datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="66bd9-237">El `GridView` control especifica **editar** y **eliminar** comandos, pero aún no ha agregado código para admitirlos aún.</span><span class="sxs-lookup"><span data-stu-id="66bd9-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="66bd9-238">Usan varias columnas `DynamicField` controles para que puede aprovechar la funcionalidad de formato y validación de datos automática.</span><span class="sxs-lookup"><span data-stu-id="66bd9-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="66bd9-239">En estos casos para que funcione, debe llamar el `EnableDynamicData` método en el `Page_Init` controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="66bd9-240">(`DynamicControl` controles no se usan en el `Administrator` campo porque no trabajan con las propiedades de navegación.)</span><span class="sxs-lookup"><span data-stu-id="66bd9-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="66bd9-241">El `Vertical-Align="Top"` atributos cobrará importancia más adelante cuando se agrega una columna que tenga un anidada `GridView` control a la cuadrícula.</span><span class="sxs-lookup"><span data-stu-id="66bd9-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="66bd9-242">Abra el *Departments.aspx.cs* de archivo y agregue la siguiente `using` instrucción:</span><span class="sxs-lookup"><span data-stu-id="66bd9-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="66bd9-243">A continuación, agregue el siguiente controlador de la página `Init` eventos:</span><span class="sxs-lookup"><span data-stu-id="66bd9-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="66bd9-244">En el *DAL* carpeta, cree un nuevo archivo de clase denominado *Department.cs* y reemplace el código existente por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="66bd9-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="66bd9-245">Este código agrega metadatos al modelo de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="66bd9-246">Especifica que el `Budget` propiedad de la `Department` entidad representa realmente moneda aunque su tipo de datos es `Decimal`, y especifica que el valor debe estar entre 0 y 1.000.000,00 $.</span><span class="sxs-lookup"><span data-stu-id="66bd9-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="66bd9-247">También especifica que el `StartDate` propiedad se debe dar formato como una fecha en formato mm/dd/aaaa.</span><span class="sxs-lookup"><span data-stu-id="66bd9-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="66bd9-248">Ejecute el *Departments.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="66bd9-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="66bd9-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="66bd9-250">Tenga en cuenta que, aunque no se especificó una cadena de formato en el *Departments.aspx* marcado de página para el **presupuesto** o **Start Date** predeterminado de columnas, moneda y fecha se ha aplicado formato a ellos mediante el `DynamicField` controles, utilizar los metadatos que se proporcionan en el *Department.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="66bd9-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="66bd9-251">Agregar Insert y la funcionalidad de eliminación</span><span class="sxs-lookup"><span data-stu-id="66bd9-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="66bd9-252">Abra *SchoolRepository.cs*, agregue el código siguiente para crear un `Insert` método y un `Delete` método.</span><span class="sxs-lookup"><span data-stu-id="66bd9-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="66bd9-253">El código también incluye un método denominado `GenerateDepartmentID` que calcula el siguiente valor de clave de registro disponibles para su uso por el `Insert` método.</span><span class="sxs-lookup"><span data-stu-id="66bd9-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="66bd9-254">Esto es necesario porque la base de datos no está configurado para calcular automáticamente para el `Department` tabla.</span><span class="sxs-lookup"><span data-stu-id="66bd9-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="66bd9-255">El método de conexión</span><span class="sxs-lookup"><span data-stu-id="66bd9-255">The Attach Method</span></span>

<span data-ttu-id="66bd9-256">El `DeleteDepartment` llamadas al método el `Attach` método con el fin de volver a establecer el vínculo que se mantiene en el Administrador de estado de objeto del contexto de objetos entre la entidad en la memoria y la base de datos de fila representa.</span><span class="sxs-lookup"><span data-stu-id="66bd9-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="66bd9-257">Esto debe ocurrir antes de las llamadas al método el `SaveChanges` método.</span><span class="sxs-lookup"><span data-stu-id="66bd9-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="66bd9-258">El término *contexto del objeto* hace referencia a la clase de Entity Framework que se deriva el `ObjectContext` clase que usas para acceder a los conjuntos de entidades y entidades.</span><span class="sxs-lookup"><span data-stu-id="66bd9-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="66bd9-259">En el código para este proyecto, la clase se denomina `SchoolEntities`, y siempre se denomina una instancia de ella `context`.</span><span class="sxs-lookup"><span data-stu-id="66bd9-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="66bd9-260">El contexto de objeto *Administrador de estado de objeto* es una clase que deriva la `ObjectStateManager` clase.</span><span class="sxs-lookup"><span data-stu-id="66bd9-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="66bd9-261">El contacto de objeto usa el Administrador de estado de objeto para almacenar objetos de entidad y realizar un seguimiento de si cada uno de ellos está sincronizado con su fila correspondiente de la tabla o las filas de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="66bd9-262">Al leer una entidad, el contexto del objeto almacena en el Administrador de estado de objeto y realiza un seguimiento de si dicha representación del objeto está sincronizada con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="66bd9-263">Por ejemplo, si cambia un valor de propiedad, se establece una marca para indicar que la propiedad que ha cambiado ya no está sincronizada con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="66bd9-264">A continuación, cuando se llama a la `SaveChanges` método, el contexto del objeto sabe qué hacer en la base de datos porque el Administrador de estado de objeto sabe exactamente cuál es la diferencia entre el estado actual de la entidad y el estado de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="66bd9-265">Sin embargo, este proceso normalmente no funciona en una aplicación web, porque la instancia de contexto del objeto que lee una entidad, junto con todo el contenido de su administrador de estado de objeto, se elimina después de representa una página.</span><span class="sxs-lookup"><span data-stu-id="66bd9-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="66bd9-266">La instancia de contexto del objeto que se debe aplicar los cambios es una nueva que se crea una instancia para el procesamiento de devolución de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="66bd9-267">En el caso de los `DeleteDepartment` método, el `ObjectDataSource` control crea volver a la versión original de la entidad a partir de los valores de estado de vista, pero esto vuelve a crea `Department` entidad no existe en el Administrador de estado de objeto.</span><span class="sxs-lookup"><span data-stu-id="66bd9-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="66bd9-268">Si llama a la `DeleteObject` método en esta entidad volver a crearse, la llamada produciría un error porque el contexto del objeto no sabe si la entidad está sincronizada con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="66bd9-269">Sin embargo, una llamada a la `Attach` método restablece el seguimiento mismo entre la entidad que volver a crear y los valores en la base de datos que originalmente se hacía automáticamente cuando se lee la entidad en una instancia del contexto del objeto anterior.</span><span class="sxs-lookup"><span data-stu-id="66bd9-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="66bd9-270">Hay veces cuando no desea que el contexto del objeto para realizar el seguimiento de las entidades en el Administrador de estado de objeto, y puede establecer marcas para evitar que lo haga.</span><span class="sxs-lookup"><span data-stu-id="66bd9-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="66bd9-271">En otros tutoriales de esta serie se muestran ejemplos de este.</span><span class="sxs-lookup"><span data-stu-id="66bd9-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="66bd9-272">El método SaveChanges</span><span class="sxs-lookup"><span data-stu-id="66bd9-272">The SaveChanges Method</span></span>

<span data-ttu-id="66bd9-273">Esta clase de repositorio simple ilustra los principios básicos de cómo realizar operaciones CRUD.</span><span class="sxs-lookup"><span data-stu-id="66bd9-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="66bd9-274">En este ejemplo, el `SaveChanges` se llama al método inmediatamente después de cada actualización.</span><span class="sxs-lookup"><span data-stu-id="66bd9-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="66bd9-275">En una aplicación de producción que desee llamar a la `SaveChanges` desde un método independiente para proporcionarle más control sobre cuándo se actualiza la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="66bd9-276">(Al final del tutorial siguiente encontrará un vínculo a notas del producto que se explica en la unidad del patrón de trabajo que es un enfoque para coordinar las actualizaciones relacionadas.) Observe también que en el ejemplo, el `DeleteDepartment` método no incluye el código para controlar los conflictos de simultaneidad, se agregará código para hacerlo en un tutorial más adelante en esta serie.</span><span class="sxs-lookup"><span data-stu-id="66bd9-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="66bd9-277">Recuperar los nombres de Instructor para seleccionar al insertar</span><span class="sxs-lookup"><span data-stu-id="66bd9-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="66bd9-278">Los usuarios deben poder seleccionar un administrador de una lista de instructores en una lista desplegable al crear nuevos departamentos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="66bd9-279">Por lo tanto, agregue el código siguiente al *SchoolRepository.cs* para crear un método para recuperar la lista de instructores con la vista que creó anteriormente:</span><span class="sxs-lookup"><span data-stu-id="66bd9-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="66bd9-280">Creación de una página para insertar los departamentos de TI</span><span class="sxs-lookup"><span data-stu-id="66bd9-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="66bd9-281">Crear un *DepartmentsAdd.aspx* página que usa el *Site.Master* página y agregue el siguiente marcado en el `Content` control denominado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="66bd9-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="66bd9-282">Este marcado crea dos `ObjectDataSource` controla, uno para insertar nuevos `Department` entidades y otra para recuperar los nombres de instructor para el `DropDownList` control que se utiliza para seleccionar los administradores de departamento.</span><span class="sxs-lookup"><span data-stu-id="66bd9-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="66bd9-283">El marcado crea un `DetailsView` controlar para escribir nuevos departamentos y especifica un controlador para el control `ItemInserting` eventos para que pueda establecer el `Administrator` valor de clave externa.</span><span class="sxs-lookup"><span data-stu-id="66bd9-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="66bd9-284">Al final es un `ValidationSummary` control para mostrar los mensajes de error.</span><span class="sxs-lookup"><span data-stu-id="66bd9-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="66bd9-285">Abra *DepartmentsAdd.aspx.cs* y agregue la siguiente `using` instrucción:</span><span class="sxs-lookup"><span data-stu-id="66bd9-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="66bd9-286">Agregue la siguiente variable de clase y métodos:</span><span class="sxs-lookup"><span data-stu-id="66bd9-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="66bd9-287">El `Page_Init` método habilita la funcionalidad de los datos dinámicos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="66bd9-288">El controlador para el `DropDownList` del control `Init` evento guarda una referencia al control y el controlador para el `DetailsView` del control `Inserting` evento utiliza esa referencia para obtener la `PersonID` valor de la actualización y el instructor seleccionado el `Administrator` propiedad de clave externa de la `Department` entidad.</span><span class="sxs-lookup"><span data-stu-id="66bd9-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="66bd9-289">Ejecute la página, agregue información de un nuevo departamento y, a continuación, haga clic en el **insertar** vínculo.</span><span class="sxs-lookup"><span data-stu-id="66bd9-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="66bd9-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="66bd9-291">Escriba valores para otro departamento nuevo.</span><span class="sxs-lookup"><span data-stu-id="66bd9-291">Enter values for another new department.</span></span> <span data-ttu-id="66bd9-292">Escriba un número mayor que 1.000.000,00 en el **presupuesto** campo y tab para el campo siguiente.</span><span class="sxs-lookup"><span data-stu-id="66bd9-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="66bd9-293">Aparece un asterisco en el campo y, si mantiene el puntero del mouse sobre él, puede ver el mensaje de error que ha especificado en los metadatos para ese campo.</span><span class="sxs-lookup"><span data-stu-id="66bd9-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="66bd9-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="66bd9-295">Haga clic en **insertar**, y verá el mensaje de error mostrado por el `ValidationSummary` control en la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="66bd9-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="66bd9-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="66bd9-297">A continuación, cierre el explorador y abra el *Departments.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="66bd9-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="66bd9-298">Agregar funcionalidad de eliminación la *Departments.aspx* página mediante la adición de un `DeleteMethod` atributo a la `ObjectDataSource` control y un `DataKeyNames` atributo a la `GridView` control.</span><span class="sxs-lookup"><span data-stu-id="66bd9-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="66bd9-299">Las etiquetas de apertura para estos controles asemejará ahora en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="66bd9-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="66bd9-300">Ejecute la página.</span><span class="sxs-lookup"><span data-stu-id="66bd9-300">Run the page.</span></span>

<span data-ttu-id="66bd9-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="66bd9-302">Elimine el departamento que agregó cuando ejecutó el *DepartmentsAdd.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="66bd9-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="66bd9-303">Agregar funcionalidad de actualización</span><span class="sxs-lookup"><span data-stu-id="66bd9-303">Adding Update Functionality</span></span>

<span data-ttu-id="66bd9-304">Abra *SchoolRepository.cs* y agregue la siguiente `Update` método:</span><span class="sxs-lookup"><span data-stu-id="66bd9-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="66bd9-305">Al hacer clic en **actualización** en el *Departments.aspx* página, el `ObjectDataSource` control crea dos `Department` entidades que se va a pasar a la `UpdateDepartment` método.</span><span class="sxs-lookup"><span data-stu-id="66bd9-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="66bd9-306">Uno contiene los valores originales que se han almacenado en el estado de vista y el otro contiene los nuevos valores que se especificaron en el `GridView` control.</span><span class="sxs-lookup"><span data-stu-id="66bd9-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="66bd9-307">El código en el `UpdateDepartment` método pasa el `Department` entidad que tiene los valores originales para el `Attach` método con el fin de establecer el seguimiento entre la entidad y lo que está en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="66bd9-308">A continuación, el código pasa el `Department` entidad que tiene los nuevos valores para el `ApplyCurrentValues` método.</span><span class="sxs-lookup"><span data-stu-id="66bd9-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="66bd9-309">El contexto del objeto compara los valores antiguos y nuevos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-309">The object context compares the old and new values.</span></span> <span data-ttu-id="66bd9-310">Si un nuevo valor es diferente de un valor anterior, el contexto del objeto cambia el valor de propiedad.</span><span class="sxs-lookup"><span data-stu-id="66bd9-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="66bd9-311">El `SaveChanges` método, a continuación, actualiza sólo las columnas cambiadas en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="66bd9-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="66bd9-312">(Sin embargo, si la función de actualización para esta entidad se asigna a un procedimiento almacenado, toda la fila se actualizaría con independencia de qué columnas se modificaron.)</span><span class="sxs-lookup"><span data-stu-id="66bd9-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="66bd9-313">Abra el *Departments.aspx* archivo y agregue los siguientes atributos para el `DepartmentsObjectDataSource` control:</span><span class="sxs-lookup"><span data-stu-id="66bd9-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="66bd9-314">Este hace que los valores anteriores para ser almacenan en la vista estado para que pueden compararse con los nuevos valores en el `Update` método.</span><span class="sxs-lookup"><span data-stu-id="66bd9-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="66bd9-315">Esto informa al control que es el nombre del parámetro de valores original `origDepartment` .</span><span class="sxs-lookup"><span data-stu-id="66bd9-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="66bd9-316">El marcado para la etiqueta de apertura del `ObjectDataSource` control ahora es similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="66bd9-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="66bd9-317">Agregar un `OnRowUpdating="DepartmentsGridView_RowUpdating"` atributo a la `GridView` control.</span><span class="sxs-lookup"><span data-stu-id="66bd9-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="66bd9-318">Se usará para establecer el `Administrator` valor de propiedad en función de la fila que el usuario selecciona en una lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="66bd9-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="66bd9-319">El `GridView` etiqueta de apertura ahora es similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="66bd9-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="66bd9-320">Agregar un `EditItemTemplate` controlar para el `Administrator` columna a la `GridView` controlar, inmediatamente después del `ItemTemplate` control para esa columna:</span><span class="sxs-lookup"><span data-stu-id="66bd9-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="66bd9-321">Esto `EditItemTemplate` control es similar a la `InsertItemTemplate` en controlar la *DepartmentsAdd.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="66bd9-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="66bd9-322">La diferencia es que el valor inicial del control se establece utilizando el `SelectedValue` atributo.</span><span class="sxs-lookup"><span data-stu-id="66bd9-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="66bd9-323">Antes de la `GridView` control, agregue un `ValidationSummary` controlar como hizo en el *DepartmentsAdd.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="66bd9-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="66bd9-324">Abra *Departments.aspx.cs* e inmediatamente después de la declaración de clase parcial, agregue el código siguiente para crear un campo privado para hacer referencia a la `DropDownList` control:</span><span class="sxs-lookup"><span data-stu-id="66bd9-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="66bd9-325">A continuación, agregue controladores para la `DropDownList` del control `Init` eventos y el `GridView` del control `RowUpdating` eventos:</span><span class="sxs-lookup"><span data-stu-id="66bd9-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="66bd9-326">El controlador para el `Init` evento guarda una referencia a la `DropDownList` control en el campo de clase.</span><span class="sxs-lookup"><span data-stu-id="66bd9-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="66bd9-327">El controlador para el `RowUpdating` evento usa la referencia para obtener el valor especificado por el usuario y se aplicará la `Administrator` propiedad de la `Department` entidad.</span><span class="sxs-lookup"><span data-stu-id="66bd9-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="66bd9-328">Use la *DepartmentsAdd.aspx* página para agregar un nuevo departamento, a continuación, ejecute el *Departments.aspx* página y haga clic en **editar** en la fila que ha agregado.</span><span class="sxs-lookup"><span data-stu-id="66bd9-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="66bd9-329">No podrá editar las filas que no se han agregado (es decir, que ya estaban en la base de datos), debido a los datos no válidos en la base de datos; los administradores de las filas que se crearon con la base de datos son los estudiantes.</span><span class="sxs-lookup"><span data-stu-id="66bd9-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="66bd9-330">Si se intenta editar uno de ellos, obtendrá una página de error que informa de un error similar a `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="66bd9-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>


<span data-ttu-id="66bd9-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="66bd9-332">Si introduce un no válido **presupuesto** amount y, a continuación, haga clic en **actualización**, verá el mismo asterisco y un mensaje de error que apareció en el *Departments.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="66bd9-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="66bd9-333">Cambiar un valor de campo o seleccione un administrador diferente y haga clic en **actualización**.</span><span class="sxs-lookup"><span data-stu-id="66bd9-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="66bd9-334">Se muestra el cambio.</span><span class="sxs-lookup"><span data-stu-id="66bd9-334">The change is displayed.</span></span>

<span data-ttu-id="66bd9-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="66bd9-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="66bd9-336">Con esto finaliza la introducción al uso de la `ObjectDataSource` control para básica CRUD (crear, leer, actualizar y eliminar) operaciones con Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="66bd9-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="66bd9-337">Ha creado una sencilla aplicación de n niveles, pero la capa de lógica de negocios se sigue estrechamente a la capa de acceso a datos, lo que complica las pruebas unitarias automatizadas.</span><span class="sxs-lookup"><span data-stu-id="66bd9-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="66bd9-338">En el siguiente tutorial verá cómo implementar el patrón de repositorio para facilitar las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="66bd9-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="66bd9-339">Siguiente</span><span class="sxs-lookup"><span data-stu-id="66bd9-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
