---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
title: Crear un proveedor personalizado de mapa del sitio controlado por base de datos (VB) | Microsoft Docs
author: rick-anderson
description: El proveedor del mapa del sitio predeterminado en ASP.NET 2,0 recupera sus datos de un archivo XML estático. Aunque el proveedor basado en XML es adecuado para muchas pequeñas y medianas siz...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: f904cd2c-a408-4484-9324-8b8d7fe33893
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
msc.type: authoredcontent
ms.openlocfilehash: 78051696bd75e1d574f55b1c5d5891fe67c3030d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/28/2019
ms.locfileid: "74630447"
---
# <a name="building-a-custom-database-driven-site-map-provider-vb"></a><span data-ttu-id="d8c0a-104">Crear un proveedor personalizado de mapas del sitio controlado por base de datos (VB)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-104">Building a Custom Database-Driven Site Map Provider (VB)</span></span>

<span data-ttu-id="d8c0a-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d8c0a-106">[Descargar código](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip) o [Descargar PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span></span>

> <span data-ttu-id="d8c0a-107">El proveedor del mapa del sitio predeterminado en ASP.NET 2,0 recupera sus datos de un archivo XML estático.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="d8c0a-108">Aunque el proveedor basado en XML es adecuado para muchos sitios web pequeños y de tamaño medio, las aplicaciones web más grandes requieren un mapa de sitio más dinámico.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="d8c0a-109">En este tutorial, vamos a crear un proveedor de mapa del sitio personalizado que recupera sus datos de la capa de lógica de negocios, que a su vez recupera los datos de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="d8c0a-110">Introducción</span><span class="sxs-lookup"><span data-stu-id="d8c0a-110">Introduction</span></span>

<span data-ttu-id="d8c0a-111">La característica de mapa del sitio de ASP.NET 2,0 s permite a un desarrollador de páginas definir un mapa del sitio de la aplicación web en un medio persistente, como en un archivo XML.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="d8c0a-112">Una vez definidos, se puede tener acceso a los datos del mapa del sitio mediante programación a través de la [clase`SiteMap`](https://msdn.microsoft.com/library/system.web.sitemap.aspx) en el [espacio de nombres`System.Web`](https://msdn.microsoft.com/library/system.web.aspx) o a través de una variedad de controles Web de navegación, como los controles SiteMapPath, MENU y TreeView.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="d8c0a-113">El sistema del mapa del sitio utiliza el [modelo de proveedor](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) para que se puedan crear y conectar diferentes implementaciones de serialización de mapa del sitio en una aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="d8c0a-114">El proveedor del mapa del sitio predeterminado que se incluye con ASP.NET 2,0 conserva la estructura del mapa del sitio en un archivo XML.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="d8c0a-115">De vuelta en las [páginas maestras y](../introduction/master-pages-and-site-navigation-vb.md) el tutorial de navegación del sitio, creamos un archivo denominado `Web.sitemap` que contenía esta estructura y se ha actualizado su XML con cada nueva sección del tutorial.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-vb.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="d8c0a-116">El proveedor del mapa del sitio basado en XML predeterminado funciona bien si la estructura del mapa del sitio es bastante estática, como en estos tutoriales.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="d8c0a-117">En muchos casos, sin embargo, se necesita un mapa de sitio más dinámico.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="d8c0a-118">Considere el mapa del sitio que se muestra en la figura 1, donde cada categoría y producto aparecen como secciones en la estructura del sitio Web.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="d8c0a-119">Con este mapa del sitio, la visita a la página web correspondiente al nodo raíz puede enumerar todas las categorías, mientras que al visitar una determinada página web de una categoría, se mostrarán los productos de la categoría s y la visualización de una página web de productos en particular mostraría los detalles del producto.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>

<span data-ttu-id="d8c0a-120">[![las categorías y los productos de la estructura del mapa del sitio](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span></span>

<span data-ttu-id="d8c0a-121">**Figura 1**: la composición de categorías y productos de la estructura del mapa del sitio ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span></span>

<span data-ttu-id="d8c0a-122">Aunque esta estructura basada en categorías y productos podría estar codificada de forma rígida en el archivo `Web.sitemap`, es necesario actualizar el archivo cada vez que se agrega, quita o cambia el nombre de una categoría o producto.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="d8c0a-123">Por lo tanto, el mantenimiento del mapa del sitio se simplificaría enormemente si su estructura se recupera de la base de datos o, idealmente, de la capa de lógica de negocios de la arquitectura de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="d8c0a-124">De este modo, a medida que se agregan, cambian de nombre o eliminan productos y categorías, el mapa del sitio se actualiza automáticamente para reflejar estos cambios.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="d8c0a-125">Como la serialización del mapa del sitio de ASP.NET 2,0 s se basa en el modelo del proveedor, podemos crear nuestro propio proveedor de mapa del sitio personalizado que obtiene sus datos de un almacén de datos alternativo, como la base de datos o la arquitectura.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="d8c0a-126">En este tutorial, vamos a crear un proveedor personalizado que recupera sus datos de la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="d8c0a-127">Vamos a empezar a trabajar.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="d8c0a-128">El proveedor del mapa del sitio personalizado creado en este tutorial está estrechamente acoplado a la arquitectura y al modelo de datos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="d8c0a-129">Jeff Prosise s [almacenando mapas de sitio en SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) y [el proveedor del mapa del sitio de SQL que espera que](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) los artículos examinen un enfoque generalizado para almacenar los datos del mapa del sitio en SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>

## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="d8c0a-130">Paso 1: creación de las páginas web del proveedor del mapa del sitio personalizado</span><span class="sxs-lookup"><span data-stu-id="d8c0a-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="d8c0a-131">Antes de empezar a crear un proveedor de mapa del sitio personalizado, vamos a agregar primero las páginas de ASP.NET que necesitamos para este tutorial.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="d8c0a-132">Comience agregando una nueva carpeta denominada `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="d8c0a-133">A continuación, agregue las siguientes páginas de ASP.NET a esa carpeta, asegurándose de asociar cada página a la página maestra de `Site.master`:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="d8c0a-134">Agregue también una subcarpeta `CustomProviders` a la carpeta `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>

![Agregue las páginas ASP.NET para los tutoriales relacionados con el proveedor del mapa del sitio](building-a-custom-database-driven-site-map-provider-vb/_static/image2.gif)

<span data-ttu-id="d8c0a-136">**Figura 2**: agregar las páginas ASP.net para los tutoriales relacionados con el proveedor del mapa del sitio</span><span class="sxs-lookup"><span data-stu-id="d8c0a-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>

<span data-ttu-id="d8c0a-137">Dado que solo hay un tutorial para esta sección, no es necesario `Default.aspx` para enumerar los tutoriales de la sección.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="d8c0a-138">En su lugar, `Default.aspx` mostrará las categorías en un control GridView.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="d8c0a-139">Abordaremos esto en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="d8c0a-140">A continuación, actualice `Web.sitemap` para incluir una referencia a la página de `Default.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="d8c0a-141">En concreto, agregue el siguiente marcado después del `<siteMapNode>`de almacenamiento en caché:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample1.xml)]

<span data-ttu-id="d8c0a-142">Después de actualizar `Web.sitemap`, dedique un momento a ver el sitio web de tutoriales a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="d8c0a-143">El menú de la izquierda incluye ahora un elemento para el tutorial del proveedor del mapa del sitio único.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>

![El mapa del sitio ahora incluye una entrada para el tutorial del proveedor del mapa del sitio](building-a-custom-database-driven-site-map-provider-vb/_static/image3.gif)

<span data-ttu-id="d8c0a-145">**Figura 3**: ahora, el mapa del sitio incluye una entrada para el tutorial del proveedor del mapa del sitio</span><span class="sxs-lookup"><span data-stu-id="d8c0a-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>

<span data-ttu-id="d8c0a-146">El enfoque principal de este tutorial es ilustrar la creación de un proveedor de mapa del sitio personalizado y la configuración de una aplicación web para que use ese proveedor.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="d8c0a-147">En concreto, crearemos un proveedor que devuelva un mapa del sitio que incluya un nodo raíz junto con un nodo para cada categoría y producto, como se muestra en la figura 1.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="d8c0a-148">En general, cada nodo del mapa del sitio puede especificar una dirección URL.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="d8c0a-149">En nuestro mapa del sitio, la dirección URL del nodo raíz se `~/SiteMapProvider/Default.aspx`, que enumerará todas las categorías de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="d8c0a-150">Cada nodo de categoría del mapa del sitio tendrá una dirección URL que señala a `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, que enumerará todos los productos del *CategoryID*especificado.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="d8c0a-151">Por último, cada nodo del mapa del sitio del producto apuntará a `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, que mostrará los detalles específicos del producto.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="d8c0a-152">Para empezar, es necesario crear las páginas `Default.aspx`, `ProductsByCategory.aspx`y `ProductDetails.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="d8c0a-153">Estas páginas se completan en los pasos 2, 3 y 4, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="d8c0a-154">Dado que el paso de este tutorial está en los proveedores del mapa del sitio, y como los tutoriales anteriores han explicado la creación de estos tipos de informes maestros y detallados de varias páginas, se realizarán prisas pasos del 2 al 4.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="d8c0a-155">Si necesita un actualizador para crear informes maestros y detallados que abarquen varias páginas, consulte el tutorial de [filtrado maestro y detalles en dos páginas](../masterdetail/master-detail-filtering-across-two-pages-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="d8c0a-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-vb.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="d8c0a-156">Paso 2: mostrar una lista de categorías</span><span class="sxs-lookup"><span data-stu-id="d8c0a-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="d8c0a-157">Abra la página `Default.aspx` en la carpeta `SiteMapProvider` y arrastre un control GridView desde el cuadro de herramientas hasta el diseñador, estableciendo su `ID` en `Categories`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="d8c0a-158">En la etiqueta inteligente de GridView s, enlácelo a un nuevo ObjectDataSource denominado `CategoriesDataSource` y configúrelo para que recupere sus datos mediante el método `CategoriesBLL` de clase s `GetCategories`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="d8c0a-159">Puesto que este GridView solo muestra las categorías y no proporciona capacidades de modificación de datos, establezca las listas desplegables de las pestañas actualizar, insertar y eliminar en (ninguna).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="d8c0a-160">[![configurar ObjectDataSource para devolver categorías mediante el método GetCategories](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span></span>

<span data-ttu-id="d8c0a-161">**Figura 4**: configuración de ObjectDataSource para devolver las categorías con el método `GetCategories` ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span></span>

<span data-ttu-id="d8c0a-162">[![establecer las listas desplegables de las pestañas actualizar, insertar y eliminar en (ninguna)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span></span>

<span data-ttu-id="d8c0a-163">**Figura 5**: establecer las listas desplegables de las pestañas actualizar, insertar y eliminar en (ninguna) ([haga clic para ver la imagen a tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span></span>

<span data-ttu-id="d8c0a-164">Después de completar el Asistente para configurar orígenes de datos, Visual Studio agregará un BoundField para `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`y `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="d8c0a-165">Edite GridView para que solo contenga el `CategoryName` y `Description` BoundFields y actualice la propiedad `CategoryName` BoundField s `HeaderText` a Category.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="d8c0a-166">Después, agregue un HyperLinkField y colóquelo para que sea el campo situado más a la izquierda.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="d8c0a-167">Establezca la propiedad `DataNavigateUrlFields` en `CategoryID` y la propiedad `DataNavigateUrlFormatString` en `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="d8c0a-168">Establezca la propiedad `Text` para ver productos.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-168">Set the `Text` property to View Products .</span></span>

![Agregar un HyperLinkField a las categorías GridView](building-a-custom-database-driven-site-map-provider-vb/_static/image6.gif)

<span data-ttu-id="d8c0a-170">**Ilustración 6**: agregar un HyperLinkField a la `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="d8c0a-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>

<span data-ttu-id="d8c0a-171">Después de crear el origen ObjectDataSource y personalizar los campos de GridView, los dos controles declarativos de marcado tendrán un aspecto similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample2.aspx)]

<span data-ttu-id="d8c0a-172">La figura 7 muestra `Default.aspx` cuando se ve a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="d8c0a-173">Al hacer clic en un vínculo categoría, ver productos le llevará a `ProductsByCategory.aspx?CategoryID=categoryID`, que crearemos en el paso 3.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>

<span data-ttu-id="d8c0a-174">[![cada categoría aparece junto con un vínculo Ver productos](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span></span>

<span data-ttu-id="d8c0a-175">**Figura 7**: cada categoría aparece junto con un vínculo Ver productos ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span></span>

## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="d8c0a-176">Paso 3: enumerar los productos de la categoría seleccionada</span><span class="sxs-lookup"><span data-stu-id="d8c0a-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="d8c0a-177">Abra la página `ProductsByCategory.aspx` y agregue un control GridView que le asigne un nombre `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="d8c0a-178">Desde su etiqueta inteligente, enlace GridView a un nuevo ObjectDataSource denominado `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="d8c0a-179">Configure ObjectDataSource para usar el método `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` y establezca las listas desplegables en (ninguno) en las pestañas actualizar, insertar y eliminar.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="d8c0a-180">[![usar el método ProductsBLL de la clase GetProductsByCategoryID (categoryID)](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span></span>

<span data-ttu-id="d8c0a-181">**Figura 8**: uso del método `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span></span>

<span data-ttu-id="d8c0a-182">El paso final del Asistente para configurar orígenes de datos solicita un origen de parámetro para *CategoryID*.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="d8c0a-183">Puesto que esta información se pasa a través del campo QueryString `CategoryID`, seleccione QueryString en la lista desplegable y escriba CategoryID en el cuadro de texto QueryStringField como se muestra en la figura 9.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="d8c0a-184">Haga clic en Finalizar para completar el asistente.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-184">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="d8c0a-185">[![usar el campo QueryString QueryString para el parámetro categoryID](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span></span>

<span data-ttu-id="d8c0a-186">**Figura 9**: Use el campo `CategoryID` QueryString para el parámetro *CategoryID* ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span></span>

<span data-ttu-id="d8c0a-187">Después de completar el asistente, Visual Studio agregará los valores de BoundFields y CheckBoxField correspondientes a GridView para los campos de datos del producto.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="d8c0a-188">Quite todos los `ProductName`, `UnitPrice`y `SupplierName` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="d8c0a-189">Personalice estas tres propiedades de `HeaderText` de BoundFields para leer productos, precios y proveedores, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="d8c0a-190">Dé formato a la `UnitPrice` BoundField como moneda.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="d8c0a-191">A continuación, agregue un HyperLinkField y muévalo a la posición situada más a la izquierda.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="d8c0a-192">Establezca su propiedad `Text` en ver detalles, su propiedad `DataNavigateUrlFields` en `ProductID`y su propiedad `DataNavigateUrlFormatString` en `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>

![Agregar un HyperLinkField de detalles de vista que apunte a ProductDetails. aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image10.gif)

<span data-ttu-id="d8c0a-194">**Figura 10**: agregar un HyperLinkField de detalles de vista que apunte a `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="d8c0a-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>

<span data-ttu-id="d8c0a-195">Después de llevar a cabo estas personalizaciones, el marcado declarativo de GridView y ObjectDataSource es similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample3.aspx)]

<span data-ttu-id="d8c0a-196">Vuelva a ver `Default.aspx` a través de un explorador y haga clic en el vínculo Ver productos para bebidas.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="d8c0a-197">Esto le llevará a `ProductsByCategory.aspx?CategoryID=1`, que muestra los nombres, precios y proveedores de los productos de la base de datos Northwind que pertenecen a la categoría Beverages (consulte la figura 11).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="d8c0a-198">No dude en mejorar aún más esta página para incluir un vínculo para devolver a los usuarios a la página de lista de categorías (`Default.aspx`) y un control DetailsView o FormView que muestre el nombre y la descripción de la categoría seleccionada.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>

<span data-ttu-id="d8c0a-199">[![se muestran los nombres, precios y proveedores de las bebidas](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span></span>

<span data-ttu-id="d8c0a-200">**Figura 11**: se muestran los nombres, precios y proveedores de las bebidas ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span></span>

## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="d8c0a-201">Paso 4: mostrar los detalles de un producto</span><span class="sxs-lookup"><span data-stu-id="d8c0a-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="d8c0a-202">En la página final, `ProductDetails.aspx`, se muestran los detalles de los productos seleccionados.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="d8c0a-203">Abra `ProductDetails.aspx` y arrastre un DetailsView desde el cuadro de herramientas hasta el diseñador.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="d8c0a-204">Establezca la propiedad DetailsView s `ID` en `ProductInfo` y borre sus valores de propiedad `Height` y `Width`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="d8c0a-205">A partir de su etiqueta inteligente, enlace DetailsView a un nuevo ObjectDataSource denominado `ProductDataSource`, configurando ObjectDataSource para extraer sus datos del método de `GetProductByProductID(productID)` `ProductsBLL` Class s.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="d8c0a-206">Al igual que con las páginas web anteriores creadas en los pasos 2 y 3, establezca las listas desplegables de las pestañas actualizar, insertar y eliminar en (ninguna).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="d8c0a-207">[![configurar ObjectDataSource para usar el método GetProductByProductID (productID)](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span></span>

<span data-ttu-id="d8c0a-208">**Figura 12**: configuración de ObjectDataSource para usar el método `GetProductByProductID(productID)` ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span></span>

<span data-ttu-id="d8c0a-209">El último paso del Asistente para configurar orígenes de datos solicita el origen del parámetro *ProductID* .</span><span class="sxs-lookup"><span data-stu-id="d8c0a-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="d8c0a-210">Dado que estos datos se incluyen en el campo QueryString `ProductID`, establezca la lista desplegable en QueryString y el cuadro de texto QueryStringField en ProductID.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="d8c0a-211">Por último, haga clic en el botón Finalizar para completar el asistente.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-211">Finally, click the Finish button to complete the wizard.</span></span>

<span data-ttu-id="d8c0a-212">[![configurar el parámetro productID para extraer su valor del campo de QueryString de ProductID](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span></span>

<span data-ttu-id="d8c0a-213">**Figura 13**: configure el parámetro *ProductID* para extraer su valor del campo `ProductID` QueryString ([haga clic para ver la imagen a tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span></span>

<span data-ttu-id="d8c0a-214">Después de completar el Asistente para configurar el origen de datos, Visual Studio creará BoundFields y CheckBoxField correspondientes en DetailsView para los campos de datos del producto.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="d8c0a-215">Quite los `ProductID`, `SupplierID`y `CategoryID` BoundFields y configure los campos restantes como considere oportuno.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="d8c0a-216">Después de una serie de configuraciones estéticas, el marcado declarativo de DetailsView y ObjectDataSource es similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample4.aspx)]

<span data-ttu-id="d8c0a-217">Para probar esta página, vuelva a `Default.aspx` y haga clic en Ver productos para la categoría bebidas.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="d8c0a-218">En la lista de productos de bebidas, haga clic en el vínculo ver detalles de la Tea de Chai.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="d8c0a-219">Esto le llevará a `ProductDetails.aspx?ProductID=1`, que muestra los detalles de las Chai (véase la figura 14).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>

<span data-ttu-id="d8c0a-220">[![se muestra la información sobre el proveedor, la categoría, el precio y otros datos de las Chai](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span></span>

<span data-ttu-id="d8c0a-221">**Figura 14**: se muestra el proveedor de té de Chai, la categoría, el precio y otra información ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span></span>

## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="d8c0a-222">Paso 5: Descripción del funcionamiento interno de un proveedor del mapa del sitio</span><span class="sxs-lookup"><span data-stu-id="d8c0a-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="d8c0a-223">El mapa del sitio se representa en la memoria del servidor web como una colección de instancias de `SiteMapNode` que forman una jerarquía.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="d8c0a-224">Debe haber exactamente una raíz, todos los nodos que no sean raíz deben tener exactamente un nodo primario y todos los nodos pueden tener un número arbitrario de elementos secundarios.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="d8c0a-225">Cada objeto `SiteMapNode` representa una sección en la estructura del sitio Web. Normalmente, estas secciones tienen una página web correspondiente.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="d8c0a-226">Por consiguiente, la [clase`SiteMapNode`](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) tiene propiedades como `Title`, `Url`y `Description`, que proporcionan información para la sección que representa el `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="d8c0a-227">También hay una propiedad `Key` que identifica de forma única cada `SiteMapNode` en la jerarquía, así como las propiedades que se usan para establecer esta jerarquía `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, etc.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="d8c0a-228">En la figura 15 se muestra la estructura del mapa del sitio general de la figura 1, pero con los detalles de la implementación esbozados con más detalle.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>

<span data-ttu-id="d8c0a-229">[![cada SiteMapNode tiene propiedades como título, dirección URL, clave, etc.](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span></span>

<span data-ttu-id="d8c0a-230">**Figura 15**: cada `SiteMapNode` tiene propiedades como `Title`, `Url`, `Key`, etc. ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span></span>

<span data-ttu-id="d8c0a-231">El mapa del sitio es accesible a través de la [clase`SiteMap`](https://msdn.microsoft.com/library/system.web.sitemap.aspx) en el [espacio de nombres`System.Web`](https://msdn.microsoft.com/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="d8c0a-232">Esta propiedad de clase s `RootNode` devuelve la instancia de `SiteMapNode` raíz del mapa del sitio; `CurrentNode` devuelve el `SiteMapNode` cuya propiedad `Url` coincide con la dirección URL de la página solicitada actualmente.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="d8c0a-233">Esta clase la usan internamente los controles Web de navegación de ASP.NET 2,0 s.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="d8c0a-234">Cuando se tiene acceso a las propiedades de la clase `SiteMap`, se debe serializar la estructura del mapa del sitio de un medio persistente en la memoria.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="d8c0a-235">Sin embargo, la lógica de serialización del mapa del sitio no está codificada de forma rígida en la clase `SiteMap`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="d8c0a-236">En su lugar, en tiempo de ejecución, la clase `SiteMap` determina qué *proveedor* de mapa del sitio se va a usar para la serialización.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="d8c0a-237">De forma predeterminada, se utiliza la [clase`XmlSiteMapProvider`](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) , que lee la estructura del mapa del sitio desde un archivo XML con el formato correcto.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="d8c0a-238">Sin embargo, con un poco de trabajo podemos crear nuestro propio proveedor de mapa del sitio personalizado.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="d8c0a-239">Todos los proveedores del mapa del sitio deben derivarse de la [clase`SiteMapProvider`](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), que incluye los métodos y las propiedades esenciales necesarios para los proveedores del mapa del sitio, pero omite muchos de los detalles de la implementación.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="d8c0a-240">Una segunda clase, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extiende la `SiteMapProvider` clase y contiene una implementación más sólida de la funcionalidad necesaria.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="d8c0a-241">Internamente, el `StaticSiteMapProvider` almacena las instancias de `SiteMapNode` del mapa del sitio en un `Hashtable` y proporciona métodos como `AddNode(child, parent)`, `RemoveNode(siteMapNode),` y `Clear()` que agregan y quitan `SiteMapNode` s al `Hashtable`interno.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="d8c0a-242">La clase `XmlSiteMapProvider` se deriva de la clase `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="d8c0a-243">Al crear un proveedor de mapa del sitio personalizado que extienda `StaticSiteMapProvider`, hay dos métodos abstractos que se deben invalidar: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) y [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="d8c0a-244">`BuildSiteMap`, como su nombre implica, es responsable de cargar la estructura del mapa del sitio desde el almacenamiento persistente y de construirla en la memoria.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="d8c0a-245">`GetRootNodeCore` devuelve el nodo raíz del mapa del sitio.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="d8c0a-246">Antes de que una aplicación Web pueda usar un proveedor de mapa del sitio, debe registrarse en la configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="d8c0a-247">De forma predeterminada, la clase `XmlSiteMapProvider` se registra con el nombre `AspNetXmlSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="d8c0a-248">Para registrar proveedores adicionales del mapa del sitio, agregue el marcado siguiente a `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample5.xml)]

<span data-ttu-id="d8c0a-249">El valor *Name* asigna un nombre legible al proveedor mientras que *Type* especifica el nombre de tipo completo del proveedor del mapa del sitio.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="d8c0a-250">Exploraremos los valores concretos de los valores de *nombre* y *tipo* en el paso 7, después de crear nuestro proveedor de mapa del sitio personalizado.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="d8c0a-251">Se crea una instancia de la clase del proveedor del mapa del sitio la primera vez que se tiene acceso a ella desde la clase `SiteMap` y permanece en memoria durante la vigencia de la aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="d8c0a-252">Puesto que solo hay una instancia del proveedor del mapa del sitio que se puede invocar desde varios visitantes de sitios web simultáneos, es imperativo que los métodos del proveedor sean *seguros para subprocesos*.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="d8c0a-253">Por motivos de rendimiento y escalabilidad, es importante que almacenemos en caché la estructura del mapa del sitio en memoria y devuelvan esta estructura almacenada en caché en lugar de volver a crearla cada vez que se invoque el método de `BuildSiteMap`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="d8c0a-254">se puede llamar a `BuildSiteMap` varias veces por cada solicitud de página por usuario, dependiendo de los controles de navegación en uso en la página y la profundidad de la estructura del mapa del sitio.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="d8c0a-255">En cualquier caso, si no se almacena en caché la estructura del mapa del sitio en `BuildSiteMap` cada vez que se invoca, es necesario volver a recuperar la información del producto y de la categoría de la arquitectura (lo que daría lugar a una consulta a la base de datos).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="d8c0a-256">Como hemos comentado en los tutoriales de Caching anteriores, los datos almacenados en caché pueden quedar obsoletos.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="d8c0a-257">Para combatir esto, podemos usar Expires basados en la memoria caché de tiempo o SQL.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="d8c0a-258">Un proveedor del mapa del sitio puede reemplazar opcionalmente el [método`Initialize`](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="d8c0a-259">`Initialize` se invoca cuando se crea una instancia del proveedor del mapa del sitio y se pasan los atributos personalizados asignados al proveedor en `Web.config` en el elemento `<add>` como: `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="d8c0a-260">Resulta útil si desea permitir que un desarrollador de páginas especifique varios valores relacionados con el proveedor del mapa del sitio sin tener que modificar el código del proveedor.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="d8c0a-261">Por ejemplo, si se leían los datos de la categoría y los productos directamente desde la base de datos en lugar de hacerlo a través de la arquitectura, es probable que desee permitir que el desarrollador de la página especifique la cadena de conexión de base de datos a través de `Web.config` en lugar de usar un valor codificado de forma rígida en el código del proveedor.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="d8c0a-262">El proveedor del mapa del sitio personalizado que crearemos en el paso 6 no invalida este método `Initialize`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="d8c0a-263">Para obtener un ejemplo de cómo usar el método `Initialize`, consulte [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [almacenamiento de mapas de sitio en SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) artículo.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>

## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="d8c0a-264">Paso 6: creación del proveedor del mapa del sitio personalizado</span><span class="sxs-lookup"><span data-stu-id="d8c0a-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="d8c0a-265">Para crear un proveedor de mapa del sitio personalizado que genere el mapa del sitio a partir de las categorías y los productos de la base de datos Northwind, es necesario crear una clase que extienda `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="d8c0a-266">En el paso 1, se le pidió agregar una carpeta `CustomProviders` en la carpeta `App_Code`: agregar una nueva clase a esta carpeta denominada `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="d8c0a-267">Agregue el código siguiente a la clase `NorthwindSiteMapProvider`:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample6.vb)]

<span data-ttu-id="d8c0a-268">Comencemos con la exploración de esta clase `BuildSiteMap` método, que comienza con una [instrucción`lock`](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="d8c0a-269">La instrucción `lock` solo permite que un subproceso cada vez escriba, con lo que se serializa el acceso a su código y se evita que dos subprocesos simultáneos se recorran en otro pies s.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="d8c0a-270">La variable de `SiteMapNode` de nivel de clase `root` se utiliza para almacenar en caché la estructura del mapa del sitio.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="d8c0a-271">Cuando el mapa del sitio se crea por primera vez, o por primera vez después de que se hayan modificado los datos subyacentes, se `Nothing`rá `root` y se construirá la estructura del mapa del sitio.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `Nothing` and the site map structure will be constructed.</span></span> <span data-ttu-id="d8c0a-272">El nodo raíz del mapa del sitio se asigna a `root` durante el proceso de construcción para que la próxima vez que se llame a este método, `root` no se `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `Nothing`.</span></span> <span data-ttu-id="d8c0a-273">Por consiguiente, siempre y cuando `root` no sea `Nothing` la estructura del mapa del sitio se devolverá al llamador sin tener que volver a crearlo.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-273">Consequently, so long as `root` is not `Nothing` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="d8c0a-274">Si la raíz es `Nothing`, se crea la estructura del mapa del sitio a partir de la información del producto y de la categoría.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-274">If root is `Nothing`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="d8c0a-275">El mapa del sitio se crea creando las instancias de `SiteMapNode` y, a continuación, formando la jerarquía mediante llamadas al método `AddNode` de la clase `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="d8c0a-276">`AddNode` realiza la contabilidad interna, almacenando las instancias de `SiteMapNode` ordenadas en un `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="d8c0a-277">Antes de empezar a construir la jerarquía, comenzamos llamando al método `Clear`, que borra los elementos del `Hashtable`interno.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="d8c0a-278">A continuación, el método de `GetProducts` de `ProductsBLL` Class y el `ProductsDataTable` resultante se almacenan en variables locales.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="d8c0a-279">La construcción del mapa del sitio empieza por crear el nodo raíz y asignarlo a `root`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="d8c0a-280">La sobrecarga del [constructor`SiteMapNode` s](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) que se usa aquí y a lo largo de este `BuildSiteMap` se pasa a la siguiente información:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="d8c0a-281">Referencia al proveedor del mapa del sitio (`Me`).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-281">A reference to the site map provider (`Me`).</span></span>
- <span data-ttu-id="d8c0a-282">`Key``SiteMapNode` s.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="d8c0a-283">Este valor obligatorio debe ser único para cada `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="d8c0a-284">`Url``SiteMapNode` s.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="d8c0a-285">`Url` es opcional, pero si se proporciona, cada `SiteMapNode` `Url` valor debe ser único.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="d8c0a-286">`SiteMapNode` s `Title`, que es necesario.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="d8c0a-287">La llamada al método `AddNode(root)` agrega el `root` de `SiteMapNode` al mapa del sitio como raíz.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="d8c0a-288">A continuación, se enumeran todos los `ProductRow` en el `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="d8c0a-289">Si ya existe un `SiteMapNode` para la categoría de producto actual, se hace referencia a él.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="d8c0a-290">De lo contrario, se crea un nuevo `SiteMapNode` para la categoría y se agrega como un elemento secundario del `SiteMapNode``root` a través de la llamada al método `AddNode(categoryNode, root)`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="d8c0a-291">Una vez que se ha encontrado o creado la categoría adecuada `SiteMapNode` nodo, se crea un `SiteMapNode` para el producto actual y se agrega como un elemento secundario de la categoría `SiteMapNode` a través de `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="d8c0a-292">Tenga en cuenta que el valor de la propiedad Category `SiteMapNode` s `Url` es `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` mientras que la propiedad Product `SiteMapNode` s `Url` está asignada `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="d8c0a-293">Los productos que tienen un valor de `NULL` de base de datos para sus `CategoryID` se agrupan en una categoría `SiteMapNode` cuya propiedad `Title` está establecida en None y cuya propiedad `Url` está establecida en una cadena vacía.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="d8c0a-294">Decidí establecer `Url` en una cadena vacía, ya que el método `ProductBLL` clase s `GetProductsByCategory(categoryID)` actualmente no tiene la capacidad de devolver solo los productos con un valor de `CategoryID` `NULL`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="d8c0a-295">Además, quería demostrar cómo los controles de navegación representan un `SiteMapNode` que carece de un valor para su propiedad `Url`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="d8c0a-296">Le recomiendo ampliar este tutorial para que la propiedad None `SiteMapNode` s `Url` apunte a `ProductsByCategory.aspx`, pero solo muestra los productos con `NULL` valores `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>

<span data-ttu-id="d8c0a-297">Después de construir el mapa del sitio, se agrega un objeto arbitrario a la memoria caché de datos utilizando una dependencia de caché de SQL en las tablas `Categories` y `Products` a través de un objeto `AggregateCacheDependency`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="d8c0a-298">Hemos explorado el uso de las dependencias de caché de SQL en el tutorial anterior, *con las dependencias de caché de SQL*.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="d8c0a-299">Sin embargo, el proveedor del mapa del sitio personalizado usa una sobrecarga del método `Insert` de la caché de datos que se va a explorar todavía.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="d8c0a-300">Esta sobrecarga acepta como su parámetro de entrada final un delegado al que se llama cuando el objeto se quita de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="d8c0a-301">En concreto, pasamos un nuevo [delegado`CacheItemRemovedCallback`](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) que apunta al método `OnSiteMapChanged` definido más abajo en la clase `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="d8c0a-302">La representación en memoria del mapa del sitio se almacena en la memoria caché a través de la variable de nivel de clase `root`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="d8c0a-303">Dado que solo hay una instancia de la clase del proveedor del mapa del sitio personalizado y que la instancia se comparte entre todos los subprocesos de la aplicación Web, esta variable de clase actúa como una memoria caché.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="d8c0a-304">El método `BuildSiteMap` también utiliza la memoria caché de datos, pero solo como un medio para recibir notificaciones cuando cambian los datos de la base de datos subyacente en las tablas `Categories` o `Products`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="d8c0a-305">Tenga en cuenta que el valor colocado en la memoria caché de datos es solo la fecha y hora actuales.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="d8c0a-306">Los datos reales del mapa del sitio *no* se colocan en la memoria caché de datos.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-306">The actual site map data is *not* put in the data cache.</span></span>

<span data-ttu-id="d8c0a-307">El método `BuildSiteMap` finaliza devolviendo el nodo raíz del mapa del sitio.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="d8c0a-308">Los métodos restantes son bastante sencillos.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="d8c0a-309">`GetRootNodeCore` es responsable de devolver el nodo raíz.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="d8c0a-310">Puesto que `BuildSiteMap` devuelve la raíz, `GetRootNodeCore` simplemente devuelve el valor devuelto de `BuildSiteMap` s.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="d8c0a-311">El método `OnSiteMapChanged` establece `root` de nuevo en `Nothing` cuando se quita el elemento de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-311">The `OnSiteMapChanged` method sets `root` back to `Nothing` when the cache item is removed.</span></span> <span data-ttu-id="d8c0a-312">Con la raíz establecida en `Nothing`, la próxima vez que se invoque `BuildSiteMap`, se volverá a generar la estructura del mapa del sitio.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-312">With root set back to `Nothing`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="d8c0a-313">Por último, la propiedad `CachedDate` devuelve el valor de fecha y hora almacenado en la memoria caché de datos, si este valor existe.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="d8c0a-314">El desarrollador de páginas puede usar esta propiedad para determinar cuándo se han almacenado en caché los datos del mapa del sitio por última vez.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="d8c0a-315">Paso 7: registrar el`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="d8c0a-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="d8c0a-316">Para que nuestra aplicación web use el proveedor del mapa del sitio de `NorthwindSiteMapProvider` creado en el paso 6, es necesario registrarlo en la sección `<siteMap>` de `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="d8c0a-317">En concreto, agregue el siguiente marcado en el elemento `<system.web>` de `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample7.xml)]

<span data-ttu-id="d8c0a-318">Este marcado hace dos cosas: en primer lugar, indica que el `AspNetXmlSiteMapProvider` integrado es el proveedor del mapa del sitio predeterminado; en segundo lugar, registra el proveedor del mapa del sitio personalizado creado en el paso 6 con el nombre descriptivo Northwind.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="d8c0a-319">En el caso de los proveedores del mapa del sitio ubicados en la carpeta Application s `App_Code`, el valor del atributo `type` es simplemente el nombre de clase.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="d8c0a-320">Como alternativa, el proveedor del mapa del sitio personalizado podría haberse creado en un proyecto de biblioteca de clases independiente con el ensamblado compilado colocado en el directorio de `/Bin` de la aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="d8c0a-321">En ese caso, el valor del atributo `type` sería el *espacio de nombres*. *ClassName*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="d8c0a-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>

<span data-ttu-id="d8c0a-322">Después de actualizar `Web.config`, dedique un momento a ver cualquier página de los tutoriales en un explorador.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="d8c0a-323">Tenga en cuenta que la interfaz de navegación de la izquierda sigue mostrando las secciones y los tutoriales definidos en `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="d8c0a-324">Esto se debe a que hemos dejado `AspNetXmlSiteMapProvider` como proveedor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="d8c0a-325">Con el fin de crear un elemento de interfaz de usuario de navegación que use el `NorthwindSiteMapProvider`, deberá especificar explícitamente que se debe usar el proveedor de mapa del sitio de Northwind.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="d8c0a-326">Veremos cómo hacerlo en el paso 8.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="d8c0a-327">Paso 8: Mostrar información del mapa del sitio mediante el proveedor del mapa del sitio personalizado</span><span class="sxs-lookup"><span data-stu-id="d8c0a-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="d8c0a-328">Con el proveedor del mapa del sitio personalizado creado y registrado en `Web.config`, se vuelve a preparar para agregar controles de navegación a las páginas `Default.aspx`, `ProductsByCategory.aspx`y `ProductDetails.aspx` de la carpeta `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="d8c0a-329">Comience abriendo la página de `Default.aspx` y arrastre una `SiteMapPath` desde el cuadro de herramientas hasta el diseñador.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="d8c0a-330">El control SiteMapPath se encuentra en la sección de navegación del cuadro de herramientas.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>

<span data-ttu-id="d8c0a-331">[![agregar un SiteMapPath a default. aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span></span>

<span data-ttu-id="d8c0a-332">**Figura 16**: agregar un SiteMapPath a `Default.aspx` ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span></span>

<span data-ttu-id="d8c0a-333">El control SiteMapPath muestra una ruta de navegación, que indica la ubicación de la página actual en el mapa del sitio.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="d8c0a-334">Se ha agregado un SiteMapPath a la parte superior de la página maestra en el tutorial de navegación por el *sitio y las páginas maestras* .</span><span class="sxs-lookup"><span data-stu-id="d8c0a-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="d8c0a-335">Tómese un momento para ver esta página a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="d8c0a-336">El SiteMapPath agregado en la figura 16 utiliza el proveedor del mapa del sitio predeterminado, extrayendo sus datos de `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="d8c0a-337">Por lo tanto, la ruta de navegación muestra Inicio &gt; personalizar el mapa del sitio, al igual que la ruta de navegación en la esquina superior derecha.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>

<span data-ttu-id="d8c0a-338">[![la ruta de navegación utiliza el proveedor del mapa del sitio predeterminado](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span></span>

<span data-ttu-id="d8c0a-339">**Figura 17**: la ruta de navegación utiliza el proveedor del mapa del sitio predeterminado ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span></span>

<span data-ttu-id="d8c0a-340">Para que el SiteMapPath agregado en la figura 16 use el proveedor del mapa del sitio personalizado que creamos en el paso 6, establezca su [propiedad`SiteMapProvider`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) en Northwind, el nombre que asignamos a la `NorthwindSiteMapProvider` en `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="d8c0a-341">Desafortunadamente, el diseñador sigue usando el proveedor del mapa del sitio predeterminado, pero si visita la página a través de un explorador después de hacer este cambio de propiedad, verá que la ruta de navegación ahora usa el proveedor del mapa del sitio personalizado.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>

<span data-ttu-id="d8c0a-342">[![la ruta de navegación ahora utiliza el proveedor del mapa del sitio personalizado NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span></span>

<span data-ttu-id="d8c0a-343">**Figura 18**: ahora, la ruta de navegación utiliza el proveedor del mapa del sitio personalizado `NorthwindSiteMapProvider` ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span></span>

<span data-ttu-id="d8c0a-344">El control SiteMapPath muestra una interfaz de usuario más funcional en las páginas `ProductsByCategory.aspx` y `ProductDetails.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="d8c0a-345">Agregue un SiteMapPath a estas páginas y establezca la propiedad `SiteMapProvider` en Northwind.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="d8c0a-346">En `Default.aspx` haga clic en el vínculo Ver productos para bebidas y, a continuación, en el vínculo ver detalles de la té de Chai.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="d8c0a-347">Como se muestra en la figura 19, la ruta de navegación incluye la sección del mapa del sitio actual (té de Chai) y sus antecesores: bebidas y todas las categorías.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>

<span data-ttu-id="d8c0a-348">[![la ruta de navegación ahora utiliza el proveedor del mapa del sitio personalizado NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span></span>

<span data-ttu-id="d8c0a-349">**Figura 19**: la ruta de navegación ahora usa el proveedor del mapa del sitio personalizado `NorthwindSiteMapProvider` ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span></span>

<span data-ttu-id="d8c0a-350">Se pueden usar otros elementos de la interfaz de usuario de navegación además de SiteMapPath, como los controles menu y TreeView.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="d8c0a-351">Las páginas `Default.aspx`, `ProductsByCategory.aspx`y `ProductDetails.aspx` de la descarga para este tutorial, por ejemplo, todos los controles de menú de inclusión (vea la figura 20).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="d8c0a-352">Consulte [examen de las características de navegación del sitio de ASP.NET 2,0 s](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) y la sección uso de los [controles de navegación de sitios](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) de las guías de [Inicio rápido de ASP.net 2,0](https://quickstarts.asp.net/QuickStartv20/aspnet/) para obtener información más detallada sobre los controles de navegación y el sistema del mapa del sitio en ASP.net 2,0.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>

<span data-ttu-id="d8c0a-353">[![el control de menú muestra cada una de las categorías y productos](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span></span>

<span data-ttu-id="d8c0a-354">**Figura 20**: el control de menú muestra cada una de las categorías y los productos ([haga clic para ver la imagen de tamaño completo](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="d8c0a-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span></span>

<span data-ttu-id="d8c0a-355">Como se mencionó anteriormente en este tutorial, se puede obtener acceso a la estructura del mapa del sitio mediante programación a través de la clase `SiteMap`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="d8c0a-356">El código siguiente devuelve el `SiteMapNode` raíz del proveedor predeterminado:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample8.vb)]

<span data-ttu-id="d8c0a-357">Como el `AspNetXmlSiteMapProvider` es el proveedor predeterminado para nuestra aplicación, el código anterior devolvería el nodo raíz definido en `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="d8c0a-358">Para hacer referencia a un proveedor del mapa del sitio que no sea el predeterminado, use la propiedad `SiteMap` clase s [`Providers`](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample9.vb)]

<span data-ttu-id="d8c0a-359">Donde *Name* es el nombre del proveedor del mapa del sitio personalizado (Northwind, para nuestra aplicación web).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="d8c0a-360">Para tener acceso a un miembro específico de un proveedor del mapa del sitio, utilice `SiteMap.Providers["name"]` para recuperar la instancia del proveedor y, a continuación, conviértala al tipo adecuado.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="d8c0a-361">Por ejemplo, para mostrar la propiedad `NorthwindSiteMapProvider` s `CachedDate` en una página de ASP.NET, use el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample10.vb)]

> [!NOTE]
> <span data-ttu-id="d8c0a-362">Asegúrese de probar la característica de dependencia de caché de SQL.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="d8c0a-363">Después de visitar las páginas `Default.aspx`, `ProductsByCategory.aspx`y `ProductDetails.aspx`, vaya a uno de los tutoriales de la sección edición, inserción y eliminación y edite el nombre de una categoría o producto.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="d8c0a-364">A continuación, vuelva a una de las páginas de la carpeta `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="d8c0a-365">Suponiendo que haya transcurrido el tiempo suficiente para que el mecanismo de sondeo tenga en cuenta el cambio en la base de datos subyacente, el mapa del sitio debe actualizarse para mostrar el nuevo nombre de producto o categoría.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>

## <a name="summary"></a><span data-ttu-id="d8c0a-366">Resumen</span><span class="sxs-lookup"><span data-stu-id="d8c0a-366">Summary</span></span>

<span data-ttu-id="d8c0a-367">Las características del mapa del sitio de ASP.NET 2,0 s incluyen una clase `SiteMap`, una serie de controles Web de navegación integrados y un proveedor del mapa del sitio predeterminado que espera que la información del mapa del sitio se conserve en un archivo XML.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="d8c0a-368">Para usar la información del mapa del sitio de otro origen, como una base de datos, la arquitectura de la aplicación o un servicio Web remoto, es necesario crear un proveedor del mapa del sitio personalizado.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="d8c0a-369">Esto implica la creación de una clase que deriva, directa o indirectamente, de la clase `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="d8c0a-370">En este tutorial, vimos cómo crear un proveedor de mapa del sitio personalizado basado en el mapa del sitio en la información del producto y de la categoría que se ha quitado de la arquitectura de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="d8c0a-371">Nuestro proveedor amplió la `StaticSiteMapProvider` clase e informaba de la creación de un `BuildSiteMap` método que recuperó los datos, construyó la jerarquía del mapa del sitio y almacenó en caché la estructura resultante en una variable de nivel de clase.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="d8c0a-372">Usamos una dependencia de caché de SQL con una función de devolución de llamada para invalidar la estructura almacenada en caché cuando se modifican los datos subyacentes `Categories` o `Products`.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="d8c0a-373">¡ Feliz programación!</span><span class="sxs-lookup"><span data-stu-id="d8c0a-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="d8c0a-374">Información adicional</span><span class="sxs-lookup"><span data-stu-id="d8c0a-374">Further Reading</span></span>

<span data-ttu-id="d8c0a-375">Para obtener más información sobre los temas descritos en este tutorial, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="d8c0a-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="d8c0a-376">[Almacenar mapas de sitio en SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) y [el proveedor del mapa del sitio de SQL al que está esperando](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="d8c0a-377">Un vistazo al modelo de proveedor de ASP.NET 2,0 s</span><span class="sxs-lookup"><span data-stu-id="d8c0a-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="d8c0a-378">El kit de herramientas del proveedor</span><span class="sxs-lookup"><span data-stu-id="d8c0a-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="d8c0a-379">Examen de las características de navegación del sitio de ASP.NET 2,0 s</span><span class="sxs-lookup"><span data-stu-id="d8c0a-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="d8c0a-380">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="d8c0a-380">About the Author</span></span>

<span data-ttu-id="d8c0a-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros de ASP/ASP. net y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha estado trabajando con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d8c0a-382">Scott funciona como consultor, profesor y redactor independiente.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d8c0a-383">Su último libro se [*enseña a ASP.NET 2,0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="d8c0a-384">Puede ponerse en contacto con usted en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="d8c0a-385">o a través de su blog, que encontrará en [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="d8c0a-385">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="d8c0a-386">Agradecimiento especial a</span><span class="sxs-lookup"><span data-stu-id="d8c0a-386">Special Thanks To</span></span>

<span data-ttu-id="d8c0a-387">Muchos revisores útiles revisaron esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-387">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d8c0a-388">Los revisores responsables de este tutorial fueron Dave Gardner, Zack Jones, Teresa Murphy y Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="d8c0a-388">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="d8c0a-389">¿Está interesado en revisar los próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="d8c0a-389">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d8c0a-390">En caso afirmativo, suéltelo en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d8c0a-390">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="d8c0a-391">Anterior</span><span class="sxs-lookup"><span data-stu-id="d8c0a-391">Previous</span></span>](building-a-custom-database-driven-site-map-provider-cs.md)
