---
uid: web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-vb
title: Desbloquear y aprobar cuentas de usuario (VB) | Microsoft Docs
author: rick-anderson
description: En este tutorial se muestra cómo crear una página web para que los administradores administren los Estados de los usuarios bloqueados y aprobados. También veremos cómo aprobar nuevos usuarios o...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 041854a5-ea8c-4de0-82f1-121ba6cb2893
msc.legacyurl: /web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-vb
msc.type: authoredcontent
ms.openlocfilehash: 4a7474676b8f502c583e226678de2b275e0ea3c7
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/28/2019
ms.locfileid: "74590618"
---
# <a name="unlocking-and-approving-user-accounts-vb"></a><span data-ttu-id="9bea7-104">Desbloquear y autorizar cuentas de usuario (VB)</span><span class="sxs-lookup"><span data-stu-id="9bea7-104">Unlocking and Approving User Accounts (VB)</span></span>

<span data-ttu-id="9bea7-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9bea7-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9bea7-106">[Descargar código](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.14.zip) o [Descargar PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="9bea7-106">[Download Code](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.14.zip) or [Download PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_vb.pdf)</span></span>

> <span data-ttu-id="9bea7-107">En este tutorial se muestra cómo crear una página web para que los administradores administren los Estados de los usuarios bloqueados y aprobados.</span><span class="sxs-lookup"><span data-stu-id="9bea7-107">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="9bea7-108">También veremos cómo aprobar nuevos usuarios solo después de haber comprobado su dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="9bea7-108">We will also see how to approve new users only after they have verified their email address.</span></span>

## <a name="introduction"></a><span data-ttu-id="9bea7-109">Introducción</span><span class="sxs-lookup"><span data-stu-id="9bea7-109">Introduction</span></span>

<span data-ttu-id="9bea7-110">Junto con un nombre de usuario, una contraseña y un correo electrónico, cada cuenta de usuario tiene dos campos de estado que determinan si el usuario puede iniciar sesión en el sitio: bloqueado y aprobado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-110">Along with a username, password, and email, each user account has two status fields that dictate whether the user can log into the site: locked out and approved.</span></span> <span data-ttu-id="9bea7-111">Un usuario se bloquea automáticamente si proporciona credenciales no válidas un número especificado de veces dentro de un número especificado de minutos (la configuración predeterminada bloquea a un usuario después de 5 intentos de inicio de sesión no válidos en 10 minutos).</span><span class="sxs-lookup"><span data-stu-id="9bea7-111">A user is automatically locked out if they provide invalid credentials a specified number of times within a specified number of minutes (the default settings lock a user out after 5 invalid login attempts within 10 minutes).</span></span> <span data-ttu-id="9bea7-112">El estado aprobado es útil en escenarios en los que se debe llevar a cabo alguna acción antes de que un nuevo usuario pueda iniciar sesión en el sitio.</span><span class="sxs-lookup"><span data-stu-id="9bea7-112">The approved status is useful in scenarios where some action must transpire before a new user is able to log on to the site.</span></span> <span data-ttu-id="9bea7-113">Por ejemplo, un usuario podría tener que comprobar primero su dirección de correo electrónico o ser aprobada por un administrador antes de poder iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="9bea7-113">For example, a user might need to first verify their email address or be approved by an administrator before being able to login.</span></span>

<span data-ttu-id="9bea7-114">Dado que un usuario bloqueado o no aprobado no puede iniciar sesión, solo es natural preguntar cómo se pueden restablecer estos Estados.</span><span class="sxs-lookup"><span data-stu-id="9bea7-114">Because a locked out or unapproved user cannot login, it's only natural to wonder how these statuses can be reset.</span></span> <span data-ttu-id="9bea7-115">ASP.NET no incluye ninguna funcionalidad integrada ni controles Web para la administración de los Estados de los usuarios bloqueados y aprobados, en parte porque es necesario controlar estas decisiones de sitio por sitio.</span><span class="sxs-lookup"><span data-stu-id="9bea7-115">ASP.NET does not include any built-in functionality or Web controls for managing users' locked out and approved statuses, in part because these decisions need to be handled on a site-by-site basis.</span></span> <span data-ttu-id="9bea7-116">Algunos sitios pueden aprobar automáticamente todas las cuentas de usuario nuevas (comportamiento predeterminado).</span><span class="sxs-lookup"><span data-stu-id="9bea7-116">Some sites might automatically approve all new user accounts (the default behavior).</span></span> <span data-ttu-id="9bea7-117">Otros usuarios tienen un administrador que aprueba nuevas cuentas o no aprueban a los usuarios hasta que visitan un vínculo que se envía a la dirección de correo electrónico que se le proporcionó al suscribirse.</span><span class="sxs-lookup"><span data-stu-id="9bea7-117">Others have an administrator approve new accounts or do not approve users until they visit a link sent to the email address provided when they signed up.</span></span> <span data-ttu-id="9bea7-118">Del mismo modo, algunos sitios pueden bloquear a los usuarios hasta que un administrador restablece su estado, mientras que otros sitios envían un correo electrónico al usuario bloqueado con una dirección URL que pueden visitar para desbloquear su cuenta.</span><span class="sxs-lookup"><span data-stu-id="9bea7-118">Likewise, some sites may lock out users until an administrator resets their status, while other sites send an email to the locked out user with a URL they can visit to unlock their account.</span></span>

<span data-ttu-id="9bea7-119">En este tutorial se muestra cómo crear una página web para que los administradores administren los Estados de los usuarios bloqueados y aprobados.</span><span class="sxs-lookup"><span data-stu-id="9bea7-119">This tutorial shows how to build a web page for administrators to manage users' locked out and approved statuses.</span></span> <span data-ttu-id="9bea7-120">También veremos cómo aprobar nuevos usuarios solo después de haber comprobado su dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="9bea7-120">We will also see how to approve new users only after they have verified their email address.</span></span>

## <a name="step-1-managing-users-locked-out-and-approved-statuses"></a><span data-ttu-id="9bea7-121">Paso 1: administración de los Estados de los usuarios bloqueados y aprobados</span><span class="sxs-lookup"><span data-stu-id="9bea7-121">Step 1: Managing Users' Locked Out and Approved Statuses</span></span>

<span data-ttu-id="9bea7-122">En el <a id="Tutorial12"> </a>tutorial [*creación de una interfaz para seleccionar una cuenta de usuario de muchos*](building-an-interface-to-select-one-user-account-from-many-vb.md) , hemos creado una página con una lista de cada una de las cuentas de usuario en un control GridView paginado y filtrado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-122">In the <a id="Tutorial12"></a>[*Building an Interface to Select One User Account from Many*](building-an-interface-to-select-one-user-account-from-many-vb.md) tutorial we constructed a page that listed each user account in a paged, filtered GridView.</span></span> <span data-ttu-id="9bea7-123">En la cuadrícula se muestra el nombre y el correo electrónico de cada usuario, sus Estados aprobados y bloqueados, si están en línea y cualquier comentario sobre el usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-123">The grid lists each user's name and email, their approved and locked out statuses, whether they're currently online, and any comments about the user.</span></span> <span data-ttu-id="9bea7-124">Para administrar los Estados aprobados y bloqueados de los usuarios, podríamos hacer que esta cuadrícula sea editable.</span><span class="sxs-lookup"><span data-stu-id="9bea7-124">To manage users' approved and locked out statuses, we could make this grid editable.</span></span> <span data-ttu-id="9bea7-125">Para cambiar el estado aprobado de un usuario, el administrador ubicaría primero la cuenta de usuario y, a continuación, edita la fila de GridView correspondiente, activando o desactivando la casilla aprobado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-125">To change a user's approved status, the administrator would first locate the user account and then edit the corresponding GridView row, checking or unchecking the approved checkbox.</span></span> <span data-ttu-id="9bea7-126">Como alternativa, podríamos administrar los Estados aprobados y bloqueados a través de una página de ASP.NET independiente.</span><span class="sxs-lookup"><span data-stu-id="9bea7-126">Alternatively, we could manage the approved and locked out statuses through a separate ASP.NET page.</span></span>

<span data-ttu-id="9bea7-127">En este tutorial, vamos a usar dos páginas de ASP.NET: `ManageUsers.aspx` y `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-127">For this tutorial let's use two ASP.NET pages: `ManageUsers.aspx` and `UserInformation.aspx`.</span></span> <span data-ttu-id="9bea7-128">La idea es que `ManageUsers.aspx` muestra las cuentas de usuario en el sistema, mientras `UserInformation.aspx` permite que el administrador administre los Estados aprobados y bloqueados para un usuario específico.</span><span class="sxs-lookup"><span data-stu-id="9bea7-128">The idea here is that `ManageUsers.aspx` lists the user accounts in the system, while `UserInformation.aspx` enables the administrator to manage the approved and locked out statuses for a specific user.</span></span> <span data-ttu-id="9bea7-129">Nuestro primer orden de negocio es aumentar el GridView en `ManageUsers.aspx` para incluir un HyperLinkField, que se representa como una columna de vínculos.</span><span class="sxs-lookup"><span data-stu-id="9bea7-129">Our first order of business is to augment the GridView in `ManageUsers.aspx` to include a HyperLinkField, which renders as a column of links.</span></span> <span data-ttu-id="9bea7-130">Queremos que cada vínculo apunte a `UserInformation.aspx?user=UserName`, donde *username* es el nombre del usuario que se va a editar.</span><span class="sxs-lookup"><span data-stu-id="9bea7-130">We want each link to point to `UserInformation.aspx?user=UserName`, where *UserName* is the name of the user to edit.</span></span>

> [!NOTE]
> <span data-ttu-id="9bea7-131">Si descargó el código para el <a id="Tutorial13"> </a>tutorial [*recuperación y cambio de contraseñas*](recovering-and-changing-passwords-vb.md) , es posible que haya observado que la página `ManageUsers.aspx` ya contiene un conjunto de vínculos "administrar" y la página `UserInformation.aspx` proporciona una interfaz para cambiar la contraseña del usuario seleccionado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-131">If you downloaded the code for the <a id="Tutorial13"></a>[*Recovering and Changing Passwords*](recovering-and-changing-passwords-vb.md) tutorial you may have noticed that the `ManageUsers.aspx` page already contains a set of "Manage" links and the `UserInformation.aspx` page provides an interface for changing the selected user's password.</span></span> <span data-ttu-id="9bea7-132">Decidí no replicar esa funcionalidad en el código asociado a este tutorial porque funcionaba mediante la elusión de la API de pertenencia y el funcionamiento directo con la SQL Server base de datos para cambiar la contraseña de un usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-132">I decided not to replicate that functionality in the code associated with this tutorial because it worked by circumventing the Membership API and operating directly with the SQL Server database to change a user's password.</span></span> <span data-ttu-id="9bea7-133">Este tutorial comienza desde cero con la página `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-133">This tutorial starts from scratch with the `UserInformation.aspx` page.</span></span>

### <a name="adding-manage-links-to-theuseraccountsgridview"></a><span data-ttu-id="9bea7-134">Agregar vínculos de "administración" al`UserAccounts`GridView</span><span class="sxs-lookup"><span data-stu-id="9bea7-134">Adding "Manage" Links to the`UserAccounts`GridView</span></span>

<span data-ttu-id="9bea7-135">Abra la página `ManageUsers.aspx` y agregue un HyperLinkField al `UserAccounts` GridView.</span><span class="sxs-lookup"><span data-stu-id="9bea7-135">Open the `ManageUsers.aspx` page and add a HyperLinkField to the `UserAccounts` GridView.</span></span> <span data-ttu-id="9bea7-136">Establezca la propiedad `Text` de HyperLinkField en "administrar" y sus propiedades `DataNavigateUrlFields` y `DataNavigateUrlFormatString` en `UserName` y "UserInformation. aspx? User ={0}", respectivamente.</span><span class="sxs-lookup"><span data-stu-id="9bea7-136">Set the HyperLinkField's `Text` property to "Manage" and its `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties to `UserName` and "UserInformation.aspx?user={0}", respectively.</span></span> <span data-ttu-id="9bea7-137">Estos valores configuran el HyperLinkField de forma que todos los hipervínculos muestren el texto "Manage", pero cada vínculo pasa el valor de *username* adecuado a QueryString.</span><span class="sxs-lookup"><span data-stu-id="9bea7-137">These settings configure the HyperLinkField such that all of the hyperlinks display the text "Manage", but each link passes in the appropriate *UserName* value into the querystring.</span></span>

<span data-ttu-id="9bea7-138">Después de agregar HyperLinkField a GridView, dedique un momento a ver la página `ManageUsers.aspx` a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="9bea7-138">After adding the HyperLinkField to the GridView, take a moment to view the `ManageUsers.aspx` page through a browser.</span></span> <span data-ttu-id="9bea7-139">Como se muestra en la figura 1, cada fila de GridView ahora incluye un vínculo "administrar".</span><span class="sxs-lookup"><span data-stu-id="9bea7-139">As Figure 1 shows, each GridView row now includes a "Manage" link.</span></span> <span data-ttu-id="9bea7-140">Vínculo "administrar" para que los puntos de Bruce se `UserInformation.aspx?user=Bruce`, mientras que el vínculo "administrar" de Dave apunta a `UserInformation.aspx?user=Dave`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-140">The "Manage" link for Bruce points to `UserInformation.aspx?user=Bruce`, whereas the "Manage" link for Dave points to `UserInformation.aspx?user=Dave`.</span></span>

<span data-ttu-id="9bea7-141">[![HyperLinkField agrega un](unlocking-and-approving-user-accounts-vb/_static/image2.png)](unlocking-and-approving-user-accounts-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9bea7-141">[![The HyperLinkField Adds a](unlocking-and-approving-user-accounts-vb/_static/image2.png)](unlocking-and-approving-user-accounts-vb/_static/image1.png)</span></span>

<span data-ttu-id="9bea7-142">**Figura 1**: el HyperLinkField agrega un vínculo "administrar" para cada cuenta de usuario ([haga clic para ver la imagen de tamaño completo](unlocking-and-approving-user-accounts-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="9bea7-142">**Figure 1**: The HyperLinkField Adds a "Manage" Link for Each User Account  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image3.png))</span></span>

<span data-ttu-id="9bea7-143">Vamos a crear la interfaz de usuario y el código para la página `UserInformation.aspx` en un momento, pero primero vamos a hablar sobre cómo cambiar mediante programación los Estados bloqueado y aprobado de un usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-143">We will create the user interface and code for the `UserInformation.aspx` page in a moment, but first let's talk about how to programmatically change a user's locked out and approved statuses.</span></span> <span data-ttu-id="9bea7-144">La [clase`MembershipUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) tiene propiedades [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) y [`IsApproved`](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span><span class="sxs-lookup"><span data-stu-id="9bea7-144">The [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) has [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) and [`IsApproved` properties](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx).</span></span> <span data-ttu-id="9bea7-145">La propiedad `IsLockedOut` es de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="9bea7-145">The `IsLockedOut` property is read-only.</span></span> <span data-ttu-id="9bea7-146">No hay ningún mecanismo para bloquear un usuario mediante programación; para desbloquear un usuario, use el [método`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx)de la clase `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-146">There is no mechanism to programmatically lock out a user; to unlock a user, use the `MembershipUser` class's [`UnlockUser` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span> <span data-ttu-id="9bea7-147">La propiedad `IsApproved` es legible y grabable.</span><span class="sxs-lookup"><span data-stu-id="9bea7-147">The `IsApproved` property is readable and writeable.</span></span> <span data-ttu-id="9bea7-148">Para guardar los cambios en esta propiedad, es necesario llamar al [método`UpdateUser`](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx)de la clase `Membership`, pasando el objeto `MembershipUser` modificado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-148">To save any changes to this property, we need to call the `Membership` class's [`UpdateUser` method](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), passing in the modified `MembershipUser` object.</span></span>

<span data-ttu-id="9bea7-149">Dado que la propiedad `IsApproved` se puede leer y escribir, un control CheckBox es probablemente el mejor elemento de la interfaz de usuario para configurar esta propiedad.</span><span class="sxs-lookup"><span data-stu-id="9bea7-149">Because the `IsApproved` property is readable and writeable, a CheckBox control is probably the best user interface element for configuring this property.</span></span> <span data-ttu-id="9bea7-150">Sin embargo, una casilla no funcionará para la propiedad `IsLockedOut` porque un administrador no puede bloquear a un usuario, solo puede desbloquear a un usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-150">However, a CheckBox will not work for the `IsLockedOut` property because an administrator cannot lock out a user, she may only unlock a user.</span></span> <span data-ttu-id="9bea7-151">Una interfaz de usuario adecuada para la propiedad `IsLockedOut` es un botón que, al hacer clic en él, desbloquea la cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-151">A suitable user interface for the `IsLockedOut` property is a Button that, when clicked, unlocks the user account.</span></span> <span data-ttu-id="9bea7-152">Este botón solo debe habilitarse si el usuario está bloqueado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-152">This Button should only be enabled if the user is locked out.</span></span>

### <a name="creating-theuserinformationaspxpage"></a><span data-ttu-id="9bea7-153">Crear la página`UserInformation.aspx`</span><span class="sxs-lookup"><span data-stu-id="9bea7-153">Creating the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="9bea7-154">Ahora estamos listos para implementar la interfaz de usuario en `UserInformation.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-154">We are now ready to implement the user interface in `UserInformation.aspx`.</span></span> <span data-ttu-id="9bea7-155">Abra esta página y agregue los siguientes controles Web:</span><span class="sxs-lookup"><span data-stu-id="9bea7-155">Open this page and add the following Web controls:</span></span>

- <span data-ttu-id="9bea7-156">Control de hipervínculo que, cuando se hace clic en él, devuelve el administrador a la página `ManageUsers.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-156">A HyperLink control that, when clicked, returns the administrator to the `ManageUsers.aspx` page.</span></span>
- <span data-ttu-id="9bea7-157">Un control Web de etiqueta para mostrar el nombre del usuario seleccionado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-157">A Label Web control for displaying the selected user's name.</span></span> <span data-ttu-id="9bea7-158">Establezca el `ID` de la etiqueta en `UserNameLabel` y borre su propiedad texto.</span><span class="sxs-lookup"><span data-stu-id="9bea7-158">Set this Label's `ID` to `UserNameLabel` and clear out its Text property.</span></span>
- <span data-ttu-id="9bea7-159">Control CheckBox denominado `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-159">A CheckBox control named `IsApproved`.</span></span> <span data-ttu-id="9bea7-160">Establezca su propiedad `AutoPostBack` en `True`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-160">Set its `AutoPostBack` property to `True`.</span></span>
- <span data-ttu-id="9bea7-161">Control de etiqueta para mostrar la última fecha de bloqueo del usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-161">A Label control for displaying the user's last locked out date.</span></span> <span data-ttu-id="9bea7-162">Asigne a esta etiqueta el nombre `LastLockedOutDateLabel` y borre su propiedad `Text`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-162">Name this Label `LastLockedOutDateLabel` and clear out its `Text` property.</span></span>
- <span data-ttu-id="9bea7-163">Un botón para desbloquear al usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-163">A Button for unlocking the user.</span></span> <span data-ttu-id="9bea7-164">Asigne un nombre a este botón `UnlockUserButton` y establezca su propiedad `Text` en "Unlock user".</span><span class="sxs-lookup"><span data-stu-id="9bea7-164">Name this Button `UnlockUserButton` and set its `Text` property to "Unlock User".</span></span>
- <span data-ttu-id="9bea7-165">Un control de etiqueta para mostrar mensajes de estado, como "el estado aprobado del usuario se ha actualizado".</span><span class="sxs-lookup"><span data-stu-id="9bea7-165">A Label control for displaying status messages, such as, "The user's approved status has been updated."</span></span> <span data-ttu-id="9bea7-166">Asigne a este control el nombre `StatusMessage`, borre su propiedad `Text` y establezca su propiedad `CssClass` en `Important`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-166">Name this control `StatusMessage`, clear out its `Text` property, and set its `CssClass` property to `Important`.</span></span> <span data-ttu-id="9bea7-167">(La clase `Important` CSS se define en el archivo de hoja de estilos `Styles.css`; muestra el texto correspondiente en una fuente de color rojo grande).</span><span class="sxs-lookup"><span data-stu-id="9bea7-167">(The `Important` CSS class is defined in the `Styles.css` stylesheet file; it displays the corresponding text in a large, red font.)</span></span>

<span data-ttu-id="9bea7-168">Después de agregar estos controles, el Vista de diseño en Visual Studio debe ser similar a la captura de pantalla de la figura 2.</span><span class="sxs-lookup"><span data-stu-id="9bea7-168">After adding these controls, the Design view in Visual Studio should look similar to the screen shot in Figure 2.</span></span>

<span data-ttu-id="9bea7-169">[![crear la interfaz de usuario para UserInformation. aspx](unlocking-and-approving-user-accounts-vb/_static/image5.png)](unlocking-and-approving-user-accounts-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9bea7-169">[![Create the User Interface for UserInformation.aspx](unlocking-and-approving-user-accounts-vb/_static/image5.png)](unlocking-and-approving-user-accounts-vb/_static/image4.png)</span></span>

<span data-ttu-id="9bea7-170">**Figura 2**: creación de la interfaz de usuario para `UserInformation.aspx` ([haga clic para ver la imagen de tamaño completo](unlocking-and-approving-user-accounts-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9bea7-170">**Figure 2**: Create the User Interface for `UserInformation.aspx` ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image6.png))</span></span>

<span data-ttu-id="9bea7-171">Una vez completada la interfaz de usuario, la siguiente tarea consiste en establecer la casilla `IsApproved` y otros controles basados en la información del usuario seleccionado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-171">With the user interface complete, our next task is to set the `IsApproved` CheckBox and other controls based on the selected user's information.</span></span> <span data-ttu-id="9bea7-172">Cree un controlador de eventos para el evento de `Load` de la página y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="9bea7-172">Create an event handler for the page's `Load` event and add the following code:</span></span>

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample1.vb)]

<span data-ttu-id="9bea7-173">El código anterior se inicia asegurándose de que se trata de la primera visita a la página y no de un postback posterior.</span><span class="sxs-lookup"><span data-stu-id="9bea7-173">The above code starts by ensuring that this is the first visit to the page and not a subsequent postback.</span></span> <span data-ttu-id="9bea7-174">A continuación, lee el nombre de usuario pasado por el campo `user` QueryString y recupera información acerca de esa cuenta de usuario mediante el método `Membership.GetUser(username)`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-174">It then reads the username passed through the `user` querystring field and retrieves information about that user account via the `Membership.GetUser(username)` method.</span></span> <span data-ttu-id="9bea7-175">Si no se ha proporcionado ningún nombre de usuario a través de la cadena de acceso, o si no se encuentra el usuario especificado, el administrador se devuelve a la página `ManageUsers.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-175">If no username was supplied through the querystring, or if the specified user could not be found, the administrator is sent back to the `ManageUsers.aspx` page.</span></span>

<span data-ttu-id="9bea7-176">A continuación, se muestra el valor `UserName` del objeto `MembershipUser` en el `UserNameLabel` y se activa la casilla `IsApproved` basándose en el valor de la propiedad `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-176">The `MembershipUser` object's `UserName` value is then displayed in the `UserNameLabel` and the `IsApproved` CheckBox is checked based on the `IsApproved` property value.</span></span>

<span data-ttu-id="9bea7-177">La [propiedad`LastLockoutDate`](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) del objeto `MembershipUser` devuelve un valor `DateTime` que indica cuándo se bloqueó por última vez el usuario. Si nunca se ha bloqueado el usuario, el valor devuelto depende del proveedor de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="9bea7-177">The `MembershipUser` object's [`LastLockoutDate` property](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) returns a `DateTime` value indicating when the user was last locked out. If the user has never been locked out, the value returned depends on the Membership provider.</span></span> <span data-ttu-id="9bea7-178">Cuando se crea una nueva cuenta, el `SqlMembershipProvider` establece el campo `LastLockoutDate` de la `aspnet_Membership` de la tabla en `1754-01-01 12:00:00 AM`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-178">When a new account is created, the `SqlMembershipProvider` sets the `aspnet_Membership` table's `LastLockoutDate` field to `1754-01-01 12:00:00 AM`.</span></span> <span data-ttu-id="9bea7-179">En el código anterior se muestra una cadena vacía en el `LastLockoutDateLabel` si la propiedad `LastLockoutDate` se produce antes del año 2000; de lo contrario, la parte de la fecha de la propiedad `LastLockoutDate` se muestra en la etiqueta.</span><span class="sxs-lookup"><span data-stu-id="9bea7-179">The above code displays an empty string in the `LastLockoutDateLabel` if the `LastLockoutDate` property occurs before year 2000; otherwise, the date portion of the `LastLockoutDate` property is displayed in the Label.</span></span> <span data-ttu-id="9bea7-180">La propiedad `Enabled` del `UnlockUserButton`está establecida en el estado de bloqueo del usuario, lo que significa que este botón solo estará habilitado si el usuario está bloqueado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-180">The `UnlockUserButton`'s `Enabled` property is set to the user's locked out status, meaning that this Button will only be enabled if the user is locked out.</span></span>

<span data-ttu-id="9bea7-181">Dedique un momento a probar la página `UserInformation.aspx` a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="9bea7-181">Take a moment to test the `UserInformation.aspx` page through a browser.</span></span> <span data-ttu-id="9bea7-182">Por supuesto, tendrá que iniciar en `ManageUsers.aspx` y seleccionar una cuenta de usuario para administrarla.</span><span class="sxs-lookup"><span data-stu-id="9bea7-182">You will, of course, need to start at `ManageUsers.aspx` and select a user account to manage.</span></span> <span data-ttu-id="9bea7-183">Al llegar a `UserInformation.aspx`, tenga en cuenta que la casilla `IsApproved` solo se comprueba si se aprueba el usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-183">Upon arriving at `UserInformation.aspx`, note that the `IsApproved` CheckBox is only checked if the user is approved.</span></span> <span data-ttu-id="9bea7-184">Si el usuario se ha bloqueado alguna vez, se muestra la fecha de la última vez que se bloqueó.</span><span class="sxs-lookup"><span data-stu-id="9bea7-184">If the user has ever been locked out, their last locked out date is displayed.</span></span> <span data-ttu-id="9bea7-185">El botón Desbloquear usuario solo está habilitado si el usuario está bloqueado actualmente. Al activar o desactivar la casilla de `IsApproved` o al hacer clic en el botón Desbloquear usuario, se produce un postback, pero no se realiza ninguna modificación en la cuenta de usuario porque todavía hemos creado controladores de eventos para estos eventos.</span><span class="sxs-lookup"><span data-stu-id="9bea7-185">The Unlock User button is enabled only if the user is currently locked out. Checking or unchecking the `IsApproved` CheckBox or clicking the Unlock User button causes a postback, but no modifications are made to the user account because we've yet to create event handlers for these events.</span></span>

<span data-ttu-id="9bea7-186">Vuelva a Visual Studio y cree controladores de eventos para el evento `CheckedChanged` de la casilla de `IsApproved` y el evento `Click` del botón `UnlockUser`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-186">Return to Visual Studio and create event handlers for the `IsApproved` CheckBox's `CheckedChanged` event and the `UnlockUser` Button's `Click` event.</span></span> <span data-ttu-id="9bea7-187">En el controlador de eventos `CheckedChanged`, establezca la propiedad `IsApproved` del usuario en la propiedad `Checked` de la casilla y, a continuación, guarde los cambios a través de una llamada a `Membership.UpdateUser`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-187">In the `CheckedChanged` event handler, set the user's `IsApproved` property to the `Checked` property of the CheckBox and then save the changes via a call to `Membership.UpdateUser`.</span></span> <span data-ttu-id="9bea7-188">En el controlador de eventos `Click`, simplemente llame al método `UnlockUser` del objeto `MembershipUser`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-188">In the `Click` event handler, simply call the `MembershipUser` object's `UnlockUser` method.</span></span> <span data-ttu-id="9bea7-189">En ambos controladores de eventos, muestre un mensaje adecuado en la etiqueta de `StatusMessage`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-189">In both event handlers, display a suitable message in the `StatusMessage` Label.</span></span>

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample2.vb)]

### <a name="testing-theuserinformationaspxpage"></a><span data-ttu-id="9bea7-190">Probar la página`UserInformation.aspx`</span><span class="sxs-lookup"><span data-stu-id="9bea7-190">Testing the`UserInformation.aspx`Page</span></span>

<span data-ttu-id="9bea7-191">Con estos controladores de eventos en su lugar, vuelva a visitar la página y sin aprobar un usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-191">With these event handlers in place, revisit the page and unapproved a user.</span></span> <span data-ttu-id="9bea7-192">Como se muestra en la figura 3, debería ver un mensaje breve en la página que indica que la propiedad `IsApproved` del usuario se modificó correctamente.</span><span class="sxs-lookup"><span data-stu-id="9bea7-192">As Figure 3 shows, you should see a brief message on the page indicating that the user's `IsApproved` property was successfully modified.</span></span>

<span data-ttu-id="9bea7-193">[no se ha aprobado ![Chris](unlocking-and-approving-user-accounts-vb/_static/image8.png)](unlocking-and-approving-user-accounts-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9bea7-193">[![Chris has been Unapproved](unlocking-and-approving-user-accounts-vb/_static/image8.png)](unlocking-and-approving-user-accounts-vb/_static/image7.png)</span></span>

<span data-ttu-id="9bea7-194">**Figura 3**: Carlos no aprobado ([haga clic para ver la imagen de tamaño completo](unlocking-and-approving-user-accounts-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="9bea7-194">**Figure 3**: Chris has been Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image9.png))</span></span>

<span data-ttu-id="9bea7-195">A continuación, cierre la sesión e intente iniciar sesión como el usuario cuya cuenta se acaba de aprobar.</span><span class="sxs-lookup"><span data-stu-id="9bea7-195">Next, logout and try to login as the user whose account was just unapproved.</span></span> <span data-ttu-id="9bea7-196">Dado que el usuario no está aprobado, no puede iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="9bea7-196">Because the user is not approved, they cannot login.</span></span> <span data-ttu-id="9bea7-197">De forma predeterminada, el control de inicio de sesión muestra el mismo mensaje si el usuario no puede iniciar sesión, independientemente de la razón.</span><span class="sxs-lookup"><span data-stu-id="9bea7-197">By default, the Login control displays the same message if the user cannot login, regardless of the reason.</span></span> <span data-ttu-id="9bea7-198">Pero en el <a id="Tutorial6"> </a>tutorial [*validación de las credenciales de usuario en el almacén de usuarios de pertenencia*](../membership/validating-user-credentials-against-the-membership-user-store-vb.md) , hemos visto cómo mejorar el control de inicio de sesión para mostrar un mensaje más adecuado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-198">But in the <a id="Tutorial6"></a>[*Validating User Credentials Against the Membership User Store*](../membership/validating-user-credentials-against-the-membership-user-store-vb.md) tutorial we looked at enhancing the Login control to display a more appropriate message.</span></span> <span data-ttu-id="9bea7-199">Como se muestra en la figura 4, se muestra un mensaje en el que se explica que no puede iniciar sesión porque su cuenta aún no se ha aprobado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-199">As Figure 4 shows, Chris is shown a message explaining that he cannot login because his account is not yet approved.</span></span>

<span data-ttu-id="9bea7-200">[![Chris no puede iniciar sesión porque su cuenta no está aprobada](unlocking-and-approving-user-accounts-vb/_static/image11.png)](unlocking-and-approving-user-accounts-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="9bea7-200">[![Chris Cannot Login Because His Account is Unapproved](unlocking-and-approving-user-accounts-vb/_static/image11.png)](unlocking-and-approving-user-accounts-vb/_static/image10.png)</span></span>

<span data-ttu-id="9bea7-201">**Figura 4**: Chris no puede iniciar sesión porque su cuenta no está aprobada ([haga clic para ver la imagen de tamaño completo](unlocking-and-approving-user-accounts-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="9bea7-201">**Figure 4**: Chris Cannot Login Because His Account is Unapproved  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image12.png))</span></span>

<span data-ttu-id="9bea7-202">Para probar la funcionalidad de bloqueo, intente iniciar sesión como un usuario aprobado, pero use una contraseña incorrecta.</span><span class="sxs-lookup"><span data-stu-id="9bea7-202">To test the locked out functionality, attempt to login as an approved user, but use an incorrect password.</span></span> <span data-ttu-id="9bea7-203">Repita este proceso el número de veces que sea necesario hasta que la cuenta del usuario se haya bloqueado. El control de inicio de sesión también se actualizó para mostrar un mensaje personalizado si se intenta iniciar sesión desde una cuenta bloqueada.</span><span class="sxs-lookup"><span data-stu-id="9bea7-203">Repeat this process the necessary number of times until the user's account has been locked out. The Login control was also updated to show a custom message if attempting to login from a locked out account.</span></span> <span data-ttu-id="9bea7-204">Sabe que una cuenta se ha bloqueado una vez que empiece a ver el siguiente mensaje en la página de inicio de sesión: "su cuenta se ha bloqueado debido a que hay demasiados intentos de inicio de sesión no válidos.</span><span class="sxs-lookup"><span data-stu-id="9bea7-204">You know that an account has been locked out once you start seeing the following message at the login page: "Your account has been locked out because of too many invalid login attempts.</span></span> <span data-ttu-id="9bea7-205">Póngase en contacto con el administrador para que se desbloquee la cuenta ".</span><span class="sxs-lookup"><span data-stu-id="9bea7-205">Please contact the administrator to have your account unlocked."</span></span>

<span data-ttu-id="9bea7-206">Vuelva a la página `ManageUsers.aspx` y haga clic en el vínculo administrar del usuario bloqueado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-206">Return to the `ManageUsers.aspx` page and click the Manage link for the locked out user.</span></span> <span data-ttu-id="9bea7-207">Como se muestra en la figura 5, debería ver un valor en la `LastLockedOutDateLabel` el botón Desbloquear usuario debe estar habilitado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-207">As Figure 5 shows, you should see a value in the `LastLockedOutDateLabel` the Unlock User button should be enabled.</span></span> <span data-ttu-id="9bea7-208">Haga clic en el botón Desbloquear usuario para desbloquear la cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-208">Click the Unlock User button to unlock the user account.</span></span> <span data-ttu-id="9bea7-209">Una vez que haya desbloqueado el usuario, podrá iniciar sesión de nuevo.</span><span class="sxs-lookup"><span data-stu-id="9bea7-209">Once you have unlocked the user, they will be able to login again.</span></span>

<span data-ttu-id="9bea7-210">[![David se ha bloqueado fuera del sistema](unlocking-and-approving-user-accounts-vb/_static/image14.png)](unlocking-and-approving-user-accounts-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9bea7-210">[![Dave Has Been Locked Out of the System](unlocking-and-approving-user-accounts-vb/_static/image14.png)](unlocking-and-approving-user-accounts-vb/_static/image13.png)</span></span>

<span data-ttu-id="9bea7-211">**Figura 5**: David está bloqueado en el sistema ([haga clic para ver la imagen de tamaño completo](unlocking-and-approving-user-accounts-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="9bea7-211">**Figure 5**: Dave Has Been Locked Out of the System  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image15.png))</span></span>

## <a name="step-2-specifying-new-users-approved-status"></a><span data-ttu-id="9bea7-212">Paso 2: especificar el estado aprobado de los nuevos usuarios</span><span class="sxs-lookup"><span data-stu-id="9bea7-212">Step 2: Specifying New Users' Approved Status</span></span>

<span data-ttu-id="9bea7-213">El estado aprobado es útil en escenarios en los que desea realizar alguna acción antes de que un nuevo usuario pueda iniciar sesión y tener acceso a las características específicas del sitio.</span><span class="sxs-lookup"><span data-stu-id="9bea7-213">The approved status is useful in scenarios where you want some action to be performed before a new user is able to login and access the user-specific features of the site.</span></span> <span data-ttu-id="9bea7-214">Por ejemplo, puede que esté ejecutando un sitio web privado en el que todas las páginas, excepto las páginas de inicio de sesión y suscripción, solo sean accesibles para los usuarios autenticados.</span><span class="sxs-lookup"><span data-stu-id="9bea7-214">For example, you may be running a private website where all pages, except for the login and signup pages, are accessible only to authenticated users.</span></span> <span data-ttu-id="9bea7-215">Pero, ¿qué ocurre si un extraño llega a su sitio web, encuentra la página de registro y crea una cuenta?</span><span class="sxs-lookup"><span data-stu-id="9bea7-215">But what happens if a stranger reaches your website, finds the signup page, and creates an account?</span></span> <span data-ttu-id="9bea7-216">Para evitar que esto suceda, puede trasladar la página de registro a un `Administration` carpeta y requerir que un administrador cree manualmente cada cuenta.</span><span class="sxs-lookup"><span data-stu-id="9bea7-216">To prevent this from happening you could move the signup page to an `Administration` folder, and require that an administrator manually create each account.</span></span> <span data-ttu-id="9bea7-217">Como alternativa, puede permitir que cualquier persona se ponga en suscripción, pero prohibir el acceso al sitio hasta que un administrador apruebe la cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-217">Alternatively, you could allow anyone to signup, but prohibit site access until an administrator approves the user account.</span></span>

<span data-ttu-id="9bea7-218">De forma predeterminada, el control CreateUserWizard aprueba nuevas cuentas.</span><span class="sxs-lookup"><span data-stu-id="9bea7-218">By default, the CreateUserWizard control approves new accounts.</span></span> <span data-ttu-id="9bea7-219">Puede configurar este comportamiento mediante la [propiedad`DisableCreatedUser`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx)del control.</span><span class="sxs-lookup"><span data-stu-id="9bea7-219">You can configure this behavior using the control's [`DisableCreatedUser` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx).</span></span> <span data-ttu-id="9bea7-220">Establezca esta propiedad en `True` para no aprobar nuevas cuentas de usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-220">Set this property to `True` to not approve new user accounts.</span></span>

> [!NOTE]
> <span data-ttu-id="9bea7-221">De forma predeterminada, el control CreateUserWizard inicia sesión automáticamente en la nueva cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-221">By default the CreateUserWizard control automatically logs on the new user account.</span></span> <span data-ttu-id="9bea7-222">Este comportamiento viene determinado por la [propiedad`LoginCreatedUser`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx)del control.</span><span class="sxs-lookup"><span data-stu-id="9bea7-222">This behavior is dictated by the control's [`LoginCreatedUser` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span></span> <span data-ttu-id="9bea7-223">Dado que los usuarios no aprobados no pueden iniciar sesión en el sitio, cuando `DisableCreatedUser` está `True` la nueva cuenta de usuario no inicia sesión en el sitio, independientemente del valor de la propiedad `LoginCreatedUser`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-223">Because unapproved users cannot login to the site, when `DisableCreatedUser` is `True` the new user account is not logged into the site, regardless of the value of the `LoginCreatedUser` property.</span></span>

<span data-ttu-id="9bea7-224">Si va a crear nuevas cuentas de usuario mediante programación a través del método `Membership.CreateUser`, para crear una cuenta de usuario no aprobada, use una de las sobrecargas que acepten el valor de la propiedad `IsApproved` del usuario nuevo como parámetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="9bea7-224">If you are programmatically creating new user accounts via the `Membership.CreateUser` method, to create an unapproved user account use one of the overloads that accept the new user's `IsApproved` property value as an input parameter.</span></span>

## <a name="step-3-approving-users-by-verifying-their-email-address"></a><span data-ttu-id="9bea7-225">Paso 3: aprobación de los usuarios mediante la comprobación de su dirección de correo electrónico</span><span class="sxs-lookup"><span data-stu-id="9bea7-225">Step 3: Approving Users By Verifying their Email Address</span></span>

<span data-ttu-id="9bea7-226">Muchos sitios web que admiten cuentas de usuario no aprueban a los nuevos usuarios hasta que comprueban la dirección de correo electrónico proporcionada al registrarse.</span><span class="sxs-lookup"><span data-stu-id="9bea7-226">Many websites that support user accounts do not approve new users until they verify the email address they supplied when registering.</span></span> <span data-ttu-id="9bea7-227">Este proceso de comprobación se usa normalmente para combatir bots, remitentes de correo no deseado y otros ne'er, ya que requiere una dirección de correo electrónico única y comprobada y agrega un paso adicional en el proceso de suscripción.</span><span class="sxs-lookup"><span data-stu-id="9bea7-227">This verification process is commonly used to thwart bots, spammers, and other ne'er-do-wells as it requires a unique, verified email address and adds an extra step in the signup process.</span></span> <span data-ttu-id="9bea7-228">Con este modelo, cuando un nuevo usuario se suscribe, se le envía un mensaje de correo electrónico que incluye un vínculo a una página de comprobación.</span><span class="sxs-lookup"><span data-stu-id="9bea7-228">With this model, when a new user signs up they are sent an email message that includes a link to a verification page.</span></span> <span data-ttu-id="9bea7-229">Al visitar el vínculo, el usuario ha demostrado que ha recibido el correo electrónico y, por lo tanto, la dirección de correo electrónico proporcionada es válida.</span><span class="sxs-lookup"><span data-stu-id="9bea7-229">By visiting the link the user has proven that they received the email and, therefore, that the email address provided is valid.</span></span> <span data-ttu-id="9bea7-230">La página de comprobación es responsable de la aprobación del usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-230">The verification page is responsible for approving the user.</span></span> <span data-ttu-id="9bea7-231">Esto puede ocurrir automáticamente, con lo que se aprueba cualquier usuario que llegue a esta página o solo después de que el usuario proporcione información adicional, como un [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span><span class="sxs-lookup"><span data-stu-id="9bea7-231">This may happen automatically, thereby approving any user who reaches this page, or only after the user provides some additional information, such as a [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).</span></span>

<span data-ttu-id="9bea7-232">Para dar cabida a este flujo de trabajo, es necesario actualizar primero la página de creación de la cuenta para que los nuevos usuarios no estén aprobados.</span><span class="sxs-lookup"><span data-stu-id="9bea7-232">To accommodate this workflow, we need to first update the account creation page so that new users are unapproved.</span></span> <span data-ttu-id="9bea7-233">Abra la página `EnhancedCreateUserWizard.aspx` en la carpeta `Membership` y establezca la propiedad `DisableCreatedUser` del control CreateUserWizard en `True`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-233">Open the `EnhancedCreateUserWizard.aspx` page in the `Membership` folder and set the CreateUserWizard control's `DisableCreatedUser` property to `True`.</span></span>

<span data-ttu-id="9bea7-234">A continuación, es necesario configurar el control CreateUserWizard para enviar un correo electrónico al nuevo usuario con instrucciones sobre cómo comprobar su cuenta.</span><span class="sxs-lookup"><span data-stu-id="9bea7-234">Next, we need to configure the CreateUserWizard control to send an email to the new user with instructions on how to verify their account.</span></span> <span data-ttu-id="9bea7-235">En concreto, incluiremos un vínculo en el correo electrónico a la página `Verification.aspx` (que todavía hemos creado), pasando el `UserId` del nuevo usuario a través de la cadena de mensajes.</span><span class="sxs-lookup"><span data-stu-id="9bea7-235">In particular, we will include a link in the email to the `Verification.aspx` page (which we've yet to create), passing in the new user's `UserId` through the querystring.</span></span> <span data-ttu-id="9bea7-236">En la página `Verification.aspx` se buscará el usuario especificado y se marcarán como aprobados.</span><span class="sxs-lookup"><span data-stu-id="9bea7-236">The `Verification.aspx` page will lookup the specified user and mark them approved.</span></span>

### <a name="sending-a-verification-email-to-new-users"></a><span data-ttu-id="9bea7-237">Envío de un correo electrónico de comprobación a nuevos usuarios</span><span class="sxs-lookup"><span data-stu-id="9bea7-237">Sending a Verification Email to New Users</span></span>

<span data-ttu-id="9bea7-238">Para enviar un correo electrónico desde el control CreateUserWizard, configure la propiedad `MailDefinition` correctamente.</span><span class="sxs-lookup"><span data-stu-id="9bea7-238">To send an email from the CreateUserWizard control, configure its `MailDefinition` property appropriately.</span></span> <span data-ttu-id="9bea7-239">Como se explicó en <a id="Tutorial13"> </a>el [tutorial anterior](recovering-and-changing-passwords-vb.md), los controles ChangePassword y PasswordRecovery incluyen una [`MailDefinition` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) que funciona de la misma manera que el control CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="9bea7-239">As discussed in the <a id="Tutorial13"></a>[previous tutorial](recovering-and-changing-passwords-vb.md), the ChangePassword and PasswordRecovery controls include a [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) that works in the same manner as the CreateUserWizard control's.</span></span>

> [!NOTE]
> <span data-ttu-id="9bea7-240">Para usar la propiedad `MailDefinition` debe especificar las opciones de entrega de correo en `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-240">To use the `MailDefinition` property you need to specify mail delivery options in `Web.config`.</span></span> <span data-ttu-id="9bea7-241">Para obtener más información, consulte [envío de correo electrónico en ASP.net](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="9bea7-241">For more information, refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span></span>

<span data-ttu-id="9bea7-242">Empiece por crear una nueva plantilla de correo electrónico denominada `CreateUserWizard.txt` en la carpeta `EmailTemplates`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-242">Start by creating a new email template named `CreateUserWizard.txt` in the `EmailTemplates` folder.</span></span> <span data-ttu-id="9bea7-243">Use el siguiente texto para la plantilla:</span><span class="sxs-lookup"><span data-stu-id="9bea7-243">Use the following text for the template:</span></span>

[!code-aspx[Main](unlocking-and-approving-user-accounts-vb/samples/sample3.aspx)]

<span data-ttu-id="9bea7-244">Establezca la propiedad `BodyFileName` del `MailDefinition`en "~/EmailTemplates/CreateUserWizard.txt" y su propiedad `Subject` en "Bienvenido a mi sitio Web.</span><span class="sxs-lookup"><span data-stu-id="9bea7-244">Set the `MailDefinition`'s `BodyFileName` property to "~/EmailTemplates/CreateUserWizard.txt" and its `Subject` property to "Welcome to My Website!</span></span> <span data-ttu-id="9bea7-245">Active su cuenta ".</span><span class="sxs-lookup"><span data-stu-id="9bea7-245">Please activate your account."</span></span>

<span data-ttu-id="9bea7-246">Tenga en cuenta que la plantilla de correo electrónico de `CreateUserWizard.txt` incluye un marcador de posición de `<%VerificationUrl%>`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-246">Note that the `CreateUserWizard.txt` email template includes a `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="9bea7-247">Aquí es donde se colocará la dirección URL de la página `Verification.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-247">This is where the URL for the `Verification.aspx` page will be placed.</span></span> <span data-ttu-id="9bea7-248">CreateUserWizard reemplaza automáticamente los marcadores de posición `<%UserName%>` y `<%Password%>` por el nombre de usuario y la contraseña de la nueva cuenta, pero no hay ningún marcador de posición de `<%VerificationUrl%>` integrado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-248">The CreateUserWizard automatically replaces the `<%UserName%>` and `<%Password%>` placeholders with the new account's username and password, but there is no built-in `<%VerificationUrl%>` placeholder.</span></span> <span data-ttu-id="9bea7-249">Necesitamos reemplazarlo manualmente por la dirección URL de comprobación adecuada.</span><span class="sxs-lookup"><span data-stu-id="9bea7-249">We need to manually replace it with the appropriate verification URL.</span></span>

<span data-ttu-id="9bea7-250">Para ello, cree un controlador de eventos para el evento de [`SendingMail`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) de CreateUserWizard y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="9bea7-250">To accomplish this, create an event handler for the CreateUserWizard's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) and add the following code:</span></span>

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample4.vb)]

<span data-ttu-id="9bea7-251">El evento `SendingMail` se desencadena después del evento `CreatedUser`, lo que significa que, en el momento en que se ha creado el controlador de eventos anterior, ya se ha creado la nueva cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="9bea7-251">The `SendingMail` event fires after the `CreatedUser` event, meaning that by the time the above event handler executes the new user account has already been created.</span></span> <span data-ttu-id="9bea7-252">Podemos acceder al valor de `UserId` del nuevo usuario llamando al método `Membership.GetUser`, pasando el `UserName` especificado en el control CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="9bea7-252">We can access the new user's `UserId` value by calling the `Membership.GetUser` method, passing in the `UserName` entered into the CreateUserWizard control.</span></span> <span data-ttu-id="9bea7-253">A continuación, se forma la dirección URL de comprobación.</span><span class="sxs-lookup"><span data-stu-id="9bea7-253">Next, the verification URL is formed.</span></span> <span data-ttu-id="9bea7-254">La instrucción `Request.Url.GetLeftPart(UriPartial.Authority)` devuelve la parte `http://yourserver.com` de la dirección URL; `Request.ApplicationPath` devuelve la ruta de acceso donde se encuentra la raíz de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="9bea7-254">The statement `Request.Url.GetLeftPart(UriPartial.Authority)` returns the `http://yourserver.com` portion of the URL; `Request.ApplicationPath` returns path where the application is rooted.</span></span> <span data-ttu-id="9bea7-255">La dirección URL de comprobación se define como `Verification.aspx?ID=userId`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-255">The verification URL is then defined as `Verification.aspx?ID=userId`.</span></span> <span data-ttu-id="9bea7-256">A continuación, estas dos cadenas se concatenan para formar la dirección URL completa.</span><span class="sxs-lookup"><span data-stu-id="9bea7-256">These two strings are then concatenated to form the complete URL.</span></span> <span data-ttu-id="9bea7-257">Por último, el cuerpo del mensaje de correo electrónico (`e.Message.Body`) tiene todas las apariciones de `<%VerificationUrl%>` reemplazadas por la dirección URL completa.</span><span class="sxs-lookup"><span data-stu-id="9bea7-257">Finally, the email message body (`e.Message.Body`) has all occurrences of `<%VerificationUrl%>` replaced with the full URL.</span></span>

<span data-ttu-id="9bea7-258">El efecto neto es que los nuevos usuarios no están aprobados, lo que significa que no pueden iniciar sesión en el sitio.</span><span class="sxs-lookup"><span data-stu-id="9bea7-258">The net effect is that new users are unapproved, meaning that they cannot log into the site.</span></span> <span data-ttu-id="9bea7-259">Además, se envía automáticamente un correo electrónico con un vínculo a la dirección URL de comprobación (consulte la figura 6).</span><span class="sxs-lookup"><span data-stu-id="9bea7-259">Furthermore, they are automatically sent an email with a link to the verification URL (see Figure 6).</span></span>

<span data-ttu-id="9bea7-260">[![el nuevo usuario recibe un correo electrónico con un vínculo a la dirección URL de comprobación](unlocking-and-approving-user-accounts-vb/_static/image17.png)](unlocking-and-approving-user-accounts-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="9bea7-260">[![The New User Receives an Email with a Link to the Verification URL](unlocking-and-approving-user-accounts-vb/_static/image17.png)](unlocking-and-approving-user-accounts-vb/_static/image16.png)</span></span>

<span data-ttu-id="9bea7-261">**Figura 6**: el nuevo usuario recibe un correo electrónico con un vínculo a la dirección URL de comprobación ([haga clic para ver la imagen de tamaño completo](unlocking-and-approving-user-accounts-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="9bea7-261">**Figure 6**: The New User Receives an Email with a Link to the Verification URL  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="9bea7-262">El paso CreateUserWizard predeterminado del control CreateUserWizard muestra un mensaje que informa al usuario de que se ha creado su cuenta y muestra el botón continuar.</span><span class="sxs-lookup"><span data-stu-id="9bea7-262">The CreateUserWizard control's default CreateUserWizard step displays a message informing the user their account has been created and displays a Continue button.</span></span> <span data-ttu-id="9bea7-263">Al hacer clic en esta, se toma al usuario la dirección URL especificada por la propiedad `ContinueDestinationPageUrl` del control.</span><span class="sxs-lookup"><span data-stu-id="9bea7-263">Clicking this takes the user to the URL specified by the control's `ContinueDestinationPageUrl` property.</span></span> <span data-ttu-id="9bea7-264">CreateUserWizard en `EnhancedCreateUserWizard.aspx` está configurado para enviar nuevos usuarios al `~/Membership/AdditionalUserInfo.aspx`, que solicita al usuario su Hometown, la dirección URL de la Página principal y la firma.</span><span class="sxs-lookup"><span data-stu-id="9bea7-264">The CreateUserWizard in `EnhancedCreateUserWizard.aspx` is configured to send new users to the `~/Membership/AdditionalUserInfo.aspx`, which prompts the user for their hometown, homepage URL, and signature.</span></span> <span data-ttu-id="9bea7-265">Dado que esta información solo la pueden agregar usuarios que han iniciado sesión, tiene sentido actualizar esta propiedad para devolver a los usuarios a la Página principal del sitio (`~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="9bea7-265">Because this information can only be added by logged on users, it makes sense to update this property to send users back to the site's homepage (`~/Default.aspx`).</span></span> <span data-ttu-id="9bea7-266">Además, la página `EnhancedCreateUserWizard.aspx` o el paso CreateUserWizard deben aumentarse para informar al usuario de que se ha enviado un correo electrónico de comprobación y su cuenta no se activará hasta que sigan las instrucciones de este correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="9bea7-266">Moreover, the `EnhancedCreateUserWizard.aspx` page or the CreateUserWizard step should be augmented to inform the user that they have been sent a verification email and their account won't be activated until they follow the instructions in this email.</span></span> <span data-ttu-id="9bea7-267">Dejo estas modificaciones como un ejercicio para el lector.</span><span class="sxs-lookup"><span data-stu-id="9bea7-267">I leave these modifications as an exercise for the reader.</span></span>

### <a name="creating-the-verification-page"></a><span data-ttu-id="9bea7-268">Crear la página de comprobación</span><span class="sxs-lookup"><span data-stu-id="9bea7-268">Creating the Verification Page</span></span>

<span data-ttu-id="9bea7-269">Nuestra tarea final es crear la página `Verification.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-269">Our final task is to create the `Verification.aspx` page.</span></span> <span data-ttu-id="9bea7-270">Agregue esta página a la carpeta raíz, asociándolo a la página maestra de `Site.master`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-270">Add this page to the root folder, associating it with the `Site.master` master page.</span></span> <span data-ttu-id="9bea7-271">Como hemos hecho con la mayoría de las páginas de contenido anteriores agregadas al sitio, quite el control de contenido que hace referencia a la `LoginContent` ContentPlaceHolder para que la página de contenido utilice el contenido predeterminado de la página maestra.</span><span class="sxs-lookup"><span data-stu-id="9bea7-271">As we've done with most of the previous content pages added to the site, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the content page uses the master page's default content.</span></span>

<span data-ttu-id="9bea7-272">Agregue un control Web de etiqueta a la página `Verification.aspx`, establezca su `ID` en `StatusMessage` y borre su propiedad Text.</span><span class="sxs-lookup"><span data-stu-id="9bea7-272">Add a Label Web control to the `Verification.aspx` page, set its `ID` to `StatusMessage` and clear out its text property.</span></span> <span data-ttu-id="9bea7-273">A continuación, cree el controlador de eventos `Page_Load` y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="9bea7-273">Next, create the `Page_Load` event handler and add the following code:</span></span>

[!code-vb[Main](unlocking-and-approving-user-accounts-vb/samples/sample5.vb)]

<span data-ttu-id="9bea7-274">La mayor parte del código anterior comprueba que el identificador de usuario proporcionado a través de QueryString existe, que es un valor de `Guid` válido y que hace referencia a una cuenta de usuario existente.</span><span class="sxs-lookup"><span data-stu-id="9bea7-274">The bulk of the above code verifies that the UserId supplied through the querystring exists, that it is a valid `Guid` value, and that it references an existing user account.</span></span> <span data-ttu-id="9bea7-275">Si todas estas comprobaciones son correctas, se aprueba la cuenta de usuario; de lo contrario, se muestra un mensaje de estado adecuado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-275">If all of these checks pass, the user account is approved; otherwise, a suitable status message is displayed.</span></span>

<span data-ttu-id="9bea7-276">En la ilustración 7 se muestra la página `Verification.aspx` cuando se visita a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="9bea7-276">Figure 7 shows the `Verification.aspx` page when visited through a browser.</span></span>

<span data-ttu-id="9bea7-277">[![la cuenta del usuario nuevo ya está aprobada](unlocking-and-approving-user-accounts-vb/_static/image20.png)](unlocking-and-approving-user-accounts-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9bea7-277">[![The New User's Account is Now Approved](unlocking-and-approving-user-accounts-vb/_static/image20.png)](unlocking-and-approving-user-accounts-vb/_static/image19.png)</span></span>

<span data-ttu-id="9bea7-278">**Figura 7**: la cuenta del usuario nuevo ya está aprobada ([haga clic para ver la imagen de tamaño completo](unlocking-and-approving-user-accounts-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="9bea7-278">**Figure 7**: The New User's Account is Now Approved  ([Click to view full-size image](unlocking-and-approving-user-accounts-vb/_static/image21.png))</span></span>

## <a name="summary"></a><span data-ttu-id="9bea7-279">Resumen</span><span class="sxs-lookup"><span data-stu-id="9bea7-279">Summary</span></span>

<span data-ttu-id="9bea7-280">Todas las cuentas de usuario de pertenencia tienen dos Estados que determinan si el usuario puede iniciar sesión en el sitio: `IsLockedOut` y `IsApproved`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-280">All Membership user accounts have two statuses that determine whether the user can log into the site: `IsLockedOut` and `IsApproved`.</span></span> <span data-ttu-id="9bea7-281">Ambas propiedades deben estar `True` para que el usuario inicie sesión.</span><span class="sxs-lookup"><span data-stu-id="9bea7-281">Both of these properties must be `True` for the user to login.</span></span>

<span data-ttu-id="9bea7-282">El estado de bloqueo del usuario se usa como medida de seguridad para reducir la probabilidad de que un hacker se interrumpa en un sitio mediante métodos de fuerza bruta.</span><span class="sxs-lookup"><span data-stu-id="9bea7-282">The user's locked out status is used as a security measure to reduce the likelihood of a hacker breaking into a site through brute force methods.</span></span> <span data-ttu-id="9bea7-283">En concreto, se bloquea un usuario si hay un determinado número de intentos de inicio de sesión no válidos dentro de un período de tiempo determinado.</span><span class="sxs-lookup"><span data-stu-id="9bea7-283">Specifically, a user is locked out if there are a certain number of invalid login attempts within a certain window of time.</span></span> <span data-ttu-id="9bea7-284">Estos límites se pueden configurar a través de la configuración del proveedor de pertenencia en `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="9bea7-284">These bounds are configurable through the Membership provider settings in `Web.config`.</span></span>

<span data-ttu-id="9bea7-285">El estado aprobado se usa normalmente como un medio para impedir que los nuevos usuarios inicien sesión hasta que haya transcurrido alguna acción.</span><span class="sxs-lookup"><span data-stu-id="9bea7-285">The approved status is commonly used as a means to prohibit new users from logging in until some action has transpired.</span></span> <span data-ttu-id="9bea7-286">Es posible que el sitio requiera que el administrador apruebe primero las cuentas nuevas o, como vimos en el paso 3, comprobando su dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="9bea7-286">Perhaps the site requires that new accounts first be approved by the administrator or, as we saw in Step 3, by verifying their email address.</span></span>

<span data-ttu-id="9bea7-287">¡ Feliz programación!</span><span class="sxs-lookup"><span data-stu-id="9bea7-287">Happy Programming!</span></span>

### <a name="about-the-author"></a><span data-ttu-id="9bea7-288">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="9bea7-288">About the Author</span></span>

<span data-ttu-id="9bea7-289">Scott Mitchell, autor de varios libros de ASP/ASP. NET y fundador de 4GuysFromRolla.com, ha estado trabajando con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="9bea7-289">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9bea7-290">Scott funciona como consultor, profesor y redactor independiente.</span><span class="sxs-lookup"><span data-stu-id="9bea7-290">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9bea7-291">Su último libro se *[enseña a ASP.NET 2,0 en 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="9bea7-291">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="9bea7-292">Se puede acceder a Scott en [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) o a través de su blog en [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="9bea7-292">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="9bea7-293">Agradecimiento especial...</span><span class="sxs-lookup"><span data-stu-id="9bea7-293">Special Thanks To…</span></span>

<span data-ttu-id="9bea7-294">Muchos revisores útiles revisaron esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="9bea7-294">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9bea7-295">¿Está interesado en revisar los próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="9bea7-295">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9bea7-296">Si es así, coloque una línea en [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9bea7-296">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="9bea7-297">Anterior</span><span class="sxs-lookup"><span data-stu-id="9bea7-297">Previous</span></span>](recovering-and-changing-passwords-vb.md)
