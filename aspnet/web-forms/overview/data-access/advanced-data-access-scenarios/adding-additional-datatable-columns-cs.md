---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
title: Agregar columnas adicionales de DataTableC#() | Microsoft Docs
author: rick-anderson
description: Al utilizar el Asistente para TableAdapter para crear un conjunto de datos con tipo, el DataTable correspondiente contiene las columnas devueltas por la consulta de base de datos principal. Pero...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 615f3361-f21f-4338-8bc1-fce8ae071de9
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
msc.type: authoredcontent
ms.openlocfilehash: a96f254aa54e7077456ac1a9bd6c5e2a17619d96
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/28/2019
ms.locfileid: "74610708"
---
# <a name="adding-additional-datatable-columns-c"></a><span data-ttu-id="41328-104">Agregar columnas adicionales de DataTable (C#)</span><span class="sxs-lookup"><span data-stu-id="41328-104">Adding Additional DataTable Columns (C#)</span></span>

<span data-ttu-id="41328-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="41328-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="41328-106">[Descargar código](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip) o [Descargar PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="41328-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip) or [Download PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span></span>

> <span data-ttu-id="41328-107">Al utilizar el Asistente para TableAdapter para crear un conjunto de datos con tipo, el DataTable correspondiente contiene las columnas devueltas por la consulta de base de datos principal.</span><span class="sxs-lookup"><span data-stu-id="41328-107">When using the TableAdapter Wizard to create a Typed DataSet, the corresponding DataTable contains the columns returned by the main database query.</span></span> <span data-ttu-id="41328-108">Pero hay ocasiones en las que la DataTable necesita incluir columnas adicionales.</span><span class="sxs-lookup"><span data-stu-id="41328-108">But there are occasions when the DataTable needs to include additional columns.</span></span> <span data-ttu-id="41328-109">En este tutorial se explica por qué se recomiendan los procedimientos almacenados cuando se necesitan columnas DataTable adicionales.</span><span class="sxs-lookup"><span data-stu-id="41328-109">In this tutorial we learn why stored procedures are recommended when we need additional DataTable columns.</span></span>

## <a name="introduction"></a><span data-ttu-id="41328-110">Introducción</span><span class="sxs-lookup"><span data-stu-id="41328-110">Introduction</span></span>

<span data-ttu-id="41328-111">Al agregar un TableAdapter a un conjunto de tipos, el esquema DataTable s correspondiente viene determinado por la consulta principal de TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="41328-111">When adding a TableAdapter to a Typed DataSet, the corresponding DataTable s schema is determined by the TableAdapter s main query.</span></span> <span data-ttu-id="41328-112">Por ejemplo, si la consulta principal devuelve los campos *de datos a*, *b*y *c*, la DataTable tendrá tres columnas correspondientes denominadas *a*, *b*y *c*. Además de su consulta principal, un TableAdapter puede incluir consultas adicionales que devuelven, quizás, un subconjunto de los datos basándose en algún parámetro.</span><span class="sxs-lookup"><span data-stu-id="41328-112">For example, if the main query returns data fields *A*, *B*, and *C*, the DataTable will have three corresponding columns named *A*, *B*, and *C*. In addition to its main query, a TableAdapter can include additional queries that return, perhaps, a subset of the data based on some parameter.</span></span> <span data-ttu-id="41328-113">Por ejemplo, además de la consulta principal `ProductsTableAdapter` s, que devuelve información sobre todos los productos, también contiene métodos como `GetProductsByCategoryID(categoryID)` y `GetProductByProductID(productID)`, que devuelven información específica del producto en función de un parámetro proporcionado.</span><span class="sxs-lookup"><span data-stu-id="41328-113">For instance, in addition to the `ProductsTableAdapter` s main query, which returns information about all products, it also contains methods like `GetProductsByCategoryID(categoryID)` and `GetProductByProductID(productID)`, which return specific product information based on a supplied parameter.</span></span>

<span data-ttu-id="41328-114">El modelo de tener el esquema DataTable s refleja la consulta principal de TableAdapter s funciona bien si todos los métodos TableAdapter s devuelven los mismos campos de datos o menos que los especificados en la consulta principal.</span><span class="sxs-lookup"><span data-stu-id="41328-114">The model of having the DataTable s schema reflect the TableAdapter s main query works well if all of the TableAdapter s methods return the same or fewer data fields than those specified in the main query.</span></span> <span data-ttu-id="41328-115">Si un método TableAdapter necesita devolver campos de datos adicionales, deberíamos expandir el esquema DataTable s en consecuencia.</span><span class="sxs-lookup"><span data-stu-id="41328-115">If a TableAdapter method needs to return additional data fields, then we should expand the DataTable s schema accordingly.</span></span> <span data-ttu-id="41328-116">En la [página maestra/detalle mediante una lista con viñetas de registros maestros con un tutorial de DataList de detalles](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) , agregamos un método a la `CategoriesTableAdapter` que devolvía los campos de datos `CategoryID`, `CategoryName`y `Description` definidos en la consulta principal más `NumberOfProducts`, un campo de datos adicional que indica el número de productos asociados a cada categoría.</span><span class="sxs-lookup"><span data-stu-id="41328-116">In the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that returned the `CategoryID`, `CategoryName`, and `Description` data fields defined in the main query plus `NumberOfProducts`, an additional data field that reported the number of products associated with each category.</span></span> <span data-ttu-id="41328-117">Agregamos manualmente una nueva columna a la `CategoriesDataTable` para capturar el valor del campo de datos `NumberOfProducts` de este nuevo método.</span><span class="sxs-lookup"><span data-stu-id="41328-117">We manually added a new column to the `CategoriesDataTable` in order to capture the `NumberOfProducts` data field value from this new method.</span></span>

<span data-ttu-id="41328-118">Como se describe en el tutorial de [carga de archivos](../working-with-binary-files/uploading-files-cs.md) , se debe tener especial cuidado con los TableAdapters que usan instrucciones SQL ad hoc y tienen métodos cuyos campos de datos no coinciden exactamente con la consulta principal.</span><span class="sxs-lookup"><span data-stu-id="41328-118">As discussed in the [Uploading Files](../working-with-binary-files/uploading-files-cs.md) tutorial, great care must be taken with TableAdapters that use ad-hoc SQL statements and have methods whose data fields do not precisely match the main query.</span></span> <span data-ttu-id="41328-119">Si se vuelve a ejecutar el Asistente para la configuración de TableAdapter, se actualizarán todos los métodos de TableAdapter para que su lista de campos de datos coincida con la consulta principal.</span><span class="sxs-lookup"><span data-stu-id="41328-119">If the TableAdapter Configuration wizard is re-run, it will update all of the TableAdapter s methods so that their data field list matches the main query.</span></span> <span data-ttu-id="41328-120">Por consiguiente, cualquier método con listas de columnas personalizadas revertirá a la lista de columnas de la consulta principal y no devolverá los datos esperados.</span><span class="sxs-lookup"><span data-stu-id="41328-120">Consequently, any methods with customized column lists will revert to the main query s column list and not return the expected data.</span></span> <span data-ttu-id="41328-121">Este problema no se produce cuando se usan procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="41328-121">This issue does not arise when using stored procedures.</span></span>

<span data-ttu-id="41328-122">En este tutorial, veremos cómo extender un esquema DataTable s para incluir columnas adicionales.</span><span class="sxs-lookup"><span data-stu-id="41328-122">In this tutorial we will look at how to extend a DataTable s schema to include additional columns.</span></span> <span data-ttu-id="41328-123">Debido a la fragilidad del TableAdapter cuando se usan instrucciones SQL ad hoc, en este tutorial usaremos procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="41328-123">Due to the brittleness of the TableAdapter when using ad-hoc SQL statements, in this tutorial we will use stored procedures.</span></span> <span data-ttu-id="41328-124">Consulte [crear nuevos procedimientos almacenados para los TableAdapters del conjunto de datos con tipo](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) y [usar procedimientos almacenados existentes para los tutoriales de TableAdapters del conjunto](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs) de datos con tipo para obtener más información sobre la configuración de un TableAdapter para usar procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="41328-124">Refer to the [Creating New Stored Procedures for the Typed DataSet s TableAdapters](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) and [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs) tutorials for more information on configuring a TableAdapter to use stored procedures.</span></span>

## <a name="step-1-adding-apricequartilecolumn-to-theproductsdatatable"></a><span data-ttu-id="41328-125">Paso 1: agregar una columna de`PriceQuartile`al`ProductsDataTable`</span><span class="sxs-lookup"><span data-stu-id="41328-125">Step 1: Adding a`PriceQuartile`Column to the`ProductsDataTable`</span></span>

<span data-ttu-id="41328-126">En el tutorial *crear nuevos procedimientos almacenados para el conjunto de objetos de datasets con tipo* , hemos creado un conjunto de un conjunto de tipos denominado `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="41328-126">In the *Creating New Stored Procedures for the Typed DataSet s TableAdapters* tutorial we created a Typed DataSet named `NorthwindWithSprocs`.</span></span> <span data-ttu-id="41328-127">Este conjunto de contenido contiene actualmente dos DataTables: `ProductsDataTable` y `EmployeesDataTable`.</span><span class="sxs-lookup"><span data-stu-id="41328-127">This DataSet currently contains two DataTables: `ProductsDataTable` and `EmployeesDataTable`.</span></span> <span data-ttu-id="41328-128">El `ProductsTableAdapter` tiene los tres métodos siguientes:</span><span class="sxs-lookup"><span data-stu-id="41328-128">The `ProductsTableAdapter` has the following three methods:</span></span>

- <span data-ttu-id="41328-129">`GetProducts`: la consulta principal, que devuelve todos los registros de la tabla `Products`</span><span class="sxs-lookup"><span data-stu-id="41328-129">`GetProducts` - the main query, which returns all records from the `Products` table</span></span>
- <span data-ttu-id="41328-130">`GetProductsByCategoryID(categoryID)`: devuelve todos los productos con el *IdCategoría*especificado.</span><span class="sxs-lookup"><span data-stu-id="41328-130">`GetProductsByCategoryID(categoryID)` - returns all products with the specified *categoryID*.</span></span>
- <span data-ttu-id="41328-131">`GetProductByProductID(productID)`: devuelve el producto concreto con el *ProductID*especificado.</span><span class="sxs-lookup"><span data-stu-id="41328-131">`GetProductByProductID(productID)` - returns the particular product with the specified *productID*.</span></span>

<span data-ttu-id="41328-132">La consulta principal y los dos métodos adicionales devuelven el mismo conjunto de campos de datos, es decir, todas las columnas de la tabla `Products`.</span><span class="sxs-lookup"><span data-stu-id="41328-132">The main query and the two additional methods all return the same set of data fields, namely all of the columns from the `Products` table.</span></span> <span data-ttu-id="41328-133">No hay subconsultas correlacionadas ni `JOIN` extraer datos relacionados de las tablas `Categories` o `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="41328-133">There are no correlated subqueries or `JOIN` s pulling related data from the `Categories` or `Suppliers` tables.</span></span> <span data-ttu-id="41328-134">Por lo tanto, el `ProductsDataTable` tiene una columna correspondiente para cada campo de la tabla de `Products`.</span><span class="sxs-lookup"><span data-stu-id="41328-134">Therefore, the `ProductsDataTable` has a corresponding column for each field in the `Products` table.</span></span>

<span data-ttu-id="41328-135">En este tutorial, vamos a agregar un método a la `ProductsTableAdapter` denominada `GetProductsWithPriceQuartile` que devuelve todos los productos.</span><span class="sxs-lookup"><span data-stu-id="41328-135">For this tutorial, let s add a method to the `ProductsTableAdapter` named `GetProductsWithPriceQuartile` that returns all of the products.</span></span> <span data-ttu-id="41328-136">Además de los campos de datos de producto estándar, `GetProductsWithPriceQuartile` también incluirá un `PriceQuartile` campo de datos que indica en qué cuartil está el precio del producto.</span><span class="sxs-lookup"><span data-stu-id="41328-136">In addition to the standard product data fields, `GetProductsWithPriceQuartile` will also include a `PriceQuartile` data field that indicates under which quartile the product s price falls.</span></span> <span data-ttu-id="41328-137">Por ejemplo, aquellos productos cuyos precios estén en el 25% más caro tendrán un valor de `PriceQuartile` de 1, mientras que los que se encuentran en el 25% inferior tendrán un valor de 4.</span><span class="sxs-lookup"><span data-stu-id="41328-137">For example, those products whose prices are in the most expensive 25% will have a `PriceQuartile` value of 1, while those whose prices fall in the bottom 25% will have a value of 4.</span></span> <span data-ttu-id="41328-138">Sin embargo, antes de preocuparnos por la creación del procedimiento almacenado para devolver esta información, primero es necesario actualizar el `ProductsDataTable` para incluir una columna que contenga los resultados del `PriceQuartile` cuando se use el método `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="41328-138">Before we worry about creating the stored procedure to return this information, however, we first need to update the `ProductsDataTable` to include a column to hold the `PriceQuartile` results when the `GetProductsWithPriceQuartile` method is used.</span></span>

<span data-ttu-id="41328-139">Abra el conjunto de `NorthwindWithSprocs` y haga clic con el botón derecho en el `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="41328-139">Open the `NorthwindWithSprocs` DataSet and right-click on the `ProductsDataTable`.</span></span> <span data-ttu-id="41328-140">Elija Agregar en el menú contextual y, a continuación, seleccione columna.</span><span class="sxs-lookup"><span data-stu-id="41328-140">Choose Add from the context-menu and then pick Column.</span></span>

<span data-ttu-id="41328-141">[![agregar una nueva columna a ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="41328-141">[![Add a New Column to the ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span></span>

<span data-ttu-id="41328-142">**Figura 1**: agregar una nueva columna a la `ProductsDataTable` ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="41328-142">**Figure 1**: Add a New Column to the `ProductsDataTable` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image3.png))</span></span>

<span data-ttu-id="41328-143">Esto agregará una nueva columna a la DataTable denominada Column1 de tipo `System.String`.</span><span class="sxs-lookup"><span data-stu-id="41328-143">This will add a new column to the DataTable named Column1 of type `System.String`.</span></span> <span data-ttu-id="41328-144">Necesitamos actualizar el nombre de esta columna a PriceQuartile y su tipo a `System.Int32`, ya que se usará para contener un número entre 1 y 4.</span><span class="sxs-lookup"><span data-stu-id="41328-144">We need to update this column s name to PriceQuartile and its type to `System.Int32` since it will be used to hold a number between 1 and 4.</span></span> <span data-ttu-id="41328-145">Seleccione la columna recién agregada en el `ProductsDataTable` y, en el ventana Propiedades, establezca la propiedad `Name` en PriceQuartile y la propiedad `DataType` en `System.Int32`.</span><span class="sxs-lookup"><span data-stu-id="41328-145">Select the newly-added column in the `ProductsDataTable` and, from the Properties window, set the `Name` property to PriceQuartile and the `DataType` property to `System.Int32`.</span></span>

<span data-ttu-id="41328-146">[![establecer las propiedades de nombre y tipo de columna de las nuevas columnas](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="41328-146">[![Set the New Column s Name and DataType Properties](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span></span>

<span data-ttu-id="41328-147">**Figura 2**: establecer las propiedades de la nueva columna `Name` y `DataType` ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="41328-147">**Figure 2**: Set the New Column s `Name` and `DataType` Properties ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image6.png))</span></span>

<span data-ttu-id="41328-148">Como se muestra en la figura 2, hay propiedades adicionales que se pueden establecer, por ejemplo, si los valores de la columna deben ser únicos, si la columna es una columna de incremento automático, si se permiten o no los valores de `NULL` de la base de datos, etc.</span><span class="sxs-lookup"><span data-stu-id="41328-148">As Figure 2 shows, there are additional properties that can be set, such as whether the values in the column must be unique, if the column is an auto-increment column, whether or not database `NULL` values are allowed, and so on.</span></span> <span data-ttu-id="41328-149">Deje estos valores establecidos en sus valores predeterminados.</span><span class="sxs-lookup"><span data-stu-id="41328-149">Leave these values set to their defaults.</span></span>

## <a name="step-2-creating-thegetproductswithpricequartilemethod"></a><span data-ttu-id="41328-150">Paso 2: crear el método`GetProductsWithPriceQuartile`</span><span class="sxs-lookup"><span data-stu-id="41328-150">Step 2: Creating the`GetProductsWithPriceQuartile`Method</span></span>

<span data-ttu-id="41328-151">Ahora que el `ProductsDataTable` se ha actualizado para incluir la columna `PriceQuartile`, estamos preparados para crear el método `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="41328-151">Now that the `ProductsDataTable` has been updated to include the `PriceQuartile` column, we are ready to create the `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="41328-152">Para empezar, haga clic con el botón derecho en el TableAdapter y elija Agregar consulta en el menú contextual.</span><span class="sxs-lookup"><span data-stu-id="41328-152">Start by right-clicking on the TableAdapter and choosing Add Query from the context-menu.</span></span> <span data-ttu-id="41328-153">Se abre el Asistente para configuración de consultas de TableAdapter, que primero nos pregunta si deseamos usar instrucciones SQL ad hoc o un procedimiento almacenado nuevo o existente.</span><span class="sxs-lookup"><span data-stu-id="41328-153">This brings up the TableAdapter Query Configuration wizard, which first prompts us as to whether we want to use ad-hoc SQL statements or a new or existing stored procedure.</span></span> <span data-ttu-id="41328-154">Dado que todavía no tenemos un procedimiento almacenado que devuelva los datos del cuartil de precios, permita que el TableAdapter cree este procedimiento almacenado para nosotros.</span><span class="sxs-lookup"><span data-stu-id="41328-154">Since we don t yet have a stored procedure that returns the price quartile data, let s allow the TableAdapter to create this stored procedure for us.</span></span> <span data-ttu-id="41328-155">Seleccione la opción Crear nuevo procedimiento almacenado y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="41328-155">Select the Create new stored procedure option and click Next.</span></span>

<span data-ttu-id="41328-156">[![indicar al asistente de TableAdapter que cree el procedimiento almacenado para nosotros](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="41328-156">[![Instruct the TableAdapter Wizard to Create the Stored Procedure For Us](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span></span>

<span data-ttu-id="41328-157">**Figura 3**: indicar al asistente de TableAdapter que cree el procedimiento almacenado para nosotros ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="41328-157">**Figure 3**: Instruct the TableAdapter Wizard to Create the Stored Procedure For Us ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image9.png))</span></span>

<span data-ttu-id="41328-158">En la pantalla siguiente, que se muestra en la figura 4, el asistente nos pregunta qué tipo de consulta agregar.</span><span class="sxs-lookup"><span data-stu-id="41328-158">In the subsequent screen, shown in Figure 4, the wizard asks us what type of query to add.</span></span> <span data-ttu-id="41328-159">Dado que el método `GetProductsWithPriceQuartile` devolverá todas las columnas y los registros de la tabla `Products`, seleccione la opción seleccionar qué devuelve filas y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="41328-159">Since the `GetProductsWithPriceQuartile` method will return all columns and records from the `Products` table, select the SELECT which returns rows option and click Next.</span></span>

<span data-ttu-id="41328-160">[![nuestra consulta será una instrucción SELECT que devuelva varias filas](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="41328-160">[![Our Query will be a SELECT Statement that Returns Multiple Rows](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span></span>

<span data-ttu-id="41328-161">**Figura 4**: nuestra consulta será una instrucción `SELECT` que devuelve varias filas ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="41328-161">**Figure 4**: Our Query will be a `SELECT` Statement that Returns Multiple Rows ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image12.png))</span></span>

<span data-ttu-id="41328-162">A continuación, se le pedirá el `SELECT` consulta.</span><span class="sxs-lookup"><span data-stu-id="41328-162">Next we are prompted for the `SELECT` query.</span></span> <span data-ttu-id="41328-163">En el asistente, escriba la siguiente consulta:</span><span class="sxs-lookup"><span data-stu-id="41328-163">Enter the following query into the wizard:</span></span>

[!code-sql[Main](adding-additional-datatable-columns-cs/samples/sample1.sql)]

<span data-ttu-id="41328-164">La consulta anterior utiliza SQL Server [función new`NTILE`](https://msdn.microsoft.com/library/ms175126.aspx) de 2005 s para dividir los resultados en cuatro grupos en los que los grupos vienen determinados por los valores de `UnitPrice` ordenados en orden descendente.</span><span class="sxs-lookup"><span data-stu-id="41328-164">The above query uses SQL Server 2005 s new [`NTILE` function](https://msdn.microsoft.com/library/ms175126.aspx) to divide the results into four groups where the groups are determined by the `UnitPrice` values sorted in descending order.</span></span>

<span data-ttu-id="41328-165">Desafortunadamente, el Generador de consultas no sabe cómo analizar la palabra clave `OVER` y mostrará un error al analizar la consulta anterior.</span><span class="sxs-lookup"><span data-stu-id="41328-165">Unfortunately, the Query Builder does not know how to parse the `OVER` keyword and will display an error when parsing the above query.</span></span> <span data-ttu-id="41328-166">Por lo tanto, escriba la consulta anterior directamente en el cuadro de texto del asistente sin usar el Generador de consultas.</span><span class="sxs-lookup"><span data-stu-id="41328-166">Therefore, enter the above query directly in the textbox in the wizard without using the Query Builder.</span></span>

> [!NOTE]
> <span data-ttu-id="41328-167">Para obtener más información sobre NTILE y SQL Server 2005 s otras funciones de categoría, vea [devolver resultados clasificados con Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) y la [sección funciones de categoría](https://msdn.microsoft.com/library/ms189798.aspx) en los [libros en pantalla de SQL Server 2005](https://msdn.microsoft.com/library/ms189798.aspx).</span><span class="sxs-lookup"><span data-stu-id="41328-167">For more information on NTILE and SQL Server 2005 s other ranking functions, see [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) and the [Ranking Functions section](https://msdn.microsoft.com/library/ms189798.aspx) from the [SQL Server 2005 Books Online](https://msdn.microsoft.com/library/ms189798.aspx).</span></span>

<span data-ttu-id="41328-168">Después de escribir la consulta de `SELECT` y hacer clic en siguiente, el asistente nos pide que proporcione un nombre para el procedimiento almacenado que creará.</span><span class="sxs-lookup"><span data-stu-id="41328-168">After entering the `SELECT` query and clicking Next, the wizard asks us to provide a name for the stored procedure it will create.</span></span> <span data-ttu-id="41328-169">Asigne un nombre al nuevo procedimiento almacenado `Products_SelectWithPriceQuartile` y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="41328-169">Name the new stored procedure `Products_SelectWithPriceQuartile` and click Next.</span></span>

<span data-ttu-id="41328-170">[![el nombre del procedimiento almacenado Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="41328-170">[![Name the Stored Procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span></span>

<span data-ttu-id="41328-171">**Figura 5**: asignar un nombre al procedimiento almacenado `Products_SelectWithPriceQuartile` ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="41328-171">**Figure 5**: Name the Stored Procedure `Products_SelectWithPriceQuartile` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image15.png))</span></span>

<span data-ttu-id="41328-172">Por último, se le pedirá que asigne un nombre a los métodos de TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="41328-172">Lastly, we are prompted to name the TableAdapter methods.</span></span> <span data-ttu-id="41328-173">Deje las casillas rellenar un DataTable y devolver un objeto DataTable activada y asigne a los métodos el nombre `FillWithPriceQuartile` y `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="41328-173">Leave both the Fill a DataTable and Return a DataTable checkboxes checked and name the methods `FillWithPriceQuartile` and `GetProductsWithPriceQuartile`.</span></span>

<span data-ttu-id="41328-174">[![nombre de los métodos de TableAdapter y haga clic en finalizar](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="41328-174">[![Name the TableAdapter s Methods and Click Finish](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span></span>

<span data-ttu-id="41328-175">**Figura 6**: asigne un nombre a los métodos de TableAdapter y haga clic en finalizar ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="41328-175">**Figure 6**: Name the TableAdapter s Methods and Click Finish ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image18.png))</span></span>

<span data-ttu-id="41328-176">Con la consulta `SELECT` especificada y el procedimiento almacenado y los métodos TableAdapter denominados, haga clic en finalizar para completar el asistente.</span><span class="sxs-lookup"><span data-stu-id="41328-176">With the `SELECT` query specified and the stored procedure and TableAdapter methods named, click Finish to complete the wizard.</span></span> <span data-ttu-id="41328-177">En este momento, puede recibir una advertencia o dos del asistente que indica que no se admite la construcción o instrucción de SQL `OVER`.</span><span class="sxs-lookup"><span data-stu-id="41328-177">At this point you may get a warning or two from the wizard saying that The `OVER` SQL construct or statement is not supported.</span></span> <span data-ttu-id="41328-178">Estas advertencias se pueden omitir.</span><span class="sxs-lookup"><span data-stu-id="41328-178">These warnings can be ignored.</span></span>

<span data-ttu-id="41328-179">Después de completar el asistente, el TableAdapter debe incluir los métodos `FillWithPriceQuartile` y `GetProductsWithPriceQuartile` y la base de datos debe incluir un procedimiento almacenado denominado `Products_SelectWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="41328-179">After completing the wizard, the TableAdapter should include the `FillWithPriceQuartile` and `GetProductsWithPriceQuartile` methods and the database should include a stored procedure named `Products_SelectWithPriceQuartile`.</span></span> <span data-ttu-id="41328-180">Dedique un momento a comprobar que el TableAdapter realmente contiene este nuevo método y que el procedimiento almacenado se ha agregado correctamente a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="41328-180">Take a moment to verify that the TableAdapter does indeed contain this new method and that the stored procedure has been correctly added to the database.</span></span> <span data-ttu-id="41328-181">Al comprobar la base de datos, si no ve el procedimiento almacenado, haga clic con el botón secundario en la carpeta procedimientos almacenados y elija actualizar.</span><span class="sxs-lookup"><span data-stu-id="41328-181">When checking the database, if you do not see the stored procedure try right-clicking on the Stored Procedures folder and choosing Refresh.</span></span>

![Comprobar que se ha agregado un nuevo método a TableAdapter](adding-additional-datatable-columns-cs/_static/image19.png)

<span data-ttu-id="41328-183">**Figura 7**: comprobación de que se ha agregado un nuevo método a TableAdapter</span><span class="sxs-lookup"><span data-stu-id="41328-183">**Figure 7**: Verify that a New Method Has Been Added to the TableAdapter</span></span>

<span data-ttu-id="41328-184">[![asegurarse de que la base de datos contiene el Products_SelectWithPriceQuartile procedimiento almacenado](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="41328-184">[![Ensure that the Database Contains the Products_SelectWithPriceQuartile Stored Procedure](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span></span>

<span data-ttu-id="41328-185">**Figura 8**: Asegúrese de que la base de datos contiene el `Products_SelectWithPriceQuartile` procedimiento almacenado ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="41328-185">**Figure 8**: Ensure that the Database Contains the `Products_SelectWithPriceQuartile` Stored Procedure ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image22.png))</span></span>

> [!NOTE]
> <span data-ttu-id="41328-186">Una de las ventajas de utilizar procedimientos almacenados en lugar de instrucciones SQL ad hoc es que volver a ejecutar el Asistente para la configuración de TableAdapter no modificará las listas de columnas de procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="41328-186">One of the benefits of using stored procedures instead of ad-hoc SQL statements is that re-running the TableAdapter Configuration wizard will not modify the stored procedures column lists.</span></span> <span data-ttu-id="41328-187">Para comprobarlo, haga clic con el botón secundario en el TableAdapter, elija la opción configurar en el menú contextual para iniciar el asistente y, a continuación, haga clic en finalizar para completarlo.</span><span class="sxs-lookup"><span data-stu-id="41328-187">Verify this by right-clicking on the TableAdapter, choosing the Configure option from the context-menu to start the wizard, and then clicking Finish to complete it.</span></span> <span data-ttu-id="41328-188">A continuación, vaya a la base de datos y vea el `Products_SelectWithPriceQuartile` procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="41328-188">Next, go to the database and view the `Products_SelectWithPriceQuartile` stored procedure.</span></span> <span data-ttu-id="41328-189">Tenga en cuenta que la lista de columnas no se ha modificado.</span><span class="sxs-lookup"><span data-stu-id="41328-189">Note that its column list has not been modified.</span></span> <span data-ttu-id="41328-190">Si hubiéramos usado instrucciones SQL ad-hoc, volver a ejecutar el Asistente para configuración de TableAdapter habría revertido esta lista de columnas de consulta para que coincida con la lista de columnas de consulta principal, con lo que se quitará la instrucción NTILE de la consulta utilizada por el método `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="41328-190">Had we been using ad-hoc SQL statements, re-running the TableAdapter Configuration wizard would have reverted this query s column list to match the main query column list, thereby removing the NTILE statement from the query used by the `GetProductsWithPriceQuartile` method.</span></span>

<span data-ttu-id="41328-191">Cuando se invoca el método Data Access Layer s `GetProductsWithPriceQuartile`, el TableAdapter ejecuta el `Products_SelectWithPriceQuartile` procedimiento almacenado y agrega una fila a la `ProductsDataTable` para cada registro devuelto.</span><span class="sxs-lookup"><span data-stu-id="41328-191">When the Data Access Layer s `GetProductsWithPriceQuartile` method is invoked, the TableAdapter executes the `Products_SelectWithPriceQuartile` stored procedure and adds a row to the `ProductsDataTable` for each returned record.</span></span> <span data-ttu-id="41328-192">Los campos de datos devueltos por el procedimiento almacenado se asignan a las columnas `ProductsDataTable` s.</span><span class="sxs-lookup"><span data-stu-id="41328-192">The data fields returned by the stored procedure are mapped to the `ProductsDataTable` s columns.</span></span> <span data-ttu-id="41328-193">Dado que hay un `PriceQuartile` campo de datos devuelto por el procedimiento almacenado, su valor se asigna a la columna `ProductsDataTable` s `PriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="41328-193">Since there is a `PriceQuartile` data field returned from the stored procedure, its value is assigned to the `ProductsDataTable` s `PriceQuartile` column.</span></span>

<span data-ttu-id="41328-194">En el caso de los métodos de TableAdapter cuyas consultas no devuelven un `PriceQuartile` campo de datos, el valor de la `PriceQuartile` columna s es el valor especificado por su propiedad `DefaultValue`.</span><span class="sxs-lookup"><span data-stu-id="41328-194">For those TableAdapter methods whose queries do not return a `PriceQuartile` data field, the `PriceQuartile` column s value is the value specified by its `DefaultValue` property.</span></span> <span data-ttu-id="41328-195">Como se muestra en la figura 2, este valor se establece en `DBNull`, el valor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="41328-195">As Figure 2 shows, this value is set to `DBNull`, the default.</span></span> <span data-ttu-id="41328-196">Si prefiere un valor predeterminado diferente, basta con establecer la propiedad `DefaultValue` en consecuencia.</span><span class="sxs-lookup"><span data-stu-id="41328-196">If you would prefer a different default value, simply set the `DefaultValue` property accordingly.</span></span> <span data-ttu-id="41328-197">Solo tiene que asegurarse de que el valor de `DefaultValue` sea válido dado que la columna s `DataType` (es decir, `System.Int32` para la columna de `PriceQuartile`).</span><span class="sxs-lookup"><span data-stu-id="41328-197">Just make sure that the `DefaultValue` value is valid given the column s `DataType` (i.e., `System.Int32` for the `PriceQuartile` column).</span></span>

<span data-ttu-id="41328-198">En este punto, hemos realizado los pasos necesarios para agregar una columna adicional a una DataTable.</span><span class="sxs-lookup"><span data-stu-id="41328-198">At this point we have performed the necessary steps for adding an additional column to a DataTable.</span></span> <span data-ttu-id="41328-199">Para comprobar que esta columna adicional funciona según lo previsto, cree una página ASP.NET que muestre cada nombre de producto, precio y cuartil de precios.</span><span class="sxs-lookup"><span data-stu-id="41328-199">To verify that this additional column works as expected, let s create an ASP.NET page that displays each product s name, price, and price quartile.</span></span> <span data-ttu-id="41328-200">Sin embargo, antes de hacerlo, primero es necesario actualizar la capa de lógica de negocios para incluir un método que llama al método de `GetProductsWithPriceQuartile` de la capa DAL.</span><span class="sxs-lookup"><span data-stu-id="41328-200">Before we do that, though, we first need to update the Business Logic Layer to include a method that calls down to the DAL s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="41328-201">Actualizaremos la capa BLL siguiente, en el paso 3 y, a continuación, crearemos la página ASP.NET en el paso 4.</span><span class="sxs-lookup"><span data-stu-id="41328-201">We will update the BLL next, in Step 3, and then create the ASP.NET page in Step 4.</span></span>

## <a name="step-3-augmenting-the-business-logic-layer"></a><span data-ttu-id="41328-202">Paso 3: aumentar el nivel de lógica de negocios</span><span class="sxs-lookup"><span data-stu-id="41328-202">Step 3: Augmenting the Business Logic Layer</span></span>

<span data-ttu-id="41328-203">Antes de usar el método New `GetProductsWithPriceQuartile` del nivel de presentación, primero debemos agregar el método correspondiente a la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="41328-203">Before we use the new `GetProductsWithPriceQuartile` method from the Presentation Layer, we should first add a corresponding method to the BLL.</span></span> <span data-ttu-id="41328-204">Abra el archivo de clase `ProductsBLLWithSprocs` y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="41328-204">Open the `ProductsBLLWithSprocs` class file and add the following code:</span></span>

[!code-csharp[Main](adding-additional-datatable-columns-cs/samples/sample2.cs)]

<span data-ttu-id="41328-205">Al igual que los demás métodos de recuperación de datos en `ProductsBLLWithSprocs`, el método `GetProductsWithPriceQuartile` simplemente llama al método `GetProductsWithPriceQuartile` de la capa DAL correspondiente y devuelve sus resultados.</span><span class="sxs-lookup"><span data-stu-id="41328-205">Like the other data retrieval methods in `ProductsBLLWithSprocs`, the `GetProductsWithPriceQuartile` method simply calls the DAL s corresponding `GetProductsWithPriceQuartile` method and returns its results.</span></span>

## <a name="step-4-displaying-the-price-quartile-information-in-an-aspnet-web-page"></a><span data-ttu-id="41328-206">Paso 4: visualización de la información del cuartil de precios en una página web de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="41328-206">Step 4: Displaying the Price Quartile Information in an ASP.NET Web Page</span></span>

<span data-ttu-id="41328-207">Una vez completada la adición de BLL, hemos vuelto a preparar la creación de una página de ASP.NET que muestra el cuartil de precios de cada producto.</span><span class="sxs-lookup"><span data-stu-id="41328-207">With the BLL addition complete we re ready to create an ASP.NET page that shows the price quartile for each product.</span></span> <span data-ttu-id="41328-208">Abra la página `AddingColumns.aspx` en la carpeta `AdvancedDAL` y arrastre un control GridView desde el cuadro de herramientas hasta el diseñador, estableciendo su propiedad `ID` en `Products`.</span><span class="sxs-lookup"><span data-stu-id="41328-208">Open the `AddingColumns.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="41328-209">En la etiqueta inteligente de GridView s, enlácelo a un nuevo ObjectDataSource denominado `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="41328-209">From the GridView s smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="41328-210">Configure ObjectDataSource para usar el método de `GetProductsWithPriceQuartile` de `ProductsBLLWithSprocs` Class s.</span><span class="sxs-lookup"><span data-stu-id="41328-210">Configure the ObjectDataSource to use the `ProductsBLLWithSprocs` class s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="41328-211">Dado que se trata de una cuadrícula de solo lectura, establezca las listas desplegables de las pestañas actualizar, insertar y eliminar en (ninguna).</span><span class="sxs-lookup"><span data-stu-id="41328-211">Since this will be a read-only grid, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="41328-212">[![configurar ObjectDataSource para usar la clase ProductsBLLWithSprocs](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="41328-212">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span></span>

<span data-ttu-id="41328-213">**Figura 9**: configuración de ObjectDataSource para usar la clase `ProductsBLLWithSprocs` ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="41328-213">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image25.png))</span></span>

<span data-ttu-id="41328-214">[![recuperar información del producto del método GetProductsWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="41328-214">[![Retrieve Product Information from the GetProductsWithPriceQuartile Method](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span></span>

<span data-ttu-id="41328-215">**Figura 10**: recuperación de la información del producto del método `GetProductsWithPriceQuartile` ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="41328-215">**Figure 10**: Retrieve Product Information from the `GetProductsWithPriceQuartile` Method ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image28.png))</span></span>

<span data-ttu-id="41328-216">Después de completar el Asistente para configurar orígenes de datos, Visual Studio agregará automáticamente un CheckBoxField a GridView para cada uno de los campos de datos devueltos por el método.</span><span class="sxs-lookup"><span data-stu-id="41328-216">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the data fields returned by the method.</span></span> <span data-ttu-id="41328-217">Uno de estos campos de datos es `PriceQuartile`, que es la columna que agregamos al `ProductsDataTable` en el paso 1.</span><span class="sxs-lookup"><span data-stu-id="41328-217">One of these data fields is `PriceQuartile`, which is the column we added to the `ProductsDataTable` in Step 1.</span></span>

<span data-ttu-id="41328-218">Edite los campos de GridView, quitando todos excepto el `ProductName`, `UnitPrice`y `PriceQuartile` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="41328-218">Edit the GridView s fields, removing all but the `ProductName`, `UnitPrice`, and `PriceQuartile` BoundFields.</span></span> <span data-ttu-id="41328-219">Configure el `UnitPrice` BoundField para dar formato de moneda a su valor y tener los `UnitPrice` y `PriceQuartile` BoundFields alineados a la derecha y al centro, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="41328-219">Configure the `UnitPrice` BoundField to format its value as a currency and have the `UnitPrice` and `PriceQuartile` BoundFields right- and center-aligned, respectively.</span></span> <span data-ttu-id="41328-220">Por último, actualice el resto de las propiedades de BoundFields `HeaderText` a producto, precio y cuartil del precio, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="41328-220">Finally, update the remaining BoundFields `HeaderText` properties to Product, Price, and Price Quartile, respectively.</span></span> <span data-ttu-id="41328-221">Además, active la casilla habilitar ordenación de la etiqueta inteligente de GridView s.</span><span class="sxs-lookup"><span data-stu-id="41328-221">Also, check the Enable Sorting checkbox from the GridView s smart tag.</span></span>

<span data-ttu-id="41328-222">Después de estas modificaciones, el marcado declarativo de GridView y ObjectDataSource s debería tener un aspecto similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="41328-222">After these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](adding-additional-datatable-columns-cs/samples/sample3.aspx)]

<span data-ttu-id="41328-223">En la figura 11 se muestra esta página cuando se visita a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="41328-223">Figure 11 shows this page when visited through a browser.</span></span> <span data-ttu-id="41328-224">Tenga en cuenta que, inicialmente, los productos se ordenan por su precio en orden descendente con cada producto asignado a un valor de `PriceQuartile` adecuado.</span><span class="sxs-lookup"><span data-stu-id="41328-224">Note that, initially, the products are ordered by their price in descending order with each product assigned an appropriate `PriceQuartile` value.</span></span> <span data-ttu-id="41328-225">Por supuesto, estos datos se pueden ordenar por otros criterios con el valor de la columna del cuartil del precio, que sigue reflejando la clasificación del producto en relación con el precio (consulte la figura 12).</span><span class="sxs-lookup"><span data-stu-id="41328-225">Of course this data can be sorted by other criteria with the Price Quartile column value still reflecting the product s ranking with respect to price (see Figure 12).</span></span>

<span data-ttu-id="41328-226">[![los productos se ordenan por sus precios](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="41328-226">[![The Products are Ordered by their Prices](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span></span>

<span data-ttu-id="41328-227">**Figura 11**: los productos se ordenan por sus precios ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="41328-227">**Figure 11**: The Products are Ordered by their Prices ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image31.png))</span></span>

<span data-ttu-id="41328-228">[![los productos se ordenan por sus nombres](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="41328-228">[![The Products are Ordered by their Names](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span></span>

<span data-ttu-id="41328-229">**Figura 12**: los productos se ordenan por sus nombres ([haga clic para ver la imagen de tamaño completo](adding-additional-datatable-columns-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="41328-229">**Figure 12**: The Products are Ordered by their Names ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image34.png))</span></span>

> [!NOTE]
> <span data-ttu-id="41328-230">Con unas pocas líneas de código, podríamos aumentar el GridView para que el color de las filas del producto se represente en función de su valor de `PriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="41328-230">With a few lines of code we could augment the GridView so that it colored the product rows based on their `PriceQuartile` value.</span></span> <span data-ttu-id="41328-231">Es posible que el color de los productos del primer cuartil sea verde claro, los del segundo cuartil, un amarillo claro, etc.</span><span class="sxs-lookup"><span data-stu-id="41328-231">We might color those products in the first quartile a light green, those in the second quartile a light yellow, and so forth.</span></span> <span data-ttu-id="41328-232">Le recomiendo que dedique un momento a agregar esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="41328-232">I encourage you to take a moment to add this functionality.</span></span> <span data-ttu-id="41328-233">Si necesita un actualizador para dar formato a un control GridView, consulte el tutorial sobre el [formato personalizado basado en datos](../custom-formatting/custom-formatting-based-upon-data-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="41328-233">If you need a refresher on formatting a GridView, consult the [Custom Formatting Based Upon Data](../custom-formatting/custom-formatting-based-upon-data-cs.md) tutorial.</span></span>

## <a name="an-alternative-approach---creating-another-tableadapter"></a><span data-ttu-id="41328-234">Un enfoque alternativo: crear otro TableAdapter</span><span class="sxs-lookup"><span data-stu-id="41328-234">An Alternative Approach - Creating Another TableAdapter</span></span>

<span data-ttu-id="41328-235">Como vimos en este tutorial, al agregar un método a un TableAdapter que devuelve campos de datos distintos de los escritos por la consulta principal, se pueden agregar las columnas correspondientes a la DataTable.</span><span class="sxs-lookup"><span data-stu-id="41328-235">As we saw in this tutorial, when adding a method to a TableAdapter that returns data fields other than those spelled out by the main query, we can add corresponding columns to the DataTable.</span></span> <span data-ttu-id="41328-236">Sin embargo, este enfoque solo funciona bien si hay un pequeño número de métodos en el TableAdapter que devuelven campos de datos diferentes y los campos de datos alternativos no varían demasiado de la consulta principal.</span><span class="sxs-lookup"><span data-stu-id="41328-236">Such an approach, however, works well only if there are a small number of methods in the TableAdapter that return different data fields and if those alternate data fields do not vary too much from the main query.</span></span>

<span data-ttu-id="41328-237">En lugar de Agregar columnas a la DataTable, en su lugar, puede agregar otro TableAdapter al conjunto de datos que contiene los métodos del primer TableAdapter que devuelven campos de datos diferentes.</span><span class="sxs-lookup"><span data-stu-id="41328-237">Rather than adding columns to the DataTable, you can instead add another TableAdapter to the DataSet that contains the methods from the first TableAdapter that return different data fields.</span></span> <span data-ttu-id="41328-238">En este tutorial, en lugar de agregar la columna `PriceQuartile` a la `ProductsDataTable` (donde solo la usa el método `GetProductsWithPriceQuartile`), podríamos haber agregado un TableAdapter adicional al conjunto de objetos denominado `ProductsWithPriceQuartileTableAdapter` que usaba el `Products_SelectWithPriceQuartile` procedimiento almacenado como consulta principal.</span><span class="sxs-lookup"><span data-stu-id="41328-238">For this tutorial, rather than add the `PriceQuartile` column to the `ProductsDataTable` (where it is only used by the `GetProductsWithPriceQuartile` method), we could have added an additional TableAdapter to the DataSet named `ProductsWithPriceQuartileTableAdapter` that used the `Products_SelectWithPriceQuartile` stored procedure as its main query.</span></span> <span data-ttu-id="41328-239">Las páginas de ASP.NET que necesitaban obtener información del producto con el cuartil de precios usarían el `ProductsWithPriceQuartileTableAdapter`, mientras que los que no podían seguir usando la `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="41328-239">ASP.NET pages that needed to get product information with the price quartile would use the `ProductsWithPriceQuartileTableAdapter`, while those that did not could continue to use the `ProductsTableAdapter`.</span></span>

<span data-ttu-id="41328-240">Al agregar un nuevo TableAdapter, los objetos DataTable permanecen untarnished y sus columnas reflejan exactamente los campos de datos devueltos por sus métodos TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="41328-240">By adding a new TableAdapter, the DataTables remain untarnished and their columns precisely mirror the data fields returned by their TableAdapter s methods.</span></span> <span data-ttu-id="41328-241">Sin embargo, los TableAdapters adicionales pueden introducir tareas y funciones repetitivas.</span><span class="sxs-lookup"><span data-stu-id="41328-241">However, additional TableAdapters can introduce repetitive tasks and functionality.</span></span> <span data-ttu-id="41328-242">Por ejemplo, si las páginas de ASP.NET que muestran la columna `PriceQuartile` también necesitan proporcionar compatibilidad para insertar, actualizar y eliminar, el `ProductsWithPriceQuartileTableAdapter` tendría que tener las propiedades `InsertCommand`, `UpdateCommand`y `DeleteCommand` configuradas correctamente.</span><span class="sxs-lookup"><span data-stu-id="41328-242">For example, if those ASP.NET pages that displayed the `PriceQuartile` column also needed to provide insert, update, and delete support, the `ProductsWithPriceQuartileTableAdapter` would need to have its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties properly configured.</span></span> <span data-ttu-id="41328-243">Aunque estas propiedades reflejarían el `ProductsTableAdapter` s, esta configuración introduce un paso adicional.</span><span class="sxs-lookup"><span data-stu-id="41328-243">While these properties would mirror the `ProductsTableAdapter` s, this configuration introduces an extra step.</span></span> <span data-ttu-id="41328-244">Además, ahora hay dos maneras de actualizar, eliminar o agregar un producto a la base de datos, a través de las clases `ProductsTableAdapter` y `ProductsWithPriceQuartileTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="41328-244">Moreover, there are now two ways to update, delete, or add a product to the database - through the `ProductsTableAdapter` and `ProductsWithPriceQuartileTableAdapter` classes.</span></span>

<span data-ttu-id="41328-245">La descarga de este tutorial incluye una clase `ProductsWithPriceQuartileTableAdapter` en el conjunto de `NorthwindWithSprocs` que ilustra este enfoque alternativo.</span><span class="sxs-lookup"><span data-stu-id="41328-245">The download for this tutorial includes a `ProductsWithPriceQuartileTableAdapter` class in the `NorthwindWithSprocs` DataSet that illustrates this alternative approach.</span></span>

## <a name="summary"></a><span data-ttu-id="41328-246">Resumen</span><span class="sxs-lookup"><span data-stu-id="41328-246">Summary</span></span>

<span data-ttu-id="41328-247">En la mayoría de los escenarios, todos los métodos de un TableAdapter devolverán el mismo conjunto de campos de datos, pero hay ocasiones en las que un determinado método o dos pueden necesitar devolver un campo adicional.</span><span class="sxs-lookup"><span data-stu-id="41328-247">In most scenarios, all of the methods in a TableAdapter will return the same set of data fields, but there are times when a particular method or two may need to return an additional field.</span></span> <span data-ttu-id="41328-248">Por ejemplo, en la [página maestra/detalle mediante una lista con viñetas de registros maestros con un tutorial de DataList de detalles](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) , se ha agregado un método a la `CategoriesTableAdapter` que, además de los campos de datos principales de la consulta, devolvía un campo `NumberOfProducts` que ha comunicado el número de productos asociados a cada categoría.</span><span class="sxs-lookup"><span data-stu-id="41328-248">For example, in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that, in addition to the main query s data fields, returned a `NumberOfProducts` field that reported the number of products associated with each category.</span></span> <span data-ttu-id="41328-249">En este tutorial, hemos examinado cómo agregar un método en la `ProductsTableAdapter` que devolvía un campo `PriceQuartile` además de los campos de datos principales de la consulta.</span><span class="sxs-lookup"><span data-stu-id="41328-249">In this tutorial we looked at adding a method in the `ProductsTableAdapter` that returned a `PriceQuartile` field in addition to the main query s data fields.</span></span> <span data-ttu-id="41328-250">Para capturar campos de datos adicionales devueltos por los métodos de TableAdapter, es necesario agregar las columnas correspondientes a la DataTable.</span><span class="sxs-lookup"><span data-stu-id="41328-250">To capture additional data fields returned by the TableAdapter s methods we need to add corresponding columns to the DataTable.</span></span>

<span data-ttu-id="41328-251">Si planea agregar columnas manualmente a la DataTable, se recomienda que el TableAdapter Use procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="41328-251">If you plan on manually adding columns to the DataTable, it is recommended that the TableAdapter use stored procedures.</span></span> <span data-ttu-id="41328-252">Si el TableAdapter utiliza instrucciones SQL ad hoc, siempre que se ejecute el Asistente para configuración de TableAdapter, todos los métodos listas de campos de datos volverán a los campos de datos devueltos por la consulta principal.</span><span class="sxs-lookup"><span data-stu-id="41328-252">If the TableAdapter uses ad-hoc SQL statements, any time the TableAdapter Configuration wizard is run all of the methods data field lists revert to the data fields returned by the main query.</span></span> <span data-ttu-id="41328-253">Este problema no se extiende a los procedimientos almacenados, por lo que se recomiendan y se usaron en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="41328-253">This problem does not extend to stored procedures, which is why they are recommended and were used in this tutorial.</span></span>

<span data-ttu-id="41328-254">¡ Feliz programación!</span><span class="sxs-lookup"><span data-stu-id="41328-254">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="41328-255">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="41328-255">About the Author</span></span>

<span data-ttu-id="41328-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros de ASP/ASP. net y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha estado trabajando con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="41328-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="41328-257">Scott funciona como consultor, profesor y redactor independiente.</span><span class="sxs-lookup"><span data-stu-id="41328-257">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="41328-258">Su último libro se [*enseña a ASP.NET 2,0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="41328-258">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="41328-259">Puede ponerse en contacto con usted en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="41328-259">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="41328-260">o a través de su blog, que encontrará en [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="41328-260">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="41328-261">Agradecimiento especial a</span><span class="sxs-lookup"><span data-stu-id="41328-261">Special Thanks To</span></span>

<span data-ttu-id="41328-262">Muchos revisores útiles revisaron esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="41328-262">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="41328-263">Los revisores responsables de este tutorial eran Randy Schmidt, Jacky Goor, Bernadette Leigh y Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="41328-263">Lead reviewers for this tutorial were Randy Schmidt, Jacky Goor, Bernadette Leigh, and Hilton Giesenow.</span></span> <span data-ttu-id="41328-264">¿Está interesado en revisar los próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="41328-264">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="41328-265">En caso afirmativo, suéltelo en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="41328-265">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="41328-266">[Anterior](updating-the-tableadapter-to-use-joins-cs.md)
> [Siguiente](working-with-computed-columns-cs.md)</span><span class="sxs-lookup"><span data-stu-id="41328-266">[Previous](updating-the-tableadapter-to-use-joins-cs.md)
[Next](working-with-computed-columns-cs.md)</span></span>
