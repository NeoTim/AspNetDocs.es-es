---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
title: Paginación eficaz a través de grandes cantidadesC#de datos () | Microsoft Docs
author: rick-anderson
description: La opción de paginación predeterminada de un control de presentación de datos no es adecuada cuando se trabaja con grandes cantidades de datos, como el control de origen de datos subyacente recupera...
ms.author: riande
ms.date: 08/15/2006
ms.assetid: 59c01998-9326-4ecb-9392-cb9615962140
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
msc.type: authoredcontent
ms.openlocfilehash: a3e9562035cb24987b01fcdff5fbfb5fa8a1f894
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78477013"
---
# <a name="efficiently-paging-through-large-amounts-of-data-c"></a><span data-ttu-id="70eb0-103">Pasar página por grandes cantidades de datos de forma eficaz (C#)</span><span class="sxs-lookup"><span data-stu-id="70eb0-103">Efficiently Paging Through Large Amounts of Data (C#)</span></span>

<span data-ttu-id="70eb0-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="70eb0-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="70eb0-105">[Descarga](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) de la aplicación de ejemplo o [descarga de PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="70eb0-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span></span>

> <span data-ttu-id="70eb0-106">La opción de paginación predeterminada de un control de presentación de datos no es adecuada cuando se trabaja con grandes cantidades de datos, ya que el control de origen de datos subyacente recupera todos los registros, aunque solo se muestre un subconjunto de datos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="70eb0-107">En tales circunstancias, debemos pasar a la paginación personalizada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-107">In such circumstances, we must turn to custom paging.</span></span>

## <a name="introduction"></a><span data-ttu-id="70eb0-108">Introducción</span><span class="sxs-lookup"><span data-stu-id="70eb0-108">Introduction</span></span>

<span data-ttu-id="70eb0-109">Como se explicó en el tutorial anterior, la paginación se puede implementar de una de estas dos maneras:</span><span class="sxs-lookup"><span data-stu-id="70eb0-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="70eb0-110">La **paginación predeterminada** se puede implementar simplemente comprobando la opción Habilitar paginación en la etiqueta inteligente control de Web de datos. sin embargo, cada vez que se ve una página de datos, el ObjectDataSource recupera *todos* los registros, aunque solo se muestre un subconjunto de ellos en la página.</span><span class="sxs-lookup"><span data-stu-id="70eb0-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="70eb0-111">La **paginación personalizada** mejora el rendimiento de la paginación predeterminada al recuperar solo los registros de la base de datos que se deben mostrar para la página de datos determinada que solicita el usuario. sin embargo, la paginación personalizada implica un poco más de trabajo de implementación que la paginación predeterminada</span><span class="sxs-lookup"><span data-stu-id="70eb0-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="70eb0-112">Debido a la facilidad de implementación, active una casilla y vuelva a realizarla.</span><span class="sxs-lookup"><span data-stu-id="70eb0-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="70eb0-113">la paginación predeterminada es una opción atractiva.</span><span class="sxs-lookup"><span data-stu-id="70eb0-113">default paging is an attractive option.</span></span> <span data-ttu-id="70eb0-114">Sin embargo, su enfoque na en la recuperación de todos los registros lo convierte en una opción improbable al paginar a través de cantidades de datos suficientemente grandes o para sitios con muchos usuarios simultáneos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="70eb0-115">En tales circunstancias, debemos pasar a la paginación personalizada para proporcionar un sistema con capacidad de respuesta.</span><span class="sxs-lookup"><span data-stu-id="70eb0-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="70eb0-116">El reto de la paginación personalizada es la posibilidad de escribir una consulta que devuelve el conjunto preciso de registros necesarios para una página de datos determinada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="70eb0-117">Afortunadamente, Microsoft SQL Server 2005 proporciona una nueva palabra clave para clasificar los resultados, lo que nos permite escribir una consulta que pueda recuperar eficazmente el subconjunto de registros adecuado.</span><span class="sxs-lookup"><span data-stu-id="70eb0-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="70eb0-118">En este tutorial veremos cómo usar esta nueva SQL Server palabra clave 2005 para implementar la paginación personalizada en un control GridView.</span><span class="sxs-lookup"><span data-stu-id="70eb0-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="70eb0-119">Aunque la interfaz de usuario para la paginación personalizada es idéntica a la paginación predeterminada, la ejecución paso a paso de una página a la siguiente mediante la paginación personalizada puede ser de varios pedidos de magnitud más rápido que la paginación predeterminada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="70eb0-120">La ganancia de rendimiento exacta que exhibe la paginación personalizada depende del número total de registros que se van a paginar y de la carga que se va a colocar en el servidor de base de datos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="70eb0-121">Al final de este tutorial veremos algunas métricas generales que muestran las ventajas del rendimiento obtenido a través de la paginación personalizada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>

## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="70eb0-122">Paso 1: Descripción del proceso de paginación personalizada</span><span class="sxs-lookup"><span data-stu-id="70eb0-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="70eb0-123">Al paginar a través de los datos, los registros precisos que se muestran en una página dependen de la página de datos que se solicita y del número de registros que se muestran por página.</span><span class="sxs-lookup"><span data-stu-id="70eb0-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="70eb0-124">Por ejemplo, Imagine que queríamos paginar los productos 81, mostrando 10 productos por página.</span><span class="sxs-lookup"><span data-stu-id="70eb0-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="70eb0-125">Al ver la primera página, se desean los productos del 1 al 10. al ver la segunda página, estamos interesados en los productos 11 a 20, etc.</span><span class="sxs-lookup"><span data-stu-id="70eb0-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="70eb0-126">Hay tres variables que indican qué registros deben recuperarse y cómo se debe representar la interfaz de paginación:</span><span class="sxs-lookup"><span data-stu-id="70eb0-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="70eb0-127">**Índice de fila inicial** : índice de la primera fila de la página de datos que se va a mostrar; Este índice se puede calcular multiplicando el índice de la página por los registros que se van a mostrar por página y agregando uno.</span><span class="sxs-lookup"><span data-stu-id="70eb0-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="70eb0-128">Por ejemplo, al paginar los registros 10 a la vez, en la primera página (cuyo índice de página es 0), el índice de la fila inicial es 0 \* 10 + 1 o 1; en la segunda página (cuyo índice de página es 1), el índice de la fila inicial es 1 \* 10 + 1 o 11.</span><span class="sxs-lookup"><span data-stu-id="70eb0-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="70eb0-129">Número **máximo de filas** que se van a mostrar por página.</span><span class="sxs-lookup"><span data-stu-id="70eb0-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="70eb0-130">Esta variable se conoce como número máximo de filas, ya que en la última página puede haber menos registros devueltos que el tamaño de página.</span><span class="sxs-lookup"><span data-stu-id="70eb0-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="70eb0-131">Por ejemplo, al paginar a través de los 81 productos 10 registros por página, la novena y la página final tendrán un solo registro.</span><span class="sxs-lookup"><span data-stu-id="70eb0-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="70eb0-132">Sin embargo, ninguna página mostrará más registros que el valor máximo de filas.</span><span class="sxs-lookup"><span data-stu-id="70eb0-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="70eb0-133">**Recuento total** de registros número total de registros que se van a paginar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="70eb0-134">Aunque esta variable no es necesaria para determinar qué registros se van a recuperar en una página determinada, dicta la interfaz de paginación.</span><span class="sxs-lookup"><span data-stu-id="70eb0-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="70eb0-135">Por ejemplo, si hay 81 productos en los que se va a paginar, la interfaz de paginación sabe Mostrar nueve números de página en la interfaz de usuario de paginación.</span><span class="sxs-lookup"><span data-stu-id="70eb0-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="70eb0-136">Con la paginación predeterminada, el índice de la fila inicial se calcula como el producto del índice de la página y el tamaño de página más uno, mientras que el número máximo de filas es simplemente el tamaño de la página.</span><span class="sxs-lookup"><span data-stu-id="70eb0-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="70eb0-137">Dado que la paginación predeterminada recupera todos los registros de la base de datos al representar cualquier página de datos, se conoce el índice de cada fila, lo que hace pasar a la fila de índice de la fila inicial una tarea trivial.</span><span class="sxs-lookup"><span data-stu-id="70eb0-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="70eb0-138">Además, el número total de registros está disponible fácilmente, ya que es simplemente el número de registros de la tabla de datos (o cualquier objeto que se use para contener los resultados de la base de datos).</span><span class="sxs-lookup"><span data-stu-id="70eb0-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="70eb0-139">Dadas las variables de índice de inicio y máximo de filas, una implementación de paginación personalizada solo debe devolver el subconjunto preciso de registros a partir del índice de la fila inicial y hasta el número máximo de filas de registros después.</span><span class="sxs-lookup"><span data-stu-id="70eb0-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="70eb0-140">La paginación personalizada proporciona dos desafíos:</span><span class="sxs-lookup"><span data-stu-id="70eb0-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="70eb0-141">Es necesario poder asociar de forma eficaz un índice de fila con cada fila de los datos completos que se van a paginar a través de para que podamos empezar a devolver registros en el índice de la fila inicial especificada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="70eb0-142">Es necesario proporcionar el número total de registros que se van a paginar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="70eb0-143">En los dos pasos siguientes examinaremos el script SQL necesario para responder a estos dos desafíos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="70eb0-144">Además del script SQL, también tendremos que implementar métodos en DAL y BLL.</span><span class="sxs-lookup"><span data-stu-id="70eb0-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="70eb0-145">Paso 2: devolver el número total de registros que se van a paginar</span><span class="sxs-lookup"><span data-stu-id="70eb0-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="70eb0-146">Antes de examinar cómo recuperar el subconjunto preciso de los registros de la página que se está mostrando, eche un vistazo primero a cómo devolver el número total de registros que se van a paginar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="70eb0-147">Esta información es necesaria para configurar correctamente la interfaz de usuario de paginación.</span><span class="sxs-lookup"><span data-stu-id="70eb0-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="70eb0-148">El número total de registros devueltos por una consulta SQL determinada se puede obtener mediante el [`COUNT` función de agregado](https://msdn.microsoft.com/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="70eb0-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="70eb0-149">Por ejemplo, para determinar el número total de registros en la tabla `Products`, podemos usar la siguiente consulta:</span><span class="sxs-lookup"><span data-stu-id="70eb0-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample1.sql)]

<span data-ttu-id="70eb0-150">Permite agregar un método a la capa DAL que devuelve esta información.</span><span class="sxs-lookup"><span data-stu-id="70eb0-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="70eb0-151">En concreto, vamos a crear un método DAL denominado `TotalNumberOfProducts()` que ejecute la instrucción de `SELECT` mostrada anteriormente.</span><span class="sxs-lookup"><span data-stu-id="70eb0-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="70eb0-152">Para empezar, abra el `Northwind.xsd` archivo de conjunto de archivos con tipo en la carpeta `App_Code/DAL`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="70eb0-153">A continuación, haga clic con el botón derecho en el `ProductsTableAdapter` en el diseñador y elija Agregar consulta.</span><span class="sxs-lookup"><span data-stu-id="70eb0-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="70eb0-154">Como hemos aprendido en los tutoriales anteriores, esto nos permitirá agregar un nuevo método a la capa DAL que, cuando se invoca, ejecutará una instrucción SQL o un procedimiento almacenado determinado.</span><span class="sxs-lookup"><span data-stu-id="70eb0-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="70eb0-155">Al igual que con nuestros métodos de TableAdapter en los tutoriales anteriores, para esta opción se opta por usar una instrucción SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="70eb0-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>

![Usar una instrucción SQL ad hoc](efficiently-paging-through-large-amounts-of-data-cs/_static/image1.png)

<span data-ttu-id="70eb0-157">**Figura 1**: uso de una instrucción SQL ad hoc</span><span class="sxs-lookup"><span data-stu-id="70eb0-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>

<span data-ttu-id="70eb0-158">En la pantalla siguiente, se puede especificar el tipo de consulta que se va a crear.</span><span class="sxs-lookup"><span data-stu-id="70eb0-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="70eb0-159">Puesto que esta consulta devolverá un único valor escalar, el número total de registros de la tabla `Products` elige el `SELECT` que devuelve una opción de valor único.</span><span class="sxs-lookup"><span data-stu-id="70eb0-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>

![Configurar la consulta para utilizar una instrucción SELECT que devuelve un valor único](efficiently-paging-through-large-amounts-of-data-cs/_static/image2.png)

<span data-ttu-id="70eb0-161">**Figura 2**: configuración de la consulta para usar una instrucción SELECT que devuelve un único valor</span><span class="sxs-lookup"><span data-stu-id="70eb0-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>

<span data-ttu-id="70eb0-162">Después de indicar el tipo de consulta que se va a usar, se debe especificar la consulta.</span><span class="sxs-lookup"><span data-stu-id="70eb0-162">After indicating the type of query to use, we must next specify the query.</span></span>

![Usar la consulta SELECT COUNT (\*) FROM Products](efficiently-paging-through-large-amounts-of-data-cs/_static/image3.png)

<span data-ttu-id="70eb0-164">**Figura 3**: uso de la consulta Select COUNT (\*) from Products</span><span class="sxs-lookup"><span data-stu-id="70eb0-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>

<span data-ttu-id="70eb0-165">Por último, especifique el nombre del método.</span><span class="sxs-lookup"><span data-stu-id="70eb0-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="70eb0-166">Como ya se ha mencionado, deje que use `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>

![Asigne al método DAL el nombre TotalNumberOfProducts](efficiently-paging-through-large-amounts-of-data-cs/_static/image4.png)

<span data-ttu-id="70eb0-168">**Figura 4**: nombrar el método Dal TotalNumberOfProducts</span><span class="sxs-lookup"><span data-stu-id="70eb0-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>

<span data-ttu-id="70eb0-169">Después de hacer clic en finalizar, el asistente agregará el método `TotalNumberOfProducts` a la capa DAL.</span><span class="sxs-lookup"><span data-stu-id="70eb0-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="70eb0-170">Los métodos que devuelven valores escalares en la capa DAL devuelven tipos que aceptan valores NULL, en caso de que el resultado de la consulta SQL sea `NULL`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="70eb0-171">Sin embargo, nuestra consulta de `COUNT` siempre devolverá un valor que no sea de`NULL`; sin importar, el método DAL devuelve un entero que acepta valores NULL.</span><span class="sxs-lookup"><span data-stu-id="70eb0-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="70eb0-172">Además del método DAL, también necesitamos un método en la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="70eb0-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="70eb0-173">Abra el archivo de clase de `ProductsBLL` y agregue un método `TotalNumberOfProducts` que simplemente llama al método de `TotalNumberOfProducts` DAL s:</span><span class="sxs-lookup"><span data-stu-id="70eb0-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample2.cs)]

<span data-ttu-id="70eb0-174">El método DAL s `TotalNumberOfProducts` devuelve un entero que acepta valores NULL; sin embargo, se ha creado el método `ProductsBLL` Class s `TotalNumberOfProducts` para que devuelva un entero estándar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="70eb0-175">Por lo tanto, es necesario que el método `ProductsBLL` clase s `TotalNumberOfProducts` devuelva la parte del valor del entero que acepta valores NULL que devuelve el método `TotalNumberOfProducts` de DAL.</span><span class="sxs-lookup"><span data-stu-id="70eb0-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="70eb0-176">La llamada a `GetValueOrDefault()` devuelve el valor del entero que acepta valores NULL, si existe; sin embargo, si el entero que acepta valores NULL es `null`, devuelve el valor entero predeterminado, 0.</span><span class="sxs-lookup"><span data-stu-id="70eb0-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="70eb0-177">Paso 3: devolver el subconjunto preciso de registros</span><span class="sxs-lookup"><span data-stu-id="70eb0-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="70eb0-178">La siguiente tarea consiste en crear métodos en la capa DAL y BLL que acepten las variables de índice de inicio y máximo de filas que se han descrito anteriormente y devuelven los registros correspondientes.</span><span class="sxs-lookup"><span data-stu-id="70eb0-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="70eb0-179">Antes de hacerlo, deje que primero examinemos el script SQL necesario.</span><span class="sxs-lookup"><span data-stu-id="70eb0-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="70eb0-180">El reto de nosotros es que debemos poder asignar eficazmente un índice a cada fila de los resultados completos que se van a paginar a través de para que podamos devolver solo los registros que comienzan en el índice de la fila inicial (y hasta el número máximo de registros).</span><span class="sxs-lookup"><span data-stu-id="70eb0-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="70eb0-181">Esto no es un desafío si ya existe una columna en la tabla de base de datos que actúa como índice de fila.</span><span class="sxs-lookup"><span data-stu-id="70eb0-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="70eb0-182">A primera vista, podríamos pensar que el campo `Products` tabla s `ProductID` sería suficiente, ya que el primer producto tiene `ProductID` de 1, el segundo a 2, etc.</span><span class="sxs-lookup"><span data-stu-id="70eb0-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="70eb0-183">Sin embargo, la eliminación de un producto deja un hueco en la secuencia, anulando este enfoque.</span><span class="sxs-lookup"><span data-stu-id="70eb0-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="70eb0-184">Hay dos técnicas generales que se usan para asociar de forma eficaz un índice de fila con los datos que se van a recorrer, lo que permite recuperar el subconjunto preciso de registros:</span><span class="sxs-lookup"><span data-stu-id="70eb0-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="70eb0-185">Al **utilizar SQL Server palabra clave de `ROW_NUMBER()` 2005 s** nueva en SQL Server 2005, la palabra clave `ROW_NUMBER()` asocia una clasificación con cada registro devuelto según el orden.</span><span class="sxs-lookup"><span data-stu-id="70eb0-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="70eb0-186">Esta clasificación se puede usar como índice de fila para cada fila.</span><span class="sxs-lookup"><span data-stu-id="70eb0-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="70eb0-187">**Usar una variable de tabla y `SET ROWCOUNT`** Se puede utilizar SQL Server [instrucción`SET ROWCOUNT`](https://msdn.microsoft.com/library/ms188774.aspx) para especificar el número total de registros que debe procesar una consulta antes de finalizar. [las variables de tabla](http://www.sqlteam.com/item.asp?ItemID=9454) son variables de T-SQL locales que pueden contener datos tabulares, similar a [las tablas temporales](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="70eb0-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="70eb0-188">Este enfoque funciona igual de bien con Microsoft SQL Server 2005 y SQL Server 2000 (mientras que el enfoque `ROW_NUMBER()` solo funciona con SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="70eb0-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
  <span data-ttu-id="70eb0-189">La idea aquí es crear una variable de tabla que tenga una `IDENTITY` columna y columnas para las claves principales de la tabla cuyos datos se van a paginar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="70eb0-190">Después, el contenido de la tabla cuyos datos se están paginando se vuelca en la variable de tabla, con lo que se asocia un índice de fila secuencial (a través de la columna `IDENTITY`) para cada registro de la tabla.</span><span class="sxs-lookup"><span data-stu-id="70eb0-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="70eb0-191">Una vez que se ha rellenado la variable de tabla, se puede ejecutar una instrucción `SELECT` en la variable de tabla, unida a la tabla subyacente, para extraer los registros determinados.</span><span class="sxs-lookup"><span data-stu-id="70eb0-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="70eb0-192">La instrucción `SET ROWCOUNT` se utiliza para limitar de forma inteligente el número de registros que se deben volcar en la variable de tabla.</span><span class="sxs-lookup"><span data-stu-id="70eb0-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
  <span data-ttu-id="70eb0-193">Este enfoque de eficacia se basa en el número de página que se solicita, ya que al valor `SET ROWCOUNT` se le asigna el valor de inicio de índice de fila más las filas máximas.</span><span class="sxs-lookup"><span data-stu-id="70eb0-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="70eb0-194">Al paginar a través de páginas de número bajo, como las primeras páginas de datos, este enfoque es muy eficaz.</span><span class="sxs-lookup"><span data-stu-id="70eb0-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="70eb0-195">Sin embargo, exhibe un rendimiento similar a la paginación predeterminada al recuperar una página cerca del final.</span><span class="sxs-lookup"><span data-stu-id="70eb0-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="70eb0-196">En este tutorial se implementa la paginación personalizada mediante la palabra clave `ROW_NUMBER()`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="70eb0-197">Para obtener más información sobre el uso de la variable de tabla y la técnica de `SET ROWCOUNT`, vea [un método más eficaz para la paginación a través de grandes conjuntos de resultados](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="70eb0-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="70eb0-198">La palabra clave `ROW_NUMBER()` asociada a una clasificación con cada registro devuelto en una ordenación determinada con la siguiente sintaxis:</span><span class="sxs-lookup"><span data-stu-id="70eb0-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample3.sql)]

<span data-ttu-id="70eb0-199">`ROW_NUMBER()` devuelve un valor numérico que especifica el rango de cada registro con respecto a la ordenación indicada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="70eb0-200">Por ejemplo, para ver el rango de cada producto, ordenado del más caro al menos, podríamos usar la siguiente consulta:</span><span class="sxs-lookup"><span data-stu-id="70eb0-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample4.sql)]

<span data-ttu-id="70eb0-201">En la ilustración 5 se muestran los resultados de esta consulta cuando se ejecutan en la ventana de consulta de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="70eb0-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="70eb0-202">Tenga en cuenta que los productos se ordenan por precio, junto con un rango de precios para cada fila.</span><span class="sxs-lookup"><span data-stu-id="70eb0-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>

![El rango de precios se incluye para cada registro devuelto](efficiently-paging-through-large-amounts-of-data-cs/_static/image5.png)

<span data-ttu-id="70eb0-204">**Figura 5**: el rango de precios se incluye para cada registro devuelto</span><span class="sxs-lookup"><span data-stu-id="70eb0-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>

> [!NOTE]
> <span data-ttu-id="70eb0-205">`ROW_NUMBER()` es solo una de las muchas funciones nuevas de categoría disponibles en SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="70eb0-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="70eb0-206">Para obtener una explicación más detallada de `ROW_NUMBER()`, junto con las demás funciones de categoría, lea [resultados clasificados devueltos con Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="70eb0-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>

<span data-ttu-id="70eb0-207">Al clasificar los resultados por la columna de `ORDER BY` especificada en la cláusula `OVER` (`UnitPrice`, en el ejemplo anterior), SQL Server debe ordenar los resultados.</span><span class="sxs-lookup"><span data-stu-id="70eb0-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="70eb0-208">Se trata de una operación rápida si hay un índice clúster en las columnas en las que se están ordenando los resultados, o si hay un índice de cobertura, pero puede ser más costoso en caso contrario.</span><span class="sxs-lookup"><span data-stu-id="70eb0-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="70eb0-209">Para ayudar a mejorar el rendimiento de las consultas suficientemente grandes, considere la posibilidad de agregar un índice no agrupado para la columna por la que se ordenan los resultados.</span><span class="sxs-lookup"><span data-stu-id="70eb0-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="70eb0-210">Consulte [funciones de categoría y rendimiento en SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) para obtener una visión más detallada de las consideraciones de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="70eb0-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="70eb0-211">La información de clasificación devuelta por `ROW_NUMBER()` no se puede usar directamente en la cláusula `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="70eb0-212">Sin embargo, se puede usar una tabla derivada para devolver el `ROW_NUMBER()` resultado, que puede aparecer en la cláusula `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="70eb0-213">Por ejemplo, la consulta siguiente usa una tabla derivada para devolver las columnas ProductName y UnitPrice, junto con el resultado de la `ROW_NUMBER()` y, a continuación, utiliza una cláusula `WHERE` para devolver solo los productos cuyo rango de precio está entre 11 y 20:</span><span class="sxs-lookup"><span data-stu-id="70eb0-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample5.sql)]

<span data-ttu-id="70eb0-214">Ampliando este concepto un poco más, podemos usar este enfoque para recuperar una página específica de datos según los valores de índice de fila inicial y filas máximas que desee:</span><span class="sxs-lookup"><span data-stu-id="70eb0-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>

[!code-html[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="70eb0-215">Como veremos más adelante en este tutorial, el *`StartRowIndex`* proporcionado por ObjectDataSource se indexa a partir de cero, mientras que el valor de `ROW_NUMBER()` devuelto por SQL Server 2005 se indexa a partir de 1.</span><span class="sxs-lookup"><span data-stu-id="70eb0-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="70eb0-216">Por lo tanto, la cláusula `WHERE` devuelve los registros donde `PriceRank` es estrictamente mayor que *`StartRowIndex`* y menor o igual que`StartRowIndex` \* + `MaximumRows`.\*</span><span class="sxs-lookup"><span data-stu-id="70eb0-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>

<span data-ttu-id="70eb0-217">Ahora que hemos analizado cómo se puede usar `ROW_NUMBER()` para recuperar una página de datos determinada, dados los valores de índice de inicio y máximo de filas, ahora necesitamos implementar esta lógica como métodos en DAL y BLL.</span><span class="sxs-lookup"><span data-stu-id="70eb0-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="70eb0-218">Al crear esta consulta, es necesario decidir el orden por el que se clasificarán los resultados; permita ordenar los productos por su nombre por orden alfabético.</span><span class="sxs-lookup"><span data-stu-id="70eb0-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="70eb0-219">Esto significa que, con la implementación de paginación personalizada en este tutorial, no se podrá crear un informe paginado personalizado que también se pueda ordenar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="70eb0-220">Sin embargo, en el siguiente tutorial, veremos cómo se puede proporcionar esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="70eb0-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="70eb0-221">En la sección anterior, creamos el método DAL como una instrucción SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="70eb0-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="70eb0-222">Desafortunadamente, el analizador de T-SQL de Visual Studio que usa el Asistente de TableAdapter no es como la sintaxis de `OVER` usada por la función `ROW_NUMBER()`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="70eb0-223">Por lo tanto, es necesario crear este método DAL como un procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="70eb0-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="70eb0-224">Seleccione el Explorador de servidores en el menú Ver (o presione Ctrl + Alt + S) y expanda el nodo `NORTHWND.MDF`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="70eb0-225">Para agregar un nuevo procedimiento almacenado, haga clic con el botón secundario en el nodo procedimientos almacenados y elija Agregar un nuevo procedimiento almacenado (vea la figura 6).</span><span class="sxs-lookup"><span data-stu-id="70eb0-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>

![Agregar un nuevo procedimiento almacenado para la paginación a través de los productos](efficiently-paging-through-large-amounts-of-data-cs/_static/image6.png)

<span data-ttu-id="70eb0-227">**Figura 6**: agregar un nuevo procedimiento almacenado para la paginación a través de los productos</span><span class="sxs-lookup"><span data-stu-id="70eb0-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>

<span data-ttu-id="70eb0-228">Este procedimiento almacenado debe aceptar dos parámetros de entrada enteros: `@startRowIndex` y `@maximumRows` y usar la función `ROW_NUMBER()` ordenada por el campo `ProductName`, devolviendo solo las filas mayores que el `@startRowIndex` especificado y menor o igual que `@startRowIndex` + `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="70eb0-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="70eb0-229">Escriba el siguiente script en el nuevo procedimiento almacenado y, a continuación, haga clic en el icono guardar para agregar el procedimiento almacenado a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample7.sql)]

<span data-ttu-id="70eb0-230">Después de crear el procedimiento almacenado, dedique un momento a probarlo. Haga clic con el botón derecho en el `GetProductsPaged` nombre del procedimiento almacenado en el Explorador de servidores y elija la opción ejecutar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="70eb0-231">A continuación, Visual Studio le pedirá los parámetros de entrada, `@startRowIndex` y `@maximumRow` s (consulte la figura 7).</span><span class="sxs-lookup"><span data-stu-id="70eb0-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="70eb0-232">Pruebe valores diferentes y examine los resultados.</span><span class="sxs-lookup"><span data-stu-id="70eb0-232">Try different values and examine the results.</span></span>

![Escriba un valor para los parámetros @startRowIndex y @maximumRows](efficiently-paging-through-large-amounts-of-data-cs/_static/image7.png)

<span data-ttu-id="70eb0-234"><strong>Figura 7</strong>: escriba un valor para los parámetros @startRowIndex y @maximumRows</span><span class="sxs-lookup"><span data-stu-id="70eb0-234"><strong>Figure 7</strong>: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>

<span data-ttu-id="70eb0-235">Después de elegir estos valores de parámetros de entrada, en la ventana de salida se mostrarán los resultados.</span><span class="sxs-lookup"><span data-stu-id="70eb0-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="70eb0-236">En la figura 8 se muestran los resultados al pasar 10 para los parámetros `@startRowIndex` y `@maximumRows`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>

<span data-ttu-id="70eb0-237">[![se devuelven los registros que aparecen en la segunda página de datos](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="70eb0-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span></span>

<span data-ttu-id="70eb0-238">**Figura 8**: se devuelven los registros que aparecen en la segunda página de datos ([haga clic para ver la imagen de tamaño completo](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="70eb0-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span></span>

<span data-ttu-id="70eb0-239">Con este procedimiento almacenado creado, se ha preparado para crear el método de `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="70eb0-240">Abra el `Northwind.xsd` conjunto de bits con tipo, haga clic con el botón derecho en el `ProductsTableAdapter`y elija la opción Agregar consulta.</span><span class="sxs-lookup"><span data-stu-id="70eb0-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="70eb0-241">En lugar de crear la consulta mediante una instrucción SQL ad hoc, créela mediante un procedimiento almacenado existente.</span><span class="sxs-lookup"><span data-stu-id="70eb0-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>

![Crear el método DAL mediante un procedimiento almacenado existente](efficiently-paging-through-large-amounts-of-data-cs/_static/image11.png)

<span data-ttu-id="70eb0-243">**Ilustración 9**: crear el método Dal mediante un procedimiento almacenado existente</span><span class="sxs-lookup"><span data-stu-id="70eb0-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>

<span data-ttu-id="70eb0-244">A continuación, se le pedirá que seleccione el procedimiento almacenado que se va a invocar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="70eb0-245">Elija el `GetProductsPaged` procedimiento almacenado en la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="70eb0-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>

![Elija el procedimiento almacenado GetProductsPaged en la lista desplegable.](efficiently-paging-through-large-amounts-of-data-cs/_static/image12.png)

<span data-ttu-id="70eb0-247">**Figura 10**: elegir el procedimiento almacenado GetProductsPaged en la lista desplegable</span><span class="sxs-lookup"><span data-stu-id="70eb0-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>

<span data-ttu-id="70eb0-248">A continuación, en la siguiente pantalla se le pregunta qué tipo de datos devuelve el procedimiento almacenado: datos tabulares, un solo valor o ningún valor.</span><span class="sxs-lookup"><span data-stu-id="70eb0-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="70eb0-249">Dado que el `GetProductsPaged` procedimiento almacenado puede devolver varios registros, indique que devuelve datos tabulares.</span><span class="sxs-lookup"><span data-stu-id="70eb0-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>

![Indicar que el procedimiento almacenado devuelve datos tabulares](efficiently-paging-through-large-amounts-of-data-cs/_static/image13.png)

<span data-ttu-id="70eb0-251">**Figura 11**: indicar que el procedimiento almacenado devuelve datos tabulares</span><span class="sxs-lookup"><span data-stu-id="70eb0-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>

<span data-ttu-id="70eb0-252">Por último, indique los nombres de los métodos que desea crear.</span><span class="sxs-lookup"><span data-stu-id="70eb0-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="70eb0-253">Al igual que en los tutoriales anteriores, continúe y cree métodos con el rellenado de un DataTable y devuelva un DataTable.</span><span class="sxs-lookup"><span data-stu-id="70eb0-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="70eb0-254">Asigne al primer método el nombre `FillPaged` y el segundo `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>

![Asigne a los métodos el nombre FillPaged y GetProductsPaged](efficiently-paging-through-large-amounts-of-data-cs/_static/image14.png)

<span data-ttu-id="70eb0-256">**Figura 12**: asigne un nombre a los métodos FillPaged y GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="70eb0-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>

<span data-ttu-id="70eb0-257">Además de crear un método DAL para devolver una página determinada de productos, también es necesario proporcionar dicha funcionalidad en la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="70eb0-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="70eb0-258">Al igual que el método DAL, el método GetProductsPaged de BLL debe aceptar dos entradas de enteros para especificar el índice de la fila inicial y el número máximo de filas, y debe devolver solo los registros que se encuentran dentro del intervalo especificado.</span><span class="sxs-lookup"><span data-stu-id="70eb0-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="70eb0-259">Cree este método BLL en la clase ProductsBLL que simplemente llama al método GetProductsPaged de la capa DAL, de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="70eb0-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample8.cs)]

<span data-ttu-id="70eb0-260">Puede usar cualquier nombre para los parámetros de entrada del método BLL, pero, como veremos en breve, al elegir usar `startRowIndex` y `maximumRows` nos ahorrará de un bit de trabajo adicional al configurar un ObjectDataSource para usar este método.</span><span class="sxs-lookup"><span data-stu-id="70eb0-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="70eb0-261">Paso 4: configuración de ObjectDataSource para usar la paginación personalizada</span><span class="sxs-lookup"><span data-stu-id="70eb0-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="70eb0-262">Con los métodos BLL y DAL para tener acceso a un subconjunto de registros determinado, se vuelve a preparar la creación de un control GridView que recorre los registros subyacentes mediante la paginación personalizada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="70eb0-263">Para empezar, abra la página `EfficientPaging.aspx` de la carpeta `PagingAndSorting`, agregue un control GridView a la página y configúrelo para utilizar un nuevo control ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="70eb0-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="70eb0-264">En los tutoriales anteriores, a menudo tuvimos configurado ObjectDataSource para usar el método `ProductsBLL` Class s `GetProducts`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="70eb0-265">Sin embargo, esta vez queremos usar el método `GetProductsPaged` en su lugar, ya que el método `GetProducts` devuelve *todos* los productos de la base de datos, mientras que `GetProductsPaged` devuelve solo un subconjunto determinado de registros.</span><span class="sxs-lookup"><span data-stu-id="70eb0-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>

![Configurar ObjectDataSource para usar el método ProductsBLL de la clase GetProductsPaged](efficiently-paging-through-large-amounts-of-data-cs/_static/image15.png)

<span data-ttu-id="70eb0-267">**Figura 13**: configuración de ObjectDataSource para usar el método ProductsBLL de la clase GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="70eb0-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>

<span data-ttu-id="70eb0-268">Dado que vamos a crear un control GridView de solo lectura, dedique un momento a establecer la lista desplegable de métodos en las pestañas insertar, actualizar y eliminar en (ninguno).</span><span class="sxs-lookup"><span data-stu-id="70eb0-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="70eb0-269">A continuación, el Asistente para ObjectDataSource nos solicita los orígenes de los valores del método `GetProductsPaged` s `startRowIndex` y `maximumRows` parámetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="70eb0-270">Los parámetros de entrada se establecerán realmente mediante GridView automáticamente, por lo que simplemente deje el origen establecido en ninguno y haga clic en finalizar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>

![Dejar los orígenes de parámetro de entrada como ninguno](efficiently-paging-through-large-amounts-of-data-cs/_static/image16.png)

<span data-ttu-id="70eb0-272">**Figura 14**: dejar los orígenes de parámetro de entrada como ninguno</span><span class="sxs-lookup"><span data-stu-id="70eb0-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>

<span data-ttu-id="70eb0-273">Después de completar el Asistente de ObjectDataSource, GridView contendrá un BoundField o CheckBoxField para cada uno de los campos de datos de producto.</span><span class="sxs-lookup"><span data-stu-id="70eb0-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="70eb0-274">No dude en adaptar la apariencia de GridView como considere oportuno.</span><span class="sxs-lookup"><span data-stu-id="70eb0-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="70eb0-275">He optado por mostrar solo las `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`y `UnitPrice` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="70eb0-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="70eb0-276">Además, configure GridView para que admita la paginación. para ello, active la casilla habilitar paginación en su etiqueta inteligente.</span><span class="sxs-lookup"><span data-stu-id="70eb0-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="70eb0-277">Después de estos cambios, el marcado declarativo de GridView y ObjectDataSource debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="70eb0-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample9.aspx)]

<span data-ttu-id="70eb0-278">Sin embargo, si visita la página a través de un explorador, el control GridView no es donde se encuentra.</span><span class="sxs-lookup"><span data-stu-id="70eb0-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>

![GridView no se muestra](efficiently-paging-through-large-amounts-of-data-cs/_static/image17.png)

<span data-ttu-id="70eb0-280">**Figura 15**: no se muestra GridView</span><span class="sxs-lookup"><span data-stu-id="70eb0-280">**Figure 15**: The GridView is Not Displayed</span></span>

<span data-ttu-id="70eb0-281">Falta GridView porque ObjectDataSource está usando actualmente 0 como valores para los parámetros de entrada y `maximumRows` `startRowIndex` de `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="70eb0-282">Por lo tanto, la consulta SQL resultante no devuelve ningún registro y, por tanto, no se muestra GridView.</span><span class="sxs-lookup"><span data-stu-id="70eb0-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="70eb0-283">Para solucionarlo, es necesario configurar ObjectDataSource para usar la paginación personalizada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="70eb0-284">Esto puede realizarse en los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="70eb0-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="70eb0-285">**Establezca la propiedad ObjectDataSource s `EnablePaging` en `true`** esto indica al origen ObjectDataSource que debe pasar al `SelectMethod` dos parámetros adicionales: uno para especificar el índice de la fila inicial ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)) y otro para especificar el número máximo de filas ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span><span class="sxs-lookup"><span data-stu-id="70eb0-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="70eb0-286">**Establezca las propiedades de ObjectDataSource s `StartRowIndexParameterName` y `MaximumRowsParameterName` en consecuencia,** las propiedades `StartRowIndexParameterName` y `MaximumRowsParameterName` indican los nombres de los parámetros de entrada pasados en el `SelectMethod` para fines de paginación personalizada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="70eb0-287">De forma predeterminada, estos nombres de parámetro se `startIndexRow` y `maximumRows`, que es el motivo por el que al crear el método `GetProductsPaged` en el BLL, usé estos valores para los parámetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="70eb0-288">Si decide usar nombres de parámetros diferentes para el método de `GetProductsPaged` de BLL, como `startIndex` y `maxRows`, por ejemplo, debe establecer las propiedades de los `StartRowIndexParameterName` y `MaximumRowsParameterName` de ObjectDataSource según corresponda (como startIndex para `StartRowIndexParameterName` y maxRows para `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="70eb0-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="70eb0-289">**Establezca la propiedad ObjectDataSource s [`SelectCountMethod`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) en el nombre del método que devuelve el número total de registros que se van a paginar (`TotalNumberOfProducts`)** . recuerde que el método `ProductsBLL` de la clase `TotalNumberOfProducts` devuelve el número total de registros que se van a paginar mediante un método dal que ejecuta una consulta de `SELECT COUNT(*) FROM Products`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="70eb0-290">Esta información es necesaria para que ObjectDataSource pueda representar correctamente la interfaz de paginación.</span><span class="sxs-lookup"><span data-stu-id="70eb0-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="70eb0-291">**Quitar los elementos `startRowIndex` y `maximumRows` `<asp:Parameter>` del marcado declarativo de ObjectDataSource s** al configurar ObjectDataSource mediante el asistente, Visual Studio agrega automáticamente dos elementos `<asp:Parameter>` para los parámetros de entrada del método `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="70eb0-292">Al establecer `EnablePaging` en `true`, estos parámetros se pasarán automáticamente. Si también aparecen en la sintaxis declarativa, ObjectDataSource intentará pasar *cuatro* parámetros al método `GetProductsPaged` y dos parámetros al método `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="70eb0-293">Si olvida quitar estos elementos `<asp:Parameter>`, al visitar la página a través de un explorador aparecerá un mensaje de error similar a: *ObjectDataSource ' ObjectDataSource1 ' no encontró un método no genérico ' TotalNumberOfProducts ' que tenga parámetros: startRowIndex, maximumRows*.</span><span class="sxs-lookup"><span data-stu-id="70eb0-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="70eb0-294">Después de realizar estos cambios, la sintaxis declarativa s de ObjectDataSource debe ser similar a la siguiente:</span><span class="sxs-lookup"><span data-stu-id="70eb0-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample10.aspx)]

<span data-ttu-id="70eb0-295">Tenga en cuenta que se han establecido las propiedades `EnablePaging` y `SelectCountMethod` y se han quitado los elementos `<asp:Parameter>`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="70eb0-296">En la figura 16 se muestra una captura de pantalla de la ventana Propiedades una vez realizados estos cambios.</span><span class="sxs-lookup"><span data-stu-id="70eb0-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>

![Para usar la paginación personalizada, configure el control ObjectDataSource](efficiently-paging-through-large-amounts-of-data-cs/_static/image18.png)

<span data-ttu-id="70eb0-298">**Figura 16**: para usar la paginación personalizada, configure el control ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="70eb0-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>

<span data-ttu-id="70eb0-299">Después de realizar estos cambios, visite esta página a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="70eb0-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="70eb0-300">Debería ver 10 productos enumerados por orden alfabético.</span><span class="sxs-lookup"><span data-stu-id="70eb0-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="70eb0-301">Dedique un momento a recorrer los datos una página a la vez.</span><span class="sxs-lookup"><span data-stu-id="70eb0-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="70eb0-302">Aunque no hay ninguna diferencia visual de la perspectiva del usuario final entre la paginación predeterminada y la paginación personalizada, la paginación personalizada se pagina de forma más eficaz a través de grandes cantidades de datos, ya que solo recupera los registros que deben mostrarse para una página determinada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>

<span data-ttu-id="70eb0-303">[![los datos, ordenados por el nombre del producto, se paginan mediante la paginación personalizada](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="70eb0-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span></span>

<span data-ttu-id="70eb0-304">**Figura 17**: los datos, ordenados por el nombre del producto, se paginan mediante la paginación personalizada ([haga clic para ver la imagen de tamaño completo](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="70eb0-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span></span>

> [!NOTE]
> <span data-ttu-id="70eb0-305">Con la paginación personalizada, el valor de recuento de páginas devuelto por la `SelectCountMethod` de ObjectDataSource s se almacena en el estado de vista de GridView.</span><span class="sxs-lookup"><span data-stu-id="70eb0-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="70eb0-306">Otras variables de GridView las `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` colección, etc. se almacenan en el *Estado del control*, que se conserva independientemente del valor de la propiedad `EnableViewState` de GridView.</span><span class="sxs-lookup"><span data-stu-id="70eb0-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="70eb0-307">Puesto que el valor `PageCount` se conserva en los postbacks mediante el estado de vista, cuando se usa una interfaz de paginación que incluye un vínculo para ir a la última página, es imperativo que el estado de vista de GridView esté habilitado.</span><span class="sxs-lookup"><span data-stu-id="70eb0-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="70eb0-308">(Si la interfaz de paginación no incluye un vínculo directo a la última página, puede deshabilitar el estado de vista).</span><span class="sxs-lookup"><span data-stu-id="70eb0-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>

<span data-ttu-id="70eb0-309">Al hacer clic en el vínculo de la última página se produce un postback y se indica a GridView que actualice su `PageIndex` propiedad.</span><span class="sxs-lookup"><span data-stu-id="70eb0-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="70eb0-310">Si se hace clic en el vínculo de la última página, GridView asigna su propiedad `PageIndex` a un valor inferior a su propiedad `PageCount`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="70eb0-311">Con el estado de vista deshabilitado, el valor de `PageCount` se pierde en los postbacks y el `PageIndex` tiene asignado el valor entero máximo en su lugar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="70eb0-312">Después, el control GridView intenta determinar el índice de la fila inicial multiplicando las propiedades `PageSize` y `PageCount`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="70eb0-313">Esto da como resultado una `OverflowException` porque el producto supera el tamaño máximo permitido.</span><span class="sxs-lookup"><span data-stu-id="70eb0-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="70eb0-314">Implementar la paginación y ordenación personalizadas</span><span class="sxs-lookup"><span data-stu-id="70eb0-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="70eb0-315">Nuestra implementación de paginación personalizada actual requiere que el orden en el que se paginan los datos se especifique estáticamente al crear el `GetProductsPaged` procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="70eb0-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="70eb0-316">Sin embargo, es posible que haya observado que la etiqueta inteligente GridView s contiene una casilla habilitar ordenación además de la opción Habilitar paginación.</span><span class="sxs-lookup"><span data-stu-id="70eb0-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="70eb0-317">Desafortunadamente, agregar compatibilidad de ordenación a GridView con nuestra implementación de paginación personalizada actual solo ordenará los registros de la página de datos que se está viendo actualmente.</span><span class="sxs-lookup"><span data-stu-id="70eb0-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="70eb0-318">Por ejemplo, si configura GridView para que también admita la paginación y, a continuación, cuando vea la primera página de datos, ordene por nombre de producto en orden descendente, invertirá el orden de los productos en la Página 1.</span><span class="sxs-lookup"><span data-stu-id="70eb0-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="70eb0-319">Como se muestra en la figura 18, se muestra Carnarvon Tigers como primer producto al ordenar en orden alfabético inverso, lo que omite los 71 otros productos que se encuentran después de Carnarvon Tigers, alfabéticamente. en la ordenación solo se tienen en cuenta los registros de la primera página.</span><span class="sxs-lookup"><span data-stu-id="70eb0-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>

<span data-ttu-id="70eb0-320">[![solo se ordenan los datos que se muestran en la página actual](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="70eb0-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span></span>

<span data-ttu-id="70eb0-321">**Figura 18**: solo se ordenan los datos mostrados en la página actual ([haga clic para ver la imagen de tamaño completo](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="70eb0-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span></span>

<span data-ttu-id="70eb0-322">La ordenación solo se aplica a la página de datos actual, ya que la ordenación se produce después de que los datos se hayan recuperado del método BLL s `GetProductsPaged` y este método solo devuelve los registros de la página específica.</span><span class="sxs-lookup"><span data-stu-id="70eb0-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="70eb0-323">Para implementar la ordenación correctamente, es necesario pasar la expresión de ordenación al método `GetProductsPaged` de modo que los datos se puedan clasificar adecuadamente antes de devolver la página de datos específica.</span><span class="sxs-lookup"><span data-stu-id="70eb0-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="70eb0-324">Veremos cómo hacerlo en el siguiente tutorial.</span><span class="sxs-lookup"><span data-stu-id="70eb0-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="70eb0-325">Implementar la paginación y eliminación personalizadas</span><span class="sxs-lookup"><span data-stu-id="70eb0-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="70eb0-326">Si habilita la eliminación de la funcionalidad en un control GridView cuyos datos se paginan mediante técnicas de paginación personalizadas, descubrirá que, al eliminar el último registro de la última página, GridView desaparecerá en lugar de disminuir correctamente el `PageIndex`de GridView.</span><span class="sxs-lookup"><span data-stu-id="70eb0-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="70eb0-327">Para reproducir este error, habilite la eliminación del tutorial que acabamos de crear.</span><span class="sxs-lookup"><span data-stu-id="70eb0-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="70eb0-328">Vaya a la última página (página 9), donde debería ver un solo producto, ya que estamos paginando a través de 81 productos, 10 productos a la vez.</span><span class="sxs-lookup"><span data-stu-id="70eb0-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="70eb0-329">Elimine este producto.</span><span class="sxs-lookup"><span data-stu-id="70eb0-329">Delete this product.</span></span>

<span data-ttu-id="70eb0-330">Al eliminar el último producto, GridView *debe* ir automáticamente a la octava página y esta funcionalidad se exhibe con paginación predeterminada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="70eb0-331">Sin embargo, con la paginación personalizada, después de eliminar ese último producto en la última página, GridView simplemente desaparece de la pantalla.</span><span class="sxs-lookup"><span data-stu-id="70eb0-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="70eb0-332">El motivo exacto *por* el que ocurre esto es un poco más allá del ámbito de este tutorial. vea [eliminar el último registro de la última página de un control GridView con paginación personalizada](http://scottonwriting.net/sowblog/posts/7326.aspx) para ver los detalles de bajo nivel en lo que se refiere al origen de este problema.</span><span class="sxs-lookup"><span data-stu-id="70eb0-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="70eb0-333">En Resumen, se deben a la siguiente secuencia de pasos que GridView realiza al hacer clic en el botón Eliminar:</span><span class="sxs-lookup"><span data-stu-id="70eb0-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="70eb0-334">Eliminar el registro</span><span class="sxs-lookup"><span data-stu-id="70eb0-334">Delete the record</span></span>
2. <span data-ttu-id="70eb0-335">Obtiene los registros adecuados que se van a mostrar para el `PageIndex` especificado y `PageSize`</span><span class="sxs-lookup"><span data-stu-id="70eb0-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="70eb0-336">Asegúrese de que el `PageIndex` no supera el número de páginas de datos del origen de datos; Si es así, disminuye automáticamente la propiedad `PageIndex` de GridView.</span><span class="sxs-lookup"><span data-stu-id="70eb0-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="70eb0-337">Enlazar la página de datos adecuada a GridView usando los registros obtenidos en el paso 2</span><span class="sxs-lookup"><span data-stu-id="70eb0-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="70eb0-338">El problema se debe al hecho de que en el paso 2 el `PageIndex` que se usa al capturar los registros que se van a mostrar sigue siendo el `PageIndex` de la última página cuyo único registro se ha eliminado.</span><span class="sxs-lookup"><span data-stu-id="70eb0-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="70eb0-339">Por lo tanto, en el paso 2, no se devuelve *ningún* registro, ya que la última página de datos ya no contiene ningún registro.</span><span class="sxs-lookup"><span data-stu-id="70eb0-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="70eb0-340">A continuación, en el paso 3, el control GridView se entiende que su propiedad `PageIndex` es mayor que el número total de páginas del origen de datos (ya que hemos eliminado el último registro de la última página) y, por lo tanto, disminuye su propiedad `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="70eb0-341">En el paso 4, el control GridView intenta enlazarse a los datos recuperados en el paso 2; sin embargo, en el paso 2 no se devolvieron registros, por lo que se produce un control GridView vacío.</span><span class="sxs-lookup"><span data-stu-id="70eb0-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="70eb0-342">Con la paginación predeterminada, este problema no tiene la superficie t porque en el paso 2 se recuperan *todos* los registros del origen de datos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="70eb0-343">Para solucionar este comportamiento tenemos dos opciones.</span><span class="sxs-lookup"><span data-stu-id="70eb0-343">To fix this we have two options.</span></span> <span data-ttu-id="70eb0-344">El primero es crear un controlador de eventos para el controlador de eventos GridView s `RowDeleted` que determina cuántos registros se han mostrado en la página que se acaba de eliminar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="70eb0-345">Si solo había un registro, el registro que acaba de eliminar debe haber sido el último y es necesario reducir el `PageIndex`de GridView.</span><span class="sxs-lookup"><span data-stu-id="70eb0-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="70eb0-346">Por supuesto, solo queremos actualizar el `PageIndex` si la operación de eliminación se realizó correctamente, lo que se puede determinar asegurándose de que se `null`la propiedad `e.Exception`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="70eb0-347">Este enfoque funciona porque actualiza el `PageIndex` después del paso 1, pero antes del paso 2.</span><span class="sxs-lookup"><span data-stu-id="70eb0-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="70eb0-348">Por lo tanto, en el paso 2, se devuelve el conjunto de registros adecuado.</span><span class="sxs-lookup"><span data-stu-id="70eb0-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="70eb0-349">Para ello, use código similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="70eb0-349">To accomplish this, use code like the following:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample11.cs)]

<span data-ttu-id="70eb0-350">Una solución alternativa consiste en crear un controlador de eventos para el evento ObjectDataSource s `RowDeleted` y establecer la propiedad `AffectedRows` en un valor de 1.</span><span class="sxs-lookup"><span data-stu-id="70eb0-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="70eb0-351">Después de eliminar el registro del paso 1 (pero antes de volver a recuperar los datos en el paso 2), GridView actualiza su `PageIndex` propiedad si una o más filas se vieron afectadas por la operación.</span><span class="sxs-lookup"><span data-stu-id="70eb0-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="70eb0-352">Sin embargo, ObjectDataSource no establece la propiedad `AffectedRows` y, por tanto, se omite este paso.</span><span class="sxs-lookup"><span data-stu-id="70eb0-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="70eb0-353">Una manera de ejecutar este paso consiste en establecer manualmente la propiedad `AffectedRows` si la operación de eliminación se completa correctamente.</span><span class="sxs-lookup"><span data-stu-id="70eb0-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="70eb0-354">Esto puede realizarse mediante código como el siguiente:</span><span class="sxs-lookup"><span data-stu-id="70eb0-354">This can be accomplished using code like the following:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample12.cs)]

<span data-ttu-id="70eb0-355">El código de ambos controladores de eventos se puede encontrar en la clase de código subyacente del ejemplo `EfficientPaging.aspx`.</span><span class="sxs-lookup"><span data-stu-id="70eb0-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="70eb0-356">Comparar el rendimiento de la paginación predeterminada y personalizada</span><span class="sxs-lookup"><span data-stu-id="70eb0-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="70eb0-357">Dado que la paginación personalizada solo recupera los registros necesarios, mientras que la paginación predeterminada devuelve *todos* los registros de cada página que se está viendo, es evidente que la paginación personalizada es más eficaz que la paginación predeterminada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="70eb0-358">Pero ¿qué más eficaz es la paginación personalizada?</span><span class="sxs-lookup"><span data-stu-id="70eb0-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="70eb0-359">¿Qué tipo de mejoras de rendimiento se pueden observar moviendo de la paginación predeterminada a la paginación personalizada?</span><span class="sxs-lookup"><span data-stu-id="70eb0-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="70eb0-360">Desafortunadamente, no hay un tamaño que se ajuste a todas las respuestas aquí.</span><span class="sxs-lookup"><span data-stu-id="70eb0-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="70eb0-361">La ganancia de rendimiento depende de una serie de factores, los dos más destacados, el número de registros que se van a paginar y la carga colocada en el servidor de base de datos y los canales de comunicación entre el servidor Web y el servidor de base de datos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="70eb0-362">En el caso de las tablas pequeñas con solo unos cuantos registros, la diferencia de rendimiento puede ser insignificante.</span><span class="sxs-lookup"><span data-stu-id="70eb0-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="70eb0-363">Sin embargo, en el caso de tablas grandes, con miles de cientos de miles de filas, la diferencia de rendimiento es aguda.</span><span class="sxs-lookup"><span data-stu-id="70eb0-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="70eb0-364">Un artículo de la mina, la [paginación personalizada en ASP.NET 2,0 con SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contiene algunas pruebas de rendimiento que ejecuto para mostrar las diferencias de rendimiento entre estas dos técnicas de paginación al paginar a través de una tabla de base de datos con registros de 50.000.</span><span class="sxs-lookup"><span data-stu-id="70eb0-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="70eb0-365">En estas pruebas, examinamos el tiempo de ejecución de la consulta en el nivel de SQL Server (con [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) y en la página ASP.net con [las características de seguimiento de ASP.net s](https://msdn.microsoft.com/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="70eb0-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="70eb0-366">Tenga en cuenta que estas pruebas se ejecutaron en el cuadro de desarrollo con un solo usuario activo y, por lo tanto, no son científicas y no imitan los patrones de carga de sitios web típicos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="70eb0-367">Independientemente de, los resultados muestran las diferencias relativas en el tiempo de ejecución para la paginación predeterminada y personalizada al trabajar con grandes cantidades de datos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>

|  | <span data-ttu-id="70eb0-368">**Promedio de duración (s)**</span><span class="sxs-lookup"><span data-stu-id="70eb0-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="70eb0-369">**Lecturas**</span><span class="sxs-lookup"><span data-stu-id="70eb0-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="70eb0-370">**SQL Profiler de paginación predeterminada**</span><span class="sxs-lookup"><span data-stu-id="70eb0-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="70eb0-371">1.411</span><span class="sxs-lookup"><span data-stu-id="70eb0-371">1.411</span></span> | <span data-ttu-id="70eb0-372">383</span><span class="sxs-lookup"><span data-stu-id="70eb0-372">383</span></span> |
| <span data-ttu-id="70eb0-373">**SQL Profiler de paginación personalizada**</span><span class="sxs-lookup"><span data-stu-id="70eb0-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="70eb0-374">0.002</span><span class="sxs-lookup"><span data-stu-id="70eb0-374">0.002</span></span> | <span data-ttu-id="70eb0-375">29</span><span class="sxs-lookup"><span data-stu-id="70eb0-375">29</span></span> |
| <span data-ttu-id="70eb0-376">**Seguimiento predeterminado de ASP.NET de paginación**</span><span class="sxs-lookup"><span data-stu-id="70eb0-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="70eb0-377">2.379</span><span class="sxs-lookup"><span data-stu-id="70eb0-377">2.379</span></span> | <span data-ttu-id="70eb0-378">*N/D*</span><span class="sxs-lookup"><span data-stu-id="70eb0-378">*N/A*</span></span> |
| <span data-ttu-id="70eb0-379">**Seguimiento de ASP.NET de paginación personalizada**</span><span class="sxs-lookup"><span data-stu-id="70eb0-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="70eb0-380">0.029</span><span class="sxs-lookup"><span data-stu-id="70eb0-380">0.029</span></span> | <span data-ttu-id="70eb0-381">*N/D*</span><span class="sxs-lookup"><span data-stu-id="70eb0-381">*N/A*</span></span> |

<span data-ttu-id="70eb0-382">Como puede ver, la recuperación de una página de datos determinada requiere 354 menos lecturas en promedio y completadas en una fracción del tiempo.</span><span class="sxs-lookup"><span data-stu-id="70eb0-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="70eb0-383">En la página ASP.NET, se ha personalizado la página para que se representara cerca<sup>del 1/100 de</sup> tiempo que se llevó a cabo cuando se usa la paginación predeterminada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="70eb0-384">Vea [mi artículo](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) para obtener más información sobre estos resultados junto con el código y una base de datos que puede descargar para reproducir estas pruebas en su propio entorno.</span><span class="sxs-lookup"><span data-stu-id="70eb0-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="70eb0-385">Resumen</span><span class="sxs-lookup"><span data-stu-id="70eb0-385">Summary</span></span>

<span data-ttu-id="70eb0-386">La paginación predeterminada es un cinch para implementar simplemente active la casilla habilitar paginación en la etiqueta inteligente control Web de datos, pero esta simplicidad se refiere al costo del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="70eb0-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="70eb0-387">Con la paginación predeterminada, cuando un usuario solicita cualquier página de datos, se devuelven *todos* los registros, aunque solo se puede mostrar una pequeña fracción de ellos.</span><span class="sxs-lookup"><span data-stu-id="70eb0-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="70eb0-388">Para combatir esta sobrecarga de rendimiento, ObjectDataSource ofrece una opción de paginación personalizada alternativa.</span><span class="sxs-lookup"><span data-stu-id="70eb0-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="70eb0-389">Aunque la paginación personalizada mejora en los problemas de rendimiento de la paginación predeterminada al recuperar solo los registros que deben mostrarse, es más complicado implementar la paginación personalizada.</span><span class="sxs-lookup"><span data-stu-id="70eb0-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="70eb0-390">En primer lugar, se debe escribir una consulta que tenga acceso correctamente (y de forma eficaz) al subconjunto específico de registros solicitados.</span><span class="sxs-lookup"><span data-stu-id="70eb0-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="70eb0-391">Esto puede realizarse de varias maneras: la que examinamos en este tutorial es usar SQL Server función New `ROW_NUMBER()` de 2005 s para clasificar los resultados y, a continuación, devolver solo los resultados cuya clasificación esté dentro de un intervalo especificado.</span><span class="sxs-lookup"><span data-stu-id="70eb0-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="70eb0-392">Además, es necesario agregar un medio para determinar el número total de registros que se van a paginar.</span><span class="sxs-lookup"><span data-stu-id="70eb0-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="70eb0-393">Después de crear estos métodos DAL y BLL, también es necesario configurar ObjectDataSource para que pueda determinar el número total de registros que se van a paginar y puede pasar correctamente los valores de índice de la fila inicial y máximo de filas a la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="70eb0-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="70eb0-394">Aunque la implementación de la paginación personalizada requiere una serie de pasos y no es casi tan simple como la paginación predeterminada, la paginación personalizada es una necesidad al paginar a través de cantidades de datos suficientemente grandes.</span><span class="sxs-lookup"><span data-stu-id="70eb0-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="70eb0-395">Tal como se ha mostrado en los resultados, la paginación personalizada puede mostrar los segundos en el tiempo de representación de la página ASP.NET y puede aclarar la carga en el servidor de base de datos en uno o varios pedidos de magnitud.</span><span class="sxs-lookup"><span data-stu-id="70eb0-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="70eb0-396">¡ Feliz programación!</span><span class="sxs-lookup"><span data-stu-id="70eb0-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="70eb0-397">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="70eb0-397">About the Author</span></span>

<span data-ttu-id="70eb0-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros de ASP/ASP. net y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha estado trabajando con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="70eb0-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="70eb0-399">Scott funciona como consultor, profesor y redactor independiente.</span><span class="sxs-lookup"><span data-stu-id="70eb0-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="70eb0-400">Su último libro se [*enseña a ASP.NET 2,0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="70eb0-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="70eb0-401">Puede ponerse en contacto con usted en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="70eb0-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="70eb0-402">o a través de su blog, que encontrará en [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="70eb0-402">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="70eb0-403">[Anterior](paging-and-sorting-report-data-cs.md)
> [Siguiente](sorting-custom-paged-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="70eb0-403">[Previous](paging-and-sorting-report-data-cs.md)
[Next](sorting-custom-paged-data-cs.md)</span></span>
