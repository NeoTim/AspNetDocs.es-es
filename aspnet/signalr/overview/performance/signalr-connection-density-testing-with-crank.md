---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: Pruebas de densidad de conexión de signalr con el Cigüeñado | Microsoft Docs
author: bradygaster
description: Pruebas de densidad de la conexión de SignalR con Crank
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: 901e039fbb81651ed18d560c99745b7e7f716e01
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78449875"
---
# <a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="5c0cc-103">Pruebas de densidad de la conexión de SignalR con Crank</span><span class="sxs-lookup"><span data-stu-id="5c0cc-103">SignalR Connection Density Testing with Crank</span></span>

<span data-ttu-id="5c0cc-104">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="5c0cc-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="5c0cc-105">En este artículo se describe cómo usar la herramienta de arranque para probar una aplicación con varios clientes simulados.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>

<span data-ttu-id="5c0cc-106">Una vez que la aplicación se ejecuta en su entorno de hospedaje (ya sea un rol Web de Azure, IIS o autohospedado mediante Owin), puede probar la respuesta de la aplicación a un alto nivel de densidad de conexión mediante la herramienta de arranque.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="5c0cc-107">El entorno de hospedaje puede ser un servidor Internet Information Services (IIS), un host Owin o un rol Web de Azure.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="5c0cc-108">(Nota: los contadores de rendimiento no están disponibles en Web Apps de Azure App Service, por lo que no podrá obtener datos de rendimiento de una prueba de densidad de conexión).</span><span class="sxs-lookup"><span data-stu-id="5c0cc-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="5c0cc-109">La densidad de conexión hace referencia al número de conexiones TCP simultáneas que se pueden establecer en un servidor.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="5c0cc-110">Cada conexión TCP incurre en su propia sobrecarga y, al abrir un gran número de conexiones inactivas, se creará un cuello de botella de memoria.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="5c0cc-111">[El código base de signalr](https://github.com/signalr/signalr) incluye una herramienta de prueba de carga denominada **cigüeñal**.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="5c0cc-112">La versión más reciente del cigüeñal se puede encontrar en [la rama dev](https://github.com/SignalR/signalr/tree/dev) en github.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="5c0cc-113">[Aquí](https://github.com/SignalR/SignalR/archive/dev.zip)puede descargar un archivo zip de la rama dev del código base de signalr.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="5c0cc-114">El cigüeñal se puede usar para saturar completamente la memoria del servidor con el fin de calcular el número total de conexiones inactivas posibles en el hardware del servidor.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="5c0cc-115">Como alternativa, también puede usar el equilibrio para la prueba de carga del servidor en una determinada cantidad de presión de memoria, mediante la puesta en marcha de las conexiones hasta que se alcance un determinado número o un umbral de memoria específico.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="5c0cc-116">Al realizar las pruebas, es importante usar los clientes remotos para evitar la competición por los recursos (es decir, las conexiones TCP y la memoria).</span><span class="sxs-lookup"><span data-stu-id="5c0cc-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="5c0cc-117">Supervise los clientes para asegurarse de que no alcanzan cuellos de botella que puedan impedir que el servidor alcance su capacidad total (memoria o CPU).</span><span class="sxs-lookup"><span data-stu-id="5c0cc-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="5c0cc-118">Es posible que tenga que aumentar el número de clientes para poder cargar el servidor por completo.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="5c0cc-119">Ejecución de una prueba de densidad de conexión</span><span class="sxs-lookup"><span data-stu-id="5c0cc-119">Running a Connection Density Test</span></span>

<span data-ttu-id="5c0cc-120">En esta sección se describen los pasos necesarios para ejecutar una prueba de densidad de conexión en una aplicación Signalr.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="5c0cc-121">Descargue y compile la [rama dev del código base de signalr](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="5c0cc-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="5c0cc-122">En un símbolo del sistema, vaya a &lt;directorio del proyecto&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="5c0cc-123">Implemente la aplicación en su entorno de hospedaje previsto.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="5c0cc-124">Tome nota del punto de conexión que usa la aplicación; por ejemplo, en la aplicación creada en el [tutorial de introducción](../getting-started/tutorial-getting-started-with-signalr.md), el punto de conexión es `http://<yourhost>:8080/signalr`.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="5c0cc-125">Instale los [contadores de rendimiento de signalr](signalr-performance.md#perfcounters) en el servidor.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="5c0cc-126">Si la aplicación se ejecuta en Azure, consulte [uso de contadores de rendimiento de signalr en un rol Web de Azure](using-signalr-performance-counters-in-an-azure-web-role.md).</span><span class="sxs-lookup"><span data-stu-id="5c0cc-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="5c0cc-127">Una vez que haya descargado y compilado el código base, así como los contadores de rendimiento instalados en el host, puede encontrar la herramienta de línea de comandos de un monitor en el `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` carpeta.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="5c0cc-128">Las opciones disponibles para la herramienta de arranque incluyen:</span><span class="sxs-lookup"><span data-stu-id="5c0cc-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="5c0cc-129">**/?** : Muestra la pantalla de ayuda.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="5c0cc-130">También se muestran las opciones disponibles si se omite el parámetro **URL** .</span><span class="sxs-lookup"><span data-stu-id="5c0cc-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="5c0cc-131">**/URL**: la dirección URL para las conexiones de signalr.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="5c0cc-132">Este parámetro es necesario.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-132">This parameter is required.</span></span> <span data-ttu-id="5c0cc-133">En el caso de una aplicación Signalr que use la asignación predeterminada, la ruta de acceso finalizará en "/signalr".</span><span class="sxs-lookup"><span data-stu-id="5c0cc-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="5c0cc-134">**/Seguridad**: el nombre del transporte utilizado.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="5c0cc-135">El valor predeterminado es `auto`, que seleccionará el mejor protocolo disponible.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="5c0cc-136">Entre las opciones se incluyen `WebSockets`, `ServerSentEvents`y `LongPolling` (`ForeverFrame` no es una opción para el cigüeñal, ya que se usa el cliente de .NET en lugar de Internet Explorer).</span><span class="sxs-lookup"><span data-stu-id="5c0cc-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="5c0cc-137">Para más información sobre cómo Signalr selecciona los transportes, consulte [transportes y reservas](../getting-started/introduction-to-signalr.md#transports).</span><span class="sxs-lookup"><span data-stu-id="5c0cc-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="5c0cc-138">**/BatchSize**: número de clientes agregados en cada lote.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="5c0cc-139">El valor predeterminado es 50.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-139">The default is 50.</span></span>
- <span data-ttu-id="5c0cc-140">**/ConnectInterval**: el intervalo en milisegundos entre agregar conexiones.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="5c0cc-141">El valor predeterminado es 500.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-141">The default is 500.</span></span>
- <span data-ttu-id="5c0cc-142">**/Connections**: el número de conexiones usadas para cargar-probar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="5c0cc-143">El valor predeterminado es 100.000.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-143">The default is 100,000.</span></span>
- <span data-ttu-id="5c0cc-144">**/ConnectTimeout**: tiempo de espera en segundos antes de anular la prueba.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="5c0cc-145">El valor predeterminado es 300.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-145">The default is 300.</span></span>
- <span data-ttu-id="5c0cc-146">**MinServerMBytes**: los megabytes de servidor mínimos a los que llegar.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="5c0cc-147">El valor predeterminado es 500.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-147">The default is 500.</span></span>
- <span data-ttu-id="5c0cc-148">**SendBytes**: el tamaño de la carga que se envía al servidor en bytes.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="5c0cc-149">El valor predeterminado es 0.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-149">The default is 0.</span></span>
- <span data-ttu-id="5c0cc-150">**SendInterval**: el retraso en milisegundos entre los mensajes en el servidor.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="5c0cc-151">El valor predeterminado es 500.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-151">The default is 500.</span></span>
- <span data-ttu-id="5c0cc-152">**SendTimeout**: tiempo de espera en milisegundos para los mensajes en el servidor.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="5c0cc-153">El valor predeterminado es 300.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-153">The default is 300.</span></span>
- <span data-ttu-id="5c0cc-154">**ControllerUrl**: la dirección URL en la que un cliente hospedará un concentrador de controlador.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="5c0cc-155">El valor predeterminado es null (sin concentrador de controladores).</span><span class="sxs-lookup"><span data-stu-id="5c0cc-155">The default is null (no controller hub).</span></span> <span data-ttu-id="5c0cc-156">El concentrador de controlador se inicia cuando se inicia la sesión de arranque; no se realiza ningún contacto adicional entre el concentrador del controlador y el cigüeñal.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="5c0cc-157">**NumClients**: número de clientes simulados que se van a conectar a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="5c0cc-158">El valor predeterminado es uno.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-158">The default is one.</span></span>
- <span data-ttu-id="5c0cc-159">**Logfile**: el nombre de archivo del archivo de registro de la ejecución de pruebas.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="5c0cc-160">El valor predeterminado es `crank.csv`.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="5c0cc-161">**SampleInterval**: el tiempo en milisegundos entre muestras del contador de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="5c0cc-162">El valor predeterminado es 1000.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-162">The default is 1000.</span></span>
- <span data-ttu-id="5c0cc-163">**SignalRInstance**: el nombre de la instancia para los contadores de rendimiento en el servidor.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="5c0cc-164">El valor predeterminado es usar el estado de conexión de cliente.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="5c0cc-165">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="5c0cc-165">Example</span></span>

<span data-ttu-id="5c0cc-166">El siguiente comando probará un sitio denominado `pfsignalr` en Azure que hospede una aplicación en el puerto 8080 con un concentrador denominado "ControllerHub", con conexiones de 100.</span><span class="sxs-lookup"><span data-stu-id="5c0cc-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
