---
uid: mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
title: Usar métodos asincrónicos en ASP.NET MVC 4 | Microsoft Docs
author: Rick-Anderson
description: Este tutorial le enseñará los aspectos básicos de la creación de una aplicación web MVC de ASP.NET asincrónica con Visual Studio Express 2012 para Web, que es una versión gratuita...
ms.author: riande
ms.date: 06/06/2012
ms.assetid: a56572ba-81c3-47af-826d-941e9c4775ec
msc.legacyurl: /mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
msc.type: authoredcontent
ms.openlocfilehash: 15692b18fc112c4c6cce4d50a243a0e8d5fb52a4
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457757"
---
# <a name="using-asynchronous-methods-in-aspnet-mvc-4"></a><span data-ttu-id="755ca-103">Usar métodos asincrónicos en ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="755ca-103">Using Asynchronous Methods in ASP.NET MVC 4</span></span>

<span data-ttu-id="755ca-104">por [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="755ca-104">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="755ca-105">Este tutorial le enseñará los aspectos básicos de la creación de una aplicación web MVC de ASP.NET asincrónica con [Visual Studio Express 2012 para web](https://www.microsoft.com/visualstudio/11), que es una versión gratuita de Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="755ca-105">This tutorial will teach you the basics of building an asynchronous ASP.NET MVC Web application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="755ca-106">También puede usar [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="755ca-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span>
> 
> <span data-ttu-id="755ca-107">Se proporciona un ejemplo completo para este tutorial en github [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span><span class="sxs-lookup"><span data-stu-id="755ca-107">A complete sample is provided for this tutorial on github [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span></span>

<span data-ttu-id="755ca-108">La clase de [controlador](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) ASP.NET MVC 4 en la combinación [.net 4,5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) le permite escribir métodos de acción asincrónicos que devuelven un objeto de tipo [Task&lt;ActionResult&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="755ca-108">The ASP.NET MVC 4 [Controller](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) class in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to write asynchronous action methods that return an object of type [Task&lt;ActionResult&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span></span> <span data-ttu-id="755ca-109">El .NET Framework 4 presentó un concepto de programación asincrónica denominado [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) y ASP.NET MVC 4 admite la [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="755ca-109">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET MVC 4 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="755ca-110">Las tareas se representan mediante el tipo de **tarea** y los tipos relacionados en el espacio de nombres [System. Threading. Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) .</span><span class="sxs-lookup"><span data-stu-id="755ca-110">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="755ca-111">El .NET Framework 4,5 se basa en esta compatibilidad asincrónica con las palabras clave [Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) y [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) que hacen que el trabajo con objetos de [tarea](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) sea mucho menos complejo que los enfoques asincrónicos anteriores.</span><span class="sxs-lookup"><span data-stu-id="755ca-111">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="755ca-112">La palabra clave [Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) es una abreviatura sintáctica para indicar que un fragmento de código debe esperar de forma asincrónica en algún otro fragmento de código.</span><span class="sxs-lookup"><span data-stu-id="755ca-112">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="755ca-113">La palabra clave [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) representa una sugerencia que se puede usar para marcar métodos como métodos asincrónicos basados en tareas.</span><span class="sxs-lookup"><span data-stu-id="755ca-113">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="755ca-114">La combinación de **Await**, **Async**y el objeto de **tarea** hace que sea mucho más fácil escribir código asincrónico en .net 4,5.</span><span class="sxs-lookup"><span data-stu-id="755ca-114">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="755ca-115">El nuevo modelo de métodos asincrónicos se denomina *patrón asincrónico basado en tareas* (**TAP**).</span><span class="sxs-lookup"><span data-stu-id="755ca-115">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="755ca-116">En este tutorial se supone que está familiarizado con los programas asincrónicos mediante las palabras clave [Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) y [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) y el espacio de nombres [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) .</span><span class="sxs-lookup"><span data-stu-id="755ca-116">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="755ca-117">Para obtener más información sobre el uso de las palabras clave [Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) y [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) y el espacio de nombres [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) , vea las referencias siguientes.</span><span class="sxs-lookup"><span data-stu-id="755ca-117">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="755ca-118">Notas del producto: asincronía en .NET</span><span class="sxs-lookup"><span data-stu-id="755ca-118">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="755ca-119">Preguntas más frecuentes sobre Async/Await</span><span class="sxs-lookup"><span data-stu-id="755ca-119">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="755ca-120">Programación asincrónica de Visual Studio</span><span class="sxs-lookup"><span data-stu-id="755ca-120">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a><span data-ttu-id="755ca-121">Cómo procesa el grupo de subprocesos las solicitudes</span><span class="sxs-lookup"><span data-stu-id="755ca-121">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="755ca-122">En el servidor Web, el .NET Framework mantiene un grupo de subprocesos que se usan para atender las solicitudes de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="755ca-122">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="755ca-123">Cuando se recibe una solicitud, se envía un subproceso del grupo para procesarla.</span><span class="sxs-lookup"><span data-stu-id="755ca-123">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="755ca-124">Si la solicitud se procesa de forma sincrónica, el subproceso que procesa la solicitud está ocupado mientras se procesa la solicitud y ese subproceso no puede atender a otra solicitud.</span><span class="sxs-lookup"><span data-stu-id="755ca-124">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="755ca-125">Esto podría no ser un problema, porque el grupo de subprocesos puede ser lo suficientemente grande como para alojar muchos subprocesos ocupados.</span><span class="sxs-lookup"><span data-stu-id="755ca-125">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="755ca-126">Sin embargo, el número de subprocesos del grupo de subprocesos es limitado (el máximo predeterminado para .NET 4,5 es 5.000).</span><span class="sxs-lookup"><span data-stu-id="755ca-126">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="755ca-127">En aplicaciones de gran tamaño con una gran simultaneidad de solicitudes de ejecución prolongada, todos los subprocesos disponibles podrían estar ocupados.</span><span class="sxs-lookup"><span data-stu-id="755ca-127">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="755ca-128">Esta condición se conoce como colapso de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="755ca-128">This condition is known as thread starvation.</span></span> <span data-ttu-id="755ca-129">Cuando se alcanza esta condición, el servidor web pone en cola las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="755ca-129">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="755ca-130">Si la cola de solicitudes se llena, el servidor Web rechazará las solicitudes con un Estado HTTP 503 (servidor demasiado ocupado).</span><span class="sxs-lookup"><span data-stu-id="755ca-130">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="755ca-131">El grupo de subprocesos de CLR tiene limitaciones en las nuevas inyecciones de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="755ca-131">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="755ca-132">Si la simultaneidad es más grande (es decir, el sitio web puede obtener repentinamente un gran número de solicitudes) y todos los subprocesos de solicitud disponibles están ocupados debido a llamadas de back-end con latencia elevada, la velocidad de inserción de subprocesos limitada puede hacer que la aplicación responda muy mal.</span><span class="sxs-lookup"><span data-stu-id="755ca-132">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="755ca-133">Además, cada nuevo subproceso agregado al grupo de subprocesos tiene una sobrecarga (por ejemplo, 1 MB de memoria de pila).</span><span class="sxs-lookup"><span data-stu-id="755ca-133">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="755ca-134">Una aplicación web que usa métodos sincrónicos para atender las llamadas de latencia alta en las que el grupo de subprocesos crece hasta el máximo predeterminado de 5, 000 subprocesos consumen aproximadamente 5 GB de memoria más que una aplicación capaz de atender las mismas solicitudes con 4,5. métodos asincrónicos y solo 50 subprocesos.</span><span class="sxs-lookup"><span data-stu-id="755ca-134">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="755ca-135">Cuando está realizando el trabajo asincrónico, no siempre se usa un subproceso.</span><span class="sxs-lookup"><span data-stu-id="755ca-135">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="755ca-136">Por ejemplo, al realizar una solicitud de servicio Web asincrónica, ASP.NET no usará ningún subproceso entre la llamada al método **asincrónico** y el **Await**.</span><span class="sxs-lookup"><span data-stu-id="755ca-136">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="755ca-137">El uso del grupo de subprocesos para atender las solicitudes con latencia alta puede conducir a una gran cantidad de memoria y un uso deficiente del hardware del servidor.</span><span class="sxs-lookup"><span data-stu-id="755ca-137">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="755ca-138">Procesar solicitudes asincrónicas</span><span class="sxs-lookup"><span data-stu-id="755ca-138">Processing Asynchronous Requests</span></span>

<span data-ttu-id="755ca-139">En una aplicación web que ve un gran número de solicitudes simultáneas en el inicio o tiene una carga elevada (donde la simultaneidad aumenta repentinamente), al realizar llamadas asincrónicas al servicio Web se aumenta la capacidad de respuesta de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="755ca-139">In a web app that sees a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous increases the responsiveness of the app.</span></span> <span data-ttu-id="755ca-140">Una solicitud asincrónica tarda el mismo tiempo en procesarse que una sincrónica.</span><span class="sxs-lookup"><span data-stu-id="755ca-140">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="755ca-141">Si una solicitud realiza una llamada de servicio Web que requiere dos segundos para completarse, la solicitud tarda dos segundos si se realiza de forma sincrónica o asincrónica.</span><span class="sxs-lookup"><span data-stu-id="755ca-141">If a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it's performed synchronously or asynchronously.</span></span> <span data-ttu-id="755ca-142">Sin embargo, durante una llamada asincrónica, no se impide que un subproceso responda a otras solicitudes mientras espera a que se complete la primera solicitud.</span><span class="sxs-lookup"><span data-stu-id="755ca-142">However during an asynchronous call, a thread isn't blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="755ca-143">Por consiguiente, las solicitudes asincrónicas impiden la puesta en cola de solicitudes y el crecimiento del grupo de subprocesos cuando hay muchas solicitudes simultáneas que invocan operaciones de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="755ca-143">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a><span data-ttu-id="755ca-144">Elegir métodos de acción sincrónicos o asincrónicos</span><span class="sxs-lookup"><span data-stu-id="755ca-144">Choosing Synchronous or Asynchronous Action Methods</span></span>

<span data-ttu-id="755ca-145">En esta sección se muestran las directrices para decidir cuándo utilizar métodos de acción sincrónicos o asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="755ca-145">This section lists guidelines for when to use synchronous or asynchronous action methods.</span></span> <span data-ttu-id="755ca-146">Estas son simplemente instrucciones; examine cada aplicación individualmente para determinar si los métodos asincrónicos ayudan a mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="755ca-146">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="755ca-147">En general, use métodos sincrónicos para las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="755ca-147">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="755ca-148">Las operaciones son simples o de ejecución breve.</span><span class="sxs-lookup"><span data-stu-id="755ca-148">The operations are simple or short-running.</span></span>
- <span data-ttu-id="755ca-149">La simplicidad es más importante que la eficacia.</span><span class="sxs-lookup"><span data-stu-id="755ca-149">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="755ca-150">Las operaciones son principalmente operaciones de la CPU y no operaciones que requieren una gran sobrecarga del disco o de la red.</span><span class="sxs-lookup"><span data-stu-id="755ca-150">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="755ca-151">El uso de métodos de acción asincrónicos en operaciones relacionadas con la CPU no proporciona ninguna ventaja y da lugar a mayor sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="755ca-151">Using asynchronous action methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

<span data-ttu-id="755ca-152">En general, use métodos asincrónicos para las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="755ca-152">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="755ca-153">Está llamando a servicios que se pueden consumir mediante métodos asincrónicos y usa .NET 4,5 o superior.</span><span class="sxs-lookup"><span data-stu-id="755ca-153">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="755ca-154">Las operaciones están relacionadas con la red o con E/S y no con la CPU.</span><span class="sxs-lookup"><span data-stu-id="755ca-154">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="755ca-155">El paralelismo es más importante que la simplicidad de código.</span><span class="sxs-lookup"><span data-stu-id="755ca-155">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="755ca-156">Se desea proporcionar un mecanismo que permita al usuario cancelar solicitudes de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="755ca-156">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="755ca-157">Cuando la ventaja de cambiar subprocesos supera el costo del cambio de contexto.</span><span class="sxs-lookup"><span data-stu-id="755ca-157">When the benefit of switching threads outweighs the cost of the context switch.</span></span> <span data-ttu-id="755ca-158">En general, debe hacer que un método sea asincrónico si el método sincrónico espera en el subproceso de solicitud ASP.NET mientras no realiza ningún trabajo.</span><span class="sxs-lookup"><span data-stu-id="755ca-158">In general, you should make a method asynchronous if the synchronous method waits on the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="755ca-159">Al hacer que la llamada sea asincrónica, el subproceso de solicitud ASP.NET no se detiene y no realiza ningún trabajo mientras espera a que se complete la solicitud del servicio Web.</span><span class="sxs-lookup"><span data-stu-id="755ca-159">By making the call asynchronous, the ASP.NET request thread is not stalled doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="755ca-160">Las pruebas muestran que las operaciones de bloqueo son un cuello de botella en el rendimiento del sitio y que IIS puede atender más solicitudes mediante métodos asincrónicos para estas llamadas de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="755ca-160">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

<span data-ttu-id="755ca-161">En el ejemplo descargable se muestra cómo utilizar con eficacia los métodos de acción asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="755ca-161">The downloadable sample shows how to use asynchronous action methods effectively.</span></span> <span data-ttu-id="755ca-162">El ejemplo proporcionado se diseñó para proporcionar una demostración sencilla de la programación asincrónica en ASP.NET MVC 4 con .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="755ca-162">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET MVC 4 using .NET 4.5.</span></span> <span data-ttu-id="755ca-163">El ejemplo no pretende ser una arquitectura de referencia para la programación asincrónica en ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="755ca-163">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET MVC.</span></span> <span data-ttu-id="755ca-164">El programa de ejemplo llama a los métodos de [ASP.net web API](../../../web-api/index.md) que, a su vez, llaman a [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) para simular llamadas a servicios Web de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="755ca-164">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="755ca-165">La mayoría de las aplicaciones de producción no mostrarán tales ventajas obvias en el uso de métodos de acción asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="755ca-165">Most production applications will not show such obvious benefits to using asynchronous action methods.</span></span>   
  
<span data-ttu-id="755ca-166">Pocas aplicaciones exigen que todos los métodos de acción sean asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="755ca-166">Few applications require all action methods to be asynchronous.</span></span> <span data-ttu-id="755ca-167">Con frecuencia, basta con convertir algunos métodos de acción sincrónicos en métodos asincrónicos para obtener la máxima eficacia para la cantidad de trabajo requerida.</span><span class="sxs-lookup"><span data-stu-id="755ca-167">Often, converting a few synchronous action methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a><span data-ttu-id="755ca-168">La aplicación de ejemplo</span><span class="sxs-lookup"><span data-stu-id="755ca-168">The Sample Application</span></span>

<span data-ttu-id="755ca-169">Puede descargar la aplicación de ejemplo desde [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) en el sitio de [GitHub](https://github.com/) .</span><span class="sxs-lookup"><span data-stu-id="755ca-169">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="755ca-170">El repositorio consta de tres proyectos:</span><span class="sxs-lookup"><span data-stu-id="755ca-170">The repository consists of three projects:</span></span>

- <span data-ttu-id="755ca-171">*Mvc4Async*: el proyecto ASP.NET MVC 4 que contiene el código usado en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="755ca-171">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in this tutorial.</span></span> <span data-ttu-id="755ca-172">Realiza llamadas API Web al servicio **WebAPIpgw** .</span><span class="sxs-lookup"><span data-stu-id="755ca-172">It makes Web API calls to the **WebAPIpgw** service.</span></span>
- <span data-ttu-id="755ca-173">*WebAPIpgw*: el proyecto de API Web de ASP.NET MVC 4 que implementa los controladores de `Products, Gizmos and Widgets`.</span><span class="sxs-lookup"><span data-stu-id="755ca-173">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="755ca-174">Proporciona los datos para el proyecto *WebAppAsync* y el proyecto *Mvc4Async* .</span><span class="sxs-lookup"><span data-stu-id="755ca-174">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="755ca-175">*WebAppAsync*: el proyecto de formularios Web Forms de ASP.net usado en otro tutorial.</span><span class="sxs-lookup"><span data-stu-id="755ca-175">*WebAppAsync*: The ASP.NET Web Forms project used in another tutorial.</span></span>

## <a id="GizmosSynch"></a><span data-ttu-id="755ca-176">Método de acción sincrónica Gizmos</span><span class="sxs-lookup"><span data-stu-id="755ca-176">The Gizmos Synchronous Action Method</span></span>

 <span data-ttu-id="755ca-177">En el código siguiente se muestra el método de acción `Gizmos` sincrónico que se usa para mostrar una lista de Gizmos.</span><span class="sxs-lookup"><span data-stu-id="755ca-177">The following code shows the `Gizmos` synchronous action method that is used to display a list of gizmos.</span></span> <span data-ttu-id="755ca-178">(En este artículo, un Gizmo es un dispositivo mecánico ficticio).</span><span class="sxs-lookup"><span data-stu-id="755ca-178">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample1.cs)]

<span data-ttu-id="755ca-179">En el código siguiente se muestra el método `GetGizmos` del servicio Gizmo.</span><span class="sxs-lookup"><span data-stu-id="755ca-179">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample2.cs)]

<span data-ttu-id="755ca-180">El método `GizmoService GetGizmos` pasa un URI a un servicio ASP.NET Web API HTTP que devuelve una lista de datos de Gizmos.</span><span class="sxs-lookup"><span data-stu-id="755ca-180">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="755ca-181">El proyecto *WebAPIpgw* contiene la implementación de la API Web `gizmos, widget` y los controladores de `product`.</span><span class="sxs-lookup"><span data-stu-id="755ca-181">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="755ca-182">En la imagen siguiente se muestra la vista Gizmos del proyecto de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="755ca-182">The following image shows the gizmos view from the sample project.</span></span>

![Gizmos](using-asynchronous-methods-in-aspnet-mvc-4/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a><span data-ttu-id="755ca-184">Crear un método de acción Gizmos asincrónico</span><span class="sxs-lookup"><span data-stu-id="755ca-184">Creating an Asynchronous Gizmos Action Method</span></span>

<span data-ttu-id="755ca-185">En el ejemplo se usan las nuevas palabras clave [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) y [Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (disponibles en .net 4,5 y Visual Studio 2012) para permitir que el compilador sea responsable de mantener las complejas transformaciones necesarias para la programación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="755ca-185">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="755ca-186">El compilador permite escribir código mediante C#las construcciones de flujo de control sincrónicos y el compilador aplica automáticamente las transformaciones necesarias para utilizar las devoluciones de llamada con el fin de evitar el bloqueo de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="755ca-186">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="755ca-187">En el código siguiente se muestra el método sincrónico `Gizmos` y el método asincrónico `GizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="755ca-187">The following code shows the `Gizmos` synchronous method and the `GizmosAsync` asynchronous method.</span></span> <span data-ttu-id="755ca-188">Si el explorador admite el [elemento de `<mark>` de HTML 5](http://www.w3.org/wiki/HTML/Elements/mark), verá los cambios en `GizmosAsync` con un resaltado amarillo.</span><span class="sxs-lookup"><span data-stu-id="755ca-188">If your browser supports the [HTML 5 `<mark>` element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample3.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample4.cs?highlight=1,3,5)]

 <span data-ttu-id="755ca-189">Se aplicaron los siguientes cambios para permitir que la `GizmosAsync` sea asincrónica.</span><span class="sxs-lookup"><span data-stu-id="755ca-189">The following changes were applied to allow the `GizmosAsync` to be asynchronous.</span></span>

- <span data-ttu-id="755ca-190">El método se marca con la palabra clave [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , que indica al compilador que genere devoluciones de llamada para partes del cuerpo y que cree automáticamente una `Task<ActionResult>` que se devuelva.</span><span class="sxs-lookup"><span data-stu-id="755ca-190">The method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task<ActionResult>` that is returned.</span></span>
- <span data-ttu-id="755ca-191">&quot;Async&quot; se agregó al nombre del método.</span><span class="sxs-lookup"><span data-stu-id="755ca-191">&quot;Async&quot; was appended to the method name.</span></span> <span data-ttu-id="755ca-192">Anexar "Async" no es necesario, pero es la Convención al escribir métodos asincrónicos.</span><span class="sxs-lookup"><span data-stu-id="755ca-192">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="755ca-193">El tipo de valor devuelto cambió de `ActionResult` a `Task<ActionResult>`.</span><span class="sxs-lookup"><span data-stu-id="755ca-193">The return type was changed from `ActionResult` to `Task<ActionResult>`.</span></span> <span data-ttu-id="755ca-194">El tipo de valor devuelto de `Task<ActionResult>` representa el trabajo en curso y proporciona a los llamadores del método un identificador a través del cual se espera la finalización de la operación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="755ca-194">The return type of `Task<ActionResult>` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span> <span data-ttu-id="755ca-195">En este caso, el autor de la llamada es el servicio Web.</span><span class="sxs-lookup"><span data-stu-id="755ca-195">In this case, the caller is the web service.</span></span> <span data-ttu-id="755ca-196">`Task<ActionResult>` representa el trabajo en curso con el resultado de `ActionResult.`</span><span class="sxs-lookup"><span data-stu-id="755ca-196">`Task<ActionResult>` represents ongoing work with a result of `ActionResult.`</span></span>
- <span data-ttu-id="755ca-197">La palabra clave [Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) se aplicó a la llamada al servicio Web.</span><span class="sxs-lookup"><span data-stu-id="755ca-197">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="755ca-198">Se llamó a la API del servicio Web asincrónico (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="755ca-198">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="755ca-199">Dentro del cuerpo del método `GetGizmosAsync` otro método asincrónico, se llama a `GetGizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="755ca-199">Inside of the `GetGizmosAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="755ca-200">`GetGizmosAsync` devuelve inmediatamente un `Task<List<Gizmo>>` que se completará finalmente cuando los datos estén disponibles.</span><span class="sxs-lookup"><span data-stu-id="755ca-200">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="755ca-201">Dado que no desea hacer nada más hasta que tenga los datos de Gizmo, el código espera la tarea (mediante la palabra clave **Await** ).</span><span class="sxs-lookup"><span data-stu-id="755ca-201">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="755ca-202">Solo puede utilizar la palabra clave **Await** en métodos anotados con la palabra clave **Async** .</span><span class="sxs-lookup"><span data-stu-id="755ca-202">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="755ca-203">La palabra clave **Await** no bloquea el subproceso hasta que se completa la tarea.</span><span class="sxs-lookup"><span data-stu-id="755ca-203">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="755ca-204">Registra el resto del método como una devolución de llamada en la tarea y devuelve inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="755ca-204">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="755ca-205">Cuando se complete la tarea esperada, se invocará esa devolución de llamada y, por tanto, se reanudará la ejecución del método justo donde se quedó.</span><span class="sxs-lookup"><span data-stu-id="755ca-205">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="755ca-206">Para obtener más información sobre el uso de las palabras clave [Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) y [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) y el espacio de nombres [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) , vea [referencias asincrónicas](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="755ca-206">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="755ca-207">El siguiente código muestra los métodos `GetGizmos` y `GetGizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="755ca-207">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample5.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample6.cs?highlight=1,4-8)]

 <span data-ttu-id="755ca-208">Los cambios asincrónicos son similares a los que se realizaron en el **GizmosAsync** anterior.</span><span class="sxs-lookup"><span data-stu-id="755ca-208">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="755ca-209">La firma del método se anotó con la palabra clave [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , el tipo de valor devuelto se cambió a `Task<List<Gizmo>>`y *Async* se anexó al nombre del método.</span><span class="sxs-lookup"><span data-stu-id="755ca-209">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="755ca-210">La clase [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) asincrónica se usa en lugar de la clase [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) .</span><span class="sxs-lookup"><span data-stu-id="755ca-210">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="755ca-211">La palabra clave [Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) se aplicó a los métodos asincrónicos [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="755ca-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) asynchronous methods.</span></span>

<span data-ttu-id="755ca-212">En la imagen siguiente se muestra la vista Gizmo asincrónica.</span><span class="sxs-lookup"><span data-stu-id="755ca-212">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-mvc-4/_static/image2.png)

<span data-ttu-id="755ca-214">La presentación de los exploradores de los datos de Gizmos es idéntica a la vista creada por la llamada sincrónica.</span><span class="sxs-lookup"><span data-stu-id="755ca-214">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="755ca-215">La única diferencia es que la versión asincrónica puede ser más eficaz en cargas pesadas.</span><span class="sxs-lookup"><span data-stu-id="755ca-215">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a id="Parallel"></a><span data-ttu-id="755ca-216">Realizar varias operaciones en paralelo</span><span class="sxs-lookup"><span data-stu-id="755ca-216">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="755ca-217">Los métodos de acción asincrónicos tienen una ventaja significativa con respecto a los métodos sincrónicos cuando una acción debe realizar varias operaciones independientes.</span><span class="sxs-lookup"><span data-stu-id="755ca-217">Asynchronous action methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="755ca-218">En el ejemplo proporcionado, el método sincrónico `PWG`(para productos, widgets y Gizmos) muestra los resultados de tres llamadas al servicio web para obtener una lista de productos, widgets y Gizmos.</span><span class="sxs-lookup"><span data-stu-id="755ca-218">In the sample provided, the synchronous method `PWG`(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="755ca-219">El proyecto de [ASP.net web API](../../../web-api/index.md) que proporciona estos servicios usa [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) para simular latencia o llamadas de red lentas.</span><span class="sxs-lookup"><span data-stu-id="755ca-219">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="755ca-220">Cuando el retraso se establece en 500 milisegundos, el método de `PWGasync` asincrónico tarda un poco más de 500 milisegundos en completarse, mientras que la versión de `PWG` sincrónica tarda más de 1.500 milisegundos.</span><span class="sxs-lookup"><span data-stu-id="755ca-220">When the delay is set to 500 milliseconds, the asynchronous `PWGasync` method takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="755ca-221">En el código siguiente se muestra el método sincrónico `PWG`.</span><span class="sxs-lookup"><span data-stu-id="755ca-221">The synchronous `PWG` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample7.cs)]

<span data-ttu-id="755ca-222">El método `PWGasync` asincrónico se muestra en el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="755ca-222">The asynchronous `PWGasync` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample8.cs?highlight=1,3,12)]

<span data-ttu-id="755ca-223">En la imagen siguiente se muestra la vista devuelta por el método **PWGasync** .</span><span class="sxs-lookup"><span data-stu-id="755ca-223">The following image shows the view returned from the **PWGasync** method.</span></span>

![pwgAsync](using-asynchronous-methods-in-aspnet-mvc-4/_static/image3.png)

## <a id="CancelToken"></a><span data-ttu-id="755ca-225">Usar un token de cancelación</span><span class="sxs-lookup"><span data-stu-id="755ca-225">Using a Cancellation Token</span></span>

<span data-ttu-id="755ca-226">Los métodos de acción asincrónicos que devuelven `Task<ActionResult>`son cancelables, es decir, toman un parámetro [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) cuando se proporciona uno con el atributo [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) .</span><span class="sxs-lookup"><span data-stu-id="755ca-226">Asynchronous action methods returning `Task<ActionResult>`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) attribute.</span></span> <span data-ttu-id="755ca-227">En el código siguiente se muestra el método `GizmosCancelAsync` con un tiempo de espera de 150 milisegundos.</span><span class="sxs-lookup"><span data-stu-id="755ca-227">The following code shows the `GizmosCancelAsync` method with a timeout of 150 milliseconds.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample9.cs?highlight=1-3,5,10)]

<span data-ttu-id="755ca-228">En el código siguiente se muestra la sobrecarga de GetGizmosAsync, que toma un parámetro [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="755ca-228">The following code shows the GetGizmosAsync overload, which takes a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample10.cs)]

<span data-ttu-id="755ca-229">En la aplicación de ejemplo proporcionada, al seleccionar el vínculo de *demostración token de cancelación* , se llama al método `GizmosCancelAsync` y se muestra la cancelación de la llamada asincrónica.</span><span class="sxs-lookup"><span data-stu-id="755ca-229">In the sample application provided, selecting the *Cancellation Token Demo* link calls the `GizmosCancelAsync` method and demonstrates the cancellation of the asynchronous call.</span></span>

## <a id="ServerConfig"></a><span data-ttu-id="755ca-230">Configuración del servidor para las llamadas de servicio Web de alta simultaneidad y latencia alta</span><span class="sxs-lookup"><span data-stu-id="755ca-230">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="755ca-231">Para obtener las ventajas de una aplicación web asincrónica, es posible que tenga que realizar algunos cambios en la configuración predeterminada del servidor.</span><span class="sxs-lookup"><span data-stu-id="755ca-231">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="755ca-232">Tenga en cuenta lo siguiente al configurar y realizar pruebas de esfuerzo de la aplicación web asincrónica.</span><span class="sxs-lookup"><span data-stu-id="755ca-232">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="755ca-233">Windows 7, Windows Vista y todos los sistemas operativos de cliente de Windows tienen un máximo de 10 solicitudes simultáneas.</span><span class="sxs-lookup"><span data-stu-id="755ca-233">Windows 7, Windows Vista and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="755ca-234">Necesitará un sistema operativo Windows Server para ver las ventajas de los métodos asincrónicos con una carga elevada.</span><span class="sxs-lookup"><span data-stu-id="755ca-234">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="755ca-235">Registre .NET 4,5 con IIS desde un símbolo del sistema con privilegios elevados:</span><span class="sxs-lookup"><span data-stu-id="755ca-235">Register .NET 4.5 with IIS from an elevated command prompt:</span></span>  
  <span data-ttu-id="755ca-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis-i</span><span class="sxs-lookup"><span data-stu-id="755ca-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis -i</span></span>  
  <span data-ttu-id="755ca-237">Consulte [ASP.net IIS registration Tool (Aspnet\_regiis. exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span><span class="sxs-lookup"><span data-stu-id="755ca-237">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="755ca-238">Es posible que tenga que aumentar el límite de la cola [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) del valor predeterminado de 1.000 a 5.000.</span><span class="sxs-lookup"><span data-stu-id="755ca-238">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="755ca-239">Si el valor es demasiado bajo, es posible que vea las solicitudes de rechazo [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) con un estado http 503.</span><span class="sxs-lookup"><span data-stu-id="755ca-239">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="755ca-240">Para cambiar el límite de la cola HTTP. sys:</span><span class="sxs-lookup"><span data-stu-id="755ca-240">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="755ca-241">Abra el administrador de IIS y navegue hasta el panel grupos de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="755ca-241">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="755ca-242">Haga clic con el botón derecho en el grupo de aplicaciones de destino y seleccione **Configuración avanzada**.</span><span class="sxs-lookup"><span data-stu-id="755ca-242">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="755ca-243">](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png) de ![avanzadas</span><span class="sxs-lookup"><span data-stu-id="755ca-243">![advanced](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png)</span></span>
    - <span data-ttu-id="755ca-244">En el cuadro de diálogo **Configuración avanzada** , cambie la longitud de la *cola* de 1.000 a 5.000.</span><span class="sxs-lookup"><span data-stu-id="755ca-244">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="755ca-245">![longitud de cola](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="755ca-245">![Queue length](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span></span>  
  
  <span data-ttu-id="755ca-246">Tenga en cuenta que en las imágenes anteriores, .NET Framework se muestra como v 4.0, aunque el grupo de aplicaciones use .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="755ca-246">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="755ca-247">Para comprender esta discrepancia, consulte lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="755ca-247">To understand this discrepancy, see the following:</span></span>

    - [<span data-ttu-id="755ca-248">Control de versiones de .NET y compatibilidad con múltiples versiones: .NET 4,5 es una actualización local a .NET 4,0</span><span class="sxs-lookup"><span data-stu-id="755ca-248">.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0</span></span>](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
    - [<span data-ttu-id="755ca-249">Cómo establecer una aplicación de IIS o AppPool para usar ASP.NET 3,5 en lugar de 2,0</span><span class="sxs-lookup"><span data-stu-id="755ca-249">How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0</span></span>](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
    - <span data-ttu-id="755ca-250">[Versiones y dependencias de .NET Framework](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="755ca-250">[.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span></span>
- <span data-ttu-id="755ca-251">Si su aplicación usa servicios web o System.NET para comunicarse con un back-end a través de HTTP, puede que tenga que aumentar el elemento [connectionManagement/MaxConnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="755ca-251">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="755ca-252">En el caso de las aplicaciones ASP.NET, está limitado por la característica AutoConfig a 12 veces el número de CPU.</span><span class="sxs-lookup"><span data-stu-id="755ca-252">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="755ca-253">Esto significa que en un proceso cuádruple, puede tener como máximo 12 \* 4 = 48 conexiones simultáneas a un extremo de IP.</span><span class="sxs-lookup"><span data-stu-id="755ca-253">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="755ca-254">Dado que está vinculado a [AutoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), la manera más fácil de aumentar `maxconnection` en una aplicación ASP.net es establecer [System .net. ServicePointManager. DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) mediante programación en el método from `Application_Start` en el archivo *global. asax* .</span><span class="sxs-lookup"><span data-stu-id="755ca-254">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="755ca-255">Vea la descarga de ejemplo para obtener un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="755ca-255">See the sample download for an example.</span></span>
- <span data-ttu-id="755ca-256">En .NET 4,5, el valor predeterminado de 5000 para [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) debe ser correcto.</span><span class="sxs-lookup"><span data-stu-id="755ca-256">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>
