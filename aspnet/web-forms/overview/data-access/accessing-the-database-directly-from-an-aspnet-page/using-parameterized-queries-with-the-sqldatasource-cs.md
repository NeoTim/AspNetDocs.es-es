---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-cs
title: Usar consultas parametrizadas con SqlDataSource (C#) | Microsoft Docs
author: rick-anderson
description: En este tutorial, se continúa nuestro aspecto en el control SqlDataSource y obtenga información sobre cómo definir consultas con parámetros. Los parámetros se pueden especificar ambos decla...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: 9128aaac-afe2-449f-84b2-bb1d035083c4
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-cs
msc.type: authoredcontent
ms.openlocfilehash: 34135c5cdcda5c49c9cdad14b26eb20992b6dcc8
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/06/2019
ms.locfileid: "65124488"
---
# <a name="using-parameterized-queries-with-the-sqldatasource-c"></a><span data-ttu-id="9d88f-104">Usar consultas parametrizadas con SqlDataSource (C#)</span><span class="sxs-lookup"><span data-stu-id="9d88f-104">Using Parameterized Queries with the SqlDataSource (C#)</span></span>

<span data-ttu-id="9d88f-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9d88f-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9d88f-106">[Descargue la aplicación de ejemplo](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_CS.exe) o [descargar PDF](using-parameterized-queries-with-the-sqldatasource-cs/_static/datatutorial48cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9d88f-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_CS.exe) or [Download PDF](using-parameterized-queries-with-the-sqldatasource-cs/_static/datatutorial48cs1.pdf)</span></span>

> <span data-ttu-id="9d88f-107">En este tutorial, se continúa nuestro aspecto en el control SqlDataSource y obtenga información sobre cómo definir consultas con parámetros.</span><span class="sxs-lookup"><span data-stu-id="9d88f-107">In this tutorial, we continue our look at the SqlDataSource control and learn how to define parameterized queries.</span></span> <span data-ttu-id="9d88f-108">Los parámetros se pueden especificar mediante declaración y mediante programación y pueden extraerse de un número de ubicaciones, como la cadena de consulta, estado sesión, otros controles y mucho más.</span><span class="sxs-lookup"><span data-stu-id="9d88f-108">The parameters can be specified both declaratively and programmatically, and can be pulled from a number of locations such as the querystring, Session state, other controls, and more.</span></span>

## <a name="introduction"></a><span data-ttu-id="9d88f-109">Introducción</span><span class="sxs-lookup"><span data-stu-id="9d88f-109">Introduction</span></span>

<span data-ttu-id="9d88f-110">En el tutorial anterior, vimos cómo usar el control SqlDataSource para recuperar los datos directamente desde una base de datos.</span><span class="sxs-lookup"><span data-stu-id="9d88f-110">In the previous tutorial we saw how to use the SqlDataSource control to retrieve data directly from a database.</span></span> <span data-ttu-id="9d88f-111">Mediante el Asistente para configurar orígenes de datos, podríamos seleccionar la base de datos y, a continuación, ya sea: elegir las columnas que se va a devolver desde una tabla o vista; Escriba una instrucción SQL personalizada; o bien usar un procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-111">Using the Configure Data Source wizard, we could choose the database and then either: pick the columns to return from a table or view; enter a custom SQL statement; or use a stored procedure.</span></span> <span data-ttu-id="9d88f-112">Si selecciona las columnas de una tabla o vista, o escribir una instrucción SQL personalizada, SqlDataSource control s `SelectCommand` propiedad se asigna el código SQL resultante ad-hoc `SELECT` instrucción y esto es `SELECT` instrucción que se ejecuta cuando el S SqlDataSource `Select()` se invoca el método (ya sea mediante programación o automáticamente desde un control Web de datos).</span><span class="sxs-lookup"><span data-stu-id="9d88f-112">Whether selecting columns from a table or view or entering a custom SQL statement, the SqlDataSource control s `SelectCommand` property is assigned the resulting ad-hoc SQL `SELECT` statement and it is this `SELECT` statement that is executed when the SqlDataSource s `Select()` method is invoked (either programmatically or automatically from a data Web control).</span></span>

<span data-ttu-id="9d88f-113">El código SQL `SELECT` instrucciones que se usan en las demostraciones de tutorial s anterior carecía de `WHERE` cláusulas.</span><span class="sxs-lookup"><span data-stu-id="9d88f-113">The SQL `SELECT` statements used in the previous tutorial s demos lacked `WHERE` clauses.</span></span> <span data-ttu-id="9d88f-114">En un `SELECT` instrucción, el `WHERE` cláusula puede utilizarse para limitar los resultados devueltos.</span><span class="sxs-lookup"><span data-stu-id="9d88f-114">In a `SELECT` statement, the `WHERE` clause can be used to limit the results returned.</span></span> <span data-ttu-id="9d88f-115">Por ejemplo, para mostrar los nombres de productos que cuestan más de 50,00 dólares, podríamos usar la siguiente consulta:</span><span class="sxs-lookup"><span data-stu-id="9d88f-115">For example, to display the names of products costing more than $50.00, we could use the following query:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample1.sql)]

<span data-ttu-id="9d88f-116">Normalmente, los valores utilizados en un `WHERE` cláusula se determinan por algún origen externo, como un valor de cadena de consulta, una variable de sesión o entrada de usuario desde un control Web en la página.</span><span class="sxs-lookup"><span data-stu-id="9d88f-116">Typically, the values used in a `WHERE` clause are determine by some external source, such as a querystring value, a session variable, or user input from a Web control on the page.</span></span> <span data-ttu-id="9d88f-117">Idealmente, estas entradas se especifican mediante el uso de *parámetros*.</span><span class="sxs-lookup"><span data-stu-id="9d88f-117">Ideally, such inputs are specified through the use of *parameters*.</span></span> <span data-ttu-id="9d88f-118">Con Microsoft SQL Server, los parámetros se denotan con `@parameterName`, como en:</span><span class="sxs-lookup"><span data-stu-id="9d88f-118">With Microsoft SQL Server, parameters are denoted using `@parameterName`, as in:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample2.sql)]

<span data-ttu-id="9d88f-119">SqlDataSource admite consultas con parámetros, tanto para `SELECT` instrucciones y `INSERT`, `UPDATE`, y `DELETE` instrucciones.</span><span class="sxs-lookup"><span data-stu-id="9d88f-119">The SqlDataSource supports parameterized queries, both for `SELECT` statements and `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="9d88f-120">Además, los valores de parámetro pueden automáticamente extraerse de una variedad de orígenes de la cadena de consulta, el estado de sesión, controles de la página y así sucesivamente o se pueden asignar mediante programación.</span><span class="sxs-lookup"><span data-stu-id="9d88f-120">Moreover, the parameter values can be automatically pulled from a variety of sources the querystring, session state, controls on the page, and so on or can be assigned programmatically.</span></span> <span data-ttu-id="9d88f-121">En este tutorial, veremos cómo definir las consultas con parámetros, así como la forma para especificar el parámetro de valores mediante declaración y mediante programación.</span><span class="sxs-lookup"><span data-stu-id="9d88f-121">In this tutorial, we'll see how to define parameterized queries as well as how to specify the parameter values both declaratively and programmatically.</span></span>

> [!NOTE]
> <span data-ttu-id="9d88f-122">En el tutorial anterior, en comparación con el origen ObjectDataSource que ha sido nuestra herramienta que prefiera a través de los primeros 46 tutoriales con SqlDataSource, teniendo en cuenta sus similitudes conceptuales.</span><span class="sxs-lookup"><span data-stu-id="9d88f-122">In the previous tutorial we compared the ObjectDataSource which has been our tool of choice over the first 46 tutorials with the SqlDataSource, noting their conceptual similarities.</span></span> <span data-ttu-id="9d88f-123">Estas similitudes también se extienden a los parámetros.</span><span class="sxs-lookup"><span data-stu-id="9d88f-123">These similarities also extend to parameters.</span></span> <span data-ttu-id="9d88f-124">Parámetros ObjectDataSource s asignados a los parámetros de entrada para los métodos en la capa de lógica empresarial.</span><span class="sxs-lookup"><span data-stu-id="9d88f-124">The ObjectDataSource s parameters mapped to the input parameters for the methods in the Business Logic Layer.</span></span> <span data-ttu-id="9d88f-125">Con SqlDataSource, los parámetros se definen directamente dentro de la consulta SQL.</span><span class="sxs-lookup"><span data-stu-id="9d88f-125">With the SqlDataSource, the parameters are defined directly within the SQL query.</span></span> <span data-ttu-id="9d88f-126">Ambos controles tienen las colecciones de parámetros para su `Select()`, `Insert()`, `Update()`, y `Delete()` métodos y ambos pueden tener estos valores de parámetro que se rellena a partir de orígenes predefinidos (valores de cadena de consulta, las variables de sesión etc. ) o asignado mediante programación.</span><span class="sxs-lookup"><span data-stu-id="9d88f-126">Both controls have collections of parameters for their `Select()`, `Insert()`, `Update()`, and `Delete()` methods, and both can have these parameter values populated from pre-defined sources (querystring values, session variables, and so on) or assigned programmatically.</span></span>

## <a name="creating-a-parameterized-query"></a><span data-ttu-id="9d88f-127">Crear una consulta parametrizada</span><span class="sxs-lookup"><span data-stu-id="9d88f-127">Creating a Parameterized Query</span></span>

<span data-ttu-id="9d88f-128">El Asistente para configurar origen de datos de SqlDataSource control s ofrece tres vías para definir el comando se ejecute para recuperar registros de base de datos:</span><span class="sxs-lookup"><span data-stu-id="9d88f-128">The SqlDataSource control s Configure Data Source wizard offers three avenues for defining the command to execute to retrieve database records:</span></span>

- <span data-ttu-id="9d88f-129">Al seleccionar las columnas de una tabla o vista existente,</span><span class="sxs-lookup"><span data-stu-id="9d88f-129">By picking the columns from an existing table or view,</span></span>
- <span data-ttu-id="9d88f-130">Escriba una instrucción SQL personalizada, o</span><span class="sxs-lookup"><span data-stu-id="9d88f-130">By entering a custom SQL statement, or</span></span>
- <span data-ttu-id="9d88f-131">Si elige un procedimiento almacenado</span><span class="sxs-lookup"><span data-stu-id="9d88f-131">By choosing a stored procedure</span></span>

<span data-ttu-id="9d88f-132">Al seleccionar las columnas de una tabla existente o vista, los parámetros para el `WHERE` cláusula debe especificarse mediante el complemento `WHERE` cuadro de diálogo de cláusula.</span><span class="sxs-lookup"><span data-stu-id="9d88f-132">When picking columns from an existing table or view, the parameters for the `WHERE` clause must be specified through the Add `WHERE` Clause dialog box.</span></span> <span data-ttu-id="9d88f-133">Al crear una instrucción SQL personalizada, sin embargo, puede especificar los parámetros directamente en el `WHERE` cláusula (mediante `@parameterName` para denotar cada parámetro).</span><span class="sxs-lookup"><span data-stu-id="9d88f-133">When creating a custom SQL statement, however, you can enter the parameters directly into the `WHERE` clause (using `@parameterName` to denote each parameter).</span></span> <span data-ttu-id="9d88f-134">Un [procedimiento almacenado](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consta de una o varias instrucciones SQL, y se pueden parametrizar estas instrucciones.</span><span class="sxs-lookup"><span data-stu-id="9d88f-134">A [stored procedure](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consists of one or more SQL statements, and these statements can be parameterized.</span></span> <span data-ttu-id="9d88f-135">Los parámetros utilizados en las instrucciones SQL, sin embargo, deben pasarse como parámetros de entrada al procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-135">The parameters used in the SQL statements, however, must be passed in as input parameters to the stored procedure.</span></span>

<span data-ttu-id="9d88f-136">Puesto que la creación de una consulta parametrizada depende de cómo la s SqlDataSource `SelectCommand` es s especificado, deje que eche un vistazo a las tres enfoques.</span><span class="sxs-lookup"><span data-stu-id="9d88f-136">Since creating a parameterized query depends on how the SqlDataSource s `SelectCommand` is specified, let s take a look at all three approaches.</span></span> <span data-ttu-id="9d88f-137">Para empezar, abra el `ParameterizedQueries.aspx` página en el `SqlDataSource` carpeta, arrastre un control SqlDataSource desde el cuadro de herramientas hasta el diseñador y establezca su `ID` a `Products25BucksAndUnderDataSource`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-137">To get started, open the `ParameterizedQueries.aspx` page in the `SqlDataSource` folder, drag a SqlDataSource control from the Toolbox onto the Designer, and set its `ID` to `Products25BucksAndUnderDataSource`.</span></span> <span data-ttu-id="9d88f-138">A continuación, haga clic en el vínculo Configurar origen de datos de la etiqueta inteligente del control s.</span><span class="sxs-lookup"><span data-stu-id="9d88f-138">Next, click the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="9d88f-139">Seleccione la base de datos (`NORTHWINDConnectionString`) y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="9d88f-139">Select the database to use (`NORTHWINDConnectionString`) and click Next.</span></span>

## <a name="step-1-adding-awhereclause-when-picking-the-columns-from-a-table-or-view"></a><span data-ttu-id="9d88f-140">Paso 1: Agregar un`WHERE`cláusula al seleccionar las columnas de una tabla o vista</span><span class="sxs-lookup"><span data-stu-id="9d88f-140">Step 1: Adding a`WHERE`Clause When Picking the Columns from a Table or View</span></span>

<span data-ttu-id="9d88f-141">Al seleccionar los datos que se devuelven desde la base de datos con el control SqlDataSource, el Asistente para configurar orígenes de datos nos permite elegir las columnas que se devuelven de una tabla existente o ver (consulte la figura 1).</span><span class="sxs-lookup"><span data-stu-id="9d88f-141">When selecting the data to return from the database with the SqlDataSource control, the Configure Data Source wizard allows us to simply pick the columns to return from an existing table or view (see Figure 1).</span></span> <span data-ttu-id="9d88f-142">Al hacerlo, automáticamente se crea una instancia de SQL `SELECT` instrucción, que es lo que se envía a la base de datos cuando la s SqlDataSource `Select()` se invoca el método.</span><span class="sxs-lookup"><span data-stu-id="9d88f-142">Doing so automatically builds up a SQL `SELECT` statement, which is what is sent to the database when the SqlDataSource s `Select()` method is invoked.</span></span> <span data-ttu-id="9d88f-143">Como hicimos en el tutorial anterior, seleccione la tabla Products de la lista desplegable y compruebe el `ProductID`, `ProductName`, y `UnitPrice` columnas.</span><span class="sxs-lookup"><span data-stu-id="9d88f-143">As we did in the previous tutorial, select the Products table from the drop-down list and check the `ProductID`, `ProductName`, and `UnitPrice` columns.</span></span>

<span data-ttu-id="9d88f-144">[![Seleccionar las columnas que se va a devolver desde una tabla o vista](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-144">[![Pick the Columns to Return from a Table or View](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.png)</span></span>

<span data-ttu-id="9d88f-145">**Figura 1**: Elegir las columnas para volver de una tabla o vista ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-145">**Figure 1**: Pick the Columns to Return from a Table or View ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.png))</span></span>

<span data-ttu-id="9d88f-146">Para incluir un `WHERE` cláusula en la `SELECT` instrucción, haga clic en el `WHERE` botón, que abre el complemento `WHERE` cuadro de diálogo de cláusula (consulte la figura 2).</span><span class="sxs-lookup"><span data-stu-id="9d88f-146">To include a `WHERE` clause in the `SELECT` statement, click the `WHERE` button, which brings up the Add `WHERE` Clause dialog box (see Figure 2).</span></span> <span data-ttu-id="9d88f-147">Para agregar un parámetro para limitar los resultados devueltos por la `SELECT` de consulta, primero elija la columna para filtrar los datos por.</span><span class="sxs-lookup"><span data-stu-id="9d88f-147">To add a parameter to limit the results returned by the `SELECT` query, first choose the column to filter the data by.</span></span> <span data-ttu-id="9d88f-148">A continuación, elija el operador que se usará para el filtrado (=, &lt;, &lt;=, &gt;, y así sucesivamente).</span><span class="sxs-lookup"><span data-stu-id="9d88f-148">Next, choose the operator to use for filtering (=, &lt;, &lt;=, &gt;, and so on).</span></span> <span data-ttu-id="9d88f-149">Por último, elija el origen del valor de parámetro s, como desde el estado de sesión o de cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="9d88f-149">Finally, choose the source of the parameter s value, such as from the querystring or session state.</span></span> <span data-ttu-id="9d88f-150">Después de configurar el parámetro, haga clic en el botón Agregar para incluirlo en el `SELECT` consulta.</span><span class="sxs-lookup"><span data-stu-id="9d88f-150">After configuring the parameter, click the Add button to include it in the `SELECT` query.</span></span>

<span data-ttu-id="9d88f-151">En este ejemplo, s permiten devolver sólo esos resultados donde el `UnitPrice` valor es menor o igual que 25,00 $.</span><span class="sxs-lookup"><span data-stu-id="9d88f-151">For this example, let s only return those results where the `UnitPrice` value is less than or equal to $25.00.</span></span> <span data-ttu-id="9d88f-152">Por lo tanto, elegir `UnitPrice` desde la lista desplegable de columnas y &lt;= desde la lista desplegable operador.</span><span class="sxs-lookup"><span data-stu-id="9d88f-152">Therefore, pick `UnitPrice` from the Column drop-down list and &lt;= from the Operator drop-down list.</span></span> <span data-ttu-id="9d88f-153">Cuando se usa un valor de parámetro codificado de forma rígida (por ejemplo, $25,00) o si el valor del parámetro es necesario especificar mediante programación, seleccione Ninguno en la lista desplegable de origen.</span><span class="sxs-lookup"><span data-stu-id="9d88f-153">When using a hard-coded parameter value (such as $25.00) or if the parameter value is to be specified programmatically, select None from the Source drop-down list.</span></span> <span data-ttu-id="9d88f-154">A continuación, escriba el valor del parámetro codificado de forma rígida en el cuadro de texto valor 25,00 y completar el proceso, haga clic en el botón Agregar.</span><span class="sxs-lookup"><span data-stu-id="9d88f-154">Next, enter the hard-coded parameter value in the Value textbox 25.00 and complete the process by clicking the Add button.</span></span>

<span data-ttu-id="9d88f-155">[![Limitar los resultados devueltos desde el agregar WHERE cláusula cuadro de diálogo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-155">[![Limit the Results Returned from the Add WHERE Clause Dialog Box](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.png)</span></span>

<span data-ttu-id="9d88f-156">**Figura 2**: Limitar los resultados se devuelven desde el complemento `WHERE` cuadro de diálogo de cláusula ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-156">**Figure 2**: Limit the Results Returned from the Add `WHERE` Clause Dialog Box ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.png))</span></span>

<span data-ttu-id="9d88f-157">Después de agregar el parámetro, haga clic en Aceptar para volver al Asistente para configurar origen de datos.</span><span class="sxs-lookup"><span data-stu-id="9d88f-157">After adding the parameter, click OK to return to the Configure Data Source wizard.</span></span> <span data-ttu-id="9d88f-158">El `SELECT` instrucción en la parte inferior del asistente debe incluir ahora un `WHERE` cláusula con un parámetro denominado `@UnitPrice`:</span><span class="sxs-lookup"><span data-stu-id="9d88f-158">The `SELECT` statement at the bottom of the wizard should now include a `WHERE` clause with a parameter named `@UnitPrice`:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample3.sql)]

> [!NOTE]
> <span data-ttu-id="9d88f-159">Si se especifican varias condiciones en la `WHERE` cláusula desde el complemento `WHERE` cuadro de diálogo de cláusula, el asistente las combina con la `AND` operador.</span><span class="sxs-lookup"><span data-stu-id="9d88f-159">If you specify multiple conditions in the `WHERE` clause from the Add `WHERE` Clause dialog box, the wizard joins them with the `AND` operator.</span></span> <span data-ttu-id="9d88f-160">Si necesita incluir una `OR` en el `WHERE` cláusula (como `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`), a continuación, tendrá que crear el `SELECT` instrucción a través de la pantalla de instrucción SQL personalizada.</span><span class="sxs-lookup"><span data-stu-id="9d88f-160">If you need to include an `OR` in the `WHERE` clause (such as `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) then you have to build the `SELECT` statement through the custom SQL statement screen.</span></span>

<span data-ttu-id="9d88f-161">Completar la configuración SqlDataSource (haga clic en siguiente, a continuación, finalizar) y, a continuación, inspeccione el marcado declarativo de SqlDataSource s.</span><span class="sxs-lookup"><span data-stu-id="9d88f-161">Complete configuring the SqlDataSource (click Next, then Finish) and then inspect the SqlDataSource s declarative markup.</span></span> <span data-ttu-id="9d88f-162">El marcado incluye ahora un `<SelectParameters>` colección, que se detalla los orígenes de los parámetros en el `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-162">The markup now includes a `<SelectParameters>` collection, which spells out the sources for the parameters in the `SelectCommand`.</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample4.aspx)]

<span data-ttu-id="9d88f-163">Cuando la s SqlDataSource `Select()` se invoca al método, el `UnitPrice` (25,00) el valor del parámetro se aplica a la `@UnitPrice` parámetro en el `SelectCommand` antes de que se envían a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="9d88f-163">When the SqlDataSource s `Select()` method is invoked, the `UnitPrice` parameter value (25.00) is applied to the `@UnitPrice` parameter in the `SelectCommand` before being sent to the database.</span></span> <span data-ttu-id="9d88f-164">El resultado neto es que solo esos productos menor o igual que $25,00 se devuelven desde el `Products` tabla.</span><span class="sxs-lookup"><span data-stu-id="9d88f-164">The net result is that only those products less than or equal to $25.00 are returned from the `Products` table.</span></span> <span data-ttu-id="9d88f-165">Para confirmar esto, agregue un control GridView a la página, enlazarlo a este origen de datos y, a continuación, ver la página mediante un explorador.</span><span class="sxs-lookup"><span data-stu-id="9d88f-165">To confirm this, add a GridView to the page, bind it to this data source, and then view the page through a browser.</span></span> <span data-ttu-id="9d88f-166">Solo debería ver los productos enumerados con menor o igual que $25,00, tal como confirma la figura 3.</span><span class="sxs-lookup"><span data-stu-id="9d88f-166">You should only see those products listed that are less than or equal to $25.00, as Figure 3 confirms.</span></span>

<span data-ttu-id="9d88f-167">[![Se muestran solo los productos es menor o igual que 25,00 $](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-167">[![Only Those Products Less Than or Equal to $25.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.png)</span></span>

<span data-ttu-id="9d88f-168">**Figura 3**: Se muestran solo los productos es menor o igual a $25,00 ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-168">**Figure 3**: Only Those Products Less Than or Equal to $25.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.png))</span></span>

## <a name="step-2-adding-parameters-to-a-custom-sql-statement"></a><span data-ttu-id="9d88f-169">Paso 2: Agregar parámetros a una instrucción SQL personalizada</span><span class="sxs-lookup"><span data-stu-id="9d88f-169">Step 2: Adding Parameters to a Custom SQL Statement</span></span>

<span data-ttu-id="9d88f-170">Al agregar una instrucción SQL personalizada puede escribir el `WHERE` cláusula explícitamente o especifique un valor en la celda de filtro del generador de consultas.</span><span class="sxs-lookup"><span data-stu-id="9d88f-170">When adding a custom SQL statement you can enter the `WHERE` clause explicitly or specify a value in the Filter cell of the Query Builder.</span></span> <span data-ttu-id="9d88f-171">Para demostrarlo, permiten s Mostrar solo esos productos en un control GridView cuyos precios son inferiores a un umbral determinado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-171">To demonstrate this, let s display just those products in a GridView whose prices are less than a certain threshold.</span></span> <span data-ttu-id="9d88f-172">Empiece agregando un cuadro de texto para el `ParameterizedQueries.aspx` página para obtener este valor de umbral del usuario.</span><span class="sxs-lookup"><span data-stu-id="9d88f-172">Start by adding a TextBox to the `ParameterizedQueries.aspx` page to collect this threshold value from the user.</span></span> <span data-ttu-id="9d88f-173">Establezca el cuadro de texto s `ID` propiedad `MaxPrice`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-173">Set the TextBox s `ID` property to `MaxPrice`.</span></span> <span data-ttu-id="9d88f-174">Agregue un control Web de botón y establezca su `Text` propiedad para mostrar productos de coincidencia.</span><span class="sxs-lookup"><span data-stu-id="9d88f-174">Add a Button Web control and set its `Text` property to Display Matching Products .</span></span>

<span data-ttu-id="9d88f-175">A continuación, arrastre un control GridView a la página y en la etiqueta inteligente de optar por crear un nuevo SqlDataSource denominado `ProductsFilteredByPriceDataSource`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-175">Next, drag a GridView onto the page and from its smart tag choose to create a new SqlDataSource named `ProductsFilteredByPriceDataSource`.</span></span> <span data-ttu-id="9d88f-176">Desde el Asistente para configurar origen de datos, continúe con la especificación de una instrucción SQL personalizada o una pantalla de procedimiento almacenado (consulte la figura 4) y escriba la siguiente consulta:</span><span class="sxs-lookup"><span data-stu-id="9d88f-176">From the Configure Data Source wizard, proceed to the Specify a custom SQL statement or stored procedure screen (see Figure 4) and enter the following query:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample5.sql)]

<span data-ttu-id="9d88f-177">Después de escribir la consulta (ya sea manualmente o mediante el generador de consultas), haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="9d88f-177">After entering the query (either manually or through the Query Builder), click Next.</span></span>

<span data-ttu-id="9d88f-178">[![Devolver solo los productos menor o igual que un valor de parámetro](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-178">[![Return Only Those Products Less Than or Equal to a Parameter Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.png)</span></span>

<span data-ttu-id="9d88f-179">**Figura 4**: Valor devuelto solo aquellos productos es menor o igual al valor de parámetro ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-179">**Figure 4**: Return Only Those Products Less Than or Equal to a Parameter Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.png))</span></span>

<span data-ttu-id="9d88f-180">Dado que la consulta incluye parámetros, la siguiente pantalla del asistente nos pide el origen de los valores de parámetros.</span><span class="sxs-lookup"><span data-stu-id="9d88f-180">Since the query includes parameters, the next screen in the wizard prompts us for the source of the parameters values.</span></span> <span data-ttu-id="9d88f-181">Elija el Control en la lista desplegable de origen de parámetro y `MaxPrice` (el control TextBox s `ID` valor) en la lista desplegable de ControlID.</span><span class="sxs-lookup"><span data-stu-id="9d88f-181">Choose Control from the Parameter source drop-down list and `MaxPrice` (the TextBox control s `ID` value) from the ControlID drop-down list.</span></span> <span data-ttu-id="9d88f-182">También puede especificar un valor predeterminado opcional para usar en el caso donde el usuario no ha escrito ningún texto en el `MaxPrice` cuadro de texto.</span><span class="sxs-lookup"><span data-stu-id="9d88f-182">You can also enter an optional default value to use in the case where the user has not entered any text into the `MaxPrice` TextBox.</span></span> <span data-ttu-id="9d88f-183">Por el momento, no escriba un valor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-183">For the time being, do not enter a default value.</span></span>

<span data-ttu-id="9d88f-184">[![La propiedad Text de MaxPrice TextBox s se usa como origen del parámetro](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-184">[![The MaxPrice TextBox s Text Property is Used as the Parameter Source](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.png)</span></span>

<span data-ttu-id="9d88f-185">**Figura 5**: El `MaxPrice` TextBox s `Text` propiedad se utiliza como origen del parámetro ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-185">**Figure 5**: The `MaxPrice` TextBox s `Text` Property is Used as the Parameter Source ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.png))</span></span>

<span data-ttu-id="9d88f-186">Complete el Asistente para configurar orígenes de datos haciendo clic a continuación, a continuación, finalice.</span><span class="sxs-lookup"><span data-stu-id="9d88f-186">Complete the Configure Data Source wizard by clicking Next, then Finish.</span></span> <span data-ttu-id="9d88f-187">El marcado declarativo para el control GridView, cuadro de texto, botón y SqlDataSource sigue:</span><span class="sxs-lookup"><span data-stu-id="9d88f-187">The declarative markup for the GridView, TextBox, Button, and SqlDataSource follows:</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample6.aspx)]

<span data-ttu-id="9d88f-188">Tenga en cuenta que el parámetro dentro de las operaciones de asignación SqlDataSource `<SelectParameters>` sección es un `ControlParameter`, que incluye propiedades adicionales, como `ControlID` y `PropertyName`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-188">Note that the parameter within the SqlDataSource s `<SelectParameters>` section is a `ControlParameter`, which includes additional properties like `ControlID` and `PropertyName`.</span></span> <span data-ttu-id="9d88f-189">Cuando la s SqlDataSource `Select()` se invoca al método, el `ControlParameter` toma el valor de la propiedad de control Web especificada y lo asigna al parámetro correspondiente en el `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-189">When the SqlDataSource s `Select()` method is invoked, the `ControlParameter` grabs the value from the specified Web control property and assigns it to the corresponding parameter in the `SelectCommand`.</span></span> <span data-ttu-id="9d88f-190">En este ejemplo, el `MaxPrice` s la propiedad de texto se utiliza como el `@MaxPrice` el valor del parámetro.</span><span class="sxs-lookup"><span data-stu-id="9d88f-190">In this example, the `MaxPrice` s Text property is used as the `@MaxPrice` parameter value.</span></span>

<span data-ttu-id="9d88f-191">Tómese un minuto para ver esta página a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="9d88f-191">Take a minute to view this page through a browser.</span></span> <span data-ttu-id="9d88f-192">Cuando se visita primero la página o cada vez que el `MaxPrice` TextBox no tiene un valor que no hay registros se muestran en el control GridView.</span><span class="sxs-lookup"><span data-stu-id="9d88f-192">When first visiting the page or whenever the `MaxPrice` TextBox lacks a value no records are displayed in the GridView.</span></span>

<span data-ttu-id="9d88f-193">[![No hay registros son que muestra cuando el MaxPrice cuadro de texto está vacío](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-193">[![No Records are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.png)</span></span>

<span data-ttu-id="9d88f-194">**Figura 6**: Registros no son muestra cuando el `MaxPrice` cuadro de texto está vacío ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-194">**Figure 6**: No Records are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.png))</span></span>

<span data-ttu-id="9d88f-195">El motivo no hay productos se muestran es porque, de forma predeterminada, una cadena vacía para un valor de parámetro se convierte en una base de datos `NULL` valor.</span><span class="sxs-lookup"><span data-stu-id="9d88f-195">The reason no products are shown is because, by default, an empty string for a parameter value is converted into a database `NULL` value.</span></span> <span data-ttu-id="9d88f-196">Desde la comparación de `[UnitPrice] <= NULL` siempre se evalúa como False, se devuelve ningún resultado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-196">Since the comparison of `[UnitPrice] <= NULL` always evaluates as False, no results are returned.</span></span>

<span data-ttu-id="9d88f-197">Escriba un valor en el cuadro de texto, como 5,00 y haga clic en el botón Mostrar productos de coincidencia.</span><span class="sxs-lookup"><span data-stu-id="9d88f-197">Enter a value into the textbox, like 5.00, and click the Display Matching Products button.</span></span> <span data-ttu-id="9d88f-198">En el postback, SqlDataSource informa a que la GridView que uno de sus orígenes de parámetro ha cambiado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-198">On postback, the SqlDataSource informs the GridView that one of its parameter sources has changed.</span></span> <span data-ttu-id="9d88f-199">Por lo tanto, el control GridView vuelve a enlazar de SqlDataSource, mostrar esos productos menor o igual a 5,00 USD.</span><span class="sxs-lookup"><span data-stu-id="9d88f-199">Consequently, the GridView rebinds to the SqlDataSource, displaying those products less than or equal to $5.00.</span></span>

<span data-ttu-id="9d88f-200">[![Se muestran los productos es menor o igual a $5.00](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-200">[![Products Less Than or Equal to $5.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.png)</span></span>

<span data-ttu-id="9d88f-201">**Figura 7**: Se muestran los productos es menor o igual a 5,00 USD ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-201">**Figure 7**: Products Less Than or Equal to $5.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.png))</span></span>

## <a name="initially-displaying-all-products"></a><span data-ttu-id="9d88f-202">Mostrar inicialmente todos los productos</span><span class="sxs-lookup"><span data-stu-id="9d88f-202">Initially Displaying All Products</span></span>

<span data-ttu-id="9d88f-203">En lugar de no mostrar ningún producto cuando se carga la página por primera vez, quizás deseamos mostrar *todas* productos.</span><span class="sxs-lookup"><span data-stu-id="9d88f-203">Rather than displaying no products when the page is first loaded, we may want to display *all* products.</span></span> <span data-ttu-id="9d88f-204">Una forma de lista de todos los productos cada vez que la `MaxPrice` cuadro de texto está vacía consiste en establecer el valor predeterminado del parámetro en algún valor increíblemente alto, como 1000000, debido a que s improbable que Northwind Traders nunca habrá inventario cuyo precio supera a 1.000.000 dólares.</span><span class="sxs-lookup"><span data-stu-id="9d88f-204">One way to list all products whenever the `MaxPrice` TextBox is empty is to set the parameter s default value to some insanely high value, like 1000000, since it s unlikely that Northwind Traders will ever have inventory whose unit price exceeds $1,000,000.</span></span> <span data-ttu-id="9d88f-205">Sin embargo, este enfoque es limitada y podría no funcionar en otras situaciones.</span><span class="sxs-lookup"><span data-stu-id="9d88f-205">However, this approach is shortsighted and might not work in other situations.</span></span>

<span data-ttu-id="9d88f-206">En los tutoriales anteriores - [parámetros declarativos](../basic-reporting/declarative-parameters-cs.md) y [filtrado de maestro y detalles con un DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) que nos enfrentamos con un problema similar.</span><span class="sxs-lookup"><span data-stu-id="9d88f-206">In previous tutorials - [Declarative Parameters](../basic-reporting/declarative-parameters-cs.md) and [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) we were faced with a similar problem.</span></span> <span data-ttu-id="9d88f-207">Nuestra solución allí fue poner esta lógica en la capa de lógica empresarial.</span><span class="sxs-lookup"><span data-stu-id="9d88f-207">Our solution there was to put this logic in the Business Logic Layer.</span></span> <span data-ttu-id="9d88f-208">En concreto, la capa BLL examina el valor entrante y, si fuese `NULL` o algunas valor reservado, la llamada se enruta al método DAL que devuelve todos los registros.</span><span class="sxs-lookup"><span data-stu-id="9d88f-208">Specifically, the BLL examined the incoming value and, if it was `NULL` or some reserved value, the call was routed to the DAL method that returned all records.</span></span> <span data-ttu-id="9d88f-209">Si el valor entrante era un valor de filtrado normal, se realizó una llamada al método DAL que ejecuta una instrucción SQL que utiliza un parametrizada `WHERE` cláusula con el valor proporcionado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-209">If the incoming value was a normal filtering value, a call was made to the DAL method that executed a SQL statement that used a parameterized `WHERE` clause with the supplied value.</span></span>

<span data-ttu-id="9d88f-210">Lamentablemente, se omiten la arquitectura al usar SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="9d88f-210">Unfortunately, we bypass the architecture when using the SqlDataSource.</span></span> <span data-ttu-id="9d88f-211">En su lugar, se debe personalizar la instrucción SQL para captar información inteligente todos los registros si la `@MaximumPrice` parámetro es `NULL` o algún valor reservado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-211">Instead, we need to customize the SQL statement to intelligently grab all records if the `@MaximumPrice` parameter is `NULL` or some reserved value.</span></span> <span data-ttu-id="9d88f-212">Para este ejercicio, s permiten tener, por lo que ese if el `@MaximumPrice` es igual al parámetro `-1.0`, a continuación, *todas* de los registros que se van a devolverse (`-1.0` funciona como un valor reservado, ya que ningún producto puede tener un valor negativo `UnitPrice`valor).</span><span class="sxs-lookup"><span data-stu-id="9d88f-212">For this exercise, let s have it so that if the `@MaximumPrice` parameter is equal to `-1.0`, then *all* of the records are to be returned (`-1.0` works as a reserved value since no product can have a negative `UnitPrice` value).</span></span> <span data-ttu-id="9d88f-213">Podemos usar la siguiente instrucción SQL para lograr esto:</span><span class="sxs-lookup"><span data-stu-id="9d88f-213">To accomplish this we can use the following SQL statement:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample7.sql)]

<span data-ttu-id="9d88f-214">Esto `WHERE` cláusula devuelve *todas* registra si el `@MaximumPrice` parámetro es igual a `-1.0`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-214">This `WHERE` clause returns *all* records if the `@MaximumPrice` parameter equals `-1.0`.</span></span> <span data-ttu-id="9d88f-215">Si el valor del parámetro no es `-1.0`, solo los productos cuyo `UnitPrice` es menor o igual que el `@MaximumPrice` se devuelven el valor del parámetro.</span><span class="sxs-lookup"><span data-stu-id="9d88f-215">If the parameter value is not `-1.0`, only those products whose `UnitPrice` is less than or equal to the `@MaximumPrice` parameter value are returned.</span></span> <span data-ttu-id="9d88f-216">Estableciendo el valor predeterminado de la `@MaximumPrice` parámetro `-1.0`, en la primera carga de página (o cada vez que el `MaxPrice` cuadro de texto está vacía), `@MaximumPrice` tendrá un valor de `-1.0` y se mostrarán todos los productos.</span><span class="sxs-lookup"><span data-stu-id="9d88f-216">By setting the default value of the `@MaximumPrice` parameter to `-1.0`, on the first page load (or whenever the `MaxPrice` TextBox is empty), `@MaximumPrice` will have a value of `-1.0` and all products will be displayed.</span></span>

<span data-ttu-id="9d88f-217">[![Ahora todos los productos están muestra cuando el MaxPrice cuadro de texto está vacío](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-217">[![Now All Products are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.png)</span></span>

<span data-ttu-id="9d88f-218">**Figura 8**: Ahora todos los productos son muestra cuando el `MaxPrice` cuadro de texto está vacío ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-218">**Figure 8**: Now All Products are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image16.png))</span></span>

<span data-ttu-id="9d88f-219">Hay un par de advertencias a tener en cuenta con este enfoque.</span><span class="sxs-lookup"><span data-stu-id="9d88f-219">There are a couple of caveats to note with this approach.</span></span> <span data-ttu-id="9d88f-220">En primer lugar, tenga en cuenta que se infiere el tipo de datos de parámetro s uso s en la consulta SQL.</span><span class="sxs-lookup"><span data-stu-id="9d88f-220">First, realize that the parameter s data type is inferred by it s usage in the SQL query.</span></span> <span data-ttu-id="9d88f-221">Si cambia el `WHERE` cláusula desde `@MaximumPrice = -1.0` a `@MaximumPrice = -1`, el tiempo de ejecución trata el parámetro como un entero.</span><span class="sxs-lookup"><span data-stu-id="9d88f-221">If you change the `WHERE` clause from `@MaximumPrice = -1.0` to `@MaximumPrice = -1`, the runtime treats the parameter as an integer.</span></span> <span data-ttu-id="9d88f-222">Si intenta asignar el `MaxPrice` cuadro de texto en un valor decimal (por ejemplo, 5,00), se producirá un error porque no se puede convertir 5.00 en un entero.</span><span class="sxs-lookup"><span data-stu-id="9d88f-222">If you then attempt to assign the `MaxPrice` TextBox to a decimal value (like 5.00 ), an error will occur because it cannot convert 5.00 to an integer.</span></span> <span data-ttu-id="9d88f-223">Para solucionar este problema, asegúrese de usar `@MaximumPrice = -1.0` en el `WHERE` cláusula o, mejor aún, establezca el `ControlParameter` objeto s `Type` propiedad en Decimal.</span><span class="sxs-lookup"><span data-stu-id="9d88f-223">To remedy this, either make sure that you use `@MaximumPrice = -1.0` in the `WHERE` clause or, better yet, set the `ControlParameter` object s `Type` property to Decimal .</span></span>

<span data-ttu-id="9d88f-224">En segundo lugar, agregando el `OR @MaximumPrice = -1.0` a la `WHERE` cláusula, el motor de consultas no puede usar un índice en `UnitPrice` (suponiendo que exista uno), lo que resulta en un recorrido de tabla.</span><span class="sxs-lookup"><span data-stu-id="9d88f-224">Secondly, by adding the `OR @MaximumPrice = -1.0` to the `WHERE` clause, the query engine cannot use an index on `UnitPrice` (assuming one exists), thereby resulting in a table scan.</span></span> <span data-ttu-id="9d88f-225">Esto puede afectar al rendimiento si hay un número suficientemente elevado de registros en el `Products` tabla.</span><span class="sxs-lookup"><span data-stu-id="9d88f-225">This can impact performance if there are a sufficiently large number of records in the `Products` table.</span></span> <span data-ttu-id="9d88f-226">Un mejor enfoque sería llevar esta lógica a un procedimiento almacenado donde un `IF` instrucción podría realizar un `SELECT` consultar desde el `Products` tabla sin un `WHERE` cláusula cuando todos los registros deben devolverse o uno cuyo `WHERE` cláusula contiene sólo el `UnitPrice` criterios, por lo que se puede usar un índice.</span><span class="sxs-lookup"><span data-stu-id="9d88f-226">A better approach would be to move this logic to a stored procedure where an `IF` statement would either perform a `SELECT` query from the `Products` table without a `WHERE` clause when all records need to be returned or one whose `WHERE` clause contains just the `UnitPrice` criteria, so that an index can be used.</span></span>

## <a name="step-3-creating-and-using-parameterized-stored-procedures"></a><span data-ttu-id="9d88f-227">Paso 3: Crear y usar procedimientos almacenados parametrizados</span><span class="sxs-lookup"><span data-stu-id="9d88f-227">Step 3: Creating and Using Parameterized Stored Procedures</span></span>

<span data-ttu-id="9d88f-228">Procedimientos almacenados pueden incluir un conjunto de parámetros de entrada que, a continuación, se puede usar en las instrucciones SQL definidas en el procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-228">Stored procedures can include a set of input parameters that can then be used in the SQL statement(s) defined within the stored procedure.</span></span> <span data-ttu-id="9d88f-229">Al configurar SqlDataSource para utilizar un procedimiento almacenado que acepta parámetros de entrada, se pueden especificar estos valores de parámetro utilizando las mismas técnicas al igual que con instrucciones SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="9d88f-229">When configuring the SqlDataSource to use a stored procedure that accepts input parameters, these parameter values can be specified using the same techniques as with ad-hoc SQL statements.</span></span>

<span data-ttu-id="9d88f-230">Para ilustrar el uso de procedimientos almacenados en SqlDataSource, s permiten crear un nuevo procedimiento almacenado en la base de datos Northwind denominado `GetProductsByCategory`, que acepta un parámetro denominado `@CategoryID` y devuelve todas las columnas de los productos cuyo `CategoryID` coincide con la columna `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-230">To illustrate using stored procedures in the SqlDataSource, let s create a new stored procedure in the Northwind database named `GetProductsByCategory`, which accepts a parameter named `@CategoryID` and returns all of the columns of the products whose `CategoryID` column matches `@CategoryID`.</span></span> <span data-ttu-id="9d88f-231">Para crear un procedimiento almacenado, vaya al explorador de servidores y explorar en profundidad el `NORTHWND.MDF` base de datos.</span><span class="sxs-lookup"><span data-stu-id="9d88f-231">To create a stored procedure, go to the Server Explorer and drill down into the `NORTHWND.MDF` database.</span></span> <span data-ttu-id="9d88f-232">(Si don t ve el Explorador de servidores, activarla, vaya al menú Ver y seleccione la opción del explorador de servidores.)</span><span class="sxs-lookup"><span data-stu-id="9d88f-232">(If you don t see the Server Explorer, bring it up by going to the View menu and selecting the Server Explorer option.)</span></span>

<span data-ttu-id="9d88f-233">Desde el `NORTHWND.MDF` de base de datos, haga doble clic en la carpeta procedimientos almacenados, elija Agregar nuevo procedimiento almacenado y escriba la siguiente sintaxis:</span><span class="sxs-lookup"><span data-stu-id="9d88f-233">From the `NORTHWND.MDF` database, right-click on the Stored Procedures folder, choose Add New Stored Procedure, and enter the following syntax:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample8.sql)]

<span data-ttu-id="9d88f-234">Haga clic en el icono de guardar (o Ctrl + S) para guardar el procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-234">Click the Save icon (or Ctrl+S) to save the stored procedure.</span></span> <span data-ttu-id="9d88f-235">Puede probar el procedimiento almacenado con el botón secundario en la carpeta procedimientos almacenados y eligiendo ejecutar.</span><span class="sxs-lookup"><span data-stu-id="9d88f-235">You can test the stored procedure by right-clicking it from the Stored Procedures folder and choosing Execute.</span></span> <span data-ttu-id="9d88f-236">Esto le pedirá que los parámetros de procedimiento almacenado s (`@CategoryID`, en este caso), después de que los resultados se mostrarán en la ventana de salida.</span><span class="sxs-lookup"><span data-stu-id="9d88f-236">This will prompt you for the stored procedure s parameters (`@CategoryID`, in this instance), after which the results will be displayed in the Output window.</span></span>

<span data-ttu-id="9d88f-237">[![El GetProductsByCategory almacenados procedimiento cuando se ejecuta con un @CategoryID 1](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-237">[![The GetProductsByCategory Stored Procedure when Executed with a @CategoryID of 1](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image17.png)</span></span>

<span data-ttu-id="9d88f-238">**Figura 9**: El `GetProductsByCategory` procedimiento almacenado cuando se ejecuta con un `@CategoryID` 1 ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-238">**Figure 9**: The `GetProductsByCategory` Stored Procedure when Executed with a `@CategoryID` of 1 ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image18.png))</span></span>

<span data-ttu-id="9d88f-239">Permiten s usar este procedimiento almacenado para mostrar todos los productos de la categoría de bebidas en un control GridView.</span><span class="sxs-lookup"><span data-stu-id="9d88f-239">Let s use this stored procedure to display all products in the Beverages category in a GridView.</span></span> <span data-ttu-id="9d88f-240">Agregar un control GridView nuevo a la página y enlazarlo a un nuevo SqlDataSource denominado `BeverageProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-240">Add a new GridView to the page and bind it to a new SqlDataSource named `BeverageProductsDataSource`.</span></span> <span data-ttu-id="9d88f-241">Continuar para especificar una instrucción SQL personalizada o una pantalla de procedimiento almacenado, seleccione el botón de radio del procedimiento almacenado y elegir el `GetProductsByCategory` procedimiento almacenado desde la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="9d88f-241">Continue to the Specify a custom SQL statement or stored procedure screen, select the Stored procedure radio button, and pick the `GetProductsByCategory` stored procedure from the drop-down list.</span></span>

<span data-ttu-id="9d88f-242">[![Seleccione el GetProductsByCategory procedimiento almacenado desde la lista desplegable](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-242">[![Select the GetProductsByCategory Stored Procedure from the Drop-Down List](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image19.png)</span></span>

<span data-ttu-id="9d88f-243">**Figura 10**: Seleccione el `GetProductsByCategory` procedimiento almacenado en la lista desplegable ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-243">**Figure 10**: Select the `GetProductsByCategory` Stored Procedure from the Drop-Down List ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image20.png))</span></span>

<span data-ttu-id="9d88f-244">Dado que el procedimiento almacenado acepta un parámetro de entrada (`@CategoryID`), haga clic en siguiente nos pedirá que especifique el origen para este valor de parámetro s.</span><span class="sxs-lookup"><span data-stu-id="9d88f-244">Since the stored procedure accepts an input parameter (`@CategoryID`), clicking Next prompts us to specify the source for this parameter s value.</span></span> <span data-ttu-id="9d88f-245">Las bebidas `CategoryID` es 1, por lo que deje la lista desplegable de origen de parámetro en ninguno y escriba 1 en el cuadro de texto DefaultValue.</span><span class="sxs-lookup"><span data-stu-id="9d88f-245">The Beverages `CategoryID` is 1, so leave the Parameter source drop-down list at None and enter 1 into the DefaultValue textbox.</span></span>

<span data-ttu-id="9d88f-246">[![Use un valor codificado de forma rígida de 1 para devolver los productos de la categoría Bebidas](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-246">[![Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image21.png)</span></span>

<span data-ttu-id="9d88f-247">**Figura 11**: Use un valor Hard-Coded 1 para devolver los productos de la categoría bebidas ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-247">**Figure 11**: Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image22.png))</span></span>

<span data-ttu-id="9d88f-248">Como muestra el siguiente marcado declarativo, cuando se usa un procedimiento almacenado, la s SqlDataSource `SelectCommand` propiedad está establecida en el nombre del procedimiento almacenado y el [ `SelectCommandType` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) está establecido en `StoredProcedure`, lo que indica que el `SelectCommand` es el nombre de un procedimiento almacenado en lugar de una instrucción de SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="9d88f-248">As the following declarative markup shows, when using a stored procedure, the SqlDataSource s `SelectCommand` property is set to the name of the stored procedure and the [`SelectCommandType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) is set to `StoredProcedure`, indicating that the `SelectCommand` is the name of a stored procedure rather than an ad-hoc SQL statement.</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample9.aspx)]

<span data-ttu-id="9d88f-249">Pruebe la página en un explorador.</span><span class="sxs-lookup"><span data-stu-id="9d88f-249">Test out the page in a browser.</span></span> <span data-ttu-id="9d88f-250">Se muestran solo los productos que pertenecen a la categoría Bebidas, aunque *todas* del producto se muestran los campos desde la `GetProductsByCategory` procedimiento almacenado devuelve todas las columnas de la `Products` tabla.</span><span class="sxs-lookup"><span data-stu-id="9d88f-250">Only those products that belong to the Beverages category are displayed, although *all* of the product fields are displayed since the `GetProductsByCategory` stored procedure returns all of the columns from the `Products` table.</span></span> <span data-ttu-id="9d88f-251">Por supuesto, nos podemos limitar o personalizar los campos que aparecen en el control GridView en el cuadro de diálogo Editar columnas GridView.</span><span class="sxs-lookup"><span data-stu-id="9d88f-251">We could, of course, limit or customize the fields displayed in the GridView from the GridView s Edit Columns dialog box.</span></span>

<span data-ttu-id="9d88f-252">[![Se mostrarán todas las bebidas](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-252">[![All of the Beverages are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image23.png)</span></span>

<span data-ttu-id="9d88f-253">**Figura 12**: Se mostrarán todas las bebidas ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-253">**Figure 12**: All of the Beverages are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image24.png))</span></span>

## <a name="step-4-programmatically-invoking-a-sqldatasource-sselectstatement"></a><span data-ttu-id="9d88f-254">Paso 4: Invocar mediante programación un s SqlDataSource`Select()`instrucción</span><span class="sxs-lookup"><span data-stu-id="9d88f-254">Step 4: Programmatically Invoking a SqlDataSource s`Select()`Statement</span></span>

<span data-ttu-id="9d88f-255">Los ejemplos se ve hasta ahora se ven en el tutorial anterior y este tutorial enlazar los controles SqlDataSource directamente en un control GridView.</span><span class="sxs-lookup"><span data-stu-id="9d88f-255">The examples we ve seen in the previous tutorial and this tutorial so far have bound SqlDataSource controls directly to a GridView.</span></span> <span data-ttu-id="9d88f-256">Los datos del control s SqlDataSource, sin embargo, pueden obtener mediante programación acceso y enumerados en el código.</span><span class="sxs-lookup"><span data-stu-id="9d88f-256">The SqlDataSource control s data, however, can be programmatically accessed and enumerated in code.</span></span> <span data-ttu-id="9d88f-257">Esto puede ser especialmente útil cuando necesita para consultar los datos para inspeccionarlo, pero don t se necesitan para que se muestre.</span><span class="sxs-lookup"><span data-stu-id="9d88f-257">This can be particularly useful when you need to query data to inspect it, but don t need to display it.</span></span> <span data-ttu-id="9d88f-258">En lugar de tener que escribir todo el código de ADO.NET para conectarse a la base de datos, especifique el comando y recuperar los resultados de código reutilizable, puede dejar que SqlDataSource controlar este código más monótonas.</span><span class="sxs-lookup"><span data-stu-id="9d88f-258">Rather than having to write all of the boilerplate ADO.NET code to connect to the database, specify the command, and retrieve the results, you can let the SqlDataSource handle this monotonous code.</span></span>

<span data-ttu-id="9d88f-259">Para ilustrar cómo trabajar con las operaciones de asignación SqlDataSource datos mediante programación, imagine que su jefe ha abordado con una solicitud para crear una página web que muestra el nombre de una categoría seleccionada al azar y sus productos asociados.</span><span class="sxs-lookup"><span data-stu-id="9d88f-259">To illustrate working with the SqlDataSource s data programmatically, imagine that your boss has approached you with a request to create a web page that displays the name of a randomly selected category and its associated products.</span></span> <span data-ttu-id="9d88f-260">Es decir, cuando un usuario visita esta página, queremos elige aleatoriamente una categoría de la `Categories` de tabla, mostrar el nombre de categoría y, a continuación, enumerar los productos que pertenecen a esa categoría.</span><span class="sxs-lookup"><span data-stu-id="9d88f-260">That is, when a user visits this page, we want to randomly choose a category from the `Categories` table, display the category name, and then list the products belonging to that category.</span></span>

<span data-ttu-id="9d88f-261">Para lograr esto, necesitamos dos controles SqlDataSource uno para tomar una categoría aleatoria desde el `Categories` tabla y otra para obtener la categoría de productos de s.</span><span class="sxs-lookup"><span data-stu-id="9d88f-261">To accomplish this we need two SqlDataSource controls one to grab a random category from the `Categories` table and another to get the category s products.</span></span> <span data-ttu-id="9d88f-262">Vamos a crear SqlDataSource que recupera un registro de la categoría aleatorio en este paso; Paso 5 examina diseñar SqlDataSource que recupera los productos de s de categoría.</span><span class="sxs-lookup"><span data-stu-id="9d88f-262">We'll build the SqlDataSource that retrieves a random category record in this step; Step 5 looks at crafting the SqlDataSource that retrieves the category s products.</span></span>

<span data-ttu-id="9d88f-263">Empiece agregando un SqlDataSource a `ParameterizedQueries.aspx` y establezca su `ID` a `RandomCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-263">Start by adding a SqlDataSource to `ParameterizedQueries.aspx` and set its `ID` to `RandomCategoryDataSource`.</span></span> <span data-ttu-id="9d88f-264">Configúrelo para que utilice la siguiente consulta SQL:</span><span class="sxs-lookup"><span data-stu-id="9d88f-264">Configure it so that it uses the following SQL query:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample10.sql)]

<span data-ttu-id="9d88f-265">`ORDER BY NEWID()` Devuelve los registros ordenados en orden aleatorio (consulte [Using `NEWID()` para ordenar aleatoriamente los registros](http://www.sqlteam.com/item.asp?ItemID=8747)).</span><span class="sxs-lookup"><span data-stu-id="9d88f-265">`ORDER BY NEWID()` returns the records sorted in random order (see [Using `NEWID()` to Randomly Sort Records](http://www.sqlteam.com/item.asp?ItemID=8747)).</span></span> <span data-ttu-id="9d88f-266">`SELECT TOP 1` Devuelve el primer registro del conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="9d88f-266">`SELECT TOP 1` returns the first record from the result set.</span></span> <span data-ttu-id="9d88f-267">Resumiendo, esta consulta devuelve el `CategoryID` y `CategoryName` valores de columna de una categoría única y seleccionado aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="9d88f-267">Put together, this query returns the `CategoryID` and `CategoryName` column values from a single, randomly selected category.</span></span>

<span data-ttu-id="9d88f-268">Para mostrar la categoría s `CategoryName` valor, agregue un control Web de la etiqueta a la página, establezca su `ID` propiedad `CategoryNameLabel`y borrar su `Text` propiedad.</span><span class="sxs-lookup"><span data-stu-id="9d88f-268">To display the category s `CategoryName` value, add a Label Web control to the page, set its `ID` property to `CategoryNameLabel`, and clear out its `Text` property.</span></span> <span data-ttu-id="9d88f-269">Para recuperar los datos de un control SqlDataSource mediante programación, es necesario invocar su `Select()` método.</span><span class="sxs-lookup"><span data-stu-id="9d88f-269">To programmatically retrieve the data from a SqlDataSource control, we need to invoke its `Select()` method.</span></span> <span data-ttu-id="9d88f-270">El [ `Select()` método](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) espera un parámetro de entrada de tipo [ `DataSourceSelectArguments` ](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), que especifica cómo los datos deben ser mensajes antes de devolverlos.</span><span class="sxs-lookup"><span data-stu-id="9d88f-270">The [`Select()` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) expects a single input parameter of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), which specifies how the data should be messaged before being returned.</span></span> <span data-ttu-id="9d88f-271">Esto puede incluir instrucciones en Ordenar y filtrar los datos y se usa los datos de que controles Web al ordenar o paginar los datos desde un control SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="9d88f-271">This can include instructions on sorting and filtering the data, and is used by the data Web controls when sorting or paging through the data from a SqlDataSource control.</span></span> <span data-ttu-id="9d88f-272">En nuestro ejemplo, sin embargo, se don necesidad de t los datos se puede modificar antes de que se devuelve y, por tanto, se pasarán en la `DataSourceSelectArguments.Empty` objeto.</span><span class="sxs-lookup"><span data-stu-id="9d88f-272">For our example, though, we don t need the data to be modified before being returned, and therefore will pass in the `DataSourceSelectArguments.Empty` object.</span></span>

<span data-ttu-id="9d88f-273">El `Select()` método devuelve un objeto que implementa `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-273">The `Select()` method returns an object that implements `IEnumerable`.</span></span> <span data-ttu-id="9d88f-274">El tipo exacto devuelto depende del valor del control SqlDataSource s [ `DataSourceMode` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span><span class="sxs-lookup"><span data-stu-id="9d88f-274">The precise type returned depends on the value of the SqlDataSource control s [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span></span> <span data-ttu-id="9d88f-275">Como se describe en el tutorial anterior, se puede establecer esta propiedad en un valor de uno de ellos `DataSet` o `DataReader`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-275">As discussed in the previous tutorial, this property can be set to a value of either `DataSet` or `DataReader`.</span></span> <span data-ttu-id="9d88f-276">Si establece en `DataSet`, el `Select()` método devuelve un [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) objeto; si se establece en `DataReader`, devuelve un objeto que implementa [ `IDataReader` ](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span><span class="sxs-lookup"><span data-stu-id="9d88f-276">If set to `DataSet`, the `Select()` method returns a [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) object; if set to `DataReader`, it returns an object that implements [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span></span> <span data-ttu-id="9d88f-277">Puesto que la `RandomCategoryDataSource` SqlDataSource tiene su `DataSourceMode` propiedad establecida en `DataSet` (valor predeterminado), trabajaremos con un objeto DataView.</span><span class="sxs-lookup"><span data-stu-id="9d88f-277">Since the `RandomCategoryDataSource` SqlDataSource has its `DataSourceMode` property set to `DataSet` (the default), we will be working with a DataView object.</span></span>

<span data-ttu-id="9d88f-278">El código siguiente muestra cómo recuperar los registros desde el `RandomCategoryDataSource` SqlDataSource como un objeto DataView, así como cómo leer el `CategoryName` valor de la columna de la primera fila de DataView:</span><span class="sxs-lookup"><span data-stu-id="9d88f-278">The following code illustrates how to retrieve the records from the `RandomCategoryDataSource` SqlDataSource as a DataView as well as how to read the `CategoryName` column value from the first DataView row:</span></span>

[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample11.cs)]

<span data-ttu-id="9d88f-279">`randomCategoryView[0]` Devuelve el primer `DataRowView` en el objeto DataView.</span><span class="sxs-lookup"><span data-stu-id="9d88f-279">`randomCategoryView[0]` returns the first `DataRowView` in the DataView.</span></span> <span data-ttu-id="9d88f-280">`randomCategoryView[0]["CategoryName"]` Devuelve el valor de la `CategoryName` columna en esta primera fila.</span><span class="sxs-lookup"><span data-stu-id="9d88f-280">`randomCategoryView[0]["CategoryName"]` returns the value of the `CategoryName` column in this first row.</span></span> <span data-ttu-id="9d88f-281">Tenga en cuenta que el objeto DataView es fuertemente tipado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-281">Note that the DataView is loosely-typed.</span></span> <span data-ttu-id="9d88f-282">Para hacer referencia a un valor de columna en particular, necesitamos pasar el nombre de la columna como una cadena (en este caso, CategoryName).</span><span class="sxs-lookup"><span data-stu-id="9d88f-282">To reference a particular column value we need to pass in the name of the column as a string ( CategoryName, in this case).</span></span> <span data-ttu-id="9d88f-283">Figura 13 se muestra el mensaje que se muestra en el `CategoryNameLabel` al ver la página.</span><span class="sxs-lookup"><span data-stu-id="9d88f-283">Figure 13 shows the message displayed in the `CategoryNameLabel` when viewing the page.</span></span> <span data-ttu-id="9d88f-284">Por supuesto, se selecciona aleatoriamente el nombre de categoría real mostrado por el `RandomCategoryDataSource` SqlDataSource en cada visita a la página (incluidas las devoluciones de datos).</span><span class="sxs-lookup"><span data-stu-id="9d88f-284">Of course, the actual category name displayed is randomly selected by the `RandomCategoryDataSource` SqlDataSource on each visit to the page (including postbacks).</span></span>

<span data-ttu-id="9d88f-285">[![Se muestra el nombre de las operaciones de asignación seleccionado aleatoriamente de categoría](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-285">[![The Randomly Selected Category s Name is Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image25.png)</span></span>

<span data-ttu-id="9d88f-286">**Figura 13**: Las operaciones de asignación seleccionado aleatoriamente de categoría se muestra el nombre ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-286">**Figure 13**: The Randomly Selected Category s Name is Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image26.png))</span></span>

> [!NOTE]
> <span data-ttu-id="9d88f-287">Si SqlDataSource control s `DataSourceMode` propiedad se ha establecido en `DataReader`, el valor devuelto por la `Select()` método hubiera necesitado para convertirse en `IDataReader`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-287">If the SqlDataSource control s `DataSourceMode` property had been set to `DataReader`, the return value from the `Select()` method would have needed to be cast to `IDataReader`.</span></span> <span data-ttu-id="9d88f-288">Para leer el `CategoryName` valor de la columna de la primera fila, d, use código similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="9d88f-288">To read the `CategoryName` column value from the first row, we d use code like:</span></span>

[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample12.cs)]

<span data-ttu-id="9d88f-289">Con SqlDataSource aleatoriamente al seleccionar una categoría, que está listo para agregar el control GridView que muestra los productos de la categoría s.</span><span class="sxs-lookup"><span data-stu-id="9d88f-289">With the SqlDataSource randomly selecting a category, we re ready to add the GridView that lists the category s products.</span></span>

> [!NOTE]
> <span data-ttu-id="9d88f-290">En lugar de usar un control Web Label para mostrar el nombre de categoría s, podríamos haber agregamos un DetailsView o FormView a la página, enlazarlo de SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="9d88f-290">Rather than using a Label Web control to display the category s name, we could have added a FormView or DetailsView to the page, binding it to the SqlDataSource.</span></span> <span data-ttu-id="9d88f-291">Con la etiqueta, sin embargo, nos ha permitido explorar cómo invocar mediante programación la s SqlDataSource `Select()` instrucción y trabajar con sus datos en el código resultantes.</span><span class="sxs-lookup"><span data-stu-id="9d88f-291">Using the Label, however, allowed us to explore how to programmatically invoke the SqlDataSource s `Select()` statement and work with its resulting data in code.</span></span>

## <a name="step-5-assigning-parameter-values-programmatically"></a><span data-ttu-id="9d88f-292">Paso 5: Asignar valores de parámetro mediante programación</span><span class="sxs-lookup"><span data-stu-id="9d88f-292">Step 5: Assigning Parameter Values Programmatically</span></span>

<span data-ttu-id="9d88f-293">Todos los ejemplos se ha visto hasta ahora en este tutorial ha utilizado un valor de parámetro codificado de forma rígida o uno procedente de uno de los orígenes de parámetro predefinidos (un valor de cadena de consulta, un control Web en la página y así sucesivamente).</span><span class="sxs-lookup"><span data-stu-id="9d88f-293">All of the examples we ve seen so far in this tutorial have used either a hard-coded parameter value or one taken from one of the pre-defined parameter sources (a querystring value, a Web control on the page, and so on).</span></span> <span data-ttu-id="9d88f-294">Sin embargo, los parámetros de s control SqlDataSource también pueden establecerse mediante programación.</span><span class="sxs-lookup"><span data-stu-id="9d88f-294">However, the SqlDataSource control s parameters can also be set programmatically.</span></span> <span data-ttu-id="9d88f-295">Para completar nuestro ejemplo actual, necesitamos un SqlDataSource que devuelve todos los productos que pertenecen a una categoría especificada.</span><span class="sxs-lookup"><span data-stu-id="9d88f-295">To complete our current example, we need a SqlDataSource that returns all of the products belonging to a specified category.</span></span> <span data-ttu-id="9d88f-296">Tendrá este SqlDataSource un `CategoryID` parámetro cuyo valor debe establecerse en función de la `CategoryID` valor de la columna devuelta por la `RandomCategoryDataSource` SqlDataSource en el `Page_Load` controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="9d88f-296">This SqlDataSource will have a `CategoryID` parameter whose value needs to be set based on the `CategoryID` column value returned by the `RandomCategoryDataSource` SqlDataSource in the `Page_Load` event handler.</span></span>

<span data-ttu-id="9d88f-297">Empiece agregando un control GridView a la página y enlazarlo a un nuevo SqlDataSource denominado `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="9d88f-297">Start by adding a GridView to the page and bind it to a new SqlDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="9d88f-298">Mucho como hicimos en el paso 3, configurar SqlDataSource para que invoca el `GetProductsByCategory` procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="9d88f-298">Much like we did in Step 3, configure the SqlDataSource so that it invokes the `GetProductsByCategory` stored procedure.</span></span> <span data-ttu-id="9d88f-299">Deje el parámetro establecido de lista desplegable de origen en None, pero no se escriba un valor predeterminado, tal y como se establecerá este valor predeterminado mediante programación.</span><span class="sxs-lookup"><span data-stu-id="9d88f-299">Leave the Parameter source drop-down list set to None, but do not enter a default value, as we will set this default value programmatically.</span></span>

<span data-ttu-id="9d88f-300">[![No se especifica un origen de los parámetros o el valor predeterminado](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-300">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image27.png)</span></span>

<span data-ttu-id="9d88f-301">**Figura 14**: Lleve a cabo no especificar un origen del parámetro o el valor predeterminado ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-301">**Figure 14**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image28.png))</span></span>

<span data-ttu-id="9d88f-302">Después de completar al Asistente de SqlDataSource, el marcado declarativo resultante debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="9d88f-302">After completing the SqlDataSource wizard, the resulting declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample13.aspx)]

<span data-ttu-id="9d88f-303">Podemos asignamos el `DefaultValue` de la `CategoryID` parámetro mediante programación en el `Page_Load` controlador de eventos:</span><span class="sxs-lookup"><span data-stu-id="9d88f-303">We can assign the `DefaultValue` of the `CategoryID` parameter programmatically in the `Page_Load` event handler:</span></span>

[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample14.cs)]

<span data-ttu-id="9d88f-304">Con esta adición, la página incluye un control GridView que muestra los productos asociados con la categoría seleccionada al azar.</span><span class="sxs-lookup"><span data-stu-id="9d88f-304">With this addition, the page includes a GridView that shows the products associated with the randomly selected category.</span></span>

<span data-ttu-id="9d88f-305">[![No se especifica un origen de los parámetros o el valor predeterminado](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="9d88f-305">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image29.png)</span></span>

<span data-ttu-id="9d88f-306">**Figura 15**: Lleve a cabo no especificar un origen del parámetro o el valor predeterminado ([haga clic aquí para ver imagen en tamaño completo](using-parameterized-queries-with-the-sqldatasource-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="9d88f-306">**Figure 15**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image30.png))</span></span>

## <a name="summary"></a><span data-ttu-id="9d88f-307">Resumen</span><span class="sxs-lookup"><span data-stu-id="9d88f-307">Summary</span></span>

<span data-ttu-id="9d88f-308">SqlDataSource permite a los desarrolladores de páginas definir consultas con parámetros cuyos valores de parámetros pueden codificado de forma rígida, extraídos de orígenes de parámetros predefinidos o asignados mediante programación.</span><span class="sxs-lookup"><span data-stu-id="9d88f-308">The SqlDataSource enables page developers to define parameterized queries whose parameter values can be hard-coded, pulled from pre-defined parameter sources, or assigned programmatically.</span></span> <span data-ttu-id="9d88f-309">En este tutorial hemos visto cómo crear una consulta con parámetros desde el asistente Configurar origen de datos para consultas SQL ad hoc y procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="9d88f-309">In this tutorial we saw how to craft a parameterized query from the Configure Data Source wizard for both ad-hoc SQL queries and stored procedures.</span></span> <span data-ttu-id="9d88f-310">También hemos analizado utiliza orígenes de parámetro codificado de forma rígida, un control Web como un origen de los parámetros y se especifica mediante programación el valor del parámetro.</span><span class="sxs-lookup"><span data-stu-id="9d88f-310">We also looked at using hard-coded parameter sources, a Web control as a parameter source, and programmatically specifying the parameter value.</span></span>

<span data-ttu-id="9d88f-311">Al igual que con el origen ObjectDataSource, SqlDataSource también proporciona capacidades para modificar los datos subyacentes.</span><span class="sxs-lookup"><span data-stu-id="9d88f-311">Like with the ObjectDataSource, the SqlDataSource also provides capabilities to modify its underlying data.</span></span> <span data-ttu-id="9d88f-312">En el siguiente tutorial daremos un vistazo a cómo definir `INSERT`, `UPDATE`, y `DELETE` instrucciones con SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="9d88f-312">In the next tutorial we'll look at how to define `INSERT`, `UPDATE`, and `DELETE` statements with the SqlDataSource.</span></span> <span data-ttu-id="9d88f-313">Una vez que se han agregado estas instrucciones, podemos usamos integrado Insertar, modificar y eliminar funciones inherentes a los controles GridView, DetailsView y FormView.</span><span class="sxs-lookup"><span data-stu-id="9d88f-313">Once these statements have been added, we can utilize the built-in inserting, editing, and deleting features inherent to the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="9d88f-314">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="9d88f-314">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="9d88f-315">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="9d88f-315">About the Author</span></span>

<span data-ttu-id="9d88f-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros sobre ASP/ASP.NET y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), trabaja con tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="9d88f-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9d88f-317">Scott trabaja como consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="9d88f-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9d88f-318">Su último libro es [*SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="9d88f-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9d88f-319">Puede ponerse en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9d88f-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="9d88f-320">o a través de su blog, que puede encontrarse en [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="9d88f-320">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="9d88f-321">Agradecimientos especiales a</span><span class="sxs-lookup"><span data-stu-id="9d88f-321">Special Thanks To</span></span>

<span data-ttu-id="9d88f-322">Esta serie de tutoriales ha sido revisada por muchos revisores útiles.</span><span class="sxs-lookup"><span data-stu-id="9d88f-322">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9d88f-323">Los revisores para este tutorial fueron Scott Clyde, Randell Schmidt y Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="9d88f-323">Lead reviewers for this tutorial were Scott Clyde, Randell Schmidt, and Ken Pespisa.</span></span> <span data-ttu-id="9d88f-324">¿Está interesado en leer mi próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="9d88f-324">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9d88f-325">Si es así, envíeme una línea en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9d88f-325">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9d88f-326">[Anterior](querying-data-with-the-sqldatasource-control-cs.md)
> [Siguiente](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)</span><span class="sxs-lookup"><span data-stu-id="9d88f-326">[Previous](querying-data-with-the-sqldatasource-control-cs.md)
[Next](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)</span></span>
