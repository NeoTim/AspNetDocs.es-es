---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: 'Usar el Entity Framework 4,0 y el control ObjectDataSource, parte 1: Introducción | Microsoft Docs'
author: tdykstra
description: Esta serie de tutoriales se basa en la aplicación web contoso University que crea el Introducción con la serie de tutoriales Entity Framework. Si yo...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 2f14707eb058d438495dd2bc4c17b976c471fc97
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78440407"
---
# <a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="eb3a1-104">Usar el Entity Framework 4,0 y el control ObjectDataSource, parte 1: Introducción</span><span class="sxs-lookup"><span data-stu-id="eb3a1-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>

<span data-ttu-id="eb3a1-105">por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="eb3a1-106">Esta serie de tutoriales se basa en la aplicación web contoso University que crea el [Introducción con la](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) serie de tutoriales Entity Framework 4,0.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="eb3a1-107">Si no completó los tutoriales anteriores, como punto de partida para este tutorial, puede [descargar la aplicación](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) que habría creado.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="eb3a1-108">También puede [descargar la aplicación](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) que se crea en la serie completa de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="eb3a1-109">En la aplicación Web de ejemplo contoso University se muestra cómo crear aplicaciones de formularios Web Forms de ASP.NET mediante el Entity Framework 4,0 y Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="eb3a1-110">La aplicación de ejemplo es un sitio web de una Universidad ficticia de contoso.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="eb3a1-111">Incluye funciones como la admisión de estudiantes, la creación de cursos y asignaciones de instructores.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="eb3a1-112">En el tutorial se muestran C#ejemplos de.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="eb3a1-113">El [ejemplo descargable](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contiene código en C# y Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="eb3a1-114">Database First</span><span class="sxs-lookup"><span data-stu-id="eb3a1-114">Database First</span></span>
> 
> <span data-ttu-id="eb3a1-115">Hay tres maneras de trabajar con datos en el Entity Framework: *Database First*, *Model First*y *code First*.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="eb3a1-116">Este tutorial es para Database First.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-116">This tutorial is for Database First.</span></span> <span data-ttu-id="eb3a1-117">Para obtener información sobre las diferencias entre estos flujos de trabajo e instrucciones sobre cómo elegir el mejor para su escenario, consulte [Entity Framework flujos de trabajo de desarrollo](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="eb3a1-118">formularios Web Forms</span><span class="sxs-lookup"><span data-stu-id="eb3a1-118">Web Forms</span></span>
> 
> <span data-ttu-id="eb3a1-119">Al igual que la serie Introducción, en esta serie de tutoriales se usa el modelo de formularios Web Forms de ASP.NET y se supone que sabe cómo trabajar con formularios Web Forms de ASP.NET en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="eb3a1-120">Si no lo hace, vea [Introducción con formularios Web Forms de ASP.NET 4,5](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="eb3a1-121">Si prefiere trabajar con el marco de ASP.NET MVC, consulte [Introducción con el Entity Framework mediante ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="eb3a1-122">Versiones de software</span><span class="sxs-lookup"><span data-stu-id="eb3a1-122">Software versions</span></span>
> 
> | <span data-ttu-id="eb3a1-123">**Se muestra en el tutorial**</span><span class="sxs-lookup"><span data-stu-id="eb3a1-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="eb3a1-124">**También funciona con**</span><span class="sxs-lookup"><span data-stu-id="eb3a1-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="eb3a1-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="eb3a1-125">Windows 7</span></span> | <span data-ttu-id="eb3a1-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="eb3a1-126">Windows 8</span></span> |
> | <span data-ttu-id="eb3a1-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="eb3a1-127">Visual Studio 2010</span></span> | <span data-ttu-id="eb3a1-128">Visual Studio 2010 Express para Web.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="eb3a1-129">El tutorial no se ha probado con versiones posteriores de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="eb3a1-130">Hay muchas diferencias en las selecciones de menú, los cuadros de diálogo y las plantillas.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="eb3a1-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="eb3a1-131">.NET 4</span></span> | <span data-ttu-id="eb3a1-132">.NET 4,5 es compatible con versiones anteriores de .NET 4, pero el tutorial no se ha probado con .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="eb3a1-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="eb3a1-133">Entity Framework 4</span></span> | <span data-ttu-id="eb3a1-134">El tutorial no se ha probado con versiones posteriores de Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="eb3a1-135">A partir de Entity Framework 5, EF utiliza de forma predeterminada el `DbContext API` que se presentó con EF 4,1.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="eb3a1-136">El control EntityDataSource se diseñó para usar la API de `ObjectContext`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="eb3a1-137">Para obtener información sobre cómo usar el control EntityDataSource con la API de `DbContext`, consulte [esta entrada de blog](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="eb3a1-138">Preguntas</span><span class="sxs-lookup"><span data-stu-id="eb3a1-138">Questions</span></span>
> 
> <span data-ttu-id="eb3a1-139">Si tiene preguntas que no están directamente relacionadas con el tutorial, puede publicarlas en el foro de [Entity Framework de ASP.net](https://forums.asp.net/1227.aspx), en el [Foro de Entity Framework y LINQ to Entities](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), o en [stackoverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>

<span data-ttu-id="eb3a1-140">El control `EntityDataSource` permite crear una aplicación muy rápidamente, pero normalmente requiere que se mantenga una cantidad significativa de lógica de negocios y lógica de acceso a datos en las páginas *. aspx* .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="eb3a1-141">Si espera que la aplicación crezca en complejidad y requiera mantenimiento en curso, puede invertir más tiempo de desarrollo por adelantado para crear una estructura de aplicación de *n niveles* o en *capas* que sea más fácil de mantener.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="eb3a1-142">Para implementar esta arquitectura, separe la capa de presentación de la capa de lógica de negocios (BLL) y la capa de acceso a datos (DAL).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="eb3a1-143">Una manera de implementar esta estructura es usar el control `ObjectDataSource` en lugar del control `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="eb3a1-144">Cuando se usa el control `ObjectDataSource`, se implementa su propio código de acceso a datos y, a continuación, se invoca en páginas *. aspx* con un control que tiene muchas de las mismas características que otros controles de origen de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="eb3a1-145">Esto le permite combinar las ventajas de un enfoque de n niveles con las ventajas de usar un control de formularios Web Forms para el acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="eb3a1-146">El control `ObjectDataSource` ofrece más flexibilidad también en otras maneras.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="eb3a1-147">Dado que escribe su propio código de acceso a datos, es más fácil hacer algo más que simplemente leer, insertar, actualizar o eliminar un tipo de entidad concreto, que son las tareas que el control `EntityDataSource` está diseñado para realizar.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="eb3a1-148">Por ejemplo, puede realizar el registro cada vez que se actualiza una entidad, archivar datos cada vez que se elimina una entidad o comprobar y actualizar automáticamente los datos relacionados según sea necesario al insertar una fila con un valor de clave externa.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="eb3a1-149">Clases de repositorio y lógica de negocios</span><span class="sxs-lookup"><span data-stu-id="eb3a1-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="eb3a1-150">Un control de `ObjectDataSource` funciona mediante la invocación de una clase que se crea.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="eb3a1-151">La clase incluye métodos que recuperan y actualizan datos, y proporciona los nombres de esos métodos al control `ObjectDataSource` en el marcado.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="eb3a1-152">Durante la representación o el procesamiento de postback, el `ObjectDataSource` llama a los métodos que ha especificado.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="eb3a1-153">Además de las operaciones CRUD básicas, la clase que se crea para utilizar con el control `ObjectDataSource` puede necesitar ejecutar la lógica de negocios cuando el `ObjectDataSource` lee o actualiza los datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="eb3a1-154">Por ejemplo, al actualizar un departamento, es posible que tenga que validar que ningún otro departamento tenga el mismo administrador porque una persona no puede ser administrador de más de un departamento.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="eb3a1-155">En algunos `ObjectDataSource` documentación, como la [información general de la clase ObjectDataSource](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), el control llama a una clase denominada *objeto comercial* que incluye lógica de negocios y lógica de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="eb3a1-156">En este tutorial, creará clases independientes para la lógica de negocios y para la lógica de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="eb3a1-157">La clase que encapsula la lógica de acceso a datos se denomina *repositorio*.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="eb3a1-158">La clase de lógica de negocios incluye métodos de lógica empresarial y métodos de acceso a datos, pero los métodos de acceso a datos llaman al repositorio para realizar tareas de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="eb3a1-159">También creará una capa de abstracción entre la capa BLL y la capa DAL que facilita las pruebas unitarias automatizadas de la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="eb3a1-160">Esta capa de abstracción se implementa mediante la creación de una interfaz y el uso de la interfaz cuando se crea una instancia del repositorio en la clase de lógica de negocios.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="eb3a1-161">Esto permite proporcionar la clase de lógica de negocios con una referencia a cualquier objeto que implemente la interfaz del repositorio.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="eb3a1-162">Para un funcionamiento normal, se proporciona un objeto de repositorio que funciona con el Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="eb3a1-163">Para las pruebas, debe proporcionar un objeto de repositorio que funcione con los datos almacenados de una forma que pueda manipular fácilmente, como las variables de clase definidas como colecciones.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="eb3a1-164">En la ilustración siguiente se muestra la diferencia entre una clase de lógica empresarial que incluye la lógica de acceso a datos sin un repositorio y otra que usa un repositorio.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="eb3a1-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="eb3a1-166">Comenzará creando páginas web en las que el control de `ObjectDataSource` se enlaza directamente a un repositorio porque solo realiza tareas básicas de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="eb3a1-167">En el tutorial siguiente, creará una clase de lógica de negocios con la lógica de validación y enlazará el control de `ObjectDataSource` a esa clase en lugar de a la clase de repositorio.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="eb3a1-168">También creará pruebas unitarias para la lógica de validación.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="eb3a1-169">En el tercer tutorial de esta serie, agregará funcionalidad de ordenación y filtrado a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="eb3a1-170">Las páginas que crea en este tutorial funcionan con el conjunto de entidades `Departments` del modelo de datos creado en la [serie de tutoriales de introducción](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="eb3a1-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="eb3a1-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="eb3a1-173">Actualizar la base de datos y el modelo de datos</span><span class="sxs-lookup"><span data-stu-id="eb3a1-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="eb3a1-174">Para comenzar este tutorial, debe realizar dos cambios en la base de datos, y ambos requieren los cambios correspondientes en el modelo de datos que ha creado en el [Introducción con los tutoriales de Entity Framework y formularios Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="eb3a1-175">En uno de esos tutoriales, realizó cambios en el diseñador manualmente para sincronizar el modelo de datos con la base de datos después de un cambio en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="eb3a1-176">En este tutorial, usará la herramienta **Actualizar modelo de la base de** datos del diseñador para actualizar el modelo de datos automáticamente.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="eb3a1-177">Agregar una relación a la base de datos</span><span class="sxs-lookup"><span data-stu-id="eb3a1-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="eb3a1-178">En Visual Studio, abra la aplicación web contoso University que creó en el Introducción con la serie de tutoriales de [Entity Framework y Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) y, a continuación, abra el diagrama de base de datos `SchoolDiagram`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="eb3a1-179">Si observa la tabla `Department` del diagrama de base de datos, verá que tiene una columna `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="eb3a1-180">Esta columna es una clave externa de la tabla de `Person`, pero no se ha definido ninguna relación de clave externa en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="eb3a1-181">Debe crear la relación y actualizar el modelo de datos para que el Entity Framework pueda controlar automáticamente esta relación.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="eb3a1-182">En el diagrama de base de datos, haga clic con el botón secundario en la tabla `Department` y seleccione **relaciones**.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="eb3a1-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="eb3a1-184">En el cuadro **relaciones de clave externa** , haga clic en **Agregar**y, a continuación, haga clic en los puntos suspensivos para **especificación de tablas y columnas**.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="eb3a1-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="eb3a1-186">En el cuadro de diálogo **tablas y columnas** , establezca la tabla y el campo de la clave principal en `Person` y `PersonID`, y establezca la tabla y el campo de la clave externa en `Department` y `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="eb3a1-187">(Al hacerlo, el nombre de la relación cambiará de `FK_Department_Department` a `FK_Department_Person`).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="eb3a1-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="eb3a1-189">Haga clic en **Aceptar** en el cuadro **tablas y columnas** , haga clic en **cerrar** en el cuadro **relaciones de clave externa** y guarde los cambios.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="eb3a1-190">Si se le pregunta si desea guardar las tablas `Person` y `Department`, haga clic en **sí**.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="eb3a1-191">Si ha eliminado `Person` filas que se corresponden con los datos que ya están en la columna `Administrator`, no podrá guardar este cambio.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="eb3a1-192">En ese caso, use el editor de tablas de **Explorador de servidores** para asegurarse de que el valor de `Administrator` de cada fila de `Department` contiene el identificador de un registro que realmente existe en la tabla de `Person`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="eb3a1-193">Después de guardar el cambio, no podrá eliminar una fila de la tabla `Person` si esa persona es un administrador de departamento.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="eb3a1-194">En una aplicación de producción, se proporciona un mensaje de error específico cuando una restricción de base de datos impide una eliminación o se especifica una eliminación en cascada.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="eb3a1-195">Para obtener un ejemplo de cómo especificar una eliminación en cascada, vea [el Entity Framework y ASP.net – introducción parte 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>

### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="eb3a1-196">Agregar una vista a la base de datos</span><span class="sxs-lookup"><span data-stu-id="eb3a1-196">Adding a View to the Database</span></span>

<span data-ttu-id="eb3a1-197">En la página New *departments. aspx* que va a crear, desea proporcionar una lista desplegable de instructores, con nombres en el formato "último, primero" para que los usuarios puedan seleccionar administradores de departamento.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="eb3a1-198">Para facilitar la tarea, se creará una vista en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="eb3a1-199">La vista se compondrá solo de los datos necesarios para la lista desplegable: el nombre completo (con el formato correcto) y la clave de registro.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="eb3a1-200">En **Explorador de servidores**, expanda *School. MDF*, haga clic con el botón secundario en la carpeta **views** y seleccione **Agregar nueva vista**.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="eb3a1-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="eb3a1-202">Haga clic en **cerrar** cuando aparezca el cuadro de diálogo **Agregar tabla** y pegue la siguiente instrucción SQL en el panel SQL:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="eb3a1-203">Guarde la vista como `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="eb3a1-204">Actualizar el modelo de datos</span><span class="sxs-lookup"><span data-stu-id="eb3a1-204">Updating the Data Model</span></span>

<span data-ttu-id="eb3a1-205">En la carpeta *Dal* , abra el archivo *SchoolModel. edmx* , haga clic con el botón secundario en la superficie de diseño y seleccione **Actualizar modelo desde base de datos**.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="eb3a1-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="eb3a1-207">En el cuadro de diálogo **Elija los objetos de base de datos** , seleccione la pestaña **Agregar** y seleccione la vista que acaba de crear.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="eb3a1-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="eb3a1-209">Haga clic en **Finalizar**.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-209">Click **Finish**.</span></span>

<span data-ttu-id="eb3a1-210">En el diseñador, verá que la herramienta creó una entidad `vInstructorName` y una nueva asociación entre las entidades `Department` y `Person`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="eb3a1-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="eb3a1-212">En las ventanas **salida** y **lista de errores** , es posible que vea un mensaje de advertencia que le informa de que la herramienta creó automáticamente una clave principal para la nueva vista `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="eb3a1-213">Este es el comportamiento normal.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-213">This is expected behavior.</span></span>

<span data-ttu-id="eb3a1-214">Cuando se hace referencia a la nueva entidad `vInstructorName` en el código, no se desea usar la Convención de base de datos de prefijo "v" en minúsculas.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="eb3a1-215">Por lo tanto, cambiará el nombre de la entidad y del conjunto de entidades en el modelo.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="eb3a1-216">Abra el **Explorador de modelos**.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-216">Open the **Model Browser**.</span></span> <span data-ttu-id="eb3a1-217">Verá `vInstructorName` enumerada como un tipo de entidad y una vista.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="eb3a1-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="eb3a1-219">En **SchoolModel** (no en **SchoolModel. Store**), haga clic con el botón secundario en **vInstructorName** y seleccione **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="eb3a1-220">En la ventana **propiedades** , cambie la propiedad **nombre** a "InstructorName" y cambie la propiedad nombre del **conjunto de entidades** por "InstructorNames".</span><span class="sxs-lookup"><span data-stu-id="eb3a1-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="eb3a1-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="eb3a1-222">Guarde y cierre el modelo de datos y, a continuación, recompile el proyecto.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="eb3a1-223">Usar una clase de repositorio y un control ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="eb3a1-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="eb3a1-224">Cree un nuevo archivo de clase en la carpeta *Dal* , asígnele el nombre *SchoolRepository.CS*y reemplace el código existente por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="eb3a1-225">Este código proporciona un único método de `GetDepartments` que devuelve todas las entidades del conjunto de entidades `Departments`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="eb3a1-226">Como sabe que va a tener acceso a la propiedad de navegación `Person` para cada fila devuelta, especifique la carga diligente para esa propiedad mediante el método `Include`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="eb3a1-227">La clase también implementa la interfaz `IDisposable` para asegurarse de que la conexión a la base de datos se libera cuando se desecha el objeto.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="eb3a1-228">Una práctica común es crear una clase de repositorio para cada tipo de entidad.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="eb3a1-229">En este tutorial, se usa una clase de repositorio para varios tipos de entidad.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="eb3a1-230">Para obtener más información sobre el patrón de repositorio, consulte las publicaciones en [el blog del equipo de Entity Framework](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) y el [blog de Julia Lerman](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>

<span data-ttu-id="eb3a1-231">El método `GetDepartments` devuelve un objeto `IEnumerable` en lugar de un objeto `IQueryable` para asegurarse de que la colección devuelta se puede usar incluso después de que se elimine el propio objeto de repositorio.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="eb3a1-232">Un objeto `IQueryable` puede producir el acceso a la base de datos cada vez que se tiene acceso a él, pero el objeto de repositorio podría desecharse en el momento en que un control enlazado a datos intenta representar los datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="eb3a1-233">Podría devolver otro tipo de colección, como un objeto `IList` en lugar de un objeto `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="eb3a1-234">Sin embargo, la devolución de un objeto `IEnumerable` garantiza que puede realizar tareas habituales de procesamiento de lista de solo lectura como bucles de `foreach` y consultas LINQ, pero no puede Agregar o quitar elementos de la colección, lo que puede implicar que tales cambios se conserven en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="eb3a1-235">Cree una página *departments. aspx* que use la página maestra *site. Master* y agregue el marcado siguiente en el control `Content` denominado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="eb3a1-236">Este marcado crea un control `ObjectDataSource` que utiliza la clase de repositorio que acaba de crear y un control `GridView` para mostrar los datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="eb3a1-237">El control `GridView` especifica comandos de **edición** y **eliminación** , pero no ha agregado código para admitirlos todavía.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="eb3a1-238">Varias columnas usan controles de `DynamicField` para que pueda aprovechar las ventajas de la funcionalidad de validación y formato de datos automática.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="eb3a1-239">Para que funcionen, deberá llamar al método `EnableDynamicData` en el controlador de eventos `Page_Init`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="eb3a1-240">(`DynamicControl` los controles no se usan en el campo `Administrator` porque no funcionan con las propiedades de navegación).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="eb3a1-241">Los atributos de `Vertical-Align="Top"` se convertirán en importantes más adelante cuando agregue una columna que tenga un control de `GridView` anidado a la cuadrícula.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="eb3a1-242">Abra el archivo *departments.aspx.CS* y agregue la siguiente instrucción `using`:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="eb3a1-243">A continuación, agregue el siguiente controlador para el evento de `Init` de la página:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="eb3a1-244">En la carpeta *Dal* , cree un nuevo archivo de clase denominado *Department.CS* y reemplace el código existente por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="eb3a1-245">Este código agrega metadatos al modelo de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="eb3a1-246">Especifica que la propiedad `Budget` de la entidad `Department` realmente representa la moneda, aunque su tipo de datos sea `Decimal`y especifica que el valor debe estar comprendido entre 0 y $1.000.000,00.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="eb3a1-247">También especifica que la propiedad `StartDate` debe tener el formato de fecha en formato mm/dd/aaaa.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="eb3a1-248">Ejecute la página *departments. aspx* .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="eb3a1-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="eb3a1-250">Tenga en cuenta que, aunque no especificó una cadena de formato en el marcado de página *departments. aspx* para las columnas **presupuesto** o **fecha de inicio** , el formato de fecha y moneda predeterminado se les ha aplicado mediante los controles `DynamicField`, usando los metadatos que proporcionó en el archivo *Department.CS* .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="eb3a1-251">Agregar funcionalidad de inserción y eliminación</span><span class="sxs-lookup"><span data-stu-id="eb3a1-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="eb3a1-252">Abra *SchoolRepository.CS*y agregue el código siguiente para crear un método de `Insert` y un método `Delete`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="eb3a1-253">El código también incluye un método denominado `GenerateDepartmentID` que calcula el siguiente valor de clave de registro disponible para su uso por el método `Insert`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="eb3a1-254">Esto es necesario porque la base de datos no está configurada para calcular esto automáticamente para la tabla `Department`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="eb3a1-255">Método Attach</span><span class="sxs-lookup"><span data-stu-id="eb3a1-255">The Attach Method</span></span>

<span data-ttu-id="eb3a1-256">El método `DeleteDepartment` llama al método `Attach` para volver a establecer el vínculo que se mantiene en el administrador de estado de objetos del contexto del objeto entre la entidad en la memoria y la fila de base de datos que representa.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="eb3a1-257">Esto debe ocurrir antes de que el método llame al método `SaveChanges`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="eb3a1-258">El término *contexto del objeto* hace referencia a la clase Entity Framework que se deriva de la clase `ObjectContext` que se usa para tener acceso a las entidades y los conjuntos de entidades.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="eb3a1-259">En el código de este proyecto, la clase se denomina `SchoolEntities`y una instancia de se denomina siempre `context`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="eb3a1-260">El *Administrador de estado de objetos* del contexto del objeto es una clase que se deriva de la clase `ObjectStateManager`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="eb3a1-261">El contacto de objeto utiliza el administrador de estado de objetos para almacenar objetos de entidad y para realizar un seguimiento de si cada uno está sincronizado con su fila o filas de tabla correspondientes en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="eb3a1-262">Cuando se lee una entidad, el contexto del objeto la almacena en el administrador de estado de objetos y realiza un seguimiento de si esa representación del objeto está sincronizada con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="eb3a1-263">Por ejemplo, si cambia un valor de propiedad, se establece una marca para indicar que la propiedad modificada ya no está sincronizada con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="eb3a1-264">A continuación, al llamar al método `SaveChanges`, el contexto del objeto sabe qué hacer en la base de datos porque el administrador de estado de objetos sabe exactamente cuáles son las diferencias entre el estado actual de la entidad y el estado de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="eb3a1-265">Sin embargo, este proceso no funciona normalmente en una aplicación Web, porque la instancia del contexto del objeto que lee una entidad, junto con todo en el administrador de estado de objetos, se elimina después de representar una página.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="eb3a1-266">La instancia del contexto del objeto que debe aplicar los cambios es una nueva instancia de con la que se crean instancias para el procesamiento de postback.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="eb3a1-267">En el caso del método `DeleteDepartment`, el control `ObjectDataSource` vuelve a crear la versión original de la entidad a partir de los valores del estado de vista, pero esta entidad que se ha vuelto a crear `Department` no existe en el administrador de estado de objetos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="eb3a1-268">Si llamó al método `DeleteObject` en esta entidad que se ha vuelto a crear, se produciría un error en la llamada porque el contexto del objeto no sabe si la entidad está sincronizada con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="eb3a1-269">Sin embargo, al llamar al método `Attach` se vuelve a establecer el mismo seguimiento entre la entidad que se ha vuelto a crear y los valores de la base de datos que se realizaron originalmente automáticamente cuando la entidad se leyó en una instancia anterior del contexto del objeto.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="eb3a1-270">Hay ocasiones en las que no desea que el contexto del objeto realice el seguimiento de las entidades en el administrador de estado de objetos, y puede establecer marcas para evitar que lo haga.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="eb3a1-271">En los tutoriales posteriores de esta serie se muestran ejemplos de esto.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="eb3a1-272">El método SaveChanges</span><span class="sxs-lookup"><span data-stu-id="eb3a1-272">The SaveChanges Method</span></span>

<span data-ttu-id="eb3a1-273">Esta clase de repositorio simple muestra los principios básicos de cómo realizar operaciones CRUD.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="eb3a1-274">En este ejemplo, se llama al método `SaveChanges` inmediatamente después de cada actualización.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="eb3a1-275">En una aplicación de producción podría querer llamar al método `SaveChanges` desde un método independiente para proporcionar más control sobre cuándo se actualiza la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="eb3a1-276">(Al final del tutorial siguiente encontrará un vínculo a una nota del producto que describe el patrón de unidad de trabajo, que es un enfoque para coordinar las actualizaciones relacionadas). Observe también que en el ejemplo, el método `DeleteDepartment` no incluye el código para controlar los conflictos de simultaneidad. código que se va a agregar en un tutorial posterior de esta serie.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="eb3a1-277">Recuperando nombres de instructor para seleccionar al insertar</span><span class="sxs-lookup"><span data-stu-id="eb3a1-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="eb3a1-278">Los usuarios deben poder seleccionar un administrador de una lista de instructores en una lista desplegable al crear nuevos departamentos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="eb3a1-279">Por consiguiente, agregue el código siguiente a *SchoolRepository.CS* para crear un método para recuperar la lista de instructores mediante la vista que creó anteriormente:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="eb3a1-280">Crear una página para insertar departamentos</span><span class="sxs-lookup"><span data-stu-id="eb3a1-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="eb3a1-281">Cree una página *DepartmentsAdd. aspx* que use la página *site. Master* y agregue el marcado siguiente en el control `Content` denominado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="eb3a1-282">Este marcado crea dos controles `ObjectDataSource`, uno para insertar nuevas entidades `Department` y otro para recuperar los nombres de los instructores para el control `DropDownList` que se usa para seleccionar administradores de departamento.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="eb3a1-283">El marcado crea un control de `DetailsView` para la entrada de nuevos departamentos y especifica un controlador para el evento de `ItemInserting` del control, de modo que pueda establecer el valor de clave externa de `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="eb3a1-284">Al final hay un control de `ValidationSummary` para mostrar los mensajes de error.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="eb3a1-285">Abra *DepartmentsAdd.aspx.CS* y agregue la siguiente instrucción `using`:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="eb3a1-286">Agregue la siguiente variable y métodos de clase:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="eb3a1-287">El método `Page_Init` habilita la funcionalidad de datos dinámicos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="eb3a1-288">El controlador del evento de `Init` del control `DropDownList` guarda una referencia al control y el controlador del evento `Inserting` del control `DetailsView` utiliza esa referencia para obtener el valor `PersonID` del instructor seleccionado y actualizar la propiedad `Administrator` clave externa de la entidad `Department`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="eb3a1-289">Ejecute la página, agregue información para un nuevo departamento y, a continuación, haga clic en el vínculo **Insertar** .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="eb3a1-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="eb3a1-291">Escriba los valores de otro departamento nuevo.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-291">Enter values for another new department.</span></span> <span data-ttu-id="eb3a1-292">Escriba un número mayor que 1.000.000,00 en el campo **presupuesto** y la pestaña en el campo siguiente.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="eb3a1-293">Aparece un asterisco en el campo y, si mantiene el puntero del mouse sobre él, puede ver el mensaje de error que especificó en los metadatos de ese campo.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="eb3a1-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="eb3a1-295">Haga clic en **Insertar**y verá el mensaje de error que muestra el control `ValidationSummary` en la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="eb3a1-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="eb3a1-297">A continuación, cierre el explorador y abra la página *departments. aspx* .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="eb3a1-298">Agregue la funcionalidad de eliminación a la página *departments. aspx* agregando un `DeleteMethod` atributo al control `ObjectDataSource` y un atributo `DataKeyNames` al control `GridView`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="eb3a1-299">Ahora, las etiquetas de apertura de estos controles son similares a las del ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="eb3a1-300">Ejecute la página.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-300">Run the page.</span></span>

<span data-ttu-id="eb3a1-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="eb3a1-302">Elimine el Departamento que agregó al ejecutar la página *DepartmentsAdd. aspx* .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="eb3a1-303">Agregar funcionalidad de actualización</span><span class="sxs-lookup"><span data-stu-id="eb3a1-303">Adding Update Functionality</span></span>

<span data-ttu-id="eb3a1-304">Abra *SchoolRepository.CS* y agregue el siguiente método de `Update`:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="eb3a1-305">Al hacer clic en **Actualizar** en la página *departments. aspx* , el control `ObjectDataSource` crea dos entidades `Department` para pasar al método `UpdateDepartment`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="eb3a1-306">Uno contiene los valores originales que se han almacenado en el estado de vista y el otro contiene los nuevos valores que se especificaron en el control `GridView`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="eb3a1-307">El código del método `UpdateDepartment` pasa la entidad `Department` que tiene los valores originales al método `Attach` para establecer el seguimiento entre la entidad y lo que hay en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="eb3a1-308">A continuación, el código pasa la entidad `Department` que tiene los valores nuevos al método `ApplyCurrentValues`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="eb3a1-309">El contexto del objeto compara los valores antiguos y nuevos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-309">The object context compares the old and new values.</span></span> <span data-ttu-id="eb3a1-310">Si un valor nuevo es diferente de un valor anterior, el contexto del objeto cambia el valor de la propiedad.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="eb3a1-311">A continuación, el método `SaveChanges` actualiza solo las columnas modificadas en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="eb3a1-312">(Sin embargo, si la función de actualización de esta entidad se asignó a un procedimiento almacenado, toda la fila se actualizaría independientemente de las columnas que se cambiaran).</span><span class="sxs-lookup"><span data-stu-id="eb3a1-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="eb3a1-313">Abra el archivo *departments. aspx* y agregue los siguientes atributos al control `DepartmentsObjectDataSource`:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="eb3a1-314">Esto hace que los valores anteriores se almacenen en el estado de vista para que se puedan comparar con los nuevos valores del método `Update`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="eb3a1-315">Esto informa al control de que el nombre del parámetro de valores originales es `origDepartment`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="eb3a1-316">El marcado de la etiqueta de apertura del control `ObjectDataSource` ahora es similar al ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="eb3a1-317">Agregue un atributo `OnRowUpdating="DepartmentsGridView_RowUpdating"` al control `GridView`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="eb3a1-318">Lo usará para establecer el valor de la propiedad `Administrator` en función de la fila que el usuario seleccione en una lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="eb3a1-319">La etiqueta de apertura de `GridView` ahora es similar al ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="eb3a1-320">Agregue un control de `EditItemTemplate` para la columna `Administrator` al control `GridView`, inmediatamente después del control `ItemTemplate` para esa columna:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="eb3a1-321">Este control `EditItemTemplate` es similar al control `InsertItemTemplate` en la página *DepartmentsAdd. aspx* .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="eb3a1-322">La diferencia es que el valor inicial del control se establece mediante el atributo `SelectedValue`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="eb3a1-323">Antes del control `GridView`, agregue un control `ValidationSummary` como hizo en la página *DepartmentsAdd. aspx* .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="eb3a1-324">Abra *departments.aspx.CS* y inmediatamente después de la declaración de clase parcial, agregue el código siguiente para crear un campo privado para hacer referencia al control `DropDownList`:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="eb3a1-325">A continuación, agregue Controladores para el evento `Init` del control `DropDownList` y el evento `RowUpdating` del control `GridView`:</span><span class="sxs-lookup"><span data-stu-id="eb3a1-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="eb3a1-326">El controlador del evento `Init` guarda una referencia al control `DropDownList` en el campo de clase.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="eb3a1-327">El controlador del evento `RowUpdating` usa la referencia para obtener el valor que el usuario ha escrito y aplicarlo a la propiedad `Administrator` de la entidad `Department`.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="eb3a1-328">Use la página *DepartmentsAdd. aspx* para agregar un nuevo departamento y, a continuación, ejecute la página *departments. aspx* y haga clic en **Editar** en la fila que ha agregado.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="eb3a1-329">No podrá modificar filas que no haya agregado (es decir, que ya estaban en la base de datos), debido a que los datos no son válidos en la base de datos. los administradores de las filas que se crearon con la base de datos son estudiantes.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="eb3a1-330">Si intenta editar uno de ellos, aparecerá una página de error que informa de un error como `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="eb3a1-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>

<span data-ttu-id="eb3a1-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="eb3a1-332">Si escribe una cantidad de **presupuesto** no válida y, a continuación, hace clic en **Actualizar**, verá el mismo asterisco y el mismo mensaje de error que vio en la página *departments. aspx* .</span><span class="sxs-lookup"><span data-stu-id="eb3a1-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="eb3a1-333">Cambie un valor de campo o seleccione un administrador diferente y haga clic en **Actualizar**.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="eb3a1-334">Se muestra el cambio.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-334">The change is displayed.</span></span>

<span data-ttu-id="eb3a1-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="eb3a1-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="eb3a1-336">Esto completa la introducción al uso del control `ObjectDataSource` para las operaciones CRUD (creación, lectura, actualización y eliminación) básicas con la Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="eb3a1-337">Ha creado una aplicación de n niveles simple, pero la capa de lógica de negocios todavía está estrechamente acoplada a la capa de acceso a datos, lo que complica las pruebas unitarias automatizadas.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="eb3a1-338">En el tutorial siguiente, verá cómo implementar el patrón de repositorio para facilitar las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="eb3a1-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="eb3a1-339">Siguiente</span><span class="sxs-lookup"><span data-stu-id="eb3a1-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
