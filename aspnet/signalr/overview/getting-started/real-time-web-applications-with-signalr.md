---
uid: signalr/overview/getting-started/real-time-web-applications-with-signalr
title: 'Laboratorio práctico: aplicaciones web en tiempo real con Signalr | Microsoft Docs'
author: bradygaster
description: Las aplicaciones web en tiempo real tienen la capacidad de insertar contenido del lado servidor en los clientes conectados, en tiempo real. Para desarrolladores de ASP.NET, ASP...
ms.author: bradyg
ms.date: 07/16/2014
ms.assetid: ba07958c-42e1-4da0-81db-ba6925ed6db0
msc.legacyurl: /signalr/overview/getting-started/real-time-web-applications-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: 9e39fd3f2fc9d4e791002450085215096c222fcd
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78431671"
---
# <a name="hands-on-lab-real-time-web-applications-with-signalr"></a><span data-ttu-id="9afee-104">Laboratorio práctico: aplicaciones web en tiempo real con Signalr</span><span class="sxs-lookup"><span data-stu-id="9afee-104">Hands On Lab: Real-Time Web Applications with SignalR</span></span>

<span data-ttu-id="9afee-105">por [equipo de grupos de web](https://twitter.com/webcamps)</span><span class="sxs-lookup"><span data-stu-id="9afee-105">by [Web Camps Team](https://twitter.com/webcamps)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

[<span data-ttu-id="9afee-106">Descargar el kit de aprendizaje de Web., versión de octubre de 2015</span><span class="sxs-lookup"><span data-stu-id="9afee-106">Download Web Camps Training Kit, October 2015 Release</span></span>](https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b)

> <span data-ttu-id="9afee-107">Las aplicaciones web en tiempo real tienen la capacidad de insertar contenido del lado servidor en los clientes conectados, en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="9afee-107">Real-time Web applications feature the ability to push server-side content to the connected clients as it happens, in real-time.</span></span> <span data-ttu-id="9afee-108">Para desarrolladores de ASP.NET, **ASP.net signalr** es una biblioteca para agregar funcionalidad web en tiempo real a sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="9afee-108">For ASP.NET developers, **ASP.NET SignalR** is a library to add real-time web functionality to their applications.</span></span> <span data-ttu-id="9afee-109">Aprovecha varios transportes, seleccionando automáticamente el mejor transporte disponible en función del cliente y el mejor transporte disponible del servidor.</span><span class="sxs-lookup"><span data-stu-id="9afee-109">It takes advantage of several transports, automatically selecting the best available transport given the client and server's best available transport.</span></span> <span data-ttu-id="9afee-110">Aprovecha **WebSocket**, una API de HTML5 que permite la comunicación bidireccional entre el explorador y el servidor.</span><span class="sxs-lookup"><span data-stu-id="9afee-110">It takes advantage of **WebSocket**, an HTML5 API that enables bi-directional communication between the browser and server.</span></span>
> 
> <span data-ttu-id="9afee-111">**Signalr** también proporciona una API sencilla y de alto nivel para realizar la RPC de servidor a cliente (llamar a funciones de JavaScript en los exploradores de los clientes desde el código .net del lado servidor) en la aplicación de ASP.net, así como agregar enlaces útiles para la administración de conexiones, como eventos de conexión/desconexión, agrupación de conexiones y autorización.</span><span class="sxs-lookup"><span data-stu-id="9afee-111">**SignalR** also provides a simple, high-level API for doing server to client RPC (call JavaScript functions in your clients' browsers from server-side .NET code) in your ASP.NET application, as well as adding useful hooks for connection management, such as connect/disconnect events, grouping connections, and authorization.</span></span>
> 
> <span data-ttu-id="9afee-112">**Signalr** es una abstracción en algunos de los transportes necesarios para realizar el trabajo en tiempo real entre el cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="9afee-112">**SignalR** is an abstraction over some of the transports that are required to do real-time work between client and server.</span></span> <span data-ttu-id="9afee-113">Una conexión **signalr** se inicia como http y, después, se promueve a una conexión **WebSocket** , si está disponible.</span><span class="sxs-lookup"><span data-stu-id="9afee-113">A **SignalR** connection starts as HTTP, and is then promoted to a **WebSocket** connection if available.</span></span> <span data-ttu-id="9afee-114">**WebSocket** es el transporte ideal para **signalr**, ya que hace el uso más eficaz de la memoria del servidor, tiene la latencia más baja y tiene las características más subyacentes (como la comunicación dúplex completa entre el cliente y el servidor), pero también tiene los requisitos más estrictos: **WebSocket** requiere que el servidor use **Windows Server 2012** o **Windows 8**, junto con **.NET Framework 4,5**.</span><span class="sxs-lookup"><span data-stu-id="9afee-114">**WebSocket** is the ideal transport for **SignalR**, since it makes the most efficient use of server memory, has the lowest latency, and has the most underlying features (such as full duplex communication between client and server), but it also has the most stringent requirements: **WebSocket** requires the server to be using **Windows Server 2012** or **Windows 8**, along with **.NET Framework 4.5**.</span></span> <span data-ttu-id="9afee-115">Si no se cumplen estos requisitos, **signalr** intentará usar otros transportes para realizar sus conexiones (como el *sondeo prolongado de Ajax*).</span><span class="sxs-lookup"><span data-stu-id="9afee-115">If these requirements are not met, **SignalR** will attempt to use other transports to make its connections (like *Ajax long polling*).</span></span>
> 
> <span data-ttu-id="9afee-116">**Signalr** API contiene dos modelos para la comunicación entre clientes y servidores: conexiones y **concentradores** **persistentes** .</span><span class="sxs-lookup"><span data-stu-id="9afee-116">The **SignalR** API contains two models for communicating between clients and servers: **Persistent Connections** and **Hubs**.</span></span> <span data-ttu-id="9afee-117">Una **conexión** representa un extremo simple para el envío de mensajes de un solo destinatario, agrupados o de difusión.</span><span class="sxs-lookup"><span data-stu-id="9afee-117">A **Connection** represents a simple endpoint for sending single-recipient, grouped, or broadcast messages.</span></span> <span data-ttu-id="9afee-118">Un **concentrador** es una canalización de alto nivel que se basa en la API de conexión que permite que el cliente y el servidor llamen a métodos entre sí directamente.</span><span class="sxs-lookup"><span data-stu-id="9afee-118">A **Hub** is a more high-level pipeline built upon the Connection API that allows your client and server to call methods on each other directly.</span></span>
> 
> ![Arquitectura de signalr](real-time-web-applications-with-signalr/_static/image1.png)
> 
> <span data-ttu-id="9afee-120">Todo el código de ejemplo y los fragmentos de código se incluyen en el kit de aprendizaje de Web de la versión 2015 de octubre, disponible en [https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b](https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b).</span><span class="sxs-lookup"><span data-stu-id="9afee-120">All sample code and snippets are included in the Web Camps Training Kit, October 2015 Release, available at [https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b](https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b).</span></span>  <span data-ttu-id="9afee-121">Tenga en cuenta que el vínculo del instalador de esa página ya no funciona; en su lugar, use uno de los vínculos de la sección activos.</span><span class="sxs-lookup"><span data-stu-id="9afee-121">Please note that the Installer link on that page no longer works; use one of the links under the Assets section instead.</span></span>

<a id="Overview"></a>
## <a name="overview"></a><span data-ttu-id="9afee-122">Información general</span><span class="sxs-lookup"><span data-stu-id="9afee-122">Overview</span></span>

<a id="Objectives"></a>
### <a name="objectives"></a><span data-ttu-id="9afee-123">Objetivos</span><span class="sxs-lookup"><span data-stu-id="9afee-123">Objectives</span></span>

<span data-ttu-id="9afee-124">En este laboratorio práctico, aprenderá a:</span><span class="sxs-lookup"><span data-stu-id="9afee-124">In this hands-on lab, you will learn how to:</span></span>

- <span data-ttu-id="9afee-125">Enviar notificaciones del servidor al cliente mediante Signalr.</span><span class="sxs-lookup"><span data-stu-id="9afee-125">Send notifications from server to client using SignalR.</span></span>
- <span data-ttu-id="9afee-126">Escalabilidad horizontal la aplicación Signalr mediante **SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="9afee-126">Scale Out your SignalR application using **SQL Server**.</span></span>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a><span data-ttu-id="9afee-127">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="9afee-127">Prerequisites</span></span>

<span data-ttu-id="9afee-128">Para completar este laboratorio práctico, es necesario lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="9afee-128">The following is required to complete this hands-on lab:</span></span>

- <span data-ttu-id="9afee-129">[Visual Studio Express 2013 para web](https://www.microsoft.com/visualstudio/) o superior</span><span class="sxs-lookup"><span data-stu-id="9afee-129">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/) or greater</span></span>

<a id="Setup"></a>
### <a name="setup"></a><span data-ttu-id="9afee-130">Programa de instalación</span><span class="sxs-lookup"><span data-stu-id="9afee-130">Setup</span></span>

<span data-ttu-id="9afee-131">Con el fin de ejecutar los ejercicios de este laboratorio práctico, deberá configurar el entorno primero.</span><span class="sxs-lookup"><span data-stu-id="9afee-131">In order to run the exercises in this hands-on lab, you will need to set up your environment first.</span></span>

1. <span data-ttu-id="9afee-132">Abra una ventana del explorador de Windows y vaya a la carpeta de **origen** del laboratorio.</span><span class="sxs-lookup"><span data-stu-id="9afee-132">Open a Windows Explorer window and browse to the lab's **Source** folder.</span></span>
2. <span data-ttu-id="9afee-133">Haga clic con el botón secundario en **setup. cmd** y seleccione **Ejecutar como administrador** para iniciar el proceso de instalación que configurará el entorno e instalará los fragmentos de código de Visual Studio para este laboratorio.</span><span class="sxs-lookup"><span data-stu-id="9afee-133">Right-click **Setup.cmd** and select **Run as administrator** to launch the setup process that will configure your environment and install the Visual Studio code snippets for this lab.</span></span>
3. <span data-ttu-id="9afee-134">Si se muestra el cuadro de diálogo control de cuentas de usuario, confirme la acción para continuar.</span><span class="sxs-lookup"><span data-stu-id="9afee-134">If the User Account Control dialog box is shown, confirm the action to proceed.</span></span>

> [!NOTE]
> <span data-ttu-id="9afee-135">Asegúrese de que ha comprobado todas las dependencias de este laboratorio antes de ejecutar el programa de instalación.</span><span class="sxs-lookup"><span data-stu-id="9afee-135">Make sure you have checked all the dependencies for this lab before running the setup.</span></span>

<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a><span data-ttu-id="9afee-136">Usar los fragmentos de código</span><span class="sxs-lookup"><span data-stu-id="9afee-136">Using the Code Snippets</span></span>

<span data-ttu-id="9afee-137">En todo el documento de laboratorio, se le indicará que inserte bloques de código.</span><span class="sxs-lookup"><span data-stu-id="9afee-137">Throughout the lab document, you will be instructed to insert code blocks.</span></span> <span data-ttu-id="9afee-138">Para su comodidad, la mayor parte de este código se proporciona como fragmentos de Visual Studio Code, a los que puede acceder desde Visual Studio 2013 para evitar tener que agregarlo manualmente.</span><span class="sxs-lookup"><span data-stu-id="9afee-138">For your convenience, most of this code is provided as Visual Studio Code Snippets, which you can access from within Visual Studio 2013 to avoid having to add it manually.</span></span>

> [!NOTE]
> <span data-ttu-id="9afee-139">Cada ejercicio va acompañado de una solución de inicio que se encuentra en la carpeta **Inicio** del ejercicio que le permite seguir cada ejercicio con independencia de los demás.</span><span class="sxs-lookup"><span data-stu-id="9afee-139">Each exercise is accompanied by a starting solution located in the **Begin** folder of the exercise that allows you to follow each exercise independently of the others.</span></span> <span data-ttu-id="9afee-140">Tenga en cuenta que los fragmentos de código que se agregan durante un ejercicio no se encuentran en estas soluciones de inicio y puede que no funcionen hasta que haya completado el ejercicio.</span><span class="sxs-lookup"><span data-stu-id="9afee-140">Please be aware that the code snippets that are added during an exercise are missing from these starting solutions and may not work until you have completed the exercise.</span></span> <span data-ttu-id="9afee-141">Dentro del código fuente de un ejercicio, también encontrará una carpeta **final** que contiene una solución de Visual Studio con el código que es el resultado de completar los pasos del ejercicio correspondiente.</span><span class="sxs-lookup"><span data-stu-id="9afee-141">Inside the source code for an exercise, you will also find an **End** folder containing a Visual Studio solution with the code that results from completing the steps in the corresponding exercise.</span></span> <span data-ttu-id="9afee-142">Puede usar estas soluciones como guía si necesita ayuda adicional a medida que trabaja en este laboratorio práctico.</span><span class="sxs-lookup"><span data-stu-id="9afee-142">You can use these solutions as guidance if you need additional help as you work through this hands-on lab.</span></span>

---

<a id="Exercises"></a>
## <a name="exercises"></a><span data-ttu-id="9afee-143">Ejercicios</span><span class="sxs-lookup"><span data-stu-id="9afee-143">Exercises</span></span>

<span data-ttu-id="9afee-144">Este laboratorio práctico incluye los siguientes ejercicios:</span><span class="sxs-lookup"><span data-stu-id="9afee-144">This hands-on lab includes the following exercises:</span></span>

1. [<span data-ttu-id="9afee-145">Trabajar con datos en tiempo real mediante Signalr</span><span class="sxs-lookup"><span data-stu-id="9afee-145">Working with Real-Time Data Using SignalR</span></span>](#Exercise1)
2. [<span data-ttu-id="9afee-146">Escalado horizontal con SQL Server</span><span class="sxs-lookup"><span data-stu-id="9afee-146">Scaling Out Using SQL Server</span></span>](#Exercise2)

<span data-ttu-id="9afee-147">Tiempo estimado para completar este laboratorio: **60 minutos**</span><span class="sxs-lookup"><span data-stu-id="9afee-147">Estimated time to complete this lab: **60 minutes**</span></span>

> [!NOTE]
> <span data-ttu-id="9afee-148">Al iniciar Visual Studio por primera vez, debe seleccionar una de las colecciones de configuraciones predefinidas.</span><span class="sxs-lookup"><span data-stu-id="9afee-148">When you first start Visual Studio, you must select one of the predefined settings collections.</span></span> <span data-ttu-id="9afee-149">Cada colección predefinida está diseñada para coincidir con un estilo de desarrollo determinado y determina los diseños de ventana, el comportamiento del editor, los fragmentos de código de IntelliSense y las opciones del cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="9afee-149">Each predefined collection is designed to match a particular development style and determines window layouts, editor behavior, IntelliSense code snippets, and dialog box options.</span></span> <span data-ttu-id="9afee-150">En los procedimientos de este laboratorio se describen las acciones necesarias para realizar una tarea determinada en Visual Studio cuando se usa la colección de **configuración de desarrollo general** .</span><span class="sxs-lookup"><span data-stu-id="9afee-150">The procedures in this lab describe the actions necessary to accomplish a given task in Visual Studio when using the **General Development Settings** collection.</span></span> <span data-ttu-id="9afee-151">Si elige una colección de valores de configuración diferente para el entorno de desarrollo, puede haber diferencias en los pasos que debe tener en cuenta.</span><span class="sxs-lookup"><span data-stu-id="9afee-151">If you choose a different settings collection for your development environment, there may be differences in the steps that you should take into account.</span></span>

<a id="Exercise1"></a>
### <a name="exercise-1-working-with-real-time-data-using-signalr"></a><span data-ttu-id="9afee-152">Ejercicio 1: trabajar con datos en tiempo real mediante Signalr</span><span class="sxs-lookup"><span data-stu-id="9afee-152">Exercise 1: Working with Real-Time Data Using SignalR</span></span>

<span data-ttu-id="9afee-153">Aunque el chat se usa a menudo como ejemplo, puede hacer mucho más con la funcionalidad web en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="9afee-153">While chat is often used as an example, you can do a whole lot more with real-time Web functionality.</span></span> <span data-ttu-id="9afee-154">Cada vez que un usuario actualiza una página web para ver los nuevos datos o la página implementa el sondeo de Ajax Long para recuperar los datos nuevos, puede usar Signalr.</span><span class="sxs-lookup"><span data-stu-id="9afee-154">Any time a user refreshes a web page to see new data or the page implements Ajax long polling to retrieve new data, you can use SignalR.</span></span>

<span data-ttu-id="9afee-155">Signalr admite la funcionalidad de instalación o **difusión** del **servidor** ; controla la administración de conexiones automáticamente.</span><span class="sxs-lookup"><span data-stu-id="9afee-155">SignalR supports **server push** or **broadcasting** functionality; it handles connection management automatically.</span></span> <span data-ttu-id="9afee-156">En las conexiones HTTP clásicas para la comunicación cliente-servidor, se restablece la conexión para cada solicitud, pero Signalr proporciona una conexión persistente entre el cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="9afee-156">In classic HTTP connections for client-server communication, connection is re-established for each request, but SignalR provides persistent connection between the client and server.</span></span> <span data-ttu-id="9afee-157">En Signalr, el código de servidor llama a un código de cliente en el explorador mediante llamadas a procedimiento remoto (RPC), en lugar del modelo de solicitud-respuesta que conocemos hoy en día.</span><span class="sxs-lookup"><span data-stu-id="9afee-157">In SignalR the server code calls out to a client code in the browser using Remote Procedure Calls (RPC), rather than the request-response model we know today.</span></span>

<span data-ttu-id="9afee-158">En este ejercicio, configurará la aplicación de **prueba** de la que se usa signalr para mostrar el panel de estadísticas con las métricas actualizadas sin necesidad de actualizar toda la página.</span><span class="sxs-lookup"><span data-stu-id="9afee-158">In this exercise, you will configure the **Geek Quiz** application to use SignalR to display the Statistics dashboard with the updated metrics without the need to refresh the entire page.</span></span>

<a id="Ex1Task1"></a>
#### <a name="task-1--exploring-the-geek-quiz-statistics-page"></a><span data-ttu-id="9afee-159">Tarea 1: explorar la página de estadísticas de las pruebas de los fanáticos</span><span class="sxs-lookup"><span data-stu-id="9afee-159">Task 1 – Exploring the Geek Quiz Statistics Page</span></span>

<span data-ttu-id="9afee-160">En esta tarea, irá a través de la aplicación y comprobará cómo se muestra la página estadísticas y cómo puede mejorar la forma en que se actualiza la información.</span><span class="sxs-lookup"><span data-stu-id="9afee-160">In this task, you will go through the application and verify how the statistics page is shown and how you can improve the way the information is updated.</span></span>

1. <span data-ttu-id="9afee-161">Abra **Visual Studio Express 2013 para web** y abra la solución **GeekQuiz. sln** que se encuentra en la carpeta **Source\Ex1-WorkingWithRealTimeData\Begin** .</span><span class="sxs-lookup"><span data-stu-id="9afee-161">Open **Visual Studio Express 2013 for Web** and open the **GeekQuiz.sln** solution located in the **Source\Ex1-WorkingWithRealTimeData\Begin** folder.</span></span>
2. <span data-ttu-id="9afee-162">Presione **F5** para ejecutar la solución.</span><span class="sxs-lookup"><span data-stu-id="9afee-162">Press **F5** to run the solution.</span></span> <span data-ttu-id="9afee-163">La página de **Inicio de sesión** debe aparecer en el explorador.</span><span class="sxs-lookup"><span data-stu-id="9afee-163">The **Log in** page should appear in the browser.</span></span>

    <span data-ttu-id="9afee-164">![Ejecutar la solución](real-time-web-applications-with-signalr/_static/image2.png "Ejecutar la solución")</span><span class="sxs-lookup"><span data-stu-id="9afee-164">![Running the solution](real-time-web-applications-with-signalr/_static/image2.png "Running the solution")</span></span>

    <span data-ttu-id="9afee-165">*Ejecutar la solución*</span><span class="sxs-lookup"><span data-stu-id="9afee-165">*Running the solution*</span></span>
3. <span data-ttu-id="9afee-166">Haga clic en **registrar** en la esquina superior derecha de la página para crear un nuevo usuario en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="9afee-166">Click **Register** in the upper-right corner of the page to create a new user in the application.</span></span>

    <span data-ttu-id="9afee-167">![Vínculo de registro](real-time-web-applications-with-signalr/_static/image3.png "Vínculo de registro")</span><span class="sxs-lookup"><span data-stu-id="9afee-167">![Register link](real-time-web-applications-with-signalr/_static/image3.png "Register link")</span></span>

    <span data-ttu-id="9afee-168">*Vínculo de registro*</span><span class="sxs-lookup"><span data-stu-id="9afee-168">*Register link*</span></span>
4. <span data-ttu-id="9afee-169">En la página **registrar** , escriba un **nombre de usuario** y una **contraseña**y, a continuación, haga clic en **registrar**.</span><span class="sxs-lookup"><span data-stu-id="9afee-169">In the **Register** page, enter a **User name** and **Password**, and then click **Register**.</span></span>

    <span data-ttu-id="9afee-170">![Registrar un usuario](real-time-web-applications-with-signalr/_static/image4.png "Registrar un usuario")</span><span class="sxs-lookup"><span data-stu-id="9afee-170">![Registering a user](real-time-web-applications-with-signalr/_static/image4.png "Registering a user")</span></span>

    <span data-ttu-id="9afee-171">*Registrar un usuario*</span><span class="sxs-lookup"><span data-stu-id="9afee-171">*Registering a user*</span></span>
5. <span data-ttu-id="9afee-172">La aplicación registra la nueva cuenta y el usuario se autentica y redirige de nuevo a la Página principal que muestra la primera pregunta de la prueba.</span><span class="sxs-lookup"><span data-stu-id="9afee-172">The application registers the new account and the user is authenticated and redirected back to the home page showing the first quiz question.</span></span>
6. <span data-ttu-id="9afee-173">Abra la página de **estadísticas** en una nueva ventana y coloque la página **principal** y la página de **estadísticas** en paralelo.</span><span class="sxs-lookup"><span data-stu-id="9afee-173">Open the **Statistics** page in a new window and put the **Home** page and **Statistics** page side-by-side.</span></span>

    <span data-ttu-id="9afee-174">![Ventanas en paralelo](real-time-web-applications-with-signalr/_static/image5.png "Ventanas en paralelo")</span><span class="sxs-lookup"><span data-stu-id="9afee-174">![Side-by-side windows](real-time-web-applications-with-signalr/_static/image5.png "Side by side windows")</span></span>

    <span data-ttu-id="9afee-175">*Ventanas en paralelo*</span><span class="sxs-lookup"><span data-stu-id="9afee-175">*Side-by-side windows*</span></span>
7. <span data-ttu-id="9afee-176">En la página **principal** , haga clic en una de las opciones para responder a la pregunta.</span><span class="sxs-lookup"><span data-stu-id="9afee-176">In the **Home** page, answer the question by clicking one of the options.</span></span>

    <span data-ttu-id="9afee-177">![Responder a una pregunta](real-time-web-applications-with-signalr/_static/image6.png "Responder a una pregunta")</span><span class="sxs-lookup"><span data-stu-id="9afee-177">![Answering a question](real-time-web-applications-with-signalr/_static/image6.png "Answering a question")</span></span>

    <span data-ttu-id="9afee-178">*Responder a una pregunta*</span><span class="sxs-lookup"><span data-stu-id="9afee-178">*Answering a question*</span></span>
8. <span data-ttu-id="9afee-179">Después de hacer clic en uno de los botones, debe aparecer la respuesta.</span><span class="sxs-lookup"><span data-stu-id="9afee-179">After clicking one of the buttons, the answer should appear.</span></span>

    <span data-ttu-id="9afee-180">![Pregunta contestada correctamente](real-time-web-applications-with-signalr/_static/image7.png "Pregunta contestada correctamente")</span><span class="sxs-lookup"><span data-stu-id="9afee-180">![Question answered correct](real-time-web-applications-with-signalr/_static/image7.png "Question answered correct")</span></span>

    <span data-ttu-id="9afee-181">*Pregunta respondida correctamente*</span><span class="sxs-lookup"><span data-stu-id="9afee-181">*Question answered correctly*</span></span>
9. <span data-ttu-id="9afee-182">Tenga en cuenta que la información proporcionada en la página estadísticas está obsoleta.</span><span class="sxs-lookup"><span data-stu-id="9afee-182">Notice that the information provided in the Statistics page is outdated.</span></span> <span data-ttu-id="9afee-183">Actualice la página para ver los resultados actualizados.</span><span class="sxs-lookup"><span data-stu-id="9afee-183">Refresh the page in order to see the updated results.</span></span>

    <span data-ttu-id="9afee-184">![Página estadísticas](real-time-web-applications-with-signalr/_static/image8.png "Página estadísticas")</span><span class="sxs-lookup"><span data-stu-id="9afee-184">![Statistics page](real-time-web-applications-with-signalr/_static/image8.png "Statistics page")</span></span>

    <span data-ttu-id="9afee-185">*Página estadísticas*</span><span class="sxs-lookup"><span data-stu-id="9afee-185">*Statistics page*</span></span>
10. <span data-ttu-id="9afee-186">Vuelva a Visual Studio y detenga la depuración.</span><span class="sxs-lookup"><span data-stu-id="9afee-186">Go back to Visual Studio and stop debugging.</span></span>

<a id="Ex1Task2"></a>
#### <a name="task-2--adding-signalr-to-geek-quiz-to-show-online-charts"></a><span data-ttu-id="9afee-187">Tarea 2: adición de Signalr a una prueba de experto para mostrar gráficos en línea</span><span class="sxs-lookup"><span data-stu-id="9afee-187">Task 2 – Adding SignalR to Geek Quiz to Show Online Charts</span></span>

<span data-ttu-id="9afee-188">En esta tarea, agregará Signalr a la solución y enviará actualizaciones a los clientes automáticamente cuando se envíe una nueva respuesta al servidor.</span><span class="sxs-lookup"><span data-stu-id="9afee-188">In this task, you will add SignalR to the solution and send updates to the clients automatically when a new answer is sent to the server.</span></span>

1. <span data-ttu-id="9afee-189">En el menú **herramientas** de Visual Studio, seleccione **Administrador de paquetes NuGet**y, a continuación, haga clic en **consola del administrador de paquetes**.</span><span class="sxs-lookup"><span data-stu-id="9afee-189">From the **Tools** menu in Visual Studio, select **NuGet Package Manager**, and then click **Package Manager Console**.</span></span>
2. <span data-ttu-id="9afee-190">En la ventana de la **consola del administrador de paquetes** , ejecute el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="9afee-190">In the **Package Manager Console** window, execute the following command:</span></span>

    [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample1.ps1)]

    <span data-ttu-id="9afee-191">![Instalación del paquete de signalr](real-time-web-applications-with-signalr/_static/image9.png "Instalación del paquete de signalr")</span><span class="sxs-lookup"><span data-stu-id="9afee-191">![SignalR package installation](real-time-web-applications-with-signalr/_static/image9.png "SignalR package installation")</span></span>

    <span data-ttu-id="9afee-192">*Instalación del paquete de signalr*</span><span class="sxs-lookup"><span data-stu-id="9afee-192">*SignalR package installation*</span></span>

   > [!NOTE]
   > <span data-ttu-id="9afee-193">Al instalar los paquetes NuGet de **signalr** versión 2.0.2 desde una nueva aplicación MVC 5, deberá actualizar manualmente los paquetes **OWIN** a la versión 2.0.1 (o superior) antes de instalar signalr.</span><span class="sxs-lookup"><span data-stu-id="9afee-193">When installing **SignalR** NuGet packages version 2.0.2 from a brand new MVC 5 application, you will need to manually update **OWIN** packages to version 2.0.1 (or higher) before installing SignalR.</span></span> <span data-ttu-id="9afee-194">Para ello, puede ejecutar el siguiente script en la consola del **Administrador de paquetes**:</span><span class="sxs-lookup"><span data-stu-id="9afee-194">To do this, you can execute the following script in the **Package Manager Console**:</span></span>
   > 
   > [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample2.ps1)]
   > 
   > <span data-ttu-id="9afee-195">En una versión futura de Signalr, las dependencias OWIN se actualizarán automáticamente.</span><span class="sxs-lookup"><span data-stu-id="9afee-195">In a future release of SignalR, OWIN dependencies will be automatically updated.</span></span>
3. <span data-ttu-id="9afee-196">En **Explorador de soluciones**, expanda la carpeta **scripts** y observe que los archivos de signalr *JS* se agregaron a la solución.</span><span class="sxs-lookup"><span data-stu-id="9afee-196">In **Solution Explorer**, expand the **Scripts** folder and notice that the SignalR *js* files were added to the solution.</span></span>

    <span data-ttu-id="9afee-197">![Referencias de JavaScript de signalr](real-time-web-applications-with-signalr/_static/image10.png "Referencias de JavaScript de signalr")</span><span class="sxs-lookup"><span data-stu-id="9afee-197">![SignalR JavaScript references](real-time-web-applications-with-signalr/_static/image10.png "SignalR JavaScript references")</span></span>

    <span data-ttu-id="9afee-198">*Referencias de JavaScript de signalr*</span><span class="sxs-lookup"><span data-stu-id="9afee-198">*SignalR JavaScript references*</span></span>
4. <span data-ttu-id="9afee-199">En **Explorador de soluciones**, haga clic con el botón derecho en el proyecto **GeekQuiz** , seleccione **Agregar** | **nueva carpeta**y asígnele el nombre **hubs**.</span><span class="sxs-lookup"><span data-stu-id="9afee-199">In **Solution Explorer**, right-click the **GeekQuiz** project, select **Add** | **New Folder**, and name it **Hubs**.</span></span>
5. <span data-ttu-id="9afee-200">Haga clic con el botón derecho en la carpeta **hubs** y seleccione **Agregar | Nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="9afee-200">Right-click the **Hubs** folder and select **Add | New Item**.</span></span>

    <span data-ttu-id="9afee-201">![Agregar nuevo elemento](real-time-web-applications-with-signalr/_static/image11.png "Agregar nuevo elemento")</span><span class="sxs-lookup"><span data-stu-id="9afee-201">![Add new item](real-time-web-applications-with-signalr/_static/image11.png "Add new item")</span></span>

    <span data-ttu-id="9afee-202">*Agregar nuevo elemento*</span><span class="sxs-lookup"><span data-stu-id="9afee-202">*Add new item*</span></span>
6. <span data-ttu-id="9afee-203">En el cuadro de diálogo **Agregar nuevo elemento** , seleccione **el C# objeto visual | Web | Nodo signalr** en el panel izquierdo, seleccione **clase de concentrador de signalr (V2)** en el panel central, asigne al archivo el nombre **StatisticsHub.CS** y haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="9afee-203">In the **Add New Item** dialog box, select the **Visual C# | Web | SignalR** node in the left pane, select **SignalR Hub Class (v2)** from the center pane, name the file **StatisticsHub.cs** and click **Add**.</span></span>

    <span data-ttu-id="9afee-204">![Cuadro de diálogo Agregar nuevo elemento](real-time-web-applications-with-signalr/_static/image12.png "Cuadro de diálogo Agregar nuevo elemento")</span><span class="sxs-lookup"><span data-stu-id="9afee-204">![Add new item dialog box](real-time-web-applications-with-signalr/_static/image12.png "Add new item dialog box")</span></span>

    <span data-ttu-id="9afee-205">*Cuadro de diálogo Agregar nuevo elemento*</span><span class="sxs-lookup"><span data-stu-id="9afee-205">*Add new item dialog box*</span></span>
7. <span data-ttu-id="9afee-206">Reemplace el código de la clase **StatisticsHub** por el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="9afee-206">Replace the code in the **StatisticsHub** class with the following code.</span></span>

    <span data-ttu-id="9afee-207">(Fragmento de código- *RealTimeSignalR-EX1-StatisticsHubClass*)</span><span class="sxs-lookup"><span data-stu-id="9afee-207">(Code Snippet - *RealTimeSignalR - Ex1 - StatisticsHubClass*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample3.cs)]
8. <span data-ttu-id="9afee-208">Abra **Startup.CS** y agregue la siguiente línea al final del método de **configuración** .</span><span class="sxs-lookup"><span data-stu-id="9afee-208">Open **Startup.cs** and add the following line at the end of the **Configuration** method.</span></span>

    <span data-ttu-id="9afee-209">(Fragmento de código- *RealTimeSignalR-EX1-MapSignalR*)</span><span class="sxs-lookup"><span data-stu-id="9afee-209">(Code Snippet - *RealTimeSignalR - Ex1 - MapSignalR*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample4.cs)]
9. <span data-ttu-id="9afee-210">Abra la página **StatisticsService.CS** dentro de la carpeta **servicios** y agregue las siguientes directivas using.</span><span class="sxs-lookup"><span data-stu-id="9afee-210">Open the **StatisticsService.cs** page inside the **Services** folder and add the following using directives.</span></span>

    <span data-ttu-id="9afee-211">(Fragmento de código- *RealTimeSignalR-EX1-UsingDirectives*)</span><span class="sxs-lookup"><span data-stu-id="9afee-211">(Code Snippet - *RealTimeSignalR - Ex1 - UsingDirectives*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample5.cs)]
10. <span data-ttu-id="9afee-212">Para notificar a los clientes conectados de las actualizaciones, primero debe recuperar un objeto de **contexto** para la conexión actual.</span><span class="sxs-lookup"><span data-stu-id="9afee-212">To notify connected clients of updates, you first retrieve a **Context** object for the current connection.</span></span> <span data-ttu-id="9afee-213">El objeto **Hub** contiene métodos para enviar mensajes a un solo cliente o difusión a todos los clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="9afee-213">The **Hub** object contains methods to send messages to a single client or broadcast to all connected clients.</span></span> <span data-ttu-id="9afee-214">Agregue el método siguiente a la clase **StatisticsService** para difundir los datos de las estadísticas.</span><span class="sxs-lookup"><span data-stu-id="9afee-214">Add the following method to the **StatisticsService** class to broadcast the statistics data.</span></span>

    <span data-ttu-id="9afee-215">(Fragmento de código- *RealTimeSignalR-EX1-NotifyUpdatesMethod*)</span><span class="sxs-lookup"><span data-stu-id="9afee-215">(Code Snippet - *RealTimeSignalR - Ex1 - NotifyUpdatesMethod*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample6.cs)]

    > [!NOTE]
    > <span data-ttu-id="9afee-216">En el código anterior, se usa un nombre de método arbitrario para llamar a una función en el cliente (es decir: *updateStatistics*).</span><span class="sxs-lookup"><span data-stu-id="9afee-216">In the code above, you are using an arbitrary method name to call a function on the client (i.e.: *updateStatistics*).</span></span> <span data-ttu-id="9afee-217">El nombre de método que especifique se interpreta como un objeto dinámico, lo que significa que no hay ninguna validación de IntelliSense o de tiempo de compilación para él.</span><span class="sxs-lookup"><span data-stu-id="9afee-217">The method name that you specify is interpreted as a dynamic object, which means there is no IntelliSense or compile-time validation for it.</span></span> <span data-ttu-id="9afee-218">La expresión se evalúa en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="9afee-218">The expression is evaluated at run time.</span></span> <span data-ttu-id="9afee-219">Cuando se ejecuta la llamada al método, Signalr envía el nombre del método y los valores de parámetro al cliente.</span><span class="sxs-lookup"><span data-stu-id="9afee-219">When the method call executes, SignalR sends the method name and the parameter values to the client.</span></span> <span data-ttu-id="9afee-220">Si el cliente tiene un método que coincide con el nombre, se llama a ese método y se le pasan los valores de parámetro.</span><span class="sxs-lookup"><span data-stu-id="9afee-220">If the client has a method that matches the name, that method is called and the parameter values are passed to it.</span></span> <span data-ttu-id="9afee-221">Si no se encuentra ningún método coincidente en el cliente, no se produce ningún error.</span><span class="sxs-lookup"><span data-stu-id="9afee-221">If no matching method is found on the client, no error is raised.</span></span> <span data-ttu-id="9afee-222">Para obtener más información, consulte la guía de la [API de ASP.net signalr hubs](../guide-to-the-api/hubs-api-guide-server.md).</span><span class="sxs-lookup"><span data-stu-id="9afee-222">For more information, refer to [ASP.NET SignalR Hubs API Guide](../guide-to-the-api/hubs-api-guide-server.md).</span></span>
11. <span data-ttu-id="9afee-223">Abra la página **TriviaController.CS** dentro de la carpeta **Controllers** y agregue las siguientes directivas using.</span><span class="sxs-lookup"><span data-stu-id="9afee-223">Open the **TriviaController.cs** page inside the **Controllers** folder and add the following using directives.</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample7.cs)]
12. <span data-ttu-id="9afee-224">Agregue el siguiente código resaltado al método de acción **post** .</span><span class="sxs-lookup"><span data-stu-id="9afee-224">Add the following highlighted code to the **Post** action method.</span></span>

    <span data-ttu-id="9afee-225">(Fragmento de código- *RealTimeSignalR-EX1-NotifyUpdatesCall*)</span><span class="sxs-lookup"><span data-stu-id="9afee-225">(Code Snippet - *RealTimeSignalR - Ex1 - NotifyUpdatesCall*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample8.cs)]
13. <span data-ttu-id="9afee-226">Abra la página **Statistics. cshtml** dentro de las **vistas | Carpeta particular** .</span><span class="sxs-lookup"><span data-stu-id="9afee-226">Open the **Statistics.cshtml** page inside the **Views | Home** folder.</span></span> <span data-ttu-id="9afee-227">Busque la sección **scripts** y agregue las siguientes referencias de script al principio de la sección.</span><span class="sxs-lookup"><span data-stu-id="9afee-227">Locate the **Scripts** section and add the following script references at the beginning of the section.</span></span>

    <span data-ttu-id="9afee-228">(Fragmento de código- *RealTimeSignalR-EX1-SignalRScriptReferences*)</span><span class="sxs-lookup"><span data-stu-id="9afee-228">(Code Snippet - *RealTimeSignalR - Ex1 - SignalRScriptReferences*)</span></span>

    [!code-cshtml[Main](real-time-web-applications-with-signalr/samples/sample9.cshtml)]

    > [!NOTE]
    > <span data-ttu-id="9afee-229">Al agregar Signalr y otras bibliotecas de scripts al proyecto de Visual Studio, el administrador de paquetes puede instalar una versión del archivo de script de Signalr más reciente que la versión que se muestra en este tema.</span><span class="sxs-lookup"><span data-stu-id="9afee-229">When you add SignalR and other script libraries to your Visual Studio project, the Package Manager might install a version of the SignalR script file that is more recent than the version shown in this topic.</span></span> <span data-ttu-id="9afee-230">Asegúrese de que la referencia de script en el código coincide con la versión de la biblioteca de scripts instalada en el proyecto.</span><span class="sxs-lookup"><span data-stu-id="9afee-230">Make sure that the script reference in your code matches the version of the script library installed in your project.</span></span>
14. <span data-ttu-id="9afee-231">Agregue el siguiente código resaltado para conectar el cliente al concentrador de Signalr y actualizar los datos de estadísticas cuando se recibe un mensaje nuevo desde el centro.</span><span class="sxs-lookup"><span data-stu-id="9afee-231">Add the following highlighted code to connect the client to the SignalR hub and update the statistics data when a new message is received from the hub.</span></span>

    <span data-ttu-id="9afee-232">(Fragmento de código- *RealTimeSignalR-EX1-SignalRClientCode*)</span><span class="sxs-lookup"><span data-stu-id="9afee-232">(Code Snippet - *RealTimeSignalR - Ex1 - SignalRClientCode*)</span></span>

    [!code-cshtml[Main](real-time-web-applications-with-signalr/samples/sample10.cshtml)]

    <span data-ttu-id="9afee-233">En este código, se crea un proxy de concentrador y se registra un controlador de eventos para escuchar los mensajes enviados por el servidor.</span><span class="sxs-lookup"><span data-stu-id="9afee-233">In this code, you are creating a Hub Proxy and registering an event handler to listen for messages sent by the server.</span></span> <span data-ttu-id="9afee-234">En este caso, escucha los mensajes enviados a través del método *updateStatistics* .</span><span class="sxs-lookup"><span data-stu-id="9afee-234">In this case, you listen for messages sent through the *updateStatistics* method.</span></span>

<a id="Ex1Task3"></a>
#### <a name="task-3--running-the-solution"></a><span data-ttu-id="9afee-235">Tarea 3: ejecución de la solución</span><span class="sxs-lookup"><span data-stu-id="9afee-235">Task 3 – Running the Solution</span></span>

<span data-ttu-id="9afee-236">En esta tarea, ejecutará la solución para comprobar que la vista de estadísticas se actualiza automáticamente mediante Signalr después de responder a una nueva pregunta.</span><span class="sxs-lookup"><span data-stu-id="9afee-236">In this task, you will run the solution to verify that the statistics view is updated automatically using SignalR after answering a new question.</span></span>

1. <span data-ttu-id="9afee-237">Presione **F5** para ejecutar la solución.</span><span class="sxs-lookup"><span data-stu-id="9afee-237">Press **F5** to run the solution.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9afee-238">Si aún no ha iniciado sesión en la aplicación, inicie sesión con el usuario que creó en la tarea 1.</span><span class="sxs-lookup"><span data-stu-id="9afee-238">If not already logged in to the application, log in with the user you created in Task 1.</span></span>
2. <span data-ttu-id="9afee-239">Abra la página **estadísticas** en una nueva ventana y coloque la página **principal** y la página de **estadísticas** en paralelo como hizo en la tarea 1.</span><span class="sxs-lookup"><span data-stu-id="9afee-239">Open the **Statistics** page in a new window and put the **Home** page and **Statistics** page side-by-side as you did in Task 1.</span></span>
3. <span data-ttu-id="9afee-240">En la página **principal** , haga clic en una de las opciones para responder a la pregunta.</span><span class="sxs-lookup"><span data-stu-id="9afee-240">In the **Home** page, answer the question by clicking one of the options.</span></span>

    <span data-ttu-id="9afee-241">![Responder a otra pregunta](real-time-web-applications-with-signalr/_static/image13.png "Responder a otra pregunta")</span><span class="sxs-lookup"><span data-stu-id="9afee-241">![Answering another question](real-time-web-applications-with-signalr/_static/image13.png "Answering another question")</span></span>

    <span data-ttu-id="9afee-242">*Responder a otra pregunta*</span><span class="sxs-lookup"><span data-stu-id="9afee-242">*Answering another question*</span></span>
4. <span data-ttu-id="9afee-243">Después de hacer clic en uno de los botones, debe aparecer la respuesta.</span><span class="sxs-lookup"><span data-stu-id="9afee-243">After clicking one of the buttons, the answer should appear.</span></span> <span data-ttu-id="9afee-244">Tenga en cuenta que la información de estadísticas de la página se actualiza automáticamente después de responder a la pregunta con la información actualizada sin necesidad de actualizar toda la página.</span><span class="sxs-lookup"><span data-stu-id="9afee-244">Notice that the Statistics information on the page is updated automatically after answering the question with the updated information without the need to refresh the entire page.</span></span>

    <span data-ttu-id="9afee-245">![Página de estadísticas actualizada después de la respuesta](real-time-web-applications-with-signalr/_static/image14.png "Página de estadísticas actualizada después de la respuesta")</span><span class="sxs-lookup"><span data-stu-id="9afee-245">![Statistics page refreshed after answer](real-time-web-applications-with-signalr/_static/image14.png "Statistics page refreshed after answer")</span></span>

    <span data-ttu-id="9afee-246">*Página de estadísticas actualizada después de la respuesta*</span><span class="sxs-lookup"><span data-stu-id="9afee-246">*Statistics page refreshed after answer*</span></span>

<a id="Exercise2"></a>
### <a name="exercise-2-scaling-out-using-sql-server"></a><span data-ttu-id="9afee-247">Ejercicio 2: escalado horizontal con SQL Server</span><span class="sxs-lookup"><span data-stu-id="9afee-247">Exercise 2: Scaling Out Using SQL Server</span></span>

<span data-ttu-id="9afee-248">Al escalar una aplicación Web, normalmente puede elegir entre las opciones *de escalado* vertical y *escalado* horizontal.</span><span class="sxs-lookup"><span data-stu-id="9afee-248">When scaling a web application, you can generally choose between *scaling up* and *scaling out* options.</span></span> <span data-ttu-id="9afee-249">*Escalar* verticalmente significa usar un servidor mayor, con más recursos (CPU, RAM, etc.), mientras que el *escalado horizontal* significa agregar más servidores para controlar la carga.</span><span class="sxs-lookup"><span data-stu-id="9afee-249">*Scale up* means using a larger server, with more resources (CPU, RAM, etc.) while *scale out* means adding more servers to handle the load.</span></span> <span data-ttu-id="9afee-250">El problema con este último es que los clientes se pueden enrutar a diferentes servidores.</span><span class="sxs-lookup"><span data-stu-id="9afee-250">The problem with the latter is that the clients can get routed to different servers.</span></span> <span data-ttu-id="9afee-251">Un cliente que está conectado a un servidor no recibirá los mensajes enviados desde otro servidor.</span><span class="sxs-lookup"><span data-stu-id="9afee-251">A client that is connected to one server will not receive messages sent from another server.</span></span>

<span data-ttu-id="9afee-252">Puede resolver estos problemas mediante un componente denominado *backplane*, para reenviar mensajes entre servidores.</span><span class="sxs-lookup"><span data-stu-id="9afee-252">You can solve these issues by using a component called *backplane*, to forward messages between servers.</span></span> <span data-ttu-id="9afee-253">Con un backplane habilitado, cada instancia de aplicación envía mensajes al plano posterior y el plano posterior los reenvía a las otras instancias de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="9afee-253">With a backplane enabled, each application instance sends messages to the backplane, and the backplane forwards them to the other application instances.</span></span>

<span data-ttu-id="9afee-254">Actualmente hay tres tipos de Backplanes para Signalr:</span><span class="sxs-lookup"><span data-stu-id="9afee-254">There are currently three types of backplanes for SignalR:</span></span>

- <span data-ttu-id="9afee-255">**Azure Service Bus de Windows**.</span><span class="sxs-lookup"><span data-stu-id="9afee-255">**Windows Azure Service Bus**.</span></span> <span data-ttu-id="9afee-256">Service Bus es una infraestructura de mensajería que permite a los componentes enviar mensajes de acoplamiento flexible.</span><span class="sxs-lookup"><span data-stu-id="9afee-256">Service Bus is a messaging infrastructure that allows components to send loosely coupled messages.</span></span>
- <span data-ttu-id="9afee-257">**SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="9afee-257">**SQL Server**.</span></span> <span data-ttu-id="9afee-258">El backplane SQL Server escribe mensajes en las tablas SQL.</span><span class="sxs-lookup"><span data-stu-id="9afee-258">The SQL Server backplane writes messages to SQL tables.</span></span> <span data-ttu-id="9afee-259">El backplane usa Service Broker para la mensajería eficaz.</span><span class="sxs-lookup"><span data-stu-id="9afee-259">The backplane uses Service Broker for efficient messaging.</span></span> <span data-ttu-id="9afee-260">Sin embargo, también funciona si Service Broker no está habilitado.</span><span class="sxs-lookup"><span data-stu-id="9afee-260">However, it also works if Service Broker is not enabled.</span></span>
- <span data-ttu-id="9afee-261">**Redis**.</span><span class="sxs-lookup"><span data-stu-id="9afee-261">**Redis**.</span></span> <span data-ttu-id="9afee-262">Redis es un almacén de clave-valor en memoria.</span><span class="sxs-lookup"><span data-stu-id="9afee-262">Redis is an in-memory key-value store.</span></span> <span data-ttu-id="9afee-263">Redis admite un patrón de publicación/suscripción ("pub/sub") para enviar mensajes.</span><span class="sxs-lookup"><span data-stu-id="9afee-263">Redis supports a publish/subscribe ("pub/sub") pattern for sending messages.</span></span>

<span data-ttu-id="9afee-264">Cada mensaje se envía a través de un bus de mensajes.</span><span class="sxs-lookup"><span data-stu-id="9afee-264">Every message is sent through a message bus.</span></span> <span data-ttu-id="9afee-265">Un bus de mensajes implementa la interfaz [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) , que proporciona una abstracción de publicación/suscripción.</span><span class="sxs-lookup"><span data-stu-id="9afee-265">A message bus implements the [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) interface, which provides a publish/subscribe abstraction.</span></span> <span data-ttu-id="9afee-266">Los Backplanes funcionan reemplazando el valor predeterminado de **IMessageBus** por un bus diseñado para ese backplane.</span><span class="sxs-lookup"><span data-stu-id="9afee-266">The backplanes work by replacing the default **IMessageBus** with a bus designed for that backplane.</span></span>

<span data-ttu-id="9afee-267">Cada instancia de servidor se conecta al plano posterior a través del bus.</span><span class="sxs-lookup"><span data-stu-id="9afee-267">Each server instance connects to the backplane through the bus.</span></span> <span data-ttu-id="9afee-268">Cuando se envía un mensaje, se dirige al backplane y el plano posterior lo envía a todos los servidores.</span><span class="sxs-lookup"><span data-stu-id="9afee-268">When a message is sent, it goes to the backplane, and the backplane sends it to every server.</span></span> <span data-ttu-id="9afee-269">Cuando un servidor recibe un mensaje del plano posterior, lo almacena en la memoria caché local.</span><span class="sxs-lookup"><span data-stu-id="9afee-269">When a server receives a message from the backplane, it stores the message in its local cache.</span></span> <span data-ttu-id="9afee-270">A continuación, el servidor entrega mensajes a los clientes desde su caché local.</span><span class="sxs-lookup"><span data-stu-id="9afee-270">The server then delivers messages to clients from its local cache.</span></span>

<span data-ttu-id="9afee-271">Para obtener más información sobre cómo funciona el backplane Signalr, lea este [artículo](../performance/scaleout-in-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="9afee-271">For more information about how the SignalR backplane works, read this [article](../performance/scaleout-in-signalr.md).</span></span>

> [!NOTE]
> <span data-ttu-id="9afee-272">Hay algunos escenarios en los que un backplane puede convertirse en un cuello de botella.</span><span class="sxs-lookup"><span data-stu-id="9afee-272">There are some scenarios where a backplane can become a bottleneck.</span></span> <span data-ttu-id="9afee-273">Estos son algunos escenarios típicos de Signalr:</span><span class="sxs-lookup"><span data-stu-id="9afee-273">Here are some typical SignalR scenarios:</span></span>
> 
> - <span data-ttu-id="9afee-274">[Difusión del servidor](tutorial-server-broadcast-with-signalr.md) (por ejemplo, el tablero de cotizaciones): los Backplanes funcionan bien en este escenario, ya que el servidor controla la velocidad a la que se envían los mensajes.</span><span class="sxs-lookup"><span data-stu-id="9afee-274">[Server broadcast](tutorial-server-broadcast-with-signalr.md) (e.g., stock ticker): Backplanes work well for this scenario, because the server controls the rate at which messages are sent.</span></span>
> - <span data-ttu-id="9afee-275">[Cliente a cliente](tutorial-getting-started-with-signalr.md) (por ejemplo, chat): en este escenario, el backplane podría ser un cuello de botella si el número de mensajes se escala con el número de clientes; es decir, si la tasa de mensajes aumenta proporcionalmente a medida que se unen más clientes.</span><span class="sxs-lookup"><span data-stu-id="9afee-275">[Client-to-client](tutorial-getting-started-with-signalr.md) (e.g., chat): In this scenario, the backplane might be a bottleneck if the number of messages scales with the number of clients; that is, if the rate of messages grows proportionally as more clients join.</span></span>
> - <span data-ttu-id="9afee-276">[Alta frecuencia en tiempo real](tutorial-high-frequency-realtime-with-signalr.md) (por ejemplo, juegos en tiempo real): no se recomienda un backplane para este escenario.</span><span class="sxs-lookup"><span data-stu-id="9afee-276">[High-frequency realtime](tutorial-high-frequency-realtime-with-signalr.md) (e.g., real-time games): A backplane is not recommended for this scenario.</span></span>

<span data-ttu-id="9afee-277">En este ejercicio, usará **SQL Server** para distribuir los mensajes a través de la aplicación de prueba de los **fanáticos** .</span><span class="sxs-lookup"><span data-stu-id="9afee-277">In this exercise, you will use **SQL Server** to distribute messages across the **Geek Quiz** application.</span></span> <span data-ttu-id="9afee-278">Estas tareas se ejecutarán en una única máquina de pruebas para aprender a configurar la configuración, pero para obtener el efecto completo, deberá implementar la aplicación Signalr en dos o más servidores.</span><span class="sxs-lookup"><span data-stu-id="9afee-278">You will run these tasks on a single test machine to learn how to set up the configuration, but in order to get the full effect, you will need to deploy the SignalR application to two or more servers.</span></span> <span data-ttu-id="9afee-279">También debe instalar SQL Server en uno de los servidores o en un servidor dedicado independiente.</span><span class="sxs-lookup"><span data-stu-id="9afee-279">You must also install SQL Server on one of the servers, or on a separate dedicated server.</span></span>

![Escalabilidad horizontal mediante SQL Server diagrama](real-time-web-applications-with-signalr/_static/image15.png)

<a id="Ex2Task1"></a>
#### <a name="task-1---understanding-the-scenario"></a><span data-ttu-id="9afee-281">Tarea 1: Descripción del escenario</span><span class="sxs-lookup"><span data-stu-id="9afee-281">Task 1 - Understanding the Scenario</span></span>

<span data-ttu-id="9afee-282">En esta tarea, ejecutará dos instancias de la **prueba de experto** en la simulación de varias instancias de IIS en el equipo local.</span><span class="sxs-lookup"><span data-stu-id="9afee-282">In this task, you will run 2 instances of **Geek Quiz** simulating multiple IIS instances on your local machine.</span></span> <span data-ttu-id="9afee-283">En este escenario, al responder a las preguntas Curiosidades en una aplicación, no se notificará a la actualización en la página estadísticas de la segunda instancia.</span><span class="sxs-lookup"><span data-stu-id="9afee-283">In this scenario, when answering trivia questions on one application, update won't be notified on the statistics page of the second instance.</span></span> <span data-ttu-id="9afee-284">Esta simulación es similar a un entorno en el que la aplicación se implementa en varias instancias y con un equilibrador de carga para comunicarse con ellas.</span><span class="sxs-lookup"><span data-stu-id="9afee-284">This simulation resembles an environment where your application is deployed on multiple instances and using a load balancer to communicate with them.</span></span>

1. <span data-ttu-id="9afee-285">Abra la solución **Begin. sln** que se encuentra en la carpeta **source/Ex2-ScalingOutWithSQLServer/Begin** .</span><span class="sxs-lookup"><span data-stu-id="9afee-285">Open the **Begin.sln** solution located in the **Source/Ex2-ScalingOutWithSQLServer/Begin** folder.</span></span> <span data-ttu-id="9afee-286">Una vez cargados, observará en el **Explorador de servidores** que la solución tiene dos proyectos con estructuras idénticas pero nombres diferentes.</span><span class="sxs-lookup"><span data-stu-id="9afee-286">Once loaded, you will notice on the **Server Explorer** that the solution has two projects with identical structures but different names.</span></span> <span data-ttu-id="9afee-287">Esto simulará la ejecución de dos instancias de la misma aplicación en el equipo local.</span><span class="sxs-lookup"><span data-stu-id="9afee-287">This will simulate running two instances of the same application on your local machine.</span></span>

    <span data-ttu-id="9afee-288">![Comenzar la solución simulando 2 instancias de una prueba de experto](real-time-web-applications-with-signalr/_static/image16.png "Comenzar la solución simulando 2 instancias de una prueba de experto")</span><span class="sxs-lookup"><span data-stu-id="9afee-288">![Begin Solution Simulating 2 Instances of Geek Quiz](real-time-web-applications-with-signalr/_static/image16.png "Begin Solution Simulating 2 Instances of Geek Quiz")</span></span>

    <span data-ttu-id="9afee-289">*Comenzar la solución simulando 2 instancias de una prueba de experto*</span><span class="sxs-lookup"><span data-stu-id="9afee-289">*Begin Solution Simulating 2 Instances of Geek Quiz*</span></span>
2. <span data-ttu-id="9afee-290">Abra la página de propiedades de la solución haciendo clic con el botón secundario en el nodo de la solución y seleccionando **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="9afee-290">Open the properties page of the solution by right-clicking the solution node and selecting **Properties**.</span></span> <span data-ttu-id="9afee-291">En **proyecto de inicio**, seleccione **proyectos de inicio múltiples** y cambie el valor de la **acción** de ambos proyectos a *iniciar*.</span><span class="sxs-lookup"><span data-stu-id="9afee-291">Under **Startup Project**, select **Multiple startup projects** and change the **Action** value for both projects to *Start*.</span></span>

    <span data-ttu-id="9afee-292">![Iniciar varios proyectos](real-time-web-applications-with-signalr/_static/image17.png "Iniciar varios proyectos")</span><span class="sxs-lookup"><span data-stu-id="9afee-292">![Starting Multiple Projects](real-time-web-applications-with-signalr/_static/image17.png "Starting Multiple Projects")</span></span>

    <span data-ttu-id="9afee-293">*Iniciar varios proyectos*</span><span class="sxs-lookup"><span data-stu-id="9afee-293">*Starting Multiple Projects*</span></span>
3. <span data-ttu-id="9afee-294">Presione **F5** para ejecutar la solución.</span><span class="sxs-lookup"><span data-stu-id="9afee-294">Press **F5** to run the solution.</span></span> <span data-ttu-id="9afee-295">La aplicación iniciará dos instancias de una **prueba** integrada en diferentes puertos y simulará varias instancias de la misma aplicación.</span><span class="sxs-lookup"><span data-stu-id="9afee-295">The application will launch two instances of **Geek Quiz** in different ports, simulating multiple instances of the same application.</span></span> <span data-ttu-id="9afee-296">Ancle uno de los exploradores a la izquierda y el otro a la derecha de la pantalla.</span><span class="sxs-lookup"><span data-stu-id="9afee-296">Pin one of the browsers on left and the other on the right of your screen.</span></span> <span data-ttu-id="9afee-297">Inicie sesión con sus credenciales o registre un nuevo usuario.</span><span class="sxs-lookup"><span data-stu-id="9afee-297">Log in with your credentials or register a new user.</span></span> <span data-ttu-id="9afee-298">Una vez que haya iniciado sesión, mantenga la página de curiosidades a la izquierda y vaya a la página de **estadísticas** en el explorador de la derecha.</span><span class="sxs-lookup"><span data-stu-id="9afee-298">Once logged in, keep the Trivia page on the left and go to the **Statistics** page in the browser on the right.</span></span>

    ![Prueba de los fanáticos en paralelo](real-time-web-applications-with-signalr/_static/image18.png)

    <span data-ttu-id="9afee-300">*Prueba de los fanáticos en paralelo*</span><span class="sxs-lookup"><span data-stu-id="9afee-300">*Geek Quiz Side by Side*</span></span>

    ![Prueba integrada en distintos puertos](real-time-web-applications-with-signalr/_static/image19.png)

    <span data-ttu-id="9afee-302">*Prueba integrada en distintos puertos*</span><span class="sxs-lookup"><span data-stu-id="9afee-302">*Geek Quiz in Different Ports*</span></span>
4. <span data-ttu-id="9afee-303">Empiece a responder a preguntas en el explorador izquierdo y observará que la página de **estadísticas** del explorador derecho no se está actualizando.</span><span class="sxs-lookup"><span data-stu-id="9afee-303">Start answering questions in the left browser and you will notice that the **Statistics** page in the right browser is not being updated.</span></span> <span data-ttu-id="9afee-304">Esto se debe a que **signalr** usa una memoria caché local para distribuir los mensajes entre sus clientes y este escenario está simulando varias instancias, por lo que la memoria caché no se comparte entre ellas.</span><span class="sxs-lookup"><span data-stu-id="9afee-304">This is because **SignalR** uses a local cache to distribute messages across their clients and this scenario is simulating multiple instances, therefore the cache is not shared between them.</span></span> <span data-ttu-id="9afee-305">Puede comprobar que **signalr** funciona probando los mismos pasos, pero usando una sola aplicación.</span><span class="sxs-lookup"><span data-stu-id="9afee-305">You can verify that **SignalR** is working by testing the same steps but using a single app.</span></span> <span data-ttu-id="9afee-306">En las tareas siguientes, configurará un backplane para replicar los mensajes entre las instancias.</span><span class="sxs-lookup"><span data-stu-id="9afee-306">In the following tasks you will configure a backplane to replicate the messages across instances.</span></span>
5. <span data-ttu-id="9afee-307">Vuelva a Visual Studio y detenga la depuración.</span><span class="sxs-lookup"><span data-stu-id="9afee-307">Go back to Visual Studio and stop debugging.</span></span>

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-the-sql-server-backplane"></a><span data-ttu-id="9afee-308">Tarea 2: crear el backplane SQL Server</span><span class="sxs-lookup"><span data-stu-id="9afee-308">Task 2 – Creating the SQL Server Backplane</span></span>

<span data-ttu-id="9afee-309">En esta tarea, creará una base de datos que servirá como un plano posterior para la aplicación de **prueba** de la que se trata.</span><span class="sxs-lookup"><span data-stu-id="9afee-309">In this task, you will create a database that will serve as a backplane for the **Geek Quiz** application.</span></span> <span data-ttu-id="9afee-310">Usará **Explorador de objetos de SQL Server** para examinar el servidor e inicializar la base de datos.</span><span class="sxs-lookup"><span data-stu-id="9afee-310">You will use **SQL Server Object Explorer** to browse your server and initialize the database.</span></span> <span data-ttu-id="9afee-311">Además, habilitará el **Service Broker**.</span><span class="sxs-lookup"><span data-stu-id="9afee-311">Additionally, you will enable the **Service Broker**.</span></span>

1. <span data-ttu-id="9afee-312">En **Visual Studio**, abra la **vista** de menú y seleccione **Explorador de objetos de SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="9afee-312">In **Visual Studio**, open menu **View** and select **SQL Server Object Explorer**.</span></span>
2. <span data-ttu-id="9afee-313">Conéctese a la instancia de LocalDB haciendo clic con el botón secundario en el nodo **SQL Server** y seleccionando la opción **Agregar SQL Server...** .</span><span class="sxs-lookup"><span data-stu-id="9afee-313">Connect to your LocalDB instance by right-clicking the **SQL Server** node and selecting **Add SQL Server...** option.</span></span>

    <span data-ttu-id="9afee-314">![Agregar una instancia de SQL Server](real-time-web-applications-with-signalr/_static/image20.png "Agregar una instancia de SQL Server")</span><span class="sxs-lookup"><span data-stu-id="9afee-314">![Adding a SQL Server Instance](real-time-web-applications-with-signalr/_static/image20.png "Adding a SQL Server Instance")</span></span>

    <span data-ttu-id="9afee-315">*Agregar una instancia de SQL Server a Explorador de objetos de SQL Server*</span><span class="sxs-lookup"><span data-stu-id="9afee-315">*Adding a SQL Server instance to SQL Server Object Explorer*</span></span>
3. <span data-ttu-id="9afee-316">Establezca el **nombre del servidor** en *(LocalDB) \v11.0* y deje la **autenticación de Windows** como modo de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9afee-316">Set the **server name** to *(localdb)\v11.0* and leave **Windows Authentication** as your authentication mode.</span></span> <span data-ttu-id="9afee-317">Haga clic en **Conectar** para continuar.</span><span class="sxs-lookup"><span data-stu-id="9afee-317">Click **Connect** to continue.</span></span>

    <span data-ttu-id="9afee-318">![Conectar con LocalDB](real-time-web-applications-with-signalr/_static/image21.png "Conectar con LocalDB")</span><span class="sxs-lookup"><span data-stu-id="9afee-318">![Connecting to LocalDB](real-time-web-applications-with-signalr/_static/image21.png "Connecting to LocalDB")</span></span>

    <span data-ttu-id="9afee-319">*Conectar con LocalDB*</span><span class="sxs-lookup"><span data-stu-id="9afee-319">*Connecting to LocalDB*</span></span>
4. <span data-ttu-id="9afee-320">Ahora que está conectado a la instancia de LocalDB, tendrá que crear una base de datos que represente el SQL Server backplane de Signalr.</span><span class="sxs-lookup"><span data-stu-id="9afee-320">Now that you are connected to your LocalDB instance, you will need to create a database that will represent the SQL Server backplane for SignalR.</span></span> <span data-ttu-id="9afee-321">Para ello, haga clic con el botón secundario en el nodo **bases** de **datos y seleccione Agregar nueva base de datos**.</span><span class="sxs-lookup"><span data-stu-id="9afee-321">To do this, right-click the **Databases** node and select **Add New Database**.</span></span>

    <span data-ttu-id="9afee-322">![Agregar una nueva base de datos](real-time-web-applications-with-signalr/_static/image22.png "Agregar una nueva base de datos")</span><span class="sxs-lookup"><span data-stu-id="9afee-322">![Adding a new database](real-time-web-applications-with-signalr/_static/image22.png "Adding a new database")</span></span>

    <span data-ttu-id="9afee-323">*Agregar una nueva base de datos*</span><span class="sxs-lookup"><span data-stu-id="9afee-323">*Adding a new database*</span></span>
5. <span data-ttu-id="9afee-324">Establezca el nombre de la base de datos en *signalr* y haga clic en **Aceptar** para crearlo.</span><span class="sxs-lookup"><span data-stu-id="9afee-324">Set the database name to *SignalR* and click **OK** to create it.</span></span>

    <span data-ttu-id="9afee-325">![Crear la base de datos de Signalr](real-time-web-applications-with-signalr/_static/image23.png "Crear la base de datos de Signalr")</span><span class="sxs-lookup"><span data-stu-id="9afee-325">![Creating the SignalR database](real-time-web-applications-with-signalr/_static/image23.png "Creating the SignalR database")</span></span>

    <span data-ttu-id="9afee-326">*Crear la base de datos de Signalr*</span><span class="sxs-lookup"><span data-stu-id="9afee-326">*Creating the SignalR database*</span></span>

    > [!NOTE]
    > <span data-ttu-id="9afee-327">Puede elegir cualquier nombre para la base de datos.</span><span class="sxs-lookup"><span data-stu-id="9afee-327">You can choose any name for the database.</span></span>
6. <span data-ttu-id="9afee-328">Para recibir actualizaciones de forma más eficaz desde el backplane, se recomienda habilitar Service Broker para la base de datos.</span><span class="sxs-lookup"><span data-stu-id="9afee-328">To receive updates more efficiently from the backplane, it is recommended to enable Service Broker for the database.</span></span> <span data-ttu-id="9afee-329">Service Broker proporciona compatibilidad nativa para mensajería y puesta en cola en SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9afee-329">Service Broker provides native support for messaging and queuing in SQL Server.</span></span> <span data-ttu-id="9afee-330">El backplane también funciona sin Service Broker.</span><span class="sxs-lookup"><span data-stu-id="9afee-330">The backplane also works without Service Broker.</span></span> <span data-ttu-id="9afee-331">Abra una nueva consulta; para ello, haga clic con el botón secundario en la base de datos y seleccione **nueva consulta**.</span><span class="sxs-lookup"><span data-stu-id="9afee-331">Open a new query by right-clicking the database and select **New Query**.</span></span>

    <span data-ttu-id="9afee-332">![Abrir una nueva consulta](real-time-web-applications-with-signalr/_static/image24.png "Abrir una nueva consulta")</span><span class="sxs-lookup"><span data-stu-id="9afee-332">![Opening a New Query](real-time-web-applications-with-signalr/_static/image24.png "Opening a New Query")</span></span>

    <span data-ttu-id="9afee-333">*Abrir una nueva consulta*</span><span class="sxs-lookup"><span data-stu-id="9afee-333">*Opening a New Query*</span></span>
7. <span data-ttu-id="9afee-334">Para comprobar si Service Broker está habilitado, consulte la columna **is\_broker\_Enabled** en la vista de catálogo **Sys. Databases** .</span><span class="sxs-lookup"><span data-stu-id="9afee-334">To check whether Service Broker is enabled, query the **is\_broker\_enabled** column in the **sys.databases** catalog view.</span></span> <span data-ttu-id="9afee-335">Ejecute el siguiente script en la ventana de consulta abierta recientemente.</span><span class="sxs-lookup"><span data-stu-id="9afee-335">Execute the following script in the recently opened query window.</span></span>

    [!code-sql[Main](real-time-web-applications-with-signalr/samples/sample11.sql)]

    <span data-ttu-id="9afee-336">![Consulta del estado de la Service Broker](real-time-web-applications-with-signalr/_static/image25.png "Consulta del estado de la Service Broker")</span><span class="sxs-lookup"><span data-stu-id="9afee-336">![Querying the Service Broker Status](real-time-web-applications-with-signalr/_static/image25.png "Querying the Service Broker Status")</span></span>

    <span data-ttu-id="9afee-337">*Consulta del estado de la Service Broker*</span><span class="sxs-lookup"><span data-stu-id="9afee-337">*Querying the Service Broker Status*</span></span>
8. <span data-ttu-id="9afee-338">Si el valor de la columna **está\_broker\_habilitado** en la base de datos es &quot;0&quot;, use el siguiente comando para habilitarlo.</span><span class="sxs-lookup"><span data-stu-id="9afee-338">If the value of the **is\_broker\_enabled** column in your database is &quot;0&quot;, use the following command to enable it.</span></span> <span data-ttu-id="9afee-339">Reemplace **&lt;la base de datos&gt;** por el nombre que estableció al crear la base de datos (por ejemplo: signalr).</span><span class="sxs-lookup"><span data-stu-id="9afee-339">Replace **&lt;YOUR-DATABASE&gt;** with the name you set when creating the database (e.g.: SignalR).</span></span>

    [!code-sql[Main](real-time-web-applications-with-signalr/samples/sample12.sql)]

    <span data-ttu-id="9afee-340">![Habilitar Service Broker](real-time-web-applications-with-signalr/_static/image26.png "Habilitar Service Broker")</span><span class="sxs-lookup"><span data-stu-id="9afee-340">![Enabling Service Broker](real-time-web-applications-with-signalr/_static/image26.png "Enabling Service Broker")</span></span>

    <span data-ttu-id="9afee-341">*Habilitar Service Broker*</span><span class="sxs-lookup"><span data-stu-id="9afee-341">*Enabling Service Broker*</span></span>

    > [!NOTE]
    > <span data-ttu-id="9afee-342">Si esta consulta aparece en interbloqueo, asegúrese de que no haya ninguna aplicación conectada a la base de BD.</span><span class="sxs-lookup"><span data-stu-id="9afee-342">If this query appears to deadlock, make sure there are no applications connected to the DB.</span></span>

<a id="Ex2Task3"></a>
#### <a name="task-3--configuring-the-signalr-application"></a><span data-ttu-id="9afee-343">Tarea 3: configuración de la aplicación Signalr</span><span class="sxs-lookup"><span data-stu-id="9afee-343">Task 3 – Configuring the SignalR Application</span></span>

<span data-ttu-id="9afee-344">En esta tarea, configurará una **prueba de experto** para conectarse al backplane SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9afee-344">In this task, you will configure **Geek Quiz** to connect to the SQL Server backplane.</span></span> <span data-ttu-id="9afee-345">En primer lugar, agregará el paquete NuGet **signalr. SqlServer** y establecerá la cadena de conexión en la base de datos de backplane.</span><span class="sxs-lookup"><span data-stu-id="9afee-345">You will first add the **SignalR.SqlServer** NuGet package and set the connection string to your backplane database.</span></span>

1. <span data-ttu-id="9afee-346">Abra la **consola del administrador de paquetes** desde **herramientas** > **Administrador de paquetes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="9afee-346">Open the **Package Manager Console** from **Tools** > **NuGet Package Manager**.</span></span> <span data-ttu-id="9afee-347">Asegúrese de que el proyecto **GeekQuiz** está seleccionado en la lista desplegable **proyecto predeterminado** .</span><span class="sxs-lookup"><span data-stu-id="9afee-347">Make sure that **GeekQuiz** project is selected in the **Default project** drop-down list.</span></span> <span data-ttu-id="9afee-348">Escriba el siguiente comando para instalar el paquete NuGet **Microsoft. Aspnet. signalr. SqlServer** .</span><span class="sxs-lookup"><span data-stu-id="9afee-348">Type the following command to install the **Microsoft.AspNet.SignalR.SqlServer** NuGet package.</span></span>

    [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample13.ps1)]
2. <span data-ttu-id="9afee-349">Repita el paso anterior, pero esta vez para el proyecto **GeekQuiz2**.</span><span class="sxs-lookup"><span data-stu-id="9afee-349">Repeat the previous step but this time for project **GeekQuiz2**.</span></span>
3. <span data-ttu-id="9afee-350">Para configurar la SQL Server backplane, abra el archivo **Startup.CS** del proyecto **GeekQuiz** y agregue el código siguiente al método **Configure** .</span><span class="sxs-lookup"><span data-stu-id="9afee-350">To configure the SQL Server backplane, open the **Startup.cs** file of the **GeekQuiz** project and add the following code to the **Configure** method.</span></span> <span data-ttu-id="9afee-351">Reemplace **&lt;la base de datos&gt;** por el nombre de la base de datos que usó al crear el backplane SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9afee-351">Replace **&lt;YOUR-DATABASE&gt;** with your database name you used when creating the SQL Server backplane.</span></span> <span data-ttu-id="9afee-352">Repita este paso para el proyecto **GeekQuiz2** .</span><span class="sxs-lookup"><span data-stu-id="9afee-352">Repeat this step for the **GeekQuiz2** project.</span></span>

    <span data-ttu-id="9afee-353">(Fragmento de código- *RealTimeSignalR-Ex2-StartupConfiguration*)</span><span class="sxs-lookup"><span data-stu-id="9afee-353">(Code Snippet - *RealTimeSignalR - Ex2 - StartupConfiguration*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample14.cs)]
4. <span data-ttu-id="9afee-354">Ahora que ambos proyectos están configurados para usar el backplane SQL Server, presione **F5** para ejecutarlos simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="9afee-354">Now that both projects are configured to use the SQL Server backplane, press **F5** to run them simultaneously.</span></span>
5. <span data-ttu-id="9afee-355">De nuevo, **Visual Studio** iniciará dos instancias de una **prueba de experto** en distintos puertos.</span><span class="sxs-lookup"><span data-stu-id="9afee-355">Again, **Visual Studio** will launch two instances of **Geek Quiz** in different ports.</span></span> <span data-ttu-id="9afee-356">Ancle uno de los exploradores de la izquierda y el otro a la derecha de la pantalla e inicie sesión con sus credenciales.</span><span class="sxs-lookup"><span data-stu-id="9afee-356">Pin one of the browsers on the left and the other on the right of your screen and log in with your credentials.</span></span> <span data-ttu-id="9afee-357">Mantenga la página de curiosidades a la izquierda y vaya a la página de **estadísticas** en el explorador adecuado.</span><span class="sxs-lookup"><span data-stu-id="9afee-357">Keep the Trivia page on the left and go to **Statistics** pagein the right browser.</span></span>
6. <span data-ttu-id="9afee-358">Empiece a responder a preguntas en el explorador izquierdo.</span><span class="sxs-lookup"><span data-stu-id="9afee-358">Start answering questions in the left browser.</span></span> <span data-ttu-id="9afee-359">Esta vez, la página de **estadísticas** se actualiza gracias al backplane.</span><span class="sxs-lookup"><span data-stu-id="9afee-359">This time, the **Statistics** page is updated thanks to the backplane.</span></span> <span data-ttu-id="9afee-360">Cambiar entre aplicaciones (las**estadísticas** están ahora a la izquierda y la **curiosidad** está a la derecha) y repetir la prueba para comprobar que funciona para ambas instancias.</span><span class="sxs-lookup"><span data-stu-id="9afee-360">Switch between applications (**Statistics** is now on the left, and **Trivia** is on the right) and repeat the test to validate that it is working for both instances.</span></span> <span data-ttu-id="9afee-361">El backplane actúa como una *caché compartida* de mensajes para cada servidor conectado y cada servidor almacenará los mensajes en su propia memoria caché local para distribuirlos a los clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="9afee-361">The backplane serves as a *shared cache* of messages for each connected server, and each server will store the messages in their own local cache to distribute to connected clients.</span></span>
7. <span data-ttu-id="9afee-362">Vuelva a Visual Studio y detenga la depuración.</span><span class="sxs-lookup"><span data-stu-id="9afee-362">Go back to Visual Studio and stop debugging.</span></span>
8. <span data-ttu-id="9afee-363">El componente de backplane SQL Server genera automáticamente las tablas necesarias en la base de datos especificada.</span><span class="sxs-lookup"><span data-stu-id="9afee-363">The SQL Server backplane component automatically generates the necessary tables on the specified database.</span></span> <span data-ttu-id="9afee-364">En el panel de **Explorador de objetos de SQL Server** , abra la base de datos que creó para el backplane (por ejemplo: signalr) y expanda sus tablas.</span><span class="sxs-lookup"><span data-stu-id="9afee-364">In the **SQL Server Object Explorer** panel, open the database you created for the backplane (e.g.: SignalR) and expand its tables.</span></span> <span data-ttu-id="9afee-365">Debería ver las tablas siguientes:</span><span class="sxs-lookup"><span data-stu-id="9afee-365">You should see the following tables:</span></span>

    ![Tablas generadas por el backplane](real-time-web-applications-with-signalr/_static/image27.png)

    <span data-ttu-id="9afee-367">*Tablas generadas por el backplane*</span><span class="sxs-lookup"><span data-stu-id="9afee-367">*Backplane Generated Tables*</span></span>
9. <span data-ttu-id="9afee-368">Haga clic con el botón derecho en la tabla **signalr. messages\_0** y seleccione **ver datos**.</span><span class="sxs-lookup"><span data-stu-id="9afee-368">Right-click the **SignalR.Messages\_0** table and select **View Data**.</span></span>

    ![Ver tabla de mensajes de backplane de Signalr](real-time-web-applications-with-signalr/_static/image28.png)

    <span data-ttu-id="9afee-370">*Ver tabla de mensajes de backplane de Signalr*</span><span class="sxs-lookup"><span data-stu-id="9afee-370">*View SignalR Backplane Messages Table*</span></span>
10. <span data-ttu-id="9afee-371">Puede ver los distintos mensajes que se envían al **Centro** al responder a las preguntas de curiosidades.</span><span class="sxs-lookup"><span data-stu-id="9afee-371">You can see the different messages sent to the **Hub** when answering the trivia questions.</span></span> <span data-ttu-id="9afee-372">El backplane distribuye estos mensajes a cualquier instancia conectada.</span><span class="sxs-lookup"><span data-stu-id="9afee-372">The backplane distributes these messages to any connected instance.</span></span>

    ![Tabla de mensajes de backplane](real-time-web-applications-with-signalr/_static/image29.png)

    <span data-ttu-id="9afee-374">*Tabla de mensajes de backplane*</span><span class="sxs-lookup"><span data-stu-id="9afee-374">*Backplane Messages Table*</span></span>

---

<a id="Summary"></a>
## <a name="summary"></a><span data-ttu-id="9afee-375">Resumen</span><span class="sxs-lookup"><span data-stu-id="9afee-375">Summary</span></span>

<span data-ttu-id="9afee-376">En este laboratorio práctico, ha aprendido a agregar **signalr** a la aplicación y enviar notificaciones desde el servidor a los clientes conectados mediante **hubs**.</span><span class="sxs-lookup"><span data-stu-id="9afee-376">In this hands-on lab, you have learned how to add **SignalR** to your application and send notifications from the server to your connected clients using **Hubs**.</span></span> <span data-ttu-id="9afee-377">Además, ha aprendido a escalar horizontalmente la aplicación mediante un componente de *backplane* cuando la aplicación se implementa en varias instancias de IIS.</span><span class="sxs-lookup"><span data-stu-id="9afee-377">Additionally, you learned how to scale out your application by using a *backplane* component when your application is deployed in multiple IIS instances.</span></span>
