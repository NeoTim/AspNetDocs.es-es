---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Habilitar las pruebas unitarias automatizadas | Microsoft Docs
author: microsoft
description: Paso 12 muestra cómo desarrollar un conjunto de pruebas unitarias automatizadas que comprueben la funcionalidad de NerdDinner, y que nos proporcionará la confianza para realizar cambios...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: b0c9cd7ab36a8414e0d7d50a68b05bb09a5f24f1
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/17/2019
ms.locfileid: "59387911"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="6701c-103">Habilitar las pruebas unitarias automatizadas</span><span class="sxs-lookup"><span data-stu-id="6701c-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="6701c-104">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="6701c-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="6701c-105">Descargar PDF</span><span class="sxs-lookup"><span data-stu-id="6701c-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="6701c-106">Este es el paso 12 de una segunda oportunidad ["" la aplicación NerdDinner](introducing-the-nerddinner-tutorial.md) que le guía a través cómo compilar un pequeño, pero completa, aplicación web mediante ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="6701c-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="6701c-107">Paso 12 muestra cómo desarrollar un conjunto de pruebas unitarias automatizadas que comprueben la funcionalidad de NerdDinner, y que nos proporcionará la confianza para realizar cambios y mejoras a la aplicación en el futuro.</span><span class="sxs-lookup"><span data-stu-id="6701c-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="6701c-108">Si usa ASP.NET MVC 3, se recomienda que siga el [Introducción a trabajar con MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) o [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutoriales.</span><span class="sxs-lookup"><span data-stu-id="6701c-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="6701c-109">NerdDinner paso 12: Pruebas unitarias</span><span class="sxs-lookup"><span data-stu-id="6701c-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="6701c-110">Vamos a desarrollar un conjunto de pruebas unitarias automatizadas que comprueben la funcionalidad de NerdDinner, y que nos proporcionará la confianza para realizar cambios y mejoras a la aplicación en el futuro.</span><span class="sxs-lookup"><span data-stu-id="6701c-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="6701c-111">¿Por qué prueba unitaria?</span><span class="sxs-lookup"><span data-stu-id="6701c-111">Why Unit Test?</span></span>

<span data-ttu-id="6701c-112">En la unidad en el trabajo una mañana tener flash repentino de inspiración acerca de una aplicación que está trabajando.</span><span class="sxs-lookup"><span data-stu-id="6701c-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="6701c-113">Se dará cuenta que hay que puede implementar un cambio que harán que la aplicación muchísimo mejor.</span><span class="sxs-lookup"><span data-stu-id="6701c-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="6701c-114">Es posible una refactorización que limpia el código, agrega una nueva característica o corrige un error.</span><span class="sxs-lookup"><span data-stu-id="6701c-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="6701c-115">La pregunta al cuando llega al equipo que es: "safe es para realizar esta mejora?"</span><span class="sxs-lookup"><span data-stu-id="6701c-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="6701c-116">¿Qué ocurre si realizar el cambio tiene efectos secundarios o interrumpe algo?</span><span class="sxs-lookup"><span data-stu-id="6701c-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="6701c-117">El cambio podría ser sencillo y tardar solo unos minutos en implementar, pero ¿qué ocurre si tarda horas para probar manualmente todos los escenarios de aplicación?</span><span class="sxs-lookup"><span data-stu-id="6701c-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="6701c-118">¿Qué sucede si olvida cubrir un escenario y una aplicación rota entre en producción?</span><span class="sxs-lookup"><span data-stu-id="6701c-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="6701c-119">¿Está realizando esta mejora realmente vale la pena todo el esfuerzo?</span><span class="sxs-lookup"><span data-stu-id="6701c-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="6701c-120">Pruebas unitarias automatizadas pueden proporcionar una red de seguridad que le permite mejorar continuamente sus aplicaciones y evita deje intimidar por el código que está trabajando.</span><span class="sxs-lookup"><span data-stu-id="6701c-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="6701c-121">Tener las pruebas automatizadas que comprobación rápidamente funcionalidad le permite codificar con total tranquilidad; y le permiten realizar mejoras que es posible que en caso contrario, no se sientan cómodos haciendo.</span><span class="sxs-lookup"><span data-stu-id="6701c-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="6701c-122">También ayudan a crear soluciones que son más fáciles de mantener y tienen una duración más larga - lo que lleva a una mayor rentabilidad de la inversión.</span><span class="sxs-lookup"><span data-stu-id="6701c-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="6701c-123">El marco de MVC de ASP.NET hace fácil y natural a la funcionalidad de aplicación de pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="6701c-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="6701c-124">También permite un flujo de trabajo de desarrollo de controlado por pruebas (TDD) que permite el desarrollo basado en pruebas previas.</span><span class="sxs-lookup"><span data-stu-id="6701c-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="6701c-125">NerdDinner.Tests Project</span><span class="sxs-lookup"><span data-stu-id="6701c-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="6701c-126">Cuando se creó nuestra aplicación NerdDinner al principio de este tutorial, nos estábamos se le solicite un cuadro de diálogo que pregunta si deseamos crear un proyecto de prueba unitaria para continuar con el proyecto de aplicación:</span><span class="sxs-lookup"><span data-stu-id="6701c-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="6701c-127">Se mantiene el "Sí, crear un proyecto de prueba unitaria" botón de radio seleccionado: que dieron lugar a un proyecto de "NerdDinner.Tests" que se va a agregar a nuestra solución:</span><span class="sxs-lookup"><span data-stu-id="6701c-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="6701c-128">El proyecto NerdDinner.Tests hace referencia al ensamblado de proyecto de aplicación NerdDinner y nos permite agregar fácilmente las pruebas automatizadas que comprobar la funcionalidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6701c-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="6701c-129">Crear pruebas unitarias para la clase de modelo cena</span><span class="sxs-lookup"><span data-stu-id="6701c-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="6701c-130">Vamos a agregar algunas pruebas para nuestro proyecto NerdDinner.Tests que comprueban la clase Dinner que hemos creado cuando creamos nuestro nivel de modelo.</span><span class="sxs-lookup"><span data-stu-id="6701c-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="6701c-131">Comenzaremos por crear una carpeta dentro de nuestro proyecto de prueba llamada "Models" donde se colocarán las pruebas relacionadas con el modelo.</span><span class="sxs-lookup"><span data-stu-id="6701c-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="6701c-132">A continuación, se le haga doble clic en la carpeta y elija el **Add -&gt;nueva prueba** comando de menú.</span><span class="sxs-lookup"><span data-stu-id="6701c-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="6701c-133">Se abrirá el cuadro de diálogo "Agregar nueva prueba".</span><span class="sxs-lookup"><span data-stu-id="6701c-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="6701c-134">Decidimos crear una "prueba unitaria" y asígnele el nombre "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="6701c-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="6701c-135">Cuando se haga clic en el botón "Aceptar" Visual Studio agregará (y abrir) un archivo DinnerTest.cs al proyecto:</span><span class="sxs-lookup"><span data-stu-id="6701c-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="6701c-136">La plantilla de prueba unitaria de forma predeterminada Visual Studio tiene una serie de la cantidad de código reutilizable en lo que considero un tanto lioso.</span><span class="sxs-lookup"><span data-stu-id="6701c-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="6701c-137">Vamos a limpiarlo simplemente contenga el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="6701c-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="6701c-138">El atributo [TestClass] en la clase DinnerTest anterior lo identifica como una clase que contendrá las pruebas, así como inicialización de la prueba opcional y el código de desmontaje.</span><span class="sxs-lookup"><span data-stu-id="6701c-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="6701c-139">Podemos definir pruebas dentro de él mediante la adición de métodos públicos que tienen un atributo [TestMethod] sobre ellos.</span><span class="sxs-lookup"><span data-stu-id="6701c-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="6701c-140">A continuación se muestran en el primero de dos pruebas que actúan sobre nuestra clase Dinner vamos a agregar.</span><span class="sxs-lookup"><span data-stu-id="6701c-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="6701c-141">La primera prueba comprueba que nuestro Dinner no es válida si se crea una nueva cena sin todas las propiedades que se establece correctamente.</span><span class="sxs-lookup"><span data-stu-id="6701c-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="6701c-142">La segunda prueba comprueba que nuestro Dinner es válida cuando una cena tiene todas las propiedades establecidas por los valores válidos:</span><span class="sxs-lookup"><span data-stu-id="6701c-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="6701c-143">Anteriormente se dará cuenta que los nombres de prueba son muy explícitas (y detallada).</span><span class="sxs-lookup"><span data-stu-id="6701c-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="6701c-144">Hacemos esto porque se podría acabar crear cientos o miles de pruebas de pequeñas y queremos que sea fácil de determinar rápidamente la intención y el comportamiento de cada uno de ellos (especialmente cuando buscamos a través de una lista de errores en un ejecutor de pruebas).</span><span class="sxs-lookup"><span data-stu-id="6701c-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="6701c-145">Los nombres de prueba deben llamarse después de la funcionalidad que se están probando.</span><span class="sxs-lookup"><span data-stu-id="6701c-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="6701c-146">Anteriormente, usamos un "sustantivo\_debe\_verbo" patrón de nomenclatura.</span><span class="sxs-lookup"><span data-stu-id="6701c-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="6701c-147">Nos estamos estructurar las pruebas con pruebas de patrón, que es el acrónimo "Arrange, Act, Assert" "AAA":</span><span class="sxs-lookup"><span data-stu-id="6701c-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="6701c-148">Organizar: Programa de instalación de la unidad que se está probando</span><span class="sxs-lookup"><span data-stu-id="6701c-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="6701c-149">actuar: Ejecute la unidad sometida a prueba y capturar los resultados</span><span class="sxs-lookup"><span data-stu-id="6701c-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="6701c-150">Aserción: Comprobar el comportamiento</span><span class="sxs-lookup"><span data-stu-id="6701c-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="6701c-151">Cuando escribimos las pruebas que desea evitar que las pruebas individuales hacer demasiado.</span><span class="sxs-lookup"><span data-stu-id="6701c-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="6701c-152">En su lugar, cada prueba debe comprobar solo un único concepto (que le resultará mucho más fácil de identificar la causa de errores).</span><span class="sxs-lookup"><span data-stu-id="6701c-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="6701c-153">Una buena directriz es intentar tener sólo una única instrucción para cada prueba de aserción.</span><span class="sxs-lookup"><span data-stu-id="6701c-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="6701c-154">Si tiene más de una instrucción en un método de prueba de aserción, asegúrese de que todos los que se sirven para probar el mismo concepto.</span><span class="sxs-lookup"><span data-stu-id="6701c-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="6701c-155">En caso de duda, realice otra prueba.</span><span class="sxs-lookup"><span data-stu-id="6701c-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="6701c-156">Ejecutar pruebas</span><span class="sxs-lookup"><span data-stu-id="6701c-156">Running Tests</span></span>

<span data-ttu-id="6701c-157">Visual Studio 2008 Professional (y las ediciones superiores) incluyen un ejecutor de pruebas integradas que puede usarse para ejecutar proyectos de prueba unitaria de Visual Studio en el IDE.</span><span class="sxs-lookup"><span data-stu-id="6701c-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="6701c-158">Podemos seleccionar el **Test -&gt;ejecución -&gt;todas las pruebas de la solución** comando de menú (o tipo Ctrl R, A) para ejecutar todas nuestras pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="6701c-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="6701c-159">O también podemos colocar el cursor dentro de un método de prueba o clase de prueba concreta y usar el **Test -&gt;ejecución -&gt;pruebas del contexto actual** comando de menú (o escriba Ctrl R, T) para ejecutar un subconjunto de las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="6701c-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="6701c-160">Vamos a colocar el cursor dentro de la clase DinnerTest y escriba "Ctrl R, T" para ejecutar las dos pruebas que acabamos de definir.</span><span class="sxs-lookup"><span data-stu-id="6701c-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="6701c-161">Cuando lo hacemos una ventana "Resultados de pruebas" aparecerá dentro de Visual Studio y veremos los resultados de nuestra prueba ejecute enumerados dentro de él:</span><span class="sxs-lookup"><span data-stu-id="6701c-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="6701c-162">*Nota: La ventana de resultados de pruebas de VS no muestra la columna de nombre de clase de forma predeterminada. Se puede agregar con el botón secundario en la ventana Resultados de pruebas y usando el comando de menú Agregar o quitar columnas.*</span><span class="sxs-lookup"><span data-stu-id="6701c-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="6701c-163">Las dos pruebas duraban sólo una fracción de segundo para ejecutar y como se puede ver pasados.</span><span class="sxs-lookup"><span data-stu-id="6701c-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="6701c-164">Ahora podemos se encienden y aumentarlas mediante la creación de pruebas adicionales que comprobación las validaciones de regla concreta, así como para cubren los dos métodos auxiliares - IsUserHost() y IsUserRegistered(): que se han agregado a la clase Dinner.</span><span class="sxs-lookup"><span data-stu-id="6701c-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="6701c-165">Con todas estas pruebas en su lugar para la clase Dinner resultará más fácil y seguro agregar nuevas reglas de negocios y validaciones a él en el futuro.</span><span class="sxs-lookup"><span data-stu-id="6701c-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="6701c-166">Podemos agregar nuestra lógica de la regla nueva a cenar y, a continuación, en cuestión de segundos, comprobar que no se ha interrumpido cualquiera de nuestra funcionalidad lógica anterior.</span><span class="sxs-lookup"><span data-stu-id="6701c-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="6701c-167">Tenga en cuenta cómo utilizando un nombre descriptivo prueba facilita comprender rápidamente lo que está comprobando cada prueba.</span><span class="sxs-lookup"><span data-stu-id="6701c-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="6701c-168">Recomienda usar la **Tools -&gt;opciones** comando de menú, abrir las herramientas de pruebas -&gt;pantalla de configuración de ejecución de prueba y comprobar el "doble clic en un resultado de prueba unitaria con error o no concluyente muestra casilla de verificación de punto de error en la prueba".</span><span class="sxs-lookup"><span data-stu-id="6701c-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="6701c-169">Esto le permitirá hacer doble clic en un error en la ventana de resultados de pruebas y pasar inmediatamente al error de aserción.</span><span class="sxs-lookup"><span data-stu-id="6701c-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="6701c-170">Crear pruebas unitarias DinnersController</span><span class="sxs-lookup"><span data-stu-id="6701c-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="6701c-171">Ahora creemos algunas pruebas unitarias que comprueben la funcionalidad de DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6701c-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="6701c-172">Comenzaremos con el botón secundario en la carpeta "Controladores" dentro de nuestro proyecto de prueba y, a continuación, elija el **Add -&gt;nueva prueba** comando de menú.</span><span class="sxs-lookup"><span data-stu-id="6701c-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="6701c-173">Crearemos una "prueba unitaria" y asígnele el nombre "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="6701c-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="6701c-174">Vamos a crear dos métodos de prueba que comprueben el método de acción Details() en el DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6701c-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="6701c-175">La primera comprobará que se devuelve una vista cuando se solicita una cena existente.</span><span class="sxs-lookup"><span data-stu-id="6701c-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="6701c-176">El segundo comprobará que se devuelve una vista de "NotFound" cuando se solicita una cena inexistente:</span><span class="sxs-lookup"><span data-stu-id="6701c-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="6701c-177">El código anterior se compila limpia.</span><span class="sxs-lookup"><span data-stu-id="6701c-177">The above code compiles clean.</span></span> <span data-ttu-id="6701c-178">Al ejecutar las pruebas, sin embargo, ambas finalizan con errores:</span><span class="sxs-lookup"><span data-stu-id="6701c-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="6701c-179">Si miramos los mensajes de error, veremos que el motivo de error de las pruebas era porque nuestra clase DinnersRepository no pudo conectarse a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="6701c-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="6701c-180">Nuestra aplicación NerdDinner usa una cadena de conexión en un archivo local de SQL Server Express que se encuentra bajo el \App\_directorio de datos del proyecto de aplicación NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="6701c-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="6701c-181">Dado que nuestro proyecto NerdDinner.Tests compila y ejecuta en un directorio diferente, a continuación, el proyecto de aplicación, la ubicación de ruta de acceso relativa de nuestra cadena de conexión es correcta.</span><span class="sxs-lookup"><span data-stu-id="6701c-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="6701c-182">Nos *podría* solucionar este problema copiando el archivo de base de datos de SQL Express en nuestro proyecto de prueba y, a continuación, agregarle una cadena de conexión de prueba adecuada en el archivo App.config de nuestro proyecto de prueba.</span><span class="sxs-lookup"><span data-stu-id="6701c-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="6701c-183">Esto obtendría las pruebas anteriores desbloqueado y ejecuta.</span><span class="sxs-lookup"><span data-stu-id="6701c-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="6701c-184">Pruebas unitarias de código mediante una base de datos real, sin embargo, trae consigo una serie de desafíos.</span><span class="sxs-lookup"><span data-stu-id="6701c-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="6701c-185">De manera específica:</span><span class="sxs-lookup"><span data-stu-id="6701c-185">Specifically:</span></span>

- <span data-ttu-id="6701c-186">Ralentiza considerablemente el tiempo de ejecución de pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="6701c-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="6701c-187">Cuanto más tiempo tarda en ejecutarse las pruebas, menos probable es que se ejecuten con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="6701c-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="6701c-188">Lo ideal es que desea que las pruebas unitarias para poder ejecutarse en segundos y que sea algo que se hace como naturalmente como compilar el proyecto.</span><span class="sxs-lookup"><span data-stu-id="6701c-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="6701c-189">Complica la lógica del programa de instalación y limpieza dentro de las pruebas.</span><span class="sxs-lookup"><span data-stu-id="6701c-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="6701c-190">Desea que cada prueba unitaria se aislada e independiente de otros usuarios (sin efectos secundarios o con dependencias).</span><span class="sxs-lookup"><span data-stu-id="6701c-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="6701c-191">Cuando se trabaja con una base de datos real, debe ser consciente del estado y restablecerlo entre las pruebas.</span><span class="sxs-lookup"><span data-stu-id="6701c-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="6701c-192">Echemos un vistazo a un patrón de diseño denominado "inserción de dependencias" que puede ayudarnos a solucionar estos problemas y evitar la necesidad de usar una base de datos real con nuestras pruebas.</span><span class="sxs-lookup"><span data-stu-id="6701c-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="6701c-193">Inserción de dependencias</span><span class="sxs-lookup"><span data-stu-id="6701c-193">Dependency Injection</span></span>

<span data-ttu-id="6701c-194">Ahora mismo DinnersController está "estrechamente" a la clase de instancia DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6701c-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="6701c-195">"Acoplamiento" hace referencia a una situación donde una clase explícitamente se basa en otra clase para poder funcionar:</span><span class="sxs-lookup"><span data-stu-id="6701c-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="6701c-196">Dado que la clase de instancia DinnerRepository requiere acceso a una base de datos, la dependencia estrechamente acoplada tiene la clase DinnersController en la instancia DinnerRepository termina la necesidad de que tener una base de datos para los métodos de acción DinnersController va a probar.</span><span class="sxs-lookup"><span data-stu-id="6701c-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="6701c-197">Podemos solucionar este problema mediante el uso de un patrón de diseño denominado "inserción de dependencias", que es un enfoque donde las dependencias (como las clases de repositorio que proporcionan acceso a datos) ya no es implícitamente se crean dentro de las clases que los usan.</span><span class="sxs-lookup"><span data-stu-id="6701c-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="6701c-198">En su lugar, las dependencias se pueden pasar explícitamente a la clase que se usa con argumentos de constructor.</span><span class="sxs-lookup"><span data-stu-id="6701c-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="6701c-199">Si las dependencias se definen mediante las interfaces, a continuación, tenemos la flexibilidad necesaria para pasar las implementaciones de dependencia "falsos" para escenarios de pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="6701c-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="6701c-200">Esto nos permite crear implementaciones de dependencia específica de la prueba que no se requieren acceso a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="6701c-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="6701c-201">Para ver esto en acción, vamos a implementar la inserción de dependencias con nuestra DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6701c-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="6701c-202">Extraer una interfaz IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="6701c-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="6701c-203">El primer paso será crear una nueva interfaz de IDinnerRepository que encapsula el contrato del repositorio que requieren nuestros controladores para recuperar y actualizar las cenas.</span><span class="sxs-lookup"><span data-stu-id="6701c-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="6701c-204">Podemos definir este contrato de interfaz manualmente, con el botón secundario en la carpeta \Models y, a continuación, elija el **Add -&gt;nuevo elemento** comando de menú y la creación de una nueva interfaz denominada IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="6701c-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="6701c-205">También podemos usar la refactorización automáticamente herramientas integrados en Visual Studio Professional (y las ediciones superiores) para extraer y crear una interfaz para que podamos de nuestra clase DinnerRepository existente.</span><span class="sxs-lookup"><span data-stu-id="6701c-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="6701c-206">Para extraer esta interfaz con VS, simplemente coloque el cursor en el editor de texto en la clase de instancia DinnerRepository y, a continuación, haga clic en y elija el **refactorizar -&gt;Extraer interfaz** comando de menú:</span><span class="sxs-lookup"><span data-stu-id="6701c-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="6701c-207">Esto iniciará el cuadro de diálogo "Extraer interfaz" y nos solicitará el nombre de la interfaz para crear.</span><span class="sxs-lookup"><span data-stu-id="6701c-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="6701c-208">Se IDinnerRepository de forma predeterminada y seleccionar automáticamente todos los métodos públicos en la clase de instancia DinnerRepository existente para agregar a la interfaz:</span><span class="sxs-lookup"><span data-stu-id="6701c-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="6701c-209">Cuando hacemos clic en el botón "Aceptar", Visual Studio agregará una nueva interfaz de IDinnerRepository a nuestra aplicación:</span><span class="sxs-lookup"><span data-stu-id="6701c-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="6701c-210">Y nuestra clase DinnerRepository existente se actualizará para que implemente la interfaz:</span><span class="sxs-lookup"><span data-stu-id="6701c-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="6701c-211">Actualizando DinnersController para admitir la inserción de constructor</span><span class="sxs-lookup"><span data-stu-id="6701c-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="6701c-212">Ahora, actualizaremos la clase DinnersController para usar la nueva interfaz.</span><span class="sxs-lookup"><span data-stu-id="6701c-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="6701c-213">Actualmente DinnersController está codificado de forma rígida que su campo "dinnerRepository" siempre es una clase de instancia DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="6701c-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="6701c-214">Podrá cambiarlo para que el campo "dinnerRepository" es de tipo IDinnerRepository en lugar de la instancia DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6701c-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="6701c-215">A continuación, vamos a agregar dos constructores públicos de DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6701c-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="6701c-216">Uno de los constructores permite una instancia IDinnerRepository pasarse como argumento.</span><span class="sxs-lookup"><span data-stu-id="6701c-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="6701c-217">El otro es un constructor predeterminado que usa nuestra implementación DinnerRepository existente:</span><span class="sxs-lookup"><span data-stu-id="6701c-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="6701c-218">Dado que ASP.NET MVC predeterminada se crea utilizando los constructores predeterminados de las clases de controlador, nuestro DinnersController en tiempo de ejecución continuará usar la clase de instancia DinnerRepository para tener acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="6701c-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="6701c-219">Ahora podemos actualizar nuestro pruebas unitarias, sin embargo, para pasar una implementación de repositorio cena "falsos" con el parámetro constructor.</span><span class="sxs-lookup"><span data-stu-id="6701c-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="6701c-220">Este repositorio cena "falsos" no requerirá acceso a una base de datos real y en su lugar, usará los datos de ejemplo en memoria.</span><span class="sxs-lookup"><span data-stu-id="6701c-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="6701c-221">Creación de la clase FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="6701c-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="6701c-222">Vamos a crear una clase FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6701c-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="6701c-223">Crearemos empiece por crear un directorio "Fakes" dentro de nuestro proyecto NerdDinner.Tests y, a continuación, agregaremos una nueva clase FakeDinnerRepository a él (haga doble clic en la carpeta y elija **Add -&gt;nueva clase**):</span><span class="sxs-lookup"><span data-stu-id="6701c-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="6701c-224">Actualizaremos el código para que la clase FakeDinnerRepository implementa la interfaz de IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6701c-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="6701c-225">Podemos, a continuación, haga doble clic en él y elija el comando del menú contextual "Implementar interfaz IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="6701c-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="6701c-226">Esto hará que Visual Studio agregar automáticamente todos los miembros de interfaz de IDinnerRepository a nuestra clase FakeDinnerRepository con implementaciones de "código auxiliar de" valor predeterminado:</span><span class="sxs-lookup"><span data-stu-id="6701c-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="6701c-227">A continuación, podemos actualizar la implementación FakeDinnerRepository trabajar fuera de una lista en memoria&lt;Dinner&gt; recopilación le pasa como argumento de constructor:</span><span class="sxs-lookup"><span data-stu-id="6701c-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="6701c-228">Ahora tenemos una implementación falsa de IDinnerRepository que no requiere una base de datos y, en su lugar, puede trabajar fuera de una lista en memoria de objetos de la cena.</span><span class="sxs-lookup"><span data-stu-id="6701c-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="6701c-229">Utilizar el FakeDinnerRepository con pruebas unitarias</span><span class="sxs-lookup"><span data-stu-id="6701c-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="6701c-230">Vamos a volver a las pruebas unitarias de DinnersController con error anteriormente debido a la base de datos no estaba disponible.</span><span class="sxs-lookup"><span data-stu-id="6701c-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="6701c-231">Podemos actualizar los métodos de prueba para utilizar un FakeDinnerRepository rellenado con datos de ejemplo en memoria cena el DinnersController con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="6701c-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="6701c-232">Y ahora al ejecutar estas pruebas pasen:</span><span class="sxs-lookup"><span data-stu-id="6701c-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="6701c-233">Lo mejor de todo, tomar sólo una fracción de segundo para ejecutar y no requieren ninguna lógica complicada configuración o limpieza.</span><span class="sxs-lookup"><span data-stu-id="6701c-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="6701c-234">Podemos ahora la prueba unitaria todo nuestro código de método de acción DinnersController (lista incluida, paginación, detalles, crear, actualizar y eliminar) sin necesidad de conectarse a una base de datos real.</span><span class="sxs-lookup"><span data-stu-id="6701c-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="6701c-235">**Tema de lado: Marcos de inserción de dependencia**</span><span class="sxs-lookup"><span data-stu-id="6701c-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="6701c-236">Realizar la inserción de dependencias de manual (por ejemplo, se están por encima) funciona bien, pero se vuelven más difícil de mantener como el número de dependencias y los componentes de una aplicación aumenta.</span><span class="sxs-lookup"><span data-stu-id="6701c-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="6701c-237">Existen varios marcos de inserción de dependencia para .NET que puede ayudar a proporcionar mayor flexibilidad de administración de dependencias.</span><span class="sxs-lookup"><span data-stu-id="6701c-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="6701c-238">Estos marcos, a veces se denominan contenedores "Inversión de Control" (IoC), proporcionan mecanismos que permiten un nivel adicional de compatibilidad con la configuración para especificar y pasar las dependencias a objetos en tiempo de ejecución (con mayor frecuencia mediante inserción de constructor ).</span><span class="sxs-lookup"><span data-stu-id="6701c-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="6701c-239">Algunas de la inserción de dependencias más populares de OSS / incluyen marcos IOC en. NET: AutoFac, Ninject, Spring.NET, StructureMap y Windsor.</span><span class="sxs-lookup"><span data-stu-id="6701c-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="6701c-240">ASP.NET MVC expone la API que permiten a los desarrolladores participar en la resolución y la creación de instancias de los controladores y, lo que permite la inserción de dependencias de extensibilidad / marcos IoC para integrarse sin problemas dentro de este proceso.</span><span class="sxs-lookup"><span data-stu-id="6701c-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="6701c-241">Uso de un marco DI/IOC también permitiría que eliminemos el constructor predeterminado desde nuestro DinnersController – que desea quitar completamente el acoplamiento entre ella y la instancia DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6701c-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="6701c-242">No se usará con una inserción de dependencias / marco IOC con nuestra aplicación NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="6701c-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="6701c-243">Pero es algo que podemos considerar para el futuro si las capacidades y la base de código de NerdDinner ha crecido.</span><span class="sxs-lookup"><span data-stu-id="6701c-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="6701c-244">Crear pruebas unitarias de acción de edición</span><span class="sxs-lookup"><span data-stu-id="6701c-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="6701c-245">Ahora creemos algunas pruebas unitarias que comprueben la funcionalidad de edición de la DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6701c-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="6701c-246">Comenzaremos por comprobar la versión de HTTP-GET de la acción de edición:</span><span class="sxs-lookup"><span data-stu-id="6701c-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="6701c-247">Vamos a crear una prueba que comprueba que se representa una vista respaldada por un objeto DinnerFormViewModel cuando se solicita una cena válida:</span><span class="sxs-lookup"><span data-stu-id="6701c-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="6701c-248">Cuando se ejecuta la prueba, sin embargo, se encontrará que se produce un error porque se produce una excepción de referencia nula cuando el método Edit tiene acceso a la propiedad User.Identity.Name para realizar la comprobación de Dinner.IsHostedBy().</span><span class="sxs-lookup"><span data-stu-id="6701c-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="6701c-249">El objeto de usuario en la clase base del controlador encapsula los detalles sobre el usuario ha iniciado sesión y se rellena con ASP.NET MVC cuando crea el controlador en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="6701c-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="6701c-250">Dado que estamos probando la DinnersController fuera de un entorno de servidor web, no se establece el objeto de usuario (por lo tanto, la excepción de referencia null).</span><span class="sxs-lookup"><span data-stu-id="6701c-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="6701c-251">La propiedad User.Identity.Name de simulación</span><span class="sxs-lookup"><span data-stu-id="6701c-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="6701c-252">Marcos de simulación simplificar las pruebas por lo que nos permite crear dinámicamente falsas versiones de los objetos dependientes que admiten nuestras pruebas.</span><span class="sxs-lookup"><span data-stu-id="6701c-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="6701c-253">Por ejemplo, podemos usar un marco de simulación en nuestra prueba de acción de edición para crear dinámicamente un objeto de usuario que puede usar nuestro DinnersController para buscar un nombre de usuario simulado.</span><span class="sxs-lookup"><span data-stu-id="6701c-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="6701c-254">Esto evita una referencia nula que se produzca cuando ejecutemos nuestra prueba.</span><span class="sxs-lookup"><span data-stu-id="6701c-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="6701c-255">Hay muchos .NET marcos que pueden utilizarse con ASP.NET MVC de simulación (puede ver una lista de ellos: [ http://www.mockframeworks.com/ ](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="6701c-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="6701c-256">Para probar nuestra aplicación NerdDinner, vamos a usar un marco denominado "Moq" de simulación de código abierto, que puede descargarse de forma gratuita desde [ http://www.mockframeworks.com/moq ](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="6701c-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="6701c-257">Una vez descargado, vamos a agregar una referencia en nuestro proyecto NerdDinner.Tests al ensamblado Moq.dll:</span><span class="sxs-lookup"><span data-stu-id="6701c-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="6701c-258">Método auxiliar "CreateDinnersControllerAs(username)", a continuación, vamos a agregar a nuestra clase de prueba que toma un nombre de usuario como un parámetro y que, a continuación, "mocks" la propiedad User.Identity.Name en la instancia de DinnersController:</span><span class="sxs-lookup"><span data-stu-id="6701c-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="6701c-259">Estamos usando Moq anteriormente para crear un objeto de simulacro que un objeto de elemento ControllerContext (que es lo que ASP.NET MVC que se pasa a las clases de controlador para exponer objetos en tiempo de ejecución como usuario, solicitud, respuesta y sesión) de fakes.</span><span class="sxs-lookup"><span data-stu-id="6701c-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="6701c-260">Lo llamamos el método "SetupGet" en el simulacro para indicar que la propiedad HttpContext.User.Identity.Name en el elemento ControllerContext debe devolver la cadena de nombre de usuario que se pasa al método auxiliar.</span><span class="sxs-lookup"><span data-stu-id="6701c-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="6701c-261">Nos podemos simular cualquier número de métodos y propiedades de elemento ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="6701c-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="6701c-262">Para ilustrar esto también agregué una llamada SetupGet() para la propiedad Request.IsAuthenticated (que realmente no es necesario para las pruebas siguientes: pero que puede ayudarle a ilustrar cómo se pueden simular propiedades de la solicitud).</span><span class="sxs-lookup"><span data-stu-id="6701c-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="6701c-263">Cuando terminemos asignamos una instancia de la simulación de elemento ControllerContext a la DinnersController devuelve el método auxiliar.</span><span class="sxs-lookup"><span data-stu-id="6701c-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="6701c-264">Ahora podemos escribir pruebas unitarias que usan este método auxiliar para probar los escenarios de edición que implican a distintos usuarios:</span><span class="sxs-lookup"><span data-stu-id="6701c-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="6701c-265">Y ahora al ejecutar las pruebas pasan:</span><span class="sxs-lookup"><span data-stu-id="6701c-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="6701c-266">UpdateModel() escenarios de pruebas</span><span class="sxs-lookup"><span data-stu-id="6701c-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="6701c-267">Hemos creado las pruebas que abarcan la versión de HTTP-GET de la acción de edición.</span><span class="sxs-lookup"><span data-stu-id="6701c-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="6701c-268">Ahora, vamos a crear algunas pruebas que comprueben la versión de HTTP POST de la acción de edición:</span><span class="sxs-lookup"><span data-stu-id="6701c-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="6701c-269">El escenario de prueba nuevo interesante soporte con este método de acción es su uso del método auxiliar UpdateModel() en la clase base del controlador.</span><span class="sxs-lookup"><span data-stu-id="6701c-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="6701c-270">Estamos usando este método auxiliar para enlazar los valores de formulario post a nuestra instancia de objeto de la cena.</span><span class="sxs-lookup"><span data-stu-id="6701c-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="6701c-271">A continuación se muestran dos pruebas que se muestra cómo podemos proporcionarle registrado los valores para el método auxiliar UpdateModel() utilizar el formulario.</span><span class="sxs-lookup"><span data-stu-id="6701c-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="6701c-272">Se deberá hacer esto creando y rellenando un objeto ColecciónFormulario y, a continuación, asignarlo a la propiedad "ValueProvider" en el controlador.</span><span class="sxs-lookup"><span data-stu-id="6701c-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="6701c-273">La primera prueba comprueba que en una operación de guardar correctamente el explorador se redirige a la acción de detalles.</span><span class="sxs-lookup"><span data-stu-id="6701c-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="6701c-274">La segunda prueba comprueba que cuando se publica la entrada no es válida la acción vuelve a mostrar la vista de edición nuevo con un mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="6701c-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>


[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="6701c-275">Resumen de pruebas</span><span class="sxs-lookup"><span data-stu-id="6701c-275">Testing Wrap-Up</span></span>

<span data-ttu-id="6701c-276">Nos hemos tratado los conceptos principales implicados en las clases del controlador de pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="6701c-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="6701c-277">Podemos usar estas técnicas para crear fácilmente cientos de pruebas simples que comprueben el comportamiento de nuestra aplicación.</span><span class="sxs-lookup"><span data-stu-id="6701c-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="6701c-278">Dado que nuestro controlador y las pruebas de modelo no requieren una base de datos real, son extremadamente rápida y fácil de ejecutar.</span><span class="sxs-lookup"><span data-stu-id="6701c-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="6701c-279">Podremos ejecutar cientos de pruebas automatizadas en segundos y obtener comentarios sobre si se realizó un cambio interrumpió algo de inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="6701c-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="6701c-280">Esto le ayudará a Proporciónenos la confianza necesaria para mejorar, refactorizar continuamente y refinar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6701c-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="6701c-281">Se tratan las pruebas como el último tema en este capítulo, pero no porque las pruebas son algo que debe hacer al final de un proceso de desarrollo!</span><span class="sxs-lookup"><span data-stu-id="6701c-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="6701c-282">Por el contrario, debe escribir pruebas automatizadas tan pronto como sea posible en el proceso de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="6701c-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="6701c-283">Si lo hace por lo que le permite obtener una respuesta inmediata a medida que desarrolle, le ayuda a pensar cuidadosamente en escenarios de casos de uso de la aplicación y le guía para diseñar la aplicación con limpia la creación de capas y de acoplamiento en mente.</span><span class="sxs-lookup"><span data-stu-id="6701c-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="6701c-284">Desarrollo controlado por pruebas (TDD) y cómo usarlo con ASP.NET MVC, veremos un capítulo posterior en el libro.</span><span class="sxs-lookup"><span data-stu-id="6701c-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="6701c-285">TDD es una práctica de codificación iterativa donde se escriben las pruebas que cumplirá el código resultante.</span><span class="sxs-lookup"><span data-stu-id="6701c-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="6701c-286">Con TDD comenzar cada característica mediante la creación de una prueba que comprueba la funcionalidad que se va a implementar.</span><span class="sxs-lookup"><span data-stu-id="6701c-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="6701c-287">Escritura de la unidad de prueba primero le ayuda a asegurarse de que comprende claramente la característica y cómo se supone que funcione.</span><span class="sxs-lookup"><span data-stu-id="6701c-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="6701c-288">Después de la prueba se escribe (y ha comprobado que se produce un error) es, a continuación, implementar la funcionalidad real de que la prueba comprueba.</span><span class="sxs-lookup"><span data-stu-id="6701c-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="6701c-289">Dado que ya ha invertido tiempo a pensar acerca de cómo se supone que la característica funciona en el caso de uso, tendrá una mejor comprensión de los requisitos y la mejor manera de implementarlos.</span><span class="sxs-lookup"><span data-stu-id="6701c-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="6701c-290">Cuando haya terminado con la implementación, puede volver a ejecutar la prueba – y reciben una respuesta inmediata a si la característica funciona correctamente.</span><span class="sxs-lookup"><span data-stu-id="6701c-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="6701c-291">Hablaremos sobre TDD más en el capítulo 10.</span><span class="sxs-lookup"><span data-stu-id="6701c-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="6701c-292">Paso siguiente</span><span class="sxs-lookup"><span data-stu-id="6701c-292">Next Step</span></span>

<span data-ttu-id="6701c-293">Algunos encapsulado final de los comentarios.</span><span class="sxs-lookup"><span data-stu-id="6701c-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6701c-294">[Anterior](use-ajax-to-implement-mapping-scenarios.md)
> [Siguiente](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="6701c-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
