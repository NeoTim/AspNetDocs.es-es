---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
title: Incluido un archivo de opción de carga al agregar un nuevo registro (VB) | Microsoft Docs
author: rick-anderson
description: Este tutorial muestra cómo crear una interfaz Web que permite al usuario introducir datos de texto y cargar los archivos binarios. Para ilustrar las opciones disponibles t...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 5776281d-4637-4d1e-a65b-2621d2cade44
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
msc.type: authoredcontent
ms.openlocfilehash: 4d9d064501ab2f7fe0d6ce5e1a87a128cba5e6d7
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/17/2019
ms.locfileid: "59411311"
---
# <a name="including-a-file-upload-option-when-adding-a-new-record-vb"></a><span data-ttu-id="7e82e-104">Incluir una opción de carga de archivos al agregar un nuevo registro (VB)</span><span class="sxs-lookup"><span data-stu-id="7e82e-104">Including a File Upload Option When Adding a New Record (VB)</span></span>

<span data-ttu-id="7e82e-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7e82e-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7e82e-106">[Descargue la aplicación de ejemplo](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) o [descargar PDF](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7e82e-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span></span>

> <span data-ttu-id="7e82e-107">Este tutorial muestra cómo crear una interfaz Web que permite al usuario introducir datos de texto y cargar los archivos binarios.</span><span class="sxs-lookup"><span data-stu-id="7e82e-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="7e82e-108">Para ilustrar las opciones disponibles para almacenar datos binarios, se guardará un archivo en la base de datos mientras la otra se almacena en el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>


## <a name="introduction"></a><span data-ttu-id="7e82e-109">Introducción</span><span class="sxs-lookup"><span data-stu-id="7e82e-109">Introduction</span></span>

<span data-ttu-id="7e82e-110">En los dos tutoriales anteriores, analizamos las técnicas para almacenar datos binarios que está asociados con el modelo de datos de aplicación s, examinado cómo utilizar el control FileUpload para enviar archivos desde el cliente al servidor web y ha visto cómo presentar estos datos binarios en un datos W control EB.</span><span class="sxs-lookup"><span data-stu-id="7e82e-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="7e82e-111">Se ve que tratan sobre cómo asociar los datos cargados con el modelo de datos, sin embargo.</span><span class="sxs-lookup"><span data-stu-id="7e82e-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="7e82e-112">En este tutorial crearemos una página web para agregar una nueva categoría.</span><span class="sxs-lookup"><span data-stu-id="7e82e-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="7e82e-113">Además de los cuadros de texto para el nombre de categoría s y la descripción, esta página debe incluir dos controles FileUpload uno para la nueva imagen de categoría s y otra para el folleto.</span><span class="sxs-lookup"><span data-stu-id="7e82e-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="7e82e-114">Se almacenará la imagen cargada directamente en el nuevo registro s `Picture` columna, mientras que el folleto se guardará en el `~/Brochures` carpeta con la ruta de acceso al archivo guardado en el nuevo registro s `BrochurePath` columna.</span><span class="sxs-lookup"><span data-stu-id="7e82e-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="7e82e-115">Antes de crear esta nueva página web, necesitamos actualizar la arquitectura.</span><span class="sxs-lookup"><span data-stu-id="7e82e-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="7e82e-116">El `CategoriesTableAdapter` consulta principal s no recupera el `Picture` columna.</span><span class="sxs-lookup"><span data-stu-id="7e82e-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="7e82e-117">Por lo tanto, el generado automáticamente `Insert` método sólo tiene entradas para el `CategoryName`, `Description`, y `BrochurePath` campos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="7e82e-118">Por lo tanto, es necesario crear un método adicional en el TableAdapter que solicita los cuatro `Categories` campos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="7e82e-119">La `CategoriesBLL` clase en la capa de lógica empresarial también tendrá que actualizarse.</span><span class="sxs-lookup"><span data-stu-id="7e82e-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="7e82e-120">Paso 1: Agregar un`InsertWithPicture`método a la`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="7e82e-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="7e82e-121">Cuando se crea el `CategoriesTableAdapter` en el [crear una capa de acceso a datos](../introduction/creating-a-data-access-layer-vb.md) tutorial, hemos configurado para generar automáticamente `INSERT`, `UPDATE`, y `DELETE` las instrucciones en función de la consulta principal.</span><span class="sxs-lookup"><span data-stu-id="7e82e-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="7e82e-122">Además, le indicamos emplear el enfoque directo de base de datos, que crea los métodos TableAdapter `Insert`, `Update`, y `Delete`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="7e82e-123">Estos métodos ejecutan los autogenerado `INSERT`, `UPDATE`, y `DELETE` instrucciones y, por lo tanto, aceptan parámetros de entrada en función de las columnas devueltas por la consulta principal.</span><span class="sxs-lookup"><span data-stu-id="7e82e-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="7e82e-124">En el [cargar archivos](uploading-files-vb.md) tutorial hemos ampliados la `CategoriesTableAdapter` consulta principal de s que se utilizará la `BrochurePath` columna.</span><span class="sxs-lookup"><span data-stu-id="7e82e-124">In the [Uploading Files](uploading-files-vb.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="7e82e-125">Puesto que la `CategoriesTableAdapter` no hace referencia la consulta principal s el `Picture` columna, nos podemos agregar un nuevo registro ni actualizar un registro existente con un valor para el `Picture` columna.</span><span class="sxs-lookup"><span data-stu-id="7e82e-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="7e82e-126">Para capturar esta información, o bien podemos crear un nuevo método en TableAdapter que se utiliza específicamente para insertar un registro con datos binarios o podemos personalizar la autogenerado `INSERT` instrucción.</span><span class="sxs-lookup"><span data-stu-id="7e82e-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="7e82e-127">El problema con la personalización de la autogenerado `INSERT` instrucción es que nos se corre el riesgo nuestro personalizaciones sobrescribir por el asistente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="7e82e-128">Por ejemplo, imagine que se personaliza la `INSERT` instrucción para incluir el uso de la `Picture` columna.</span><span class="sxs-lookup"><span data-stu-id="7e82e-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="7e82e-129">Esto actualizará los TableAdapter s `Insert` método para incluir un parámetro de entrada adicional para los datos binarios de imagen s s de categoría.</span><span class="sxs-lookup"><span data-stu-id="7e82e-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="7e82e-130">A continuación, podríamos crear un método en la capa de lógica empresarial para usar este método DAL e invocar este método BLL a través de la capa de presentación y todo funcionaría maravillosamente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="7e82e-131">Es decir, hasta la próxima vez que hemos configurado el TableAdapter mediante el Asistente para configuración de TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="7e82e-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="7e82e-132">Tan pronto como complete el asistente, nuestro personalizaciones a la `INSERT` se sobrescribirán la instrucción, el `Insert` método revertiría a su formato antiguo y ya no se compilará el código!</span><span class="sxs-lookup"><span data-stu-id="7e82e-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="7e82e-133">Esta serie de molestias es un problema al utilizar procedimientos almacenados en lugar de instrucciones SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="7e82e-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="7e82e-134">Un futuro tutorial explorará el uso de procedimientos almacenados en lugar de instrucciones SQL ad hoc en la capa de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>


<span data-ttu-id="7e82e-135">Para evitar esta posibilidad dolor de cabeza, en lugar de personalización de las instrucciones SQL generadas automáticamente permite s e en su lugar, cree un nuevo método del TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="7e82e-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="7e82e-136">Este método, denominado `InsertWithPicture`, acepte los valores para el `CategoryName`, `Description`, `BrochurePath`, y `Picture` columnas y ejecutar un `INSERT` instrucción que almacena los cuatro valores de un nuevo registro.</span><span class="sxs-lookup"><span data-stu-id="7e82e-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="7e82e-137">Abra el conjunto de datos con tipo y, desde el diseñador, haga doble clic en el `CategoriesTableAdapter` encabezado s y elija Agregar consulta en el menú contextual.</span><span class="sxs-lookup"><span data-stu-id="7e82e-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="7e82e-138">Esto inicia al Asistente para configuración de TableAdapter Query, que comienza con la que nos pregunta cómo la consulta de TableAdapter debe tener acceso a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="7e82e-139">Elija usar instrucciones SQL y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="7e82e-140">El siguiente paso le pide el tipo de consulta que se genere.</span><span class="sxs-lookup"><span data-stu-id="7e82e-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="7e82e-141">Desde que creamos re creando una consulta para agregar un nuevo registro a la `Categories` de tabla, elija Insertar y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>


<span data-ttu-id="7e82e-142">[![Seleccione la opción de INSERCIÓN](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span></span>

<span data-ttu-id="7e82e-143">**Figura 1**: Seleccione la opción Insertar ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span></span>


<span data-ttu-id="7e82e-144">Ahora tenemos que especificar el `INSERT` instrucción SQL.</span><span class="sxs-lookup"><span data-stu-id="7e82e-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="7e82e-145">El Asistente sugiere automáticamente un `INSERT` instrucción correspondiente a la consulta principal de TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="7e82e-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="7e82e-146">En este caso, lo s un `INSERT` instrucción que se inserta el `CategoryName`, `Description`, y `BrochurePath` valores.</span><span class="sxs-lookup"><span data-stu-id="7e82e-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="7e82e-147">La instrucción Update para que la `Picture` columna se incluye junto con un `@Picture` parámetro, de este modo:</span><span class="sxs-lookup"><span data-stu-id="7e82e-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>


[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample1.sql)]

<span data-ttu-id="7e82e-148">La última pantalla del asistente nos pide al nombre del nuevo método del TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="7e82e-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="7e82e-149">Escriba `InsertWithPicture` y haga clic en Finalizar.</span><span class="sxs-lookup"><span data-stu-id="7e82e-149">Enter `InsertWithPicture` and click Finish.</span></span>


<span data-ttu-id="7e82e-150">[![Nombre de la nueva InsertWithPicture TableAdapter (método)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span></span>

<span data-ttu-id="7e82e-151">**Figura 2**: Nombre del nuevo método TableAdapter `InsertWithPicture` ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span></span>


## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="7e82e-152">Paso 2: Actualización de la capa de lógica de negocios</span><span class="sxs-lookup"><span data-stu-id="7e82e-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="7e82e-153">Puesto que la capa de presentación sólo debe interactuar con la capa de lógica empresarial en lugar de omitir para ir directamente a la capa de acceso a datos, es necesario crear un método BLL que invoca el método DAL que acabamos de crear (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="7e82e-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="7e82e-154">Para este tutorial, cree un método en el `CategoriesBLL` clase denominada `InsertWithPicture` que acepta como entrada tres `String` s y un `Byte` matriz.</span><span class="sxs-lookup"><span data-stu-id="7e82e-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `String` s and a `Byte` array.</span></span> <span data-ttu-id="7e82e-155">El `String` son parámetros de entrada para el nombre de categoría s, descripción y ruta de acceso de archivo de folleto, mientras que el `Byte` matriz es para el contenido binario de la imagen de la categoría s.</span><span class="sxs-lookup"><span data-stu-id="7e82e-155">The `String` input parameters are for the category s name, description, and brochure file path, while the `Byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="7e82e-156">Como se muestra en el código siguiente, este método BLL invoca el método DAL correspondiente:</span><span class="sxs-lookup"><span data-stu-id="7e82e-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample2.vb)]

> [!NOTE]
> <span data-ttu-id="7e82e-157">Asegúrese de que ha guardado el conjunto de datos con tipo antes de agregar el `InsertWithPicture` método a la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="7e82e-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="7e82e-158">Puesto que la `CategoriesTableAdapter` código de la clase es generado automáticamente basándose en el conjunto de datos con tipo, si don t primero guarde los cambios en el conjunto de datos con tipo el `Adapter` propiedad no conocerá el `InsertWithPicture` método.</span><span class="sxs-lookup"><span data-stu-id="7e82e-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won't know about the `InsertWithPicture` method.</span></span>


## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="7e82e-159">Paso 3: Lista de las categorías existentes y sus datos binarios</span><span class="sxs-lookup"><span data-stu-id="7e82e-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="7e82e-160">En este tutorial crearemos una página que permite que un usuario final agregar una nueva categoría al sistema, que proporciona una imagen y un folleto para la nueva categoría.</span><span class="sxs-lookup"><span data-stu-id="7e82e-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="7e82e-161">En el [tutorial anterior](displaying-binary-data-in-the-data-web-controls-vb.md) se usa un control GridView con un TemplateField y ImageField para mostrar cada nombre de categoría s, descripción, imagen y un vínculo para descargar su folleto.</span><span class="sxs-lookup"><span data-stu-id="7e82e-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-vb.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="7e82e-162">Permiten s replicar esa funcionalidad para este tutorial, la creación de una página que enumera todas las categorías existentes y permite crear otros nuevos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="7e82e-163">Comience abriendo la `DisplayOrDownload.aspx` página desde la `BinaryData` carpeta.</span><span class="sxs-lookup"><span data-stu-id="7e82e-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="7e82e-164">Vaya a la vista del origen y copie la GridView y ObjectDataSource s sintaxis declarativa, pegándolo en la `<asp:Content>` elemento `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="7e82e-165">Además, no olvide copiar a través de la `GenerateBrochureLink` método de la clase de código subyacente de `DisplayOrDownload.aspx` a `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>


<span data-ttu-id="7e82e-166">[![Copie y pegue la sintaxis declarativa de DisplayOrDownload.aspx a UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span></span>

<span data-ttu-id="7e82e-167">**Figura 3**: Copie y pegue la sintaxis declarativa de `DisplayOrDownload.aspx` a `UploadInDetailsView.aspx` ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span></span>


<span data-ttu-id="7e82e-168">Después de copiar la sintaxis declarativa y `GenerateBrochureLink` método a través de la `UploadInDetailsView.aspx` página, vea la página a través de un explorador para asegurarse de que todo lo que se copia correctamente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="7e82e-169">Debería ver un GridView las ocho categorías de lista que incluye un vínculo para descargar el folleto, así como la imagen de la categoría s.</span><span class="sxs-lookup"><span data-stu-id="7e82e-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>


<span data-ttu-id="7e82e-170">[![Ahora debería ver cada categoría junto con sus datos binarios](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span></span>

<span data-ttu-id="7e82e-171">**Figura 4**: Ahora debería ver cada categoría junto con sus datos binarios ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span></span>


## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="7e82e-172">Paso 4: Configurar el`CategoriesDataSource`para insertar de soporte técnico</span><span class="sxs-lookup"><span data-stu-id="7e82e-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="7e82e-173">El `CategoriesDataSource` ObjectDataSource utilizado por el `Categories` GridView actualmente no proporciona la capacidad para insertar datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="7e82e-174">Para admitir la inserción a través de este control de origen de datos, es necesario asignar su `Insert` método a un método en su objeto subyacente, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="7e82e-175">En particular, queremos que se asigne a la `CategoriesBLL` método que agregamos en el paso 2 `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="7e82e-176">Iniciar, haga clic en el vínculo Configurar origen de datos de la etiqueta inteligente de s de ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="7e82e-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="7e82e-177">La primera pantalla muestra el objeto de origen de datos está configurado para trabajar, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="7e82e-178">Deje esta opción como-está y haga clic en siguiente para pasar a la pantalla de definir los métodos de datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="7e82e-179">Mover a la ficha Insertar y elija el `InsertWithPicture` método en la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="7e82e-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="7e82e-180">Haga clic en Finalizar para completar al asistente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-180">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="7e82e-181">[![Configurar el origen ObjectDataSource para usar el método InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span></span>

<span data-ttu-id="7e82e-182">**Figura 5**: Configurar el origen ObjectDataSource para usar el `InsertWithPicture` método ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span></span>


> [!NOTE]
> <span data-ttu-id="7e82e-183">Al finalizar al asistente, Visual Studio puede pedirle si desea actualizar campos y las claves, que volverá a generar los datos Web controla los campos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="7e82e-184">Elija No, porque si elige Sí, se sobrescribirá cualquier personalización de campo que se ha realizado.</span><span class="sxs-lookup"><span data-stu-id="7e82e-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>


<span data-ttu-id="7e82e-185">Después de completar el asistente, el origen ObjectDataSource ahora incluirá un valor para su `InsertMethod` propiedad como `InsertParameters` para las columnas de la categoría de cuatro, como el siguiente marcado declarativo muestra:</span><span class="sxs-lookup"><span data-stu-id="7e82e-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="7e82e-186">Paso 5: Creación de la interfaz de inserción</span><span class="sxs-lookup"><span data-stu-id="7e82e-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="7e82e-187">En primer lugar como se explica en el [una visión general de insertar, actualizar y eliminar datos](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), el control DetailsView proporciona una interfaz de inserción integrada que puede utilizarse cuando se trabaja con un control de origen de datos que admite la inserción.</span><span class="sxs-lookup"><span data-stu-id="7e82e-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="7e82e-188">Permitir s Agregar un control DetailsView a esta página por encima de GridView que representará permanentemente su interfaz de inserción, lo que permite al usuario agregar rápidamente una nueva categoría.</span><span class="sxs-lookup"><span data-stu-id="7e82e-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="7e82e-189">Al agregar una nueva categoría en DetailsView, GridView debajo de ella se actualice automáticamente y mostrar la nueva categoría.</span><span class="sxs-lookup"><span data-stu-id="7e82e-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="7e82e-190">Inicio arrastrando un DetailsView desde el cuadro de herramientas hasta el diseñador por encima del control GridView, establecer su `ID` propiedad `NewCategory` y borrarlos el `Height` y `Width` los valores de propiedad.</span><span class="sxs-lookup"><span data-stu-id="7e82e-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="7e82e-191">En la etiqueta inteligente s DetailsView, enlazarlo a existente `CategoriesDataSource` y, a continuación, active la casilla Habilitar inserción.</span><span class="sxs-lookup"><span data-stu-id="7e82e-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>


<span data-ttu-id="7e82e-192">[![Enlazar el CategoriesDataSource DetailsView y Habilitar inserción](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span></span>

<span data-ttu-id="7e82e-193">**Figura 6**: Enlazar a DetailsView el `CategoriesDataSource` y Habilitar inserción ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span></span>


<span data-ttu-id="7e82e-194">Para representar permanentemente DetailsView en la interfaz de inserción, establezca su `DefaultMode` propiedad `Insert`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="7e82e-195">Tenga en cuenta que DetailsView tiene cinco BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, y `BrochurePath` aunque el `CategoryID` BoundField no se representa en la interfaz de inserción porque su `InsertVisible` propiedad está establecida en `False`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `False`.</span></span> <span data-ttu-id="7e82e-196">Estos BoundFields existe porque son las columnas devueltas por la `GetCategories()` método, que es lo que el ObjectDataSource invoca para recuperar sus datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="7e82e-197">Para insertar, sin embargo, no queremos t desea permitir al usuario especificar un valor para `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="7e82e-198">Además, es necesario para que puedan cargar una imagen para la nueva categoría así como cargar un archivo PDF para el folleto.</span><span class="sxs-lookup"><span data-stu-id="7e82e-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="7e82e-199">Quitar el `NumberOfProducts` BoundField del DetailsView completamente y actualice el `HeaderText` propiedades de la `CategoryName` y `BrochurePath` BoundFields a la categoría y el folleto, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="7e82e-200">A continuación, convertir la `BrochurePath` BoundField en TemplateField y agregar un nuevo TemplateField para la imagen, lo que ofrece esta nueva TemplateField un `HeaderText` valor de la imagen.</span><span class="sxs-lookup"><span data-stu-id="7e82e-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="7e82e-201">Mover el `Picture` TemplateField para que esté entre el `BrochurePath` TemplateField y CommandField.</span><span class="sxs-lookup"><span data-stu-id="7e82e-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>


![Enlazar el CategoriesDataSource DetailsView y Habilitar inserción](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.gif)

<span data-ttu-id="7e82e-203">**Figura 7**: Enlazar a DetailsView el `CategoriesDataSource` y Habilitar inserción</span><span class="sxs-lookup"><span data-stu-id="7e82e-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>


<span data-ttu-id="7e82e-204">Si ha convertido el `BrochurePath` BoundField en TemplateField a través del cuadro de diálogo Editar campos, TemplateField incluye un `ItemTemplate`, `EditItemTemplate`, y `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="7e82e-205">Solo el `InsertItemTemplate` es necesario, sin embargo, por lo que no dude en quitar las dos plantillas.</span><span class="sxs-lookup"><span data-stu-id="7e82e-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="7e82e-206">En este momento su sintaxis declarativa de DetailsView s debería ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="7e82e-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="7e82e-207">Agregar controles FileUpload para los campos de imagen y un folleto</span><span class="sxs-lookup"><span data-stu-id="7e82e-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="7e82e-208">Actualmente, el `BrochurePath` TemplateField s `InsertItemTemplate` contiene un cuadro de texto, mientras que el `Picture` TemplateField no contiene ninguna plantilla.</span><span class="sxs-lookup"><span data-stu-id="7e82e-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="7e82e-209">Es necesario actualizar estas dos s TemplateField `InsertItemTemplate` para utilizar controles FileUpload.</span><span class="sxs-lookup"><span data-stu-id="7e82e-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="7e82e-210">En la etiqueta inteligente de DetailsView s, elija la opción de editar plantillas y, a continuación, seleccione el `BrochurePath` TemplateField s `InsertItemTemplate` en la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="7e82e-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="7e82e-211">Quite el cuadro de texto y, a continuación, arrastre un control FileUpload desde el cuadro de herramientas en la plantilla.</span><span class="sxs-lookup"><span data-stu-id="7e82e-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="7e82e-212">Establecer el control FileUpload s `ID` a `BrochureUpload`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="7e82e-213">De forma similar, agregue un control FileUpload para el `Picture` TemplateField s `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="7e82e-214">Establecer este control FileUpload s `ID` a `PictureUpload`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>


<span data-ttu-id="7e82e-215">[![Agregar un Control FileUpload a la InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span></span>

<span data-ttu-id="7e82e-216">**Figura 8**: Agregar un Control FileUpload el `InsertItemTemplate` ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span></span>


<span data-ttu-id="7e82e-217">Después de realizar estas adiciones, la sintaxis declarativa de dos TemplateField s será:</span><span class="sxs-lookup"><span data-stu-id="7e82e-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample5.aspx)]

<span data-ttu-id="7e82e-218">Cuando un usuario agrega una nueva categoría, queremos asegurarnos de que el folleto y la imagen son del tipo de archivo correcto.</span><span class="sxs-lookup"><span data-stu-id="7e82e-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="7e82e-219">Obtener el catálogo, el usuario debe proporcionar un archivo PDF.</span><span class="sxs-lookup"><span data-stu-id="7e82e-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="7e82e-220">¿Para la imagen, necesitamos que el usuario puede cargar un archivo de imagen, pero se permiten *cualquier* archivo o sólo los archivos de imagen de un tipo determinado, por ejemplo, con formato GIF o jpg de la imagen?</span><span class="sxs-lookup"><span data-stu-id="7e82e-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="7e82e-221">Para permitir diferentes tipos de archivo, d necesitamos ampliar el `Categories` esquema para incluir una columna que captura el tipo de archivo para que este tipo se puede enviar al cliente a través de `Response.ContentType` en `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="7e82e-222">Puesto que no queremos t tiene este tipo de columna, sería recomendable restringir a los usuarios para que solo proporciona un tipo de archivo de imagen específico.</span><span class="sxs-lookup"><span data-stu-id="7e82e-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="7e82e-223">El `Categories` imágenes existentes de la tabla s son mapas de bits, pero jpg están un formato de archivo más adecuado para las imágenes que sirven a través de Internet.</span><span class="sxs-lookup"><span data-stu-id="7e82e-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="7e82e-224">Si un usuario carga un tipo de archivo incorrecto, se debe cancelar la inserción y mostrará un mensaje que indica el problema.</span><span class="sxs-lookup"><span data-stu-id="7e82e-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="7e82e-225">Agregue un control Web de la etiqueta debajo de DetailsView.</span><span class="sxs-lookup"><span data-stu-id="7e82e-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="7e82e-226">Establecer su `ID` propiedad `UploadWarning`, desactive out su `Text` establecer la propiedad, el `CssClass` propiedad a la advertencia y la `Visible` y `EnableViewState` propiedades para `False`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="7e82e-227">El `Warning` clase CSS que se define en `Styles.css` y representa el texto en una fuente grande, rojo, cursiva, negrita.</span><span class="sxs-lookup"><span data-stu-id="7e82e-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="7e82e-228">Idealmente, el `CategoryName` y `Description` BoundFields se convertiría TemplateFields y sus interfaces de inserción personalizadas.</span><span class="sxs-lookup"><span data-stu-id="7e82e-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="7e82e-229">El `Description` insertar interfaz, por ejemplo, sería probablemente adaptarla mejor a través de un cuadro de texto multilínea.</span><span class="sxs-lookup"><span data-stu-id="7e82e-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="7e82e-230">Y, puesto que la `CategoryName` columna no acepta `NULL` valores, se debe agregar un control RequiredFieldValidator para asegurarse de que el usuario proporciona un valor para el nuevo nombre de categoría s.</span><span class="sxs-lookup"><span data-stu-id="7e82e-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="7e82e-231">Estos pasos se dejan como un ejercicio para el lector.</span><span class="sxs-lookup"><span data-stu-id="7e82e-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="7e82e-232">Vuelva a consultar [personalizar la interfaz de modificación de datos](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) para una visión detallada de aumento de las interfaces de modificación de datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) for an in-depth look at augmenting the data modification interfaces.</span></span>


## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="7e82e-233">Paso 6: Guardando el folleto cargado en el sistema de archivos de s de servidor Web</span><span class="sxs-lookup"><span data-stu-id="7e82e-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="7e82e-234">Cuando el usuario especifica los valores para una nueva categoría y hace clic en el botón de inserción, se produce un postback y se desarrolla el flujo de trabajo de inserción.</span><span class="sxs-lookup"><span data-stu-id="7e82e-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="7e82e-235">Primero, la s DetailsView [ `ItemInserting` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) se activa.</span><span class="sxs-lookup"><span data-stu-id="7e82e-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="7e82e-236">A continuación, la s ObjectDataSource `Insert()` se invoca el método, que da como resultado un nuevo registro que se agrega a la `Categories` tabla.</span><span class="sxs-lookup"><span data-stu-id="7e82e-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="7e82e-237">Después de eso, la s DetailsView [ `ItemInserted` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) se activa.</span><span class="sxs-lookup"><span data-stu-id="7e82e-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="7e82e-238">Antes de las operaciones de asignación ObjectDataSource `Insert()` se invoca el método, debemos en primer lugar asegúrese de que los tipos de archivo adecuados se han cargado por el usuario y, a continuación, guarde el folleto PDF en el sistema de archivos de s de servidor web.</span><span class="sxs-lookup"><span data-stu-id="7e82e-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="7e82e-239">Crear un controlador de eventos para el s DetailsView `ItemInserting` eventos y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="7e82e-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample6.vb)]

<span data-ttu-id="7e82e-240">El controlador de eventos se inicia haciendo referencia a la `BrochureUpload` control FileUpload desde las plantillas de s DetailsView.</span><span class="sxs-lookup"><span data-stu-id="7e82e-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="7e82e-241">A continuación, si se ha cargado un folleto, se examina la extensión de s del archivo cargado.</span><span class="sxs-lookup"><span data-stu-id="7e82e-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="7e82e-242">Si no es la extensión. Se muestra el PDF, a continuación, una advertencia, se cancela la inserción y finaliza la ejecución del controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="7e82e-243">Depender de la extensión de s del archivo cargado no es una técnica descuidada para asegurarse de que el archivo cargado no es un documento PDF.</span><span class="sxs-lookup"><span data-stu-id="7e82e-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="7e82e-244">El usuario podría tener un documento PDF válido con la extensión `.Brochure`, o podría tomar un documento que no son PDF y dado que un `.pdf` extensión.</span><span class="sxs-lookup"><span data-stu-id="7e82e-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="7e82e-245">El contenido binario del archivo s necesitaría examinarse mediante programación con el fin de comprobar el tipo de archivo de forma más concluyente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="7e82e-246">Tales métodos completas, sin embargo, a menudo son excesivos; comprobación de la extensión es suficiente para la mayoría de los escenarios.</span><span class="sxs-lookup"><span data-stu-id="7e82e-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>


<span data-ttu-id="7e82e-247">Como se describe en el [cargar archivos](uploading-files-vb.md) tutorial, debe tener cuidado al guardar archivos al sistema de archivos para esa carga de un usuario s no sobrescribe s otro.</span><span class="sxs-lookup"><span data-stu-id="7e82e-247">As discussed in the [Uploading Files](uploading-files-vb.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="7e82e-248">Para este tutorial, se intentará usar el mismo nombre que el archivo cargado.</span><span class="sxs-lookup"><span data-stu-id="7e82e-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="7e82e-249">Si ya existe un archivo en el `~/Brochures` directorio con ese mismo nombre de archivo, sin embargo, se deberá anexar un número al final hasta que se encuentra un nombre único.</span><span class="sxs-lookup"><span data-stu-id="7e82e-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="7e82e-250">Por ejemplo, si el usuario carga un archivo de catálogo denominado `Meats.pdf`, pero ya hay un archivo denominado `Meats.pdf` en el `~/Brochures` carpeta, cambiaremos el nombre del archivo guardado para `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="7e82e-251">Si no existe que intentaremos `Meats-2.pdf`, y así sucesivamente, hasta que se encuentra un nombre de archivo único.</span><span class="sxs-lookup"><span data-stu-id="7e82e-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="7e82e-252">El siguiente código utiliza el [ `File.Exists(path)` método](https://msdn.microsoft.com/library/system.io.file.exists.aspx) para determinar si ya existe un archivo con el nombre de archivo especificado.</span><span class="sxs-lookup"><span data-stu-id="7e82e-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="7e82e-253">Si es así, continúa probar los nuevos nombres de archivo para el folleto hasta que no se encuentra ningún conflicto.</span><span class="sxs-lookup"><span data-stu-id="7e82e-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample7.vb)]

<span data-ttu-id="7e82e-254">Una vez que se ha encontrado un nombre de archivo válido, el archivo debe guardarse en el sistema de archivos y la s ObjectDataSource `brochurePath``InsertParameter` valor debe actualizarse para que este nombre de archivo se escribe en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="7e82e-255">Como vimos en el *cargar archivos* tutorial, el archivo puede guardarse con el control FileUpload s `SaveAs(path)` método.</span><span class="sxs-lookup"><span data-stu-id="7e82e-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="7e82e-256">Para actualizar la s ObjectDataSource `brochurePath` parámetro, use el `e.Values` colección.</span><span class="sxs-lookup"><span data-stu-id="7e82e-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample8.vb)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="7e82e-257">Paso 7: Guardar la imagen cargada en la base de datos</span><span class="sxs-lookup"><span data-stu-id="7e82e-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="7e82e-258">Para almacenar la imagen cargada en el nuevo `Categories` registros, se debe asignar el contenido binario cargado al origen ObjectDataSource s `picture` parámetro en la s DetailsView `ItemInserting` eventos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="7e82e-259">Sin embargo, antes de realizar esta asignación, es necesario para asegurarse de que la imagen cargada es un JPG y no algún otro tipo de imagen.</span><span class="sxs-lookup"><span data-stu-id="7e82e-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="7e82e-260">Como en el paso 6, permiten usar la extensión de archivo de imagen cargados s para determinar su tipo de s.</span><span class="sxs-lookup"><span data-stu-id="7e82e-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="7e82e-261">Mientras el `Categories` table permite `NULL` valores para la `Picture` columna, todas las categorías actualmente tiene una imagen.</span><span class="sxs-lookup"><span data-stu-id="7e82e-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="7e82e-262">Permiten s obligar al usuario para proporcionar una imagen al agregar una nueva categoría a través de esta página.</span><span class="sxs-lookup"><span data-stu-id="7e82e-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="7e82e-263">El código siguiente se comprueba para asegurarse de que se ha cargado una imagen y que tiene una extensión adecuada.</span><span class="sxs-lookup"><span data-stu-id="7e82e-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample9.vb)]

<span data-ttu-id="7e82e-264">Este código debe colocarse *antes* el código del paso 6 para que si hay un problema con la carga de imagen, el controlador de eventos finalizará antes de que el archivo de catálogo se guarda en el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="7e82e-265">Suponiendo que se ha cargado un archivo adecuado, puede asignar el contenido binario cargado para el valor del parámetro imagen con la siguiente línea de código:</span><span class="sxs-lookup"><span data-stu-id="7e82e-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample10.vb)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="7e82e-266">La completa`ItemInserting`controlador de eventos</span><span class="sxs-lookup"><span data-stu-id="7e82e-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="7e82e-267">Por integridad, aquí está el `ItemInserting` controlador de eventos en su totalidad:</span><span class="sxs-lookup"><span data-stu-id="7e82e-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample11.vb)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="7e82e-268">Paso 8: Corregir la`DisplayCategoryPicture.aspx`página</span><span class="sxs-lookup"><span data-stu-id="7e82e-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="7e82e-269">Let s dedique un momento para probar la interfaz de inserción y `ItemInserting` controlador de eventos que se creó durante los últimos pasos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="7e82e-270">Visite el `UploadInDetailsView.aspx` página a través de un explorador y el intento de agregar una categoría, pero omita la imagen o especificar una imagen que no son JPG o un folleto que no son PDF.</span><span class="sxs-lookup"><span data-stu-id="7e82e-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="7e82e-271">En cualquiera de estos casos, se mostrará un mensaje de error y cancela el flujo de trabajo de inserción.</span><span class="sxs-lookup"><span data-stu-id="7e82e-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>


<span data-ttu-id="7e82e-272">[![Es de un mensaje de advertencia aparece si se carga un tipo de archivo no válido](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span></span>

<span data-ttu-id="7e82e-273">**Figura 9**: Es de un mensaje de advertencia aparece si se carga un tipo de archivo no válido ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span></span>


<span data-ttu-id="7e82e-274">Una vez haya comprobado que la página requiere una imagen para cargarse y no aceptan archivos PDF no o que no son JPG, agregue una nueva categoría válido imagen JPG, dejar vacío el campo de folleto.</span><span class="sxs-lookup"><span data-stu-id="7e82e-274">Once you have verified that the page requires a picture to be uploaded and won't accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="7e82e-275">Después de hacer clic en el botón de inserción, la página se devolución de datos y se agregará un nuevo registro a la `Categories` tabla con el contenido binario de la imagen cargada s almacenada directamente en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="7e82e-276">El control GridView se actualiza y muestra una fila para la categoría recién agregada, pero, como se muestra en la figura 10, la nueva imagen de s de categoría no se represente correctamente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>


<span data-ttu-id="7e82e-277">[![La nueva categoría s que no se muestra la imagen](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span></span>

<span data-ttu-id="7e82e-278">**Figura 10**: Las operaciones de asignación nueva categoría no se muestra la imagen ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span></span>


<span data-ttu-id="7e82e-279">La razón no se muestra la nueva imagen es que la `DisplayCategoryPicture.aspx` página que devuelve una imagen de la categoría especificada s está configurada para procesar los mapas de bits que tienen un encabezado OLE.</span><span class="sxs-lookup"><span data-stu-id="7e82e-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="7e82e-280">Este encabezado 78 bytes se elimina de la `Picture` hacer una copia del contenido binario de la columna s antes de enviarlos al cliente.</span><span class="sxs-lookup"><span data-stu-id="7e82e-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="7e82e-281">Pero el archivo JPG que se acaba de cargar para la nueva categoría no tiene este encabezado OLE; por lo tanto, se quitan de los datos binarios de imagen s los bytes válidas, es necesarios.</span><span class="sxs-lookup"><span data-stu-id="7e82e-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="7e82e-282">Puesto que ahora hay dos mapas de bits con encabezados OLE y los archivos JPEG en la `Categories` tabla, es necesario actualizar `DisplayCategoryPicture.aspx` para que lo hace el encabezado OLE quitando las ocho categorías originales y se omite esta eliminación para los registros más recientes de la categoría.</span><span class="sxs-lookup"><span data-stu-id="7e82e-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="7e82e-283">En nuestro siguiente tutorial examinaremos cómo actualizar una imagen existente de registro s y se actualizará todas las imágenes de la categoría anterior para que sean jpg.</span><span class="sxs-lookup"><span data-stu-id="7e82e-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="7e82e-284">Por ahora, sin embargo, puede usar el siguiente código en `DisplayCategoryPicture.aspx` para quitar los encabezados OLE solo para esas ocho categorías originales:</span><span class="sxs-lookup"><span data-stu-id="7e82e-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample12.vb)]

<span data-ttu-id="7e82e-285">Con este cambio, ahora se representa correctamente la imagen JPG en GridView.</span><span class="sxs-lookup"><span data-stu-id="7e82e-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>


<span data-ttu-id="7e82e-286">[![Las imágenes JPG de nuevas categorías son represente correctamente](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="7e82e-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span></span>

<span data-ttu-id="7e82e-287">**Figura 11**: Las imágenes JPG de nuevas categorías son represente correctamente ([haga clic aquí para ver imagen en tamaño completo](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="7e82e-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span></span>


## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="7e82e-288">Paso 9: Eliminando el folleto en caso de una excepción</span><span class="sxs-lookup"><span data-stu-id="7e82e-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="7e82e-289">Uno de los desafíos de almacenar datos binarios en el sistema de archivos de s de servidor web es que introduce una desconexión entre el modelo de datos y sus datos binarios.</span><span class="sxs-lookup"><span data-stu-id="7e82e-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="7e82e-290">Por lo tanto, cada vez que se elimina un registro, los datos binarios correspondientes en el sistema de archivos también deben quitarse.</span><span class="sxs-lookup"><span data-stu-id="7e82e-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="7e82e-291">Esto puede entran en juego cuando se insertan, también.</span><span class="sxs-lookup"><span data-stu-id="7e82e-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="7e82e-292">Considere el siguiente escenario: un usuario agrega una nueva categoría, especificar una imagen válida y un folleto.</span><span class="sxs-lookup"><span data-stu-id="7e82e-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="7e82e-293">Tras hacer clic en el botón de inserción, se produce un postback y la s DetailsView `ItemInserting` desencadena el evento, guardando el folleto para el sistema de archivos de s de servidor web.</span><span class="sxs-lookup"><span data-stu-id="7e82e-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="7e82e-294">A continuación, la s ObjectDataSource `Insert()` se invoca el método, que llama a la `CategoriesBLL` clase s `InsertWithPicture` método que llama el `CategoriesTableAdapter` s `InsertWithPicture` método.</span><span class="sxs-lookup"><span data-stu-id="7e82e-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="7e82e-295">Ahora, ¿qué ocurre si la base de datos está sin conexión o si hay un error en la `INSERT` instrucción SQL?</span><span class="sxs-lookup"><span data-stu-id="7e82e-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="7e82e-296">Claramente la INSERCIÓN se producirá un error, por lo que no hay ninguna fila de la categoría nueva se agregará a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="7e82e-297">Pero aún tendremos el archivo cargado folleto sentado en el sistema de archivos de s de servidor web.</span><span class="sxs-lookup"><span data-stu-id="7e82e-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="7e82e-298">Este archivo debe eliminarse en el caso de una excepción durante el flujo de trabajo de inserción.</span><span class="sxs-lookup"><span data-stu-id="7e82e-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="7e82e-299">Como se explicó anteriormente en el [BLL - control y excepciones de nivel DAL en una página ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial, cuando se produce una excepción desde dentro de las profundidades de la arquitectura afecta al funcionamiento a través de las distintas capas.</span><span class="sxs-lookup"><span data-stu-id="7e82e-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="7e82e-300">En la capa de presentación, podemos determinar si se ha producido una excepción de s DetailsView `ItemInserted` eventos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="7e82e-301">Este controlador de eventos también proporciona los valores de las operaciones de asignación ObjectDataSource `InsertParameters`.</span><span class="sxs-lookup"><span data-stu-id="7e82e-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="7e82e-302">Por lo tanto, podemos crear un controlador de eventos para el `ItemInserted` eventos que comprueba si se ha producido una excepción y, si es así, elimina el archivo especificado por la s ObjectDataSource `brochurePath` parámetro:</span><span class="sxs-lookup"><span data-stu-id="7e82e-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample13.vb)]

## <a name="summary"></a><span data-ttu-id="7e82e-303">Resumen</span><span class="sxs-lookup"><span data-stu-id="7e82e-303">Summary</span></span>

<span data-ttu-id="7e82e-304">Hay una serie de pasos que deben realizarse con el fin de proporcionar una interfaz basada en web para agregar los registros que incluyen datos binarios.</span><span class="sxs-lookup"><span data-stu-id="7e82e-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="7e82e-305">Si se va a almacenar los datos binarios directamente en la base de datos, lo más probable es que deberá actualizar la arquitectura, la adición de métodos específicos para controlar el caso donde se insertan los datos binarios.</span><span class="sxs-lookup"><span data-stu-id="7e82e-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="7e82e-306">Una vez que se ha actualizado la arquitectura, el siguiente paso es crear la interfaz de inserción, que puede realizarse mediante un DetailsView en la que se ha personalizado para incluir un control FileUpload para cada campo de datos binarios.</span><span class="sxs-lookup"><span data-stu-id="7e82e-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="7e82e-307">Los datos cargados, a continuación, se guarda en el sistema de archivos de s de servidor web o asignados a un parámetro de origen de datos en la s DetailsView `ItemInserting` controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="7e82e-308">Guardar datos binarios en el sistema de archivos requiere más planeación que guardar los datos directamente en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="7e82e-309">Debe elegir un esquema de nomenclatura con el fin de evitar una carga de usuario s sobrescribiendo s otro.</span><span class="sxs-lookup"><span data-stu-id="7e82e-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="7e82e-310">Además, se deben realizar pasos adicionales para eliminar el archivo cargado si se produce un error en la inserción de base de datos.</span><span class="sxs-lookup"><span data-stu-id="7e82e-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="7e82e-311">Ahora tenemos la capacidad de agregar nuevas categorías para el sistema con un folleto y la imagen, pero se ve aún a mirar cómo actualizar un categoría s los datos binarios existentes o quitar correctamente los datos binarios para una categoría eliminada.</span><span class="sxs-lookup"><span data-stu-id="7e82e-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="7e82e-312">Exploraremos estos dos temas en el siguiente tutorial.</span><span class="sxs-lookup"><span data-stu-id="7e82e-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="7e82e-313">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="7e82e-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="7e82e-314">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="7e82e-314">About the Author</span></span>

<span data-ttu-id="7e82e-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros sobre ASP/ASP.NET y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), trabaja con tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="7e82e-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7e82e-316">Scott trabaja como consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="7e82e-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7e82e-317">Su último libro es [*SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="7e82e-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7e82e-318">Puede ponerse en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7e82e-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="7e82e-319">o a través de su blog, que puede encontrarse en [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="7e82e-319">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7e82e-320">Agradecimientos especiales a</span><span class="sxs-lookup"><span data-stu-id="7e82e-320">Special Thanks To</span></span>

<span data-ttu-id="7e82e-321">Esta serie de tutoriales ha sido revisada por muchos revisores útiles.</span><span class="sxs-lookup"><span data-stu-id="7e82e-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7e82e-322">Los revisores para este tutorial fueron Dave Gardner, Teresa Murphy y Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="7e82e-322">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="7e82e-323">¿Está interesado en leer mi próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="7e82e-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7e82e-324">Si es así, envíeme una línea en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7e82e-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7e82e-325">[Anterior](displaying-binary-data-in-the-data-web-controls-vb.md)
> [Siguiente](updating-and-deleting-existing-binary-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7e82e-325">[Previous](displaying-binary-data-in-the-data-web-controls-vb.md)
[Next](updating-and-deleting-existing-binary-data-vb.md)</span></span>
