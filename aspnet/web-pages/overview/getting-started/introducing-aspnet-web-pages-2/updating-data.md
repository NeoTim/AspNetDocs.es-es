---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
title: Introducción a la actualización de datos de la base de datos de ASP.NET Web Pages | Microsoft Docs
author: Rick-Anderson
description: En este tutorial se muestra cómo actualizar (cambiar) una entrada de base de datos existente cuando se usa ASP.NET Web Pages (Razor). Se supone que ha completado la serie...
ms.author: riande
ms.date: 01/02/2018
ms.assetid: ac86ec9c-6b69-485b-b9e0-8b9127b13e6b
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
msc.type: authoredcontent
ms.openlocfilehash: 8f8bcfb7d9d2416a2699776cadbdaae8e12415ba
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78463495"
---
# <a name="introducing-aspnet-web-pages---updating-database-data"></a><span data-ttu-id="3ee3a-104">Introducción a la actualización de datos de base de datos de ASP.NET Web Pages</span><span class="sxs-lookup"><span data-stu-id="3ee3a-104">Introducing ASP.NET Web Pages - Updating Database Data</span></span>

<span data-ttu-id="3ee3a-105">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="3ee3a-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="3ee3a-106">En este tutorial se muestra cómo actualizar (cambiar) una entrada de base de datos existente cuando se usa ASP.NET Web Pages (Razor).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-106">This tutorial shows you how to update (change) an existing database entry when you use ASP.NET Web Pages (Razor).</span></span> <span data-ttu-id="3ee3a-107">Se supone que ha completado la serie a través de la [especificación de datos mediante el uso de formularios ASP.NET Web pages](entering-data.md).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-107">It assumes you have completed the series through [Entering Data by Using Forms Using ASP.NET Web Pages](entering-data.md).</span></span>
> 
> <span data-ttu-id="3ee3a-108">Temas que se abordarán:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-108">What you'll learn:</span></span>
> 
> - <span data-ttu-id="3ee3a-109">Cómo seleccionar un registro individual en la aplicación auxiliar de `WebGrid`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-109">How to select an individual record in the `WebGrid` helper.</span></span>
> - <span data-ttu-id="3ee3a-110">Cómo leer un solo registro de una base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-110">How to read a single record from a database.</span></span>
> - <span data-ttu-id="3ee3a-111">Cómo cargar previamente un formulario con valores del registro de base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-111">How to preload a form with values from the database record.</span></span>
> - <span data-ttu-id="3ee3a-112">Cómo actualizar un registro existente en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-112">How to update an existing record in a database.</span></span>
> - <span data-ttu-id="3ee3a-113">Cómo almacenar información en la página sin mostrarla.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-113">How to store information in the page without displaying it.</span></span>
> - <span data-ttu-id="3ee3a-114">Cómo usar un campo oculto para almacenar información.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-114">How to use a hidden field to store information.</span></span>
>   
> 
> <span data-ttu-id="3ee3a-115">Características y tecnologías descritas:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-115">Features/technologies discussed:</span></span>
> 
> - <span data-ttu-id="3ee3a-116">Aplicación auxiliar de `WebGrid`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-116">The `WebGrid` helper.</span></span>
> - <span data-ttu-id="3ee3a-117">Comando de SQL `Update`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-117">The SQL `Update` command.</span></span>
> - <span data-ttu-id="3ee3a-118">El método `Database.Execute` .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-118">The `Database.Execute` method.</span></span>
> - <span data-ttu-id="3ee3a-119">Campos ocultos (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-119">Hidden fields (`<input type="hidden">`).</span></span>

## <a name="what-youll-build"></a><span data-ttu-id="3ee3a-120">Lo que creará</span><span class="sxs-lookup"><span data-stu-id="3ee3a-120">What You'll Build</span></span>

<span data-ttu-id="3ee3a-121">En el tutorial anterior, aprendió a agregar un registro a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-121">In the previous tutorial, you learned how to add a record to a database.</span></span> <span data-ttu-id="3ee3a-122">Aquí aprenderá a mostrar un registro para editarlo.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-122">Here, you'll learn how to display a record for editing.</span></span> <span data-ttu-id="3ee3a-123">En la página *películas* , actualizará la aplicación auxiliar de `WebGrid` para que muestre un vínculo de **edición** junto a cada película:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-123">In the *Movies* page, you'll update the `WebGrid` helper so that it displays an **Edit** link next to each movie:</span></span>

![Presentación de WebGrid que incluye un vínculo de edición para cada película](updating-data/_static/image1.png)

<span data-ttu-id="3ee3a-125">Al hacer clic en el vínculo **Editar** , se le remite a una página diferente, donde la información de la película ya está en un formulario:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-125">When you click the **Edit** link, it takes you to a different page, where the movie information is already in a form:</span></span>

![Editar la página de película que muestra la película que se va a editar](updating-data/_static/image2.png)

<span data-ttu-id="3ee3a-127">Puede cambiar cualquiera de los valores.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-127">You can change any of the values.</span></span> <span data-ttu-id="3ee3a-128">Al enviar los cambios, el código de la página actualiza la base de datos y vuelve a la lista de películas.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-128">When you submit the changes, the code in the page updates the database and takes you back to the movie listing.</span></span>

<span data-ttu-id="3ee3a-129">Esta parte del proceso funciona casi exactamente igual que la página *AddMovie. cshtml* que creó en el tutorial anterior, por lo que gran parte de este tutorial le resultará familiar.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-129">This part of the process works almost exactly like the *AddMovie.cshtml* page you created in the previous tutorial, so much of this tutorial will be familiar.</span></span>

<span data-ttu-id="3ee3a-130">Hay varias maneras de implementar una forma de editar una película individual.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-130">There are several ways you could implement a way to edit an individual movie.</span></span> <span data-ttu-id="3ee3a-131">Se ha elegido el enfoque que se muestra porque es fácil de implementar y fácil de comprender.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-131">The approach shown was chosen because it's easy to implement and easy to understand.</span></span>

## <a name="adding-an-edit-link-to-the-movie-listing"></a><span data-ttu-id="3ee3a-132">Agregar un vínculo de edición a la lista de películas</span><span class="sxs-lookup"><span data-stu-id="3ee3a-132">Adding an Edit Link to the Movie Listing</span></span>

<span data-ttu-id="3ee3a-133">Para empezar, deberá actualizar la página de *películas* para que cada lista de películas también contenga un vínculo de **edición** .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-133">To begin, you'll update the *Movies* page so that each movie listing also contains an **Edit** link.</span></span>

<span data-ttu-id="3ee3a-134">Abra el archivo *movies. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-134">Open the *Movies.cshtml* file.</span></span>

<span data-ttu-id="3ee3a-135">En el cuerpo de la página, cambie el marcado `WebGrid` agregando una columna.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-135">In the body of the page, change the `WebGrid` markup by adding a column.</span></span> <span data-ttu-id="3ee3a-136">Este es el marcado modificado:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-136">Here's the modified markup:</span></span>

[!code-html[Main](updating-data/samples/sample1.html?highlight=6)]

<span data-ttu-id="3ee3a-137">La nueva columna es esta:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-137">The new column is this one:</span></span>

[!code-html[Main](updating-data/samples/sample2.html)]

<span data-ttu-id="3ee3a-138">El punto de esta columna es mostrar un vínculo (elemento`<a>`) cuyo texto dice "Edit".</span><span class="sxs-lookup"><span data-stu-id="3ee3a-138">The point of this column is to show a link (`<a>` element) whose text says "Edit".</span></span> <span data-ttu-id="3ee3a-139">Lo que es después es crear un vínculo similar al siguiente cuando se ejecuta la página, con el valor `id` diferente para cada película:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-139">What we're after is to create a link that looks like the following when the page runs, with the `id` value different for each movie:</span></span>

[!code-css[Main](updating-data/samples/sample3.css)]

<span data-ttu-id="3ee3a-140">Este vínculo invocará una página denominada *EditMovie*y pasará la cadena de consulta `?id=7` a esa página.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-140">This link will invoke a page named *EditMovie*, and it will pass the query string `?id=7` to that page.</span></span>

<span data-ttu-id="3ee3a-141">La sintaxis de la nueva columna podría parecer un poco compleja, pero esto solo se debe a que une varios elementos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-141">The syntax for the new column might look a bit complex, but that's only because it puts together several elements.</span></span> <span data-ttu-id="3ee3a-142">Cada elemento individual es sencillo.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-142">Each individual element is straightforward.</span></span> <span data-ttu-id="3ee3a-143">Si se concentra solo en el elemento `<a>`, verá este marcado:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-143">If you concentrate on just the `<a>` element, you see this markup:</span></span>

[!code-html[Main](updating-data/samples/sample4.html)]

<span data-ttu-id="3ee3a-144">Información general sobre cómo funciona la cuadrícula: la cuadrícula muestra las filas, una para cada registro de base de datos, y muestra las columnas de cada campo en el registro de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-144">Some background about how the grid works: the grid displays rows, one for each database record, and it displays columns for each field in the database record.</span></span> <span data-ttu-id="3ee3a-145">Mientras se construye cada fila de la cuadrícula, el objeto `item` contiene el registro de base de datos (elemento) de esa fila.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-145">While each grid row is being constructed, the `item` object contains the database record (item) for that row.</span></span> <span data-ttu-id="3ee3a-146">Esta disposición le proporciona una forma de obtener el código para obtener los datos de esa fila.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-146">This arrangement gives you a way in code to get at the data for that row.</span></span> <span data-ttu-id="3ee3a-147">Eso es lo que se ve aquí: la expresión `item.ID` obtiene el valor de identificador del elemento de base de datos actual.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-147">That's what you see here: the expression `item.ID` is getting the ID value of the current database item.</span></span> <span data-ttu-id="3ee3a-148">Puede obtener cualquiera de los valores de la base de datos (title, Genre o Year) del mismo modo mediante `item.Title`, `item.Genre`o `item.Year`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-148">You could get any of the database values (title, genre, or year) the same way by using `item.Title`, `item.Genre`, or `item.Year`.</span></span>

<span data-ttu-id="3ee3a-149">La expresión `"~/EditMovie?id=@item.ID` combina la parte codificada de forma rígida de la dirección URL de destino (`~/EditMovie?id=`) con este identificador derivado de forma dinámica.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-149">The expression `"~/EditMovie?id=@item.ID` combines the hard-coded part of the target URL (`~/EditMovie?id=`) with this dynamically derived ID.</span></span> <span data-ttu-id="3ee3a-150">(Vio el operador `~` en el tutorial anterior; es un operador ASP.NET que representa la raíz del sitio web actual).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-150">(You saw the `~` operator in the previous tutorial; it's an ASP.NET operator that represents the current website root.)</span></span>

<span data-ttu-id="3ee3a-151">El resultado es que esta parte del marcado en la columna simplemente genera algo parecido al siguiente marcado en tiempo de ejecución:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-151">The result is that this part of the markup in the column simply produces something like the following markup at run time:</span></span>

[!code-xml[Main](updating-data/samples/sample5.xml)]

<span data-ttu-id="3ee3a-152">Naturalmente, el valor real de `id` será diferente para cada fila.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-152">Naturally, the actual value of `id` will be different for each row.</span></span>

## <a name="creating-a-custom-display-for-a-grid-column"></a><span data-ttu-id="3ee3a-153">Crear una presentación personalizada para una columna de cuadrícula</span><span class="sxs-lookup"><span data-stu-id="3ee3a-153">Creating a Custom Display for a Grid Column</span></span>

<span data-ttu-id="3ee3a-154">Ahora vuelva a la columna Grid.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-154">Now back to the grid column.</span></span> <span data-ttu-id="3ee3a-155">Las tres columnas que originalmente tenía en la cuadrícula solo muestran valores de datos (título, género y año).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-155">The three columns you originally had in the grid displayed only data values (title, genre, and year).</span></span> <span data-ttu-id="3ee3a-156">Para especificar esta presentación, debe pasar el nombre de la columna de base de datos &mdash; por ejemplo, `grid.Column("Title")`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-156">You specified this display by passing the name of the database column &mdash; for example, `grid.Column("Title")`.</span></span>

<span data-ttu-id="3ee3a-157">Esta nueva columna de **edición** de vínculo es diferente.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-157">This new **Edit** link column is different.</span></span> <span data-ttu-id="3ee3a-158">En lugar de especificar un nombre de columna, está pasando un parámetro `format`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-158">Instead of specifying a column name, you're passing a `format` parameter.</span></span> <span data-ttu-id="3ee3a-159">Este parámetro permite definir el marcado que se representará en la aplicación auxiliar de `WebGrid` junto con el valor `item` para mostrar los datos de la columna en negrita o verde, o en el formato que desee.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-159">This parameter lets you define markup that the `WebGrid` helper will render along with the `item` value to display the column data as bold or green or in whatever format that you want.</span></span> <span data-ttu-id="3ee3a-160">Por ejemplo, si desea que el título aparezca en negrita, puede crear una columna como en este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-160">For example, if you wanted the title to appear bold, you could create a column like this example:</span></span>

[!code-html[Main](updating-data/samples/sample6.html)]

<span data-ttu-id="3ee3a-161">(Los distintos `@` caracteres que se ven en la propiedad `format` marcan la transición entre el marcado y un valor de código).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-161">(The various `@` characters you see in the `format` property mark the transition between markup and a code value.)</span></span>

<span data-ttu-id="3ee3a-162">Una vez que conozca la propiedad `format`, es más fácil comprender cómo se agrupa la nueva columna de vínculo de **edición** :</span><span class="sxs-lookup"><span data-stu-id="3ee3a-162">Once you know about the `format` property, it's easier to understand how the new **Edit** link column is put together:</span></span>

[!code-html[Main](updating-data/samples/sample7.html)]

<span data-ttu-id="3ee3a-163">La columna *solo* está formada por el marcado que representa el vínculo, más parte de la información (el ID.) que se extrae del registro de la base de datos de la fila.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-163">The column consists *only* of the markup that renders the link, plus some information (the ID) that's extracted from the database record for the row.</span></span>

> [!TIP]
> 
> <span data-ttu-id="3ee3a-164">**Parámetros con nombre y parámetros posicionales para un método**</span><span class="sxs-lookup"><span data-stu-id="3ee3a-164">**Named Parameters and Positional Parameters for a Method**</span></span>
> 
> <span data-ttu-id="3ee3a-165">Muchas veces, cuando se llama a un método y se le pasan parámetros, simplemente se muestran los valores de los parámetros separados por comas.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-165">Many times when you've called a method and passed parameters to it, you've simply listed the parameter values separated by commas.</span></span> <span data-ttu-id="3ee3a-166">A continuación se muestran un par de ejemplos:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-166">Here are a couple of examples:</span></span>
> 
> `db.Execute(insertCommand, title, genre, year)`
> 
> `Validation.RequireField("title", "You must enter a title")`
> 
> <span data-ttu-id="3ee3a-167">No mencionamos el problema la primera vez que vio este código, pero en cada caso, va a pasar parámetros a los métodos en un orden específico &mdash; nombre, el orden en el que se definen los parámetros en dicho método.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-167">We didn't mention the issue when you first saw this code, but in each case, you're passing parameters to the methods in a specific order &mdash; namely, the order in which the parameters are defined in that method.</span></span> <span data-ttu-id="3ee3a-168">Por `db.Execute` y `Validation.RequireFields`, si mezcla el orden de los valores que pasa, recibirá un mensaje de error al ejecutar la página o al menos algunos resultados extraños.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-168">For `db.Execute` and `Validation.RequireFields`, if you mixed up the order of the values you pass, you'd get an error message when the page runs, or at least some strange results.</span></span> <span data-ttu-id="3ee3a-169">Claramente, tiene que conocer el orden en el que debe pasar los parámetros.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-169">Clearly, you have to know the order to pass the parameters in.</span></span> <span data-ttu-id="3ee3a-170">(En WebMatrix, IntelliSense puede ayudarle a averiguar el nombre, el tipo y el orden de los parámetros).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-170">(In WebMatrix, IntelliSense can help you learn figure out the name, type, and order of the parameters.)</span></span>
> 
> <span data-ttu-id="3ee3a-171">Como alternativa a pasar valores en orden, puede usar *parámetros con nombre*.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-171">As an alternative to passing values in order, you can use *named parameters*.</span></span> <span data-ttu-id="3ee3a-172">(El paso de parámetros en orden se conoce como usar *parámetros posicionales*). En el caso de los parámetros con nombre, se incluye explícitamente el nombre del parámetro al pasar su valor.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-172">(Passing parameters in order is known as using *positional parameters*.) For named parameters, you explicitly include the name of the parameter when passing its value.</span></span> <span data-ttu-id="3ee3a-173">Ha usado parámetros con nombre ya varias veces en estos tutoriales.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-173">You've used named parameters already a number of times in these tutorials.</span></span> <span data-ttu-id="3ee3a-174">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-174">For example:</span></span>
> 
> [!code-csharp[Main](updating-data/samples/sample8.cs)]
> 
> <span data-ttu-id="3ee3a-175">y</span><span class="sxs-lookup"><span data-stu-id="3ee3a-175">and</span></span>
> 
> [!code-css[Main](updating-data/samples/sample9.css)]
> 
> <span data-ttu-id="3ee3a-176">Los parámetros con nombre son útiles para un par de situaciones, especialmente cuando un método toma muchos parámetros.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-176">Named parameters are handy for a couple of situations, especially when a method takes many parameters.</span></span> <span data-ttu-id="3ee3a-177">Una es cuando desea pasar solo uno o dos parámetros, pero los valores que desea pasar no están entre las primeras posiciones de la lista de parámetros.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-177">One is when you want to pass only one or two parameters, but the values you want to pass are not among the first positions in the parameter list.</span></span> <span data-ttu-id="3ee3a-178">Otra situación es cuando desea hacer que el código sea más legible pasando los parámetros en el orden que le resulte más conveniente.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-178">Another situation is when you want to make your code more readable by passing the parameters in the order that makes the most sense to you.</span></span>
> 
> <span data-ttu-id="3ee3a-179">Obviamente, para usar parámetros con nombre, debe conocer los nombres de los parámetros.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-179">Obviously, to use named parameters, you have to know the names of the parameters.</span></span> <span data-ttu-id="3ee3a-180">IntelliSense de WebMatrix puede *Mostrar* los nombres, pero actualmente no puede rellenarlos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-180">WebMatrix IntelliSense can *show* you the names, but it cannot currently fill them in for you.</span></span>

## <a name="creating-the-edit-page"></a><span data-ttu-id="3ee3a-181">Crear la página de edición</span><span class="sxs-lookup"><span data-stu-id="3ee3a-181">Creating the Edit Page</span></span>

<span data-ttu-id="3ee3a-182">Ahora puede crear la página *EditMovie* .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-182">Now you can create the *EditMovie* page.</span></span> <span data-ttu-id="3ee3a-183">Cuando los usuarios hagan clic en el vínculo **Editar** , terminarán en esta página.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-183">When users click the **Edit** link, they'll end up on this page.</span></span>

<span data-ttu-id="3ee3a-184">Cree una página denominada *EditMovie. cshtml* y reemplace lo que hay en el archivo con el marcado siguiente:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-184">Create a page named *EditMovie.cshtml* and replace what's in the file with the following markup:</span></span>

[!code-cshtml[Main](updating-data/samples/sample10.cshtml)]

<span data-ttu-id="3ee3a-185">Este marcado y código es similar a lo que tiene en la página *AddMovie* .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-185">This markup and code is similar to what you have in the *AddMovie* page.</span></span> <span data-ttu-id="3ee3a-186">Hay una pequeña diferencia en el texto del botón Enviar.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-186">There's a small difference in the text for the submit button.</span></span> <span data-ttu-id="3ee3a-187">Al igual que en la página *AddMovie* , hay una llamada `Html.ValidationSummary` que mostrará los errores de validación, si hay alguno.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-187">As with the *AddMovie* page, there's an `Html.ValidationSummary` call that will display validation errors if there are any.</span></span> <span data-ttu-id="3ee3a-188">Esta vez se omiten las llamadas a `Validation.Message`, ya que los errores se mostrarán en el Resumen de la validación.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-188">This time we're leaving out calls to `Validation.Message`, since errors will be displayed in the validation summary.</span></span> <span data-ttu-id="3ee3a-189">Como se indicó en el tutorial anterior, puede utilizar el Resumen de validación y los mensajes de error individuales en diversas combinaciones.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-189">As noted in the previous tutorial, you can use the validation summary and the individual error messages in various combinations.</span></span>

<span data-ttu-id="3ee3a-190">Observe de nuevo que el atributo `method` del elemento `<form>` está establecido en `post`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-190">Notice again that the `method` attribute of the `<form>` element is set to `post`.</span></span> <span data-ttu-id="3ee3a-191">Como con la página *AddMovie. cshtml* , esta página realiza cambios en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-191">As with the *AddMovie.cshtml* page, this page makes changes to the database.</span></span> <span data-ttu-id="3ee3a-192">Por lo tanto, este formulario debe realizar una operación de `POST`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-192">Therefore, this form should perform a `POST` operation.</span></span> <span data-ttu-id="3ee3a-193">(Para obtener más información sobre la diferencia entre las operaciones de `GET` y `POST`, vea la barra lateral de [seguridad del verbo GET, post y http](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) en el tutorial sobre formularios HTML).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-193">(For more about the difference between `GET` and `POST` operations, see the [GET, POST, and HTTP Verb Safety](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) sidebar in the tutorial on HTML forms.)</span></span>

<span data-ttu-id="3ee3a-194">Como vimos en un tutorial anterior, los `value` atributos de los cuadros de texto se establecen con código Razor para cargarlos previamente.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-194">As you saw in an earlier tutorial, the `value` attributes of the text boxes are being set with Razor code in order to preload them.</span></span> <span data-ttu-id="3ee3a-195">Sin embargo, esta vez se usan variables como `title` y `genre` para esa tarea en lugar de `Request.Form["title"]`:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-195">This time, though, you're using variables like `title` and `genre` for that task instead of `Request.Form["title"]`:</span></span>

`<input type="text" name="title" value="@title" />`

<span data-ttu-id="3ee3a-196">Como antes, este marcado cargará previamente los valores del cuadro de texto con los valores de la película.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-196">As before, this markup will preload the text box values with the movie values.</span></span> <span data-ttu-id="3ee3a-197">Verá en un momento por qué es práctico usar variables esta vez en lugar de usar el objeto `Request`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-197">You'll see in a moment why it's handy to use variables this time instead of using the `Request` object.</span></span>

<span data-ttu-id="3ee3a-198">También hay un `<input type="hidden">` elemento en esta página.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-198">There's also a `<input type="hidden">` element on this page.</span></span> <span data-ttu-id="3ee3a-199">Este elemento almacena el ID. de la película sin que esté visible en la página.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-199">This element stores the movie ID without making it visible on the page.</span></span> <span data-ttu-id="3ee3a-200">El identificador se pasa inicialmente a la página mediante el uso de un valor de cadena de consulta (`?id=7` o similar en la dirección URL).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-200">The ID is initially passed to the page by using a query string value (`?id=7` or similar in the URL).</span></span> <span data-ttu-id="3ee3a-201">Al colocar el valor de identificador en un campo oculto, puede asegurarse de que está disponible cuando se envía el formulario, aunque ya no tenga acceso a la dirección URL original con la que se invocó la página.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-201">By putting the ID value into a hidden field, you can make sure that it's available when the form is submitted, even if you no longer have access to the original URL that the page was invoked with.</span></span>

<span data-ttu-id="3ee3a-202">A diferencia de la página *AddMovie* , el código de la página *EditMovie* tiene dos funciones distintas.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-202">Unlike the *AddMovie* page, the code for the *EditMovie* page has two distinct functions.</span></span> <span data-ttu-id="3ee3a-203">La primera función es que cuando se muestra la página por primera vez (y *solo* después), el código obtiene el ID. de la película de la cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-203">The first function is that when the page is displayed for the first time (and *only* then), the code gets the movie ID from the query string.</span></span> <span data-ttu-id="3ee3a-204">A continuación, el código usa el identificador para leer la película correspondiente de la base de datos y mostrarla (cargar previamente) en los cuadros de texto.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-204">The code then uses the ID to read the corresponding movie out of the database and display (preload) it in the text boxes.</span></span>

<span data-ttu-id="3ee3a-205">La segunda función es que cuando el usuario hace clic en el botón **Enviar cambios** , el código tiene que leer los valores de los cuadros de texto y validarlos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-205">The second function is that when the user clicks the **Submit Changes** button, the code has to read the values of the text boxes and validate them.</span></span> <span data-ttu-id="3ee3a-206">El código también tiene que actualizar el elemento de base de datos con los nuevos valores.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-206">The code also has to update the database item with the new values.</span></span> <span data-ttu-id="3ee3a-207">Esta técnica es similar a agregar un registro, como se vio en *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-207">This technique is similar to adding a record, as you saw in *AddMovie*.</span></span>

## <a name="adding-code-to-read-a-single-movie"></a><span data-ttu-id="3ee3a-208">Agregar código para leer una sola película</span><span class="sxs-lookup"><span data-stu-id="3ee3a-208">Adding Code to Read a Single Movie</span></span>

<span data-ttu-id="3ee3a-209">Para realizar la primera función, agregue este código en la parte superior de la página:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-209">To perform the first function, add this code to the top of the page:</span></span>

[!code-cshtml[Main](updating-data/samples/sample11.cshtml)]

<span data-ttu-id="3ee3a-210">La mayor parte de este código se encuentra dentro de un bloque que inicia `if(!IsPost)`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-210">Most of this code is inside a block that starts `if(!IsPost)`.</span></span> <span data-ttu-id="3ee3a-211">El operador `!` significa "no", por lo que la expresión significa *si esta solicitud no es un envío post*, lo que es una forma indirecta de indicar *si esta solicitud es la primera vez que se ha ejecutado esta página*.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-211">The `!` operator means "not," so the expression means *if this request is not a post submission*, which is an indirect way of saying *if this request is the first time that this page has been run*.</span></span> <span data-ttu-id="3ee3a-212">Como se indicó anteriormente, este código debe ejecutarse *solo* la primera vez que se ejecuta la página.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-212">As noted earlier, this code should run *only* the first time the page runs.</span></span> <span data-ttu-id="3ee3a-213">Si no incluyó el código en `if(!IsPost)`, se ejecutaría cada vez que se invoque la página, ya sea la primera vez o en respuesta a un clic de botón.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-213">If you didn't enclose the code in `if(!IsPost)`, it would run every time the page is invoked, whether the first time or in response to a button click.</span></span>

<span data-ttu-id="3ee3a-214">Tenga en cuenta que el código incluye un bloque `else` esta vez.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-214">Notice that the code includes an `else` block this time.</span></span> <span data-ttu-id="3ee3a-215">Como hemos comentado cuando hemos introducido `if` bloques, a veces desea ejecutar código alternativo si la condición que está probando no es verdadera.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-215">As we said when we introduced `if` blocks, sometimes you want to run alternative code if the condition you're testing isn't true.</span></span> <span data-ttu-id="3ee3a-216">Este es el caso aquí.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-216">That's the case here.</span></span> <span data-ttu-id="3ee3a-217">Si la condición se supera (es decir, si el identificador pasado a la página es correcto), se lee una fila de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-217">If the condition passes (that is, if the ID passed to the page is ok), you read a row from the database.</span></span> <span data-ttu-id="3ee3a-218">Sin embargo, si no se supera la condición, se ejecuta el bloque `else` y el código establece un mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-218">However, if the condition doesn't pass, the `else` block runs and the code sets an error message.</span></span>

## <a name="validating-a-value-passed-to-the-page"></a><span data-ttu-id="3ee3a-219">Validar un valor que se pasa a la página</span><span class="sxs-lookup"><span data-stu-id="3ee3a-219">Validating a Value Passed to the Page</span></span>

<span data-ttu-id="3ee3a-220">El código usa `Request.QueryString["id"]` para obtener el identificador que se pasa a la página.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-220">The code uses `Request.QueryString["id"]` to get the ID that's passed to the page.</span></span> <span data-ttu-id="3ee3a-221">El código garantiza que un valor se ha pasado realmente para el identificador.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-221">The code makes sure that a value was actually passed for the ID.</span></span> <span data-ttu-id="3ee3a-222">Si no se ha pasado ningún valor, el código establece un error de validación.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-222">If no value was passed, the code sets a validation error.</span></span>

<span data-ttu-id="3ee3a-223">Este código muestra una manera diferente de validar la información.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-223">This code shows a different way to validate information.</span></span> <span data-ttu-id="3ee3a-224">En el tutorial anterior, ha trabajado con el ayudante de `Validation`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-224">In the previous tutorial, you worked with the `Validation` helper.</span></span> <span data-ttu-id="3ee3a-225">Ha registrado campos para validar, y ASP.NET ha realizado automáticamente la validación y ha mostrado errores mediante `Html.ValidationMessage` y `Html.ValidationSummary`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-225">You registered fields to validate, and ASP.NET automatically did the validation and displayed errors by using `Html.ValidationMessage` and `Html.ValidationSummary`.</span></span> <span data-ttu-id="3ee3a-226">Sin embargo, en este caso, no está validando realmente la entrada del usuario.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-226">In this case, however, you're not really validating user input.</span></span> <span data-ttu-id="3ee3a-227">En su lugar, está validando un valor que se pasó a la página desde otra parte.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-227">Instead, you're validating a value that was passed to the page from elsewhere.</span></span> <span data-ttu-id="3ee3a-228">La aplicación auxiliar de `Validation` no lo hace por usted.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-228">The `Validation` helper doesn't do that for you.</span></span>

<span data-ttu-id="3ee3a-229">Por lo tanto, para comprobar el valor, pruébelo con `if(!Request.QueryString["ID"].IsEmpty()`).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-229">Therefore, you check the value yourself, by testing it with `if(!Request.QueryString["ID"].IsEmpty()`).</span></span> <span data-ttu-id="3ee3a-230">Si hay algún problema, puede mostrar el error mediante `Html.ValidationSummary`, como hizo con la aplicación auxiliar de `Validation`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-230">If there's a problem, you can display the error by using `Html.ValidationSummary`, as you did with the `Validation` helper.</span></span> <span data-ttu-id="3ee3a-231">Para ello, llame a `Validation.AddFormError` y pásele un mensaje para mostrarlo.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-231">To do that, you call `Validation.AddFormError` and pass it a message to display.</span></span> <span data-ttu-id="3ee3a-232">`Validation.AddFormError` es un método integrado que le permite definir mensajes personalizados que se asocian con el sistema de validación con el que ya está familiarizado.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-232">`Validation.AddFormError` is a built-in method that lets you define custom messages that tie in with the validation system you're already familiar with.</span></span> <span data-ttu-id="3ee3a-233">(Más adelante en este tutorial hablaremos acerca de cómo hacer que este proceso de validación sea un poco más robusto).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-233">(Later in this tutorial we'll talk about how to make this validation process a little more robust.)</span></span>

<span data-ttu-id="3ee3a-234">Después de asegurarse de que hay un identificador para la película, el código lee la base de datos y solo busca un elemento de base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-234">After making sure that there's an ID for the movie, the code reads the database, looking for only a single database item.</span></span> <span data-ttu-id="3ee3a-235">(Probablemente ha observado el patrón general para las operaciones de base de datos: Abra la base de datos, defina una instrucción SQL y ejecute la instrucción). Esta vez, la instrucción de SQL `Select` incluye `WHERE ID = @0`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-235">(You probably have noticed the general pattern for database operations: open the database, define a SQL statement, and run the statement.) This time, the SQL `Select` statement includes `WHERE ID = @0`.</span></span> <span data-ttu-id="3ee3a-236">Dado que el identificador es único, solo se puede devolver un registro.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-236">Because the ID is unique, only one record can be returned.</span></span>

<span data-ttu-id="3ee3a-237">La consulta se realiza mediante `db.QuerySingle` (no `db.Query`, como se ha usado para la lista de películas) y el código coloca el resultado en la variable `row`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-237">The query is performed by using `db.QuerySingle` (not `db.Query`, as you used for the movie listing), and the code puts the result into the `row` variable.</span></span> <span data-ttu-id="3ee3a-238">El nombre `row` es arbitrario; puede asignar el nombre que desee a las variables.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-238">The name `row` is arbitrary; you can name the variables anything you like.</span></span> <span data-ttu-id="3ee3a-239">Las variables inicializadas en la parte superior se rellenan con los detalles de la película para que estos valores se puedan mostrar en los cuadros de texto.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-239">The variables initialized at the top are then filled with the movie details so that these values can be displayed in the text boxes.</span></span>

## <a name="testing-the-edit-page-so-far"></a><span data-ttu-id="3ee3a-240">Probar la página de edición (hasta ahora)</span><span class="sxs-lookup"><span data-stu-id="3ee3a-240">Testing the Edit Page (So Far)</span></span>

<span data-ttu-id="3ee3a-241">Si desea probar la página, ejecute la página *películas* ahora y haga clic en un vínculo de **edición** junto a cualquier película.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-241">If you'd like to test your page, run the *Movies* page now and click an **Edit** link next to any movie.</span></span> <span data-ttu-id="3ee3a-242">Verá la página *EditMovie* con los detalles rellenados para la película seleccionada:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-242">You'll see the *EditMovie* page with the details filled in for the movie you selected:</span></span>

![Editar la página de película que muestra la película que se va a editar](updating-data/_static/image3.png)

<span data-ttu-id="3ee3a-244">Observe que la dirección URL de la página incluye algo como `?id=10` (o algún otro número).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-244">Notice that the URL of the page includes something like `?id=10` (or some other number).</span></span> <span data-ttu-id="3ee3a-245">Hasta ahora, ha probado que los vínculos de **edición** en la página de la *película* funcionan, que la página está leyendo el identificador de la cadena de consulta y que la consulta de base de datos para obtener un único registro de película funciona.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-245">So far you've tested that **Edit** links in the *Movie* page work, that your page is reading the ID from the query string, and that the database query to get a single movie record is working.</span></span>

<span data-ttu-id="3ee3a-246">Puede cambiar la información de la película, pero no ocurre nada al hacer clic en **Enviar cambios**.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-246">You can change the movie information, but nothing happens when you click **Submit Changes**.</span></span>

## <a name="adding-code-to-update-the-movie-with-the-users-changes"></a><span data-ttu-id="3ee3a-247">Agregar código para actualizar la película con los cambios del usuario</span><span class="sxs-lookup"><span data-stu-id="3ee3a-247">Adding Code to Update the Movie with the User's Changes</span></span>

<span data-ttu-id="3ee3a-248">En el archivo *EditMovie. cshtml* , para implementar la segunda función (guardar cambios), agregue el código siguiente justo dentro de la llave de cierre del bloque `@`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-248">In the *EditMovie.cshtml* file, to implement the second function (saving changes), add the following code just inside the closing brace of the `@` block.</span></span> <span data-ttu-id="3ee3a-249">(Si no está seguro de dónde colocar el código exactamente, puede ver la [lista de código completa de la página Editar película](#Complete_Page_Listing_for_EditMovie) que aparece al final de este tutorial).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-249">(If you're not sure exactly where to put the code, you can look at the [complete code listing for the Edit Movie page](#Complete_Page_Listing_for_EditMovie) that appears at the end of this tutorial.)</span></span>

[!code-csharp[Main](updating-data/samples/sample12.cs)]

<span data-ttu-id="3ee3a-250">De nuevo, este marcado y el código son similares al código de *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-250">Again, this markup and code is similar to the code in *AddMovie*.</span></span> <span data-ttu-id="3ee3a-251">El código está en un bloque `if(IsPost)`, ya que este código solo se ejecuta cuando el usuario hace clic en el botón **Enviar cambios** &mdash; es decir, cuando se ha publicado el formulario (y solo cuando).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-251">The code is in an `if(IsPost)` block, because this code runs only when the user clicks the **Submit Changes** button &mdash; that is, when (and only when) the form has been posted.</span></span> <span data-ttu-id="3ee3a-252">En este caso, no está usando una prueba como `if(IsPost && Validation.IsValid())`, es decir, no está combinando ambas pruebas mediante y.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-252">In this case, you're not using a test like `if(IsPost && Validation.IsValid())`— that is, you're not combining both tests by using AND.</span></span> <span data-ttu-id="3ee3a-253">En esta página, primero se determina si hay un envío de formulario (`if(IsPost)`) y solo se registran los campos para la validación.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-253">In this page, you first determine whether there's a form submission (`if(IsPost)`), and only then register the fields for validation.</span></span> <span data-ttu-id="3ee3a-254">A continuación, puede probar los resultados de la validación (`if(Validation.IsValid()`).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-254">Then you can test the validation results (`if(Validation.IsValid()`).</span></span> <span data-ttu-id="3ee3a-255">El flujo es ligeramente diferente que en la página *AddMovie. cshtml* , pero el efecto es el mismo.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-255">The flow is slightly different than in the *AddMovie.cshtml* page, but the effect is the same.</span></span>

<span data-ttu-id="3ee3a-256">Los valores de los cuadros de texto se obtienen mediante `Request.Form["title"]` y un código similar para los demás elementos de `<input>`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-256">You get the values of the text boxes by using `Request.Form["title"]` and similar code for the other `<input>` elements.</span></span> <span data-ttu-id="3ee3a-257">Observe que esta vez, el código obtiene el ID. de película del campo oculto (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-257">Notice that this time, the code gets the movie ID out of the hidden field (`<input type="hidden">`).</span></span> <span data-ttu-id="3ee3a-258">Cuando se ejecutó la página por primera vez, el código obtenía el ID. de la cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-258">When the page ran the first time, the code got the ID out of the query string.</span></span> <span data-ttu-id="3ee3a-259">Obtiene el valor del campo oculto para asegurarse de que está obteniendo el identificador de la película que se mostró originalmente, en caso de que la cadena de consulta se modificara de algún modo desde entonces.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-259">You get the value from the hidden field to make sure that you're getting the ID of the movie that was originally displayed, in case the query string was somehow altered since then.</span></span>

<span data-ttu-id="3ee3a-260">La diferencia realmente importante entre el código *AddMovie* y este código es que en este código se utiliza la instrucción SQL `Update` en lugar de la instrucción `Insert Into`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-260">The really important difference between the *AddMovie* code and this code is that in this code you use the SQL `Update` statement instead of the `Insert Into` statement.</span></span> <span data-ttu-id="3ee3a-261">En el ejemplo siguiente se muestra la sintaxis de la instrucción de SQL `Update`:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-261">The following example shows the syntax of the SQL `Update` statement:</span></span>

`UPDATE table SET col1="value", col2="value", col3="value" ... WHERE ID = value`

<span data-ttu-id="3ee3a-262">Puede especificar cualquier columna en cualquier orden y no es necesario actualizar todas las columnas durante una operación de `Update`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-262">You can specify any columns in any order, and you don't necessarily have to update every column during an `Update` operation.</span></span> <span data-ttu-id="3ee3a-263">(No se puede actualizar el propio identificador, ya que esto haría en efecto que el registro se guardara como un registro nuevo y eso no se permite para una operación `Update`).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-263">(You cannot update the ID itself, because that would in effect save the record as a new record, and that's not allowed for an `Update` operation.)</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="3ee3a-264">**Importante** La cláusula `Where` con el identificador es muy importante, ya que es la forma en que la base de datos sabe qué registro de base de datos desea actualizar.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-264">**Important** The `Where` clause with the ID is very important, because that's how the database knows which database record you want to update.</span></span> <span data-ttu-id="3ee3a-265">Si deja fuera de la cláusula `Where`, la base de datos actualizaría *todos* los registros de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-265">If you left off the `Where` clause, the database would update *every* record in the database.</span></span> <span data-ttu-id="3ee3a-266">En la mayoría de los casos, esto sería un desastre.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-266">In most cases, that would be a disaster.</span></span>

<span data-ttu-id="3ee3a-267">En el código, los valores que se van a actualizar se pasan a la instrucción SQL mediante marcadores de posición.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-267">In the code, the values to update are passed to the SQL statement by using placeholders.</span></span> <span data-ttu-id="3ee3a-268">Para repetir lo que hemos dicho antes: por razones de seguridad, use *solo* los marcadores de posición para pasar valores a una instrucción SQL.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-268">To repeat what we've said before: for security reasons, *only* use placeholders to pass values to a SQL statement.</span></span>

<span data-ttu-id="3ee3a-269">Una vez que el código usa `db.Execute` para ejecutar la instrucción de `Update`, redirige de nuevo a la página de lista, donde puede ver los cambios.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-269">After the code uses `db.Execute` to run the `Update` statement, it redirects back to the listing page, where you can see the changes.</span></span>

> [!TIP] 
> 
> <span data-ttu-id="3ee3a-270">**Diferentes instrucciones SQL, métodos diferentes**</span><span class="sxs-lookup"><span data-stu-id="3ee3a-270">**Different SQL Statements, Different Methods**</span></span>
> 
> <span data-ttu-id="3ee3a-271">Es posible que haya observado que usa métodos ligeramente diferentes para ejecutar diferentes instrucciones SQL.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-271">You might have noticed that you use slightly different methods to run different SQL statements.</span></span> <span data-ttu-id="3ee3a-272">Para ejecutar una consulta `Select` que puede devolver varios registros, se usa el método `Query`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-272">To run a `Select` query that potentially returns multiple records, you use the `Query` method.</span></span> <span data-ttu-id="3ee3a-273">Para ejecutar una consulta de `Select` que sepa que solo devolverá un elemento de base de datos, use el método `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-273">To run a `Select` query that you know will return only one database item, you use the `QuerySingle` method.</span></span> <span data-ttu-id="3ee3a-274">Para ejecutar comandos que realizan cambios pero que no devuelven elementos de base de datos, use el método `Execute`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-274">To run commands that make changes but that don't return database items, you use the `Execute` method.</span></span>
> 
> <span data-ttu-id="3ee3a-275">Debe tener métodos diferentes porque cada uno de ellos devuelve resultados diferentes, como ya vio en la diferencia entre `Query` y `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-275">You have to have different methods because each of them returns different results, as you saw already in the difference between `Query` and `QuerySingle`.</span></span> <span data-ttu-id="3ee3a-276">(El método `Execute` devuelve realmente un valor que también &mdash; nombre, el número de filas de base de datos afectadas por el comando &mdash; pero se ha omitido hasta ahora).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-276">(The `Execute` method actually returns a value also &mdash; namely, the number of database rows that were affected by the command &mdash; but you've been ignoring that so far.)</span></span>
> 
> <span data-ttu-id="3ee3a-277">Por supuesto, el método `Query` podría devolver solo una fila de base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-277">Of course, the `Query` method might return only one database row.</span></span> <span data-ttu-id="3ee3a-278">Sin embargo, ASP.NET siempre trata los resultados del método `Query` como una colección.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-278">However, ASP.NET always treats the results of the `Query` method as a collection.</span></span> <span data-ttu-id="3ee3a-279">Incluso si el método devuelve solo una fila, tendrá que extraer esa fila de la colección.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-279">Even if the method returns just one row, you have to extract that single row from the collection.</span></span> <span data-ttu-id="3ee3a-280">Por lo tanto, en situaciones en las que *sepa* que solo obtendrá una fila, es un poco más práctico usar `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-280">Therefore, in situations where you *know* you'll get back only one row, it's a bit more convenient to use `QuerySingle`.</span></span>
> 
> <span data-ttu-id="3ee3a-281">Hay otros métodos que realizan tipos específicos de operaciones de base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-281">There are a few other methods that perform specific types of database operations.</span></span> <span data-ttu-id="3ee3a-282">Puede encontrar una lista de métodos de base de datos en la [referencia rápida de ASP.NET Web pages API](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-282">You can find a listing of database methods in the [ASP.NET Web Pages API Quick Reference](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span></span>

## <a name="making-validation-for-the-id-more-robust"></a><span data-ttu-id="3ee3a-283">Realización de la validación del identificador más sólida</span><span class="sxs-lookup"><span data-stu-id="3ee3a-283">Making Validation for the ID More Robust</span></span>

<span data-ttu-id="3ee3a-284">La primera vez que se ejecuta la página, obtiene el ID. de la película de la cadena de consulta para que pueda obtener esa película desde la base de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-284">The first time that the page runs, you get the movie ID from the query string so that you can go get that movie from the database.</span></span> <span data-ttu-id="3ee3a-285">Asegúrese de que realmente haya un valor para buscar, que ha hecho con este código:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-285">You made sure that there actually was a value to go look for, which you did by using this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample13.cs)]

<span data-ttu-id="3ee3a-286">Usó este código para asegurarse de que si un usuario llega a la página de *EditMovies* sin seleccionar primero una película en la página *películas* , la página mostraría un mensaje de error descriptivo.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-286">You used this code to make sure that if a user gets to the *EditMovies* page without first selecting a movie in the *Movies* page, the page would display a user-friendly error message.</span></span> <span data-ttu-id="3ee3a-287">(De lo contrario, los usuarios verán un error que probablemente simplemente les confundiría).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-287">(Otherwise, users would see an error that would probably just confuse them.)</span></span>

<span data-ttu-id="3ee3a-288">Sin embargo, esta validación no es muy robusta.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-288">However, this validation isn't very robust.</span></span> <span data-ttu-id="3ee3a-289">La página también se puede invocar con estos errores:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-289">The page might also be invoked with these errors:</span></span>

- <span data-ttu-id="3ee3a-290">El identificador no es un número.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-290">The ID isn't a number.</span></span> <span data-ttu-id="3ee3a-291">Por ejemplo, la página se podría invocar con una dirección URL como `http://localhost:nnnnn/EditMovie?id=abc`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-291">For example, the page could be invoked with a URL like `http://localhost:nnnnn/EditMovie?id=abc`.</span></span>
- <span data-ttu-id="3ee3a-292">El identificador es un número, pero hace referencia a una película que no existe (por ejemplo, `http://localhost:nnnnn/EditMovie?id=100934`).</span><span class="sxs-lookup"><span data-stu-id="3ee3a-292">The ID is a number, but it references a movie that doesn't exist (for example, `http://localhost:nnnnn/EditMovie?id=100934`).</span></span>

<span data-ttu-id="3ee3a-293">Si tiene curiosidad por ver los errores resultantes de estas direcciones URL, ejecute la página *películas* .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-293">If you're curious to see the errors that result from these URLs, run the *Movies* page.</span></span> <span data-ttu-id="3ee3a-294">Seleccione una película para editarla y, a continuación, cambie la dirección URL de la página *EditMovie* por una dirección URL que contenga un identificador alfabético o el ID. de una película no existente.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-294">Select a movie to edit, and then change the URL of the *EditMovie* page to a URL that contains an alphabetic ID or the ID of a non-existent movie.</span></span>

<span data-ttu-id="3ee3a-295">¿Qué debe hacer?</span><span class="sxs-lookup"><span data-stu-id="3ee3a-295">So what should you do?</span></span> <span data-ttu-id="3ee3a-296">La primera corrección es asegurarse de que no solo se pasa un identificador a la página, pero que el identificador es un entero.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-296">The first fix is to make sure that not only is an ID passed to the page, but that the ID is an integer.</span></span> <span data-ttu-id="3ee3a-297">Cambie el código para que la prueba de `!IsPost` sea similar a la de este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-297">Change the code for the `!IsPost` test to look like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample14.cs)]

<span data-ttu-id="3ee3a-298">Ha agregado una segunda condición a la prueba de `IsEmpty`, vinculada con `&&` (AND lógico):</span><span class="sxs-lookup"><span data-stu-id="3ee3a-298">You've added a second condition to the `IsEmpty` test, linked with `&&` (logical AND):</span></span>

[!code-csharp[Main](updating-data/samples/sample15.cs)]

<span data-ttu-id="3ee3a-299">Es posible que recuerde de la [Introducción a ASP.NET Web pages](../introducing-razor-syntax-c.md) tutorial de programación que métodos como `AsBool` un `AsInt` convertir una cadena de caracteres a algún otro tipo de datos.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-299">You might remember from the [Introduction to ASP.NET Web Pages Programming](../introducing-razor-syntax-c.md) tutorial that methods like `AsBool` an `AsInt` convert a character string to some other data type.</span></span> <span data-ttu-id="3ee3a-300">El método `IsInt` (y otros, como `IsBool` y `IsDateTime`) son similares.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-300">The `IsInt` method (and others, like `IsBool` and `IsDateTime`) are similar.</span></span> <span data-ttu-id="3ee3a-301">Sin embargo, solo prueban si *puede* convertir la cadena, sin realizar realmente la conversión.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-301">However, they test only whether you *can* convert the string, without actually performing the conversion.</span></span> <span data-ttu-id="3ee3a-302">Por lo tanto, aquí está diciendo *en esencia si el valor de la cadena de consulta se puede convertir en un entero...* .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-302">So here you're essentially saying *If the query string value can be converted to an integer ...*.</span></span>

<span data-ttu-id="3ee3a-303">El otro problema potencial es buscar una película que no existe.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-303">The other potential problem is looking for a movie that doesn't exist.</span></span> <span data-ttu-id="3ee3a-304">El código para obtener una película es similar a este código:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-304">The code to get a movie looks like this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample16.cs)]

<span data-ttu-id="3ee3a-305">Si pasa un valor `movieId` al método `QuerySingle` que no se corresponde con una película real, no se devuelve nada y las instrucciones siguientes (por ejemplo, `title=row.Title`) producen errores.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-305">If you pass a `movieId` value to the `QuerySingle` method that doesn't correspond to an actual movie, nothing is returned and the statements that follow (for example, `title=row.Title`) result in errors.</span></span>

<span data-ttu-id="3ee3a-306">Una vez más, hay una solución fácil.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-306">Again there's an easy fix.</span></span> <span data-ttu-id="3ee3a-307">Si el método `db.QuerySingle` no devuelve ningún resultado, la variable `row` será null.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-307">If the `db.QuerySingle` method returns no results, the `row` variable will be null.</span></span> <span data-ttu-id="3ee3a-308">Por lo tanto, puede comprobar si la variable `row` es NULL antes de intentar obtener valores de ella.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-308">So you can check whether the `row` variable is null before you try to get values from it.</span></span> <span data-ttu-id="3ee3a-309">En el código siguiente se agrega un bloque `if` alrededor de las instrucciones que obtienen los valores del objeto `row`:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-309">The following code adds an `if` block around the statements that get the values out of the `row` object:</span></span>

[!code-csharp[Main](updating-data/samples/sample17.cs)]

<span data-ttu-id="3ee3a-310">Con estas dos pruebas de validación adicionales, la página se vuelve más detallada.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-310">With these two additional validation tests, the page becomes more bullet-proof.</span></span> <span data-ttu-id="3ee3a-311">El código completo de la rama `!IsPost` ahora es similar a este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-311">The complete code for the `!IsPost` branch now looks like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample18.cs)]

<span data-ttu-id="3ee3a-312">Tendremos en cuenta que esta tarea es un buen uso para un bloque de `else`.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-312">We'll note once more that this task is a good use for an `else` block.</span></span> <span data-ttu-id="3ee3a-313">Si no se superan las pruebas, los bloques de `else` establecen mensajes de error.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-313">If the tests don't pass, the `else` blocks set error messages.</span></span>

## <a name="adding-a-link-to-return-to-the-movies-page"></a><span data-ttu-id="3ee3a-314">Agregar un vínculo para volver a la página de películas</span><span class="sxs-lookup"><span data-stu-id="3ee3a-314">Adding a Link to Return to the Movies Page</span></span>

<span data-ttu-id="3ee3a-315">Un detalle final y útil es volver a agregar un vínculo a la página *películas* .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-315">A final and helpful detail is to add a link back to the *Movies* page.</span></span> <span data-ttu-id="3ee3a-316">En el flujo de eventos normal, los usuarios se inician en la página *películas* y hacen clic en un vínculo **Editar** .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-316">In the ordinary flow of events, users will start at the *Movies* page and click an **Edit** link.</span></span> <span data-ttu-id="3ee3a-317">Esto los coloca en la página *EditMovie* , donde pueden editar la película y hacer clic en el botón.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-317">That brings them to the *EditMovie* page, where they can edit the movie and click the button.</span></span> <span data-ttu-id="3ee3a-318">Una vez que el código procesa el cambio, redirige de nuevo a la página de *películas* .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-318">After the code processes the change, it redirects back to the *Movies* page.</span></span>

<span data-ttu-id="3ee3a-319">Pero:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-319">However:</span></span>

- <span data-ttu-id="3ee3a-320">El usuario puede decidir no cambiar nada.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-320">The user might decide not to change anything.</span></span>
- <span data-ttu-id="3ee3a-321">Es posible que el usuario haya llegado a esta página sin hacer clic primero en el vínculo **Editar** de la página *películas* .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-321">The user might have gotten to this page without first clicking an **Edit** link in the *Movies* page.</span></span>

<span data-ttu-id="3ee3a-322">En cualquier caso, desea que resulte fácil volver a la lista principal.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-322">Either way, you want to make it easy for them to return to the main listing.</span></span> <span data-ttu-id="3ee3a-323">Es una solución sencilla &mdash; agregar el marcado siguiente justo después de la etiqueta de cierre `</form>` en el marcado:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-323">It's an easy fix &mdash; add the following markup just after the closing `</form>` tag in the markup:</span></span>

[!code-html[Main](updating-data/samples/sample19.html)]

<span data-ttu-id="3ee3a-324">Este marcado usa la misma sintaxis para un elemento `<a>` que ha visto en otro lugar.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-324">This markup uses the same syntax for an `<a>` element that you've seen elsewhere.</span></span> <span data-ttu-id="3ee3a-325">La dirección URL incluye `~` que significa "raíz del sitio web".</span><span class="sxs-lookup"><span data-stu-id="3ee3a-325">The URL includes `~` to mean "root of the website."</span></span>

## <a name="testing-the-movie-update-process"></a><span data-ttu-id="3ee3a-326">Probar el proceso de actualización de la película</span><span class="sxs-lookup"><span data-stu-id="3ee3a-326">Testing the Movie Update Process</span></span>

<span data-ttu-id="3ee3a-327">Ahora puede probar.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-327">Now you can test.</span></span> <span data-ttu-id="3ee3a-328">Ejecute la página *películas* y haga clic en **Editar** junto a una película.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-328">Run the *Movies* page, and click **Edit** next to a movie.</span></span> <span data-ttu-id="3ee3a-329">Cuando aparezca la página *EditMovie* , realice cambios en la película y haga clic en **Enviar cambios**.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-329">When the *EditMovie* page appears, make changes to the movie and click **Submit Changes**.</span></span> <span data-ttu-id="3ee3a-330">Cuando aparezca la lista de películas, asegúrese de que se muestran los cambios.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-330">When the movie listing appears, make sure that your changes are shown.</span></span>

<span data-ttu-id="3ee3a-331">Para asegurarse de que la validación funciona, haga clic en **Editar** para otra película.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-331">To make sure that validation is working, click **Edit** for another movie.</span></span> <span data-ttu-id="3ee3a-332">Cuando llegue a la página *EditMovie* , borre el campo **Genre** (o el campo **Year** , o ambos) e intente enviar los cambios.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-332">When you get to the *EditMovie* page, clear the **Genre** field (or **Year** field, or both) and try to submit your changes.</span></span> <span data-ttu-id="3ee3a-333">Verá un error, como cabría esperar:</span><span class="sxs-lookup"><span data-stu-id="3ee3a-333">You'll see an error, as you'd expect:</span></span>

![Página Editar película que muestra los errores de validación](updating-data/_static/image4.png)

<span data-ttu-id="3ee3a-335">Haga clic en el vínculo **volver a la lista de películas** para abandonar los cambios y volver a la página *películas* .</span><span class="sxs-lookup"><span data-stu-id="3ee3a-335">Click the **Return to movie listing** link to abandon your changes and return to the *Movies* page.</span></span>

## <a name="coming-up-next"></a><span data-ttu-id="3ee3a-336">Próxima</span><span class="sxs-lookup"><span data-stu-id="3ee3a-336">Coming Up Next</span></span>

<span data-ttu-id="3ee3a-337">En el siguiente tutorial, verá cómo eliminar un registro de película.</span><span class="sxs-lookup"><span data-stu-id="3ee3a-337">In the next tutorial, you'll see how to delete a movie record.</span></span>

## <a name="complete-listing-for-movie-page-updated-with-edit-links"></a><span data-ttu-id="3ee3a-338">Lista completa de la página de la película (actualizada con los vínculos de edición)</span><span class="sxs-lookup"><span data-stu-id="3ee3a-338">Complete Listing for Movie Page (Updated with Edit Links)</span></span>

[!code-cshtml[Main](updating-data/samples/sample20.cshtml)]

<a id="Complete_Page_Listing_for_EditMovie"></a>
## <a name="complete-page-listing-for-edit-movie-page"></a><span data-ttu-id="3ee3a-339">Lista completa de páginas para editar película</span><span class="sxs-lookup"><span data-stu-id="3ee3a-339">Complete Page Listing for Edit Movie Page</span></span>

[!code-cshtml[Main](updating-data/samples/sample21.cshtml)]

## <a name="additional-resources"></a><span data-ttu-id="3ee3a-340">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="3ee3a-340">Additional Resources</span></span>

- [<span data-ttu-id="3ee3a-341">Introducción a la programación web de ASP.NET mediante la sintaxis Razor</span><span class="sxs-lookup"><span data-stu-id="3ee3a-341">Introduction to ASP.NET Web Programming by Using the Razor Syntax</span></span>](../../getting-started/introducing-razor-syntax-c.md)
- <span data-ttu-id="3ee3a-342">[Instrucción UPDATE de SQL](http://www.w3schools.com/sql/sql_update.asp) en el sitio de w3schools</span><span class="sxs-lookup"><span data-stu-id="3ee3a-342">[SQL UPDATE Statement](http://www.w3schools.com/sql/sql_update.asp) on the W3Schools site</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3ee3a-343">[Anterior](entering-data.md)
> [Siguiente](deleting-data.md)</span><span class="sxs-lookup"><span data-stu-id="3ee3a-343">[Previous](entering-data.md)
[Next](deleting-data.md)</span></span>
