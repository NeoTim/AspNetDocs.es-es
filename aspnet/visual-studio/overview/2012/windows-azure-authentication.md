---
uid: visual-studio/overview/2012/windows-azure-authentication
title: Autenticación de Windows Azure | Microsoft Docs
author: Rick-Anderson
description: Microsoft ASP.NET Tools para Windows Azure Active Directory facilita la habilitación de la autenticación para las aplicaciones web hospedadas en sitios web de Windows Azure...
ms.author: riande
ms.date: 02/20/2013
ms.assetid: a3cef801-a54b-4ebd-93c3-55764e2e14b1
msc.legacyurl: /visual-studio/overview/2012/windows-azure-authentication
msc.type: authoredcontent
ms.openlocfilehash: ce98effe18dd739504fb0d5453bae8a46c3ba102
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457484"
---
# <a name="windows-azure-authentication"></a><span data-ttu-id="ba519-103">Autenticación de Windows Azure</span><span class="sxs-lookup"><span data-stu-id="ba519-103">Windows Azure Authentication</span></span>

<span data-ttu-id="ba519-104">por [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="ba519-104">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="ba519-105">Microsoft ASP.NET Tools para Windows Azure Active Directory facilita la habilitación de la autenticación para las aplicaciones web hospedadas en [sitios web de Windows Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="ba519-105">Microsoft ASP.NET tools for Windows Azure Active Directory makes it simple to enable authentication for web applications hosted on [Windows Azure Web Sites](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="ba519-106">Puede usar la autenticación de Windows Azure para autenticar a los usuarios de Office 365 de su organización, las cuentas corporativas sincronizadas desde su Active Directory local o los usuarios creados en su propio dominio personalizado de Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ba519-106">You can use Windows Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Windows Azure Active Directory domain.</span></span> <span data-ttu-id="ba519-107">Al habilitar la autenticación de Windows Azure, se configura la aplicación para autenticar a los usuarios mediante un solo inquilino de [Windows Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) .</span><span class="sxs-lookup"><span data-stu-id="ba519-107">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Windows Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>
>
> <span data-ttu-id="ba519-108">La herramienta de autenticación de Windows Azure ASP.NET no se admite para los roles Web en un servicio en la nube, pero tenemos previsto hacerlo en una versión futura.</span><span class="sxs-lookup"><span data-stu-id="ba519-108">The ASP.NET Windows Azure Authentication tool is not supported for web roles in a cloud service but we plan to do so in a future release.</span></span> <span data-ttu-id="ba519-109">[Windows Identity Foundation](https://msdn.microsoft.com/library/hh291066(v=VS.110).aspx) (WIF) se admite en los roles Web de Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="ba519-109">[Windows Identity Foundation](https://msdn.microsoft.com/library/hh291066(v=VS.110).aspx) (WIF) is supported in Windows Azure web roles.</span></span>
>
> <span data-ttu-id="ba519-110">Para obtener más información sobre cómo configurar la sincronización entre el Active Directory local y el inquilino de Windows Azure Active Directory, consulte [usar AD FS 2,0 para implementar y administrar el inicio de sesión único](https://technet.microsoft.com/library/jj205462.aspx).</span><span class="sxs-lookup"><span data-stu-id="ba519-110">For details on how to setup synchronization between your on-premise Active Directory and your Windows Azure Active Directory tenant please see [Use AD FS 2.0 to implement and manage single sign-on](https://technet.microsoft.com/library/jj205462.aspx).</span></span>
>
> <span data-ttu-id="ba519-111">Windows Azure Active Directory está disponible actualmente como [servicio de vista previa gratis](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span><span class="sxs-lookup"><span data-stu-id="ba519-111">Windows Azure Active Directory is currently available as a [free preview service](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span></span>

## <a name="requirements"></a><span data-ttu-id="ba519-112">Requisitos:</span><span class="sxs-lookup"><span data-stu-id="ba519-112">Requirements:</span></span>

- <span data-ttu-id="ba519-113">Visual Studio 2012 o [Visual Studio Express 2012](https://www.microsoft.com/visualstudio/11/products/express)</span><span class="sxs-lookup"><span data-stu-id="ba519-113">Visual Studio 2012 or [Visual Studio Express 2012](https://www.microsoft.com/visualstudio/11/products/express)</span></span>
- <span data-ttu-id="ba519-114">[Extensiones de herramientas web para Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282228&amp;clcid=0x409) o [extensiones de herramientas web para Visual Studio Express 2012](https://go.microsoft.com/fwlink/?LinkID=282231&amp;clcid=0x409)</span><span class="sxs-lookup"><span data-stu-id="ba519-114">[Web Tools Extensions for Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282228&amp;clcid=0x409) or [Web Tools Extensions for Visual Studio Express 2012](https://go.microsoft.com/fwlink/?LinkID=282231&amp;clcid=0x409)</span></span>
- <span data-ttu-id="ba519-115">[Herramientas de Microsoft ASP.net para windows Azure Active Directory: Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282306) o [Microsoft ASP.net tools para windows Azure Active Directory: Visual Studio Express 2012 para web](https://go.microsoft.com/fwlink/?LinkId=282652)</span><span class="sxs-lookup"><span data-stu-id="ba519-115">[Microsoft ASP.NET Tools for Windows Azure Active Directory – Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282306) or [Microsoft ASP.NET Tools for Windows Azure Active Directory – Visual Studio Express 2012 for Web](https://go.microsoft.com/fwlink/?LinkId=282652)</span></span>

## <a name="create-an-aspnet-web-application-with-visual-studio-2012"></a><span data-ttu-id="ba519-116">Creación de una aplicación Web de ASP.NET con Visual Studio 2012</span><span class="sxs-lookup"><span data-stu-id="ba519-116">Create an ASP.NET Web Application with Visual Studio 2012</span></span>

<span data-ttu-id="ba519-117">Puede crear cualquier aplicación web con Visual Studio 2012, en este tutorial se usa la plantilla de intranet de ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="ba519-117">You can create any Web Application with Visual Studio 2012, this tutorial uses the ASP.NET MVC intranet template.</span></span>

1. <span data-ttu-id="ba519-118">Cree una nueva aplicación de intranet ASP.NET MVC 4 y acepte todos los valores predeterminados.</span><span class="sxs-lookup"><span data-stu-id="ba519-118">Create a new ASP.NET MVC 4 Intranet Application and accept all the defaults.</span></span> <span data-ttu-id="ba519-119">(Debe ser una en **tra** net y no en el proyecto **ter** net).</span><span class="sxs-lookup"><span data-stu-id="ba519-119">(It must be an In **tra** net and not In **ter** net project).</span></span>
     ![](windows-azure-authentication/_static/image1.png)

## <a name="enable-window-azure-authentication-when-you-are-a-global-administrator-of-the-tenet"></a><span data-ttu-id="ba519-120">Habilitación de la autenticación de Windows Azure (cuando es un administrador global del principio)</span><span class="sxs-lookup"><span data-stu-id="ba519-120">Enable Window Azure Authentication (When you are a Global Administrator of the Tenet)</span></span>

<span data-ttu-id="ba519-121">Si no tiene un inquilino de Windows Azure Active Directory existente (por ejemplo, a través de una cuenta existente de Office 365), puede crear un nuevo inquilino. para ello, Regístrese para obtener una [nueva cuenta de Windows Azure Active Directory](https://g.microsoftonline.com/0AX00en/5).</span><span class="sxs-lookup"><span data-stu-id="ba519-121">If you do not have an existing Windows Azure Active Directory tenant (For example, through an existing Office 365 account) you can create a new tenant by signing up for a [new Windows Azure Active Directory account](https://g.microsoftonline.com/0AX00en/5).</span></span>

1. <span data-ttu-id="ba519-122">En el menú proyecto, seleccione **Habilitar autenticación de Windows Azure**:</span><span class="sxs-lookup"><span data-stu-id="ba519-122">From the Project menu select **Enable Windows Azure Authentication**:</span></span>

   ![](windows-azure-authentication/_static/image2.png)

2. <span data-ttu-id="ba519-123">Escriba el dominio del inquilino de Windows Azure Active Directory (por ejemplo, contoso.onmicrosoft.com) y haga clic en **Habilitar**:</span><span class="sxs-lookup"><span data-stu-id="ba519-123">Enter the domain for your Windows Azure Active Directory tenant (for example, contoso.onmicrosoft.com) and click **Enable**:</span></span>

![](windows-azure-authentication/_static/image3.png)

3. <span data-ttu-id="ba519-124">En el cuadro de diálogo de autenticación Web, inicie sesión como administrador del inquilino de Windows Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="ba519-124">In the Web Authentication dialog sign in as an administrator for your Windows Azure Active Directory tenant:</span></span>

   ![](windows-azure-authentication/_static/image4.png)

![](windows-azure-authentication/_static/image5.png)

## <a name="enable-window-azure-by-a-non-administrator-of-the-tenet"></a><span data-ttu-id="ba519-125">Habilitación de Windows Azure por parte de un no administrador del principio</span><span class="sxs-lookup"><span data-stu-id="ba519-125">Enable Window Azure by a non-administrator of the Tenet</span></span>

<span data-ttu-id="ba519-126">Si no tiene privilegios de administrador global para el inquilino de Windows Azure Active Directory, puede desactivar la casilla para aprovisionar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba519-126">If you do not have Global Administrator privilege for your Windows Azure Active Directory tenant, you can uncheck the checkbox for provisioning the application.</span></span>

![](windows-azure-authentication/_static/image6.png)

<span data-ttu-id="ba519-127">El cuadro de diálogo mostrará el **dominio**, el **identificador** de la entidad de seguridad de la aplicación y la **dirección URL de respuesta** necesarios para aprovisionar la aplicación con un Azure Active Directory principio.</span><span class="sxs-lookup"><span data-stu-id="ba519-127">The dialog will display the **Domain**, **Application Principal Id** and **Reply URL** which are required for provisioning the application with an Azure Active Directory tenet.</span></span> <span data-ttu-id="ba519-128">Debe proporcionar esta información a alguien que tenga privilegios suficientes para aprovisionar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba519-128">You need to give this information to someone who has sufficient privilege to provision the application.</span></span> <span data-ttu-id="ba519-129">Consulte[cómo implementar el inicio de sesión único con la aplicación Azure Active Directory-ASP.net de Windows](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect) para obtener más información sobre cómo usar el cmdlet para crear la entidad de servicio manualmente.</span><span class="sxs-lookup"><span data-stu-id="ba519-129">See[How to implement single sign-on with Windows Azure Active Directory - ASP.NET Application](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect) for details on how to use cmdlet to create the service principal manually.</span></span>
<span data-ttu-id="ba519-130">Una vez que la aplicación se haya aprovisionado correctamente, puede hacer clic en **continuar para actualizar Web. config con la configuración seleccionada**.</span><span class="sxs-lookup"><span data-stu-id="ba519-130">Once the application has been successfully provisioned, you can click on **Continue to update web.config with the selected settings**.</span></span> <span data-ttu-id="ba519-131">Si desea continuar desarrollando la aplicación mientras espera a que se produzca el aprovisionamiento, puede hacer clic en **Cerrar para recordar la configuración del archivo de proyecto**.</span><span class="sxs-lookup"><span data-stu-id="ba519-131">If you want to continue developing the application while waiting for provisioning to happen, you can click **Close to remember the settings in project file**.</span></span> <span data-ttu-id="ba519-132">La próxima vez que se invoque habilitar autenticación de Windows Azure y desactive la casilla aprovisionamiento, verá la misma configuración y podrá hacer clic en **continuar**y, a continuación, en **aplicar esta configuración en el archivo Web. config**.</span><span class="sxs-lookup"><span data-stu-id="ba519-132">The next time you invoke Enable Windows Azure Authentication and uncheck the provisioning checkbox, you will see the same settings and you can click **Continue**, then click, **Apply these settings in web.config**.</span></span>

1. <span data-ttu-id="ba519-133">Espere mientras la aplicación está configurada para la autenticación de Windows Azure y aprovisionada con Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ba519-133">Wait while your application is configured for Windows Azure Authentication and provisioned with Windows Azure Active Directory.</span></span>
2. <span data-ttu-id="ba519-134">Una vez que se haya habilitado la autenticación de Windows Azure para su aplicación, haga clic en **Cerrar:**</span><span class="sxs-lookup"><span data-stu-id="ba519-134">Once Windows Azure Authentication has been enabled for your application, click **Close:**</span></span>

    ![](windows-azure-authentication/_static/image7.png)
3. <span data-ttu-id="ba519-135">Presione F5 para ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba519-135">Hit F5 to run your application.</span></span> <span data-ttu-id="ba519-136">Debe redirigirse automáticamente a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="ba519-136">You should automatically get redirected to login page.</span></span> <span data-ttu-id="ba519-137">Use las credenciales de usuario del principio del directorio para iniciar sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba519-137">Use the directory tenet user credentials to login to the application..</span></span>

    ![](windows-azure-authentication/_static/image1.jpg)
4. <span data-ttu-id="ba519-138">Dado que la aplicación está usando un certificado de prueba autofirmado, recibirá una advertencia del explorador que indica que el certificado no fue emitido por una entidad de certificación de confianza.</span><span class="sxs-lookup"><span data-stu-id="ba519-138">Because your application is currently using a self-signed test certificate you will receive a warning from the browser that the certificate was not issued by a trusted certificate authority.</span></span>

    <span data-ttu-id="ba519-139">Esta advertencia puede omitirse de forma segura durante el desarrollo local haciendo clic en **pasar a este sitio web:**</span><span class="sxs-lookup"><span data-stu-id="ba519-139">This warning can be safely ignored during local development by clicking **Continue to this website:**</span></span>

    ![](windows-azure-authentication/_static/image8.png)
5. <span data-ttu-id="ba519-140">Ha iniciado sesión correctamente en la aplicación con la autenticación de Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="ba519-140">You have now successfully logged in to your application using Windows Azure Authentication!</span></span>

    ![](windows-azure-authentication/_static/image2.jpg)

<span data-ttu-id="ba519-141">La habilitación de la autenticación de Windows Azure realiza los siguientes cambios en la aplicación:</span><span class="sxs-lookup"><span data-stu-id="ba519-141">Enabling Windows Azure authentication makes the following changes to your application:</span></span>

- <span data-ttu-id="ba519-142">Se agrega una clase de falsificación de solicitud entre sitios ([CSRF](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF))) ( *App\_Start\AntiXsrfConfig.CS* ) al proyecto.</span><span class="sxs-lookup"><span data-stu-id="ba519-142">An Anti-Cross-Site Request Forgery ([CSRF](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF))) class ( *App\_Start\AntiXsrfConfig.cs* ) is added to your project.</span></span>
- <span data-ttu-id="ba519-143">Los paquetes NuGet `System.IdentityModel.Tokens.ValidatingIssuerNameRegistry` se agregan al proyecto.</span><span class="sxs-lookup"><span data-stu-id="ba519-143">The NuGet packages `System.IdentityModel.Tokens.ValidatingIssuerNameRegistry` is added to your project.</span></span>
- <span data-ttu-id="ba519-144">La configuración de Windows Identity Foundation en la aplicación se configurará para aceptar los tokens de seguridad del inquilino de Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ba519-144">Windows Identity Foundation settings in your application will be configured to accept security tokens from your Windows Azure Active Directory tenant.</span></span> <span data-ttu-id="ba519-145">Haga clic en la imagen siguiente para ver una vista expandida de los cambios realizados en el archivo *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="ba519-145">Click on the image below to see an expanded view of the changes made to the *Web.config* file.</span></span>

     ![](windows-azure-authentication/_static/image9.png)
- <span data-ttu-id="ba519-146">Se aprovisionará una entidad de servicio para la aplicación en el inquilino de Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ba519-146">A service principal for your application in your Windows Azure Active Directory tenant will be provisioned.</span></span>
- <span data-ttu-id="ba519-147">HTTPS está habilitado.</span><span class="sxs-lookup"><span data-stu-id="ba519-147">HTTPS is enabled.</span></span>

## <a name="deploy-the-application-to-windows-azure"></a><span data-ttu-id="ba519-148">Implementar la aplicación en Windows Azure</span><span class="sxs-lookup"><span data-stu-id="ba519-148">Deploy the application to Windows Azure</span></span>

<span data-ttu-id="ba519-149">Para obtener instrucciones completas, consulte [implementar una aplicación Web de ASP.net en un sitio web de Windows Azure](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span><span class="sxs-lookup"><span data-stu-id="ba519-149">For complete instructions, see [Deploying an ASP.NET Web Application to a Windows Azure Web Site](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span></span>

<span data-ttu-id="ba519-150">Para publicar una aplicación con la autenticación de Windows Azure en un sitio web de Azure:</span><span class="sxs-lookup"><span data-stu-id="ba519-150">To publish an application using Windows Azure Authentication to an Azure Web Site:</span></span>

1. <span data-ttu-id="ba519-151">Haga clic con el botón derecho en la aplicación y seleccione **publicar:**</span><span class="sxs-lookup"><span data-stu-id="ba519-151">Right click on your application and select **Publish:**</span></span>

    ![](windows-azure-authentication/_static/image3.jpg)
2. <span data-ttu-id="ba519-152">En el cuadro de diálogo publicar web, descargue e importe un perfil de publicación para el sitio web de Azure.</span><span class="sxs-lookup"><span data-stu-id="ba519-152">From the Publish Web dialog download and import a publishing profile for your Azure Web Site.</span></span>

    ![](windows-azure-authentication/_static/image4.jpg)
3. <span data-ttu-id="ba519-153">La pestaña **conexión** muestra la **dirección URL de destino** (la dirección URL pública de la aplicación).</span><span class="sxs-lookup"><span data-stu-id="ba519-153">The **Connection** tab shows the **Destination URL** (the public facing URL for your application).</span></span> <span data-ttu-id="ba519-154">Haga clic en **validar conexión** para probar la conexión:</span><span class="sxs-lookup"><span data-stu-id="ba519-154">Click **Validate Connection** to test your connection:</span></span>

    ![](windows-azure-authentication/_static/image5.jpg)
4. <span data-ttu-id="ba519-155">Si ha publicado en este sitio web de Azure, considere la posibilidad de comprobar la configuración de **quitar archivos adicionales en el destino** para asegurarse de que la aplicación se publica correctamente.</span><span class="sxs-lookup"><span data-stu-id="ba519-155">If you have published to this Azure Web Site previously consider checking the **Remove additional files at destination** setting to ensure your application publishes cleanly.</span></span> <span data-ttu-id="ba519-156">Observe que la casilla **Habilitar autenticación de Windows Azure** está activada.</span><span class="sxs-lookup"><span data-stu-id="ba519-156">Notice the **Enable Windows Azure Authentication** check box is selected.</span></span>

    ![](windows-azure-authentication/_static/image10.png)
5. <span data-ttu-id="ba519-157">Opcional: en la pestaña **vista previa** , haga clic en **iniciar vista previa** para ver los archivos implementados.</span><span class="sxs-lookup"><span data-stu-id="ba519-157">Optional: On the **Preview** tab click **Start Preview** to see the files deployed.</span></span>

    ![](windows-azure-authentication/_static/image6.jpg)
6. <span data-ttu-id="ba519-158">Haga clic en **publicar.**</span><span class="sxs-lookup"><span data-stu-id="ba519-158">Click **Publish.**</span></span>

    <span data-ttu-id="ba519-159">Se le pedirá que habilite la autenticación de Windows Azure para el host de destino.</span><span class="sxs-lookup"><span data-stu-id="ba519-159">You will be prompted to enable Windows Azure Authentication for the target host.</span></span> <span data-ttu-id="ba519-160">Haga clic en **Habilitar** para continuar:</span><span class="sxs-lookup"><span data-stu-id="ba519-160">Click **Enable** to continue:</span></span>

    ![](windows-azure-authentication/_static/image11.png)
7. <span data-ttu-id="ba519-161">Escriba sus credenciales de administrador para el inquilino de Windows Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="ba519-161">Enter your administrator credentials for your Windows Azure Active Directory tenant:</span></span>

    ![](windows-azure-authentication/_static/image7.jpg)
8. <span data-ttu-id="ba519-162">Una vez que la aplicación se haya publicado correctamente, se abrirá un explorador en el sitio Web publicado.</span><span class="sxs-lookup"><span data-stu-id="ba519-162">Once your application has been successfully published, a browser will open to the published web site.</span></span>

    > [!NOTE]
    > <span data-ttu-id="ba519-163">La aplicación puede tardar hasta cinco minutos (normalmente, menos) en estar aprovisionado por completo con Windows Azure Active Directory después de habilitar la autenticación de Windows Azure para el host de destino.</span><span class="sxs-lookup"><span data-stu-id="ba519-163">It may take up to five minutes (typically must less) for your application to be fully provisioned with Windows Azure Active Directory after enabling Windows Azure Authentication for the target host.</span></span> <span data-ttu-id="ba519-164">La primera vez que ejecute la aplicación, si recibe el error ACS50001: no se encontró el usuario de confianza con el nombre ' [Realm] ', espere unos minutos e intente ejecutar la aplicación de nuevo.</span><span class="sxs-lookup"><span data-stu-id="ba519-164">When you first run your application if you receive error ACS50001: Relying party with name ‘[realm]' was not found, then wait a few minutes and try running the application again.</span></span>
9. <span data-ttu-id="ba519-165">Cuando se le solicite, inicie sesión como un usuario en su directorio:</span><span class="sxs-lookup"><span data-stu-id="ba519-165">When prompted, log in as a user in your directory:</span></span>

    ![](windows-azure-authentication/_static/image8.jpg)
10. <span data-ttu-id="ba519-166">Ha iniciado sesión correctamente en la aplicación hospedada de Azure con la autenticación de Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="ba519-166">You have now successfully logged into your Azure hosted application using Windows Azure Authentication.</span></span>

     ![](windows-azure-authentication/_static/image9.jpg)

## <a name="known-issues"></a><span data-ttu-id="ba519-167">Problemas conocidos</span><span class="sxs-lookup"><span data-stu-id="ba519-167">Known Issues</span></span>

#### <a name="role-based-authorization-fails-when-using-windows-azure-authentication"></a><span data-ttu-id="ba519-168">Se produce un error en la autorización basada en roles cuando se usa la autenticación de Windows Azure</span><span class="sxs-lookup"><span data-stu-id="ba519-168">Role-based authorization fails when using Windows Azure Authentication</span></span>

<span data-ttu-id="ba519-169">La autenticación de Windows Azure no proporciona actualmente la demanda de rol necesaria para que se pueda realizar la autorización basada en roles.</span><span class="sxs-lookup"><span data-stu-id="ba519-169">Windows Azure Authentication does not currently provide the necessary role claim so that role-based authorization can be performed.</span></span> <span data-ttu-id="ba519-170">El rol del usuario autenticado debe recuperarse manualmente de Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ba519-170">The role of the authenticated user must be manually retrieved from Windows Azure Active Directory.</span></span>

#### <a name="browsing-to-an-application-with-windows-azure-authentication-results-in-the-error-acs20016-the-domain-of-the-logged-in-user-livecom-does-not-match-any-allowed-domain-of-this-sts"></a><span data-ttu-id="ba519-171">Al buscar una aplicación con la autenticación de Windows Azure se produce el error "ACS20016 el dominio del usuario que ha iniciado sesión (live.com) no coincide con ningún dominio permitido de este STS"</span><span class="sxs-lookup"><span data-stu-id="ba519-171">Browsing to an application with Windows Azure Authentication results in the error "ACS20016 The domain of the logged in user (live.com) does not match any allowed domain of this STS"</span></span>

<span data-ttu-id="ba519-172">Si ya ha iniciado sesión en una cuenta de Microsoft (por ejemplo, hotmail.com, live.com, outlook.com) e intenta acceder a una aplicación que tiene habilitada la autenticación de Windows Azure, es posible que reciba una respuesta de error 400 porque el dominio de su cuenta de Microsoft Windows Azure Active Directory no reconoce.</span><span class="sxs-lookup"><span data-stu-id="ba519-172">If you are already logged in to a Microsoft Account (for example hotmail.com, live.com, outlook.com) and you attempt to access an application that has enabled Windows Azure Authentication you may get a 400 error response because the domain of your Microsoft Account is not recognized by Windows Azure Active Directory.</span></span> <span data-ttu-id="ba519-173">Para iniciar sesión en la aplicación, primero cierre la sesión de su cuenta de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ba519-173">To log into the application, log out from your Microsoft Account first.</span></span>

#### <a name="logging-into-an-application-with-windows-azure-authentication-enabled-and-a-x509certificatevalidationmode-other-than-none-results-in-certificate-validation-errors-for-the-accountsaccesscontrolwindowsnet-certificate"></a><span data-ttu-id="ba519-174">El inicio de sesión en una aplicación con la autenticación de Windows Azure habilitada y un X509CertificateValidationMode distinto de None produce errores de validación de certificados para el certificado accounts.accesscontrol.windows.net</span><span class="sxs-lookup"><span data-stu-id="ba519-174">Logging into an application with Windows Azure Authentication enabled and a X509CertificateValidationMode other than None results in certificate validation errors for the accounts.accesscontrol.windows.net certificate</span></span>

<span data-ttu-id="ba519-175">No es necesaria la validación de certificados y debe dejarse deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="ba519-175">Certificate validation is not required and should be left disabled.</span></span> <span data-ttu-id="ba519-176">El WSFederationAuthenticationModule valida la huella digital del certificado del emisor.</span><span class="sxs-lookup"><span data-stu-id="ba519-176">The thumbprint of the issuer certificate is validated by the WSFederationAuthenticationModule.</span></span>

#### <a name="when-attempting-to-enable-windows-azure-authentication-the-web-authentication-dialog-shows-the-error-acs20016-the-domain-of-the-logged-in-user-contosoonmicrosoftcom-does-not-match-any-allowed-domain-of-this-sts"></a><span data-ttu-id="ba519-177">Al intentar habilitar la autenticación de Windows Azure, el cuadro de diálogo de autenticación Web muestra el error "ACS20016: el dominio del usuario que inició sesión (contoso.onmicrosoft.com) no coincide con ningún dominio permitido de este STS".</span><span class="sxs-lookup"><span data-stu-id="ba519-177">When attempting to enable Windows Azure Authentication the Web Authentication dialog shows the error "ACS20016: The domain of the logged in user (contoso.onmicrosoft.com) does not match any allowed domain of this STS."</span></span>

<span data-ttu-id="ba519-178">Puede ver este error si ha iniciado sesión correctamente con una cuenta de Windows Azure Active Directory diferente en el mismo proceso de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ba519-178">You may see this error when you have previously successfully logged in using a different Windows Azure Active Directory account from within the same Visual Studio process.</span></span> <span data-ttu-id="ba519-179">Cierre la sesión de la cuenta especificada o reinicie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ba519-179">Log out from the specified account or restart Visual Studio.</span></span> <span data-ttu-id="ba519-180">Si ha iniciado sesión previamente y ha seleccionado la opción "mantener la sesión iniciada", es posible que tenga que borrar las cookies del explorador.</span><span class="sxs-lookup"><span data-stu-id="ba519-180">If you previously logged in and selected the option to "Keep me signed in" then you may need to clear your browser cookies.</span></span>

## <a name="acs20012-the-request-is-not-a-valid-ws-federation-protocol-message"></a><span data-ttu-id="ba519-181">ACS20012: la solicitud no es un mensaje de protocolo WS-Federation válido</span><span class="sxs-lookup"><span data-stu-id="ba519-181">ACS20012: The request is not a valid WS-Federation protocol message</span></span>

<span data-ttu-id="ba519-182">Esto puede ocurrir si ya ha iniciado sesión con algún otro identificador de Microsoft en uno de los servicios de Azure.</span><span class="sxs-lookup"><span data-stu-id="ba519-182">This can happen if you are already logged in with some other Microsoft ID to one of the Azure services.</span></span> <span data-ttu-id="ba519-183">Use la ventana privada del explorador como InPrivate en IE o incógnito en Chrome o borre todas las cookies.</span><span class="sxs-lookup"><span data-stu-id="ba519-183">Use Private browser window like InPrivate in IE or Incognito in Chrome or clear all the cookies.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="ba519-184">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="ba519-184">Additional Resources</span></span>

- <span data-ttu-id="ba519-185">[Herramientas de Microsoft ASP.net para Windows Azure Active Directory: Visual Studio 2012](https://blogs.msdn.com/b/vbertocci/archive/2013/02/18/microsoft-asp-net-tools-for-windows-azure-active-directory-visual-studio-2012.aspx) – Vittorio BERTOCCI</span><span class="sxs-lookup"><span data-stu-id="ba519-185">[Microsoft ASP.NET Tools for Windows Azure Active Directory – Visual Studio 2012](https://blogs.msdn.com/b/vbertocci/archive/2013/02/18/microsoft-asp-net-tools-for-windows-azure-active-directory-visual-studio-2012.aspx) – Vittorio Bertocci</span></span>
- [<span data-ttu-id="ba519-186">Características de Windows Azure: identidad</span><span class="sxs-lookup"><span data-stu-id="ba519-186">Windows Azure Features: Identity</span></span>](https://docs.microsoft.com/azure/active-directory/)
- [<span data-ttu-id="ba519-187">TechNet: Azure Active Directory de Windows</span><span class="sxs-lookup"><span data-stu-id="ba519-187">TechNet: Windows Azure Active Directory</span></span>](https://technet.microsoft.com/library/hh967619.aspx)
- [<span data-ttu-id="ba519-188">Windows Azure Active Directory: desarrollo de aplicaciones para su organización</span><span class="sxs-lookup"><span data-stu-id="ba519-188">Windows Azure Active Directory: Develop Apps for your organization</span></span>](https://activedirectory.windowsazure.com/Develop/Single-Tenant.aspx)
- [<span data-ttu-id="ba519-189">Windows Azure Active Directory: desarrollo de aplicaciones para varias organizaciones</span><span class="sxs-lookup"><span data-stu-id="ba519-189">Windows Azure Active Directory: Develop Apps for multiple organizations</span></span>](https://activedirectory.windowsazure.com/Develop/Multi-Tenant.aspx)
- [<span data-ttu-id="ba519-190">Cómo implementar el inicio de sesión único con Windows Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="ba519-190">How to implement single sign-on with Windows Azure Active Directory</span></span>](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect)
- <span data-ttu-id="ba519-191">[Inicio de sesión único con Windows Azure Active Directory: un análisis profundo](https://blogs.msdn.com/b/vbertocci/archive/2012/07/05/single-sign-on-with-windows-azure-active-directory-a-deep-dive.aspx) : Vittorio BERTOCCI</span><span class="sxs-lookup"><span data-stu-id="ba519-191">[Single Sign-On with Windows Azure Active Directory: a Deep Dive](https://blogs.msdn.com/b/vbertocci/archive/2012/07/05/single-sign-on-with-windows-azure-active-directory-a-deep-dive.aspx) – Vittorio Bertocci</span></span>
- [<span data-ttu-id="ba519-192">Usar AD FS 2,0 para implementar y administrar el inicio de sesión único</span><span class="sxs-lookup"><span data-stu-id="ba519-192">Use AD FS 2.0 to implement and manage single sign-on</span></span>](https://technet.microsoft.com/library/jj205462.aspx)
