---
uid: web-pages/overview/security/16-adding-security-and-membership
title: Agregar seguridad y pertenencia a un sitio de ASP.NET Web Pages (Razor) | Microsoft Docs
author: Rick-Anderson
description: En este capítulo se muestra cómo proteger el sitio web para que algunas de las páginas estén disponibles solo para los usuarios que inicien sesión. (También verá cómo crear páginas Tha...
ms.author: riande
ms.date: 02/24/2014
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: 0be3e767a42939a3c343f6d4a730eb1d9a6b367c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78509905"
---
# <a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="55167-104">Agregar seguridad y pertenencia a un sitio de ASP.NET Web Pages (Razor)</span><span class="sxs-lookup"><span data-stu-id="55167-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>

<span data-ttu-id="55167-105">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="55167-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="55167-106">En este artículo se explica cómo proteger un sitio web de ASP.NET Web Pages (Razor) para que algunas de las páginas estén disponibles solo para los usuarios que inicien sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="55167-107">(También verá cómo crear páginas a las que cualquiera pueda tener acceso).</span><span class="sxs-lookup"><span data-stu-id="55167-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="55167-108">**Lo que aprenderá:**</span><span class="sxs-lookup"><span data-stu-id="55167-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="55167-109">Cómo crear un sitio web que tenga una página de registro y una página de inicio de sesión para que en algunas páginas pueda limitar el acceso solo a los miembros.</span><span class="sxs-lookup"><span data-stu-id="55167-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="55167-110">Cómo crear páginas públicas y solo de miembro.</span><span class="sxs-lookup"><span data-stu-id="55167-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="55167-111">Cómo definir roles, que son grupos que tienen permisos de seguridad diferentes en el sitio, y cómo asignar usuarios a un rol.</span><span class="sxs-lookup"><span data-stu-id="55167-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="55167-112">Cómo usar CAPTCHA para evitar que programas automatizados (bots) creen cuentas de miembro.</span><span class="sxs-lookup"><span data-stu-id="55167-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="55167-113">Estas son las características de ASP.NET presentadas en el artículo:</span><span class="sxs-lookup"><span data-stu-id="55167-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="55167-114">La plantilla del **sitio de inicio** de WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="55167-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="55167-115">Aplicación auxiliar de `WebSecurity` y `Roles` clase.</span><span class="sxs-lookup"><span data-stu-id="55167-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="55167-116">Aplicación auxiliar de `ReCaptcha`.</span><span class="sxs-lookup"><span data-stu-id="55167-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="55167-117">Versiones de software usadas en el tutorial</span><span class="sxs-lookup"><span data-stu-id="55167-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="55167-118">ASP.NET Web Pages (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="55167-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="55167-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="55167-119">WebMatrix 3</span></span>
> - <span data-ttu-id="55167-120">Biblioteca de aplicaciones auxiliares Web de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="55167-120">ASP.NET Web Helpers Library</span></span>

<span data-ttu-id="55167-121">Puede configurar su sitio web para que los usuarios puedan iniciar sesión en &#8212; él, de modo que el sitio admita la *pertenencia*.</span><span class="sxs-lookup"><span data-stu-id="55167-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="55167-122">Esto puede ser útil por muchas razones.</span><span class="sxs-lookup"><span data-stu-id="55167-122">This can be useful for many reasons.</span></span> <span data-ttu-id="55167-123">Por ejemplo, es posible que el sitio tenga páginas que solo deben estar disponibles para los miembros.</span><span class="sxs-lookup"><span data-stu-id="55167-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="55167-124">En algunos casos, es posible que sea necesario que los usuarios inicien sesión para poder enviar sus comentarios o dejar un comentario.</span><span class="sxs-lookup"><span data-stu-id="55167-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="55167-125">Incluso si su sitio web admite la pertenencia, no es necesario que los usuarios inicien sesión antes de usar algunas de las páginas del sitio.</span><span class="sxs-lookup"><span data-stu-id="55167-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="55167-126">Los usuarios que no han iniciado sesión se conocen como *usuarios anónimos*.</span><span class="sxs-lookup"><span data-stu-id="55167-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="55167-127">Un usuario puede registrarse en el sitio web y, a continuación, iniciar sesión en el sitio.</span><span class="sxs-lookup"><span data-stu-id="55167-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="55167-128">El sitio web requiere un nombre de usuario (una dirección de correo electrónico) y una contraseña para confirmar que los usuarios son quienes dicen ser.</span><span class="sxs-lookup"><span data-stu-id="55167-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="55167-129">Este proceso de inicio de sesión y confirmación de la identidad de un usuario se conoce como *autenticación*.</span><span class="sxs-lookup"><span data-stu-id="55167-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="55167-130">Puede configurar la seguridad y la pertenencia de maneras diferentes:</span><span class="sxs-lookup"><span data-stu-id="55167-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="55167-131">Si usa WebMatrix, una manera fácil es crear como nuevo sitio basado en la plantilla del **sitio de inicio** .</span><span class="sxs-lookup"><span data-stu-id="55167-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="55167-132">Esta plantilla ya está configurada para la seguridad y la pertenencia, y ya tiene una página de registro, una página de inicio de sesión, etc.</span><span class="sxs-lookup"><span data-stu-id="55167-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="55167-133">El sitio creado por la plantilla también tiene una opción que permite a los usuarios iniciar sesión mediante un sitio externo como Facebook, Google o Twitter.</span><span class="sxs-lookup"><span data-stu-id="55167-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="55167-134">Si desea agregar seguridad a un sitio existente, o si no desea usar la plantilla del sitio de **Inicio** , puede crear su propia página de registro, la página de inicio de sesión, etc.</span><span class="sxs-lookup"><span data-stu-id="55167-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="55167-135">Este artículo se centra en la primera opción &mdash; cómo agregar seguridad mediante la plantilla **sitio de inicio** .</span><span class="sxs-lookup"><span data-stu-id="55167-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="55167-136">También se proporciona información básica sobre cómo implementar su propia seguridad y, a continuación, se proporcionan vínculos para obtener más información sobre cómo hacerlo.</span><span class="sxs-lookup"><span data-stu-id="55167-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="55167-137">También hay información sobre cómo habilitar los inicios de sesión externos, que se describe con más detalle en un artículo independiente.</span><span class="sxs-lookup"><span data-stu-id="55167-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="55167-138">Crear seguridad de sitio web mediante la plantilla de sitio de inicio</span><span class="sxs-lookup"><span data-stu-id="55167-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="55167-139">En WebMatrix, puede usar la plantilla **sitio de inicio** para crear un sitio web que contenga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="55167-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="55167-140">Base de datos que se usa para almacenar nombres de usuario y contraseñas para los miembros.</span><span class="sxs-lookup"><span data-stu-id="55167-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="55167-141">Página de registro en la que se pueden registrar usuarios anónimos (nuevos).</span><span class="sxs-lookup"><span data-stu-id="55167-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="55167-142">Una página de inicio y cierre de sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-142">A login and logout page.</span></span>
- <span data-ttu-id="55167-143">Una página de recuperación y restablecimiento de contraseñas.</span><span class="sxs-lookup"><span data-stu-id="55167-143">A password recovery and reset page.</span></span>

<span data-ttu-id="55167-144">En el procedimiento siguiente se describe cómo crear el sitio y configurarlo.</span><span class="sxs-lookup"><span data-stu-id="55167-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="55167-145">Inicie WebMatrix y, en la página **Inicio rápido** , seleccione **sitio de plantilla**.</span><span class="sxs-lookup"><span data-stu-id="55167-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="55167-146">Seleccione la plantilla **sitio de inicio** y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="55167-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="55167-147">WebMatrix crea un nuevo sitio.</span><span class="sxs-lookup"><span data-stu-id="55167-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="55167-148">En el panel izquierdo, haga clic en el selector de área de trabajo **archivos** .</span><span class="sxs-lookup"><span data-stu-id="55167-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="55167-149">En la carpeta raíz de su sitio web, abra el archivo *\_AppStart. cshtml* , que es un archivo especial que se usa para contener la configuración global.</span><span class="sxs-lookup"><span data-stu-id="55167-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="55167-150">Contiene algunas instrucciones que se marcan como comentarios con los caracteres `//`:</span><span class="sxs-lookup"><span data-stu-id="55167-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="55167-151">Estas instrucciones configuran la aplicación auxiliar de `WebMail`, que se puede usar para enviar correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="55167-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="55167-152">El sistema de pertenencia puede usar el correo electrónico para enviar mensajes de confirmación cuando los usuarios se registran o cuando desean cambiar sus contraseñas.</span><span class="sxs-lookup"><span data-stu-id="55167-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="55167-153">(Por ejemplo, después de que los usuarios se registren, reciben un correo electrónico que incluye un vínculo en el que pueden hacer clic para finalizar el proceso de registro).</span><span class="sxs-lookup"><span data-stu-id="55167-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="55167-154">El envío de correo electrónico requiere acceso a un servidor SMTP, tal como se describe en [Agregar correo electrónico a un sitio ASP.NET Web pages](https://go.microsoft.com/fwlink/?LinkId=202899).</span><span class="sxs-lookup"><span data-stu-id="55167-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="55167-155">Almacenará la configuración de correo electrónico en este archivo central *\_AppStart. cshtml* para que no tenga que codificarla repetidamente en cada página que pueda enviar correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="55167-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="55167-156">(No es necesario configurar los valores de SMTP para configurar una base de datos de registro; solo se necesita la configuración de SMTP si desea validar a los usuarios de su alias de correo electrónico y permitir que los usuarios restablezcan la contraseña olvidada).</span><span class="sxs-lookup"><span data-stu-id="55167-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="55167-157">Quite los comentarios de las instrucciones quitando `//` de delante de cada una de ellas.</span><span class="sxs-lookup"><span data-stu-id="55167-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="55167-158">Si no desea configurar la confirmación por correo electrónico, puede omitir este paso y el paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="55167-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="55167-159">Si no se establecen los valores SMTP, la nueva cuenta estará inmediatamente disponible sin un correo electrónico de confirmación.</span><span class="sxs-lookup"><span data-stu-id="55167-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="55167-160">Modifique la siguiente configuración relacionada con el correo electrónico en el código:</span><span class="sxs-lookup"><span data-stu-id="55167-160">Modify the following email-related settings in the code:</span></span>

   - <span data-ttu-id="55167-161">Establezca `WebMail.SmtpServer` en el nombre del servidor SMTP al que tenga acceso.</span><span class="sxs-lookup"><span data-stu-id="55167-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
   - <span data-ttu-id="55167-162">Deje `WebMail.EnableSsl` establecido en `true`.</span><span class="sxs-lookup"><span data-stu-id="55167-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="55167-163">Esta configuración protege las credenciales que se envían al servidor SMTP mediante su cifrado.</span><span class="sxs-lookup"><span data-stu-id="55167-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
   - <span data-ttu-id="55167-164">Establezca `WebMail.UserName` en el nombre de usuario de la cuenta del servidor SMTP.</span><span class="sxs-lookup"><span data-stu-id="55167-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
   - <span data-ttu-id="55167-165">Establezca `WebMail.Password` en la contraseña de la cuenta del servidor SMTP.</span><span class="sxs-lookup"><span data-stu-id="55167-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
   - <span data-ttu-id="55167-166">Establezca `WebMail.From` en su propia dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="55167-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="55167-167">Esta es la dirección de correo electrónico desde la que se envía el mensaje.</span><span class="sxs-lookup"><span data-stu-id="55167-167">This is the email address that the message is sent from.</span></span>

     > [!NOTE] 
     > 
     > <span data-ttu-id="55167-168">**Sugerencia** Para obtener más información sobre los valores de estas propiedades, consulte Configuración del [correo electrónico](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) en [personalizar el comportamiento de todo el sitio para ASP.NET Web pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span><span class="sxs-lookup"><span data-stu-id="55167-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="55167-169">Guarde y cierre *\_AppStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="55167-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="55167-170">Ejecute la página *default. cshtml* en un explorador.</span><span class="sxs-lookup"><span data-stu-id="55167-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![seguridad-pertenencia-2](16-adding-security-and-membership/_static/image1.png)

   > [!NOTE]
   > <span data-ttu-id="55167-172">Si ve un error que indica que una propiedad debe ser una instancia de `ExtendedMembershipProvider`, es posible que el sitio no esté configurado para usar el sistema de pertenencia a ASP.NET Web Pages (SimpleMembership).</span><span class="sxs-lookup"><span data-stu-id="55167-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="55167-173">A veces, esto puede ocurrir si el servidor de un proveedor de hospedaje se configura de forma diferente que el servidor local.</span><span class="sxs-lookup"><span data-stu-id="55167-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="55167-174">Para corregir esto, agregue el siguiente elemento al archivo *Web. config* del sitio:</span><span class="sxs-lookup"><span data-stu-id="55167-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
   > 
   > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
   > 
   > <span data-ttu-id="55167-175">Agregue este elemento como elemento secundario del elemento `<configuration>` y como elemento del mismo nivel del elemento `<system.web>`.</span><span class="sxs-lookup"><span data-stu-id="55167-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="55167-176">En la esquina superior derecha de la página, haga clic en el vínculo **registrar** .</span><span class="sxs-lookup"><span data-stu-id="55167-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="55167-177">Se muestra la página *Register. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="55167-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="55167-178">Escriba un nombre de usuario y una contraseña y, a continuación, haga clic en **registrar**.</span><span class="sxs-lookup"><span data-stu-id="55167-178">Enter a user name and password and then click **Register**.</span></span>

    ![seguridad-pertenencia-3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="55167-180">Al crear el sitio web a partir de la plantilla del **sitio de inicio** , se creó una base de *datos* denominada *StarterSite. sdf* en la carpeta de datos de la aplicación del sitio\_.</span><span class="sxs-lookup"><span data-stu-id="55167-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="55167-181">Durante el registro, se agrega la información de usuario a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="55167-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="55167-182">Si establece los valores de SMTP, se envía un mensaje a la dirección de correo electrónico que ha usado para que pueda finalizar el registro.</span><span class="sxs-lookup"><span data-stu-id="55167-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![seguridad-pertenencia-4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="55167-184">Vaya a su programa de correo electrónico y busque el mensaje, que tendrá el código de confirmación y un hipervínculo al sitio.</span><span class="sxs-lookup"><span data-stu-id="55167-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="55167-185">Haga clic en el hipervínculo para activar su cuenta.</span><span class="sxs-lookup"><span data-stu-id="55167-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="55167-186">El hipervínculo de confirmación abre una página de confirmación de registro.</span><span class="sxs-lookup"><span data-stu-id="55167-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![seguridad-pertenencia-5](16-adding-security-and-membership/_static/image4.png)
13. <span data-ttu-id="55167-188">Haga clic en el vínculo **Inicio de sesión** y, a continuación, inicie sesión con la cuenta que registró.</span><span class="sxs-lookup"><span data-stu-id="55167-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

      <span data-ttu-id="55167-189">Después de iniciar sesión, los vínculos de **Inicio de sesión** y **registro** se sustituyen por un vínculo de **cierre** de sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="55167-190">El nombre de inicio de sesión se muestra como un vínculo.</span><span class="sxs-lookup"><span data-stu-id="55167-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="55167-191">(El vínculo le permite ir a una página donde puede cambiar la contraseña).</span><span class="sxs-lookup"><span data-stu-id="55167-191">(The link lets you go to a page where you can change your password.)</span></span>

      ![seguridad-pertenencia-6](16-adding-security-and-membership/_static/image5.png)

      > [!NOTE]
      > <span data-ttu-id="55167-193">De forma predeterminada, las páginas Web ASP.NET envían credenciales al servidor en texto no cifrado (como texto legible).</span><span class="sxs-lookup"><span data-stu-id="55167-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="55167-194">Un sitio de producción debe usar HTTP seguro (https://, también conocido como *capa de sockets seguros* o SSL) para cifrar la información confidencial intercambiada con el servidor.</span><span class="sxs-lookup"><span data-stu-id="55167-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="55167-195">Puede solicitar que los mensajes de correo electrónico se envíen mediante SSL estableciendo `WebMail.EnableSsl=true` como en el ejemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="55167-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="55167-196">Para obtener más información acerca de SSL, consulte protección de las [comunicaciones web: certificados, SSL y https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span><span class="sxs-lookup"><span data-stu-id="55167-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="55167-197">Funcionalidad de pertenencia adicional en el sitio</span><span class="sxs-lookup"><span data-stu-id="55167-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="55167-198">El sitio contiene otras funciones que permiten a los usuarios administrar sus cuentas.</span><span class="sxs-lookup"><span data-stu-id="55167-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="55167-199">Los usuarios pueden hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="55167-199">Users can do the following:</span></span>

- <span data-ttu-id="55167-200">Cambiar sus contraseñas.</span><span class="sxs-lookup"><span data-stu-id="55167-200">Change their passwords.</span></span> <span data-ttu-id="55167-201">Después de iniciar sesión, pueden hacer clic en el nombre de usuario (que es un vínculo).</span><span class="sxs-lookup"><span data-stu-id="55167-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="55167-202">Esto lo lleva a una página en la que puede crear una nueva contraseña (*account/ChangePassword. cshtml*).</span><span class="sxs-lookup"><span data-stu-id="55167-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="55167-203">Recuperar una contraseña olvidada.</span><span class="sxs-lookup"><span data-stu-id="55167-203">Recover a forgotten password.</span></span> <span data-ttu-id="55167-204">En la página de inicio de sesión, hay un vínculo ( **¿olvidó su contraseña?** ) que lleva a los usuarios a una página (*account/ForgotPassword. cshtml*) donde pueden escribir una dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="55167-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="55167-205">El sitio les envía un mensaje de correo electrónico con un vínculo en el que se puede hacer clic para establecer una nueva contraseña (*account/PasswordReset. cshtml*).</span><span class="sxs-lookup"><span data-stu-id="55167-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="55167-206">También puede permitir que los usuarios puedan iniciar sesión con un sitio externo, como se explica más adelante.</span><span class="sxs-lookup"><span data-stu-id="55167-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="55167-207">Crear una página de solo miembros</span><span class="sxs-lookup"><span data-stu-id="55167-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="55167-208">En ese momento, cualquier usuario puede ir a cualquier página de su sitio Web.</span><span class="sxs-lookup"><span data-stu-id="55167-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="55167-209">Pero es posible que desee tener páginas que solo estén disponibles para las personas que han iniciado sesión (es decir, a los miembros).</span><span class="sxs-lookup"><span data-stu-id="55167-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="55167-210">ASP.NET permite crear páginas a las que solo pueden tener acceso los miembros que han iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="55167-211">Normalmente, si los usuarios anónimos intentan obtener acceso a una página de solo miembros, se redirigen a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="55167-212">En este procedimiento, creará una carpeta que contendrá páginas que solo están disponibles para los usuarios que han iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="55167-213">En la raíz del sitio, cree una nueva carpeta.</span><span class="sxs-lookup"><span data-stu-id="55167-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="55167-214">(En la cinta de opciones, haga clic en la flecha situada debajo de **nuevo** y elija **nueva carpeta**).</span><span class="sxs-lookup"><span data-stu-id="55167-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="55167-215">Asigne a la nueva carpeta el nombre *miembros*.</span><span class="sxs-lookup"><span data-stu-id="55167-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="55167-216">Dentro de la carpeta *Members* , cree una nueva página y asígnele el nombre *MembersInformation. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="55167-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="55167-217">Reemplace el contenido existente por el siguiente código y marcado:</span><span class="sxs-lookup"><span data-stu-id="55167-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="55167-218">Este código prueba la propiedad `IsAuthenticated` del objeto `WebSecurity`, que devuelve `true` si el usuario ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="55167-219">Si el usuario no ha iniciado sesión, el código llama a `Response.Redirect` para enviar al usuario a la página *login. cshtml* de la carpeta de la *cuenta* .</span><span class="sxs-lookup"><span data-stu-id="55167-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="55167-220">La dirección URL de la redirección incluye un valor de cadena de consulta `returnUrl` que usa `Request.Url.LocalPath` para establecer la ruta de acceso de la página actual.</span><span class="sxs-lookup"><span data-stu-id="55167-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="55167-221">Si establece el valor de `returnUrl` en la cadena de consulta de este modo (y si la dirección URL de retorno es una ruta de acceso local), la página de inicio de sesión devolverá los usuarios a esta página después de iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="55167-222">El código también establece *\_página SiteLayout. cshtml* como su página de diseño.</span><span class="sxs-lookup"><span data-stu-id="55167-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="55167-223">(Para obtener más información sobre las páginas de diseño, vea [crear un diseño coherente en sitios de ASP.NET Web pages](https://go.microsoft.com/fwlink/?LinkId=202891)).</span><span class="sxs-lookup"><span data-stu-id="55167-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="55167-224">Ejecute el sitio.</span><span class="sxs-lookup"><span data-stu-id="55167-224">Run the site.</span></span> <span data-ttu-id="55167-225">Si aún tiene iniciada la sesión, haga clic en el botón **Cerrar sesión** en la parte superior de la página.</span><span class="sxs-lookup"><span data-stu-id="55167-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="55167-226">En el explorador, solicite la página */Members/MembersInformation*.</span><span class="sxs-lookup"><span data-stu-id="55167-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="55167-227">Por ejemplo, la dirección URL podría tener el siguiente aspecto:</span><span class="sxs-lookup"><span data-stu-id="55167-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="55167-228">(El número de puerto (38366) probablemente será diferente en la dirección URL).</span><span class="sxs-lookup"><span data-stu-id="55167-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="55167-229">Se le redirigirá a la página *login. cshtml* , ya que no ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
7. <span data-ttu-id="55167-230">Inicie sesión con la cuenta que creó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="55167-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="55167-231">Se le redirigirá a la página *MembersInformation* .</span><span class="sxs-lookup"><span data-stu-id="55167-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="55167-232">Como ha iniciado sesión, esta vez verá el contenido de la página.</span><span class="sxs-lookup"><span data-stu-id="55167-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="55167-233">Para proteger el acceso a varias páginas, puede hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="55167-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="55167-234">Agregue la comprobación de seguridad a cada página.</span><span class="sxs-lookup"><span data-stu-id="55167-234">Add the security check to each page.</span></span>
- <span data-ttu-id="55167-235">Cree una *\_página PageStart. cshtml* en la carpeta donde mantiene las páginas protegidas y agregue la comprobación de seguridad allí.</span><span class="sxs-lookup"><span data-stu-id="55167-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="55167-236">La página *\_PageStart. cshtml* actúa como un tipo de página global para todas las páginas de la carpeta.</span><span class="sxs-lookup"><span data-stu-id="55167-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="55167-237">Esta técnica se explica con más detalle en [personalizar el comportamiento de todo el sitio para ASP.NET Web pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span><span class="sxs-lookup"><span data-stu-id="55167-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="55167-238">Crear seguridad para grupos de usuarios (roles)</span><span class="sxs-lookup"><span data-stu-id="55167-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="55167-239">Si el sitio tiene muchos miembros, no es eficaz comprobar los permisos de cada usuario individualmente antes de permitirles ver una página.</span><span class="sxs-lookup"><span data-stu-id="55167-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="55167-240">Lo que puede hacer es crear grupos o *roles*a los que pertenecen los miembros individuales.</span><span class="sxs-lookup"><span data-stu-id="55167-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="55167-241">A continuación, puede comprobar los permisos según el rol.</span><span class="sxs-lookup"><span data-stu-id="55167-241">You can then check permissions based on role.</span></span> <span data-ttu-id="55167-242">En esta sección, creará un rol de&quot; de administración de &quot;y, a continuación, creará una página a la que puedan tener acceso los usuarios que pertenezcan a ese rol.</span><span class="sxs-lookup"><span data-stu-id="55167-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="55167-243">El sistema de pertenencia de ASP.NET está configurado para admitir roles.</span><span class="sxs-lookup"><span data-stu-id="55167-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="55167-244">Sin embargo, a diferencia del registro de pertenencia e inicio de sesión, la plantilla del **sitio de inicio** no contiene páginas que le ayuden a administrar los roles.</span><span class="sxs-lookup"><span data-stu-id="55167-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="55167-245">(La administración de roles es una tarea administrativa en lugar de una tarea de usuario). Sin embargo, puede agregar grupos directamente en la base de datos de pertenencia en WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="55167-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="55167-246">En WebMatrix, haga clic en el selector de área de trabajo **bases de datos** .</span><span class="sxs-lookup"><span data-stu-id="55167-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="55167-247">En el panel izquierdo, abra el nodo *StarterSite. sdf* , abra el nodo **tablas** y, a continuación, haga doble clic en la tabla *páginas web\_roles* .</span><span class="sxs-lookup"><span data-stu-id="55167-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![seguridad-pertenencia-7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="55167-249">Agregue un rol denominado &quot;admin&quot;.</span><span class="sxs-lookup"><span data-stu-id="55167-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="55167-250">El campo *RoleId* se rellena automáticamente.</span><span class="sxs-lookup"><span data-stu-id="55167-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="55167-251">(Es la clave principal y se ha establecido como un campo de identificación, como se explica en [Introducción al trabajo con una base de datos en ASP.NET Web pages sitios](https://go.microsoft.com/fwlink/?LinkId=202893)).</span><span class="sxs-lookup"><span data-stu-id="55167-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="55167-252">Tome nota de cuál es el valor del campo *RoleId* .</span><span class="sxs-lookup"><span data-stu-id="55167-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="55167-253">(Si se trata del primer rol que está definiendo, será 1).</span><span class="sxs-lookup"><span data-stu-id="55167-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![seguridad-pertenencia-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="55167-255">Cierre la tabla *páginas web\_roles* .</span><span class="sxs-lookup"><span data-stu-id="55167-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="55167-256">Abra la tabla *userprofile* .</span><span class="sxs-lookup"><span data-stu-id="55167-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="55167-257">Anote el valor de *userid* de uno o varios de los usuarios de la tabla y, a continuación, cierre la tabla.</span><span class="sxs-lookup"><span data-stu-id="55167-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="55167-258">Abra la tabla *webpages\_UserInRoles* y escriba un *userid* y un valor de *RoleID* en la tabla.</span><span class="sxs-lookup"><span data-stu-id="55167-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="55167-259">Por ejemplo, para poner el usuario 2 en el rol de&quot; de administración de &quot;, debe escribir estos valores:</span><span class="sxs-lookup"><span data-stu-id="55167-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![seguridad-pertenencia-9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="55167-261">Cierre la tabla *webpages\_UsersInRoles* .</span><span class="sxs-lookup"><span data-stu-id="55167-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="55167-262">Ahora que ha definido los roles, puede configurar una página que sea accesible para los usuarios que están en ese rol.</span><span class="sxs-lookup"><span data-stu-id="55167-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="55167-263">En la carpeta raíz del sitio web, cree una nueva página denominada *AdminError. cshtml* y reemplace el contenido existente por el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="55167-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="55167-264">Esta será la página a la que se redirigirán los usuarios si no se les permite el acceso a una página.</span><span class="sxs-lookup"><span data-stu-id="55167-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="55167-265">En la carpeta raíz del sitio web, cree una nueva página denominada *AdminOnly. cshtml* y reemplace el código existente por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="55167-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="55167-266">El método `Roles.IsUserInRole` devuelve `true` si el usuario actual es miembro del rol especificado (en este caso, el rol "admin").</span><span class="sxs-lookup"><span data-stu-id="55167-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="55167-267">Ejecute *default. cshtml* en un explorador, pero no inicie sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="55167-268">(Si ya ha iniciado sesión, cierre la sesión).</span><span class="sxs-lookup"><span data-stu-id="55167-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="55167-269">En la barra de direcciones del explorador, agregue *AdminOnly* en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="55167-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="55167-270">(Es decir, solicite el archivo *AdminOnly. cshtml* ). Se le redirigirá a la página *AdminError. cshtml* porque no ha iniciado sesión actualmente como usuario en el rol de&quot; de administración de &quot;.</span><span class="sxs-lookup"><span data-stu-id="55167-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="55167-271">Vuelva a *default. cshtml* e inicie sesión como el usuario que agregó al rol de&quot; de administración de &quot;.</span><span class="sxs-lookup"><span data-stu-id="55167-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="55167-272">Vaya a la página *AdminOnly. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="55167-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="55167-273">Esta vez, verá la página.</span><span class="sxs-lookup"><span data-stu-id="55167-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="55167-274">Impedir que los programas automatizados se unan a su sitio web</span><span class="sxs-lookup"><span data-stu-id="55167-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="55167-275">La página de inicio de sesión no detendrá los programas automatizados (a veces denominados robots o *bots* *Web* ) del registro en el sitio Web.</span><span class="sxs-lookup"><span data-stu-id="55167-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="55167-276">En este procedimiento se describe cómo habilitar una prueba de ReCaptcha para la página de registro.</span><span class="sxs-lookup"><span data-stu-id="55167-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="55167-278">Registre el sitio web en ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span><span class="sxs-lookup"><span data-stu-id="55167-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="55167-279">Cuando haya completado el registro, obtendrá una clave pública y una clave privada.</span><span class="sxs-lookup"><span data-stu-id="55167-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="55167-280">Agregue la biblioteca de aplicaciones auxiliares Web de ASP.NET a su sitio web, tal como se describe en [instalación de aplicaciones auxiliares en un sitio de ASP.NET Web pages](https://go.microsoft.com/fwlink/?LinkId=252372), si no lo ha hecho ya.</span><span class="sxs-lookup"><span data-stu-id="55167-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="55167-281">En la carpeta de la *cuenta* , abra el archivo denominado *Register. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="55167-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="55167-282">En el código que se encuentra en la parte superior de la página, busque las siguientes líneas y quite las marcas de comentario mediante la eliminación de los caracteres de comentario `//`:</span><span class="sxs-lookup"><span data-stu-id="55167-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="55167-283">Reemplace `PRIVATE_KEY` por su propia clave privada de ReCaptcha.</span><span class="sxs-lookup"><span data-stu-id="55167-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="55167-284">En el marcado de la página, quite los caracteres de comentario `@*` y `*@` de alrededor de las líneas siguientes en el marcado de página:</span><span class="sxs-lookup"><span data-stu-id="55167-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="55167-285">Reemplace `PUBLIC_KEY` por su clave.</span><span class="sxs-lookup"><span data-stu-id="55167-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="55167-286">Si todavía no lo ha quitado, quite el elemento `<div>` que contiene texto que empieza por "para habilitar la comprobación de CAPTCHA...".</span><span class="sxs-lookup"><span data-stu-id="55167-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="55167-287">(Quite todo el elemento de la `<div>` y su contenido).</span><span class="sxs-lookup"><span data-stu-id="55167-287">(Remove the entire `<div>` element and its contents.)</span></span>

9. <span data-ttu-id="55167-288">Ejecute *default. cshtml* en un explorador.</span><span class="sxs-lookup"><span data-stu-id="55167-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="55167-289">Si ha iniciado sesión en el sitio, haga clic en el vínculo **Cerrar sesión** .</span><span class="sxs-lookup"><span data-stu-id="55167-289">If you're logged into the site, click the **Logout** link.</span></span>
10. <span data-ttu-id="55167-290">Haga clic en el vínculo **registrar** y pruebe el registro con la prueba CAPTCHA.</span><span class="sxs-lookup"><span data-stu-id="55167-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

     ![seguridad-pertenencia-10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="55167-292">Para obtener más información acerca de la aplicación auxiliar de `ReCaptcha`, consulte [uso de catpcha para impedir que programas automatizados (bots) usen el sitio web de ASP.net](https://go.microsoft.com/fwlink/?LinkId=251967).</span><span class="sxs-lookup"><span data-stu-id="55167-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="55167-293">Permitir a los usuarios iniciar sesión con un sitio externo</span><span class="sxs-lookup"><span data-stu-id="55167-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="55167-294">La plantilla del **sitio de inicio** incluye código y marcado que permite a los usuarios iniciar sesión con Facebook, Windows Live, Twitter, Google o Yahoo.</span><span class="sxs-lookup"><span data-stu-id="55167-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="55167-295">De forma predeterminada, esta funcionalidad no está habilitada.</span><span class="sxs-lookup"><span data-stu-id="55167-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="55167-296">El procedimiento general para usar permitir que los usuarios inicien sesión con estos proveedores externos es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="55167-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="55167-297">Decida qué sitios externos desea admitir.</span><span class="sxs-lookup"><span data-stu-id="55167-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="55167-298">Si es necesario, vaya a ese sitio y configure una aplicación de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="55167-299">(Por ejemplo, tiene que hacer esto para permitir los inicios de sesión de Facebook).</span><span class="sxs-lookup"><span data-stu-id="55167-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="55167-300">En el sitio, configure el proveedor.</span><span class="sxs-lookup"><span data-stu-id="55167-300">In your site, configure the provider.</span></span> <span data-ttu-id="55167-301">En la mayoría de los casos, solo tiene que quitar la marca de comentario de código en el archivo *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="55167-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="55167-302">Agregue marcado a la página de registro que permita que las personas se vinculen al sitio externo para iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="55167-303">Normalmente, puede copiar el marcado que necesita y cambiar el texto ligeramente.</span><span class="sxs-lookup"><span data-stu-id="55167-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="55167-304">Puede encontrar instrucciones paso a paso en el tema [Habilitar el inicio de sesión desde sitios externos en un sitio de ASP.NET Web pages](https://go.microsoft.com/fwlink/?LinkId=251969).</span><span class="sxs-lookup"><span data-stu-id="55167-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="55167-305">Después de que un usuario inicie sesión desde otro sitio, el usuario vuelve al sitio y *asocia* ese inicio de sesión con el sitio.</span><span class="sxs-lookup"><span data-stu-id="55167-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="55167-306">De hecho, esto crea una entrada de pertenencia en el sitio para el inicio de sesión externo del usuario.</span><span class="sxs-lookup"><span data-stu-id="55167-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="55167-307">Esto le permite usar los medios normales de pertenencia (como roles) con el inicio de sesión externo.</span><span class="sxs-lookup"><span data-stu-id="55167-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="55167-308">Agregar seguridad a un sitio web existente</span><span class="sxs-lookup"><span data-stu-id="55167-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="55167-309">El procedimiento anterior de este artículo se basa en el uso de la plantilla del **sitio de inicio** como base para la seguridad del sitio Web.</span><span class="sxs-lookup"><span data-stu-id="55167-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="55167-310">Si no es práctico empezar a partir de la plantilla del **sitio de inicio** o copiar las páginas correspondientes de un sitio basado en esa plantilla, puede implementar el mismo tipo de seguridad en su propio sitio mediante su codificación.</span><span class="sxs-lookup"><span data-stu-id="55167-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="55167-311">Cree los mismos tipos de páginas (registro, Inicio de sesión, etc.) y, a continuación, use aplicaciones auxiliares y clases para configurar la pertenencia.</span><span class="sxs-lookup"><span data-stu-id="55167-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="55167-312">El proceso básico se describe en la entrada de blog [la manera más básica de implementar la seguridad de Razor para ASP.net](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span><span class="sxs-lookup"><span data-stu-id="55167-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="55167-313">La mayor parte del trabajo se realiza mediante los siguientes métodos y propiedades de la aplicación auxiliar de `WebSecurity`:</span><span class="sxs-lookup"><span data-stu-id="55167-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="55167-314">[WebSecurty. UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity. CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="55167-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="55167-315">Estos métodos permiten determinar si alguien ya está registrado y registrarlos.</span><span class="sxs-lookup"><span data-stu-id="55167-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="55167-316">[WebSecurty. IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="55167-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="55167-317">Esta propiedad le permite determinar si el usuario actual ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="55167-318">Esto resulta útil para redirigir a los usuarios a una página de inicio de sesión si todavía no han iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="55167-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="55167-319">[WebSecurity. login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity. logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="55167-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="55167-320">Estos métodos inician una sesión de usuario o de salida.</span><span class="sxs-lookup"><span data-stu-id="55167-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="55167-321">[WebSecurity. CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="55167-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="55167-322">Esta propiedad es útil para mostrar el nombre de usuario actual (si el usuario ha iniciado sesión).</span><span class="sxs-lookup"><span data-stu-id="55167-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="55167-323">[WebSecurity. ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="55167-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="55167-324">Este método es útil si configura la confirmación por correo electrónico para el registro.</span><span class="sxs-lookup"><span data-stu-id="55167-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="55167-325">(Los detalles se describen en la entrada de blog [mediante la característica de confirmación de ASP.NET Web pages seguridad](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267)).</span><span class="sxs-lookup"><span data-stu-id="55167-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="55167-326">Para administrar roles, puede usar los [roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) y las clases de [pertenencia](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) , como se describe en la entrada de blog.</span><span class="sxs-lookup"><span data-stu-id="55167-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="55167-327">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="55167-327">Additional Resources</span></span>

- [<span data-ttu-id="55167-328">Personalizar el comportamiento de todo el sitio</span><span class="sxs-lookup"><span data-stu-id="55167-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="55167-329">Protección de las comunicaciones web: certificados, SSL y https://</span><span class="sxs-lookup"><span data-stu-id="55167-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="55167-330">[La manera más básica de implementar la seguridad de Razor para ASP.net](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) y [usar la característica de confirmación para ASP.NET Web pages seguridad](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span><span class="sxs-lookup"><span data-stu-id="55167-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="55167-331">Se trata de entradas de blog que describen cómo implementar las características de pertenencia a ASP.NET sin usar la plantilla del **sitio de inicio** .</span><span class="sxs-lookup"><span data-stu-id="55167-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="55167-332">Habilitar el inicio de sesión desde sitios externos en un sitio de ASP.NET Web Pages</span><span class="sxs-lookup"><span data-stu-id="55167-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="55167-333">[Referencia de la API de clase WebSecurity](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="55167-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="55167-334">[Referencia de la API de clase SimpleRoleProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="55167-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="55167-335">[Referencia de la API de clase SimpleMembershipProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="55167-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
