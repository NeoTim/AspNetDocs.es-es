---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
title: Usar procedimientos almacenados existentes para los TableAdapters del conjunto de de tipos (VB) | Microsoft Docs
author: rick-anderson
description: En el tutorial anterior se ha aprendido a usar el Asistente para TableAdapter para generar nuevos procedimientos almacenados. En este tutorial, aprenderá cómo el mismo TableAdapter...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 2da25f6a-757e-4e7b-a812-1575288d8f7a
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
msc.type: authoredcontent
ms.openlocfilehash: e35c3d6a98516a07f6119e6cb9dbeb99bc28fe33
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/28/2019
ms.locfileid: "74613548"
---
# <a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-vb"></a><span data-ttu-id="357a3-104">Usar procedimientos almacenados existentes para los TableAdapters del conjunto de datos con tipo (VB)</span><span class="sxs-lookup"><span data-stu-id="357a3-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (VB)</span></span>

<span data-ttu-id="357a3-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="357a3-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="357a3-106">[Descargar código](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip) o [Descargar PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="357a3-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span></span>

> <span data-ttu-id="357a3-107">En el tutorial anterior se ha aprendido a usar el Asistente para TableAdapter para generar nuevos procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="357a3-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="357a3-108">En este tutorial, aprenderá cómo el mismo asistente de TableAdapter puede trabajar con los procedimientos almacenados existentes.</span><span class="sxs-lookup"><span data-stu-id="357a3-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="357a3-109">También aprenderá a agregar manualmente nuevos procedimientos almacenados a nuestra base de datos.</span><span class="sxs-lookup"><span data-stu-id="357a3-109">We also learn how to manually add new stored procedures to our database.</span></span>

## <a name="introduction"></a><span data-ttu-id="357a3-110">Introducción</span><span class="sxs-lookup"><span data-stu-id="357a3-110">Introduction</span></span>

<span data-ttu-id="357a3-111">En el [tutorial anterior](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) , vimos cómo los TableAdapters del conjunto de datos con tipo pueden configurarse para usar procedimientos almacenados con el fin de obtener acceso a los datos en lugar de a las instrucciones SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="357a3-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="357a3-112">En concreto, hemos examinado cómo el Asistente para TableAdapter crea automáticamente estos procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="357a3-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="357a3-113">Al migrar una aplicación heredada a ASP.NET 2,0 o al compilar un sitio web de ASP.NET 2,0 en torno a un modelo de datos existente, lo más probable es que la base de datos ya contenga los procedimientos almacenados que necesitamos.</span><span class="sxs-lookup"><span data-stu-id="357a3-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="357a3-114">Como alternativa, puede que prefiera crear los procedimientos almacenados de forma manual o a través de alguna herramienta distinta del Asistente para TableAdapter que genera automáticamente los procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="357a3-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="357a3-115">En este tutorial, veremos cómo configurar el TableAdapter para usar los procedimientos almacenados existentes.</span><span class="sxs-lookup"><span data-stu-id="357a3-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="357a3-116">Dado que la base de datos Northwind solo tiene un pequeño conjunto de procedimientos almacenados integrados, también veremos los pasos necesarios para agregar manualmente nuevos procedimientos almacenados a la base de datos a través del entorno de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="357a3-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="357a3-117">Vamos a empezar a trabajar.</span><span class="sxs-lookup"><span data-stu-id="357a3-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="357a3-118">En el tutorial de ajuste de las [modificaciones de base de datos dentro de una transacción](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) se han agregado métodos a TableAdapter para admitir transacciones (`BeginTransaction`, `CommitTransaction`, etc.).</span><span class="sxs-lookup"><span data-stu-id="357a3-118">In the [Wrapping Database Modifications within a Transaction](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="357a3-119">Como alternativa, las transacciones se pueden administrar completamente dentro de un procedimiento almacenado, que no requiere ninguna modificación en el código del nivel de acceso a los datos.</span><span class="sxs-lookup"><span data-stu-id="357a3-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="357a3-120">En este tutorial exploraremos los comandos de T-SQL que se usan para ejecutar instrucciones de procedimientos almacenados en el ámbito de una transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>

## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="357a3-121">Paso 1: agregar procedimientos almacenados a la base de datos Northwind</span><span class="sxs-lookup"><span data-stu-id="357a3-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="357a3-122">Visual Studio facilita la tarea de agregar nuevos procedimientos almacenados a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="357a3-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="357a3-123">Permite agregar un nuevo procedimiento almacenado a la base de datos Northwind que devuelve todas las columnas de la tabla `Products` para las que tienen un valor `CategoryID` determinado.</span><span class="sxs-lookup"><span data-stu-id="357a3-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="357a3-124">En la ventana Explorador de servidores, expanda la base de datos Northwind para que se muestren sus carpetas, diagramas de base de datos, tablas, vistas, etc.</span><span class="sxs-lookup"><span data-stu-id="357a3-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="357a3-125">Como vimos en el tutorial anterior, la carpeta procedimientos almacenados contiene los procedimientos almacenados existentes de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="357a3-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="357a3-126">Para agregar un nuevo procedimiento almacenado, simplemente haga clic con el botón secundario en la carpeta procedimientos almacenados y elija la opción Agregar nuevo procedimiento almacenado en el menú contextual.</span><span class="sxs-lookup"><span data-stu-id="357a3-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>

<span data-ttu-id="357a3-127">[![haga clic con el botón secundario en la carpeta procedimientos almacenados y agregue un nuevo procedimiento almacenado](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span></span>

<span data-ttu-id="357a3-128">**Figura 1**: haga clic con el botón secundario en la carpeta procedimientos almacenados y agregue un nuevo procedimiento almacenado ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png))</span></span>

<span data-ttu-id="357a3-129">Como se muestra en la figura 1, al seleccionar la opción Agregar nuevo procedimiento almacenado, se abre una ventana de script en Visual Studio con el esquema de la secuencia de comandos SQL necesaria para crear el procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="357a3-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="357a3-130">Es nuestro trabajo extraer este script y ejecutarlo, momento en el que el procedimiento almacenado se agregará a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="357a3-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="357a3-131">Escriba el siguiente script:</span><span class="sxs-lookup"><span data-stu-id="357a3-131">Enter the following script:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample1.sql)]

<span data-ttu-id="357a3-132">Este script, cuando se ejecute, agregará un nuevo procedimiento almacenado a la base de datos Northwind denominada `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="357a3-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="357a3-133">Este procedimiento almacenado acepta un solo parámetro de entrada (`@CategoryID`, de tipo `int`) y devuelve todos los campos de los productos con un valor `CategoryID` coincidente.</span><span class="sxs-lookup"><span data-stu-id="357a3-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="357a3-134">Para ejecutar este script de `CREATE PROCEDURE` y agregar el procedimiento almacenado a la base de datos, haga clic en el icono guardar en la barra de herramientas o presione Ctrl + S.</span><span class="sxs-lookup"><span data-stu-id="357a3-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="357a3-135">Después de hacerlo, se actualiza la carpeta procedimientos almacenados, mostrando el procedimiento almacenado recién creado.</span><span class="sxs-lookup"><span data-stu-id="357a3-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="357a3-136">Además, el script de la ventana cambiará el detalle de `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` a `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="357a3-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="357a3-137">`CREATE PROCEDURE` agrega un nuevo procedimiento almacenado a la base de datos, mientras `ALTER PROCEDURE` actualiza uno existente.</span><span class="sxs-lookup"><span data-stu-id="357a3-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="357a3-138">Puesto que el inicio del script ha cambiado a `ALTER PROCEDURE`, al cambiar los parámetros de entrada o las instrucciones SQL de los procedimientos almacenados y al hacer clic en el icono de guardar se actualizará el procedimiento almacenado con estos cambios.</span><span class="sxs-lookup"><span data-stu-id="357a3-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="357a3-139">En la ilustración 2 se muestra Visual Studio una vez guardado el `Products_SelectByCategoryID` procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="357a3-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>

<span data-ttu-id="357a3-140">[![el procedimiento almacenado Products_SelectByCategoryID se ha agregado a la base de datos](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span></span>

<span data-ttu-id="357a3-141">**Figura 2**: se ha agregado el procedimiento almacenado `Products_SelectByCategoryID` a la base de datos ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span></span>

## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="357a3-142">Paso 2: configurar el TableAdapter para usar un procedimiento almacenado existente</span><span class="sxs-lookup"><span data-stu-id="357a3-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="357a3-143">Ahora que el `Products_SelectByCategoryID` procedimiento almacenado se ha agregado a la base de datos, podemos configurar nuestra capa de acceso a datos para que use este procedimiento almacenado cuando se invoque uno de sus métodos.</span><span class="sxs-lookup"><span data-stu-id="357a3-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can configure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="357a3-144">En concreto, agregaremos un método `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` a la `ProductsTableAdapter` en el `NorthwindWithSprocs` conjunto de datos con tipo que llama al procedimiento almacenado `Products_SelectByCategoryID` que acabamos de crear.</span><span class="sxs-lookup"><span data-stu-id="357a3-144">In particular, we will add a `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="357a3-145">Para empezar, abra el conjunto de `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="357a3-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="357a3-146">Haga clic con el botón derecho en el `ProductsTableAdapter` y elija Agregar consulta para iniciar el Asistente para configuración de consultas de TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="357a3-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="357a3-147">En el [tutorial anterior](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) , hemos optado por que TableAdapter creara un nuevo procedimiento almacenado para nosotros.</span><span class="sxs-lookup"><span data-stu-id="357a3-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="357a3-148">Sin embargo, para este tutorial, queremos conectar el nuevo método TableAdapter al procedimiento almacenado de `Products_SelectByCategoryID` existente.</span><span class="sxs-lookup"><span data-stu-id="357a3-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="357a3-149">Por lo tanto, elija la opción usar procedimiento almacenado existente en el primer paso del asistente y, a continuación, haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="357a3-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>

<span data-ttu-id="357a3-150">[![elegir la opción usar procedimiento almacenado existente](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span></span>

<span data-ttu-id="357a3-151">**Figura 3**: elija la opción usar procedimiento almacenado existente ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span></span>

<span data-ttu-id="357a3-152">En la pantalla siguiente se proporciona una lista desplegable que se rellena con los procedimientos almacenados de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="357a3-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="357a3-153">Al seleccionar un procedimiento almacenado se enumeran sus parámetros de entrada a la izquierda y los campos de datos devueltos (si existen) a la derecha.</span><span class="sxs-lookup"><span data-stu-id="357a3-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="357a3-154">Elija el `Products_SelectByCategoryID` procedimiento almacenado de la lista y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="357a3-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>

<span data-ttu-id="357a3-155">[![seleccionar el Products_SelectByCategoryID procedimiento almacenado](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span></span>

<span data-ttu-id="357a3-156">**Figura 4**: selección del `Products_SelectByCategoryID` procedimiento almacenado ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span></span>

<span data-ttu-id="357a3-157">En la pantalla siguiente se nos pregunta qué tipo de datos devuelve el procedimiento almacenado y nuestra respuesta determina el tipo devuelto por el método TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="357a3-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="357a3-158">Por ejemplo, si se indica que se devuelven datos tabulares, el método devolverá una `ProductsDataTable` instancia rellenada con los registros devueltos por el procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="357a3-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="357a3-159">Por el contrario, si se indica que este procedimiento almacenado devuelve un valor único, TableAdapter devolverá un `Object` al que se asigna el valor en la primera columna del primer registro devuelto por el procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="357a3-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `Object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="357a3-160">Como el `Products_SelectByCategoryID` procedimiento almacenado devuelve todos los productos que pertenecen a una categoría determinada, elija la primera respuesta: datos tabulares y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="357a3-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>

<span data-ttu-id="357a3-161">[![indican que el procedimiento almacenado devuelve datos tabulares](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span></span>

<span data-ttu-id="357a3-162">**Figura 5**: indicar que el procedimiento almacenado devuelve datos tabulares ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span></span>

<span data-ttu-id="357a3-163">Todo lo que queda es indicar qué patrones de método usar seguidos de los nombres de estos métodos.</span><span class="sxs-lookup"><span data-stu-id="357a3-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="357a3-164">Deje activada las opciones rellenar un DataTable y devolver una tabla de tipos, pero cambie el nombre de los métodos a `FillByCategoryID` y `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="357a3-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="357a3-165">A continuación, haga clic en siguiente para revisar un resumen de las tareas que realizará el asistente.</span><span class="sxs-lookup"><span data-stu-id="357a3-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="357a3-166">Si todo es correcto, haga clic en finalizar.</span><span class="sxs-lookup"><span data-stu-id="357a3-166">If everything looks correct, click Finish.</span></span>

<span data-ttu-id="357a3-167">[![nombre de los métodos FillByCategoryID y GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span></span>

<span data-ttu-id="357a3-168">**Figura 6**: asignar un nombre a los métodos `FillByCategoryID` y `GetProductsByCategoryID` ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="357a3-169">Los métodos de TableAdapter que se acaban de crear, `FillByCategoryID` y `GetProductsByCategoryID`, esperan un parámetro de entrada de tipo `Integer`.</span><span class="sxs-lookup"><span data-stu-id="357a3-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `Integer`.</span></span> <span data-ttu-id="357a3-170">Este valor de parámetro de entrada se pasa al procedimiento almacenado a través de su parámetro `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="357a3-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="357a3-171">Si modifica los parámetros del procedimiento almacenado de `Products_SelectByCategory`, deberá actualizar también los parámetros de estos métodos de TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="357a3-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="357a3-172">Tal y como se ha explicado en el [tutorial anterior](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md), esto se puede hacer de dos maneras: mediante la adición o eliminación manual de parámetros de la colección de parámetros o la reejecución del asistente de TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="357a3-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>

## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="357a3-173">Paso 3: agregar un método`GetProductsByCategoryID(categoryID)`a la capa BLL</span><span class="sxs-lookup"><span data-stu-id="357a3-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="357a3-174">Con el método `GetProductsByCategoryID` DAL completo, el siguiente paso es proporcionar acceso a este método en el nivel de lógica de negocios.</span><span class="sxs-lookup"><span data-stu-id="357a3-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="357a3-175">Abra el archivo de clase `ProductsBLLWithSprocs` y agregue el siguiente método:</span><span class="sxs-lookup"><span data-stu-id="357a3-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>

[!code-vb[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample2.vb)]

<span data-ttu-id="357a3-176">Este método BLL simplemente devuelve el `ProductsDataTable` devuelto desde el método `ProductsTableAdapter` s `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="357a3-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="357a3-177">El atributo `DataObjectMethodAttribute` proporciona metadatos utilizados por el Asistente para configurar orígenes de datos de ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="357a3-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="357a3-178">En concreto, este método aparecerá en la lista desplegable Seleccionar pestaña s.</span><span class="sxs-lookup"><span data-stu-id="357a3-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="357a3-179">Paso 4: visualización de productos por categoría</span><span class="sxs-lookup"><span data-stu-id="357a3-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="357a3-180">Para probar el procedimiento almacenado `Products_SelectByCategoryID` recién agregado y los métodos DAL y BLL correspondientes, cree una página ASP.NET que contenga un control DropDownList y un control GridView.</span><span class="sxs-lookup"><span data-stu-id="357a3-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="357a3-181">DropDownList mostrará todas las categorías en la base de datos, mientras que GridView mostrará los productos que pertenecen a la categoría seleccionada.</span><span class="sxs-lookup"><span data-stu-id="357a3-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="357a3-182">En los tutoriales anteriores, hemos creado interfaces de maestro y detalles con DropDownLists.</span><span class="sxs-lookup"><span data-stu-id="357a3-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="357a3-183">Para obtener información más detallada sobre cómo implementar este tipo de informe maestro y detalles, consulte el tutorial de [filtrado de maestro y detalles con DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="357a3-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) tutorial.</span></span>

<span data-ttu-id="357a3-184">Abra la página `ExistingSprocs.aspx` en la carpeta `AdvancedDAL` y arrastre un DropDownList desde el cuadro de herramientas hasta el diseñador.</span><span class="sxs-lookup"><span data-stu-id="357a3-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="357a3-185">Establezca la propiedad DropDownList s `ID` en `Categories` y su propiedad `AutoPostBack` en `True`.</span><span class="sxs-lookup"><span data-stu-id="357a3-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `True`.</span></span> <span data-ttu-id="357a3-186">A continuación, desde su etiqueta inteligente, enlace el DropDownList a un nuevo ObjectDataSource denominado `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="357a3-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="357a3-187">Configure ObjectDataSource para que recupere sus datos del método `CategoriesBLL` Class s `GetCategories`.</span><span class="sxs-lookup"><span data-stu-id="357a3-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="357a3-188">Establezca las listas desplegables de las pestañas actualizar, insertar y eliminar en (ninguna).</span><span class="sxs-lookup"><span data-stu-id="357a3-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="357a3-189">[![recuperar datos del método GetCategories de la clase CategoriesBLL](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span></span>

<span data-ttu-id="357a3-190">**Figura 7**: recuperación de datos del método `CategoriesBLL` Class s `GetCategories` ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span></span>

<span data-ttu-id="357a3-191">[![establecer las listas desplegables de las pestañas actualizar, insertar y eliminar en (ninguna)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span></span>

<span data-ttu-id="357a3-192">**Figura 8**: establecer las listas desplegables de las pestañas actualizar, insertar y eliminar en (ninguna) ([haga clic para ver la imagen a tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span></span>

<span data-ttu-id="357a3-193">Después de completar el Asistente de ObjectDataSource, configure el DropDownList para que muestre el `CategoryName` campo de datos y use el campo `CategoryID` como `Value` para cada `ListItem`.</span><span class="sxs-lookup"><span data-stu-id="357a3-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="357a3-194">En este momento, el marcado declarativo de DropDownList y ObjectDataSource es similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="357a3-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>

[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample3.aspx)]

<span data-ttu-id="357a3-195">A continuación, arrastre un control GridView hasta el diseñador, colocándolo debajo de DropDownList.</span><span class="sxs-lookup"><span data-stu-id="357a3-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="357a3-196">Establezca el `ID` de GridView en `ProductsByCategory` y, desde su etiqueta inteligente, enlácelo a un nuevo ObjectDataSource denominado `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="357a3-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="357a3-197">Configure el `ProductsByCategoryDataSource` ObjectDataSource para usar la clase `ProductsBLLWithSprocs`, de modo que recupere sus datos mediante el método `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="357a3-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="357a3-198">Puesto que este GridView solo se usará para Mostrar datos, establezca las listas desplegables de las pestañas actualizar, insertar y eliminar en (ninguno) y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="357a3-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>

<span data-ttu-id="357a3-199">[![configurar ObjectDataSource para usar la clase ProductsBLLWithSprocs](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span></span>

<span data-ttu-id="357a3-200">**Figura 9**: configuración de ObjectDataSource para usar la clase `ProductsBLLWithSprocs` ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span></span>

<span data-ttu-id="357a3-201">[![recuperar datos del método GetProductsByCategoryID (categoryID)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span></span>

<span data-ttu-id="357a3-202">**Figura 10**: recuperación de datos del método `GetProductsByCategoryID(categoryID)` ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span></span>

<span data-ttu-id="357a3-203">El método elegido en la pestaña seleccionar espera un parámetro, por lo que el paso final del asistente nos pide el origen del parámetro.</span><span class="sxs-lookup"><span data-stu-id="357a3-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="357a3-204">Establezca la lista desplegable origen del parámetro en control y elija el control `Categories` de la lista desplegable ControlID.</span><span class="sxs-lookup"><span data-stu-id="357a3-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="357a3-205">Haga clic en Finalizar para completar el asistente.</span><span class="sxs-lookup"><span data-stu-id="357a3-205">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="357a3-206">[![usar las categorías DropDownList como origen del parámetro categoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span></span>

<span data-ttu-id="357a3-207">**Figura 11**: Use el `Categories` DropDownList como origen del parámetro `categoryID` ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span></span>

<span data-ttu-id="357a3-208">Al completar el Asistente de ObjectDataSource, Visual Studio agregará BoundFields y CheckBoxField para cada uno de los campos de datos del producto.</span><span class="sxs-lookup"><span data-stu-id="357a3-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="357a3-209">Puede personalizar estos campos como considere oportuno.</span><span class="sxs-lookup"><span data-stu-id="357a3-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="357a3-210">Visite la página a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="357a3-210">Visit the page through a browser.</span></span> <span data-ttu-id="357a3-211">Al visitar la página, se selecciona la categoría bebidas y se muestran los productos correspondientes en la cuadrícula.</span><span class="sxs-lookup"><span data-stu-id="357a3-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="357a3-212">Al cambiar la lista desplegable a una categoría alternativa, como se muestra en la figura 12, se genera un postback y se recarga la cuadrícula con los productos de la categoría recién seleccionada.</span><span class="sxs-lookup"><span data-stu-id="357a3-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>

<span data-ttu-id="357a3-213">[![se muestran los productos de la categoría de producción](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span></span>

<span data-ttu-id="357a3-214">**Figura 12**: se muestran los productos de la categoría de producción ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span></span>

## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="357a3-215">Paso 5: encapsulado de instrucciones de procedimiento almacenado en el ámbito de una transacción</span><span class="sxs-lookup"><span data-stu-id="357a3-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="357a3-216">En el tutorial de ajuste de las [modificaciones de base de datos dentro de una transacción](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) , analizamos técnicas para realizar una serie de instrucciones de modificación de base de datos dentro del ámbito de una transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="357a3-217">Recuerde que las modificaciones realizadas bajo el paraguas de una transacción se realizan correctamente o no, lo que garantiza la atomicidad.</span><span class="sxs-lookup"><span data-stu-id="357a3-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="357a3-218">Las técnicas para el uso de transacciones incluyen:</span><span class="sxs-lookup"><span data-stu-id="357a3-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="357a3-219">Usar las clases en el espacio de nombres `System.Transactions`,</span><span class="sxs-lookup"><span data-stu-id="357a3-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="357a3-220">La capa de acceso a datos usa clases ADO.NET como `SqlTransaction`, y</span><span class="sxs-lookup"><span data-stu-id="357a3-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="357a3-221">Agregar los comandos de transacción de T-SQL directamente en el procedimiento almacenado</span><span class="sxs-lookup"><span data-stu-id="357a3-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="357a3-222">En el tutorial *ajustar las modificaciones de base de datos dentro de una transacción* se usan las clases ADO.net en la capa dal.</span><span class="sxs-lookup"><span data-stu-id="357a3-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="357a3-223">En el resto de este tutorial se examina cómo administrar una transacción mediante comandos de T-SQL desde un procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="357a3-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="357a3-224">Los tres comandos de SQL clave para iniciar, confirmar y revertir una transacción manualmente son `BEGIN TRANSACTION`, `COMMIT TRANSACTION`y `ROLLBACK TRANSACTION`, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="357a3-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="357a3-225">Al igual que con el enfoque ADO.NET, cuando se usan transacciones desde dentro de un procedimiento almacenado, es necesario aplicar el patrón siguiente:</span><span class="sxs-lookup"><span data-stu-id="357a3-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="357a3-226">Indica el inicio de una transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="357a3-227">Ejecutar las instrucciones SQL que componen la transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="357a3-228">Si hay un error en cualquiera de las instrucciones del paso 2, revierta la transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-228">If there is an error in any one of the statements from Step 2, rollback the transaction.</span></span>
4. <span data-ttu-id="357a3-229">Si todas las instrucciones del paso 2 se completan sin errores, confirme la transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="357a3-230">Este patrón se puede implementar en la sintaxis de T-SQL mediante la siguiente plantilla:</span><span class="sxs-lookup"><span data-stu-id="357a3-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample4.sql)]

<span data-ttu-id="357a3-231">La plantilla comienza por la definición de un bloque `TRY...CATCH`, una construcción nueva en SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="357a3-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="357a3-232">Al igual que con los bloques de `Try...Catch` en Visual Basic, el bloque de `TRY...CATCH` SQL ejecuta las instrucciones en el bloque de `TRY`.</span><span class="sxs-lookup"><span data-stu-id="357a3-232">Like with `Try...Catch` blocks in Visual Basic, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="357a3-233">Si alguna instrucción produce un error, el control se transfiere inmediatamente al bloque `CATCH`.</span><span class="sxs-lookup"><span data-stu-id="357a3-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="357a3-234">Si no hay errores al ejecutar las instrucciones SQL que estructuran la transacción, la instrucción `COMMIT TRANSACTION` confirma los cambios y completa la transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="357a3-235">Sin embargo, si una de las instrucciones produce un error, el `ROLLBACK TRANSACTION` del bloque `CATCH` devuelve la base de datos a su estado anterior al inicio de la transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="357a3-236">El procedimiento almacenado también genera un error con el [comando RAISERROR](https://msdn.microsoft.com/library/ms178592.aspx), que hace que se genere un `SqlException` en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="357a3-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="357a3-237">Dado que el bloque `TRY...CATCH` es nuevo en SQL Server 2005, la plantilla anterior no funcionará si usa versiones anteriores de Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="357a3-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="357a3-238">Si no utiliza SQL Server 2005, consulte Administración de [transacciones en SQL Server procedimientos almacenados](http://www.4guysfromrolla.com/webtech/080305-1.shtml) de una plantilla que funcionará con otras versiones de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="357a3-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>

<span data-ttu-id="357a3-239">Echemos un vistazo a un ejemplo concreto.</span><span class="sxs-lookup"><span data-stu-id="357a3-239">Let s look at a concrete example.</span></span> <span data-ttu-id="357a3-240">Existe una restricción FOREIGN KEY entre las tablas `Categories` y `Products`, lo que significa que cada campo `CategoryID` de la tabla `Products` debe asignarse a un valor `CategoryID` de la tabla `Categories`.</span><span class="sxs-lookup"><span data-stu-id="357a3-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="357a3-241">Cualquier acción que infrinja esta restricción, como intentar eliminar una categoría que tiene productos asociados, produce una infracción de la restricción FOREIGN KEY.</span><span class="sxs-lookup"><span data-stu-id="357a3-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="357a3-242">Para comprobarlo, vuelva a visitar el ejemplo de actualización y eliminación de datos binarios existentes en la sección trabajar con datos binarios (`~/BinaryData/UpdatingAndDeleting.aspx`).</span><span class="sxs-lookup"><span data-stu-id="357a3-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="357a3-243">En esta página se muestra una lista de cada categoría del sistema junto con los botones editar y eliminar (consulte la figura 13), pero si intenta eliminar una categoría que tiene productos asociados (como bebidas), se produce un error en la eliminación debido a una infracción de restricción de clave externa (consulte la figura 14).</span><span class="sxs-lookup"><span data-stu-id="357a3-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>

<span data-ttu-id="357a3-244">[![cada categoría se muestra en un control GridView con botones de edición y eliminación](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span></span>

<span data-ttu-id="357a3-245">**Figura 13**: cada categoría se muestra en un control GridView con botones de edición y eliminación ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span></span>

<span data-ttu-id="357a3-246">[![no puede eliminar una categoría que tenga productos existentes](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="357a3-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span></span>

<span data-ttu-id="357a3-247">**Figura 14**: no se puede eliminar una categoría que tenga productos existentes ([haga clic para ver la imagen de tamaño completo](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="357a3-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span></span>

<span data-ttu-id="357a3-248">No obstante, Imagine que queremos permitir la eliminación de las categorías independientemente de si tienen productos asociados.</span><span class="sxs-lookup"><span data-stu-id="357a3-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="357a3-249">Si se elimina una categoría con productos, Imagine que queremos eliminar también sus productos existentes (aunque otra opción sería simplemente establecer sus productos `CategoryID` valores en `NULL`).</span><span class="sxs-lookup"><span data-stu-id="357a3-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="357a3-250">Esta funcionalidad se puede implementar a través de las reglas en cascada de la restricción FOREIGN KEY.</span><span class="sxs-lookup"><span data-stu-id="357a3-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="357a3-251">Como alternativa, podríamos crear un procedimiento almacenado que acepta un `@CategoryID` parámetro de entrada y, cuando se invoca, elimina explícitamente todos los productos asociados y, a continuación, la categoría especificada.</span><span class="sxs-lookup"><span data-stu-id="357a3-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="357a3-252">Nuestro primer intento en este tipo de procedimiento almacenado podría ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="357a3-252">Our first attempt at such a stored procedure might look like the following:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample5.sql)]

<span data-ttu-id="357a3-253">Aunque esto eliminará definitivamente los productos y la categoría asociados, no lo hace en el paraguas de una transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="357a3-254">Imagine que hay alguna otra restricción FOREIGN KEY en `Categories` que prohíba la eliminación de un valor `@CategoryID` determinado.</span><span class="sxs-lookup"><span data-stu-id="357a3-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="357a3-255">El problema es que, en tal caso, todos los productos se eliminarán antes de intentar eliminar la categoría.</span><span class="sxs-lookup"><span data-stu-id="357a3-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="357a3-256">El resultado neto es que para este tipo de categoría, este procedimiento almacenado quitaría todos sus productos mientras la categoría permaneció porque todavía tiene registros relacionados en otra tabla.</span><span class="sxs-lookup"><span data-stu-id="357a3-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="357a3-257">Sin embargo, si el procedimiento almacenado se ajustó dentro del ámbito de una transacción, la eliminación en la tabla de `Products` se revertiría en el caso de una eliminación con errores en `Categories`.</span><span class="sxs-lookup"><span data-stu-id="357a3-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="357a3-258">El siguiente script de procedimiento almacenado utiliza una transacción para garantizar la atomicidad entre las dos instrucciones de `DELETE`:</span><span class="sxs-lookup"><span data-stu-id="357a3-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample6.sql)]

<span data-ttu-id="357a3-259">Dedique un momento a agregar el `Categories_Delete` procedimiento almacenado a la base de datos Northwind.</span><span class="sxs-lookup"><span data-stu-id="357a3-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="357a3-260">Consulte el paso 1 para obtener instrucciones sobre cómo agregar procedimientos almacenados a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="357a3-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="357a3-261">Paso 6: actualización del`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="357a3-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="357a3-262">Aunque se ha agregado el `Categories_Delete` procedimiento almacenado a la base de datos, la capa DAL está configurada actualmente para usar instrucciones SQL ad-hoc para realizar la eliminación.</span><span class="sxs-lookup"><span data-stu-id="357a3-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="357a3-263">Necesitamos actualizar el `CategoriesTableAdapter` e indicarle que use el `Categories_Delete` procedimiento almacenado en su lugar.</span><span class="sxs-lookup"><span data-stu-id="357a3-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="357a3-264">Anteriormente en este tutorial, trabajamos con el conjunto de `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="357a3-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="357a3-265">Pero el conjunto de cambios solo tiene una entidad única, `ProductsDataTable`y necesitamos trabajar con categorías.</span><span class="sxs-lookup"><span data-stu-id="357a3-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="357a3-266">Por lo tanto, para el resto de este tutorial, cuando hablemos sobre la capa de acceso a datos I m que hace referencia a la `Northwind` conjunto de datos, la que primero creamos en el tutorial [creación de una capa de acceso a datos](../introduction/creating-a-data-access-layer-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="357a3-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial.</span></span>

<span data-ttu-id="357a3-267">Abra el conjunto de de Northwind, seleccione el `CategoriesTableAdapter`y vaya al ventana Propiedades.</span><span class="sxs-lookup"><span data-stu-id="357a3-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="357a3-268">En el ventana Propiedades se enumeran los `InsertCommand`, `UpdateCommand`, `DeleteCommand`y `SelectCommand` utilizados por TableAdapter, así como su nombre y la información de conexión.</span><span class="sxs-lookup"><span data-stu-id="357a3-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="357a3-269">Expanda la propiedad `DeleteCommand` para ver sus detalles.</span><span class="sxs-lookup"><span data-stu-id="357a3-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="357a3-270">Como se muestra en la figura 15, la propiedad `DeleteCommand` s `CommandType` está establecida en texto, lo que le indica que envíe el texto de la propiedad `CommandText` como una consulta SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="357a3-270">As Figure 15 shows, the `DeleteCommand` s `CommandType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>

![Seleccione CategoriesTableAdapter en el diseñador para ver sus propiedades en la ventana Propiedades.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image43.png)

<span data-ttu-id="357a3-272">**Figura 15**: seleccione el `CategoriesTableAdapter` en el diseñador para ver sus propiedades en la ventana Propiedades.</span><span class="sxs-lookup"><span data-stu-id="357a3-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>

<span data-ttu-id="357a3-273">Para cambiar esta configuración, seleccione el texto (DeleteCommand) en el ventana Propiedades y elija (nuevo) en la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="357a3-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="357a3-274">Esto borrará la configuración de las propiedades `CommandText`, `CommandType`y `Parameters`.</span><span class="sxs-lookup"><span data-stu-id="357a3-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="357a3-275">A continuación, establezca la propiedad `CommandType` en `StoredProcedure` y escriba el nombre del procedimiento almacenado para el `CommandText` (`dbo.Categories_Delete`).</span><span class="sxs-lookup"><span data-stu-id="357a3-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="357a3-276">Si no está seguro de escribir las propiedades en este orden, en primer lugar el `CommandType` y, a continuación, el `CommandText`-Visual Studio rellenará automáticamente la colección de parámetros.</span><span class="sxs-lookup"><span data-stu-id="357a3-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="357a3-277">Si no especifica estas propiedades en este orden, tendrá que agregar manualmente los parámetros a través del editor de la colección de parámetros.</span><span class="sxs-lookup"><span data-stu-id="357a3-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="357a3-278">En cualquier caso, es prudente hacer clic en los puntos suspensivos de la propiedad parameters para abrir el editor de la colección de parámetros para comprobar que se han realizado los cambios de configuración de parámetros correctos (vea la figura 16).</span><span class="sxs-lookup"><span data-stu-id="357a3-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="357a3-279">Si no ve ningún parámetro en el cuadro de diálogo, agregue el parámetro `@CategoryID` manualmente (no es necesario agregar el parámetro `@RETURN_VALUE`).</span><span class="sxs-lookup"><span data-stu-id="357a3-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>

![Asegúrese de que la configuración de los parámetros sea correcta](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image44.png)

<span data-ttu-id="357a3-281">**Figura 16**: Asegúrese de que la configuración de los parámetros sea correcta</span><span class="sxs-lookup"><span data-stu-id="357a3-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>

<span data-ttu-id="357a3-282">Una vez actualizada la capa DAL, al eliminar una categoría se eliminarán automáticamente todos sus productos asociados y se realizará en el paraguas de una transacción.</span><span class="sxs-lookup"><span data-stu-id="357a3-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="357a3-283">Para comprobarlo, vuelva a la página actualizar y eliminar los datos binarios existentes y haga clic en el botón eliminar de una de las categorías.</span><span class="sxs-lookup"><span data-stu-id="357a3-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="357a3-284">Con un solo clic del mouse, se eliminarán la categoría y todos sus productos asociados.</span><span class="sxs-lookup"><span data-stu-id="357a3-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="357a3-285">Antes de probar el `Categories_Delete` procedimiento almacenado, que eliminará una serie de productos junto con la categoría seleccionada, puede ser prudente realizar una copia de seguridad de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="357a3-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="357a3-286">Si usa la base de datos de `NORTHWND.MDF` en `App_Data`, simplemente cierre Visual Studio y copie los archivos MDF y LDF de `App_Data` en otra carpeta.</span><span class="sxs-lookup"><span data-stu-id="357a3-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="357a3-287">Después de probar la funcionalidad, puede restaurar la base de datos cerrando Visual Studio y reemplazando los archivos MDF y LDF actuales en `App_Data` con las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="357a3-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>

## <a name="summary"></a><span data-ttu-id="357a3-288">Resumen</span><span class="sxs-lookup"><span data-stu-id="357a3-288">Summary</span></span>

<span data-ttu-id="357a3-289">Aunque el Asistente de TableAdapter s generará automáticamente procedimientos almacenados para nosotros, hay ocasiones en las que es posible que ya se hayan creado estos procedimientos almacenados o que desee crearlos manualmente o con otras herramientas.</span><span class="sxs-lookup"><span data-stu-id="357a3-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="357a3-290">Para dar cabida a estos escenarios, el TableAdapter también puede configurarse para que apunte a un procedimiento almacenado existente.</span><span class="sxs-lookup"><span data-stu-id="357a3-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="357a3-291">En este tutorial, hemos examinado cómo agregar manualmente procedimientos almacenados a una base de datos a través del entorno de Visual Studio y cómo conectar los métodos de TableAdapter s a estos procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="357a3-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="357a3-292">También hemos examinado los comandos de T-SQL y el patrón de scripts que se usan para iniciar, confirmar y revertir las transacciones desde dentro de un procedimiento almacenado.</span><span class="sxs-lookup"><span data-stu-id="357a3-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="357a3-293">¡ Feliz programación!</span><span class="sxs-lookup"><span data-stu-id="357a3-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="357a3-294">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="357a3-294">About the Author</span></span>

<span data-ttu-id="357a3-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros de ASP/ASP. net y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha estado trabajando con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="357a3-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="357a3-296">Scott funciona como consultor, profesor y redactor independiente.</span><span class="sxs-lookup"><span data-stu-id="357a3-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="357a3-297">Su último libro se [*enseña a ASP.NET 2,0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="357a3-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="357a3-298">Puede ponerse en contacto con usted en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="357a3-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="357a3-299">o a través de su blog, que encontrará en [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="357a3-299">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="357a3-300">Agradecimiento especial a</span><span class="sxs-lookup"><span data-stu-id="357a3-300">Special Thanks To</span></span>

<span data-ttu-id="357a3-301">Muchos revisores útiles revisaron esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="357a3-301">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="357a3-302">Los revisores responsables de este tutorial fueron Hilton Geisenow, S Ren Jacob Lauritsen y Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="357a3-302">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="357a3-303">¿Está interesado en revisar los próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="357a3-303">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="357a3-304">En caso afirmativo, suéltelo en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="357a3-304">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="357a3-305">[Anterior](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
> [Siguiente](updating-the-tableadapter-to-use-joins-vb.md)</span><span class="sxs-lookup"><span data-stu-id="357a3-305">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
[Next](updating-the-tableadapter-to-use-joins-vb.md)</span></span>
