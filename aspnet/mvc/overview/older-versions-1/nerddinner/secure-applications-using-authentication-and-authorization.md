---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Proteger aplicaciones mediante la autenticación y autorización | Microsoft Docs
author: microsoft
description: Paso 9 muestra cómo agregar autenticación y autorización para proteger nuestra aplicación NerdDinner, para que los usuarios necesitan registrar e inicie sesión en el sitio para crear...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 8d509c5f15bb4d5014e53b8dc2a736454238e72c
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/06/2019
ms.locfileid: "65122224"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="6e044-103">Proteger las aplicaciones mediante la autenticación y la autorización</span><span class="sxs-lookup"><span data-stu-id="6e044-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="6e044-104">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="6e044-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="6e044-105">Descargar PDF</span><span class="sxs-lookup"><span data-stu-id="6e044-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="6e044-106">Este es el paso 9 de manera gratuita ["" la aplicación NerdDinner](introducing-the-nerddinner-tutorial.md) que le guía a través cómo compilar un pequeño, pero completa, aplicación web mediante ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="6e044-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="6e044-107">Paso 9 muestra cómo agregar autenticación y autorización para proteger nuestra aplicación NerdDinner, para que los usuarios necesitan registrar y el inicio de sesión en el sitio para crear instancias dinners nuevo y solo el usuario que está hospedando una cena puede editar más adelante.</span><span class="sxs-lookup"><span data-stu-id="6e044-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="6e044-108">Si usa ASP.NET MVC 3, se recomienda que siga el [Introducción a trabajar con MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) o [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutoriales.</span><span class="sxs-lookup"><span data-stu-id="6e044-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="6e044-109">Paso 9 de NerdDinner: Autenticación y autorización</span><span class="sxs-lookup"><span data-stu-id="6e044-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="6e044-110">Ahora nuestra aplicación concede a cualquier persona de NerdDinner visitar el sitio la capacidad de crear y editar los detalles de cualquier cena.</span><span class="sxs-lookup"><span data-stu-id="6e044-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="6e044-111">Vamos a cambiar esto para que los usuarios necesitan registrar e inicie sesión en el sitio para crear instancias dinners nuevo y agregar una restricción para que solo el usuario que está hospedando una cena puede editar más adelante.</span><span class="sxs-lookup"><span data-stu-id="6e044-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="6e044-112">Para habilitar esta opción vamos a usar la autenticación y autorización para proteger nuestra aplicación.</span><span class="sxs-lookup"><span data-stu-id="6e044-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="6e044-113">Descripción de la autenticación y autorización</span><span class="sxs-lookup"><span data-stu-id="6e044-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="6e044-114">*Autenticación* es el proceso de identificar y validar la identidad de un cliente de acceso a una aplicación.</span><span class="sxs-lookup"><span data-stu-id="6e044-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="6e044-115">En términos más simples, consiste en identificar "quién es de los usuarios finales cuando visitan un sitio Web".</span><span class="sxs-lookup"><span data-stu-id="6e044-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="6e044-116">ASP.NET admite varias maneras de autenticar a los usuarios del explorador.</span><span class="sxs-lookup"><span data-stu-id="6e044-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="6e044-117">Para las aplicaciones web de Internet, el enfoque más común de autenticación utilizado se denomina "Autenticación de formularios".</span><span class="sxs-lookup"><span data-stu-id="6e044-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="6e044-118">Autenticación de formularios permite a un programador crear un formulario de inicio de sesión HTML dentro de su aplicación y, a continuación, validar el nombre de usuario y la contraseña de que un usuario final se envía en una base de datos u otro almacén de credenciales de contraseña.</span><span class="sxs-lookup"><span data-stu-id="6e044-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="6e044-119">Si la combinación de nombre de usuario/contraseña es correcta, el desarrollador, a continuación, puede solicitar a ASP.NET para emitir una cookie HTTP cifrada para identificar al usuario a través de las solicitudes futuras.</span><span class="sxs-lookup"><span data-stu-id="6e044-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="6e044-120">Vamos a mediante el uso de autenticación de formularios con nuestra aplicación NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="6e044-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="6e044-121">*Autorización* es el proceso de determinar si un usuario autenticado tiene permiso para tener acceso a una dirección URL o un recursos concreto o para realizar alguna acción.</span><span class="sxs-lookup"><span data-stu-id="6e044-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="6e044-122">Por ejemplo, dentro de nuestra aplicación NerdDinner desearemos autorizar que solo los usuarios que han iniciado sesión pueden tener acceso a la */Dinners/crear* dirección URL y crear instancias Dinners nuevo.</span><span class="sxs-lookup"><span data-stu-id="6e044-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="6e044-123">También nos conviene agregar lógica de autorización para que pueda editarlo – y denegar el acceso de edición a todos los demás usuarios solo el usuario que está hospedando una cena.</span><span class="sxs-lookup"><span data-stu-id="6e044-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="6e044-124">Autenticación de formularios y AccountController</span><span class="sxs-lookup"><span data-stu-id="6e044-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="6e044-125">La plantilla de proyecto de Visual Studio de forma predeterminada para ASP.NET MVC automáticamente habilita la autenticación de formularios cuando se crean nuevas aplicaciones de ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="6e044-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="6e044-126">También agrega automáticamente una implementación de página de inicio de sesión de cuenta pregenerados para el proyecto, lo que resulta muy fácil integrar la seguridad dentro de un sitio.</span><span class="sxs-lookup"><span data-stu-id="6e044-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="6e044-127">La página maestra Site.master de forma predeterminada muestra un vínculo "Iniciar sesión" en la parte superior derecha del sitio cuando no se autentica al usuario tener acceso a él:</span><span class="sxs-lookup"><span data-stu-id="6e044-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="6e044-128">Al hacer clic en el vínculo "Iniciar sesión" tarda un usuario en el */cuenta/inicio de sesión* dirección URL:</span><span class="sxs-lookup"><span data-stu-id="6e044-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="6e044-129">Los visitantes que aún no ha registrado pueden hacerlo haciendo clic en el vínculo "Register", que le llevarán a la */cuenta/Register* dirección URL y permitirles que escriba los detalles de la cuenta:</span><span class="sxs-lookup"><span data-stu-id="6e044-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="6e044-130">Al hacer clic en el botón "Registrar" crear un nuevo usuario en el sistema de pertenencia a ASP.NET y autenticar al usuario en el sitio mediante la autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="6e044-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="6e044-131">Cuando un usuario se ha iniciado sesión, el Site.master cambia la parte superior derecha de la página para generar un "Bienvenido [username]".</span><span class="sxs-lookup"><span data-stu-id="6e044-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="6e044-132">mensaje y se representa un "cerrar sesión" vincular en lugar de un "iniciar sesión" uno.</span><span class="sxs-lookup"><span data-stu-id="6e044-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="6e044-133">Al hacer clic en el vínculo "Cerrar sesión" cierra la sesión del usuario:</span><span class="sxs-lookup"><span data-stu-id="6e044-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="6e044-134">La funcionalidad de inicio de sesión, cierre de sesión y registro anterior se implementa dentro de la clase AccountController que se ha agregado a nuestro proyecto de Visual Studio cuando crea el proyecto.</span><span class="sxs-lookup"><span data-stu-id="6e044-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="6e044-135">Se implementa la interfaz de usuario para AccountController usar plantillas de vista en el directorio \Views\Account:</span><span class="sxs-lookup"><span data-stu-id="6e044-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="6e044-136">La clase AccountController utiliza el sistema de autenticación de formularios de ASP.NET para emitir cookies de autenticación cifrada y la API de pertenencia de ASP.NET para almacenar y validar los nombres de usuario y contraseña.</span><span class="sxs-lookup"><span data-stu-id="6e044-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="6e044-137">La API de pertenencia de ASP.NET es extensible y permite a cualquier almacén de credenciales de contraseña que se usará.</span><span class="sxs-lookup"><span data-stu-id="6e044-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="6e044-138">ASP.NET incluye las implementaciones del proveedor de pertenencia integrado que almacenan el nombre de usuario/contraseña dentro de una base de datos SQL o dentro de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="6e044-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="6e044-139">Podemos configurar qué proveedor de pertenencia que se debe usar nuestra aplicación NerdDinner, abra el archivo "web.config" en la raíz del proyecto y buscando el &lt;pertenencia&gt; sección dentro de él.</span><span class="sxs-lookup"><span data-stu-id="6e044-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="6e044-140">Registra el proveedor de pertenencia SQL predeterminado web.config agregado cuando se creó el proyecto y lo configura para utilizar una cadena de conexión denominada "ApplicationServices" para especificar la ubicación de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="6e044-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="6e044-141">La cadena de conexión predeterminada "ApplicationServices" (que se especifican dentro la &lt;connectionStrings&gt; sección del archivo web.config) está configurado para usar SQL Express.</span><span class="sxs-lookup"><span data-stu-id="6e044-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="6e044-142">Apunta a una base de datos de SQL Express denominado "ASPNETDB. MDF"en la aplicación" aplicación\_datos "directorio.</span><span class="sxs-lookup"><span data-stu-id="6e044-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="6e044-143">Si esta base de datos no existe en la primera vez que se usa la API de pertenencia dentro de la aplicación, ASP.NET creará automáticamente la base de datos y aprovisionar el esquema de base de datos de pertenencia apropiada dentro de él:</span><span class="sxs-lookup"><span data-stu-id="6e044-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="6e044-144">Si en lugar de usar SQL Express quisiera usar una instancia completa de SQL Server (o conectarse a una base de datos remota), todos los necesitaríamos tarea consiste en actualizar la cadena de conexión "ApplicationServices" dentro del archivo web.config y asegúrese de que el esquema de pertenencia adecuados se agregó a la apunta a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="6e044-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="6e044-145">Puede ejecutar el "aspnet\_regsql.exe" utilidad dentro del directorio \Windows\Microsoft.NET\Framework\v2.0.50727\ para agregar el esquema apropiado para la suscripción y los servicios de aplicaciones ASP.NET a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="6e044-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="6e044-146">Autorización de la dirección URL de instancias Dinners/Create con el filtro [Authorize]</span><span class="sxs-lookup"><span data-stu-id="6e044-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="6e044-147">No hemos tenido que escribir ningún código para habilitar una autenticación segura y la implementación de administración de cuenta para la aplicación NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="6e044-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="6e044-148">Los usuarios pueden registrar las cuentas nuevas con nuestra aplicación y el inicio de sesión o cierre de sesión del sitio.</span><span class="sxs-lookup"><span data-stu-id="6e044-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="6e044-149">Ahora podemos agregar lógica de autorización a la aplicación y usar el estado de la autenticación y el nombre de usuario de visitantes para controlar lo que puede y no pueden hacer desde el sitio.</span><span class="sxs-lookup"><span data-stu-id="6e044-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="6e044-150">Comencemos por agregar lógica de autorización a los métodos de acción "Crear" de nuestra clase DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6e044-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="6e044-151">En concreto, será necesario que los usuarios accedan a la */Dinners/crear* dirección URL debe haber iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="6e044-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="6e044-152">Si no ha iniciado sesión se le redirija a la página de inicio de sesión para que puede iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="6e044-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="6e044-153">Implementar esta lógica es bastante fácil.</span><span class="sxs-lookup"><span data-stu-id="6e044-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="6e044-154">Todo lo que necesitamos tarea consiste en Agregar un atributo de filtro [Authorize] a nuestros métodos de acción Create de este modo:</span><span class="sxs-lookup"><span data-stu-id="6e044-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="6e044-155">ASP.NET MVC admite la capacidad para crear "filtros de acción" que se pueden usar para implementar la lógica reutilizable que puede aplicarse mediante declaración a métodos de acción.</span><span class="sxs-lookup"><span data-stu-id="6e044-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="6e044-156">El filtro [Authorize] es uno de los filtros de acción integrados proporcionados por ASP.NET MVC, y permite al programador mediante declaración aplicar reglas de autorización a los métodos de acción y las clases de controlador.</span><span class="sxs-lookup"><span data-stu-id="6e044-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="6e044-157">Cuando se aplica sin parámetros (como anteriormente) se aplica el filtro [Authorize] que el usuario que realiza la solicitud del método de acción debe haber iniciado sesión, y le redireccionará automáticamente el explorador a la dirección URL de inicio de sesión si no lo son.</span><span class="sxs-lookup"><span data-stu-id="6e044-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="6e044-158">¿Al realizar esta redirección de la dirección URL originalmente solicitada se pasa como un argumento de cadena de consulta (por ejemplo: / cuenta/inicio de sesión? ReturnUrl = % 2fDinners % 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="6e044-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="6e044-159">AccountController, a continuación, redirigir al usuario a la dirección URL solicitada originalmente una vez que inicien sesión.</span><span class="sxs-lookup"><span data-stu-id="6e044-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="6e044-160">El filtro [Authorize] admite opcionalmente la capacidad para especificar una propiedad "Users" o "Roles" que puede utilizarse para requerir que el usuario es ambos iniciado en y dentro de una lista de usuarios permitidos o un miembro de un rol de seguridad permitidas.</span><span class="sxs-lookup"><span data-stu-id="6e044-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="6e044-161">Por ejemplo, el código siguiente solo permite que dos usuarios específicos, "scottgu" y "billg" tener acceso a la dirección URL de instancias Dinners/Create:</span><span class="sxs-lookup"><span data-stu-id="6e044-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="6e044-162">Incrustar nombres de usuario específicos dentro de código tiende a ser bastante fácil de mantener sin embargo.</span><span class="sxs-lookup"><span data-stu-id="6e044-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="6e044-163">Un enfoque mejor es definir "roles" de nivel superior que comprueba el código y, a continuación, para asignar usuarios a la función mediante una base de datos o el sistema de active directory (para habilitar la lista de asignación de usuario real para almacenarse externamente desde el código).</span><span class="sxs-lookup"><span data-stu-id="6e044-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="6e044-164">ASP.NET incluye una API de administración de roles integradas, así como un conjunto integrado de proveedores de funciones (incluidas las de SQL y Active Directory) que pueden ayudarle a realizar esta asignación de usuarios y roles.</span><span class="sxs-lookup"><span data-stu-id="6e044-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="6e044-165">A continuación, podríamos actualizamos el código para permitir que solo los usuarios dentro de un rol específico "admin" tener acceso a la dirección URL de instancias Dinners/Create:</span><span class="sxs-lookup"><span data-stu-id="6e044-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="6e044-166">Mediante la propiedad User.Identity.Name al crear instancias Dinners</span><span class="sxs-lookup"><span data-stu-id="6e044-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="6e044-167">Podemos recuperar el nombre de usuario del usuario ha iniciado sesión actualmente de una solicitud mediante la propiedad de User.Identity.Name expuesta en la clase base del controlador.</span><span class="sxs-lookup"><span data-stu-id="6e044-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="6e044-168">Anteriores cuando se implementa la versión de HTTP POST de nuestro método de acción Create() teníamos codificado de forma rígida la propiedad "HostedBy" de la cena a una cadena estática.</span><span class="sxs-lookup"><span data-stu-id="6e044-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="6e044-169">Nos podemos actualizar ahora este código para usar en su lugar la propiedad User.Identity.Name, así como agregar automáticamente una confirmación de asistencia para el host de creación de la cena:</span><span class="sxs-lookup"><span data-stu-id="6e044-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="6e044-170">Dado que hemos agregado un atributo [Authorize] al método Create(), ASP.NET MVC garantiza que el método de acción solo se ejecuta si el usuario visita la dirección URL de instancias Dinners/Create ha iniciado sesión en el sitio.</span><span class="sxs-lookup"><span data-stu-id="6e044-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="6e044-171">Por lo tanto, el valor de propiedad User.Identity.Name siempre contendrá un nombre de usuario válido.</span><span class="sxs-lookup"><span data-stu-id="6e044-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="6e044-172">Mediante la propiedad User.Identity.Name al editar las cenas</span><span class="sxs-lookup"><span data-stu-id="6e044-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="6e044-173">Ahora agreguemos alguna lógica de autorización que se restringe a los usuarios para que solo pueden editar las propiedades de instancias dinners que hospedan ellos mismos.</span><span class="sxs-lookup"><span data-stu-id="6e044-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="6e044-174">Para ello, primero vamos a agregar un método de aplicación auxiliar "IsHostedBy(username)" a nuestro objeto cena (dentro de la clase parcial Dinner.cs que hemos creado anteriormente).</span><span class="sxs-lookup"><span data-stu-id="6e044-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="6e044-175">Este método auxiliar devuelve true o false dependiendo de si un nombre de usuario proporcionado coincide con la propiedad HostedBy Dinner y encapsula la lógica necesaria para realizar una comparación de cadenas entre mayúsculas y minúsculas de ellos:</span><span class="sxs-lookup"><span data-stu-id="6e044-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="6e044-176">A continuación, vamos a agregar un atributo [Authorize] a los métodos de acción Edit() dentro de nuestra clase DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6e044-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="6e044-177">Así se asegurará de que los usuarios deben haber iniciado sesión solicitud un */dinners/Edit / [id]* dirección URL.</span><span class="sxs-lookup"><span data-stu-id="6e044-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="6e044-178">A continuación, podemos agregar código a nuestros métodos de edición que usa el método auxiliar Dinner.IsHostedBy(username) para comprobar que el usuario ha iniciado sesión coincide con el host de la cena.</span><span class="sxs-lookup"><span data-stu-id="6e044-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="6e044-179">Si el usuario no es el host, se le muestra una vista "InvalidOwner" y finalizar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="6e044-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="6e044-180">El código para hacer esto como el siguiente:</span><span class="sxs-lookup"><span data-stu-id="6e044-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="6e044-181">Podemos, a continuación, haga doble clic en el directorio \Views\Dinners y elegir Add -&gt;ver el comando de menú para crear una nueva vista "InvalidOwner".</span><span class="sxs-lookup"><span data-stu-id="6e044-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="6e044-182">Deberá rellenarla con el siguiente mensaje de error:</span><span class="sxs-lookup"><span data-stu-id="6e044-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="6e044-183">Y ahora cuando un usuario intenta modificar una cena no poseen, obtendrá un mensaje de error:</span><span class="sxs-lookup"><span data-stu-id="6e044-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="6e044-184">Nos podemos repetir los mismos pasos para los métodos de acción Delete() dentro de nuestro controlador para bloquear el permiso para eliminar también las cenas y asegúrese de que sólo el host de una cena puede eliminarlo.</span><span class="sxs-lookup"><span data-stu-id="6e044-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="6e044-185">Mostrar/ocultar editar y eliminar vínculos</span><span class="sxs-lookup"><span data-stu-id="6e044-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="6e044-186">Nos estamos vincula al método de acción Edit y Delete de nuestra clase DinnersController desde nuestra dirección URL de detalles:</span><span class="sxs-lookup"><span data-stu-id="6e044-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="6e044-187">Actualmente, se muestra los vínculos de acción de editar y eliminar independientemente de si el visitante para la dirección URL de detalles es el host de la cena.</span><span class="sxs-lookup"><span data-stu-id="6e044-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="6e044-188">Vamos a cambiar esto para que los vínculos se muestran solo si el usuario visitante es el propietario de la cena.</span><span class="sxs-lookup"><span data-stu-id="6e044-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="6e044-189">El método de acción Details() dentro de nuestro DinnersController recupera un objeto de la cena y, a continuación, pasa como el objeto de modelo a nuestra plantilla de vista:</span><span class="sxs-lookup"><span data-stu-id="6e044-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="6e044-190">Podemos actualizar la plantilla de vista para condicionalmente mostrar u ocultar los vínculos de edición y eliminación mediante el uso de la Dinner.IsHostedBy() como el método auxiliar siguiente:</span><span class="sxs-lookup"><span data-stu-id="6e044-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="6e044-191">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="6e044-191">Next Steps</span></span>

<span data-ttu-id="6e044-192">Ahora veamos cómo podemos habilitar a usuarios autenticados RSVP para instancias dinners mediante AJAX.</span><span class="sxs-lookup"><span data-stu-id="6e044-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6e044-193">[Anterior](implement-efficient-data-paging.md)
> [Siguiente](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="6e044-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
