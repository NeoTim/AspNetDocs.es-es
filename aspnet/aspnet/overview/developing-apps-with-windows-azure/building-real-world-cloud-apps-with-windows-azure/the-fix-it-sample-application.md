---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
title: 'Apéndice: aplicación de ejemplo de corrección (creación de aplicaciones en la nube reales con Azure) | Microsoft Docs'
author: MikeWasson
description: La creación de aplicaciones reales en la nube con el libro electrónico de Azure se basa en una presentación desarrollada por Scott Guthrie. Se explican 13 patrones y prácticas que pueden...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 1bc333c5-f096-4ea7-b170-779accc21c1a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
msc.type: authoredcontent
ms.openlocfilehash: 896196bdb6a6b0d12a6c798ead510e37dd38a9fc
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/19/2020
ms.locfileid: "77456886"
---
# <a name="appendix-the-fix-it-sample-application-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="65d18-104">Apéndice: aplicación de ejemplo de corrección (creación de aplicaciones en la nube reales con Azure)</span><span class="sxs-lookup"><span data-stu-id="65d18-104">Appendix: The Fix It Sample Application (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="65d18-105">por [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://twitter.com/RickAndMSFT), [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="65d18-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://twitter.com/RickAndMSFT), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="65d18-106">Descargar el proyecto de corrección de ti</span><span class="sxs-lookup"><span data-stu-id="65d18-106">Download The Fix It Project</span></span>](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)

> <span data-ttu-id="65d18-107">La **creación de aplicaciones reales en la nube con** el libro electrónico de Azure se basa en una presentación desarrollada por Scott Guthrie.</span><span class="sxs-lookup"><span data-stu-id="65d18-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="65d18-108">Se explican 13 patrones y prácticas que pueden ayudarle a desarrollar correctamente aplicaciones web para la nube.</span><span class="sxs-lookup"><span data-stu-id="65d18-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="65d18-109">Para obtener información sobre el libro electrónico, consulte [el primer capítulo](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="65d18-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="65d18-110">Este apéndice para crear aplicaciones en la nube de mundo real con el libro electrónico de Azure contiene las siguientes secciones que proporcionan información adicional sobre la aplicación de ejemplo de corrección de ti que puede descargar:</span><span class="sxs-lookup"><span data-stu-id="65d18-110">This appendix to the Building Real World Cloud Apps with Azure e-book contains the following sections that provide additional information about the Fix It sample application that you can download:</span></span>

- [<span data-ttu-id="65d18-111">Problemas conocidos</span><span class="sxs-lookup"><span data-stu-id="65d18-111">Known issues</span></span>](#knownissues)
- [<span data-ttu-id="65d18-112">procedimientos recomendados</span><span class="sxs-lookup"><span data-stu-id="65d18-112">Best practices</span></span>](#bestpractices)
- [<span data-ttu-id="65d18-113">Cómo ejecutar la aplicación desde Visual Studio en el equipo local</span><span class="sxs-lookup"><span data-stu-id="65d18-113">How to run the app from Visual Studio on your local computer</span></span>](#run-in-vs)
- [<span data-ttu-id="65d18-114">Implementación de la aplicación base para Azure App Service Web Apps mediante scripts de Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="65d18-114">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>](#deploybase)
- [<span data-ttu-id="65d18-115">Solución de problemas de los scripts de Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="65d18-115">Troubleshooting the Windows PowerShell scripts</span></span>](#troubleshooting)
- [<span data-ttu-id="65d18-116">Implementación de la aplicación con el procesamiento de colas para Azure App Service Web Apps y un servicio en la nube de Azure</span><span class="sxs-lookup"><span data-stu-id="65d18-116">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>](#deployqueues)

<a id="knownissues"></a>
## <a name="known-issues"></a><span data-ttu-id="65d18-117">Problemas conocidos</span><span class="sxs-lookup"><span data-stu-id="65d18-117">Known issues</span></span>

<span data-ttu-id="65d18-118">La aplicación Fix it se desarrolló originalmente para ilustrar lo más sencillo posible algunos de los patrones presentados en este libro electrónico.</span><span class="sxs-lookup"><span data-stu-id="65d18-118">The Fix It app was originally developed in order to illustrate as simply as possible some of the patterns presented in this e-book.</span></span> <span data-ttu-id="65d18-119">Sin embargo, dado que el libro electrónico trata sobre la creación de aplicaciones reales, nos hemos sometido al código de corrección para un proceso de revisión y pruebas similar a lo que hacemos para el software publicado.</span><span class="sxs-lookup"><span data-stu-id="65d18-119">However, since the e-book is about building real-world apps, we subjected the Fix It code to a review and testing process similar to what we'd do for released software.</span></span> <span data-ttu-id="65d18-120">Encontramos varios problemas y, al igual que con cualquier aplicación real, algunos de ellos se corrigieron y algunos de ellos se aplazón a una versión posterior.</span><span class="sxs-lookup"><span data-stu-id="65d18-120">We found a number of issues, and as with any real-world application, some of them we fixed and some of them we deferred to a later release.</span></span>

<span data-ttu-id="65d18-121">En la lista siguiente se incluyen los problemas que deben abordarse en una aplicación de producción, pero por un motivo u otro que decidimos no abordar en la versión inicial de la aplicación de ejemplo Fix it.</span><span class="sxs-lookup"><span data-stu-id="65d18-121">The following list includes issues that should be addressed in a production application, but for one reason or another we decided not to address in the initial release of the Fix It sample application.</span></span>

### <a name="security"></a><span data-ttu-id="65d18-122">Seguridad</span><span class="sxs-lookup"><span data-stu-id="65d18-122">Security</span></span>

- <span data-ttu-id="65d18-123">Asegúrese de que no se puede asignar una tarea a un propietario no existente.</span><span class="sxs-lookup"><span data-stu-id="65d18-123">Ensure that you can't assign a task to a non-existent owner.</span></span>
- <span data-ttu-id="65d18-124">Asegúrese de que solo puede ver y modificar las tareas que ha creado o que tiene asignadas.</span><span class="sxs-lookup"><span data-stu-id="65d18-124">Ensure that you can only view and modify tasks that you created or are assigned to you.</span></span>
- <span data-ttu-id="65d18-125">Use HTTPS para las páginas de inicio de sesión y las cookies de autenticación.</span><span class="sxs-lookup"><span data-stu-id="65d18-125">Use HTTPS for sign-in pages and authentication cookies.</span></span>
- <span data-ttu-id="65d18-126">Especifique un límite de tiempo para las cookies de autenticación.</span><span class="sxs-lookup"><span data-stu-id="65d18-126">Specify a time limit for authentication cookies.</span></span>

### <a name="input-validation"></a><span data-ttu-id="65d18-127">Validación de entradas</span><span class="sxs-lookup"><span data-stu-id="65d18-127">Input validation</span></span>

<span data-ttu-id="65d18-128">En general, una aplicación de producción realizaría más validaciones de entrada que la aplicación de corrección de ti.</span><span class="sxs-lookup"><span data-stu-id="65d18-128">In general, a production app would do more input validation than the Fix It app.</span></span> <span data-ttu-id="65d18-129">Por ejemplo, el tamaño de imagen/tamaño de archivo de imagen permitido para la carga debe ser limitado.</span><span class="sxs-lookup"><span data-stu-id="65d18-129">For example, the image size / image file size allowed for upload should be limited.</span></span>

### <a name="administrator-functionality"></a><span data-ttu-id="65d18-130">Funcionalidad de administrador</span><span class="sxs-lookup"><span data-stu-id="65d18-130">Administrator functionality</span></span>

<span data-ttu-id="65d18-131">Un administrador debe poder cambiar la propiedad de las tareas existentes.</span><span class="sxs-lookup"><span data-stu-id="65d18-131">An administrator should be able to change ownership on existing tasks.</span></span> <span data-ttu-id="65d18-132">Por ejemplo, el creador de una tarea podría dejar la compañía, sin dejar ninguna con autoridad para mantener la tarea a menos que esté habilitado el acceso administrativo.</span><span class="sxs-lookup"><span data-stu-id="65d18-132">For example, the creator of a task might leave the company, leaving no one with authority to maintain the task unless administrative access is enabled.</span></span>

### <a name="queue-message-processing"></a><span data-ttu-id="65d18-133">Procesamiento de mensajes en cola</span><span class="sxs-lookup"><span data-stu-id="65d18-133">Queue message processing</span></span>

<span data-ttu-id="65d18-134">El procesamiento de mensajes en cola en la aplicación Fix it se diseñó para ser sencillo con el fin de ilustrar el patrón de trabajo centrado en cola con una cantidad mínima de código.</span><span class="sxs-lookup"><span data-stu-id="65d18-134">Queue message processing in the Fix It app was designed to be simple in order to illustrate the queue-centric work pattern with a minimum amount of code.</span></span> <span data-ttu-id="65d18-135">Este código simple no sería adecuado para una aplicación de producción real.</span><span class="sxs-lookup"><span data-stu-id="65d18-135">This simple code would not be adequate for an actual production application.</span></span>

- <span data-ttu-id="65d18-136">El código no garantiza que cada mensaje de la cola se procese como máximo una vez.</span><span class="sxs-lookup"><span data-stu-id="65d18-136">The code does not guarantee that each queue message will be processed at most once.</span></span> <span data-ttu-id="65d18-137">Cuando recibe un mensaje de la cola, hay un período de tiempo de espera, durante el cual el mensaje es invisible para otros agentes de escucha de la cola.</span><span class="sxs-lookup"><span data-stu-id="65d18-137">When you get a message from the queue, there is a timeout period, during which the message is invisible to other queue listeners.</span></span> <span data-ttu-id="65d18-138">Si el tiempo de espera expira antes de que se elimine el mensaje, el mensaje vuelve a estar visible.</span><span class="sxs-lookup"><span data-stu-id="65d18-138">If the timeout expires before the message is deleted, the message becomes visible again.</span></span> <span data-ttu-id="65d18-139">Por lo tanto, si una instancia de rol de trabajo dedica mucho tiempo a procesar un mensaje, teóricamente es posible que el mismo mensaje se procese dos veces, lo que da lugar a una tarea duplicada en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="65d18-139">Therefore, if a worker role instance spends a long time processing a message, it is theoretically possible for the same message to get processed twice, resulting in a duplicate task in the database.</span></span> <span data-ttu-id="65d18-140">Para obtener más información acerca de este problema, consulte [uso de colas de Azure Storage](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span><span class="sxs-lookup"><span data-stu-id="65d18-140">For more information about this issue, see [Using Azure Storage Queues](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span></span>
- <span data-ttu-id="65d18-141">La lógica de sondeo de la cola puede ser más rentable, mediante el procesamiento por lotes de la recuperación de mensajes.</span><span class="sxs-lookup"><span data-stu-id="65d18-141">The queue polling logic could be more cost-effective, by batching message retrieval.</span></span> <span data-ttu-id="65d18-142">Cada vez que llame a [CloudQueue. GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), existe un costo de transacción.</span><span class="sxs-lookup"><span data-stu-id="65d18-142">Every time you call [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), there is a transaction cost.</span></span> <span data-ttu-id="65d18-143">En su lugar, puede llamar a [CloudQueue. GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (tenga en cuenta el ') del plural, que recibe varios mensajes en una sola transacción.</span><span class="sxs-lookup"><span data-stu-id="65d18-143">Instead, you can call [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (note the plural 's'), which gets multiple messages in a single transaction.</span></span> <span data-ttu-id="65d18-144">Los costos de las transacciones Azure Storage las colas son muy bajos, por lo que el impacto en los costos no es importante en la mayoría de los escenarios.</span><span class="sxs-lookup"><span data-stu-id="65d18-144">The transaction costs for Azure Storage Queues are very low, so the impact on costs is not substantial in most scenarios.</span></span>
- <span data-ttu-id="65d18-145">El bucle estrecho en el código de procesamiento de mensajes en cola provoca la afinidad de la CPU, que no emplea máquinas virtuales de varios núcleos de forma eficaz.</span><span class="sxs-lookup"><span data-stu-id="65d18-145">The tight loop in the queue message-processing code causes CPU affinity, which does not utilize multi-core VMs efficiently.</span></span> <span data-ttu-id="65d18-146">Un mejor diseño sería usar el paralelismo de tareas para ejecutar varias tareas asincrónicas en paralelo.</span><span class="sxs-lookup"><span data-stu-id="65d18-146">A better design would use task parallelism to run several async tasks in parallel.</span></span>
- <span data-ttu-id="65d18-147">Mensaje en cola: el procesamiento solo tiene un control de excepciones rudimentaria.</span><span class="sxs-lookup"><span data-stu-id="65d18-147">Queue message-processing has only rudimentary exception handling.</span></span> <span data-ttu-id="65d18-148">Por ejemplo, el código no controla [los mensajes dudosos](https://msdn.microsoft.com/library/ms789028.aspx).</span><span class="sxs-lookup"><span data-stu-id="65d18-148">For example, the code doesn't handle [poison messages](https://msdn.microsoft.com/library/ms789028.aspx).</span></span> <span data-ttu-id="65d18-149">(Cuando el procesamiento de mensajes produce una excepción, tiene que registrar el error y eliminar el mensaje, o bien el rol de trabajo intentará procesarlo de nuevo y el bucle continuará indefinidamente).</span><span class="sxs-lookup"><span data-stu-id="65d18-149">(When message processing causes an exception, you have to log the error and delete the message, or the worker role will try to process it again, and the loop will continue indefinitely.)</span></span>

### <a name="sql-queries-are-unbounded"></a><span data-ttu-id="65d18-150">Las consultas SQL están sin enlazar</span><span class="sxs-lookup"><span data-stu-id="65d18-150">SQL queries are unbounded</span></span>

<span data-ttu-id="65d18-151">El código de corrección actual no establece ningún límite en el número de filas que pueden devolver las consultas para las páginas de índice.</span><span class="sxs-lookup"><span data-stu-id="65d18-151">Current Fix It code places no limit on how many rows the queries for Index pages might return.</span></span> <span data-ttu-id="65d18-152">Si se especifica un gran volumen de tareas en la base de datos, el tamaño de las listas resultantes recibidas podría causar problemas de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="65d18-152">If a large volume of tasks is entered into the database, the size of the resulting lists received could cause performance issues.</span></span> <span data-ttu-id="65d18-153">La solución consiste en implementar la paginación.</span><span class="sxs-lookup"><span data-stu-id="65d18-153">The solution is to implement paging.</span></span> <span data-ttu-id="65d18-154">Para obtener un ejemplo, vea [ordenación, filtrado y paginación con el Entity Framework en una aplicación ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="65d18-154">For an example, see [Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span></span>

### <a name="view-models-recommended"></a><span data-ttu-id="65d18-155">Ver modelos recomendados</span><span class="sxs-lookup"><span data-stu-id="65d18-155">View models recommended</span></span>

<span data-ttu-id="65d18-156">La aplicación Fix it usa la clase de entidad FixItTask para pasar información entre el controlador y la vista.</span><span class="sxs-lookup"><span data-stu-id="65d18-156">The Fix It app uses the FixItTask entity class to pass information between the controller and the view.</span></span> <span data-ttu-id="65d18-157">Un procedimiento recomendado es usar los modelos de vista.</span><span class="sxs-lookup"><span data-stu-id="65d18-157">A best practice is to use view models.</span></span> <span data-ttu-id="65d18-158">El modelo de dominio (por ejemplo, la clase de entidad FixItTask) está diseñado en torno a lo que se necesita para la persistencia de datos, mientras que un modelo de vista se puede diseñar para la presentación de datos.</span><span class="sxs-lookup"><span data-stu-id="65d18-158">The domain model (e.g., the FixItTask entity class) is designed around what is needed for data persistence, while a view model can be designed for data presentation.</span></span> <span data-ttu-id="65d18-159">Para obtener más información, vea [12 procedimientos recomendados de MVC de ASP.net](https://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span><span class="sxs-lookup"><span data-stu-id="65d18-159">For more information, see [12 ASP.NET MVC Best Practices](https://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span></span>

### <a name="secure-image-blob-recommended"></a><span data-ttu-id="65d18-160">Se recomienda el BLOB de imagen segura</span><span class="sxs-lookup"><span data-stu-id="65d18-160">Secure image blob recommended</span></span>

<span data-ttu-id="65d18-161">La aplicación Fix it almacena las imágenes cargadas como públicas, lo que significa que cualquiera que encuentre la dirección URL puede acceder a las imágenes.</span><span class="sxs-lookup"><span data-stu-id="65d18-161">The Fix It app stores uploaded images as public, meaning that anyone who finds the URL can access the images.</span></span> <span data-ttu-id="65d18-162">Las imágenes se pueden proteger en lugar de ser públicas.</span><span class="sxs-lookup"><span data-stu-id="65d18-162">The images could be secured instead of public.</span></span>

### <a name="no-powershell-automation-scripts-for-queues"></a><span data-ttu-id="65d18-163">No hay scripts de automatización de PowerShell para colas</span><span class="sxs-lookup"><span data-stu-id="65d18-163">No PowerShell automation scripts for queues</span></span>

<span data-ttu-id="65d18-164">Los scripts de Automation de PowerShell de ejemplo solo se escribieron para la versión base de Fix que se ejecuta completamente en Azure App Service Web Apps.</span><span class="sxs-lookup"><span data-stu-id="65d18-164">Sample PowerShell automation scripts were written only for the base version of Fix It that runs entirely in Azure App Service Web Apps.</span></span> <span data-ttu-id="65d18-165">No se han proporcionado scripts para configurar e implementar en la aplicación Web más el entorno de servicio en la nube necesario para el procesamiento de colas.</span><span class="sxs-lookup"><span data-stu-id="65d18-165">We haven't provided scripts for setting up and deploying to the web app plus Cloud Service environment required for queue processing.</span></span>

### <a name="special-handling-for-html-codes-in-user-input"></a><span data-ttu-id="65d18-166">Control especial para códigos HTML en datos proporcionados por el usuario</span><span class="sxs-lookup"><span data-stu-id="65d18-166">Special handling for HTML codes in user input</span></span>

<span data-ttu-id="65d18-167">ASP.NET evita automáticamente muchas maneras en las que los usuarios malintencionados podrían intentar ataques de scripts entre sitios escribiendo el script en los cuadros de texto de entrada del usuario.</span><span class="sxs-lookup"><span data-stu-id="65d18-167">ASP.NET automatically prevents many ways in which malicious users might attempt cross-site scripting attacks by entering script in user input text boxes.</span></span> <span data-ttu-id="65d18-168">Y la aplicación auxiliar de `DisplayFor` MVC que se usa para mostrar los títulos de tarea y las notas codifica automáticamente los valores que envía al explorador.</span><span class="sxs-lookup"><span data-stu-id="65d18-168">And the MVC `DisplayFor` helper used to display task titles and notes automatically HTML-encodes values that it sends to the browser.</span></span> <span data-ttu-id="65d18-169">Pero en una aplicación de producción podría querer tomar medidas adicionales.</span><span class="sxs-lookup"><span data-stu-id="65d18-169">But in a production app you might want to take additional measures.</span></span> <span data-ttu-id="65d18-170">Para obtener más información, consulte [solicitud de validación en ASP.net](https://msdn.microsoft.com/library/hh882339.aspx).</span><span class="sxs-lookup"><span data-stu-id="65d18-170">For more information, see [Request Validation in ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span></span>

<a id="bestpractices"></a>
## <a name="best-practices"></a><span data-ttu-id="65d18-171">Procedimientos recomendados</span><span class="sxs-lookup"><span data-stu-id="65d18-171">Best practices</span></span>

<span data-ttu-id="65d18-172">A continuación se indican algunos problemas que se corrigieron después de detectarse en la revisión de código y las pruebas de la versión original de la aplicación de corrección de ti.</span><span class="sxs-lookup"><span data-stu-id="65d18-172">Following are some issues that were fixed after being discovered in code review and testing of the original version of the Fix It app.</span></span> <span data-ttu-id="65d18-173">Algunos se deben a que el codificador original no es consciente de un procedimiento recomendado determinado, algunos simplemente porque el código se ha escrito rápidamente y no se ha diseñado para software publicado.</span><span class="sxs-lookup"><span data-stu-id="65d18-173">Some were caused by the original coder not being aware of a particular best practice, some simply because the code was written quickly and wasn't intended for released software.</span></span> <span data-ttu-id="65d18-174">Aquí se enumeran los problemas en caso de que se haya aprendido esta revisión y las pruebas que podrían ser útiles para otras personas que también desarrollan aplicaciones Web.</span><span class="sxs-lookup"><span data-stu-id="65d18-174">We're listing the issues here in case there's something we learned from this review and testing that might be helpful to others who are also developing web apps.</span></span>

### <a name="dispose-the-database-repository"></a><span data-ttu-id="65d18-175">Desechar el repositorio de base de datos</span><span class="sxs-lookup"><span data-stu-id="65d18-175">Dispose the database repository</span></span>

<span data-ttu-id="65d18-176">La clase `FixItTaskRepository` debe eliminar la instancia de `DbContext` Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="65d18-176">The `FixItTaskRepository` class must dispose the Entity Framework `DbContext` instance.</span></span> <span data-ttu-id="65d18-177">Lo hicimos implementando `IDisposable` en la clase `FixItTaskRepository`:</span><span class="sxs-lookup"><span data-stu-id="65d18-177">We did this by implementing `IDisposable` in the `FixItTaskRepository` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample1.cs)]

<span data-ttu-id="65d18-178">Tenga en cuenta que AutoFac eliminará automáticamente la instancia de `FixItTaskRepository`, por lo que no es necesario desecharla explícitamente.</span><span class="sxs-lookup"><span data-stu-id="65d18-178">Note that AutoFac will automatically dispose the `FixItTaskRepository` instance, so we don't need to explicitly dispose it.</span></span>

<span data-ttu-id="65d18-179">Otra opción consiste en quitar el `DbContext` variable miembro de `FixItTaskRepository`y, en su lugar, crear una variable local `DbContext` dentro de cada método del repositorio, dentro de una instrucción `using`.</span><span class="sxs-lookup"><span data-stu-id="65d18-179">Another option is to remove the `DbContext` member variable from `FixItTaskRepository`, and instead create a local `DbContext` variable within each repository method, inside a `using` statement.</span></span> <span data-ttu-id="65d18-180">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="65d18-180">For example:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample2.cs)]

### <a name="register-singletons-as-such-with-di"></a><span data-ttu-id="65d18-181">Registrar singleton como tal con DI</span><span class="sxs-lookup"><span data-stu-id="65d18-181">Register singletons as such with DI</span></span>

<span data-ttu-id="65d18-182">Puesto que solo se necesita una instancia de la clase `PhotoService` y `Logger` clase, estas clases deben [registrarse como instancias únicas para la inserción de dependencias](https://code.google.com/p/autofac/wiki/InstanceScope) en *DependenciesConfig.CS*:</span><span class="sxs-lookup"><span data-stu-id="65d18-182">Since only one instance of the `PhotoService` class and `Logger` class is needed, these classes should be [registered as single instances for dependency injection](https://code.google.com/p/autofac/wiki/InstanceScope) in *DependenciesConfig.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample3.cs?highlight=1,3)]

### <a name="security-dont-show-error-details-to-users"></a><span data-ttu-id="65d18-183">Seguridad: no mostrar los detalles del error a los usuarios</span><span class="sxs-lookup"><span data-stu-id="65d18-183">Security: Don't show error details to users</span></span>

<span data-ttu-id="65d18-184">La aplicación de corrección de ti original no tenía una página de error genérica y solo permite que todas las excepciones se propaguen hasta la interfaz de usuario, por lo que algunas excepciones, como los errores de conexión de base de datos, pueden dar lugar a que se muestre un seguimiento de la pila completo en el explorador.</span><span class="sxs-lookup"><span data-stu-id="65d18-184">The original Fix It app didn't have a generic error page and just let all exceptions bubble up to the UI, so some exceptions such as database connection errors could result in a full stack trace being displayed to the browser.</span></span> <span data-ttu-id="65d18-185">A veces, la información detallada del error puede facilitar los ataques de usuarios malintencionados.</span><span class="sxs-lookup"><span data-stu-id="65d18-185">Detailed error information can sometimes facilitate attacks by malicious users.</span></span> <span data-ttu-id="65d18-186">La solución consiste en registrar los detalles de la excepción y mostrar una página de error al usuario que no incluye los detalles del error.</span><span class="sxs-lookup"><span data-stu-id="65d18-186">The solution is to log the exception details and display an error page to the user that doesn't include error details.</span></span> <span data-ttu-id="65d18-187">La aplicación Fix it ya estaba registrando y, para mostrar una página de error, agregamos `<customErrors mode=On>` en el archivo Web. config.</span><span class="sxs-lookup"><span data-stu-id="65d18-187">The Fix It app was already logging, and in order to display an error page, we added `<customErrors mode=On>` in the Web.config file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample4.xml?highlight=2)]

<span data-ttu-id="65d18-188">De forma predeterminada, esto hace que *Views\Shared\Error.cshtml* se muestre en busca de errores.</span><span class="sxs-lookup"><span data-stu-id="65d18-188">By default this causes *Views\Shared\Error.cshtml* to be displayed for errors.</span></span> <span data-ttu-id="65d18-189">Puede personalizar *error. cshtml* o crear su propia vista de página de error y agregar un atributo `defaultRedirect`.</span><span class="sxs-lookup"><span data-stu-id="65d18-189">You can customize *Error.cshtml* or create your own error page view and add a `defaultRedirect` attribute.</span></span> <span data-ttu-id="65d18-190">También puede especificar diferentes páginas de error para errores concretos.</span><span class="sxs-lookup"><span data-stu-id="65d18-190">You can also specify different error pages for specific errors.</span></span>

### <a name="security-only-allow-a-task-to-be-edited-by-its-creator"></a><span data-ttu-id="65d18-191">Seguridad: solo permite que el creador edite una tarea</span><span class="sxs-lookup"><span data-stu-id="65d18-191">Security: only allow a task to be edited by its creator</span></span>

<span data-ttu-id="65d18-192">La página de índice del panel solo muestra las tareas creadas por el usuario que ha iniciado sesión, pero un usuario malintencionado podría crear una dirección URL con un identificador a la tarea de otro usuario.</span><span class="sxs-lookup"><span data-stu-id="65d18-192">The Dashboard Index page only shows tasks created by the logged-on user, but a malicious user could create a URL with an ID to another user's task.</span></span> <span data-ttu-id="65d18-193">Hemos agregado código en *DashboardController.CS* para devolver 404 en ese caso:</span><span class="sxs-lookup"><span data-stu-id="65d18-193">We added code in *DashboardController.cs* to return a 404 in that case:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample5.cs?highlight=9-14,24-29)]

### <a name="dont-swallow-exceptions"></a><span data-ttu-id="65d18-194">No admitir excepciones</span><span class="sxs-lookup"><span data-stu-id="65d18-194">Don't swallow exceptions</span></span>

<span data-ttu-id="65d18-195">La aplicación Fix it original devolvió NULL después de registrar una excepción que resultó de una consulta SQL:</span><span class="sxs-lookup"><span data-stu-id="65d18-195">The original Fix It app just returned null after logging an exception that resulted from a SQL query:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample6.cs?highlight=4)]

<span data-ttu-id="65d18-196">De este modo, se vería al usuario como si la consulta se realizara correctamente pero no devolvería ninguna fila.</span><span class="sxs-lookup"><span data-stu-id="65d18-196">This would make it look to the user as if the query succeeded but just didn't return any rows.</span></span> <span data-ttu-id="65d18-197">La solución consiste en volver a producir la excepción después de detectar y registrar:</span><span class="sxs-lookup"><span data-stu-id="65d18-197">Solution is to re-throw the exception after catching and logging:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample7.cs)]

### <a name="catch-all-exceptions-in-worker-roles"></a><span data-ttu-id="65d18-198">Detección de todas las excepciones en los roles de trabajo</span><span class="sxs-lookup"><span data-stu-id="65d18-198">Catch all exceptions in worker roles</span></span>

<span data-ttu-id="65d18-199">Cualquier excepción no controlada en un rol de trabajo hará que la máquina virtual se recicle, por lo que querrá incluir todo lo que haga en un bloque try-catch y controlar todas las excepciones.</span><span class="sxs-lookup"><span data-stu-id="65d18-199">Any unhandled exceptions in a worker role will cause the VM to be recycled, so you want to wrap everything you do in a try-catch block and handle all exceptions.</span></span>

### <a name="specify-length-for-string-properties-in-entity-classes"></a><span data-ttu-id="65d18-200">Especificar la longitud de las propiedades de cadena en las clases de entidad</span><span class="sxs-lookup"><span data-stu-id="65d18-200">Specify length for string properties in entity classes</span></span>

<span data-ttu-id="65d18-201">Para Mostrar código simple, la versión original de la aplicación Fix it no especificó longitudes para los campos de la entidad FixItTask y, como resultado, se definieron como varchar (Max) en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="65d18-201">In order to display simple code, the original version of the Fix It app didn't specify lengths for the fields of the FixItTask entity, and as a result they were defined as varchar(max) in the database.</span></span> <span data-ttu-id="65d18-202">Como resultado, la interfaz de usuario aceptaría prácticamente cualquier cantidad de entrada.</span><span class="sxs-lookup"><span data-stu-id="65d18-202">As a result, the UI would accept almost any amount of input.</span></span> <span data-ttu-id="65d18-203">Especificar longitudes establece límites que se aplican a los datos proporcionados por el usuario en la página web y el tamaño de la columna en la base de datos:</span><span class="sxs-lookup"><span data-stu-id="65d18-203">Specifying lengths sets limits that apply both to user input in the web page and column size in the database:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample8.cs?highlight=4,7,10,12,14)]

### <a name="mark-private-members-as-readonly-when-they-arent-expected-to-change"></a><span data-ttu-id="65d18-204">Marcar miembros privados como ReadOnly cuando no se espera que cambien</span><span class="sxs-lookup"><span data-stu-id="65d18-204">Mark private members as readonly when they aren't expected to change</span></span>

<span data-ttu-id="65d18-205">Por ejemplo, en la clase `DashboardController` se crea una instancia de `FixItTaskRepository` y no se espera que cambie, por lo que se define como [ReadOnly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span><span class="sxs-lookup"><span data-stu-id="65d18-205">For example, in the `DashboardController` class an instance of `FixItTaskRepository` is created and isn't expected to change, so we defined it as [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample9.cs?highlight=3)]

### <a name="use-listany-instead-of-listcount-gt-0"></a><span data-ttu-id="65d18-206">Usar lista. Any () en lugar de List. Count () &gt; 0</span><span class="sxs-lookup"><span data-stu-id="65d18-206">Use list.Any() instead of list.Count() &gt; 0</span></span>

<span data-ttu-id="65d18-207">Si todo lo que le interesa es que uno o varios elementos de una lista se ajusten a los criterios especificados, use el método [any](https://msdn.microsoft.com/library/bb534972.aspx) , ya que devuelve en cuanto se encuentra un elemento de ajuste de los criterios, mientras que el método `Count` siempre tiene que recorrer en iteración todos los elementos.</span><span class="sxs-lookup"><span data-stu-id="65d18-207">If you all you care about is whether one or more items in a list fit the specified criteria, use the [Any](https://msdn.microsoft.com/library/bb534972.aspx) method, because it returns as soon as an item fitting the criteria is found, whereas the `Count` method always has to iterate through every item.</span></span> <span data-ttu-id="65d18-208">El archivo *index. cshtml* del panel tenía originalmente este código:</span><span class="sxs-lookup"><span data-stu-id="65d18-208">The Dashboard *Index.cshtml* file originally had this code:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample10.cshtml)]

<span data-ttu-id="65d18-209">Lo hemos cambiado por este:</span><span class="sxs-lookup"><span data-stu-id="65d18-209">We changed it to this:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample11.cshtml?highlight=1)]

### <a name="generate-urls-in-mvc-views-using-mvc-helpers"></a><span data-ttu-id="65d18-210">Generación de direcciones URL en las vistas de MVC con aplicaciones auxiliares de MVC</span><span class="sxs-lookup"><span data-stu-id="65d18-210">Generate URLs in MVC views using MVC helpers</span></span>

<span data-ttu-id="65d18-211">En el botón **crear un solucionador de ti** de la Página principal, la aplicación corregir it ha codificado de forma rígida un elemento delimitador:</span><span class="sxs-lookup"><span data-stu-id="65d18-211">For the **Create a Fix It** button on the home page, the Fix It app hard coded an anchor element:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample12.cshtml)]

<span data-ttu-id="65d18-212">En el caso de vínculos de vista o acción como este, es mejor usar la aplicación auxiliar de HTML de la [dirección URL. Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) , por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="65d18-212">For View/Action links like this it's better to use the [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) HTML helper, for example:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample13.cshtml)]

### <a name="use-taskdelay-instead-of-threadsleep-in-worker-role"></a><span data-ttu-id="65d18-213">Usar Task. Delay en lugar de Thread. Sleep en el rol de trabajo</span><span class="sxs-lookup"><span data-stu-id="65d18-213">Use Task.Delay instead of Thread.Sleep in worker role</span></span>

<span data-ttu-id="65d18-214">La plantilla New-Project coloca `Thread.Sleep` en el código de ejemplo de un rol de trabajo, pero hacer que el subproceso se suspenda puede provocar que el grupo de subprocesos genere subprocesos innecesarios adicionales.</span><span class="sxs-lookup"><span data-stu-id="65d18-214">The new-project template puts `Thread.Sleep` in the sample code for a worker role, but causing the thread to sleep can cause the thread pool to spawn additional unnecessary threads.</span></span> <span data-ttu-id="65d18-215">Puede evitarlo mediante [Task. Delay](https://msdn.microsoft.com/library/hh139096.aspx) en su lugar.</span><span class="sxs-lookup"><span data-stu-id="65d18-215">You can avoid that by using [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) instead.</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample14.cs?highlight=11)]

### <a name="avoid-async-void"></a><span data-ttu-id="65d18-216">Evitar la anulación de Async</span><span class="sxs-lookup"><span data-stu-id="65d18-216">Avoid async void</span></span>

<span data-ttu-id="65d18-217">Si un método asincrónico no necesita devolver un valor, devuelve un tipo de `Task` en lugar de `void`.</span><span class="sxs-lookup"><span data-stu-id="65d18-217">If an async method doesn't need to return a value, return a `Task` type rather than `void`.</span></span>

<span data-ttu-id="65d18-218">Este ejemplo es de la clase `FixItQueueManager`:</span><span class="sxs-lookup"><span data-stu-id="65d18-218">This example is from the `FixItQueueManager` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample15.cs)]

<span data-ttu-id="65d18-219">Solo debe usar `async void` para los controladores de eventos de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="65d18-219">You should use `async void` only for top-level event handlers.</span></span> <span data-ttu-id="65d18-220">Si define un método como `async void`, el llamador no puede **esperar** al método o detectar las excepciones que el método produce.</span><span class="sxs-lookup"><span data-stu-id="65d18-220">If you define a method as `async void`, the caller cannot **await** the method or catch any exceptions the method throws.</span></span> <span data-ttu-id="65d18-221">Para obtener más información, vea [prácticas recomendadas en programación asincrónica](https://msdn.microsoft.com/magazine/jj991977.aspx).</span><span class="sxs-lookup"><span data-stu-id="65d18-221">For more information, see [Best Practices in Asynchronous Programming](https://msdn.microsoft.com/magazine/jj991977.aspx).</span></span>

### <a name="use-a-cancellation-token-to-break-from-worker-role-loop"></a><span data-ttu-id="65d18-222">Usar un token de cancelación para interrumpir el bucle de rol de trabajo</span><span class="sxs-lookup"><span data-stu-id="65d18-222">Use a cancellation token to break from worker role loop</span></span>

<span data-ttu-id="65d18-223">Normalmente, el método **Run** de un rol de trabajo contiene un bucle infinito.</span><span class="sxs-lookup"><span data-stu-id="65d18-223">Typically, the **Run** method on a worker role contains an infinite loop.</span></span> <span data-ttu-id="65d18-224">Cuando se detiene el rol de trabajo, se llama al método [RoleEntryPoint. OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) .</span><span class="sxs-lookup"><span data-stu-id="65d18-224">When the worker role is stopping, the [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) method is called.</span></span> <span data-ttu-id="65d18-225">Debe utilizar este método para cancelar el trabajo que se realiza en el método **Run** y salir correctamente.</span><span class="sxs-lookup"><span data-stu-id="65d18-225">You should use this method to cancel the work that is being done inside the **Run** method and exit gracefully.</span></span> <span data-ttu-id="65d18-226">De lo contrario, el proceso podría terminar en medio de una operación.</span><span class="sxs-lookup"><span data-stu-id="65d18-226">Otherwise, the process might be terminated in the middle of an operation.</span></span>

### <a name="opt-out-of-automatic-mime-sniffing-procedure"></a><span data-ttu-id="65d18-227">No participar en el procedimiento automático de rastreo de MIME</span><span class="sxs-lookup"><span data-stu-id="65d18-227">Opt out of Automatic MIME Sniffing Procedure</span></span>

<span data-ttu-id="65d18-228">En algunos casos, Internet Explorer informa de un tipo MIME diferente del tipo especificado por el servidor Web.</span><span class="sxs-lookup"><span data-stu-id="65d18-228">In some cases, Internet Explorer reports a MIME type different than the type specified by the web server.</span></span> <span data-ttu-id="65d18-229">Por ejemplo, si Internet Explorer encuentra contenido HTML en un archivo entregado con el encabezado de respuesta HTTP Content-Type: text/plain, Internet Explorer determina que el contenido se debe representar como HTML.</span><span class="sxs-lookup"><span data-stu-id="65d18-229">For instance, if Internet Explorer finds HTML content in a file delivered with the HTTP response header Content-Type: text/plain, Internet Explorer determines that the content should be rendered as HTML.</span></span> <span data-ttu-id="65d18-230">Desafortunadamente, este "examen de MIME" también puede provocar problemas de seguridad en los servidores que hospedan contenido que no es de confianza.</span><span class="sxs-lookup"><span data-stu-id="65d18-230">Unfortunately, this "MIME-sniffing" can also lead to security problems for servers hosting untrusted content.</span></span> <span data-ttu-id="65d18-231">Para combatir este problema, Internet Explorer 8 ha realizado varios cambios en el código de determinación del tipo MIME y permite a los desarrolladores [de aplicaciones dejar de participar en el examen de MIME](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span><span class="sxs-lookup"><span data-stu-id="65d18-231">To combat this problem, Internet Explorer 8 has made a number of changes to MIME-type determination code and allows application developers to [opt out of MIME-sniffing](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span></span> <span data-ttu-id="65d18-232">El código siguiente se ha agregado al archivo *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="65d18-232">The following code was added to the *Web.config* file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample16.xml?highlight=2-7)]

### <a name="enable-bundling-and-minification"></a><span data-ttu-id="65d18-233">Habilitación de la agrupación y minificación</span><span class="sxs-lookup"><span data-stu-id="65d18-233">Enable bundling and minification</span></span>

<span data-ttu-id="65d18-234">Cuando Visual Studio crea un nuevo proyecto Web, la agrupación y minificación de archivos JavaScript no está habilitada de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="65d18-234">When Visual Studio creates a new web project, bundling and minification of JavaScript files is not enabled by default.</span></span> <span data-ttu-id="65d18-235">Hemos agregado una línea de código en BundleConfig.cs:</span><span class="sxs-lookup"><span data-stu-id="65d18-235">We added a line of code in BundleConfig.cs:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample17.cs?highlight=9)]

### <a name="set-an-expiration-time-out-for-authentication-cookies"></a><span data-ttu-id="65d18-236">Establecer un tiempo de espera de expiración para las cookies de autenticación</span><span class="sxs-lookup"><span data-stu-id="65d18-236">Set an expiration time-out for authentication cookies</span></span>

<span data-ttu-id="65d18-237">De forma predeterminada, las cookies de autenticación caducan en dos semanas.</span><span class="sxs-lookup"><span data-stu-id="65d18-237">By default, authentication cookies expire in two weeks.</span></span> <span data-ttu-id="65d18-238">Un tiempo más corto es más seguro.</span><span class="sxs-lookup"><span data-stu-id="65d18-238">A shorter time is more secure.</span></span> <span data-ttu-id="65d18-239">Puede cambiar esta configuración en *StartupAuth.CS*:</span><span class="sxs-lookup"><span data-stu-id="65d18-239">You can change this setting in *StartupAuth.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample18.cs?highlight=4-5)]

<a id="run-in-vs"></a>
## <a name="how-to-run-the-app-from-visual-studio-on-your-local-computer"></a><span data-ttu-id="65d18-240">Cómo ejecutar la aplicación desde Visual Studio en el equipo local</span><span class="sxs-lookup"><span data-stu-id="65d18-240">How to run the app from Visual Studio on your local computer</span></span>

<span data-ttu-id="65d18-241">Hay dos maneras de ejecutar la aplicación Fix it:</span><span class="sxs-lookup"><span data-stu-id="65d18-241">There are two ways to run the Fix It app:</span></span>

- <span data-ttu-id="65d18-242">Ejecute la aplicación base que escribe tareas nuevas directamente en la base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="65d18-242">Run the base application that writes new tasks directly to the SQL database.</span></span>
- <span data-ttu-id="65d18-243">Ejecute la aplicación con una cola más un servicio back-end para crear tareas.</span><span class="sxs-lookup"><span data-stu-id="65d18-243">Run the application using a queue plus a backend service to create tasks.</span></span> <span data-ttu-id="65d18-244">El patrón de cola se describe en el capítulo [patrón de trabajo centrado en cola](queue-centric-work-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="65d18-244">The queue pattern is described in the chapter [Queue-Centric Work Pattern](queue-centric-work-pattern.md).</span></span>

<a id="runbase"></a>
### <a name="run-the-base-application"></a><span data-ttu-id="65d18-245">Ejecutar la aplicación base</span><span class="sxs-lookup"><span data-stu-id="65d18-245">Run the base application</span></span>

1. <span data-ttu-id="65d18-246">Instalación de [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span><span class="sxs-lookup"><span data-stu-id="65d18-246">Install [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span></span>
2. <span data-ttu-id="65d18-247">Instale el [SDK de Azure para .net para Visual Studio](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="65d18-247">Install the [Azure SDK for .NET for Visual Studio](https://azure.microsoft.com/downloads/).</span></span>
3. <span data-ttu-id="65d18-248">Descargue el archivo. zip de la [Galería de código de MSDN](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span><span class="sxs-lookup"><span data-stu-id="65d18-248">Download the .zip file from the [MSDN Code Gallery](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span></span>
4. <span data-ttu-id="65d18-249">En el explorador de archivos, haga clic con el botón derecho en el archivo. zip, haga clic en propiedades y, a continuación, en el ventana Propiedades haga clic en desbloquear.</span><span class="sxs-lookup"><span data-stu-id="65d18-249">In File Explorer, right-click the .zip file and click Properties, then in the Properties window click Unblock.</span></span>
5. <span data-ttu-id="65d18-250">Descomprima el archivo.</span><span class="sxs-lookup"><span data-stu-id="65d18-250">Unzip the file.</span></span>
6. <span data-ttu-id="65d18-251">Haga doble clic en el archivo. sln para iniciar Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="65d18-251">Double-click the .sln file to launch Visual Studio.</span></span>
7. <span data-ttu-id="65d18-252">En el menú **herramientas** , haga clic en **Administrador de paquetes NuGet**y luego en **consola del administrador de paquetes**.</span><span class="sxs-lookup"><span data-stu-id="65d18-252">From the **Tools** menu, click **NuGet Package Manager**, then **Package Manager Console**.</span></span>
8. <span data-ttu-id="65d18-253">En la consola del administrador de paquetes (PMC), haga clic en restaurar.</span><span class="sxs-lookup"><span data-stu-id="65d18-253">In the Package Manager Console (PMC), click Restore.</span></span>
9. <span data-ttu-id="65d18-254">Salga de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="65d18-254">Exit Visual Studio.</span></span>
10. <span data-ttu-id="65d18-255">Inicie el [emulador de almacenamiento de Azure](/azure/storage/common/storage-use-emulator).</span><span class="sxs-lookup"><span data-stu-id="65d18-255">Start the [Azure storage emulator](/azure/storage/common/storage-use-emulator).</span></span>
11. <span data-ttu-id="65d18-256">Reinicie Visual Studio y abra el archivo de solución que cerró en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="65d18-256">Restart Visual Studio, opening the solution file you closed in the previous step.</span></span>
12. <span data-ttu-id="65d18-257">Asegúrese de que el proyecto FixIt está establecido como proyecto de inicio y, a continuación, presione CTRL + F5 para ejecutar el proyecto.</span><span class="sxs-lookup"><span data-stu-id="65d18-257">Make sure the FixIt project is set as the startup project, and then press CTRL+F5 to run the project.</span></span>

<a id="queueslocal"></a>
### <a name="run-the-application-with-queue-processing"></a><span data-ttu-id="65d18-258">Ejecutar la aplicación con el procesamiento de colas</span><span class="sxs-lookup"><span data-stu-id="65d18-258">Run the application with queue processing</span></span>

1. <span data-ttu-id="65d18-259">Siga las instrucciones para [ejecutar la aplicación base](#runbase)y, a continuación, cierre el explorador y cierre Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="65d18-259">Follow the directions for [Run the base application](#runbase), and then close the browser and close Visual Studio.</span></span>
2. <span data-ttu-id="65d18-260">Inicie Visual Studio con privilegios de administrador.</span><span class="sxs-lookup"><span data-stu-id="65d18-260">Start Visual Studio with administrator privileges.</span></span> <span data-ttu-id="65d18-261">(Va a usar el emulador de proceso de Azure y que requiere privilegios de administrador).</span><span class="sxs-lookup"><span data-stu-id="65d18-261">(You'll be using the Azure compute emulator, and that requires administrator privileges.)</span></span>
3. <span data-ttu-id="65d18-262">En el archivo *Web. config* de la aplicación en el proyecto *MyFixIt* (el proyecto web), cambie el valor de `appSettings/UseQueues` a "true":</span><span class="sxs-lookup"><span data-stu-id="65d18-262">In the application *Web.config* file in the *MyFixIt* project (the web project), change the value of `appSettings/UseQueues` to "true":</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample19.cmd?highlight=3)]
4. <span data-ttu-id="65d18-263">Si el [emulador de Azure Storage](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) aún no se está ejecutando, inícielo de nuevo.</span><span class="sxs-lookup"><span data-stu-id="65d18-263">If the [Azure storage emulator](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) isn't still running, start it again.</span></span>
5. <span data-ttu-id="65d18-264">Ejecute el proyecto web FixIt y el proyecto MyFixItCloudService simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="65d18-264">Run the FixIt web project and the MyFixItCloudService project simultaneously.</span></span>

    <span data-ttu-id="65d18-265">Con Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="65d18-265">Using Visual Studio:</span></span>

   1. <span data-ttu-id="65d18-266">Presione **F5** para ejecutar el proyecto FixIt.</span><span class="sxs-lookup"><span data-stu-id="65d18-266">Press **F5** to run the FixIt project.</span></span>
   2. <span data-ttu-id="65d18-267">En **Explorador de soluciones**, haga clic con el botón secundario en el proyecto MyFixItCloudService y, a continuación, haga clic en **depurar** > **Iniciar nueva instancia**.</span><span class="sxs-lookup"><span data-stu-id="65d18-267">In **Solution Explorer**, right-click the MyFixItCloudService project, and then click **Debug** > **Start New Instance**.</span></span>

    <span data-ttu-id="65d18-268">Usar Visual Studio 2013 Express para Web:</span><span class="sxs-lookup"><span data-stu-id="65d18-268">Using Visual Studio 2013 Express for Web:</span></span>

   3. <span data-ttu-id="65d18-269">En Explorador de soluciones, haga clic con el botón secundario en la solución FixIt y seleccione **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="65d18-269">In Solution Explorer, right-click the FixIt solution and select **Properties**.</span></span>
   4. <span data-ttu-id="65d18-270">Seleccione **proyectos de inicio múltiples**.</span><span class="sxs-lookup"><span data-stu-id="65d18-270">Select **Multiple Startup Projects**.</span></span>
   5. <span data-ttu-id="65d18-271">En la lista desplegable **acción** , en MyFixIt y MyFixItCloudService, seleccione **iniciar**.</span><span class="sxs-lookup"><span data-stu-id="65d18-271">In the **Action** dropdown list under MyFixIt and MyFixItCloudService, select **Start**.</span></span>
   6. <span data-ttu-id="65d18-272">Haga clic en **OK**.</span><span class="sxs-lookup"><span data-stu-id="65d18-272">Click **OK**.</span></span>
   7. <span data-ttu-id="65d18-273">Presione **F5** para ejecutar ambos proyectos.</span><span class="sxs-lookup"><span data-stu-id="65d18-273">Press **F5** to run both projects.</span></span>

      <span data-ttu-id="65d18-274">Al ejecutar el proyecto MyFixItCloudService, Visual Studio inicia el emulador de proceso de Azure.</span><span class="sxs-lookup"><span data-stu-id="65d18-274">When you run the MyFixItCloudService project, Visual Studio starts the Azure compute emulator.</span></span> <span data-ttu-id="65d18-275">En función de la configuración del firewall, es posible que deba permitir el emulador a través del firewall.</span><span class="sxs-lookup"><span data-stu-id="65d18-275">Depending on your firewall configuration, you might need to allow the emulator through the firewall.</span></span>

<a id="deploybase"></a>
## <a name="how-to-deploy-the-base-app-to-azure-app-service-web-apps-by-using-the-windows-powershell-scripts"></a><span data-ttu-id="65d18-276">Implementación de la aplicación base para Azure App Service Web Apps mediante scripts de Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="65d18-276">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>

<span data-ttu-id="65d18-277">Para ilustrar el patrón [automatizar todo](automate-everything.md) , se proporciona la aplicación Fix it con scripts que configuran un entorno en Azure e implementan el proyecto en el nuevo entorno.</span><span class="sxs-lookup"><span data-stu-id="65d18-277">To illustrate the [Automate Everything](automate-everything.md) pattern, the Fix It app is supplied with scripts that set up an environment in Azure and deploy the project to the new environment.</span></span> <span data-ttu-id="65d18-278">En las instrucciones siguientes se explica cómo usar los scripts.</span><span class="sxs-lookup"><span data-stu-id="65d18-278">The following instructions explain how to use the scripts.</span></span>

<span data-ttu-id="65d18-279">Si desea ejecutar en Azure sin usar colas y realizó los cambios para que se ejecuten localmente con colas, asegúrese de establecer el valor de UseQueues appSetting de nuevo en false antes de continuar con las instrucciones siguientes.</span><span class="sxs-lookup"><span data-stu-id="65d18-279">If you want to run in Azure without using queues, and you made the changes to run locally with queues, make sure you set the UseQueues appSetting value back to false before proceeding with the following instructions.</span></span>

<span data-ttu-id="65d18-280">En estas instrucciones se supone que ya ha descargado y ejecutado la solución de corrección de ti localmente y que tiene una cuenta de Azure o tiene una suscripción de Azure que está autorizado a administrar.</span><span class="sxs-lookup"><span data-stu-id="65d18-280">These instructions assume you have already downloaded and run the Fix It solution locally, and that you have an Azure account or have an Azure subscription that you are authorized to manage.</span></span>

1. <span data-ttu-id="65d18-281">Instale la consola de **Azure PowerShell** .</span><span class="sxs-lookup"><span data-stu-id="65d18-281">Install the **Azure PowerShell** console.</span></span> <span data-ttu-id="65d18-282">Para obtener instrucciones, consulte [Instalación y configuración de Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span><span class="sxs-lookup"><span data-stu-id="65d18-282">For instructions, see [How to install and configure Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span></span>

    <span data-ttu-id="65d18-283">Esta consola personalizada está configurada para trabajar con su suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="65d18-283">This customized console is configured to work with your Azure subscription.</span></span> <span data-ttu-id="65d18-284">El módulo de Azure se instala en el directorio *archivos de programa* y se importa automáticamente en cada uso de la consola de Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="65d18-284">The Azure module is installed in the *Program Files* directory and is automatically imported on every use of the Azure PowerShell console.</span></span>

    <span data-ttu-id="65d18-285">Si prefiere trabajar en otro programa host, como Windows PowerShell ISE, asegúrese de usar el cmdlet [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) para importar el módulo de Azure o usar un comando en el módulo de Azure para desencadenar la importación automática del módulo.</span><span class="sxs-lookup"><span data-stu-id="65d18-285">If you prefer to work in a different host program, such as Windows PowerShell ISE, be sure to use the [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) cmdlet to import the Azure module or use a command in the Azure module to trigger automatic importing of the module.</span></span>
2. <span data-ttu-id="65d18-286">Inicie Azure PowerShell con la opción **Ejecutar como administrador** .</span><span class="sxs-lookup"><span data-stu-id="65d18-286">Start Azure PowerShell with the **Run as administrator** option.</span></span>
3. <span data-ttu-id="65d18-287">Ejecute el cmdlet [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) para establecer la Directiva de ejecución Azure PowerShell en `RemoteSigned`.</span><span class="sxs-lookup"><span data-stu-id="65d18-287">Run the [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) cmdlet to set the Azure PowerShell execution policy to `RemoteSigned`.</span></span> <span data-ttu-id="65d18-288">Escriba **Y** (para sí) para completar el cambio de directiva.</span><span class="sxs-lookup"><span data-stu-id="65d18-288">Enter **Y** (for Yes) to complete the policy change.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample20.cmd)]

    <span data-ttu-id="65d18-289">Esta configuración permite ejecutar scripts locales que no están firmados digitalmente.</span><span class="sxs-lookup"><span data-stu-id="65d18-289">This setting enables you to run local scripts that aren't digitally signed.</span></span> <span data-ttu-id="65d18-290">(También puede establecer la Directiva de ejecución en `Unrestricted`, lo que eliminará la necesidad del paso de desbloqueo más adelante, pero esto no se recomienda por motivos de seguridad).</span><span class="sxs-lookup"><span data-stu-id="65d18-290">(You can also set the execution policy to `Unrestricted`, which would eliminate the need for the unblock step later, but this is not recommended for security reasons.)</span></span>
4. <span data-ttu-id="65d18-291">Ejecute el cmdlet `Add-AzureAccount` para configurar PowerShell con las credenciales de su cuenta.</span><span class="sxs-lookup"><span data-stu-id="65d18-291">Run the `Add-AzureAccount` cmdlet to set up PowerShell with credentials for your account.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample21.cmd)]

    <span data-ttu-id="65d18-292">Estas credenciales expiran después de un período de tiempo y tiene que volver a ejecutar el cmdlet `Add-AzureAccount`.</span><span class="sxs-lookup"><span data-stu-id="65d18-292">These credentials expire after a period of time and you have to re-run the `Add-AzureAccount` cmdlet.</span></span> <span data-ttu-id="65d18-293">A medida que se escribe este libro electrónico, el límite de tiempo antes de que expiren las credenciales es de 12 horas.</span><span class="sxs-lookup"><span data-stu-id="65d18-293">As this e-book is being written, the time limit before credentials expire is 12 hours.</span></span>
5. <span data-ttu-id="65d18-294">Si tiene varias suscripciones, use el cmdlet Select-AzureSubscription para especificar la suscripción en la que desea crear el entorno de prueba.</span><span class="sxs-lookup"><span data-stu-id="65d18-294">If you have multiple subscriptions, use the Select-AzureSubscription cmdlet to specify the subscription you want to create the test environment in.</span></span>
6. <span data-ttu-id="65d18-295">Importe un certificado de administración para la misma suscripción de Azure mediante los cmdlets `Get-AzurePublishSettingsFile` y `Import-AzurePublishSettingsFile`.</span><span class="sxs-lookup"><span data-stu-id="65d18-295">Import a management certificate for the same Azure subscription by using the `Get-AzurePublishSettingsFile` and `Import-AzurePublishSettingsFile` cmdlets.</span></span> <span data-ttu-id="65d18-296">El primero de estos cmdlets descarga un archivo de certificado y, en el segundo, se especifica la ubicación de ese archivo para poder importarlo.</span><span class="sxs-lookup"><span data-stu-id="65d18-296">The first of these cmdlets downloads a certificate file, and in the second one you specify the location of that file in order to import it.</span></span> > [!IMPORTANT]
   > <span data-ttu-id="65d18-297">Mantenga el archivo descargado en una ubicación segura o elimínelo cuando haya terminado, ya que contiene un certificado que se puede usar para administrar los servicios de Azure.</span><span class="sxs-lookup"><span data-stu-id="65d18-297">Keep the downloaded file in a safe location or delete it when you're done with it, because it contains a certificate that can be used to manage your Azure services.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample22.cmd)]

    <span data-ttu-id="65d18-298">El certificado se usa para una llamada de API de REST que detecta la dirección IP del equipo de desarrollo con el fin de establecer una regla de firewall en el servidor de SQL Database.</span><span class="sxs-lookup"><span data-stu-id="65d18-298">The certificate is used for a REST API call that detects the development machine's IP address in order to set a firewall rule on the SQL Database server.</span></span>
7. <span data-ttu-id="65d18-299">Ejecute el cmdlet [set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) (los alias se `cd`, `chdir`y `sl`) para desplazarse al directorio que contiene los scripts.</span><span class="sxs-lookup"><span data-stu-id="65d18-299">Run the [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) cmdlet (aliases are `cd`, `chdir`, and `sl`) to navigate to the directory that contains the scripts.</span></span> <span data-ttu-id="65d18-300">(Se encuentran en la carpeta *Automation* de la carpeta Fix it Solution). Coloque la ruta de acceso entre comillas si alguno de los nombres de directorio contiene espacios.</span><span class="sxs-lookup"><span data-stu-id="65d18-300">(They're located in the *Automation* folder in the Fix It solution folder.) Put the path in quotes if any of the directory names contain spaces.</span></span> <span data-ttu-id="65d18-301">Por ejemplo, para ir al directorio `c:\Sample Apps\FixIt\Automation`, puede escribir el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="65d18-301">For example, to navigate to the `c:\Sample Apps\FixIt\Automation` directory you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample23.cmd)]
8. <span data-ttu-id="65d18-302">Para permitir que Windows PowerShell ejecute estos scripts, use el cmdlet [unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) .</span><span class="sxs-lookup"><span data-stu-id="65d18-302">To allow Windows PowerShell to run these scripts, use the [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) cmdlet.</span></span> <span data-ttu-id="65d18-303">(Los scripts están bloqueados porque se descargaron de Internet).</span><span class="sxs-lookup"><span data-stu-id="65d18-303">(The scripts are blocked because they were downloaded from the Internet.)</span></span>

    > [!WARNING]
    > <span data-ttu-id="65d18-304">Seguridad: antes de ejecutar `Unblock-File` en cualquier script o archivo ejecutable, abra el archivo en el Bloc de notas, examine los comandos y compruebe que no contienen código malintencionado.</span><span class="sxs-lookup"><span data-stu-id="65d18-304">Security - Before running `Unblock-File` on any script or executable file, open the file in Notepad, examine the commands, and verify that they do not contain any malicious code.</span></span>

    <span data-ttu-id="65d18-305">Por ejemplo, el siguiente comando ejecuta el cmdlet `Unblock-File` en todos los scripts del directorio actual.</span><span class="sxs-lookup"><span data-stu-id="65d18-305">For example, the following command runs the `Unblock-File` cmdlet on all scripts in the current directory.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample24.cmd)]
9. <span data-ttu-id="65d18-306">Para crear la aplicación web para la aplicación de corrección de base (sin procesamiento de colas), ejecute el script de creación del entorno.</span><span class="sxs-lookup"><span data-stu-id="65d18-306">To create the web app for the base (no queues processing) Fix It app, run the environment creation script.</span></span>

    <span data-ttu-id="65d18-307">El parámetro `Name` obligatorio especifica el nombre de la base de datos y también se utiliza para la cuenta de almacenamiento que crea el script.</span><span class="sxs-lookup"><span data-stu-id="65d18-307">The required `Name` parameter specifies the name of the database and is also used for the storage account that the script creates.</span></span> <span data-ttu-id="65d18-308">El nombre debe ser único globalmente dentro del dominio azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="65d18-308">The name must be globally unique within the azurewebsites.net domain.</span></span> <span data-ttu-id="65d18-309">Si especifica un nombre que no es único, como FixIt o test (o incluso como en el ejemplo, fixitdemo), el cmdlet `New-AzureWebsite` produce un error interno que informa de un conflicto.</span><span class="sxs-lookup"><span data-stu-id="65d18-309">If you specify a name that is not unique, like Fixit or Test (or even as in the example, fixitdemo), the `New-AzureWebsite` cmdlet fails with an Internal Error that reports a conflict.</span></span> <span data-ttu-id="65d18-310">El script convierte el nombre en minúsculas para cumplir los requisitos de nombre de las aplicaciones Web, las cuentas de almacenamiento y las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="65d18-310">The script converts the name to all lower-case to comply with name requirements for web apps, storage accounts, and databases.</span></span>

    <span data-ttu-id="65d18-311">El parámetro `SqlDatabasePassword` necesario especifica la contraseña de la cuenta de administrador que se creará para SQL Database.</span><span class="sxs-lookup"><span data-stu-id="65d18-311">The required `SqlDatabasePassword` parameter specifies the password for the admin account that will be created for SQL Database.</span></span> <span data-ttu-id="65d18-312">No incluya caracteres XML especiales en la contraseña (&amp; &lt; &gt;;).</span><span class="sxs-lookup"><span data-stu-id="65d18-312">Don't include special XML characters in the password (&amp; &lt; &gt; ;).</span></span> <span data-ttu-id="65d18-313">Se trata de una limitación de la forma en que se escribieron los scripts, no una limitación de Azure.</span><span class="sxs-lookup"><span data-stu-id="65d18-313">This is a limitation of the way the scripts were written, not a limitation of Azure.</span></span>

    <span data-ttu-id="65d18-314">Por ejemplo, si desea crear una aplicación web denominada "fixitdemo" y usar una contraseña de administrador de SQL Server de "Passw0rd1", puede escribir el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="65d18-314">For example, if you want to create a web app named "fixitdemo" and use a SQL Server administrator password of "Passw0rd1", you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample25.cmd)]

    <span data-ttu-id="65d18-315">El nombre debe ser único en el dominio azurewebsites.net y la contraseña debe cumplir los requisitos de SQL Database para la complejidad de la contraseña.</span><span class="sxs-lookup"><span data-stu-id="65d18-315">The name must be unique in the azurewebsites.net domain, and the password must meet SQL Database requirements for password complexity.</span></span> <span data-ttu-id="65d18-316">(El Passw0rd1 de ejemplo cumple los requisitos).</span><span class="sxs-lookup"><span data-stu-id="65d18-316">(The example Passw0rd1 does meet the requirements.)</span></span>

    <span data-ttu-id="65d18-317">Tenga en cuenta que el comando comienza por ".\".</span><span class="sxs-lookup"><span data-stu-id="65d18-317">Note that the command begins with ".\".</span></span> <span data-ttu-id="65d18-318">Para ayudar a evitar la ejecución malintencionada de scripts, Windows PowerShell requiere que proporcione la ruta de acceso completa al archivo de script al ejecutar un script.</span><span class="sxs-lookup"><span data-stu-id="65d18-318">To help prevent malicious execution of scripts, Windows PowerShell requires that you provide the fully qualified path to the script file when you run a script.</span></span> <span data-ttu-id="65d18-319">Puede usar un punto para indicar el directorio actual (".\") o proporcione la ruta de acceso completa, como:</span><span class="sxs-lookup"><span data-stu-id="65d18-319">You can use a dot to indicate the current directory (".\") or provide the fully qualified path, such as:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample26.cmd)]

    <span data-ttu-id="65d18-320">Para obtener más información sobre el script, use el cmdlet `Get-Help`.</span><span class="sxs-lookup"><span data-stu-id="65d18-320">For more information about the script, use the `Get-Help` cmdlet.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample27.cmd)]

    <span data-ttu-id="65d18-321">Puede usar los parámetros `Detailed`, `Full`, `Parameters`y `Examples` del cmdlet Get-Help para filtrar la ayuda que se devuelve.</span><span class="sxs-lookup"><span data-stu-id="65d18-321">You can use the `Detailed`, `Full`, `Parameters`, and `Examples` parameters of the Get-Help cmdlet to filter the help that is returned.</span></span>

    <span data-ttu-id="65d18-322">Si el script produce un error o genera errores, como "New-AzureWebsite: Call Set-AzureSubscription y Select-AzureSubscription First", es posible que no haya completado la configuración de Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="65d18-322">If the script fails or generates errors, such as "New-AzureWebsite : Call Set-AzureSubscription and Select-AzureSubscription first," you might not have completed the configuration of Azure PowerShell.</span></span>

    <span data-ttu-id="65d18-323">Una vez finalizado el script, puede usar Azure Portal de administración para ver los recursos que se crearon, tal como se muestra en el capítulo [automatizar todo](automate-everything.md) .</span><span class="sxs-lookup"><span data-stu-id="65d18-323">After the script finishes, you can use the Azure Management Portal to see the resources that were created, as shown in the [Automate Everything](automate-everything.md) chapter.</span></span>
10. <span data-ttu-id="65d18-324">Para implementar el proyecto FixIt en el nuevo entorno de Azure, use el script *AzureWebsite. PS1* .</span><span class="sxs-lookup"><span data-stu-id="65d18-324">To deploy the FixIt project to the new Azure environment, use the *AzureWebsite.ps1* script.</span></span> <span data-ttu-id="65d18-325">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="65d18-325">For example:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample28.cmd)]

    <span data-ttu-id="65d18-326">Una vez realizada la implementación, el explorador se abre con corregirlo en ejecución en Azure.</span><span class="sxs-lookup"><span data-stu-id="65d18-326">When deployment is done, the browser opens with Fix It running in Azure.</span></span>

<a id="troubleshooting"></a>
## <a name="troubleshooting-the-windows-powershell-scripts"></a><span data-ttu-id="65d18-327">Solución de problemas de los scripts de Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="65d18-327">Troubleshooting the Windows PowerShell scripts</span></span>

<span data-ttu-id="65d18-328">Los errores más comunes que se producen al ejecutar estos scripts están relacionados con los permisos.</span><span class="sxs-lookup"><span data-stu-id="65d18-328">The most common errors encountered when running these scripts are related to permissions.</span></span> <span data-ttu-id="65d18-329">Asegúrese de que `Add-AzureAccount` y `Import-AzurePublishSettingsFile` fueron correctos y que los usó para la misma suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="65d18-329">Make sure that `Add-AzureAccount` and `Import-AzurePublishSettingsFile` were successful and that you used them for the same Azure subscription.</span></span> <span data-ttu-id="65d18-330">Incluso si `Add-AzureAccount` fue correcta, puede que tenga que ejecutarlo de nuevo.</span><span class="sxs-lookup"><span data-stu-id="65d18-330">Even if `Add-AzureAccount` was successful you might have to run it again.</span></span> <span data-ttu-id="65d18-331">Los permisos agregados por `Add-AzureAccount` expiran en 12 horas.</span><span class="sxs-lookup"><span data-stu-id="65d18-331">The permissions added by `Add-AzureAccount` expire in 12 hours.</span></span>

### <a name="object-reference-not-set-to-an-instance-of-an-object"></a><span data-ttu-id="65d18-332">Referencia a objeto no establecida como instancia de un objeto.</span><span class="sxs-lookup"><span data-stu-id="65d18-332">Object reference not set to an instance of an object.</span></span>

<span data-ttu-id="65d18-333">Si el script devuelve errores, como "referencia a objeto no establecida en una instancia de un objeto", lo que significa que Windows PowerShell no puede encontrar un objeto para procesar (se trata de una excepción de referencia nula), ejecute el cmdlet `Add-AzureAccount` y vuelva a intentar el script.</span><span class="sxs-lookup"><span data-stu-id="65d18-333">If the script returns errors, such as "Object reference not set to an instance of an object," which means that Windows PowerShell can't find an object to process (this is a null reference exception), run the `Add-AzureAccount` cmdlet and try the script again.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample29.cmd)]

### <a name="internalerror-the-server-encountered-an-internal-error"></a><span data-ttu-id="65d18-334">InternalError: el servidor encontró un error interno.</span><span class="sxs-lookup"><span data-stu-id="65d18-334">InternalError: The server encountered an internal error.</span></span>

<span data-ttu-id="65d18-335">El cmdlet `New-AzureWebsite` devuelve un error interno cuando el nombre no es único en el dominio azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="65d18-335">The `New-AzureWebsite` cmdlet returns an internal error when the name is not unique in the azurewebsites.net domain.</span></span> <span data-ttu-id="65d18-336">Para resolver el error, use un valor diferente para el nombre, que se encuentra en el parámetro name de *New-AzureWebsiteEnv. PS1*.</span><span class="sxs-lookup"><span data-stu-id="65d18-336">To resolve the error, use a different value for the name, which is in the Name parameter of *New-AzureWebsiteEnv.ps1*.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample30.cmd)]

### <a name="restarting-the-script"></a><span data-ttu-id="65d18-337">Reinicio del script</span><span class="sxs-lookup"><span data-stu-id="65d18-337">Restarting the script</span></span>

<span data-ttu-id="65d18-338">Si necesita reiniciar el script *New-AzureWebsiteEnv. PS1* porque se produjo un error antes de imprimir el mensaje "el script se ha completado", es posible que quiera eliminar los recursos que creó el script antes de detenerse.</span><span class="sxs-lookup"><span data-stu-id="65d18-338">If you need to restart the *New-AzureWebsiteEnv.ps1* script because it failed before it printed the "Script is complete" message, you might want to delete resources that the script created before it stopped.</span></span> <span data-ttu-id="65d18-339">Por ejemplo, si el script ya creó la aplicación web ContosoFixItDemo y vuelve a ejecutar el script con el mismo nombre, se producirá un error en el script porque el nombre está en uso.</span><span class="sxs-lookup"><span data-stu-id="65d18-339">For example, if the script already created the ContosoFixItDemo web app and you run the script again with the same name, the script will fail because the name is in use.</span></span>

<span data-ttu-id="65d18-340">Para determinar qué recursos creó el script antes de detenerse, use los cmdlets siguientes:</span><span class="sxs-lookup"><span data-stu-id="65d18-340">To determine which resources the script created before it stopped, use the following cmdlets:</span></span>

- `Get-AzureWebsite`
- `Get-AzureSqlDatabaseServer`
- <span data-ttu-id="65d18-341">`Get-AzureSqlDatabase`: para ejecutar este cmdlet, Canalice el nombre del servidor de base de datos a `Get-AzureSqlDatabase`: `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span><span class="sxs-lookup"><span data-stu-id="65d18-341">`Get-AzureSqlDatabase`: To run this cmdlet, pipe the database server name to `Get-AzureSqlDatabase`:   `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span></span>

<span data-ttu-id="65d18-342">Para eliminar estos recursos, use los comandos siguientes.</span><span class="sxs-lookup"><span data-stu-id="65d18-342">To delete these resources, use the following commands.</span></span> <span data-ttu-id="65d18-343">Tenga en cuenta que si elimina el servidor de base de datos, eliminará automáticamente las bases de datos asociadas con el servidor.</span><span class="sxs-lookup"><span data-stu-id="65d18-343">Note that if you delete the database server, you automatically delete the databases associated with the server.</span></span>

- `Get-AzureWebsite -Name <WebsiteName> | Remove-AzureWebsite`
- `Get-AzureSqlDatabase -Name <DatabaseName> -ServerName <DatabaseServerName> | Remove-SqlAzureDatabase`
- `Get-AzureSqlDatabaseServer | Remove-AzureSqlDatabaseServer`

<a id="deployqueues"></a>
## <a name="how-to-deploy-the-app-with-queue-processing-to-azure-app-service-web-apps-and-an-azure-cloud-service"></a><span data-ttu-id="65d18-344">Implementación de la aplicación con el procesamiento de colas para Azure App Service Web Apps y un servicio en la nube de Azure</span><span class="sxs-lookup"><span data-stu-id="65d18-344">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>

<span data-ttu-id="65d18-345">Para habilitar las colas, realice el siguiente cambio en el archivo MyFixIt\Web.config.</span><span class="sxs-lookup"><span data-stu-id="65d18-345">To enable queues, make the following change in the MyFixIt\Web.config file.</span></span> <span data-ttu-id="65d18-346">En `appSettings`, cambie el valor de `UseQueues` a "true":</span><span class="sxs-lookup"><span data-stu-id="65d18-346">Under `appSettings`, change the value of `UseQueues` to "true":</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample31.xml)]

<span data-ttu-id="65d18-347">A continuación, implemente la aplicación MVC en una aplicación web en Azure App Service, como se describió [anteriormente](#deploybase).</span><span class="sxs-lookup"><span data-stu-id="65d18-347">Then deploy the MVC application to an web app in Azure App Service, as described [earlier](#deploybase).</span></span>

<span data-ttu-id="65d18-348">A continuación, cree un nuevo servicio en la nube de Azure.</span><span class="sxs-lookup"><span data-stu-id="65d18-348">Next, create a new Azure cloud service.</span></span> <span data-ttu-id="65d18-349">Los scripts que se incluyen con la aplicación Fix it no crean ni implementan el servicio en la nube, por lo que debe usar Azure Portal para ello.</span><span class="sxs-lookup"><span data-stu-id="65d18-349">The scripts included with the Fix It app do not create or deploy the cloud service, so you must use Azure portal for this.</span></span> <span data-ttu-id="65d18-350">En el portal, haga clic en **nuevo** -- **Compute** : **servicio en la nube** -- **creación rápida**y, a continuación, escriba una dirección URL y una ubicación de centro de datos.</span><span class="sxs-lookup"><span data-stu-id="65d18-350">In the portal, click **New** -- **Compute** – **Cloud Service** -- **Quick Create**, and then enter a URL and a data center location.</span></span> <span data-ttu-id="65d18-351">Use el mismo centro de datos en el que implementó la aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="65d18-351">Use the same data center where you deployed the web app.</span></span>

![](the-fix-it-sample-application/_static/image1.png)

<span data-ttu-id="65d18-352">Para poder implementar el servicio en la nube, debe actualizar algunos de los archivos de configuración.</span><span class="sxs-lookup"><span data-stu-id="65d18-352">Before you can deploy the cloud service, you need to update some of the configuration files.</span></span>

<span data-ttu-id="65d18-353">En MyFixIt. WorkerRole\app.config, en `connectionStrings`, reemplace el valor de la cadena de conexión `appdb` por la cadena de conexión real para el SQL Database.</span><span class="sxs-lookup"><span data-stu-id="65d18-353">In MyFixIt.WorkerRole\app.config, under `connectionStrings`, replace the value of the `appdb` connection string with the actual connection string for the SQL Database.</span></span> <span data-ttu-id="65d18-354">Puede obtener la cadena de conexión desde el portal.</span><span class="sxs-lookup"><span data-stu-id="65d18-354">You can get the connection string from the portal.</span></span> <span data-ttu-id="65d18-355">En el portal, haga clic en **bases de datos SQL** - **appdb** - **Ver SQL Database cadenas de conexión para ADO .net, ODBC, PHP y JDBC**.</span><span class="sxs-lookup"><span data-stu-id="65d18-355">In the portal, click **SQL Databases** - **appdb** - **View SQL Database connection strings for ADO .Net, ODBC, PHP, and JDBC**.</span></span> <span data-ttu-id="65d18-356">Copie la cadena de conexión ADO.NET y pegue el valor en el archivo app. config.</span><span class="sxs-lookup"><span data-stu-id="65d18-356">Copy the ADO.NET connection string and paste the value into the app.config file.</span></span> <span data-ttu-id="65d18-357">Reemplace "{Your\_password\_here}" por la contraseña de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="65d18-357">Replace "{your\_password\_here}" with your database password.</span></span> <span data-ttu-id="65d18-358">(Suponiendo que usó los scripts para implementar la aplicación MVC, especificó la contraseña de la base de datos en el parámetro del script `SqlDatabasePassword`).</span><span class="sxs-lookup"><span data-stu-id="65d18-358">(Assuming you used the scripts to deploy the MVC app, you specified the database password in the `SqlDatabasePassword` script parameter.)</span></span>

<span data-ttu-id="65d18-359">El resultado debería ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="65d18-359">The result should look like the following:</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample32.xml)]

<span data-ttu-id="65d18-360">En el mismo archivo MyFixIt. WorkerRole\app.config, en `appSettings`, reemplace los dos valores de marcador de posición para la cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="65d18-360">In the same MyFixIt.WorkerRole\app.config file, under `appSettings`, replace the two placeholder values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample33.xml?highlight=2-3)]

<span data-ttu-id="65d18-361">Puede obtener la clave de acceso desde el portal.</span><span class="sxs-lookup"><span data-stu-id="65d18-361">You can get the access key from the portal.</span></span> <span data-ttu-id="65d18-362">Consulte [Cómo administrar cuentas de almacenamiento](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span><span class="sxs-lookup"><span data-stu-id="65d18-362">See [How To Manage Storage Accounts](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span></span>

<span data-ttu-id="65d18-363">En MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, reemplace los mismos dos valores de marcadores de posición para la cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="65d18-363">In MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, replace the same two placeholders values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample34.xml?highlight=3)]

<span data-ttu-id="65d18-364">Ahora está listo para implementar el servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="65d18-364">Now you are ready to deploy the cloud service.</span></span> <span data-ttu-id="65d18-365">En el explorador de soluciones, haga clic con el botón derecho en el proyecto MyFixItCloudService y seleccione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="65d18-365">In Solution Explore, right-click the MyFixItCloudService project and select **Publish**.</span></span> <span data-ttu-id="65d18-366">Para obtener más información, consulte "[implementación de la aplicación en Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", que se encuentra en la parte 2 de [este tutorial](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span><span class="sxs-lookup"><span data-stu-id="65d18-366">For more information, see "[Deploy the Application to Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", which is in part 2 of [this tutorial](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="65d18-367">Anterior</span><span class="sxs-lookup"><span data-stu-id="65d18-367">Previous</span></span>](more-patterns-and-guidance.md)
