---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
title: Almacenar datos en caché en la arquitectura (VB) | Microsoft Docs
author: rick-anderson
description: En el tutorial anterior, aprendió a aplicar el almacenamiento en caché en el nivel de presentación. En este tutorial, aprenderá cómo sacar partido de nuestro architectu con capas...
ms.author: riande
ms.date: 05/30/2007
ms.assetid: 5e189dd7-f4f9-4f28-9b3a-6cb7d392e9c7
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
msc.type: authoredcontent
ms.openlocfilehash: dc991a205fa7e61f604bc0f26e9b24b3faefd3d3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78443593"
---
# <a name="caching-data-in-the-architecture-vb"></a><span data-ttu-id="62af2-104">Almacenar datos en caché en la arquitectura (VB)</span><span class="sxs-lookup"><span data-stu-id="62af2-104">Caching Data in the Architecture (VB)</span></span>

<span data-ttu-id="62af2-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="62af2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="62af2-106">[Descarga](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) de la aplicación de ejemplo o [descarga de PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="62af2-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) or [Download PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span></span>

> <span data-ttu-id="62af2-107">En el tutorial anterior, aprendió a aplicar el almacenamiento en caché en el nivel de presentación.</span><span class="sxs-lookup"><span data-stu-id="62af2-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="62af2-108">En este tutorial, aprenderá a aprovechar nuestra arquitectura en capas para almacenar en caché los datos en el nivel de lógica de negocios.</span><span class="sxs-lookup"><span data-stu-id="62af2-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="62af2-109">Para ello, se extiende la arquitectura para incluir una capa de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-109">We do this by extending the architecture to include a Caching Layer.</span></span>

## <a name="introduction"></a><span data-ttu-id="62af2-110">Introducción</span><span class="sxs-lookup"><span data-stu-id="62af2-110">Introduction</span></span>

<span data-ttu-id="62af2-111">Como vimos en el tutorial anterior, el almacenamiento en caché de los datos de ObjectDataSource es tan sencillo como establecer un par de propiedades.</span><span class="sxs-lookup"><span data-stu-id="62af2-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="62af2-112">Desafortunadamente, ObjectDataSource aplica el almacenamiento en caché en el nivel de presentación, que acopla estrechamente las directivas de almacenamiento en caché con la página de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="62af2-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="62af2-113">Uno de los motivos para crear una arquitectura en capas es permitir que tales acoplamientos se interrumpan.</span><span class="sxs-lookup"><span data-stu-id="62af2-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="62af2-114">La capa de lógica de negocios, por ejemplo, desacopla la lógica de negocios de las páginas de ASP.NET, mientras que la capa de acceso a datos desacopla los detalles del acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="62af2-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="62af2-115">En parte, se prefiere este desacoplamiento de la lógica de negocios y los detalles del acceso a los datos, ya que hace que el sistema sea más legible, más fácil de mantener y más flexible para cambiar.</span><span class="sxs-lookup"><span data-stu-id="62af2-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="62af2-116">También permite el conocimiento del dominio y la división del trabajo que un desarrollador que trabaja en el nivel de presentación no necesita estar familiarizado con los detalles de la base de datos para poder realizar su trabajo.</span><span class="sxs-lookup"><span data-stu-id="62af2-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="62af2-117">Desacoplar la Directiva de almacenamiento en caché del nivel de presentación ofrece ventajas similares.</span><span class="sxs-lookup"><span data-stu-id="62af2-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="62af2-118">En este tutorial aumentaremos nuestra arquitectura para incluir una *capa de almacenamiento en caché* (o cl para abreviar) que emplea nuestra directiva de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="62af2-119">La capa de almacenamiento en caché incluirá una `ProductsCL` clase que proporciona acceso a la información del producto con métodos como `GetProducts()`, `GetProductsByCategoryID(categoryID)`, etc., que, cuando se invoca, intentará recuperar primero los datos de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="62af2-120">Si la memoria caché está vacía, estos métodos invocarán el método `ProductsBLL` adecuado en la capa BLL, que a su vez obtendrá los datos de la capa DAL.</span><span class="sxs-lookup"><span data-stu-id="62af2-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="62af2-121">Los métodos `ProductsCL` almacenan en caché los datos recuperados de la capa BLL antes de devolverlos.</span><span class="sxs-lookup"><span data-stu-id="62af2-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="62af2-122">Como se muestra en la figura 1, el CL se encuentra entre las capas de presentación y de lógica de negocios.</span><span class="sxs-lookup"><span data-stu-id="62af2-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>

![La capa de almacenamiento en caché (CL) es otra capa de nuestra arquitectura](caching-data-in-the-architecture-vb/_static/image1.png)

<span data-ttu-id="62af2-124">**Figura 1**: la capa de almacenamiento en caché (cl) es otra capa de nuestra arquitectura</span><span class="sxs-lookup"><span data-stu-id="62af2-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>

## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="62af2-125">Paso 1: creación de las clases de nivel de almacenamiento en caché</span><span class="sxs-lookup"><span data-stu-id="62af2-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="62af2-126">En este tutorial, se creará un CL muy sencillo con una sola clase `ProductsCL` que tiene solo unos cuantos métodos.</span><span class="sxs-lookup"><span data-stu-id="62af2-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="62af2-127">La creación de una capa de almacenamiento en caché completa para toda la aplicación requeriría la creación de `CategoriesCL`, `EmployeesCL`y `SuppliersCL` clases, y proporcionar un método en estas clases de nivel de almacenamiento en caché para cada método de acceso a datos o modificación de la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="62af2-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="62af2-128">Al igual que con BLL y DAL, la capa de almacenamiento en caché debería implementarse idealmente como un proyecto de biblioteca de clases independiente. sin embargo, se implementará como una clase en la carpeta `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="62af2-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="62af2-129">Para separar más claramente las clases de CL de las clases DAL y BLL, cree una nueva subcarpeta en la carpeta `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="62af2-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="62af2-130">Haga clic con el botón derecho en la carpeta `App_Code` del Explorador de soluciones, elija nueva carpeta y asigne a la nueva carpeta el nombre `CL`.</span><span class="sxs-lookup"><span data-stu-id="62af2-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="62af2-131">Después de crear esta carpeta, agregue una nueva clase denominada `ProductsCL.vb`.</span><span class="sxs-lookup"><span data-stu-id="62af2-131">After creating this folder, add to it a new class named `ProductsCL.vb`.</span></span>

![Agregue una nueva carpeta denominada CL y una clase denominada ProductsCL. VB.](caching-data-in-the-architecture-vb/_static/image2.png)

<span data-ttu-id="62af2-133">**Figura 2**: agregue una nueva carpeta denominada `CL` y una clase denominada `ProductsCL.vb`</span><span class="sxs-lookup"><span data-stu-id="62af2-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.vb`</span></span>

<span data-ttu-id="62af2-134">La clase `ProductsCL` debe incluir el mismo conjunto de métodos de acceso a datos y de modificación que se encuentra en su clase de capa de lógica de negocios correspondiente (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="62af2-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="62af2-135">En lugar de crear todos estos métodos, vamos a crear un par aquí para hacerse una idea de los patrones usados por CL.</span><span class="sxs-lookup"><span data-stu-id="62af2-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="62af2-136">En concreto, vamos a agregar los métodos `GetProducts()` y `GetProductsByCategoryID(categoryID)` en el paso 3 y una sobrecarga `UpdateProduct` en el paso 4.</span><span class="sxs-lookup"><span data-stu-id="62af2-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="62af2-137">Puede Agregar los demás métodos de `ProductsCL` y `CategoriesCL`, `EmployeesCL`y las clases de `SuppliersCL` en el momento de su ocio.</span><span class="sxs-lookup"><span data-stu-id="62af2-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="62af2-138">Paso 2: lectura y escritura en la memoria caché de datos</span><span class="sxs-lookup"><span data-stu-id="62af2-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="62af2-139">La característica de almacenamiento en caché de ObjectDataSource explorada en el tutorial anterior usa internamente la caché de datos ASP.NET para almacenar los datos recuperados de la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="62af2-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="62af2-140">También se puede tener acceso a la memoria caché de datos mediante programación desde las páginas de ASP.NET de código subyacente o desde las clases de la arquitectura de la aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="62af2-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="62af2-141">Para leer y escribir en la memoria caché de datos desde una clase de código subyacente de la página ASP.NET, use el siguiente patrón:</span><span class="sxs-lookup"><span data-stu-id="62af2-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample1.vb)]

<span data-ttu-id="62af2-142">El método [`Cache` Class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert`](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) tiene varias sobrecargas.</span><span class="sxs-lookup"><span data-stu-id="62af2-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="62af2-143">`Cache("key") = value` y `Cache.Insert(key, value)` son sinónimos y ambos agregan un elemento a la memoria caché utilizando la clave especificada sin una expiración definida.</span><span class="sxs-lookup"><span data-stu-id="62af2-143">`Cache("key") = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="62af2-144">Normalmente, queremos especificar una expiración al agregar un elemento a la memoria caché, ya sea como una dependencia, una expiración basada en el tiempo o ambos.</span><span class="sxs-lookup"><span data-stu-id="62af2-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="62af2-145">Use una de las otras sobrecargas del método `Insert` para proporcionar información de expiración basada en la dependencia o en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="62af2-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="62af2-146">Los métodos de la capa de almacenamiento en caché deben comprobar primero si los datos solicitados están en la memoria caché y, en caso afirmativo, devolverlos desde allí.</span><span class="sxs-lookup"><span data-stu-id="62af2-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="62af2-147">Si los datos solicitados no están en la memoria caché, es necesario invocar el método BLL adecuado.</span><span class="sxs-lookup"><span data-stu-id="62af2-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="62af2-148">Su valor devuelto debe almacenarse en caché y devolverse, como se muestra en el siguiente diagrama de secuencia.</span><span class="sxs-lookup"><span data-stu-id="62af2-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>

![Los métodos de nivel de almacenamiento en caché devuelven datos de la memoria caché si están disponibles](caching-data-in-the-architecture-vb/_static/image3.png)

<span data-ttu-id="62af2-150">**Figura 3**: los métodos de la capa de almacenamiento en caché devuelven datos de la memoria caché si están disponibles</span><span class="sxs-lookup"><span data-stu-id="62af2-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>

<span data-ttu-id="62af2-151">La secuencia que se muestra en la figura 3 se realiza en las clases de CL con el siguiente patrón:</span><span class="sxs-lookup"><span data-stu-id="62af2-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample2.vb)]

<span data-ttu-id="62af2-152">Aquí, *tipo* es el tipo de datos que se almacenan en la memoria caché `Northwind.ProductsDataTable`, por ejemplo, mientras que la *clave* es la clave que identifica de forma única el elemento de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="62af2-153">Si el elemento con la *clave* especificada no está en la memoria caché, se `Nothing`rá la *instancia* y los datos se recuperarán del método BLL adecuado y se agregarán a la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-153">If the item with the specified *key* is not in the cache, then *instance* will be `Nothing` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="62af2-154">En el momento en que se alcanza `Return instance`, la *instancia* contiene una referencia a los datos, ya sea desde la memoria caché o extraída de la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="62af2-154">By the time `Return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="62af2-155">Asegúrese de usar el patrón anterior al obtener acceso a los datos de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="62af2-156">El siguiente patrón, que, a primera vista, parece equivalente, contiene una diferencia sutil que presenta una condición de carrera.</span><span class="sxs-lookup"><span data-stu-id="62af2-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="62af2-157">Las condiciones de carrera son difíciles de depurar porque se revelan a sí mismas esporádicamente y son difíciles de reproducir.</span><span class="sxs-lookup"><span data-stu-id="62af2-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample3.vb)]

<span data-ttu-id="62af2-158">La diferencia en este segundo, fragmento de código incorrecto es que, en lugar de almacenar una referencia al elemento almacenado en caché en una variable local, se tiene acceso a la memoria caché de datos directamente en la instrucción condicional *y* en el `Return`.</span><span class="sxs-lookup"><span data-stu-id="62af2-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `Return`.</span></span> <span data-ttu-id="62af2-159">Imagine que cuando se alcanza este código, `Cache("key")` no se `Nothing`, pero antes de que se alcance la instrucción `Return`, la *clave* del sistema expulsa de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-159">Imagine that when this code is reached, `Cache("key")` is not `Nothing`, but before the `Return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="62af2-160">En este caso excepcional, el código devolverá `Nothing` en lugar de un objeto del tipo esperado.</span><span class="sxs-lookup"><span data-stu-id="62af2-160">In this rare case, the code will return `Nothing` rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="62af2-161">La caché de datos es segura para subprocesos, por lo que no es necesario sincronizar el acceso a los subprocesos para lecturas o escrituras simples.</span><span class="sxs-lookup"><span data-stu-id="62af2-161">The data cache is thread-safe, so you don't need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="62af2-162">Sin embargo, si necesita realizar varias operaciones en los datos de la memoria caché que deben ser atómicos, es responsable de implementar un bloqueo o algún otro mecanismo para garantizar la seguridad para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="62af2-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="62af2-163">Vea [sincronizar el acceso a la memoria caché de ASP.net](http://www.ddj.com/184406369) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="62af2-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>

<span data-ttu-id="62af2-164">Un elemento se puede desalojar mediante programación de la caché de datos mediante el [método`Remove`](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) como el siguiente:</span><span class="sxs-lookup"><span data-stu-id="62af2-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample4.vb)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="62af2-165">Paso 3: devolver información del producto de la clase`ProductsCL`</span><span class="sxs-lookup"><span data-stu-id="62af2-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="62af2-166">En este tutorial, se permite a s implementar dos métodos para devolver información del producto de la clase `ProductsCL`: `GetProducts()` y `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="62af2-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="62af2-167">Al igual que con la clase `ProductsBL` en el nivel de lógica de negocios, el método `GetProducts()` de CL devuelve información sobre todos los productos como un objeto `Northwind.ProductsDataTable`, mientras que `GetProductsByCategoryID(categoryID)` devuelve todos los productos de una categoría especificada.</span><span class="sxs-lookup"><span data-stu-id="62af2-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="62af2-168">En el código siguiente se muestra una parte de los métodos de la clase `ProductsCL`:</span><span class="sxs-lookup"><span data-stu-id="62af2-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample5.vb)]

<span data-ttu-id="62af2-169">En primer lugar, tenga en cuenta los atributos `DataObject` y `DataObjectMethodAttribute` aplicados a la clase y los métodos.</span><span class="sxs-lookup"><span data-stu-id="62af2-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="62af2-170">Estos atributos proporcionan información al asistente de ObjectDataSource s, que indica qué clases y métodos deben aparecer en los pasos del asistente.</span><span class="sxs-lookup"><span data-stu-id="62af2-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="62af2-171">Dado que se tendrá acceso a las clases y métodos de CL desde un ObjectDataSource en el nivel de presentación, agregué estos atributos para mejorar la experiencia en tiempo de diseño.</span><span class="sxs-lookup"><span data-stu-id="62af2-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="62af2-172">Consulte el tutorial [creación de una capa de lógica de negocios](../introduction/creating-a-business-logic-layer-vb.md) para obtener una descripción más detallada de estos atributos y sus efectos.</span><span class="sxs-lookup"><span data-stu-id="62af2-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="62af2-173">En los métodos `GetProducts()` y `GetProductsByCategoryID(categoryID)`, los datos devueltos del método `GetCacheItem(key)` se asignan a una variable local.</span><span class="sxs-lookup"><span data-stu-id="62af2-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="62af2-174">El método `GetCacheItem(key)`, que examinaremos en breve, devolverá un elemento determinado de la memoria caché en función de la *clave*especificada.</span><span class="sxs-lookup"><span data-stu-id="62af2-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="62af2-175">Si no se encuentran estos datos en la memoria caché, se recuperan del método de clase `ProductsBLL` correspondiente y, a continuación, se agregan a la memoria caché mediante el método `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="62af2-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="62af2-176">Los métodos `GetCacheItem(key)` y `AddCacheItem(key, value)` interfaz con la memoria caché de datos, los valores de lectura y escritura, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="62af2-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="62af2-177">El método `GetCacheItem(key)` es el más simple de los dos.</span><span class="sxs-lookup"><span data-stu-id="62af2-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="62af2-178">Simplemente devuelve el valor de la clase cache mediante la *clave*pasada:</span><span class="sxs-lookup"><span data-stu-id="62af2-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample6.vb)]

<span data-ttu-id="62af2-179">`GetCacheItem(key)` no usa el valor de *clave* proporcionado, sino que llama al método `GetCacheKey(key)`, que devuelve la *clave* antepuesto con ProductsCache-.</span><span class="sxs-lookup"><span data-stu-id="62af2-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="62af2-180">El método `AddCacheItem(key, value)` también utiliza el `MasterCacheKeyArray`, que contiene la cadena ProductsCache, como veremos en breve.</span><span class="sxs-lookup"><span data-stu-id="62af2-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="62af2-181">En una clase de código subyacente de la página ASP.NET, se puede tener acceso a la memoria caché de datos mediante la propiedad `Page` Class s [`Cache`](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)y permite una sintaxis como `Cache("key") = value`, como se describe en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="62af2-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache("key") = value`, as discussed in Step 2.</span></span> <span data-ttu-id="62af2-182">Desde una clase dentro de la arquitectura, se puede tener acceso a la memoria caché de datos utilizando `HttpRuntime.Cache` o `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="62af2-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="62af2-183">En la entrada de blog de [Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx) [httpRuntime. cache frente a HttpContext. Current. cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) se trata de una ligera ventaja de rendimiento al usar `HttpRuntime` en lugar de `HttpContext.Current`; por consiguiente, `ProductsCL` usa `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="62af2-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="62af2-184">Si la arquitectura se implementa mediante proyectos de biblioteca de clases, tendrá que agregar una referencia al ensamblado `System.Web` para poder usar las clases [`HttpRuntime`](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) y [`HttpContext`](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) .</span><span class="sxs-lookup"><span data-stu-id="62af2-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [`HttpRuntime`](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [`HttpContext`](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>

<span data-ttu-id="62af2-185">Si el elemento no se encuentra en la memoria caché, los métodos de la clase `ProductsCL`n obtienen los datos de la capa BLL y lo agregan a la memoria caché mediante el método `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="62af2-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="62af2-186">Para agregar *valor* a la memoria caché, podríamos usar el código siguiente, que usa una expiración de 60 segundos:</span><span class="sxs-lookup"><span data-stu-id="62af2-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample7.vb)]

<span data-ttu-id="62af2-187">`DateTime.Now.AddSeconds(CacheDuration)` especifica la expiración basada en tiempo 60 segundos en el futuro, mientras [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indica que no hay ninguna expiración variable.</span><span class="sxs-lookup"><span data-stu-id="62af2-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="62af2-188">Aunque esta `Insert` sobrecarga del método tiene parámetros de entrada para una expiración absoluta y variable, solo puede proporcionar uno de los dos.</span><span class="sxs-lookup"><span data-stu-id="62af2-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="62af2-189">Si intenta especificar tanto una hora absoluta como un intervalo de tiempo, el método `Insert` producirá una excepción `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="62af2-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="62af2-190">Actualmente, esta implementación del método `AddCacheItem(key, value)` tiene algunas deficiencias.</span><span class="sxs-lookup"><span data-stu-id="62af2-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="62af2-191">Solucionaremos estos problemas en el paso 4.</span><span class="sxs-lookup"><span data-stu-id="62af2-191">We'll address and overcome these issues in Step 4.</span></span>

## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="62af2-192">Paso 4: invalidar la memoria caché cuando se modifican los datos a través de la arquitectura</span><span class="sxs-lookup"><span data-stu-id="62af2-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="62af2-193">Junto con los métodos de recuperación de datos, la capa de almacenamiento en caché debe proporcionar los mismos métodos que el BLL para insertar, actualizar y eliminar datos.</span><span class="sxs-lookup"><span data-stu-id="62af2-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="62af2-194">Los métodos de modificación de datos de CL s no modifican los datos en caché, sino que llaman al método de modificación de datos correspondiente a BLL s y, a continuación, invalidan la caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="62af2-195">Como vimos en el tutorial anterior, este es el mismo comportamiento que ObjectDataSource aplica cuando se habilitan sus características de almacenamiento en caché y se invocan los métodos `Insert`, `Update`o `Delete`.</span><span class="sxs-lookup"><span data-stu-id="62af2-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="62af2-196">La siguiente sobrecarga de `UpdateProduct` muestra cómo implementar los métodos de modificación de datos en CL:</span><span class="sxs-lookup"><span data-stu-id="62af2-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample8.vb)]

<span data-ttu-id="62af2-197">Se invoca el método de capa de lógica de negocios de modificación de datos adecuado, pero antes de que se devuelva su respuesta, es necesario invalidar la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="62af2-198">Desafortunadamente, la invalidación de la memoria caché no es sencilla, ya que los métodos `ProductsCL` Class s `GetProducts()` y `GetProductsByCategoryID(categoryID)` cada uno agrega elementos a la memoria caché con claves diferentes y el método `GetProductsByCategoryID(categoryID)` agrega un elemento de caché diferente para cada *CategoryID*único.</span><span class="sxs-lookup"><span data-stu-id="62af2-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="62af2-199">Al invalidar la memoria caché, es necesario quitar *todos* los elementos que puede haber agregado la clase `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="62af2-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="62af2-200">Esto puede lograrse asociando una *dependencia de caché* con cada elemento agregado a la memoria caché en el método `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="62af2-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="62af2-201">En general, una dependencia de caché puede ser otro elemento de la memoria caché, un archivo del sistema de archivos o datos de una base de datos de Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="62af2-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="62af2-202">Cuando la dependencia cambia o se quita de la memoria caché, los elementos de la memoria caché a los que está asociado se desalojan automáticamente de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="62af2-203">En este tutorial, queremos crear un elemento adicional en la memoria caché que actúe como una dependencia de caché para todos los elementos agregados a través de la clase `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="62af2-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="62af2-204">De este modo, todos estos elementos se pueden quitar de la memoria caché simplemente quitando la dependencia de caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="62af2-205">Permita actualizar el método de `AddCacheItem(key, value)` para que cada elemento agregado a la memoria caché a través de este método esté asociado a una única dependencia de caché:</span><span class="sxs-lookup"><span data-stu-id="62af2-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample9.vb)]

<span data-ttu-id="62af2-206">`MasterCacheKeyArray` es una matriz de cadenas que contiene un solo valor, ProductsCache.</span><span class="sxs-lookup"><span data-stu-id="62af2-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="62af2-207">En primer lugar, se agrega un elemento de caché a la memoria caché y se le asigna la fecha y hora actuales.</span><span class="sxs-lookup"><span data-stu-id="62af2-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="62af2-208">Si el elemento de la memoria caché ya existe, se actualiza.</span><span class="sxs-lookup"><span data-stu-id="62af2-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="62af2-209">A continuación, se crea una dependencia de caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="62af2-210">La [`CacheDependency`](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) constructor de clase s tiene varias sobrecargas, pero la que se usa en este caso espera dos entradas de matriz `String`.</span><span class="sxs-lookup"><span data-stu-id="62af2-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `String` array inputs.</span></span> <span data-ttu-id="62af2-211">El primero especifica el conjunto de archivos que se usarán como dependencias.</span><span class="sxs-lookup"><span data-stu-id="62af2-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="62af2-212">Dado que no deseamos usar ninguna dependencia basada en archivos, se usa un valor de `Nothing` para el primer parámetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="62af2-212">Since we don t want to use any file-based dependencies, a value of `Nothing` is used for the first input parameter.</span></span> <span data-ttu-id="62af2-213">El segundo parámetro de entrada especifica el conjunto de claves de caché que se va a usar como dependencias.</span><span class="sxs-lookup"><span data-stu-id="62af2-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="62af2-214">Aquí se especifica nuestra dependencia única `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="62af2-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="62af2-215">A continuación, el `CacheDependency` se pasa al método `Insert`.</span><span class="sxs-lookup"><span data-stu-id="62af2-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="62af2-216">Con esta modificación en `AddCacheItem(key, value)`, la invalidación de la memoria caché es tan sencilla como quitar la dependencia.</span><span class="sxs-lookup"><span data-stu-id="62af2-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample10.vb)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="62af2-217">Paso 5: llamar a la capa de almacenamiento en caché desde el nivel de presentación</span><span class="sxs-lookup"><span data-stu-id="62af2-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="62af2-218">Las clases y los métodos de la capa de almacenamiento en caché se pueden usar para trabajar con datos mediante las técnicas que se examinan en estos tutoriales.</span><span class="sxs-lookup"><span data-stu-id="62af2-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="62af2-219">Para ilustrar el trabajo con datos almacenados en caché, guarde los cambios en la clase `ProductsCL` y, a continuación, abra la página `FromTheArchitecture.aspx` en la carpeta `Caching` y agregue un control GridView.</span><span class="sxs-lookup"><span data-stu-id="62af2-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="62af2-220">En la etiqueta inteligente de GridView s, cree un nuevo ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="62af2-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="62af2-221">En el primer paso del asistente, debería ver la clase `ProductsCL` como una de las opciones de la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="62af2-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>

<span data-ttu-id="62af2-222">[![la clase ProductsCL se incluye en la lista desplegable objeto comercial](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="62af2-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span></span>

<span data-ttu-id="62af2-223">**Figura 4**: la clase `ProductsCL` se incluye en la lista desplegable objeto comercial ([haga clic para ver la imagen de tamaño completo](caching-data-in-the-architecture-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="62af2-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image6.png))</span></span>

<span data-ttu-id="62af2-224">Después de seleccionar `ProductsCL`, haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="62af2-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="62af2-225">La lista desplegable de la pestaña seleccionar tiene dos elementos: `GetProducts()` y `GetProductsByCategoryID(categoryID)` y la pestaña actualizar tiene la única sobrecarga `UpdateProduct`.</span><span class="sxs-lookup"><span data-stu-id="62af2-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="62af2-226">Elija el método de `GetProducts()` en la pestaña seleccionar y el método `UpdateProducts` en la pestaña actualizar y haga clic en finalizar.</span><span class="sxs-lookup"><span data-stu-id="62af2-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>

<span data-ttu-id="62af2-227">[![los métodos de la clase ProductsCL se muestran en las listas desplegables](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="62af2-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span></span>

<span data-ttu-id="62af2-228">**Figura 5**: los métodos de la clase `ProductsCL` se enumeran en las listas desplegables ([haga clic para ver la imagen a tamaño completo](caching-data-in-the-architecture-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="62af2-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image9.png))</span></span>

<span data-ttu-id="62af2-229">Después de completar el asistente, Visual Studio establecerá la propiedad ObjectDataSource s `OldValuesParameterFormatString` en `original_{0}` y agregará los campos correspondientes a GridView.</span><span class="sxs-lookup"><span data-stu-id="62af2-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="62af2-230">Vuelva a cambiar la propiedad `OldValuesParameterFormatString` a su valor predeterminado, `{0}`y configure GridView para que admita la paginación, la ordenación y la edición.</span><span class="sxs-lookup"><span data-stu-id="62af2-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="62af2-231">Dado que la sobrecarga de `UploadProducts` utilizada por CL solo acepta el nombre y el precio del producto editado, limite GridView para que solo se puedan editar estos campos.</span><span class="sxs-lookup"><span data-stu-id="62af2-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="62af2-232">En el tutorial anterior, hemos definido un control GridView para incluir campos para los campos `ProductName`, `CategoryName`y `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="62af2-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="62af2-233">No dude en replicar este formato y estructura, en cuyo caso el marcado declarativo de GridView y ObjectDataSource s debería tener un aspecto similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="62af2-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](caching-data-in-the-architecture-vb/samples/sample11.aspx)]

<span data-ttu-id="62af2-234">En este momento, tenemos una página que utiliza la capa de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="62af2-235">Para ver la memoria caché en acción, establezca puntos de interrupción en los métodos `GetProducts()` y `UpdateProduct` de la clase `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="62af2-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="62af2-236">Visite la página en un explorador y recorra el código al ordenar y paginar para ver los datos extraídos de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="62af2-237">A continuación, actualice un registro y tenga en cuenta que la memoria caché se invalida y, por consiguiente, se recupera de la capa BLL cuando los datos se reenlazan a GridView.</span><span class="sxs-lookup"><span data-stu-id="62af2-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="62af2-238">La capa de almacenamiento en caché proporcionada en la descarga que acompaña a este artículo no está completa.</span><span class="sxs-lookup"><span data-stu-id="62af2-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="62af2-239">Solo contiene una clase, `ProductsCL`, que solo Sports unos cuantos métodos.</span><span class="sxs-lookup"><span data-stu-id="62af2-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="62af2-240">Además, en una sola página de ASP.NET se usa el CL (`~/Caching/FromTheArchitecture.aspx`) que todos los demás todavía hacen referencia directamente a la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="62af2-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="62af2-241">Si planea usar un CL en la aplicación, todas las llamadas desde el nivel de presentación deben ir a CL, lo que requeriría que las clases y los métodos de CL se encontraran en las clases y los métodos de la capa BLL utilizada actualmente por el nivel de presentación.</span><span class="sxs-lookup"><span data-stu-id="62af2-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>

## <a name="summary"></a><span data-ttu-id="62af2-242">Resumen</span><span class="sxs-lookup"><span data-stu-id="62af2-242">Summary</span></span>

<span data-ttu-id="62af2-243">Aunque el almacenamiento en caché se puede aplicar en el nivel de presentación con los controles ASP.NET 2,0 s SqlDataSource y ObjectDataSource, idealmente, las responsabilidades del almacenamiento en caché se delegarían a una capa independiente en la arquitectura.</span><span class="sxs-lookup"><span data-stu-id="62af2-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="62af2-244">En este tutorial, creamos una capa de almacenamiento en caché que reside entre el nivel de presentación y la capa de lógica de negocios.</span><span class="sxs-lookup"><span data-stu-id="62af2-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="62af2-245">La capa de almacenamiento en caché debe proporcionar el mismo conjunto de clases y métodos que existen en la capa BLL y a los que se llama desde el nivel de presentación.</span><span class="sxs-lookup"><span data-stu-id="62af2-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="62af2-246">Los ejemplos de nivel de almacenamiento en caché que se exploran en este y en los tutoriales anteriores exhibeban la *carga reactiva*.</span><span class="sxs-lookup"><span data-stu-id="62af2-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="62af2-247">Con la carga reactiva, los datos se cargan en la memoria caché solo cuando se realiza una solicitud de datos y faltan datos en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="62af2-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="62af2-248">Los datos también se pueden *cargar proactivamente* en la memoria caché, una técnica que carga los datos en la memoria caché antes de que se necesiten realmente.</span><span class="sxs-lookup"><span data-stu-id="62af2-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="62af2-249">En el siguiente tutorial, veremos un ejemplo de carga proactiva cuando veremos cómo almacenar valores estáticos en la memoria caché al iniciarse la aplicación.</span><span class="sxs-lookup"><span data-stu-id="62af2-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="62af2-250">¡ Feliz programación!</span><span class="sxs-lookup"><span data-stu-id="62af2-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="62af2-251">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="62af2-251">About the Author</span></span>

<span data-ttu-id="62af2-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros de ASP/ASP. net y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha estado trabajando con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="62af2-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="62af2-253">Scott funciona como consultor, profesor y redactor independiente.</span><span class="sxs-lookup"><span data-stu-id="62af2-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="62af2-254">Su último libro se [*enseña a ASP.NET 2,0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="62af2-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="62af2-255">Puede ponerse en contacto con usted en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="62af2-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="62af2-256">o a través de su blog, que encontrará en [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="62af2-256">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="62af2-257">Agradecimiento especial a</span><span class="sxs-lookup"><span data-stu-id="62af2-257">Special Thanks To</span></span>

<span data-ttu-id="62af2-258">Muchos revisores útiles revisaron esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="62af2-258">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="62af2-259">El revisor responsable de este tutorial era Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="62af2-259">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="62af2-260">¿Está interesado en revisar los próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="62af2-260">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="62af2-261">En caso afirmativo, suéltelo en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="62af2-261">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="62af2-262">[Anterior](caching-data-with-the-objectdatasource-vb.md)
> [Siguiente](caching-data-at-application-startup-vb.md)</span><span class="sxs-lookup"><span data-stu-id="62af2-262">[Previous](caching-data-with-the-objectdatasource-vb.md)
[Next](caching-data-at-application-startup-vb.md)</span></span>
