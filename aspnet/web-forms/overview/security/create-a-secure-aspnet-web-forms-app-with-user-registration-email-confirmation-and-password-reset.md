---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: Creación de una aplicación de formularios Web Forms de ASP.NET segura con registro de usuarios,C#confirmación de correo electrónico y restablecimiento de contraseña () | Microsoft Docs
author: Erikre
description: En este tutorial se muestra cómo compilar una aplicación de formularios Web Forms ASP.NET con registro de usuarios, confirmación de correo electrónico y restablecimiento de contraseña mediante el miembro de ASP.NET Identity...
ms.author: riande
ms.date: 10/02/2014
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: af3653bc164810126bc3bf8f1b1794d75642d807
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78507133"
---
# <a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="ba726-103">Crear una aplicación segura de formularios Web Forms de ASP.NET con registro de usuario, confirmación por correo electrónico y restablecimiento de contraseña (C#)</span><span class="sxs-lookup"><span data-stu-id="ba726-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="ba726-104">por [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="ba726-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="ba726-105">En este tutorial se muestra cómo compilar una aplicación de formularios Web Forms ASP.NET con registro de usuarios, confirmación de correo electrónico y restablecimiento de contraseña mediante el sistema de pertenencia de ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="ba726-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="ba726-106">Este tutorial se basó en el tutorial de [MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)de Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="ba726-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>

## <a name="introduction"></a><span data-ttu-id="ba726-107">Introducción</span><span class="sxs-lookup"><span data-stu-id="ba726-107">Introduction</span></span>

<span data-ttu-id="ba726-108">Este tutorial le guía a través de los pasos necesarios para crear una aplicación de formularios Web Forms de ASP.NET mediante Visual Studio y ASP.NET 4,5 para crear una aplicación de formularios Web Forms segura con registro de usuarios, confirmación de correo electrónico y restablecimiento de contraseña.</span><span class="sxs-lookup"><span data-stu-id="ba726-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="ba726-109">Tareas e información del tutorial:</span><span class="sxs-lookup"><span data-stu-id="ba726-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="ba726-110">Creación de una aplicación de formularios Web Forms ASP.NET</span><span class="sxs-lookup"><span data-stu-id="ba726-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="ba726-111">Enlazar SendGrid</span><span class="sxs-lookup"><span data-stu-id="ba726-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="ba726-112">Requerir confirmación por correo electrónico antes de iniciar sesión</span><span class="sxs-lookup"><span data-stu-id="ba726-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="ba726-113">Recuperación y restablecimiento de contraseñas</span><span class="sxs-lookup"><span data-stu-id="ba726-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="ba726-114">Vínculo reenviar correo electrónico de confirmación</span><span class="sxs-lookup"><span data-stu-id="ba726-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="ba726-115">Solución de problemas de la aplicación</span><span class="sxs-lookup"><span data-stu-id="ba726-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="ba726-116">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="ba726-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="ba726-117">Creación de una aplicación de formularios Web Forms ASP.NET</span><span class="sxs-lookup"><span data-stu-id="ba726-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="ba726-118">Empiece por instalar y ejecutar [Visual Studio Express 2013 para web](https://go.microsoft.com/fwlink/?LinkId=299058) o [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="ba726-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="ba726-119">Instale también [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) o una versión posterior.</span><span class="sxs-lookup"><span data-stu-id="ba726-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="ba726-120">ADVERTENCIA: debe instalar [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) o superior para completar este tutorial.</span><span class="sxs-lookup"><span data-stu-id="ba726-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>

1. <span data-ttu-id="ba726-121">Cree un nuevo proyecto (**archivo** -&gt; **nuevo proyecto**) y seleccione la plantilla **aplicación Web ASP.net** y la versión más reciente de la .NET Framework en el cuadro de diálogo **nuevo proyecto** .</span><span class="sxs-lookup"><span data-stu-id="ba726-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="ba726-122">En el cuadro de diálogo **nuevo proyecto de ASP.net** , seleccione la plantilla de **formularios Web Forms** .</span><span class="sxs-lookup"><span data-stu-id="ba726-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="ba726-123">Deje la autenticación predeterminada como **cuentas de usuario individuales**.</span><span class="sxs-lookup"><span data-stu-id="ba726-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="ba726-124">Si desea hospedar la aplicación en Azure, deje activada la casilla **hospedar en la nube** .</span><span class="sxs-lookup"><span data-stu-id="ba726-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="ba726-125">A continuación, haga clic en **Aceptar** para crear el nuevo proyecto.</span><span class="sxs-lookup"><span data-stu-id="ba726-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="ba726-126">![Cuadro de diálogo New ASP.NET Project](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ba726-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="ba726-127">Habilite Capa de sockets seguros (SSL) para el proyecto.</span><span class="sxs-lookup"><span data-stu-id="ba726-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="ba726-128">Siga los pasos disponibles en la sección **habilitación de SSL para el proyecto** de la [serie de tutoriales de introducción con formularios Web Forms](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="ba726-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="ba726-129">Ejecute la aplicación, haga clic en el vínculo **registrar** y registre un nuevo usuario.</span><span class="sxs-lookup"><span data-stu-id="ba726-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="ba726-130">En este momento, la única validación en el correo electrónico se basa en el atributo [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) para asegurarse de que la dirección de correo electrónico tiene el formato correcto.</span><span class="sxs-lookup"><span data-stu-id="ba726-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="ba726-131">Modificará el código para agregar una confirmación por correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ba726-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="ba726-132">Cierre la ventana del explorador.</span><span class="sxs-lookup"><span data-stu-id="ba726-132">Close the browser window.</span></span>
5. <span data-ttu-id="ba726-133">En **Explorador de servidores** de Visual Studio (**vista** -&gt; **Explorador de servidores**), vaya a **datos Connections\DefaultConnection\Tables\AspNetUsers**, haga clic con el botón derecho y seleccione **abrir definición de tabla**.</span><span class="sxs-lookup"><span data-stu-id="ba726-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="ba726-134">En la imagen siguiente se muestra el esquema de tabla `AspNetUsers`:</span><span class="sxs-lookup"><span data-stu-id="ba726-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Esquema de la tabla AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="ba726-136">En **Explorador de servidores**, haga clic con el botón derecho en la tabla **AspNetUsers** y seleccione **Mostrar datos de tabla**.</span><span class="sxs-lookup"><span data-stu-id="ba726-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Datos de la tabla AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="ba726-138">En este momento no se ha confirmado el correo electrónico del usuario registrado.</span><span class="sxs-lookup"><span data-stu-id="ba726-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="ba726-139">Haga clic en la fila y seleccione eliminar para eliminar el usuario.</span><span class="sxs-lookup"><span data-stu-id="ba726-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="ba726-140">Agregará este correo electrónico de nuevo en el paso siguiente y enviará un mensaje de confirmación a la dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ba726-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="ba726-141">Confirmación por correo electrónico</span><span class="sxs-lookup"><span data-stu-id="ba726-141">Email Confirmation</span></span>

<span data-ttu-id="ba726-142">Se recomienda confirmar el correo electrónico durante el registro de un nuevo usuario para comprobar que no está suplantando a otra persona (es decir, que no se han registrado con el correo electrónico de otra persona).</span><span class="sxs-lookup"><span data-stu-id="ba726-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="ba726-143">Supongamos que tiene un foro de discusión, desea evitar que `"bob@cpandl.com"` se registre como `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="ba726-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="ba726-144">Sin confirmación por correo electrónico, `"joe@contoso.com"` podría obtener un correo electrónico no deseado de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba726-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="ba726-145">Supongamos que Bob se registra accidentalmente como `"bib@cpandl.com"` y no lo ha notado, no podría usar la recuperación de contraseña porque la aplicación no tiene su correo electrónico correcto.</span><span class="sxs-lookup"><span data-stu-id="ba726-145">Suppose Bob accidentally registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="ba726-146">La confirmación por correo electrónico proporciona solo protección limitada de bots y no proporciona protección contra los remitentes de spam determinados.</span><span class="sxs-lookup"><span data-stu-id="ba726-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="ba726-147">Por lo general, querrá evitar que los nuevos usuarios publiquen datos en el sitio Web antes de que se hayan confirmado mediante correo electrónico, un mensaje de texto SMS u otro mecanismo.</span><span class="sxs-lookup"><span data-stu-id="ba726-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="ba726-148">En las secciones siguientes, habilitaremos la confirmación por correo electrónico y modificaremos el código para evitar que los usuarios recién registrados inicien sesión hasta que se haya confirmado su correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ba726-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="ba726-149">En este tutorial, usará el servicio de correo electrónico SendGrid.</span><span class="sxs-lookup"><span data-stu-id="ba726-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="ba726-150">Enlazar SendGrid</span><span class="sxs-lookup"><span data-stu-id="ba726-150">Hook up SendGrid</span></span>

<span data-ttu-id="ba726-151">SendGrid ha cambiado su API desde que se escribió este tutorial.</span><span class="sxs-lookup"><span data-stu-id="ba726-151">SendGrid has changed it's API since this tutorial was written.</span></span> <span data-ttu-id="ba726-152">Para obtener instrucciones de SendGrid actuales, consulte [SendGrid](http://sendgrid.com/) o [Habilitar la confirmación de cuenta y la recuperación de contraseña](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span><span class="sxs-lookup"><span data-stu-id="ba726-152">For current SendGrid instructions, see [SendGrid](http://sendgrid.com/) or [Enable account confirmation and password recovery](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span></span>

<span data-ttu-id="ba726-153">Aunque este tutorial solo muestra cómo agregar una notificación por correo electrónico a través de [SendGrid](http://sendgrid.com/), puede enviar correo electrónico mediante SMTP y otros mecanismos (consulte [recursos adicionales](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="ba726-153">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="ba726-154">En Visual Studio, abra la **consola del administrador de paquetes** (**herramientas** -&gt; **administrador de paquetes NuGet** -&gt; **consola del administrador de paquetes**) y escriba el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="ba726-154">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="ba726-155">Vaya a la página de registro de [Azure SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) y regístrese para obtener una cuenta gratuita de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="ba726-155">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="ba726-156">También puede registrarse para obtener una cuenta gratuita de SendGrid directamente en el [sitio de SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="ba726-156">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="ba726-157">En **Explorador de soluciones** Abra el archivo *IdentityConfig.CS* en la carpeta de inicio de la\_de la *aplicación* y agregue el siguiente código resaltado en amarillo a la clase `EmailService` para configurar **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="ba726-157">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="ba726-158">Además, agregue las siguientes instrucciones de `using` al principio del archivo *IdentityConfig.CS* :</span><span class="sxs-lookup"><span data-stu-id="ba726-158">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="ba726-159">Para simplificar este ejemplo, almacene los valores de la cuenta de servicio de correo electrónico en la sección `appSettings` del archivo *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="ba726-159">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="ba726-160">Agregue el siguiente código XML resaltado en amarillo al archivo *Web. config* en la raíz del proyecto:</span><span class="sxs-lookup"><span data-stu-id="ba726-160">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="ba726-161">Seguridad: nunca almacene datos confidenciales en el código fuente.</span><span class="sxs-lookup"><span data-stu-id="ba726-161">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="ba726-162">En este ejemplo, la cuenta y las credenciales se almacenan en la sección **appSetting** del archivo *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="ba726-162">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="ba726-163">En Azure, puede almacenar estos valores de forma segura en la pestaña **[configurar](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** del Azure portal.</span><span class="sxs-lookup"><span data-stu-id="ba726-163">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="ba726-164">Para obtener información relacionada, vea el tema de Rick Anderson titulado [procedimientos recomendados para la implementación de contraseñas y otros datos confidenciales en ASP.net y Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="ba726-164">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="ba726-165">Agregue los valores del servicio de correo electrónico para reflejar los valores de autenticación de SendGrid (nombre de usuario y contraseña) para poder enviar correo electrónico correctamente desde la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba726-165">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="ba726-166">Asegúrese de usar el nombre de la cuenta de SendGrid en lugar de la dirección de correo electrónico que proporcionó SendGrid.</span><span class="sxs-lookup"><span data-stu-id="ba726-166">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="ba726-167">Habilitar confirmación de correo electrónico</span><span class="sxs-lookup"><span data-stu-id="ba726-167">Enable Email Confirmation</span></span>

 <span data-ttu-id="ba726-168">Para habilitar la confirmación por correo electrónico, modificará el código de registro siguiendo estos pasos.</span><span class="sxs-lookup"><span data-stu-id="ba726-168">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  

1. <span data-ttu-id="ba726-169">En la carpeta de la *cuenta* , abra el código subyacente de *Register.aspx.CS* y actualice el método `CreateUser_Click` para habilitar los siguientes cambios resaltados:</span><span class="sxs-lookup"><span data-stu-id="ba726-169">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="ba726-170">En **Explorador de soluciones**, haga clic con el botón secundario en *default. aspx* y seleccione **establecer como página de inicio**.</span><span class="sxs-lookup"><span data-stu-id="ba726-170">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="ba726-171">Ejecute la aplicación presionando **F5.**</span><span class="sxs-lookup"><span data-stu-id="ba726-171">Run the app by pressing **F5.**</span></span> <span data-ttu-id="ba726-172">Una vez que se muestre la página, haga clic en el vínculo **registrar** para mostrar la página de registro.</span><span class="sxs-lookup"><span data-stu-id="ba726-172">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="ba726-173">Escriba el correo electrónico y la contraseña y haga clic en el botón **registrar** para enviar un mensaje de correo electrónico a través de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="ba726-173">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
   <span data-ttu-id="ba726-174">El estado actual del proyecto y el código permitirá que el usuario inicie sesión una vez que complete el formulario de registro, aunque no haya confirmado su cuenta.</span><span class="sxs-lookup"><span data-stu-id="ba726-174">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="ba726-175">Compruebe su cuenta de correo electrónico y haga clic en el vínculo para confirmar su correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ba726-175">Check your email account and click on the link to confirm your email.</span></span>  
   <span data-ttu-id="ba726-176">Una vez enviado el formulario de registro, se iniciará sesión.</span><span class="sxs-lookup"><span data-stu-id="ba726-176">Once you submit the registration form, you will be logged in.</span></span>  
    ![Sitio web de ejemplo-sesión iniciada](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="ba726-178">Requerir confirmación por correo electrónico antes de iniciar sesión</span><span class="sxs-lookup"><span data-stu-id="ba726-178">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="ba726-179">Aunque haya confirmado la cuenta de correo electrónico, en este momento no tendría que hacer clic en el vínculo contenido en el correo electrónico de comprobación para que la sesión esté completa.</span><span class="sxs-lookup"><span data-stu-id="ba726-179">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="ba726-180">En la siguiente sección, modificará el código que requiere que los nuevos usuarios tengan un correo electrónico confirmado antes de que se inicie sesión (autenticado).</span><span class="sxs-lookup"><span data-stu-id="ba726-180">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="ba726-181">En **Explorador de soluciones** de Visual Studio, actualice el evento de `CreateUser_Click` en el código subyacente de *Register.aspx.CS* incluido en la carpeta *cuentas* con los siguientes cambios resaltados:</span><span class="sxs-lookup"><span data-stu-id="ba726-181">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="ba726-182">Actualice el método de `LogIn` en el código subyacente de *login.aspx.CS* con los siguientes cambios resaltados:</span><span class="sxs-lookup"><span data-stu-id="ba726-182">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="ba726-183">Ejecutar la aplicación</span><span class="sxs-lookup"><span data-stu-id="ba726-183">Run the Application</span></span>

 <span data-ttu-id="ba726-184">Ahora que ha implementado el código para comprobar si se ha confirmado la dirección de correo electrónico de un usuario, puede comprobar la funcionalidad en las páginas **registro** e **Inicio de sesión** .</span><span class="sxs-lookup"><span data-stu-id="ba726-184">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="ba726-185">Elimine todas las cuentas de la tabla **AspNetUsers** que contengan el alias de correo electrónico que desea probar.</span><span class="sxs-lookup"><span data-stu-id="ba726-185">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="ba726-186">Ejecute la aplicación (**F5**) y compruebe que no se puede registrar como usuario hasta que se haya confirmado su dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ba726-186">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="ba726-187">Antes de confirmar la nueva cuenta a través del correo electrónico que se acaba de enviar, intente iniciar sesión con la nueva cuenta.</span><span class="sxs-lookup"><span data-stu-id="ba726-187">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="ba726-188">Verá que no puede iniciar sesión y que debe tener una cuenta de correo electrónico confirmada.</span><span class="sxs-lookup"><span data-stu-id="ba726-188">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="ba726-189">Una vez confirmada la dirección de correo electrónico, inicie sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba726-189">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="ba726-190">Recuperación y restablecimiento de contraseñas</span><span class="sxs-lookup"><span data-stu-id="ba726-190">Password Recovery and Reset</span></span>

1. <span data-ttu-id="ba726-191">En Visual Studio, quite los caracteres de comentario del método `Forgot` en el código subyacente de *Forgot.aspx.CS* incluido en la carpeta de la *cuenta* , para que el método aparezca de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="ba726-191">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="ba726-192">Abra la página *login. aspx* .</span><span class="sxs-lookup"><span data-stu-id="ba726-192">Open the *Login.aspx* page.</span></span> <span data-ttu-id="ba726-193">Reemplace el marcado cerca del final de la sección **loginForm** , tal y como se resalta a continuación:</span><span class="sxs-lookup"><span data-stu-id="ba726-193">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="ba726-194">Abra el código subyacente de *login.aspx.CS* y quite la marca de comentario de la siguiente línea de código resaltada en amarillo desde el controlador de eventos `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="ba726-194">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="ba726-195">Ejecute la aplicación presionando **F5.**</span><span class="sxs-lookup"><span data-stu-id="ba726-195">Run the app by pressing **F5.**</span></span> <span data-ttu-id="ba726-196">Una vez que se muestre la página, haga clic en el vínculo **iniciar sesión** .</span><span class="sxs-lookup"><span data-stu-id="ba726-196">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="ba726-197">Haga clic en el vínculo **¿olvidó su contraseña?** para mostrar la página **contraseña olvidada** .</span><span class="sxs-lookup"><span data-stu-id="ba726-197">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="ba726-198">Escriba su dirección de correo electrónico y haga clic en el botón **Enviar** para enviar un correo electrónico a su dirección que le permitirá restablecer la contraseña.</span><span class="sxs-lookup"><span data-stu-id="ba726-198">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
   <span data-ttu-id="ba726-199">Compruebe su cuenta de correo electrónico y haga clic en el vínculo para mostrar la página **Restablecer contraseña** .</span><span class="sxs-lookup"><span data-stu-id="ba726-199">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="ba726-200">En la página **Restablecer contraseña** , escriba el correo electrónico, la contraseña y la contraseña confirmada.</span><span class="sxs-lookup"><span data-stu-id="ba726-200">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="ba726-201">A continuación, haga clic en el botón **restablecer** .</span><span class="sxs-lookup"><span data-stu-id="ba726-201">Then, press the **Reset** button.</span></span>  
   <span data-ttu-id="ba726-202">Cuando haya restablecido correctamente la contraseña, se mostrará la página **contraseña cambiada** .</span><span class="sxs-lookup"><span data-stu-id="ba726-202">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="ba726-203">Ahora puede iniciar sesión con la nueva contraseña.</span><span class="sxs-lookup"><span data-stu-id="ba726-203">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="ba726-204">Vínculo reenviar correo electrónico de confirmación</span><span class="sxs-lookup"><span data-stu-id="ba726-204">Resend Email Confirmation Link</span></span>

<span data-ttu-id="ba726-205">Una vez que un usuario crea una nueva cuenta local, se le envía un vínculo de confirmación para que pueda iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="ba726-205">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="ba726-206">Si el usuario elimina accidentalmente el correo electrónico de confirmación o el correo electrónico nunca llega, deberá volver a enviar el vínculo de confirmación.</span><span class="sxs-lookup"><span data-stu-id="ba726-206">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="ba726-207">Los siguientes cambios de código muestran cómo habilitarlo.</span><span class="sxs-lookup"><span data-stu-id="ba726-207">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="ba726-208">En Visual Studio, abra el código subyacente de **login.aspx.CS** y agregue el siguiente controlador de eventos después del controlador de eventos `LogIn`:</span><span class="sxs-lookup"><span data-stu-id="ba726-208">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="ba726-209">Modifique el controlador de eventos `LogIn` en el código subyacente de *login.aspx.CS* cambiando el código resaltado en amarillo de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="ba726-209">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="ba726-210">Actualice la página *login. aspx* agregando el código resaltado en amarillo de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ba726-210">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="ba726-211">Elimine todas las cuentas de la tabla **AspNetUsers** que contengan el alias de correo electrónico que desea probar.</span><span class="sxs-lookup"><span data-stu-id="ba726-211">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="ba726-212">Ejecute la aplicación (**F5**) y registre su dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ba726-212">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="ba726-213">Antes de confirmar la nueva cuenta a través del correo electrónico que se acaba de enviar, intente iniciar sesión con la nueva cuenta.</span><span class="sxs-lookup"><span data-stu-id="ba726-213">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
   <span data-ttu-id="ba726-214">Verá que no puede iniciar sesión y que debe tener una cuenta de correo electrónico confirmada.</span><span class="sxs-lookup"><span data-stu-id="ba726-214">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="ba726-215">Además, ahora puede volver a enviar un mensaje de confirmación a su cuenta de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="ba726-215">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="ba726-216">Escriba la dirección de correo electrónico y la contraseña y, después, presione el botón **volver a enviar confirmación** .</span><span class="sxs-lookup"><span data-stu-id="ba726-216">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="ba726-217">Una vez que confirme su dirección de correo electrónico en función del mensaje de correo electrónico recién enviado, inicie sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba726-217">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="ba726-218">Solución de problemas de la aplicación</span><span class="sxs-lookup"><span data-stu-id="ba726-218">Troubleshooting the App</span></span>

<span data-ttu-id="ba726-219">Si no recibe un correo electrónico que contenga el vínculo para comprobar sus credenciales:</span><span class="sxs-lookup"><span data-stu-id="ba726-219">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="ba726-220">Compruebe la carpeta de correo no deseado o correo no deseado.</span><span class="sxs-lookup"><span data-stu-id="ba726-220">Check your junk or spam folder.</span></span>
- <span data-ttu-id="ba726-221">Inicie sesión en su cuenta de SendGrid y haga clic en el [vínculo actividad de correo electrónico](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="ba726-221">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="ba726-222">Asegúrese de usar el nombre de la cuenta de usuario de SendGrid como valor de *Web. config* en lugar de la dirección de correo electrónico de la cuenta de SendGrid.</span><span class="sxs-lookup"><span data-stu-id="ba726-222">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="ba726-223">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="ba726-223">Additional Resources</span></span>

- [<span data-ttu-id="ba726-224">Vínculos a ASP.NET Identity recursos recomendados</span><span class="sxs-lookup"><span data-stu-id="ba726-224">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="ba726-225">Confirmación de la cuenta y recuperación de la contraseña con ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="ba726-225">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="ba726-226">Serie de tutoriales de formularios Web Forms de ASP.NET: agregar un proveedor OAuth 2,0</span><span class="sxs-lookup"><span data-stu-id="ba726-226">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="ba726-227">Implementar una aplicación de formularios Web Forms de ASP.NET segura con pertenencia, OAuth y SQL Database para Azure App Service</span><span class="sxs-lookup"><span data-stu-id="ba726-227">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="ba726-228">Serie de tutoriales de ASP.NET Web Forms: habilitación de SSL para el proyecto</span><span class="sxs-lookup"><span data-stu-id="ba726-228">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
