---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
title: Recuperar y cambiar las contraseñas (C#) | Microsoft Docs
author: rick-anderson
description: ASP.NET incluye dos controles Web de ayudar a recuperar y cambiar las contraseñas. El control PasswordRecovery permite a un visitante recuperar a su pa perdido...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 19c4d042-4e34-4b44-9f1d-6bf2253ba366
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
msc.type: authoredcontent
ms.openlocfilehash: e3e097663568b21ee3f84c7006a0bd89718ac6c2
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/09/2019
ms.locfileid: "59380286"
---
# <a name="recovering-and-changing-passwords-c"></a><span data-ttu-id="f85c3-104">Recuperar y cambiar las contraseñas (C#)</span><span class="sxs-lookup"><span data-stu-id="f85c3-104">Recovering and Changing Passwords (C#)</span></span>

<span data-ttu-id="f85c3-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f85c3-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f85c3-106">[Descargar código](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) o [descargar PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="f85c3-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span></span>

> <span data-ttu-id="f85c3-107">ASP.NET incluye dos controles Web de ayudar a recuperar y cambiar las contraseñas.</span><span class="sxs-lookup"><span data-stu-id="f85c3-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="f85c3-108">El control PasswordRecovery permite a un visitante recuperar su contraseña perdida.</span><span class="sxs-lookup"><span data-stu-id="f85c3-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="f85c3-109">El control ChangePassword permite al usuario que actualice su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="f85c3-110">Al igual que otros controles Web relacionados con el inicio de sesión que hemos visto a lo largo de esta serie de tutoriales, la PasswordRecovery y ChangePassword de los controles con el marco de pertenencia en segundo plano para restablecer o modificar las contraseñas de usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>


## <a name="introduction"></a><span data-ttu-id="f85c3-111">Introducción</span><span class="sxs-lookup"><span data-stu-id="f85c3-111">Introduction</span></span>

<span data-ttu-id="f85c3-112">Entre los sitios Web para mi bank, compañía, compañía telefónica, cuentas de correo electrónico y los portales web personalizada, I, al igual que la mayoría de los usuarios tener docenas de distintas contraseñas para recordar.</span><span class="sxs-lookup"><span data-stu-id="f85c3-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="f85c3-113">Con tantas credenciales memorizar hoy en día, no es raro que las personas olvidado su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="f85c3-114">Para resolverlo, deben incluir un usuario recuperar su contraseña de una manera de sitios Web que ofrecen las cuentas de usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="f85c3-115">Este proceso conlleva normalmente genera una nueva contraseña aleatoria y enviarla a la dirección de correo electrónico del usuario en el archivo.</span><span class="sxs-lookup"><span data-stu-id="f85c3-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="f85c3-116">Después de recibir su nueva contraseña la mayoría de los usuarios volver al sitio y cambiar su contraseña desde el uno generado aleatoriamente a uno más fáciles de recordar.</span><span class="sxs-lookup"><span data-stu-id="f85c3-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="f85c3-117">ASP.NET incluye dos controles Web de ayudar a recuperar y cambiar las contraseñas.</span><span class="sxs-lookup"><span data-stu-id="f85c3-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="f85c3-118">El control PasswordRecovery permite a un visitante recuperar su contraseña perdida.</span><span class="sxs-lookup"><span data-stu-id="f85c3-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="f85c3-119">El control ChangePassword permite al usuario que actualice su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="f85c3-120">Al igual que otros controles Web relacionados con el inicio de sesión que hemos visto a lo largo de esta serie de tutoriales, la PasswordRecovery y ChangePassword de los controles con el marco de pertenencia en segundo plano para restablecer o modificar las contraseñas de usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="f85c3-121">En este tutorial, examinaremos el uso de estos dos controles.</span><span class="sxs-lookup"><span data-stu-id="f85c3-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="f85c3-122">También veremos cómo cambiar mediante programación y restablecer la contraseña de un usuario a través de la `MembershipUser` la clase `ChangePassword` y `ResetPassword` métodos.</span><span class="sxs-lookup"><span data-stu-id="f85c3-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="f85c3-123">Paso 1: Le ayuda a recuperar de los usuarios pierden las contraseñas</span><span class="sxs-lookup"><span data-stu-id="f85c3-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="f85c3-124">Todos los sitios Web que admiten las cuentas de usuario deben proporcionar a los usuarios con algún mecanismo para recuperar sus contraseñas olvidadas.</span><span class="sxs-lookup"><span data-stu-id="f85c3-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="f85c3-125">La buena noticia es que la implementación de esta funcionalidad en ASP.NET es muy fácil gracias al control PasswordRecovery Web.</span><span class="sxs-lookup"><span data-stu-id="f85c3-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="f85c3-126">El control PasswordRecovery representa una interfaz que solicita al usuario su nombre de usuario y, si es necesario, la respuesta a su pregunta de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f85c3-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="f85c3-127">A continuación, envía un correo electrónico al usuario su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="f85c3-128">Dado que los mensajes de correo electrónico se transmiten a través de la red en texto sin formato intervienen los riesgos de seguridad con el envío de contraseña de un usuario por correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="f85c3-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>


<span data-ttu-id="f85c3-129">El control PasswordRecovery consta de tres vistas:</span><span class="sxs-lookup"><span data-stu-id="f85c3-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="f85c3-130">**Nombre de usuario** -solicita el visitante para su nombre de usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="f85c3-131">Se trata de la vista inicial.</span><span class="sxs-lookup"><span data-stu-id="f85c3-131">This is the initial view.</span></span>
- <span data-ttu-id="f85c3-132">**Pregunta**-muestra la pregunta de seguridad y el nombre de usuario del usuario como texto, junto con un cuadro de texto para el usuario a escribir la respuesta a su pregunta de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f85c3-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="f85c3-133">**Éxito**-muestra un mensaje que informa al usuario que se ha enviado su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="f85c3-134">Muestran las vistas y las acciones realizadas por el control PasswordRecovery dependen de las siguientes opciones de configuración de pertenencia:</span><span class="sxs-lookup"><span data-stu-id="f85c3-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="f85c3-135">El marco de pertenencia `RequiresQuestionAndAnswer` valor indica si los usuarios deben especificar una pregunta de seguridad y la respuesta al registrarse para una cuenta.</span><span class="sxs-lookup"><span data-stu-id="f85c3-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="f85c3-136">Como se explicó en la <a id="_msoanchor_1"> </a> [ *crear cuentas de usuario* ](../membership/creating-user-accounts-cs.md) tutorial, if `RequiresQuestionAndAnswer` es True (valor predeterminado), entonces la interfaz del control CreateUserWizard incluye el cuadro de texto controles para el nuevo usuario pregunta de seguridad y respuesta; Si `RequiresQuestionAndAnswer` es False, se recopila ninguna información de este tipo.</span><span class="sxs-lookup"><span data-stu-id="f85c3-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="f85c3-137">De forma similar, si `RequiresQuestionAndAnswer` es True, entonces el control PasswordRecovery muestra la pregunta ver después de que el usuario ha escrito su nombre de usuario, ya que es recuperar la contraseña solo si el usuario escribe la respuesta de seguridad correcta.</span><span class="sxs-lookup"><span data-stu-id="f85c3-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="f85c3-138">Si `RequiresQuestionAndAnswer` es False, sin embargo, se mueve el control PasswordRecovery directamente desde la vista de nombre de usuario a la vista correcto.</span><span class="sxs-lookup"><span data-stu-id="f85c3-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="f85c3-139">Después de que el usuario ha proporcionado su nombre de usuario - o su respuesta de nombre de usuario y la seguridad, si `RequiresQuestionAndAnswer` es True: la PasswordRecovery envía por correo electrónico al usuario su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="f85c3-140">Si el `EnablePasswordRetrieval` opción está establecida en True y, después, el usuario se envían por correo electrónico su contraseña actual.</span><span class="sxs-lookup"><span data-stu-id="f85c3-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="f85c3-141">Si se establece en False y `EnablePasswordReset` está establecida en True, el control PasswordRecovery genera una nueva contraseña aleatoria para el usuario y envía por correo electrónico de esta nueva contraseña a ellos.</span><span class="sxs-lookup"><span data-stu-id="f85c3-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="f85c3-142">Si ambos `EnablePasswordRetrieval` y `EnablePasswordReset` son False, el control PasswordRecovery produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="f85c3-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="f85c3-143">Recuerde que el `SqlMembershipProvider` almacena las contraseñas de usuario en uno de los tres formatos: Clear, Hashed (valor predeterminado) o cifrado.</span><span class="sxs-lookup"><span data-stu-id="f85c3-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="f85c3-144">El mecanismo de almacenamiento utilizado depende de las opciones de configuración de pertenencia; la aplicación de demostración usa el formato de la contraseña con hash.</span><span class="sxs-lookup"><span data-stu-id="f85c3-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="f85c3-145">Cuando se usa el formato de la contraseña Hashed el `EnablePasswordRetrieval` opción debe establecerse en False porque el sistema no puede determinar la contraseña del usuario real de la versión con hash almacenada en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="f85c3-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>


<span data-ttu-id="f85c3-146">Figura 1 ilustra cómo el PasswordRecovery interfaz y el comportamiento se ve afectada por la configuración de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="f85c3-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>


[![T<span data-ttu-id="f85c3-147">él RequiresQuestionAndAnswer EnablePasswordRetrieval y EnablePasswordReset influir en la apariencia del control PasswordRecovery y comportamiento]</span><span class="sxs-lookup"><span data-stu-id="f85c3-147">he RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior]</span></span>(recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)

<span data-ttu-id="f85c3-148">**Figura 1**: El `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, y `EnablePasswordReset` influir en la apariencia y el comportamiento del control PasswordRecovery ([haga clic aquí para ver imagen en tamaño completo](recovering-and-changing-passwords-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="f85c3-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image3.png))</span></span>


> [!NOTE]
> <span data-ttu-id="f85c3-149">En el <a id="_msoanchor_2"> </a> [ *crear el esquema de pertenencia en SQL Server* ](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial hemos configurado el proveedor de pertenencia estableciendo `RequiresQuestionAndAnswer` en True, `EnablePasswordRetrieval` a Es False, y `EnablePasswordReset` en True.</span><span class="sxs-lookup"><span data-stu-id="f85c3-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>


### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="f85c3-150">Uso del Control PasswordRecovery</span><span class="sxs-lookup"><span data-stu-id="f85c3-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="f85c3-151">Veamos cómo usar el control PasswordRecovery en una página ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f85c3-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="f85c3-152">Abra `RecoverPassword.aspx` y arrastre y coloque un control PasswordRecovery desde el cuadro de herramientas hasta el diseñador; establecer su `ID` a `RecoverPwd`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="f85c3-153">Igual que los controles de inicio de sesión y CreateUserWizard Web, las vistas del control PasswordRecovery presentar una interfaz enriquecida compuesta que incluye las etiquetas, cuadros de texto, botones y los controles de validación.</span><span class="sxs-lookup"><span data-stu-id="f85c3-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="f85c3-154">Puede personalizar la apariencia de las vistas a través de las propiedades de estilo del control o convirtiendo las vistas en las plantillas.</span><span class="sxs-lookup"><span data-stu-id="f85c3-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="f85c3-155">Dejar como un ejercicio para el lector interesado.</span><span class="sxs-lookup"><span data-stu-id="f85c3-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="f85c3-156">Cuando un usuario visita esta página introducirá el nombre de usuario y haga clic en el botón Enviar.</span><span class="sxs-lookup"><span data-stu-id="f85c3-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="f85c3-157">Dado que hemos configurado la `RequiresQuestionAndAnswer` propiedad en True en nuestras opciones de configuración de pertenencia, el PasswordRecovery controlar will, a continuación, mostrar la vista de pregunta.</span><span class="sxs-lookup"><span data-stu-id="f85c3-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="f85c3-158">Después de que el usuario escribe su respuesta de seguridad correcta y haga clic en Submit, el control PasswordRecovery actualizar la contraseña del usuario a uno generado aleatoriamente y esta contraseña a la dirección de correo electrónico en el archivo de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="f85c3-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="f85c3-159">Todo esto era posible sin que tengamos que escribir una sola línea de código.</span><span class="sxs-lookup"><span data-stu-id="f85c3-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="f85c3-160">Antes de probar esta página, hay un último elemento de configuración que tienden a: se debe especificar la configuración de entrega de correo electrónico en `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="f85c3-161">El control PasswordRecovery se basa en esta configuración para enviar el correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="f85c3-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="f85c3-162">Se especifica la configuración de entrega de correo electrónico a través de la [ `<system.net>` elemento](https://msdn.microsoft.com/library/6484zdc1.aspx)del [ `<mailSettings>` elemento](https://msdn.microsoft.com/library/w355a94k.aspx).</span><span class="sxs-lookup"><span data-stu-id="f85c3-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/library/w355a94k.aspx).</span></span> <span data-ttu-id="f85c3-163">Use la [ `<smtp>` elemento](https://msdn.microsoft.com/library/ms164240.aspx) para indicar el método de entrega y el valor predeterminado de dirección.</span><span class="sxs-lookup"><span data-stu-id="f85c3-163">Use the [`<smtp>` element](https://msdn.microsoft.com/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="f85c3-164">El siguiente marcado establece la configuración de correo electrónico para usar un servidor SMTP de red denominado `smtp.example.com` en el puerto 25 y con las credenciales de usuario y contraseña de usuario y la contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> `<system.net>` <span data-ttu-id="f85c3-165">es un elemento secundario de la raíz `<configuration>` elemento y un elemento relacionado de `<system.web>`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-165">is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="f85c3-166">Por lo tanto, no coloque la `<system.net>` elemento dentro de la `<system.web>` elemento; en su lugar, se coloca en el mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="f85c3-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>


[!code-xml[Main](recovering-and-changing-passwords-cs/samples/sample1.xml)]

<span data-ttu-id="f85c3-167">Además de utilizar un servidor SMTP en la red, o bien puede especificar un directorio de recogida donde se deben depositar los mensajes de correo electrónico se envíen.</span><span class="sxs-lookup"><span data-stu-id="f85c3-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="f85c3-168">Una vez haya configurado la configuración de SMTP, visite la `RecoverPassword.aspx` página a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="f85c3-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="f85c3-169">En primer lugar pruebe a escribir un nombre de usuario que no existe en el almacén del usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="f85c3-170">Como se muestra en la figura 2, el control PasswordRecovery muestra un mensaje que indica que no se accede a la información de usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="f85c3-171">Se puede personalizar el texto del mensaje a través del control [ `UserNameFailureText` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span><span class="sxs-lookup"><span data-stu-id="f85c3-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>


[![A<span data-ttu-id="f85c3-172">n mensaje de Error aparece si se ha especificado un nombre de usuario no válido]</span><span class="sxs-lookup"><span data-stu-id="f85c3-172">n Error Message is Displayed if an Invalid Username is Entered]</span></span>(recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)

<span data-ttu-id="f85c3-173">**Figura 2**: Se muestra un mensaje de Error si se escribe un nombre de usuario no válido ([haga clic aquí para ver imagen en tamaño completo](recovering-and-changing-passwords-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="f85c3-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image6.png))</span></span>


<span data-ttu-id="f85c3-174">Ahora, escriba un nombre de usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-174">Now enter a username.</span></span> <span data-ttu-id="f85c3-175">Use el nombre de usuario de una cuenta en el sistema con una dirección de correo electrónico que puede acceder y responder a cuya seguridad se conoce.</span><span class="sxs-lookup"><span data-stu-id="f85c3-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="f85c3-176">Después de escribir el nombre de usuario y hacer clic en enviar, el control PasswordRecovery muestra su vista de pregunta.</span><span class="sxs-lookup"><span data-stu-id="f85c3-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="f85c3-177">Como con la vista de nombre de usuario, si escribe una incorrecta responda el control PasswordRecovery muestra un mensaje de error (consulte la figura 3).</span><span class="sxs-lookup"><span data-stu-id="f85c3-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="f85c3-178">Use la [ `QuestionFailureText` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) para personalizar este mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="f85c3-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>


[![A<span data-ttu-id="f85c3-179">n mensaje de Error se muestra si el usuario escribe una respuesta de seguridad no válido]</span><span class="sxs-lookup"><span data-stu-id="f85c3-179">n Error Message is Displayed if the User Enters an Invalid Security Answer]</span></span>(recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)

<span data-ttu-id="f85c3-180">**Figura 3**: Se muestra un mensaje de Error si el usuario escribe una respuesta de seguridad no válido ([haga clic aquí para ver imagen en tamaño completo](recovering-and-changing-passwords-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="f85c3-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image9.png))</span></span>


<span data-ttu-id="f85c3-181">Por último, escriba la respuesta de seguridad correcta y haga clic en enviar.</span><span class="sxs-lookup"><span data-stu-id="f85c3-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="f85c3-182">En segundo plano, el control PasswordRecovery genera una contraseña aleatoria, lo asigna a la cuenta de usuario, envía un correo electrónico que informa al usuario de su nueva contraseña (consulte la figura 4) y, a continuación, muestra la vista correcto.</span><span class="sxs-lookup"><span data-stu-id="f85c3-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>


[![T<span data-ttu-id="f85c3-183">Usuario recibe un correo electrónico con su nueva contraseña]</span><span class="sxs-lookup"><span data-stu-id="f85c3-183">he User is Sent an Email with His New Password]</span></span>(recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)

<span data-ttu-id="f85c3-184">**Figura 4**: El usuario se envía un correo electrónico con su nueva contraseña ([haga clic aquí para ver imagen en tamaño completo](recovering-and-changing-passwords-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="f85c3-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image12.png))</span></span>


### <a name="customizing-the-email"></a><span data-ttu-id="f85c3-185">Personalizar el correo electrónico</span><span class="sxs-lookup"><span data-stu-id="f85c3-185">Customizing the Email</span></span>

<span data-ttu-id="f85c3-186">El correo electrónico predeterminado enviado por el control PasswordRecovery es bastante aburrido (consulte la figura 4).</span><span class="sxs-lookup"><span data-stu-id="f85c3-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="f85c3-187">El mensaje se envía desde la cuenta especificada en el `<smtp>` del elemento `from` atributo con el asunto de contraseña y el cuerpo de texto sin formato:</span><span class="sxs-lookup"><span data-stu-id="f85c3-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="f85c3-188">Regrese al sitio e inicie sesión con la siguiente información.</span><span class="sxs-lookup"><span data-stu-id="f85c3-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="f85c3-189">Nombre de usuario: *nombre de usuario*</span><span class="sxs-lookup"><span data-stu-id="f85c3-189">User Name: *username*</span></span>

<span data-ttu-id="f85c3-190">Contraseña: *contraseña*</span><span class="sxs-lookup"><span data-stu-id="f85c3-190">Password: *password*</span></span>

<span data-ttu-id="f85c3-191">Este mensaje se puede personalizar mediante programación a través de un controlador de eventos para el control PasswordRecovery [ `SendingMail` eventos](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), o mediante declaración a través del [ `MailDefinition` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="f85c3-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="f85c3-192">Vamos a examinar ambas opciones.</span><span class="sxs-lookup"><span data-stu-id="f85c3-192">Let's explore both of these options.</span></span>

<span data-ttu-id="f85c3-193">El `SendingMail` evento se desencadena justo antes de que el mensaje de correo electrónico se envía y se nuestra última oportunidad para ajustar el mensaje de correo electrónico mediante programación.</span><span class="sxs-lookup"><span data-stu-id="f85c3-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="f85c3-194">Cuando se genera este evento, el controlador de eventos se pasa un objeto de tipo [ `MailMessageEventArgs` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), cuya `Message` propiedad contiene una referencia al correo electrónico que va a enviar.</span><span class="sxs-lookup"><span data-stu-id="f85c3-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="f85c3-195">Crear un controlador de eventos para el `SendingMail` eventos y agregue el código siguiente, que agrega mediante programación `webmaster@example.com` a la lista CC.</span><span class="sxs-lookup"><span data-stu-id="f85c3-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-csharp[Main](recovering-and-changing-passwords-cs/samples/sample2.cs)]

<span data-ttu-id="f85c3-196">El mensaje de correo electrónico también puede configurarse a través de medios declarativos.</span><span class="sxs-lookup"><span data-stu-id="f85c3-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="f85c3-197">El PasswordRecovery `MailDefinition` propiedad es un objeto de tipo [ `MailDefinition` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="f85c3-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="f85c3-198">El `MailDefinition` clase ofrece un sinfín de propiedades relacionadas con el correo electrónico, incluidos `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`y otros.</span><span class="sxs-lookup"><span data-stu-id="f85c3-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="f85c3-199">Para comenzar, establezca el [ `Subject` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) a algo más descriptivo a la que se usa de forma predeterminada (contraseña), como se ha restablecido su contraseña...</span><span class="sxs-lookup"><span data-stu-id="f85c3-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="f85c3-200">Para personalizar el cuerpo del mensaje de correo electrónico que es necesario crear un archivo de plantilla de correo electrónico independiente que contiene el contenido del cuerpo.</span><span class="sxs-lookup"><span data-stu-id="f85c3-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="f85c3-201">Empiece por crear una nueva carpeta en el sitio Web denominado `EmailTemplates`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="f85c3-202">A continuación, agregue un nuevo archivo de texto en esta carpeta denominada `PasswordRecovery.txt` y agregue el siguiente contenido:</span><span class="sxs-lookup"><span data-stu-id="f85c3-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample3.aspx)]

<span data-ttu-id="f85c3-203">Tenga en cuenta el uso de los marcadores de posición `<%UserName%>` y `<%Password%>`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="f85c3-204">El control PasswordRecovery reemplaza automáticamente estos dos marcadores de posición con nombre de usuario y una contraseña recuperada antes de enviar el correo electrónico del usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="f85c3-205">Por último, elija el `MailDefinition`del [ `BodyFileName` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) a la plantilla de correo electrónico que acabamos de crear (`~/EmailTemplates/PasswordRecovery.txt`).</span><span class="sxs-lookup"><span data-stu-id="f85c3-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="f85c3-206">Después de realizar estos cambios a consultar el `RecoverPassword.aspx` página y escriba su nombre de usuario y seguridad la respuesta.</span><span class="sxs-lookup"><span data-stu-id="f85c3-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="f85c3-207">Recibirá debe un correo electrónico que parezca más en la figura 5.</span><span class="sxs-lookup"><span data-stu-id="f85c3-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="f85c3-208">Tenga en cuenta que `webmaster@example.com` ha sido CC debería y que se han actualizado el asunto y cuerpo.</span><span class="sxs-lookup"><span data-stu-id="f85c3-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>


[![T<span data-ttu-id="f85c3-209">Asunto, el cuerpo y se han actualizado CC lista]</span><span class="sxs-lookup"><span data-stu-id="f85c3-209">he Subject, Body, and CC List Have Been Updated]</span></span>(recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)

<span data-ttu-id="f85c3-210">**Figura 5**: El asunto, el cuerpo y se han actualizado CC lista ([haga clic aquí para ver imagen en tamaño completo](recovering-and-changing-passwords-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="f85c3-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image15.png))</span></span>


<span data-ttu-id="f85c3-211">Enviar un correo electrónico con formato HTML establecer [ `IsBodyHtml` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) en True (el valor predeterminado es False) y actualización de la plantilla de correo electrónico para incluir HTML.</span><span class="sxs-lookup"><span data-stu-id="f85c3-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="f85c3-212">El `MailDefinition` propiedad no es única en la clase PasswordRecovery.</span><span class="sxs-lookup"><span data-stu-id="f85c3-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="f85c3-213">Como veremos en el paso 2, el control ChangePassword también ofrece un `MailDefinition` propiedad.</span><span class="sxs-lookup"><span data-stu-id="f85c3-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="f85c3-214">Además, el control CreateUserWizard incluye este tipo de propiedad que se pueden configurar para enviar automáticamente un mensaje de correo electrónico de bienvenida a nuevos usuarios.</span><span class="sxs-lookup"><span data-stu-id="f85c3-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="f85c3-215">Actualmente hay no hay vínculos en el panel de navegación izquierdo para llegar a la `RecoverPassword.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="f85c3-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="f85c3-216">Un usuario solo estaría interesado en visitar esta página si ella no pudo iniciar sesión en el sitio.</span><span class="sxs-lookup"><span data-stu-id="f85c3-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="f85c3-217">Por lo tanto, actualizar la `Login.aspx` página para incluir un vínculo a la `RecoverPassword.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="f85c3-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>


### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="f85c3-218">Mediante programación al restablecer una contraseña de usuario</span><span class="sxs-lookup"><span data-stu-id="f85c3-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="f85c3-219">Cuando el restablecimiento de contraseña de un usuario la PasswordRecovery control llama a la `MembershipUser` del objeto [ `ResetPassword` método](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="f85c3-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="f85c3-220">Este método tiene dos sobrecargas:</span><span class="sxs-lookup"><span data-stu-id="f85c3-220">This method has two overloads:</span></span>

- <span data-ttu-id="f85c3-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** -restablece una contraseña de usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="f85c3-222">Utilice esta sobrecarga si `RequiresQuestionAndAnswer` es False.</span><span class="sxs-lookup"><span data-stu-id="f85c3-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="f85c3-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** -Restablece solo si de contraseña de un usuario proporcionado *securityAnswer* es correcta.</span><span class="sxs-lookup"><span data-stu-id="f85c3-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="f85c3-224">Utilice esta sobrecarga si `RequiresQuestionAndAnswer` es True.</span><span class="sxs-lookup"><span data-stu-id="f85c3-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="f85c3-225">Ambas sobrecargas devuelven la nueva contraseña generada de forma aleatoria.</span><span class="sxs-lookup"><span data-stu-id="f85c3-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="f85c3-226">Al igual que con los otros métodos en el marco de pertenencia, el `ResetPassword` método delega en el proveedor configurado.</span><span class="sxs-lookup"><span data-stu-id="f85c3-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="f85c3-227">El `SqlMembershipProvider` invoca el `aspnet_Membership_ResetPassword` procedimiento almacenado, pasando en el nombre de usuario, la nueva contraseña y la respuesta de contraseña proporcionada, entre otros campos.</span><span class="sxs-lookup"><span data-stu-id="f85c3-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="f85c3-228">El procedimiento almacenado garantiza que la respuesta de contraseña coincide con y, a continuación, actualiza la contraseña del usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="f85c3-229">Un par de notas de la implementación de bajo nivel:</span><span class="sxs-lookup"><span data-stu-id="f85c3-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="f85c3-230">Un usuario bloqueado no puede restablecer su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="f85c3-231">Sin embargo, es posible que un usuario no aprobado.</span><span class="sxs-lookup"><span data-stu-id="f85c3-231">However, an unapproved user may.</span></span> <span data-ttu-id="f85c3-232">Se tratará la bloqueado y aprobado con más detalle en los Estados del <a id="_msoanchor_3"> </a> [ *Unlocking y aprobación de usuario* ](unlocking-and-approving-user-accounts-cs.md) tutorial de cuentas.</span><span class="sxs-lookup"><span data-stu-id="f85c3-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-cs.md) Accounts tutorial.</span></span>
- <span data-ttu-id="f85c3-233">Si la respuesta de contraseña es incorrecta, se incrementa la cantidad de intentos de respuesta de contraseña del usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="f85c3-234">Si se produce un número especificado de intentos de respuesta de seguridad no válido dentro de un período de tiempo especificado, el usuario está bloqueado.</span><span class="sxs-lookup"><span data-stu-id="f85c3-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="f85c3-235">Se generan una palabra en cómo las contraseñas aleatorias</span><span class="sxs-lookup"><span data-stu-id="f85c3-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="f85c3-236">Las contraseñas generado aleatoriamente que se muestra en los mensajes de correo electrónico en las figuras 4 y 5 se crean mediante la clase de pertenencia [ `GeneratePassword` método](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="f85c3-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="f85c3-237">Este método acepta dos parámetros de entrada entero - *longitud* y *numberOfNonAlphanumericCharacters* - y devuelve una cadena al menos *longitud* largo con los caracteres en menos *numberOfNonAlphanumericCharacters* número de caracteres no alfanuméricos.</span><span class="sxs-lookup"><span data-stu-id="f85c3-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="f85c3-238">Cuando este método se llama desde dentro de las clases de pertenencia o los controles Web relacionados con el inicio de sesión, los valores para estos dos parámetros se determinan mediante la configuración de pertenencia `MinRequiredPasswordLength` y `MinRequiredNonalphanumericCharacters` propiedades, que se establecen en 7 y 1, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="f85c3-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="f85c3-239">El `GeneratePassword` método utiliza un generador de números aleatorios criptográficamente seguro para asegurarse de que no hay ninguna diferencia en los caracteres aleatorios se seleccionan.</span><span class="sxs-lookup"><span data-stu-id="f85c3-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="f85c3-240">Además, `GeneratePassword` es `public`, lo que significa que se puede utilizar directamente desde la aplicación de ASP.NET si tiene que generar cadenas aleatorias o contraseñas.</span><span class="sxs-lookup"><span data-stu-id="f85c3-240">Furthermore, `GeneratePassword` is `public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="f85c3-241">El `SqlMembershipProvider` clase siempre genera una contraseña aleatoria al menos 14 caracteres, por lo que si `MinRequiredPasswordLength` es inferior a 14, a continuación, se omite su valor.</span><span class="sxs-lookup"><span data-stu-id="f85c3-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>


## <a name="step-2-changing-passwords"></a><span data-ttu-id="f85c3-242">Paso 2: Cambio de contraseñas</span><span class="sxs-lookup"><span data-stu-id="f85c3-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="f85c3-243">Son difíciles de recordar las contraseñas generada aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="f85c3-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="f85c3-244">Tenga en cuenta la contraseña que se muestra en la figura 4: `WWGUZv(f2yM:Bd`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="f85c3-245">Pruebe confirmar en memoria.</span><span class="sxs-lookup"><span data-stu-id="f85c3-245">Try committing that to memory!</span></span> <span data-ttu-id="f85c3-246">Huelga decir, cuando un usuario se envía una contraseña generada de forma aleatoria de este tipo, ella quiera cambiar la contraseña a algo más fácil de recordar.</span><span class="sxs-lookup"><span data-stu-id="f85c3-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="f85c3-247">Utilice el control ChangePassword para crear una interfaz para un usuario que cambie su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="f85c3-248">Muy similar al control PasswordRecovery, el control ChangePassword consta de dos vistas: Cambiar la contraseña y el éxito.</span><span class="sxs-lookup"><span data-stu-id="f85c3-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="f85c3-249">La vista Cambiar contraseña solicita al usuario sus contraseñas antiguas y nuevas.</span><span class="sxs-lookup"><span data-stu-id="f85c3-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="f85c3-250">Tras proporcionar la contraseña antigua correcta y una nueva contraseña que cumpla los requisitos de caracteres no alfanuméricos y la longitud mínima, el control ChangePassword actualiza la contraseña del usuario y muestra la vista correcto.</span><span class="sxs-lookup"><span data-stu-id="f85c3-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="f85c3-251">El control ChangePassword modifica la contraseña del usuario mediante la invocación del `MembershipUser` del objeto [ `ChangePassword` método](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="f85c3-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="f85c3-252">El método ChangePassword acepta dos `string` de entrada de los parámetros - *oldPassword* y *newPassword*- y actualiza la cuenta de usuario con el *newPassword*, Suponiendo que el proporcionado *oldPassword* es correcta.</span><span class="sxs-lookup"><span data-stu-id="f85c3-252">The ChangePassword method accepts two `string` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>


<span data-ttu-id="f85c3-253">Abra el `ChangePassword.aspx` página y agregue un control ChangePassword a la página, asígnele el nombre `ChangePwd`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="f85c3-254">En este momento, la vista de diseño debe mostrar el cambio de contraseña ver (consulte la figura 6).</span><span class="sxs-lookup"><span data-stu-id="f85c3-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="f85c3-255">Al igual que con el control PasswordRecovery, puede alternar entre las vistas a través de la etiqueta inteligente del control.</span><span class="sxs-lookup"><span data-stu-id="f85c3-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="f85c3-256">Además, las apariencias de estas vistas son personalizables a través de las propiedades de estilo diversas o mediante su conversión a una plantilla.</span><span class="sxs-lookup"><span data-stu-id="f85c3-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>


[![A<span data-ttu-id="f85c3-257">un ChangePassword Control a la página dd]</span><span class="sxs-lookup"><span data-stu-id="f85c3-257">dd a ChangePassword Control to the Page]</span></span>(recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)

<span data-ttu-id="f85c3-258">**Figura 6**: Agregar un ChangePassword Control a la página ([haga clic aquí para ver imagen en tamaño completo](recovering-and-changing-passwords-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="f85c3-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image18.png))</span></span>


<span data-ttu-id="f85c3-259">El control ChangePassword puede actualizar la contraseña del usuario con sesión iniciada actualmente *o* la contraseña de otro usuario especificado.</span><span class="sxs-lookup"><span data-stu-id="f85c3-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="f85c3-260">Como se muestra en la figura 6, la vista Cambiar contraseña predeterminada representa sólo tres controles de cuadro de texto: uno para la contraseña anterior y dos para la nueva contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="f85c3-261">Esta interfaz predeterminada se utiliza para actualizar la contraseña del usuario ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="f85c3-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="f85c3-262">Para usar el control ChangePassword para actualizar la contraseña de otro usuario, establezca el control [ `DisplayUserName` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) en True.</span><span class="sxs-lookup"><span data-stu-id="f85c3-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="f85c3-263">Si lo hace, agrega un cuarto cuadro de texto a la página, que se solicite el nombre de usuario del usuario cuya contraseña para cambiar.</span><span class="sxs-lookup"><span data-stu-id="f85c3-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="f85c3-264">Establecer `DisplayUserName` a True es útil si desea permitir que los usuarios registrados a cambiar su contraseña sin tener que iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="f85c3-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="f85c3-265">Personalmente, creo que no hay nada de malo obligar al usuario al inicio de sesión antes de permitir que ella cambiar su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="f85c3-266">Por lo tanto, deje `DisplayUserName` establecida en False (su valor predeterminado).</span><span class="sxs-lookup"><span data-stu-id="f85c3-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="f85c3-267">Para tomar esta decisión, sin embargo, nos básicamente estamos salvo los usuarios anónimos de llegar a esta página.</span><span class="sxs-lookup"><span data-stu-id="f85c3-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="f85c3-268">Actualizar reglas de autorización de dirección URL del sitio con el fin de impedir que los usuarios anónimos visite `ChangePassword.aspx`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="f85c3-269">Si necesita actualizar la memoria en la sintaxis de regla de autorización de URL, vuelva a consultar el <a id="_msoanchor_4"> </a> [ *autorización basada en usuario* ](../membership/user-based-authorization-cs.md) tutorial.</span><span class="sxs-lookup"><span data-stu-id="f85c3-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="f85c3-270">Puede parecer que el `DisplayUserName` propiedad resulta útil para permitir que los administradores cambiar las contraseñas de otros usuarios.</span><span class="sxs-lookup"><span data-stu-id="f85c3-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="f85c3-271">Sin embargo, incluso cuando `DisplayUserName` está establecido en True, la contraseña antigua correcta debe sabe y escribirse.</span><span class="sxs-lookup"><span data-stu-id="f85c3-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="f85c3-272">Hablaremos sobre las técnicas para permitir que los administradores cambiar las contraseñas de usuario en el paso 3.</span><span class="sxs-lookup"><span data-stu-id="f85c3-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>


<span data-ttu-id="f85c3-273">Visite el `ChangePassword.aspx` página a través de un explorador y cambie su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="f85c3-274">Tenga en cuenta que se muestra un mensaje de error si escribe una nueva contraseña que no cumple la longitud de contraseña y los requisitos de caracteres no alfanuméricos especificados en la configuración de pertenencia (consulte la figura 7).</span><span class="sxs-lookup"><span data-stu-id="f85c3-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>


[![A<span data-ttu-id="f85c3-275">un ChangePassword Control a la página dd]</span><span class="sxs-lookup"><span data-stu-id="f85c3-275">dd a ChangePassword Control to the Page]</span></span>(recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)

<span data-ttu-id="f85c3-276">**Figura 7**: Agregar un ChangePassword Control a la página ([haga clic aquí para ver imagen en tamaño completo](recovering-and-changing-passwords-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="f85c3-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image21.png))</span></span>


<span data-ttu-id="f85c3-277">Después de escribir la contraseña antigua correcta y una contraseña nueva válida, el inicio de sesión del usuario de contraseña se cambia y muestra la vista correcto.</span><span class="sxs-lookup"><span data-stu-id="f85c3-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="f85c3-278">Enviar un correo electrónico de confirmación</span><span class="sxs-lookup"><span data-stu-id="f85c3-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="f85c3-279">De forma predeterminada, el control ChangePassword no envía un mensaje de correo electrónico al usuario cuya contraseña se actualizó recientemente.</span><span class="sxs-lookup"><span data-stu-id="f85c3-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="f85c3-280">Si desea enviar un correo electrónico, basta con configurar el control `MailDefinition` propiedad.</span><span class="sxs-lookup"><span data-stu-id="f85c3-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="f85c3-281">Vamos a configurar el control ChangePassword para que se envíe un correo electrónico con formato HTML que contiene la nueva contraseña al usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="f85c3-282">Empiece por crear un nuevo archivo en el `EmailTemplates` carpeta denominada `ChangePassword.htm`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="f85c3-283">Agregue el siguiente marcado:</span><span class="sxs-lookup"><span data-stu-id="f85c3-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-cs/samples/sample4.html)]

<span data-ttu-id="f85c3-284">A continuación, establezca el control ChangePassword `MailDefinition` la propiedad `BodyFileName`, `IsBodyHtml`, y `Subject` propiedades en ~ / EmailTemplates/ChangePassword.htm, True y la contraseña ha cambiado!, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="f85c3-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="f85c3-285">Después de realizar estos cambios, volver a visitar la página y volver a cambiar su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="f85c3-286">Esta vez, el control ChangePassword envía un correo electrónico personalizado, con formato HTML a la dirección de correo electrónico del usuario en el archivo (consulte la figura 8).</span><span class="sxs-lookup"><span data-stu-id="f85c3-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>


[![A<span data-ttu-id="f85c3-287">n mensaje de correo electrónico informa de que ha cambiado la contraseña del usuario que sus]</span><span class="sxs-lookup"><span data-stu-id="f85c3-287">n Email Message Informs the User That Their Password has Changed]</span></span>(recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)

<span data-ttu-id="f85c3-288">**Figura 8**: Un mensaje de correo electrónico que informa de que ha cambiado la contraseña del usuario que sus ([haga clic aquí para ver imagen en tamaño completo](recovering-and-changing-passwords-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="f85c3-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image24.png))</span></span>


## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="f85c3-289">Paso 3: Permitir que los administradores cambiar las contraseñas de usuario</span><span class="sxs-lookup"><span data-stu-id="f85c3-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="f85c3-290">Una característica común en aplicaciones que admiten las cuentas de usuario es la capacidad para un usuario administrativo cambiar las contraseñas de otros usuarios.</span><span class="sxs-lookup"><span data-stu-id="f85c3-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="f85c3-291">A veces, esta funcionalidad es necesaria porque el sistema no tiene la posibilidad de que los usuarios cambien sus contraseñas.</span><span class="sxs-lookup"><span data-stu-id="f85c3-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="f85c3-292">En tal caso, la única forma de un usuario para recuperar su contraseña olvidada sería el administrador les asigne una nueva contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="f85c3-293">Con los controles PasswordRecovery y ChangePassword, sin embargo, los usuarios administrativos necesitan no ocupado a sí mismos con el cambio de contraseñas de usuarios, como los usuarios son capaces de hacer este a sí mismos.</span><span class="sxs-lookup"><span data-stu-id="f85c3-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="f85c3-294">Pero ¿qué ocurre si el cliente insiste en que los usuarios administrativos puedan cambiar las contraseñas de otros usuarios?</span><span class="sxs-lookup"><span data-stu-id="f85c3-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="f85c3-295">Por desgracia, al agregar esta funcionalidad puede ser un poco de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f85c3-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="f85c3-296">Para cambiar la contraseña de un usuario, se debe proporcionar la contraseña antigua y nueva a la `MembershipUser` del objeto `ChangePassword` método, pero un administrador no debería tener que conocer la contraseña de un usuario para modificarlo.</span><span class="sxs-lookup"><span data-stu-id="f85c3-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="f85c3-297">Una solución alternativa es primero restablecer la contraseña del usuario y, a continuación, cámbielo a la nueva contraseña mediante código similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="f85c3-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample5.aspx)]

<span data-ttu-id="f85c3-298">Este código se inicia mediante la recuperación de información sobre *username*, que es el usuario cuya contraseña desea cambiar el administrador.</span><span class="sxs-lookup"><span data-stu-id="f85c3-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="f85c3-299">A continuación, el `ResetPassword` se invoca al método, que asigna y el usuario una nueva contraseña aleatoria.</span><span class="sxs-lookup"><span data-stu-id="f85c3-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="f85c3-300">Esta contraseña generada de forma aleatoria es devuelto por el método y se almacena en la variable `resetPwd`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="f85c3-301">Ahora que sabemos que la contraseña del usuario, se puede cambiar mediante una llamada a `ChangePassword`.</span><span class="sxs-lookup"><span data-stu-id="f85c3-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="f85c3-302">El problema es que este código sólo funciona si se establece la configuración del sistema de pertenencia que `RequiresQuestionAndAnswer` es False.</span><span class="sxs-lookup"><span data-stu-id="f85c3-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="f85c3-303">Si `RequiresQuestionAndAnswer` es True, como sucede con nuestra aplicación, el `ResetPassword` método debe pasarse a la respuesta de seguridad, en caso contrario producirá una excepción.</span><span class="sxs-lookup"><span data-stu-id="f85c3-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="f85c3-304">Si el marco de pertenencia está configurado para solicitar una pregunta de seguridad y respuesta, y aún su cliente insiste en que los administradores podrán cambiar las contraseñas de usuario, tiene tres opciones:</span><span class="sxs-lookup"><span data-stu-id="f85c3-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="f85c3-305">Iniciar las manos en el aire y saber que el cliente que esto es solo una cosa que no se puede realizar.</span><span class="sxs-lookup"><span data-stu-id="f85c3-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="f85c3-306">Establecer `RequiresQuestionAndAnswer` en False.</span><span class="sxs-lookup"><span data-stu-id="f85c3-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="f85c3-307">Esto da como resultado una aplicación menos segura.</span><span class="sxs-lookup"><span data-stu-id="f85c3-307">This results in a less secure application.</span></span> <span data-ttu-id="f85c3-308">Imagine que un usuario viles haya obtenido acceso a la Bandeja de entrada de correo electrónico a otro usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="f85c3-309">Quizás el usuario en peligro ha dejado sus puestos de trabajo para ir a comer y no bloquea su estación de trabajo, o quizás tiene acceso a su correo electrónico desde un terminal público y no cierre la sesión. En cualquier caso, el usuario viles puede visitar el `RecoverPassword.aspx` página y escriba el nombre de usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="f85c3-310">El sistema, a continuación, enviaremos por correo electrónico la contraseña recuperada sin pedir la respuesta de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f85c3-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="f85c3-311">Omitir la capa de abstracción creada por el marco de pertenencia y trabajar directamente con la base de datos de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f85c3-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="f85c3-312">El esquema de pertenencia incluye un procedimiento almacenado denominado `aspnet_Membership_SetPassword` que establece una contraseña de usuario y no requiere la respuesta de seguridad o la contraseña antigua para realizar su tarea.</span><span class="sxs-lookup"><span data-stu-id="f85c3-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="f85c3-313">Ninguna de estas opciones son especialmente atractiva, pero es cómo va a veces la vida de un desarrollador.</span><span class="sxs-lookup"><span data-stu-id="f85c3-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="f85c3-314">Fui con antelación e implementa el tercer enfoque, escribir código que omite el `Membership` y `MembershipUser` clases y opera directamente el `SecurityTutorials` base de datos.</span><span class="sxs-lookup"><span data-stu-id="f85c3-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="f85c3-315">Cuando se trabaja directamente con la base de datos, se daña la encapsulación proporcionada por el marco de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="f85c3-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="f85c3-316">Esta decisión nos vincula el `SqlMembershipProvider`, por lo que nuestro código menos portable.</span><span class="sxs-lookup"><span data-stu-id="f85c3-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="f85c3-317">Además, este código puede no funcionar según lo previsto en futuras versiones de ASP.NET si cambia el esquema de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="f85c3-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="f85c3-318">Este enfoque es una solución alternativa y, al igual que la mayoría de las soluciones alternativas, no es un ejemplo de procedimientos recomendados.</span><span class="sxs-lookup"><span data-stu-id="f85c3-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>


<span data-ttu-id="f85c3-319">El código tiene algunos bits poco atractivo y es bastante largo.</span><span class="sxs-lookup"><span data-stu-id="f85c3-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="f85c3-320">Por lo tanto, no quiero provocar un desorden en este tutorial con un estudio detallado del mismo.</span><span class="sxs-lookup"><span data-stu-id="f85c3-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="f85c3-321">Si está interesado en obtener más información, descargue el código para este tutorial y visite el `~/Administration/ManageUsers.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="f85c3-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="f85c3-322">Esta página, que hemos creado en el <a id="_msoanchor_5"> </a> [tutorial anterior](building-an-interface-to-select-one-user-account-from-many-cs.md), enumera cada usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-cs.md), lists each user.</span></span> <span data-ttu-id="f85c3-323">He actualizado el control GridView para incluir un vínculo a la `UserInformation.aspx` página, pasando el nombre de usuario del usuario seleccionado a través de la cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="f85c3-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="f85c3-324">El `UserInformation.aspx` página muestra información sobre el usuario seleccionado y los cuadros de texto para cambiar su contraseña (consulte la figura 9).</span><span class="sxs-lookup"><span data-stu-id="f85c3-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="f85c3-325">Después de escribir la nueva contraseña, que se confirma en el segundo cuadro de texto y, al hacer clic en el botón de actualización de usuario, una devolución de datos que habrá trastornos y `aspnet_Membership_SetPassword` se invoca el procedimiento almacenado, actualizar la contraseña del usuario.</span><span class="sxs-lookup"><span data-stu-id="f85c3-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="f85c3-326">Lo animo a aquellos lectores interesados en esta funcionalidad esté más familiarizados con el código y vuelva a extender la funcionalidad para incluir enviar un correo electrónico al usuario cuya contraseña se cambió.</span><span class="sxs-lookup"><span data-stu-id="f85c3-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>


[![A<span data-ttu-id="f85c3-327">n administrador puede cambiar una contraseña de usuario]</span><span class="sxs-lookup"><span data-stu-id="f85c3-327">n Administrator May Change a User's Password]</span></span>(recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)

<span data-ttu-id="f85c3-328">**Figura 9**: Un administrador puede cambiar la contraseña de un usuario ([haga clic aquí para ver imagen en tamaño completo](recovering-and-changing-passwords-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="f85c3-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image27.png))</span></span>


> [!NOTE]
> <span data-ttu-id="f85c3-329">El `UserInformation.aspx` página actualmente solo funciona si el marco de pertenencia está configurado para almacenar contraseñas en formato cifrado o Hashed.</span><span class="sxs-lookup"><span data-stu-id="f85c3-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="f85c3-330">Contiene el código para cifrar la contraseña nueva, aunque lo invitamos a agregar esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="f85c3-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="f85c3-331">Es la manera en que recomienda agregar el código necesario con un descompilador como [Reflector](http://www.aisto.com/roeder/dotnet/) para examinar el código fuente para los métodos de .NET Framework; comenzar examinando la `SqlMembershipProvider` la clase `ChangePassword` método.</span><span class="sxs-lookup"><span data-stu-id="f85c3-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="f85c3-332">Ésta es la técnica que usa para escribir el código para crear un hash de la contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-332">This is the technique I used to write the code for creating a hash of the password.</span></span>


## <a name="summary"></a><span data-ttu-id="f85c3-333">Resumen</span><span class="sxs-lookup"><span data-stu-id="f85c3-333">Summary</span></span>

<span data-ttu-id="f85c3-334">ASP.NET ofrece dos controles para ayudar a los usuarios a administrar su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="f85c3-335">El control PasswordRecovery es útil para aquellos que han olvidado su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="f85c3-336">Según la configuración del marco de pertenencia, el usuario se envía o su contraseña existente o una nueva contraseña generada de forma aleatoria.</span><span class="sxs-lookup"><span data-stu-id="f85c3-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="f85c3-337">El control ChangePassword permite que un usuario actualice su contraseña.</span><span class="sxs-lookup"><span data-stu-id="f85c3-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="f85c3-338">Al igual que los controles de inicio de sesión y CreateUserWizard, los controles PasswordRecovery y ChangePassword representan una interfaz de usuario enriquecida sin tener que escribir ni una pizca de marcado declarativo o línea de código.</span><span class="sxs-lookup"><span data-stu-id="f85c3-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="f85c3-339">Si la interfaz de usuario predeterminada no satisface sus necesidades, puede personalizarlo a través de una serie de propiedades de estilo.</span><span class="sxs-lookup"><span data-stu-id="f85c3-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="f85c3-340">Como alternativa, las interfaces de los controles se pueden convertir en plantillas, para un grado de control más fino si cabe.</span><span class="sxs-lookup"><span data-stu-id="f85c3-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="f85c3-341">En segundo plano estos controles usa la API de pertenencia, invocar el `MembershipUser` del objeto `ResetPassword` y `ChangePassword` métodos.</span><span class="sxs-lookup"><span data-stu-id="f85c3-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="f85c3-342">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="f85c3-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="f85c3-343">Información adicional</span><span class="sxs-lookup"><span data-stu-id="f85c3-343">Further Reading</span></span>

<span data-ttu-id="f85c3-344">Para obtener más información sobre los temas tratados en este tutorial, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="f85c3-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="f85c3-345">Control ChangePassword guías de inicio rápido</span><span class="sxs-lookup"><span data-stu-id="f85c3-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="f85c3-346">Control PasswordRecovery guías de inicio rápido</span><span class="sxs-lookup"><span data-stu-id="f85c3-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="f85c3-347">Envío de correo electrónico en ASP.NET</span><span class="sxs-lookup"><span data-stu-id="f85c3-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [`System.Net.Mail` <span data-ttu-id="f85c3-348">P+F</span><span class="sxs-lookup"><span data-stu-id="f85c3-348">FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="f85c3-349">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="f85c3-349">About the Author</span></span>

<span data-ttu-id="f85c3-350">Scott Mitchell, autor de varios libros sobre ASP/ASP.NET y fundador de 4GuysFromRolla.com, ha estado trabajando con tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="f85c3-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f85c3-351">Scott trabaja como consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="f85c3-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f85c3-352">Su último libro es *[SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="f85c3-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="f85c3-353">Puede ponerse en contacto Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) o a través de su blog en [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="f85c3-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="f85c3-354">Agradecimientos especiales a</span><span class="sxs-lookup"><span data-stu-id="f85c3-354">Special Thanks To</span></span>

<span data-ttu-id="f85c3-355">Esta serie de tutoriales ha sido revisada por muchos revisores útiles.</span><span class="sxs-lookup"><span data-stu-id="f85c3-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="f85c3-356">Los revisores para este tutorial incluyen Michael Emmings y Suchi Banerjee.</span><span class="sxs-lookup"><span data-stu-id="f85c3-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="f85c3-357">¿Está interesado en leer mi próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="f85c3-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="f85c3-358">Si es así, envíeme una línea en [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f85c3-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f85c3-359">[Anterior](building-an-interface-to-select-one-user-account-from-many-cs.md)
> [Siguiente](unlocking-and-approving-user-accounts-cs.md)</span><span class="sxs-lookup"><span data-stu-id="f85c3-359">[Previous](building-an-interface-to-select-one-user-account-from-many-cs.md)
[Next](unlocking-and-approving-user-accounts-cs.md)</span></span>
