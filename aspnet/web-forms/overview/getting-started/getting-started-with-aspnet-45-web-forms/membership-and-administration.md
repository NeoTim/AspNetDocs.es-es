---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
title: Pertenencia y administración | Microsoft Docs
author: Erikre
description: Esta serie de tutoriales le enseñará los aspectos básicos de la creación de una aplicación de formularios Web Forms ASP.NET con ASP.NET 4,5 y Microsoft Visual Studio Express 2013 para nosotros...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 732a2316-e49f-4f72-becd-0cd72f14457e
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
msc.type: authoredcontent
ms.openlocfilehash: ab00bc90bfc767d06e747be6dfb973245b5aae88
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78439933"
---
# <a name="membership-and-administration"></a><span data-ttu-id="a5a80-103">Pertenencia y administración</span><span class="sxs-lookup"><span data-stu-id="a5a80-103">Membership and Administration</span></span>

<span data-ttu-id="a5a80-104">por [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="a5a80-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="a5a80-105">[Descargar el proyecto de ejemplo deC#Wingtip Toys ()](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) o [descargar el libro electrónico (pdf)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="a5a80-105">[Download Wingtip Toys Sample Project (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="a5a80-106">Esta serie de tutoriales le enseñará los aspectos básicos de la creación de una aplicación de formularios Web Forms ASP.NET con ASP.NET 4,5 y Microsoft Visual Studio Express 2013 para Web.</span><span class="sxs-lookup"><span data-stu-id="a5a80-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="a5a80-107">Hay disponible un [proyecto C# de Visual Studio 2013 con código fuente](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) para acompañar esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="a5a80-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>

<span data-ttu-id="a5a80-108">En este tutorial se muestra cómo actualizar la aplicación de ejemplo Wingtip Toys para agregar un rol personalizado y usar ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="a5a80-108">This tutorial shows you how to update the Wingtip Toys sample application to add a custom role and use ASP.NET Identity.</span></span> <span data-ttu-id="a5a80-109">También muestra cómo implementar una página de administración desde la que el usuario con un rol personalizado puede Agregar y quitar productos del sitio Web.</span><span class="sxs-lookup"><span data-stu-id="a5a80-109">It also shows you how to implement an administration page from which the user with a custom role can add and remove products from the website.</span></span>

<span data-ttu-id="a5a80-110">[ASP.net Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) es el sistema de pertenencia que se usa para compilar la aplicación Web ASP.net y está disponible en ASP.net 4,5.</span><span class="sxs-lookup"><span data-stu-id="a5a80-110">[ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) is the membership system used to build ASP.NET web application and is available in ASP.NET 4.5.</span></span> <span data-ttu-id="a5a80-111">ASP.NET Identity se usa en la plantilla de proyecto Visual Studio 2013 Web Forms, así como las plantillas para la [aplicación de una sola página](../../../../single-page-application/index.md)de [ASP.NET MVC](../../../../mvc/index.md), [ASP.net web API](../../../../web-api/index.md)y ASP.net.</span><span class="sxs-lookup"><span data-stu-id="a5a80-111">ASP.NET Identity is used in the Visual Studio 2013 Web Forms project template, as well as the templates for [ASP.NET MVC](../../../../mvc/index.md), [ASP.NET Web API](../../../../web-api/index.md), and [ASP.NET Single Page Application](../../../../single-page-application/index.md).</span></span> <span data-ttu-id="a5a80-112">También puede instalar específicamente el sistema ASP.NET Identity mediante NuGet cuando empiece con una aplicación Web vacía.</span><span class="sxs-lookup"><span data-stu-id="a5a80-112">You can also specifically install the ASP.NET Identity system using NuGet when you start with an empty Web application.</span></span> <span data-ttu-id="a5a80-113">Sin embargo, en esta serie de tutoriales, se usa el projecttemplate de **formularios Web Forms**, que incluye el sistema ASP.net Identity.</span><span class="sxs-lookup"><span data-stu-id="a5a80-113">However, in this tutorial series you use the **Web Forms**projecttemplate, which includes the ASP.NET Identity system.</span></span> <span data-ttu-id="a5a80-114">ASP.NET Identity facilita la integración de datos de perfil específicos del usuario con los datos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-114">ASP.NET Identity makes it easy to integrate user-specific profile data with application data.</span></span> <span data-ttu-id="a5a80-115">Además, ASP.NET Identity permite elegir el modelo de persistencia para perfiles de usuario en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-115">Also, ASP.NET Identity allows you to choose the persistence model for user profiles in your application.</span></span> <span data-ttu-id="a5a80-116">Puede almacenar los datos en una base de datos SQL Server u otro almacén de datos, incluidos los almacenes de datos *NoSQL* , como las tablas Azure Storage de Windows.</span><span class="sxs-lookup"><span data-stu-id="a5a80-116">You can store the data in a SQL Server database or another data store, including *NoSQL* data stores such as Windows Azure Storage Tables.</span></span>

<span data-ttu-id="a5a80-117">Este tutorial se basa en el tutorial anterior titulado "Checkout and Payment with PayPal" en la serie de tutoriales de Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="a5a80-117">This tutorial builds on the previous tutorial titled "Checkout and Payment with PayPal" in the Wingtip Toys tutorial series.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="a5a80-118">Temas que se abordarán:</span><span class="sxs-lookup"><span data-stu-id="a5a80-118">What you'll learn:</span></span>

- <span data-ttu-id="a5a80-119">Cómo usar el código para agregar un rol personalizado y un usuario a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-119">How to use code to add a custom role and a user to the application.</span></span>
- <span data-ttu-id="a5a80-120">Cómo restringir el acceso a la página y la carpeta de administración.</span><span class="sxs-lookup"><span data-stu-id="a5a80-120">How to restrict access to the administration folder and page.</span></span>
- <span data-ttu-id="a5a80-121">Cómo proporcionar la navegación para el usuario que pertenece al rol personalizado.</span><span class="sxs-lookup"><span data-stu-id="a5a80-121">How to provide navigation for the user that belongs to the custom role.</span></span>
- <span data-ttu-id="a5a80-122">Cómo usar el enlace de modelos para rellenar un control [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) con categorías de productos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-122">How to use model binding to populate a [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) control with product categories.</span></span>
- <span data-ttu-id="a5a80-123">Cómo cargar un archivo en la aplicación Web mediante el control [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="a5a80-123">How to upload a file to the web application using the [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) control.</span></span>
- <span data-ttu-id="a5a80-124">Cómo usar los controles de validación para implementar la validación de entrada.</span><span class="sxs-lookup"><span data-stu-id="a5a80-124">How to use validation controls to implement input validation.</span></span>
- <span data-ttu-id="a5a80-125">Cómo agregar y quitar productos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-125">How to add and remove products from the application.</span></span>

## <a name="these-features-are-included-in-the-tutorial"></a><span data-ttu-id="a5a80-126">Estas características se incluyen en el tutorial:</span><span class="sxs-lookup"><span data-stu-id="a5a80-126">These features are included in the tutorial:</span></span>

- <span data-ttu-id="a5a80-127">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="a5a80-127">ASP.NET Identity</span></span>
- <span data-ttu-id="a5a80-128">Configuración y autorización</span><span class="sxs-lookup"><span data-stu-id="a5a80-128">Configuration and Authorization</span></span>
- <span data-ttu-id="a5a80-129">Enlace de modelos</span><span class="sxs-lookup"><span data-stu-id="a5a80-129">Model Binding</span></span>
- <span data-ttu-id="a5a80-130">Validación discreta</span><span class="sxs-lookup"><span data-stu-id="a5a80-130">Unobtrusive Validation</span></span>

<span data-ttu-id="a5a80-131">Los formularios Web Forms de ASP.NET proporcionan funcionalidades de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="a5a80-131">ASP.NET Web Forms provides membership capabilities.</span></span> <span data-ttu-id="a5a80-132">Mediante el uso de la plantilla predeterminada, dispone de funcionalidad de pertenencia integrada que puede usar inmediatamente cuando se ejecuta la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-132">By using the default template, you have built-in membership functionality that you can immediately use when the application runs.</span></span> <span data-ttu-id="a5a80-133">En este tutorial se muestra cómo usar ASP.NET Identity para agregar un rol personalizado y asignar un usuario a ese rol.</span><span class="sxs-lookup"><span data-stu-id="a5a80-133">This tutorial shows you how to use ASP.NET Identity to add a custom role and assign a user to that role.</span></span> <span data-ttu-id="a5a80-134">Obtendrá información sobre cómo restringir el acceso a la carpeta de administración.</span><span class="sxs-lookup"><span data-stu-id="a5a80-134">You will learn how to restrict access to the administration folder.</span></span> <span data-ttu-id="a5a80-135">Agregará una página a la carpeta de administración que permite a un usuario con un rol personalizado agregar y quitar productos, así como obtener una vista previa de un producto una vez agregado.</span><span class="sxs-lookup"><span data-stu-id="a5a80-135">You'll add a page to the administration folder that allows a user with a custom role to add and remove products, and to preview a product after it has been added.</span></span>

## <a name="adding-a-custom-role"></a><span data-ttu-id="a5a80-136">Agregar un rol personalizado</span><span class="sxs-lookup"><span data-stu-id="a5a80-136">Adding a Custom Role</span></span>

<span data-ttu-id="a5a80-137">Con ASP.NET Identity, puede Agregar un rol personalizado y asignar un usuario a ese rol mediante código.</span><span class="sxs-lookup"><span data-stu-id="a5a80-137">Using ASP.NET Identity, you can add a custom role and assign a user to that role using code.</span></span>

1. <span data-ttu-id="a5a80-138">En **Explorador de soluciones**, haga clic con el botón derecho en la carpeta *lógica* y cree una nueva clase.</span><span class="sxs-lookup"><span data-stu-id="a5a80-138">In **Solution Explorer**, right-click on the *Logic* folder and create a new class.</span></span>
2. <span data-ttu-id="a5a80-139">Asigne a la nueva clase el nombre *RoleActions.CS*.</span><span class="sxs-lookup"><span data-stu-id="a5a80-139">Name the new class *RoleActions.cs*.</span></span>
3. <span data-ttu-id="a5a80-140">Modifique el código para que aparezca de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="a5a80-140">Modify the code so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample1.cs?highlight=8)]
4. <span data-ttu-id="a5a80-141">En **Explorador de soluciones**, abra el archivo *global.asax.CS* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-141">In **Solution Explorer**, open the *Global.asax.cs* file.</span></span>
5. <span data-ttu-id="a5a80-142">Modifique el archivo *global.asax.CS* agregando el código resaltado en amarillo para que aparezca de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="a5a80-142">Modify the *Global.asax.cs* file by adding the code highlighted in yellow so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample2.cs?highlight=11,26-28)]
6. <span data-ttu-id="a5a80-143">Observe que `AddUserAndRole` está subrayado en rojo.</span><span class="sxs-lookup"><span data-stu-id="a5a80-143">Notice that `AddUserAndRole` is underlined in red.</span></span> <span data-ttu-id="a5a80-144">Haga doble clic en el código AddUserAndRole.</span><span class="sxs-lookup"><span data-stu-id="a5a80-144">Double-click the AddUserAndRole code.</span></span>  
   <span data-ttu-id="a5a80-145">Se subrayará la letra "A" al principio del método resaltado.</span><span class="sxs-lookup"><span data-stu-id="a5a80-145">The letter "A" at the beginning of the highlighted method will be underlined.</span></span>
7. <span data-ttu-id="a5a80-146">Mantenga el mouse sobre la letra "A" y haga clic en la interfaz de usuario que le permite generar un código auxiliar de método para el método `AddUserAndRole`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-146">Hover over the letter "A" and click the UI that allows you to generate a method stub for the `AddUserAndRole` method.</span></span> 

    ![Pertenencia y administración: generar código auxiliar de método](membership-and-administration/_static/image1.png)
8. <span data-ttu-id="a5a80-148">Haga clic en la opción titulada:</span><span class="sxs-lookup"><span data-stu-id="a5a80-148">Click the option titled:</span></span>  
    `Generate method stub for "AddUserAndRole" in "WingtipToys.Logic.RoleActions"`
9. <span data-ttu-id="a5a80-149">Abra el archivo *RoleActions.CS* desde la carpeta *lógica* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-149">Open the *RoleActions.cs* file from the *Logic* folder.</span></span>  
   <span data-ttu-id="a5a80-150">El método de `AddUserAndRole` se ha agregado al archivo de clase.</span><span class="sxs-lookup"><span data-stu-id="a5a80-150">The `AddUserAndRole` method has been added to the class file.</span></span>
10. <span data-ttu-id="a5a80-151">Modifique el archivo *RoleActions.CS* quitando el `NotImplementedException` y agregando el código resaltado en amarillo para que aparezca de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="a5a80-151">Modify the *RoleActions.cs* file by removing the `NotImplementedException` and adding the code highlighted in yellow, so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample3.cs?highlight=5-7,15-51)]

<span data-ttu-id="a5a80-152">En primer lugar, el código anterior establece un contexto de base de datos para la base de datos de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="a5a80-152">The above code first establishes a database context for the membership database.</span></span> <span data-ttu-id="a5a80-153">La base de datos de pertenencia también se almacena como un archivo *. MDF* en la carpeta *App\_Data* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-153">The membership database is also stored as an *.mdf* file in the *App\_Data* folder.</span></span> <span data-ttu-id="a5a80-154">Podrá ver esta base de datos una vez que el primer usuario haya iniciado sesión en esta aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="a5a80-154">You will be able to view this database once the first user has signed in to this web application.</span></span> 

> [!NOTE] 
> 
> <span data-ttu-id="a5a80-155">Si desea almacenar los datos de pertenencia junto con los datos del producto, puede considerar la posibilidad de usar el mismo **DbContext** que usó para almacenar los datos del producto en el código anterior.</span><span class="sxs-lookup"><span data-stu-id="a5a80-155">If you wish to store the membership data along with the product data, you can consider using the same **DbContext** that you used to store the product data in the above code.</span></span>

 <span data-ttu-id="a5a80-156">La palabra clave *Internal* es un modificador de acceso para tipos (como clases) y miembros de tipo (como métodos o propiedades).</span><span class="sxs-lookup"><span data-stu-id="a5a80-156">The *internal* keyword is an access modifier for types (such as classes) and type members (such as methods or properties).</span></span> <span data-ttu-id="a5a80-157">Solo se puede tener acceso a los tipos o miembros internos en los archivos contenidos en el mismo ensamblado *(archivo. dll* ).</span><span class="sxs-lookup"><span data-stu-id="a5a80-157">Internal types or members are accessible only within files contained in the same assembly *(.dll* file).</span></span> <span data-ttu-id="a5a80-158">Al compilar la aplicación, se crea un archivo de ensamblado *(. dll*) que contiene el código que se ejecuta al ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-158">When you build your application, an assembly file *(.dll*) is created that contains the code that is executed when you run your application.</span></span> 

<span data-ttu-id="a5a80-159">Un objeto `RoleStore`, que proporciona la administración de roles, se crea basándose en el contexto de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-159">A `RoleStore` object, which provides role management, is created based on the database context.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="a5a80-160">Tenga en cuenta que cuando se crea el objeto de `RoleStore`, se usa un tipo de `IdentityRole` genérico.</span><span class="sxs-lookup"><span data-stu-id="a5a80-160">Notice that when the `RoleStore` object is created it uses a Generic `IdentityRole` type.</span></span> <span data-ttu-id="a5a80-161">Esto significa que el `RoleStore` solo puede contener objetos `IdentityRole`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-161">This means that the `RoleStore` is only allowed to contain `IdentityRole` objects.</span></span> <span data-ttu-id="a5a80-162">Además, mediante el uso de genéricos, los recursos de la memoria se administran mejor.</span><span class="sxs-lookup"><span data-stu-id="a5a80-162">Also by using Generics, resources in memory are handled better.</span></span>

<span data-ttu-id="a5a80-163">Después, el objeto de `RoleManager`, se crea basándose en el objeto `RoleStore` que acaba de crear.</span><span class="sxs-lookup"><span data-stu-id="a5a80-163">Next, the `RoleManager` object, is created based on the `RoleStore` object that you just created.</span></span> <span data-ttu-id="a5a80-164">el objeto `RoleManager` expone una API relacionada con el rol que se puede usar para guardar automáticamente los cambios en el `RoleStore`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-164">the `RoleManager` object exposes role related API which can be used to automatically save changes to the `RoleStore`.</span></span> <span data-ttu-id="a5a80-165">El `RoleManager` solo puede contener objetos `IdentityRole` porque el código utiliza el tipo genérico `<IdentityRole>`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-165">The `RoleManager` is only allowed to contain `IdentityRole` objects because the code uses the `<IdentityRole>` Generic type.</span></span>

<span data-ttu-id="a5a80-166">Llame al método `RoleExists` para determinar si el rol "canEdit" está presente en la base de datos de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="a5a80-166">You call the `RoleExists` method to determine if the "canEdit" role is present in the membership database.</span></span> <span data-ttu-id="a5a80-167">En caso contrario, se crea el rol.</span><span class="sxs-lookup"><span data-stu-id="a5a80-167">If it is not, you create the role.</span></span>

<span data-ttu-id="a5a80-168">La creación del objeto `UserManager` parece ser más complicada que el control `RoleManager`, pero es prácticamente igual.</span><span class="sxs-lookup"><span data-stu-id="a5a80-168">Creating the `UserManager` object appears to be more complicated than the `RoleManager` control, however it is nearly the same.</span></span> <span data-ttu-id="a5a80-169">Simplemente se codifica en una línea en lugar de en varias.</span><span class="sxs-lookup"><span data-stu-id="a5a80-169">It is just coded on one line rather than several.</span></span> <span data-ttu-id="a5a80-170">Aquí, el parámetro que está pasando crea instancias de como un nuevo objeto incluido en el paréntesis.</span><span class="sxs-lookup"><span data-stu-id="a5a80-170">Here, the parameter that you are passing is instantiating as a new object contained in the parenthesis.</span></span>

<span data-ttu-id="a5a80-171">A continuación, cree el usuario "canEditUser" mediante la creación de un nuevo objeto de `ApplicationUser`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-171">Next you create the "canEditUser" user by creating a new `ApplicationUser` object.</span></span> <span data-ttu-id="a5a80-172">A continuación, si crea correctamente el usuario, agregue el usuario al nuevo rol.</span><span class="sxs-lookup"><span data-stu-id="a5a80-172">Then, if you successfully create the user, you add the user to the new role.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="a5a80-173">El control de errores se actualizará durante el tutorial "control de errores de ASP.NET" más adelante en esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="a5a80-173">The error handling will be updated during the "ASP.NET Error Handling" tutorial later in this tutorial series.</span></span>

<span data-ttu-id="a5a80-174">La próxima vez que se inicie la aplicación, el usuario denominado "canEditUser" se agregará como el rol denominado "canEdit" de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-174">The next time the application starts, the user named "canEditUser" will be added as the role named "canEdit" of the application.</span></span> <span data-ttu-id="a5a80-175">Más adelante en este tutorial, iniciará sesión como el usuario "canEditUser" para mostrar las capacidades adicionales que agregará durante este tutorial.</span><span class="sxs-lookup"><span data-stu-id="a5a80-175">Later in this tutorial, you will login as the "canEditUser" user to display additional capabilities that you will added during this tutorial.</span></span> <span data-ttu-id="a5a80-176">Para obtener detalles de la API sobre ASP.NET Identity, vea el [espacio de nombres Microsoft. Aspnet. Identity](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="a5a80-176">For API details about ASP.NET Identity, see the [Microsoft.AspNet.Identity Namespace](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span></span> <span data-ttu-id="a5a80-177">Para obtener más información acerca de cómo inicializar el sistema ASP.NET Identity, vea [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span><span class="sxs-lookup"><span data-stu-id="a5a80-177">For additional details about initializing the ASP.NET Identity system, see the [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span></span>

### <a name="restricting-access-to-the-administration-page"></a><span data-ttu-id="a5a80-178">Restringir el acceso a la página de administración</span><span class="sxs-lookup"><span data-stu-id="a5a80-178">Restricting Access to the Administration Page</span></span>

<span data-ttu-id="a5a80-179">La aplicación de ejemplo Wingtip Toys permite que los usuarios anónimos y los usuarios que han iniciado sesión vean y compren productos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-179">The Wingtip Toys sample application allows both anonymous users and logged-in users to view and purchase products.</span></span> <span data-ttu-id="a5a80-180">Sin embargo, el usuario que ha iniciado sesión y que tiene el rol personalizado "canEdit" puede tener acceso a una página restringida para poder agregar y quitar productos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-180">However, the logged-in user that has the custom "canEdit" role can access a restricted page in order to add and remove products.</span></span>

#### <a name="add-an-administration-folder-and-page"></a><span data-ttu-id="a5a80-181">Agregar una página y una carpeta de administración</span><span class="sxs-lookup"><span data-stu-id="a5a80-181">Add an Administration Folder and Page</span></span>

<span data-ttu-id="a5a80-182">Después, creará una carpeta denominada *admin* para el usuario "canEditUser" que pertenece al rol personalizado de la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="a5a80-182">Next, you will create a folder named *Admin* for the "canEditUser" user belonging to the custom role of the Wingtip Toys sample application.</span></span>

1. <span data-ttu-id="a5a80-183">Haga clic con el botón derecho en el nombre del proyecto (**Wingtip Toys**) en **Explorador de soluciones** y seleccione **Agregar** -&gt; **nueva carpeta**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-183">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add** -&gt; **New Folder**.</span></span>
2. <span data-ttu-id="a5a80-184">Asigne un nombre a la nueva carpeta *admin*.</span><span class="sxs-lookup"><span data-stu-id="a5a80-184">Name the new folder *Admin*.</span></span>
3. <span data-ttu-id="a5a80-185">Haga clic con el botón secundario en la carpeta *admin* y seleccione **Agregar** -&gt; **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-185">Right-click the *Admin* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="a5a80-186">Se abrirá el cuadro de diálogo **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-186">The **Add New Item** dialog box is displayed.</span></span>
4. <span data-ttu-id="a5a80-187">Seleccione el grupo plantillas <strong>Web</strong> de <strong>Visual C#</strong> -&gt; a la izquierda.</span><span class="sxs-lookup"><span data-stu-id="a5a80-187">Select the <strong>Visual C#</strong>-&gt; <strong>Web</strong> templates group on the left.</span></span> <span data-ttu-id="a5a80-188">En la lista central, seleccione <strong>Web Forms con la página maestra</strong>, asígnele el nombre <em>AdminPage. aspx</em><strong>y, a continuación, seleccione</strong> <strong>Agregar</strong>.</span><span class="sxs-lookup"><span data-stu-id="a5a80-188">From the middle list, select <strong>Web Form with Master Page</strong>,name it <em>AdminPage.aspx</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
5. <span data-ttu-id="a5a80-189">Seleccione el archivo *site. Master* como la página maestra y, a continuación, elija **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-189">Select the *Site.Master* file as the master page, and then choose **OK**.</span></span>

#### <a name="add-a-webconfig-file"></a><span data-ttu-id="a5a80-190">Agregar un archivo Web. config</span><span class="sxs-lookup"><span data-stu-id="a5a80-190">Add a Web.config File</span></span>

<span data-ttu-id="a5a80-191">Al agregar un archivo *Web. config* a la carpeta *admin* , puede restringir el acceso a la página contenida en la carpeta.</span><span class="sxs-lookup"><span data-stu-id="a5a80-191">By adding a *Web.config* file to the *Admin* folder, you can restrict access to the page contained in the folder.</span></span>

1. <span data-ttu-id="a5a80-192">Haga clic con el botón secundario en la carpeta *admin* y seleccione **Agregar** -&gt; **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-192">Right-click the *Admin* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="a5a80-193">Se abrirá el cuadro de diálogo **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-193">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="a5a80-194">En la lista de plantillas C# web visuales, seleccione <strong>archivo de configuración Web</strong>en la lista central, acepte el nombre predeterminado de <em>Web. config</em><strong>y, a continuación, seleccione</strong> <strong>Agregar</strong>.</span><span class="sxs-lookup"><span data-stu-id="a5a80-194">From the list of Visual C# web templates, select <strong>Web Configuration File</strong>from the middle list, accept the default name of <em>Web.config</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
3. <span data-ttu-id="a5a80-195">Reemplace el contenido XML del archivo *Web.config* por el siguiente:</span><span class="sxs-lookup"><span data-stu-id="a5a80-195">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](membership-and-administration/samples/sample4.xml)]

<span data-ttu-id="a5a80-196">Guarde el archivo *Web.config* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-196">Save the *Web.config* file.</span></span> <span data-ttu-id="a5a80-197">El archivo *Web. config* especifica que solo el usuario que pertenece al rol "canEdit" de la aplicación puede tener acceso a la página contenida en la carpeta *admin* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-197">The *Web.config* file specifies that only user belonging to the "canEdit" role of the application can access the page contained in the *Admin* folder.</span></span>

### <a name="including-custom-role-navigation"></a><span data-ttu-id="a5a80-198">Incluir la navegación de roles personalizados</span><span class="sxs-lookup"><span data-stu-id="a5a80-198">Including Custom Role Navigation</span></span>

<span data-ttu-id="a5a80-199">Para permitir que el usuario del rol "canEdit" personalizado navegue hasta la sección de administración de la aplicación, debe agregar un vínculo a la página *site. Master* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-199">To enable the user of the custom "canEdit" role to navigate to the administration section of the application, you must add a link to the *Site.Master* page.</span></span> <span data-ttu-id="a5a80-200">Solo los usuarios que pertenecen al rol "canEdit" podrán ver el vínculo de **Administrador** y acceder a la sección de administración.</span><span class="sxs-lookup"><span data-stu-id="a5a80-200">Only users that belong to the "canEdit" role will be able to see the **Admin** link and access the administration section.</span></span>

1. <span data-ttu-id="a5a80-201">En Explorador de soluciones, busque y abra la página *site. Master* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-201">In Solution Explorer, find and open the *Site.Master* page.</span></span>
2. <span data-ttu-id="a5a80-202">Para crear un vínculo para el usuario con el rol "canEdit", agregue el marcado resaltado en amarillo al siguiente lista sin ordenar `<ul>` elemento de modo que la lista aparezca de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="a5a80-202">To create a link for the user of the "canEdit" role, add the markup highlighted in yellow to the following unordered list `<ul>` element so that the list appears as follows:</span></span>  

    [!code-html[Main](membership-and-administration/samples/sample5.html?highlight=2-3)]
3. <span data-ttu-id="a5a80-203">Abra el archivo *site.Master.CS* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-203">Open the *Site.Master.cs* file.</span></span> <span data-ttu-id="a5a80-204">Haga que el vínculo de **Administrador** solo sea visible para el usuario "canEditUser" agregando el código resaltado en amarillo al controlador de `Page_Load`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-204">Make the **Admin** link visible only to the "canEditUser" user by adding the code highlighted in yellow to the `Page_Load` handler.</span></span> <span data-ttu-id="a5a80-205">El controlador de `Page_Load` aparecerá de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="a5a80-205">The `Page_Load` handler will appear as follows:</span></span>   

    [!code-csharp[Main](membership-and-administration/samples/sample6.cs?highlight=3-6)]

<span data-ttu-id="a5a80-206">Cuando se carga la página, el código comprueba si el usuario que ha iniciado sesión tiene el rol "canEdit".</span><span class="sxs-lookup"><span data-stu-id="a5a80-206">When the page loads, the code checks whether the logged-in user has the role of "canEdit".</span></span> <span data-ttu-id="a5a80-207">Si el usuario pertenece al rol "canEdit", el elemento span que contiene el vínculo a la página *AdminPage. aspx* (y, por consiguiente, el vínculo dentro del intervalo) se hace visible.</span><span class="sxs-lookup"><span data-stu-id="a5a80-207">If the user belongs to the "canEdit" role, the span element containing the link to the *AdminPage.aspx* page (and consequently the link inside the span) is made visible.</span></span>

### <a name="enabling-product-administration"></a><span data-ttu-id="a5a80-208">Habilitar la administración de productos</span><span class="sxs-lookup"><span data-stu-id="a5a80-208">Enabling Product Administration</span></span>

<span data-ttu-id="a5a80-209">Hasta ahora, ha creado el rol "canEdit" y ha agregado un usuario "canEditUser", una carpeta de administración y una página de administración.</span><span class="sxs-lookup"><span data-stu-id="a5a80-209">So far, you have created the "canEdit" role and added an "canEditUser" user, an administration folder, and an administration page.</span></span> <span data-ttu-id="a5a80-210">Ha establecido derechos de acceso para la página y la carpeta de administración, y ha agregado un vínculo de navegación para el usuario del rol "canEdit" a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-210">You have set access rights for the administration folder and page, and have added a navigation link for the user of the "canEdit" role to the application.</span></span> <span data-ttu-id="a5a80-211">A continuación, agregará marcado a la página *AdminPage. aspx* y el código al archivo de código subyacente *AdminPage.aspx.CS* que permitirá al usuario con el rol "canEdit" agregar y quitar productos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-211">Next, you will add markup to the *AdminPage.aspx* page and code to the *AdminPage.aspx.cs* code-behind file that will enable the user with the "canEdit" role to add and remove products.</span></span>

1. <span data-ttu-id="a5a80-212">En **Explorador de soluciones**, abra el archivo *AdminPage. aspx* de la carpeta *admin* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-212">In **Solution Explorer**, open the *AdminPage.aspx* file from the *Admin* folder.</span></span>
2. <span data-ttu-id="a5a80-213">Reemplace el marcado existente por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="a5a80-213">Replace the existing markup with the following:</span></span>  

    [!code-aspx[Main](membership-and-administration/samples/sample7.aspx)]
3. <span data-ttu-id="a5a80-214">Después, abra el archivo de código subyacente *AdminPage.aspx.CS* haciendo clic con el botón secundario en *AdminPage. aspx* y haciendo clic en **Ver código**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-214">Next, open the *AdminPage.aspx.cs* code-behind file by right-clicking the *AdminPage.aspx* and clicking **View Code**.</span></span>
4. <span data-ttu-id="a5a80-215">Reemplace el código existente en el archivo de código subyacente *AdminPage.aspx.CS* por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="a5a80-215">Replace the existing code in the *AdminPage.aspx.cs* code-behind file with the following code:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample8.cs)]

<span data-ttu-id="a5a80-216">En el código que especificó para el archivo de código subyacente de *AdminPage.aspx.CS* , una clase llamada `AddProducts` realiza el trabajo real de agregar productos a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-216">In the code that you entered for the *AdminPage.aspx.cs* code-behind file, a class called `AddProducts` does the actual work of adding products to the database.</span></span> <span data-ttu-id="a5a80-217">Esta clase todavía no existe, por lo que la creará ahora.</span><span class="sxs-lookup"><span data-stu-id="a5a80-217">This class doesn't exist yet, so you will create it now.</span></span>

1. <span data-ttu-id="a5a80-218">En **Explorador de soluciones**, haga clic con el botón secundario en la carpeta *lógica* y, a continuación, seleccione **Agregar** -&gt; **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-218">In **Solution Explorer**, right-click the *Logic* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="a5a80-219">Se abrirá el cuadro de diálogo **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-219">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="a5a80-220">Seleccione el grupo plantillas de **código** de **Visual C#**  -&gt; a la izquierda.</span><span class="sxs-lookup"><span data-stu-id="a5a80-220">Select the **Visual C#** -&gt; **Code** templates group on the left.</span></span> <span data-ttu-id="a5a80-221">A continuación, seleccione **clase**en la lista central y asígnele el nombre *AddProducts.CS*.</span><span class="sxs-lookup"><span data-stu-id="a5a80-221">Then, select **Class**from the middle list and name it *AddProducts.cs*.</span></span>   
   <span data-ttu-id="a5a80-222">Se muestra el nuevo archivo de clase.</span><span class="sxs-lookup"><span data-stu-id="a5a80-222">The new class file is displayed.</span></span>
3. <span data-ttu-id="a5a80-223">Reemplace el código existente por el siguiente:</span><span class="sxs-lookup"><span data-stu-id="a5a80-223">Replace the existing code with the following:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample9.cs)]

<span data-ttu-id="a5a80-224">La página *AdminPage. aspx* permite al usuario que pertenece al rol "canEdit" agregar y quitar productos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-224">The *AdminPage.aspx* page allows the user belonging to the "canEdit" role to add and remove products.</span></span> <span data-ttu-id="a5a80-225">Cuando se agrega un nuevo producto, se validan los detalles del producto y, a continuación, se escriben en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-225">When a new product is added, the details about the product are validated and then entered into the database.</span></span> <span data-ttu-id="a5a80-226">El nuevo producto está disponible inmediatamente para todos los usuarios de la aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="a5a80-226">The new product is immediately available to all users of the web application.</span></span>

#### <a name="unobtrusive-validation"></a><span data-ttu-id="a5a80-227">Validación discreta</span><span class="sxs-lookup"><span data-stu-id="a5a80-227">Unobtrusive Validation</span></span>

<span data-ttu-id="a5a80-228">Los detalles del producto que el usuario proporciona en la página *AdminPage. aspx* se validan mediante controles de validación (`RequiredFieldValidator` y `RegularExpressionValidator`).</span><span class="sxs-lookup"><span data-stu-id="a5a80-228">The product details that the user provides on the *AdminPage.aspx* page are validated using validation controls (`RequiredFieldValidator` and `RegularExpressionValidator`).</span></span> <span data-ttu-id="a5a80-229">Estos controles utilizan automáticamente la validación discreta.</span><span class="sxs-lookup"><span data-stu-id="a5a80-229">These controls automatically use unobtrusive validation.</span></span> <span data-ttu-id="a5a80-230">La validación discreta permite a los controles de validación usar JavaScript para la lógica de validación del lado cliente, lo que significa que la página no requiere un viaje al servidor que se va a validar.</span><span class="sxs-lookup"><span data-stu-id="a5a80-230">Unobtrusive validation allows the validation controls to use JavaScript for client-side validation logic, which means the page does not require a trip to the server to be validated.</span></span> <span data-ttu-id="a5a80-231">De forma predeterminada, la validación discreta se incluye en el archivo *Web. config* en función de la configuración siguiente:</span><span class="sxs-lookup"><span data-stu-id="a5a80-231">By default, unobtrusive validation is included in the *Web.config* file based on the following configuration setting:</span></span>

[!code-xml[Main](membership-and-administration/samples/sample10.xml)]

#### <a name="regular-expressions"></a><span data-ttu-id="a5a80-232">Expresiones regulares</span><span class="sxs-lookup"><span data-stu-id="a5a80-232">Regular Expressions</span></span>

<span data-ttu-id="a5a80-233">El precio del producto en la página *AdminPage. aspx* se valida mediante un control **RegularExpressionValidator** .</span><span class="sxs-lookup"><span data-stu-id="a5a80-233">The product price on the *AdminPage.aspx* page is validated using a **RegularExpressionValidator** control.</span></span> <span data-ttu-id="a5a80-234">Este control valida si el valor del control de entrada asociado (el cuadro de texto "AddProductPrice") coincide con el patrón especificado por la expresión regular.</span><span class="sxs-lookup"><span data-stu-id="a5a80-234">This control validates whether the value of the associated input control (the "AddProductPrice" TextBox) matches the pattern specified by the regular expression.</span></span> <span data-ttu-id="a5a80-235">Una expresión regular es una notación de coincidencia de patrones que permite buscar y hacer coincidir rápidamente patrones de caracteres concretos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-235">A regular expression is a pattern-matching notation that enables you to quickly find and match specific character patterns.</span></span> <span data-ttu-id="a5a80-236">El control **RegularExpressionValidator** incluye una propiedad denominada `ValidationExpression` que contiene la expresión regular utilizada para validar la entrada de precios, como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="a5a80-236">The **RegularExpressionValidator** control includes a property named `ValidationExpression` that contains the regular expression used to validate price input, as shown below:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample11.aspx)]

#### <a name="fileupload-control"></a><span data-ttu-id="a5a80-237">FileUpload (control)</span><span class="sxs-lookup"><span data-stu-id="a5a80-237">FileUpload Control</span></span>

<span data-ttu-id="a5a80-238">Además de los controles de entrada y validación, ha agregado el control **FileUpload** a la página *AdminPage. aspx* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-238">In addition to the input and validation controls, you added the **FileUpload** control to the *AdminPage.aspx* page.</span></span> <span data-ttu-id="a5a80-239">Este control proporciona la capacidad de cargar archivos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-239">This control provides the capability to upload files.</span></span> <span data-ttu-id="a5a80-240">En este caso, solo se permiten cargar archivos de imagen.</span><span class="sxs-lookup"><span data-stu-id="a5a80-240">In this case, you are only allowing image files to be uploaded.</span></span> <span data-ttu-id="a5a80-241">En el archivo de código subyacente (*AdminPage.aspx.CS*), cuando se hace clic en el `AddProductButton`, el código comprueba la propiedad `HasFile` del control **FileUpload** .</span><span class="sxs-lookup"><span data-stu-id="a5a80-241">In the code-behind file (*AdminPage.aspx.cs*), when the `AddProductButton` is clicked, the code checks the `HasFile` property of the **FileUpload** control.</span></span> <span data-ttu-id="a5a80-242">Si el control tiene un archivo y se permite el tipo de archivo (basado en la extensión de archivo), la imagen se guarda en la carpeta *images* y en la carpeta *images/Thumbs* de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-242">If the control has a file and if the file type (based on file extension) is allowed, the image is saved to the *Images* folder and the *Images/Thumbs* folder of the application.</span></span>

#### <a name="model-binding"></a><span data-ttu-id="a5a80-243">Enlace de modelos</span><span class="sxs-lookup"><span data-stu-id="a5a80-243">Model Binding</span></span>

<span data-ttu-id="a5a80-244">Anteriormente en esta serie de tutoriales se usaba el enlace de modelos para rellenar un control **ListView** , un control **FormsView** , un control **GridView** y un control **DetailView** .</span><span class="sxs-lookup"><span data-stu-id="a5a80-244">Earlier in this tutorial series you used model binding to populate a **ListView** control, a **FormsView** control, a **GridView** control, and a **DetailView** control.</span></span> <span data-ttu-id="a5a80-245">En este tutorial, se usa el enlace de modelos para rellenar un control **DropDownList** con una lista de categorías de productos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-245">In this tutorial, you use model binding to populate a **DropDownList** control with a list of product categories.</span></span>

<span data-ttu-id="a5a80-246">El marcado que agregó al archivo *AdminPage. aspx* contiene un control **DropDownList** denominado `DropDownAddCategory`:</span><span class="sxs-lookup"><span data-stu-id="a5a80-246">The markup that you added to the *AdminPage.aspx* file contains a **DropDownList** control called `DropDownAddCategory`:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample12.aspx)]

<span data-ttu-id="a5a80-247">El enlace de modelos se usa para rellenar este **DropDownList** estableciendo el atributo de `ItemType` y el atributo de `SelectMethod`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-247">You use model binding to populate this **DropDownList** by setting the `ItemType` attribute and the `SelectMethod` attribute.</span></span> <span data-ttu-id="a5a80-248">El atributo `ItemType` especifica que se utiliza el tipo de `WingtipToys.Models.Category` al rellenar el control.</span><span class="sxs-lookup"><span data-stu-id="a5a80-248">The `ItemType` attribute specifies that you use the `WingtipToys.Models.Category` type when populating the control.</span></span> <span data-ttu-id="a5a80-249">Este tipo se definió al principio de esta serie de tutoriales mediante la creación de la clase `Category` (que se muestra a continuación).</span><span class="sxs-lookup"><span data-stu-id="a5a80-249">You defined this type at the beginning of this tutorial series by creating the `Category` class (shown below).</span></span> <span data-ttu-id="a5a80-250">La clase `Category` se encuentra en la carpeta *Models* dentro del archivo *Category.CS* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-250">The `Category` class is in the *Models* folder inside the *Category.cs* file.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample13.cs)]

<span data-ttu-id="a5a80-251">El atributo `SelectMethod` del control **DropDownList** especifica que se usa el método `GetCategories` (que se muestra a continuación) que se incluye en el archivo de código subyacente (*AdminPage.aspx.CS*).</span><span class="sxs-lookup"><span data-stu-id="a5a80-251">The `SelectMethod` attribute of the **DropDownList** control specifies that you use the `GetCategories` method (shown below) that is included in the code-behind file (*AdminPage.aspx.cs*).</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample14.cs)]

<span data-ttu-id="a5a80-252">Este método especifica que se usa una interfaz de `IQueryable` para evaluar una consulta en un tipo de `Category`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-252">This method specifies that an `IQueryable` interface is used to evaluate a query against a `Category` type.</span></span> <span data-ttu-id="a5a80-253">El valor devuelto se usa para rellenar el **DropDownList** en el marcado de la página (*AdminPage. aspx*).</span><span class="sxs-lookup"><span data-stu-id="a5a80-253">The returned value is used to populate the **DropDownList** in the markup of the page (*AdminPage.aspx*).</span></span>

<span data-ttu-id="a5a80-254">El texto que se muestra para cada elemento de la lista se especifica estableciendo el atributo `DataTextField`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-254">The text displayed for each item in the list is specified by setting the `DataTextField` attribute.</span></span> <span data-ttu-id="a5a80-255">El atributo `DataTextField` usa la `CategoryName` de la clase `Category` (mostrada anteriormente) para mostrar cada categoría en el control **DropDownList** .</span><span class="sxs-lookup"><span data-stu-id="a5a80-255">The `DataTextField` attribute uses the `CategoryName` of the `Category` class (shown above) to display each category in the **DropDownList** control.</span></span> <span data-ttu-id="a5a80-256">El valor real que se pasa cuando se selecciona un elemento en el control **DropDownList** se basa en el atributo `DataValueField`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-256">The actual value that is passed when an item is selected in the **DropDownList** control is based on the `DataValueField` attribute.</span></span> <span data-ttu-id="a5a80-257">El atributo `DataValueField` se establece en el `CategoryID` como definido en la clase `Category` (se muestra arriba).</span><span class="sxs-lookup"><span data-stu-id="a5a80-257">The `DataValueField` attribute is set to the `CategoryID` as define in the `Category` class (shown above).</span></span>

### <a name="how-the-application-will-work"></a><span data-ttu-id="a5a80-258">Cómo funcionará la aplicación</span><span class="sxs-lookup"><span data-stu-id="a5a80-258">How the Application Will Work</span></span>

<span data-ttu-id="a5a80-259">Cuando el usuario que pertenece al rol "canEdit" navega a la página por primera vez, el control `DropDownAddCategory`**DropDownList** se rellena como se describió anteriormente.</span><span class="sxs-lookup"><span data-stu-id="a5a80-259">When the user belonging to the "canEdit" role navigates to the page for the first time, the `DropDownAddCategory`**DropDownList** control is populated as described above.</span></span> <span data-ttu-id="a5a80-260">El control `DropDownRemoveProduct`**DropDownList** también se rellena con productos que utilizan el mismo enfoque.</span><span class="sxs-lookup"><span data-stu-id="a5a80-260">The `DropDownRemoveProduct`**DropDownList** control is also populated with products using the same approach.</span></span> <span data-ttu-id="a5a80-261">El usuario que pertenece al rol "canEdit" selecciona el tipo de categoría y agrega los detalles del producto (**nombre**, **Descripción**, **precio**y **archivo de imagen**).</span><span class="sxs-lookup"><span data-stu-id="a5a80-261">The user belonging to the "canEdit" role selects the category type and adds product details (**Name**, **Description**, **Price**, and **Image File**).</span></span> <span data-ttu-id="a5a80-262">Cuando el usuario que pertenece al rol "canEdit" hace clic en el botón **Agregar producto** , se desencadena el controlador de eventos `AddProductButton_Click`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-262">When the user belonging to the "canEdit" role clicks the **Add Product** button, the `AddProductButton_Click` event handler is triggered.</span></span> <span data-ttu-id="a5a80-263">El controlador de eventos `AddProductButton_Click` ubicado en el archivo de código subyacente (*AdminPage.aspx.CS*) comprueba el archivo de imagen para asegurarse de que coincide con los tipos de archivo permitidos *(. gif*, *. png*, *. JPEG*o *. jpg*).</span><span class="sxs-lookup"><span data-stu-id="a5a80-263">The `AddProductButton_Click` event handler located in the code-behind file (*AdminPage.aspx.cs*) checks the image file to make sure it matches the allowed file types *(.gif*, *.png*, *.jpeg*, or *.jpg*).</span></span> <span data-ttu-id="a5a80-264">Después, el archivo de imagen se guarda en una carpeta de la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="a5a80-264">Then, the image file is saved into a folder of the Wingtip Toys sample application.</span></span> <span data-ttu-id="a5a80-265">A continuación, se agrega el nuevo producto a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-265">Next, the new product is added to the database.</span></span> <span data-ttu-id="a5a80-266">Para realizar la adición de un nuevo producto, se crea una nueva instancia de la clase `AddProducts` y se denomina Products.</span><span class="sxs-lookup"><span data-stu-id="a5a80-266">To accomplish adding a new product, a new instance of the `AddProducts` class is created and named products.</span></span> <span data-ttu-id="a5a80-267">La clase `AddProducts` tiene un método denominado `AddProduct`y el objeto Products llama a este método para agregar productos a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-267">The `AddProducts` class has a method named `AddProduct`, and the products object calls this method to add products to the database.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample15.cs)]

<span data-ttu-id="a5a80-268">Si el código agrega correctamente el nuevo producto a la base de datos, la página se recarga con el valor de la cadena de consulta `ProductAction=add`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-268">If the code successfully adds the new product to the database, the page is reloaded with the query string value `ProductAction=add`.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample16.cs)]

<span data-ttu-id="a5a80-269">Cuando se recarga la página, la cadena de consulta se incluye en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="a5a80-269">When the page reloads, the query string is included in the URL.</span></span> <span data-ttu-id="a5a80-270">Al volver a cargar la página, el usuario que pertenece al rol "canEdit" puede ver inmediatamente las actualizaciones en los controles **DropDownList** en la página *AdminPage. aspx* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-270">By reloading the page, the user belonging to the "canEdit" role can immediately see the updates in the **DropDownList** controls on the *AdminPage.aspx* page.</span></span> <span data-ttu-id="a5a80-271">Además, al incluir la cadena de consulta con la dirección URL, la página puede mostrar un mensaje de confirmación al usuario que pertenece al rol "canEdit".</span><span class="sxs-lookup"><span data-stu-id="a5a80-271">Also, by including the query string with the URL, the page can display a success message to the user belonging to the "canEdit" role.</span></span>

<span data-ttu-id="a5a80-272">Cuando se vuelve a cargar la página *AdminPage. aspx* , se llama al evento `Page_Load`.</span><span class="sxs-lookup"><span data-stu-id="a5a80-272">When the *AdminPage.aspx* page reloads, the `Page_Load` event is called.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample17.cs)]

<span data-ttu-id="a5a80-273">El controlador de eventos `Page_Load` comprueba el valor de la cadena de consulta y determina si se muestra un mensaje de operación correcta.</span><span class="sxs-lookup"><span data-stu-id="a5a80-273">The `Page_Load` event handler checks the query string value and determines whether to show a success message.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="a5a80-274">Ejecutar la aplicación</span><span class="sxs-lookup"><span data-stu-id="a5a80-274">Running the Application</span></span>

<span data-ttu-id="a5a80-275">Ahora puede ejecutar la aplicación para ver cómo puede Agregar, eliminar y actualizar elementos en el carro de la compra.</span><span class="sxs-lookup"><span data-stu-id="a5a80-275">You can run the application now to see how you can add, delete, and update items in the shopping cart.</span></span> <span data-ttu-id="a5a80-276">El total del carro de la compra reflejará el costo total de todos los artículos en el carro de la compra.</span><span class="sxs-lookup"><span data-stu-id="a5a80-276">The shopping cart total will reflect the total cost of all items in the shopping cart.</span></span>

1. <span data-ttu-id="a5a80-277">En Explorador de soluciones, presione **F5** para ejecutar la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="a5a80-277">In Solution Explorer, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="a5a80-278">El explorador se abre y muestra la página *default. aspx* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-278">The browser opens and shows the *Default.aspx* page.</span></span>
2. <span data-ttu-id="a5a80-279">Haga clic en el vínculo **iniciar sesión** en la parte superior de la página.</span><span class="sxs-lookup"><span data-stu-id="a5a80-279">Click the **Log in** link at the top of the page.</span></span> 

    ![Pertenencia y administración: vínculo de inicio de sesión](membership-and-administration/_static/image2.png)

   <span data-ttu-id="a5a80-281">Se muestra la página *login. aspx* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-281">The *Login.aspx* page is displayed.</span></span>
3. <span data-ttu-id="a5a80-282">Use el nombre de usuario y la contraseña siguientes:</span><span class="sxs-lookup"><span data-stu-id="a5a80-282">Use the following user name and password:</span></span>  
   <span data-ttu-id="a5a80-283">Nombre de usuario: canEditUser@wingtiptoys.com</span><span class="sxs-lookup"><span data-stu-id="a5a80-283">User name: canEditUser@wingtiptoys.com</span></span>  
   <span data-ttu-id="a5a80-284">Contraseña: PA $ $word 1</span><span class="sxs-lookup"><span data-stu-id="a5a80-284">Password: Pa$$word1</span></span> 

    ![Pertenencia y administración: Página de inicio de sesión](membership-and-administration/_static/image3.png)
4. <span data-ttu-id="a5a80-286">Haga clic en el botón **iniciar sesión** situado cerca de la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="a5a80-286">Click the **Log in** button near the bottom of the page.</span></span>
5. <span data-ttu-id="a5a80-287">En la parte superior de la página siguiente, seleccione el vínculo **admin (Administrador** ) para navegar a la página *AdminPage. aspx* .</span><span class="sxs-lookup"><span data-stu-id="a5a80-287">At the top of the next page, select the **Admin** link to navigate to the *AdminPage.aspx* page.</span></span> 

    ![Pertenencia y administración: vínculo de administrador](membership-and-administration/_static/image4.png)
6. <span data-ttu-id="a5a80-289">Para probar la validación de entrada, haga clic en el botón **Agregar producto** sin agregar los detalles del producto.</span><span class="sxs-lookup"><span data-stu-id="a5a80-289">To test the input validation, click the **Add Product** button without adding any product details.</span></span> 

    ![Pertenencia y administración: Página de administración](membership-and-administration/_static/image5.png)

   <span data-ttu-id="a5a80-291">Observe que se muestran los mensajes de campo necesarios.</span><span class="sxs-lookup"><span data-stu-id="a5a80-291">Notice that the required field messages are displayed.</span></span>
7. <span data-ttu-id="a5a80-292">Agregue los detalles de un nuevo producto y, a continuación, haga clic en el botón **Agregar producto** .</span><span class="sxs-lookup"><span data-stu-id="a5a80-292">Add the details for a new product, and then click the **Add Product** button.</span></span> 

    ![Pertenencia y administración: agregar producto](membership-and-administration/_static/image6.png)
8. <span data-ttu-id="a5a80-294">Seleccione **productos** en el menú de navegación superior para ver el nuevo producto que ha agregado.</span><span class="sxs-lookup"><span data-stu-id="a5a80-294">Select **Products** from the top navigation menu to view the new product you added.</span></span> 

    ![Pertenencia y administración: Mostrar nuevo producto](membership-and-administration/_static/image7.png)
9. <span data-ttu-id="a5a80-296">Haga clic en el vínculo **Administrador** para volver a la página de administración.</span><span class="sxs-lookup"><span data-stu-id="a5a80-296">Click the **Admin** link to return to the administration page.</span></span>
10. <span data-ttu-id="a5a80-297">En la sección **quitar producto** de la página, seleccione el nuevo producto que ha agregado en **DropDownListBox**.</span><span class="sxs-lookup"><span data-stu-id="a5a80-297">In the **Remove Product** section of the page, select the new product you added in the **DropDownListBox**.</span></span>
11. <span data-ttu-id="a5a80-298">Haga clic en el botón **quitar producto** para quitar el nuevo producto de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-298">Click the **Remove Product** button to remove the new product from the application.</span></span> 

    ![Pertenencia y administración: quitar producto](membership-and-administration/_static/image8.png)
12. <span data-ttu-id="a5a80-300">Seleccione **productos** en el menú de navegación superior para confirmar que se ha quitado el producto.</span><span class="sxs-lookup"><span data-stu-id="a5a80-300">Select **Products** from the top navigation menu to confirm that the product has been removed.</span></span>
13. <span data-ttu-id="a5a80-301">Haga clic en **Cerrar sesión** en el modo de administración existente.</span><span class="sxs-lookup"><span data-stu-id="a5a80-301">Click **Log off** to exist administration mode.</span></span>   
    <span data-ttu-id="a5a80-302">Observe que el panel de navegación superior ya no muestra el elemento de menú **Administrador** .</span><span class="sxs-lookup"><span data-stu-id="a5a80-302">Notice that the top navigation pane no longer shows the **Admin** menu item.</span></span>

## <a name="summary"></a><span data-ttu-id="a5a80-303">Resumen</span><span class="sxs-lookup"><span data-stu-id="a5a80-303">Summary</span></span>

<span data-ttu-id="a5a80-304">En este tutorial, ha agregado un rol personalizado y un usuario que pertenece al rol personalizado, acceso restringido a la página y la carpeta de administración, y ha proporcionado la navegación para el usuario que pertenece al rol personalizado.</span><span class="sxs-lookup"><span data-stu-id="a5a80-304">In this tutorial, you added a custom role and a user belonging to the custom role, restricted access to the administration folder and page, and provided navigation for the user belonging to the custom role.</span></span> <span data-ttu-id="a5a80-305">Usó el enlace de modelos para rellenar un control **DropDownList** con datos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-305">You used model binding to populate a **DropDownList** control with data.</span></span> <span data-ttu-id="a5a80-306">Ha implementado el control **FileUpload** y los controles de validación.</span><span class="sxs-lookup"><span data-stu-id="a5a80-306">You implemented the **FileUpload** control and validation controls.</span></span> <span data-ttu-id="a5a80-307">Además, ha aprendido a agregar y quitar productos de una base de datos.</span><span class="sxs-lookup"><span data-stu-id="a5a80-307">Also, you have learned how to add and remove products from a database.</span></span> <span data-ttu-id="a5a80-308">En el siguiente tutorial, aprenderá a implementar el enrutamiento ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a5a80-308">In the next tutorial, you'll learn how to implement ASP.NET routing.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="a5a80-309">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="a5a80-309">Additional Resources</span></span>

<span data-ttu-id="a5a80-310">[Web. config: elemento authorization](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="a5a80-310">[Web.config - authorization Element](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="a5a80-311">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="a5a80-311">ASP.NET Identity</span></span>](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md)  
[<span data-ttu-id="a5a80-312">Implementación de una aplicación de formularios Web Forms de ASP.NET segura con suscripción, OAuth y SQL Database en un sitio web de Azure</span><span class="sxs-lookup"><span data-stu-id="a5a80-312">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to an Azure Web Site</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="a5a80-313">Evaluación gratuita de Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="a5a80-313">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

> [!div class="step-by-step"]
> <span data-ttu-id="a5a80-314">[Anterior](checkout-and-payment-with-paypal.md)
> [Siguiente](url-routing.md)</span><span class="sxs-lookup"><span data-stu-id="a5a80-314">[Previous](checkout-and-payment-with-paypal.md)
[Next](url-routing.md)</span></span>
