---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
title: Pertenencia y administración | Microsoft Docs
author: Erikre
description: Esta serie de tutoriales aprenderá los conceptos básicos de la creación de una aplicación de formularios Web Forms ASP.NET con ASP.NET 4.5 y Microsoft Visual Studio Express 2013 para se...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 732a2316-e49f-4f72-becd-0cd72f14457e
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
msc.type: authoredcontent
ms.openlocfilehash: 7263a7d7ee791be8a1369934aac4d091736a658b
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/17/2019
ms.locfileid: "59417486"
---
# <a name="membership-and-administration"></a><span data-ttu-id="32314-103">Pertenencia y administración</span><span class="sxs-lookup"><span data-stu-id="32314-103">Membership and Administration</span></span>

<span data-ttu-id="32314-104">por [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="32314-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="32314-105">[Descargar el proyecto de ejemplo de Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) o [descargar eBook (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="32314-105">[Download Wingtip Toys Sample Project (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="32314-106">Esta serie de tutoriales aprenderá los conceptos básicos de la creación de una aplicación de formularios Web Forms ASP.NET con ASP.NET 4.5 y Microsoft Visual Studio Express 2013 para Web.</span><span class="sxs-lookup"><span data-stu-id="32314-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="32314-107">Un Visual Studio 2013 [proyecto con código fuente de C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) está disponible para acompañar esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="32314-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>


<span data-ttu-id="32314-108">Este tutorial muestra cómo actualizar la aplicación de ejemplo Wingtip Toys para agregar un rol personalizado y usar ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="32314-108">This tutorial shows you how to update the Wingtip Toys sample application to add a custom role and use ASP.NET Identity.</span></span> <span data-ttu-id="32314-109">También se muestra cómo implementar una página de administración desde el que el usuario con un rol personalizado puede agregar y quitar productos desde el sitio Web.</span><span class="sxs-lookup"><span data-stu-id="32314-109">It also shows you how to implement an administration page from which the user with a custom role can add and remove products from the website.</span></span>

<span data-ttu-id="32314-110">[ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) es el sistema de pertenencia que se usa para compilar la aplicación web ASP.NET y está disponible en ASP.NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="32314-110">[ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) is the membership system used to build ASP.NET web application and is available in ASP.NET 4.5.</span></span> <span data-ttu-id="32314-111">ASP.NET Identity se utiliza en la plantilla de proyecto de formularios Web Forms de Visual Studio 2013, así como las plantillas para [ASP.NET MVC](../../../../mvc/index.md), [ASP.NET Web API](../../../../web-api/index.md), y [aplicación de página única de ASP.NET](../../../../single-page-application/index.md).</span><span class="sxs-lookup"><span data-stu-id="32314-111">ASP.NET Identity is used in the Visual Studio 2013 Web Forms project template, as well as the templates for [ASP.NET MVC](../../../../mvc/index.md), [ASP.NET Web API](../../../../web-api/index.md), and [ASP.NET Single Page Application](../../../../single-page-application/index.md).</span></span> <span data-ttu-id="32314-112">Específicamente, puede instalar el sistema ASP.NET Identity mediante NuGet cuando se inicia con una aplicación Web vacía.</span><span class="sxs-lookup"><span data-stu-id="32314-112">You can also specifically install the ASP.NET Identity system using NuGet when you start with an empty Web application.</span></span> <span data-ttu-id="32314-113">Sin embargo, en esta serie de tutoriales utilice el **formularios Web Forms**projecttemplate, que incluye el sistema ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="32314-113">However, in this tutorial series you use the **Web Forms**projecttemplate, which includes the ASP.NET Identity system.</span></span> <span data-ttu-id="32314-114">ASP.NET Identity facilita integrar datos de perfil de usuario específica con datos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-114">ASP.NET Identity makes it easy to integrate user-specific profile data with application data.</span></span> <span data-ttu-id="32314-115">Además, ASP.NET Identity permite elegir el modelo de persistencia para perfiles de usuario en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-115">Also, ASP.NET Identity allows you to choose the persistence model for user profiles in your application.</span></span> <span data-ttu-id="32314-116">Puede almacenar los datos en una base de datos de SQL Server o en otro almacén de datos, incluidos *NoSQL* almacenes de datos como tablas de almacenamiento de Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="32314-116">You can store the data in a SQL Server database or another data store, including *NoSQL* data stores such as Windows Azure Storage Tables.</span></span>

<span data-ttu-id="32314-117">Este tutorial se basa en el tutorial anterior titulado "Desprotección y pago con PayPal" en la serie de tutoriales de Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="32314-117">This tutorial builds on the previous tutorial titled "Checkout and Payment with PayPal" in the Wingtip Toys tutorial series.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="32314-118">Lo que aprenderá:</span><span class="sxs-lookup"><span data-stu-id="32314-118">What you'll learn:</span></span>

- <span data-ttu-id="32314-119">Cómo usar código para agregar un rol personalizado y un usuario a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-119">How to use code to add a custom role and a user to the application.</span></span>
- <span data-ttu-id="32314-120">Cómo restringir el acceso a la carpeta de administración y la página.</span><span class="sxs-lookup"><span data-stu-id="32314-120">How to restrict access to the administration folder and page.</span></span>
- <span data-ttu-id="32314-121">Cómo proporcionar navegación para el usuario que pertenezca al rol personalizado.</span><span class="sxs-lookup"><span data-stu-id="32314-121">How to provide navigation for the user that belongs to the custom role.</span></span>
- <span data-ttu-id="32314-122">Cómo usar el enlace de modelos para rellenar un [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) control con las categorías de productos.</span><span class="sxs-lookup"><span data-stu-id="32314-122">How to use model binding to populate a [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) control with product categories.</span></span>
- <span data-ttu-id="32314-123">Cómo cargar un archivo en la aplicación web con el [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) control.</span><span class="sxs-lookup"><span data-stu-id="32314-123">How to upload a file to the web application using the [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) control.</span></span>
- <span data-ttu-id="32314-124">Cómo usar los controles de validación para implementar la validación de entrada.</span><span class="sxs-lookup"><span data-stu-id="32314-124">How to use validation controls to implement input validation.</span></span>
- <span data-ttu-id="32314-125">Cómo agregar y quitar los productos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-125">How to add and remove products from the application.</span></span>

## <a name="these-features-are-included-in-the-tutorial"></a><span data-ttu-id="32314-126">Estas características se incluyen en el tutorial:</span><span class="sxs-lookup"><span data-stu-id="32314-126">These features are included in the tutorial:</span></span>

- <span data-ttu-id="32314-127">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="32314-127">ASP.NET Identity</span></span>
- <span data-ttu-id="32314-128">Configuración y la autorización</span><span class="sxs-lookup"><span data-stu-id="32314-128">Configuration and Authorization</span></span>
- <span data-ttu-id="32314-129">Enlace de modelos</span><span class="sxs-lookup"><span data-stu-id="32314-129">Model Binding</span></span>
- <span data-ttu-id="32314-130">Validación discreta</span><span class="sxs-lookup"><span data-stu-id="32314-130">Unobtrusive Validation</span></span>

<span data-ttu-id="32314-131">ASP.NET Web Forms proporciona capacidades de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="32314-131">ASP.NET Web Forms provides membership capabilities.</span></span> <span data-ttu-id="32314-132">Mediante el uso de la plantilla predeterminada, tiene la funcionalidad de pertenencia integrado que puede utilizar inmediatamente cuando se ejecuta la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-132">By using the default template, you have built-in membership functionality that you can immediately use when the application runs.</span></span> <span data-ttu-id="32314-133">Este tutorial muestra cómo usar ASP.NET Identity para agregar un rol personalizado y asignar a un usuario a ese rol.</span><span class="sxs-lookup"><span data-stu-id="32314-133">This tutorial shows you how to use ASP.NET Identity to add a custom role and assign a user to that role.</span></span> <span data-ttu-id="32314-134">Obtendrá información sobre cómo restringir el acceso a la carpeta de administración.</span><span class="sxs-lookup"><span data-stu-id="32314-134">You will learn how to restrict access to the administration folder.</span></span> <span data-ttu-id="32314-135">Agregará una página a la carpeta de administración que permite a un usuario con un rol personalizado para agregar y quitar los productos y obtener una vista previa de un producto después de que se ha agregado.</span><span class="sxs-lookup"><span data-stu-id="32314-135">You'll add a page to the administration folder that allows a user with a custom role to add and remove products, and to preview a product after it has been added.</span></span>

## <a name="adding-a-custom-role"></a><span data-ttu-id="32314-136">Agregar un rol personalizado</span><span class="sxs-lookup"><span data-stu-id="32314-136">Adding a Custom Role</span></span>

<span data-ttu-id="32314-137">Con ASP.NET Identity, puede agregar un rol personalizado y asignar a un usuario a ese rol usando código.</span><span class="sxs-lookup"><span data-stu-id="32314-137">Using ASP.NET Identity, you can add a custom role and assign a user to that role using code.</span></span>

1. <span data-ttu-id="32314-138">En **el Explorador de soluciones**, haga doble clic en el *lógica* carpeta y cree una nueva clase.</span><span class="sxs-lookup"><span data-stu-id="32314-138">In **Solution Explorer**, right-click on the *Logic* folder and create a new class.</span></span>
2. <span data-ttu-id="32314-139">Nombre de la nueva clase *RoleActions.cs*.</span><span class="sxs-lookup"><span data-stu-id="32314-139">Name the new class *RoleActions.cs*.</span></span>
3. <span data-ttu-id="32314-140">Modifique el código para que aparezca como sigue:</span><span class="sxs-lookup"><span data-stu-id="32314-140">Modify the code so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample1.cs?highlight=8)]
4. <span data-ttu-id="32314-141">En **el Explorador de soluciones**, abra el *Global.asax.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="32314-141">In **Solution Explorer**, open the *Global.asax.cs* file.</span></span>
5. <span data-ttu-id="32314-142">Modificar el *Global.asax.cs* archivo agregando el código resaltado en amarillo para que aparezca como sigue:</span><span class="sxs-lookup"><span data-stu-id="32314-142">Modify the *Global.asax.cs* file by adding the code highlighted in yellow so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample2.cs?highlight=11,26-28)]
6. <span data-ttu-id="32314-143">Tenga en cuenta que `AddUserAndRole` está subrayada en rojo.</span><span class="sxs-lookup"><span data-stu-id="32314-143">Notice that `AddUserAndRole` is underlined in red.</span></span> <span data-ttu-id="32314-144">Haga doble clic en el código AddUserAndRole.</span><span class="sxs-lookup"><span data-stu-id="32314-144">Double-click the AddUserAndRole code.</span></span>  
   <span data-ttu-id="32314-145">La letra "A" al principio del método resaltado aparecerá subrayada.</span><span class="sxs-lookup"><span data-stu-id="32314-145">The letter "A" at the beginning of the highlighted method will be underlined.</span></span>
7. <span data-ttu-id="32314-146">Mantenga el mouse sobre la letra "A" y haga clic en la interfaz de usuario que le permite generar código auxiliar de método para el `AddUserAndRole` método.</span><span class="sxs-lookup"><span data-stu-id="32314-146">Hover over the letter "A" and click the UI that allows you to generate a method stub for the `AddUserAndRole` method.</span></span> 

    ![Pertenencia y administración - generar código auxiliar del método](membership-and-administration/_static/image1.png)
8. <span data-ttu-id="32314-148">Haga clic en la opción titulada:</span><span class="sxs-lookup"><span data-stu-id="32314-148">Click the option titled:</span></span>  
    `Generate method stub for "AddUserAndRole" in "WingtipToys.Logic.RoleActions"`
9. <span data-ttu-id="32314-149">Abra el *RoleActions.cs* de archivos desde el *lógica* carpeta.</span><span class="sxs-lookup"><span data-stu-id="32314-149">Open the *RoleActions.cs* file from the *Logic* folder.</span></span>  
   <span data-ttu-id="32314-150">El `AddUserAndRole` método se ha agregado al archivo de clase.</span><span class="sxs-lookup"><span data-stu-id="32314-150">The `AddUserAndRole` method has been added to the class file.</span></span>
10. <span data-ttu-id="32314-151">Modificar el *RoleActions.cs* archivo quitando la `NotImplementedException` y agregue el código resaltado en amarillo, para que aparezca como sigue:</span><span class="sxs-lookup"><span data-stu-id="32314-151">Modify the *RoleActions.cs* file by removing the `NotImplementedException` and adding the code highlighted in yellow, so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample3.cs?highlight=5-7,15-51)]

<span data-ttu-id="32314-152">Primero, el código anterior establece un contexto de base de datos para la base de datos de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="32314-152">The above code first establishes a database context for the membership database.</span></span> <span data-ttu-id="32314-153">También se almacena la base de datos de pertenencia como una *.mdf* de archivos en el *aplicación\_datos* carpeta.</span><span class="sxs-lookup"><span data-stu-id="32314-153">The membership database is also stored as an *.mdf* file in the *App\_Data* folder.</span></span> <span data-ttu-id="32314-154">Podrá ver esta base de datos una vez que el primer usuario ha iniciado sesión en esta aplicación web.</span><span class="sxs-lookup"><span data-stu-id="32314-154">You will be able to view this database once the first user has signed in to this web application.</span></span> 

> [!NOTE] 
> 
> <span data-ttu-id="32314-155">Si desea almacenar los datos de pertenencia, junto con los datos del producto, puede usar el mismo **DbContext** que ha usado para almacenar los datos del producto en el código anterior.</span><span class="sxs-lookup"><span data-stu-id="32314-155">If you wish to store the membership data along with the product data, you can consider using the same **DbContext** that you used to store the product data in the above code.</span></span>


 <span data-ttu-id="32314-156">El *interno* palabra clave es un modificador de acceso para miembros de tipo (por ejemplo, métodos o propiedades) y tipos (por ejemplo, las clases).</span><span class="sxs-lookup"><span data-stu-id="32314-156">The *internal* keyword is an access modifier for types (such as classes) and type members (such as methods or properties).</span></span> <span data-ttu-id="32314-157">Tipos internos o los miembros son accesibles solo dentro de los archivos contenidos en el mismo ensamblado *(.dll* archivo).</span><span class="sxs-lookup"><span data-stu-id="32314-157">Internal types or members are accessible only within files contained in the same assembly *(.dll* file).</span></span> <span data-ttu-id="32314-158">Al compilar la aplicación, un archivo de ensamblado *(.dll*) se crea que contiene el código que se ejecuta cuando se ejecute la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-158">When you build your application, an assembly file *(.dll*) is created that contains the code that is executed when you run your application.</span></span> 

<span data-ttu-id="32314-159">Un `RoleStore` object, que proporciona administración de roles, se crea basándose en el contexto de base de datos.</span><span class="sxs-lookup"><span data-stu-id="32314-159">A `RoleStore` object, which provides role management, is created based on the database context.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="32314-160">Tenga en cuenta que, cuando el `RoleStore` se crea el objeto usa un tipo genérico `IdentityRole` tipo.</span><span class="sxs-lookup"><span data-stu-id="32314-160">Notice that when the `RoleStore` object is created it uses a Generic `IdentityRole` type.</span></span> <span data-ttu-id="32314-161">Esto significa que el `RoleStore` solo puede contener `IdentityRole` objetos.</span><span class="sxs-lookup"><span data-stu-id="32314-161">This means that the `RoleStore` is only allowed to contain `IdentityRole` objects.</span></span> <span data-ttu-id="32314-162">También mediante el uso de genéricos, se administran mejor los recursos de memoria.</span><span class="sxs-lookup"><span data-stu-id="32314-162">Also by using Generics, resources in memory are handled better.</span></span>


<span data-ttu-id="32314-163">A continuación, el `RoleManager` de objetos, se crea basándose en la `RoleStore` objeto que acaba de crear.</span><span class="sxs-lookup"><span data-stu-id="32314-163">Next, the `RoleManager` object, is created based on the `RoleStore` object that you just created.</span></span> <span data-ttu-id="32314-164">el `RoleManager` objeto expone funciones relacionadas con la API que se puede usar para guardar automáticamente los cambios realizados en el `RoleStore`.</span><span class="sxs-lookup"><span data-stu-id="32314-164">the `RoleManager` object exposes role related API which can be used to automatically save changes to the `RoleStore`.</span></span> <span data-ttu-id="32314-165">El `RoleManager` solo puede contener `IdentityRole` objetos porque el código utiliza el `<IdentityRole>` tipo genérico.</span><span class="sxs-lookup"><span data-stu-id="32314-165">The `RoleManager` is only allowed to contain `IdentityRole` objects because the code uses the `<IdentityRole>` Generic type.</span></span>

<span data-ttu-id="32314-166">Se llama a la `RoleExists` método para determinar si el rol "canEdit" está presente en la base de datos de pertenencia.</span><span class="sxs-lookup"><span data-stu-id="32314-166">You call the `RoleExists` method to determine if the "canEdit" role is present in the membership database.</span></span> <span data-ttu-id="32314-167">Si no es así, cree el rol.</span><span class="sxs-lookup"><span data-stu-id="32314-167">If it is not, you create the role.</span></span>

<span data-ttu-id="32314-168">Crear el `UserManager` objeto parece ser más complicado que el `RoleManager` controlar, sin embargo es prácticamente el mismo.</span><span class="sxs-lookup"><span data-stu-id="32314-168">Creating the `UserManager` object appears to be more complicated than the `RoleManager` control, however it is nearly the same.</span></span> <span data-ttu-id="32314-169">Solo se codifica en una línea en lugar de varias.</span><span class="sxs-lookup"><span data-stu-id="32314-169">It is just coded on one line rather than several.</span></span> <span data-ttu-id="32314-170">En este caso, el parámetro que está pasando está creando instancias como un nuevo objeto contenido en los paréntesis.</span><span class="sxs-lookup"><span data-stu-id="32314-170">Here, the parameter that you are passing is instantiating as a new object contained in the parenthesis.</span></span>

<span data-ttu-id="32314-171">A continuación cree el usuario "canEditUser" mediante la creación de un nuevo `ApplicationUser` objeto.</span><span class="sxs-lookup"><span data-stu-id="32314-171">Next you create the "canEditUser" user by creating a new `ApplicationUser` object.</span></span> <span data-ttu-id="32314-172">A continuación, si consigue crear el usuario, agregue el usuario al nuevo rol.</span><span class="sxs-lookup"><span data-stu-id="32314-172">Then, if you successfully create the user, you add the user to the new role.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="32314-173">El control de errores se actualizará durante el tutorial "Control de errores de ASP.NET" más adelante en esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="32314-173">The error handling will be updated during the "ASP.NET Error Handling" tutorial later in this tutorial series.</span></span>


<span data-ttu-id="32314-174">La próxima vez que se inicia la aplicación, se agregará el usuario denominado "canEditUser" como la función denominada "canEdit" de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-174">The next time the application starts, the user named "canEditUser" will be added as the role named "canEdit" of the application.</span></span> <span data-ttu-id="32314-175">Más adelante en este tutorial, iniciará sesión como el usuario "canEditUser" para mostrar las capacidades adicionales que se agregan durante este tutorial.</span><span class="sxs-lookup"><span data-stu-id="32314-175">Later in this tutorial, you will login as the "canEditUser" user to display additional capabilities that you will added during this tutorial.</span></span> <span data-ttu-id="32314-176">Para obtener detalles de API acerca de la identidad de ASP.NET, vea el [Microsoft.AspNet.Identity Namespace](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="32314-176">For API details about ASP.NET Identity, see the [Microsoft.AspNet.Identity Namespace](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span></span> <span data-ttu-id="32314-177">Para obtener más información acerca de cómo inicializar el sistema ASP.NET Identity, vea el [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span><span class="sxs-lookup"><span data-stu-id="32314-177">For additional details about initializing the ASP.NET Identity system, see the [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span></span>

### <a name="restricting-access-to-the-administration-page"></a><span data-ttu-id="32314-178">Restringir el acceso a la página de administración</span><span class="sxs-lookup"><span data-stu-id="32314-178">Restricting Access to the Administration Page</span></span>

<span data-ttu-id="32314-179">La aplicación de ejemplo Wingtip Toys permite a los usuarios anónimos y los usuarios registrados ver y comprar productos.</span><span class="sxs-lookup"><span data-stu-id="32314-179">The Wingtip Toys sample application allows both anonymous users and logged-in users to view and purchase products.</span></span> <span data-ttu-id="32314-180">Sin embargo, el usuario que tenga el rol "canEdit" personalizado puede tener acceso a una página restringida con el fin de agregar y quitar los productos.</span><span class="sxs-lookup"><span data-stu-id="32314-180">However, the logged-in user that has the custom "canEdit" role can access a restricted page in order to add and remove products.</span></span>

#### <a name="add-an-administration-folder-and-page"></a><span data-ttu-id="32314-181">Agregar una carpeta de administración y la página</span><span class="sxs-lookup"><span data-stu-id="32314-181">Add an Administration Folder and Page</span></span>

<span data-ttu-id="32314-182">A continuación, creará una carpeta denominada *Admin* aplicación de ejemplo para el usuario "canEditUser" que pertenecen al rol personalizado de la serie de Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="32314-182">Next, you will create a folder named *Admin* for the "canEditUser" user belonging to the custom role of the Wingtip Toys sample application.</span></span>

1. <span data-ttu-id="32314-183">Haga clic en el nombre del proyecto (**Wingtip Toys**) en **el Explorador de soluciones** y seleccione **agregar**  - &gt; **nueva carpeta**.</span><span class="sxs-lookup"><span data-stu-id="32314-183">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add** -&gt; **New Folder**.</span></span>
2. <span data-ttu-id="32314-184">Nombre de la nueva carpeta *Admin*.</span><span class="sxs-lookup"><span data-stu-id="32314-184">Name the new folder *Admin*.</span></span>
3. <span data-ttu-id="32314-185">Haga clic en el *Admin* carpeta y, a continuación, seleccione **agregar**  - &gt; **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="32314-185">Right-click the *Admin* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="32314-186">Se abrirá el cuadro de diálogo **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="32314-186">The **Add New Item** dialog box is displayed.</span></span>
4. <span data-ttu-id="32314-187">Seleccione el <strong>Visual C#</strong> - &gt; <strong>Web</strong> grupo de plantillas de la izquierda.</span><span class="sxs-lookup"><span data-stu-id="32314-187">Select the <strong>Visual C#</strong>-&gt; <strong>Web</strong> templates group on the left.</span></span> <span data-ttu-id="32314-188">En la lista central, seleccione <strong>formulario Web Forms con página maestra</strong>, asígnele el nombre <em>AdminPage.aspx</em><strong>,</strong> y, a continuación, seleccione <strong>agregar</strong>.</span><span class="sxs-lookup"><span data-stu-id="32314-188">From the middle list, select <strong>Web Form with Master Page</strong>,name it <em>AdminPage.aspx</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
5. <span data-ttu-id="32314-189">Seleccione el *Site.Master* de archivos como la página maestra y, a continuación, elija **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="32314-189">Select the *Site.Master* file as the master page, and then choose **OK**.</span></span>

#### <a name="add-a-webconfig-file"></a><span data-ttu-id="32314-190">Agregue un archivo Web.config</span><span class="sxs-lookup"><span data-stu-id="32314-190">Add a Web.config File</span></span>

<span data-ttu-id="32314-191">Agregando un *Web.config* del archivo a la *Admin* carpeta, puede restringir el acceso a la página de contenidos en la carpeta.</span><span class="sxs-lookup"><span data-stu-id="32314-191">By adding a *Web.config* file to the *Admin* folder, you can restrict access to the page contained in the folder.</span></span>

1. <span data-ttu-id="32314-192">Haga clic en el *Admin* carpeta y seleccione **agregar**  - &gt; **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="32314-192">Right-click the *Admin* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="32314-193">Se abrirá el cuadro de diálogo **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="32314-193">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="32314-194">En la lista de plantillas web de Visual C#, seleccione <strong>archivo de configuración Web</strong>desde la lista del medio, acepte el nombre predeterminado de <em>Web.config</em><strong>,</strong> y, a continuación, seleccione <strong>Agregar</strong>.</span><span class="sxs-lookup"><span data-stu-id="32314-194">From the list of Visual C# web templates, select <strong>Web Configuration File</strong>from the middle list, accept the default name of <em>Web.config</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
3. <span data-ttu-id="32314-195">Reemplace el contenido XML del *Web.config* archivo por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="32314-195">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](membership-and-administration/samples/sample4.xml)]

<span data-ttu-id="32314-196">Guardar el *Web.config* archivo.</span><span class="sxs-lookup"><span data-stu-id="32314-196">Save the *Web.config* file.</span></span> <span data-ttu-id="32314-197">El *Web.config* archivo Especifica que sólo el usuario que pertenecen al rol "canEdit" de la aplicación puede tener acceso a la página de contenido en el *Admin* carpeta.</span><span class="sxs-lookup"><span data-stu-id="32314-197">The *Web.config* file specifies that only user belonging to the "canEdit" role of the application can access the page contained in the *Admin* folder.</span></span>

### <a name="including-custom-role-navigation"></a><span data-ttu-id="32314-198">Incluida la navegación del rol personalizado</span><span class="sxs-lookup"><span data-stu-id="32314-198">Including Custom Role Navigation</span></span>

<span data-ttu-id="32314-199">Para permitir al usuario del rol "canEdit" personalizada navegar hasta la sección de administración de la aplicación, debe agregar un vínculo a la *Site.Master* página.</span><span class="sxs-lookup"><span data-stu-id="32314-199">To enable the user of the custom "canEdit" role to navigate to the administration section of the application, you must add a link to the *Site.Master* page.</span></span> <span data-ttu-id="32314-200">Solo los usuarios que pertenecen al rol "canEdit" podrán ver el **Admin** vincular y tener acceso a la sección de administración.</span><span class="sxs-lookup"><span data-stu-id="32314-200">Only users that belong to the "canEdit" role will be able to see the **Admin** link and access the administration section.</span></span>

1. <span data-ttu-id="32314-201">En el Explorador de soluciones, busque y abra el *Site.Master* página.</span><span class="sxs-lookup"><span data-stu-id="32314-201">In Solution Explorer, find and open the *Site.Master* page.</span></span>
2. <span data-ttu-id="32314-202">Para crear un vínculo para el usuario del rol "canEdit", agregue el marcado resaltado en amarillo en la siguiente lista sin ordenar `<ul>` elemento para que aparezca la lista como sigue:</span><span class="sxs-lookup"><span data-stu-id="32314-202">To create a link for the user of the "canEdit" role, add the markup highlighted in yellow to the following unordered list `<ul>` element so that the list appears as follows:</span></span>  

    [!code-html[Main](membership-and-administration/samples/sample5.html?highlight=2-3)]
3. <span data-ttu-id="32314-203">Abra el *Site.Master.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="32314-203">Open the *Site.Master.cs* file.</span></span> <span data-ttu-id="32314-204">Realizar el **Admin** vínculo solo está visible para el usuario "canEditUser" agregando el código resaltado en amarillo en la `Page_Load` controlador.</span><span class="sxs-lookup"><span data-stu-id="32314-204">Make the **Admin** link visible only to the "canEditUser" user by adding the code highlighted in yellow to the `Page_Load` handler.</span></span> <span data-ttu-id="32314-205">El `Page_Load` controlador aparecerá como sigue:</span><span class="sxs-lookup"><span data-stu-id="32314-205">The `Page_Load` handler will appear as follows:</span></span>   

    [!code-csharp[Main](membership-and-administration/samples/sample6.cs?highlight=3-6)]

<span data-ttu-id="32314-206">Cuando se carga la página, el código comprueba si el usuario ha iniciado sesión tiene el rol de "canEdit".</span><span class="sxs-lookup"><span data-stu-id="32314-206">When the page loads, the code checks whether the logged-in user has the role of "canEdit".</span></span> <span data-ttu-id="32314-207">Si el usuario pertenece al rol "canEdit", el elemento span que contiene el vínculo a la *AdminPage.aspx* página (y por consiguiente el vínculo dentro del intervalo) se hacen visibles.</span><span class="sxs-lookup"><span data-stu-id="32314-207">If the user belongs to the "canEdit" role, the span element containing the link to the *AdminPage.aspx* page (and consequently the link inside the span) is made visible.</span></span>

### <a name="enabling-product-administration"></a><span data-ttu-id="32314-208">Habilitar la administración de productos</span><span class="sxs-lookup"><span data-stu-id="32314-208">Enabling Product Administration</span></span>

<span data-ttu-id="32314-209">Hasta ahora, ha creado el rol "canEdit" y agregar un usuario "canEditUser", una carpeta de administración y una página de administración.</span><span class="sxs-lookup"><span data-stu-id="32314-209">So far, you have created the "canEdit" role and added an "canEditUser" user, an administration folder, and an administration page.</span></span> <span data-ttu-id="32314-210">Se han establecido derechos de acceso de la carpeta de administración y la página y ha agregado un vínculo de navegación para el usuario del rol "canEdit" a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-210">You have set access rights for the administration folder and page, and have added a navigation link for the user of the "canEdit" role to the application.</span></span> <span data-ttu-id="32314-211">A continuación, agregará código para el *AdminPage.aspx* página y el código para el *AdminPage.aspx.cs* archivo de código subyacente que permitirá al usuario con el rol "canEdit" Agregar y quitar los productos.</span><span class="sxs-lookup"><span data-stu-id="32314-211">Next, you will add markup to the *AdminPage.aspx* page and code to the *AdminPage.aspx.cs* code-behind file that will enable the user with the "canEdit" role to add and remove products.</span></span>

1. <span data-ttu-id="32314-212">En **el Explorador de soluciones**, abra el *AdminPage.aspx* de archivos desde el *Admin* carpeta.</span><span class="sxs-lookup"><span data-stu-id="32314-212">In **Solution Explorer**, open the *AdminPage.aspx* file from the *Admin* folder.</span></span>
2. <span data-ttu-id="32314-213">Reemplace el marcado existente por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="32314-213">Replace the existing markup with the following:</span></span>  

    [!code-aspx[Main](membership-and-administration/samples/sample7.aspx)]
3. <span data-ttu-id="32314-214">A continuación, abra el *AdminPage.aspx.cs* archivo de código subyacente con el botón secundario del *AdminPage.aspx* y haga clic en **ver código**.</span><span class="sxs-lookup"><span data-stu-id="32314-214">Next, open the *AdminPage.aspx.cs* code-behind file by right-clicking the *AdminPage.aspx* and clicking **View Code**.</span></span>
4. <span data-ttu-id="32314-215">Reemplace el código existente en el *AdminPage.aspx.cs* archivo de código subyacente con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="32314-215">Replace the existing code in the *AdminPage.aspx.cs* code-behind file with the following code:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample8.cs)]

<span data-ttu-id="32314-216">En el código que escribió para el *AdminPage.aspx.cs* archivo de código subyacente, una clase denominada `AddProducts` realiza el trabajo real de agregar productos a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="32314-216">In the code that you entered for the *AdminPage.aspx.cs* code-behind file, a class called `AddProducts` does the actual work of adding products to the database.</span></span> <span data-ttu-id="32314-217">Esta clase no existe aún, por lo que creará ahora.</span><span class="sxs-lookup"><span data-stu-id="32314-217">This class doesn't exist yet, so you will create it now.</span></span>

1. <span data-ttu-id="32314-218">En **el Explorador de soluciones**, haga clic en el *lógica* carpeta y, a continuación, seleccione **agregar**  - &gt; **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="32314-218">In **Solution Explorer**, right-click the *Logic* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="32314-219">Se abrirá el cuadro de diálogo **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="32314-219">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="32314-220">Seleccione el **Visual C#**  - &gt; **código** grupo de plantillas de la izquierda.</span><span class="sxs-lookup"><span data-stu-id="32314-220">Select the **Visual C#** -&gt; **Code** templates group on the left.</span></span> <span data-ttu-id="32314-221">A continuación, seleccione **clase**desde la parte central de lista y asígnele el nombre *AddProducts.cs*.</span><span class="sxs-lookup"><span data-stu-id="32314-221">Then, select **Class**from the middle list and name it *AddProducts.cs*.</span></span>   
   <span data-ttu-id="32314-222">Se muestra el nuevo archivo de clase.</span><span class="sxs-lookup"><span data-stu-id="32314-222">The new class file is displayed.</span></span>
3. <span data-ttu-id="32314-223">Reemplace el código existente por el siguiente:</span><span class="sxs-lookup"><span data-stu-id="32314-223">Replace the existing code with the following:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample9.cs)]

<span data-ttu-id="32314-224">El *AdminPage.aspx* página permite al usuario que pertenecen al rol "canEdit" Agregar y quitar los productos.</span><span class="sxs-lookup"><span data-stu-id="32314-224">The *AdminPage.aspx* page allows the user belonging to the "canEdit" role to add and remove products.</span></span> <span data-ttu-id="32314-225">Cuando se agrega un nuevo producto, los detalles sobre el producto se validan y, a continuación, introducidos en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="32314-225">When a new product is added, the details about the product are validated and then entered into the database.</span></span> <span data-ttu-id="32314-226">El nuevo producto está inmediatamente disponible para todos los usuarios de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="32314-226">The new product is immediately available to all users of the web application.</span></span>

#### <a name="unobtrusive-validation"></a><span data-ttu-id="32314-227">Validación discreta</span><span class="sxs-lookup"><span data-stu-id="32314-227">Unobtrusive Validation</span></span>

<span data-ttu-id="32314-228">Los detalles del producto que proporciona el usuario en el *AdminPage.aspx* página se validan mediante los controles de validación (`RequiredFieldValidator` y `RegularExpressionValidator`).</span><span class="sxs-lookup"><span data-stu-id="32314-228">The product details that the user provides on the *AdminPage.aspx* page are validated using validation controls (`RequiredFieldValidator` and `RegularExpressionValidator`).</span></span> <span data-ttu-id="32314-229">Estos controles usa automáticamente la validación discreta.</span><span class="sxs-lookup"><span data-stu-id="32314-229">These controls automatically use unobtrusive validation.</span></span> <span data-ttu-id="32314-230">Validación discreta permite usar JavaScript para la lógica de validación del lado cliente, lo que significa que la página no requiere un viaje en el servidor para validar los controles de validación.</span><span class="sxs-lookup"><span data-stu-id="32314-230">Unobtrusive validation allows the validation controls to use JavaScript for client-side validation logic, which means the page does not require a trip to the server to be validated.</span></span> <span data-ttu-id="32314-231">De forma predeterminada, se incluye la validación discreta en el *Web.config* basado en archivos en la siguiente configuración:</span><span class="sxs-lookup"><span data-stu-id="32314-231">By default, unobtrusive validation is included in the *Web.config* file based on the following configuration setting:</span></span>

[!code-xml[Main](membership-and-administration/samples/sample10.xml)]

#### <a name="regular-expressions"></a><span data-ttu-id="32314-232">Expresiones regulares</span><span class="sxs-lookup"><span data-stu-id="32314-232">Regular Expressions</span></span>

<span data-ttu-id="32314-233">El precio del producto en el *AdminPage.aspx* página se valida con un **RegularExpressionValidator** control.</span><span class="sxs-lookup"><span data-stu-id="32314-233">The product price on the *AdminPage.aspx* page is validated using a **RegularExpressionValidator** control.</span></span> <span data-ttu-id="32314-234">Este control se valida si el valor del control de entrada asociado (el cuadro de texto "AddProductPrice") coincide con el patrón especificado por la expresión regular.</span><span class="sxs-lookup"><span data-stu-id="32314-234">This control validates whether the value of the associated input control (the "AddProductPrice" TextBox) matches the pattern specified by the regular expression.</span></span> <span data-ttu-id="32314-235">Una expresión regular es una notación de coincidencia de patrones que le permite encontrar rápidamente y coinciden con patrones de caracteres específicos.</span><span class="sxs-lookup"><span data-stu-id="32314-235">A regular expression is a pattern-matching notation that enables you to quickly find and match specific character patterns.</span></span> <span data-ttu-id="32314-236">El **RegularExpressionValidator** control incluye una propiedad denominada `ValidationExpression` que contiene la expresión regular utilizada para validar la entrada de precio, como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="32314-236">The **RegularExpressionValidator** control includes a property named `ValidationExpression` that contains the regular expression used to validate price input, as shown below:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample11.aspx)]

#### <a name="fileupload-control"></a><span data-ttu-id="32314-237">Control fileUpload</span><span class="sxs-lookup"><span data-stu-id="32314-237">FileUpload Control</span></span>

<span data-ttu-id="32314-238">Además de los controles de entrada y validación, agregó el **FileUpload** el control a la *AdminPage.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="32314-238">In addition to the input and validation controls, you added the **FileUpload** control to the *AdminPage.aspx* page.</span></span> <span data-ttu-id="32314-239">Este control proporciona la capacidad para cargar archivos.</span><span class="sxs-lookup"><span data-stu-id="32314-239">This control provides the capability to upload files.</span></span> <span data-ttu-id="32314-240">En este caso, solo se permite cargar los archivos de imagen.</span><span class="sxs-lookup"><span data-stu-id="32314-240">In this case, you are only allowing image files to be uploaded.</span></span> <span data-ttu-id="32314-241">En el archivo de código subyacente (*AdminPage.aspx.cs*), cuando el `AddProductButton` se hace clic en, el código comprueba el `HasFile` propiedad de la **FileUpload** control.</span><span class="sxs-lookup"><span data-stu-id="32314-241">In the code-behind file (*AdminPage.aspx.cs*), when the `AddProductButton` is clicked, the code checks the `HasFile` property of the **FileUpload** control.</span></span> <span data-ttu-id="32314-242">Si el control tiene un archivo y si se permite el tipo de archivo (según la extensión de archivo), la imagen se guarda en el *imágenes* carpeta y el *imágenes/pulgares* carpeta de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-242">If the control has a file and if the file type (based on file extension) is allowed, the image is saved to the *Images* folder and the *Images/Thumbs* folder of the application.</span></span>

#### <a name="model-binding"></a><span data-ttu-id="32314-243">Enlace de modelos</span><span class="sxs-lookup"><span data-stu-id="32314-243">Model Binding</span></span>

<span data-ttu-id="32314-244">Anteriormente en esta serie de tutoriales se usa el enlace de modelos para rellenar un **ListView** (control), un **FormsView** (control), un **GridView** control y un  **DetailView** control.</span><span class="sxs-lookup"><span data-stu-id="32314-244">Earlier in this tutorial series you used model binding to populate a **ListView** control, a **FormsView** control, a **GridView** control, and a **DetailView** control.</span></span> <span data-ttu-id="32314-245">En este tutorial, use el enlace de modelos para rellenar un **DropDownList** control con una lista de categorías de productos.</span><span class="sxs-lookup"><span data-stu-id="32314-245">In this tutorial, you use model binding to populate a **DropDownList** control with a list of product categories.</span></span>

<span data-ttu-id="32314-246">El marcado que se ha agregado a la *AdminPage.aspx* archivo contiene un **DropDownList** control denominado `DropDownAddCategory`:</span><span class="sxs-lookup"><span data-stu-id="32314-246">The markup that you added to the *AdminPage.aspx* file contains a **DropDownList** control called `DropDownAddCategory`:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample12.aspx)]

<span data-ttu-id="32314-247">Usar el enlace de modelos para rellenar esta **DropDownList** estableciendo el `ItemType` atributo y el `SelectMethod` atributo.</span><span class="sxs-lookup"><span data-stu-id="32314-247">You use model binding to populate this **DropDownList** by setting the `ItemType` attribute and the `SelectMethod` attribute.</span></span> <span data-ttu-id="32314-248">El `ItemType` atributo especifica que se usa el `WingtipToys.Models.Category` escriba al rellenar el control.</span><span class="sxs-lookup"><span data-stu-id="32314-248">The `ItemType` attribute specifies that you use the `WingtipToys.Models.Category` type when populating the control.</span></span> <span data-ttu-id="32314-249">Este tipo al principio de esta serie de tutoriales se define mediante la creación del `Category` clase (se muestra a continuación).</span><span class="sxs-lookup"><span data-stu-id="32314-249">You defined this type at the beginning of this tutorial series by creating the `Category` class (shown below).</span></span> <span data-ttu-id="32314-250">El `Category` clase está en el *modelos* carpeta dentro de la *Category.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="32314-250">The `Category` class is in the *Models* folder inside the *Category.cs* file.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample13.cs)]

<span data-ttu-id="32314-251">El `SelectMethod` atributo de la **DropDownList** control especifica que se usa el `GetCategories` método (que se muestra a continuación) que es incluido en el archivo de código subyacente (*AdminPage.aspx.cs*).</span><span class="sxs-lookup"><span data-stu-id="32314-251">The `SelectMethod` attribute of the **DropDownList** control specifies that you use the `GetCategories` method (shown below) that is included in the code-behind file (*AdminPage.aspx.cs*).</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample14.cs)]

<span data-ttu-id="32314-252">Este método especifica que un `IQueryable` interfaz se usa para evaluar una consulta en un `Category` tipo.</span><span class="sxs-lookup"><span data-stu-id="32314-252">This method specifies that an `IQueryable` interface is used to evaluate a query against a `Category` type.</span></span> <span data-ttu-id="32314-253">El valor devuelto se usa para rellenar el **DropDownList** en el marcado de la página (*AdminPage.aspx*).</span><span class="sxs-lookup"><span data-stu-id="32314-253">The returned value is used to populate the **DropDownList** in the markup of the page (*AdminPage.aspx*).</span></span>

<span data-ttu-id="32314-254">El texto mostrado para cada elemento de la lista se especifica estableciendo el `DataTextField` atributo.</span><span class="sxs-lookup"><span data-stu-id="32314-254">The text displayed for each item in the list is specified by setting the `DataTextField` attribute.</span></span> <span data-ttu-id="32314-255">El `DataTextField` atributo usa el `CategoryName` de la `Category` clase (mostrado anteriormente) para mostrar cada categoría en la **DropDownList** control.</span><span class="sxs-lookup"><span data-stu-id="32314-255">The `DataTextField` attribute uses the `CategoryName` of the `Category` class (shown above) to display each category in the **DropDownList** control.</span></span> <span data-ttu-id="32314-256">El valor real que se pasa cuando se selecciona un elemento en el **DropDownList** control se basa en el `DataValueField` atributo.</span><span class="sxs-lookup"><span data-stu-id="32314-256">The actual value that is passed when an item is selected in the **DropDownList** control is based on the `DataValueField` attribute.</span></span> <span data-ttu-id="32314-257">El `DataValueField` atributo está establecido en el `CategoryID` tal y como se definen en el `Category` clase (mostrado anteriormente).</span><span class="sxs-lookup"><span data-stu-id="32314-257">The `DataValueField` attribute is set to the `CategoryID` as define in the `Category` class (shown above).</span></span>

### <a name="how-the-application-will-work"></a><span data-ttu-id="32314-258">Funcionamiento de la aplicación</span><span class="sxs-lookup"><span data-stu-id="32314-258">How the Application Will Work</span></span>

<span data-ttu-id="32314-259">Cuando el usuario que pertenecen al rol "canEdit" navega a la página por primera vez, el `DropDownAddCategory` **DropDownList** se rellena el control como se describió anteriormente.</span><span class="sxs-lookup"><span data-stu-id="32314-259">When the user belonging to the "canEdit" role navigates to the page for the first time, the `DropDownAddCategory`**DropDownList** control is populated as described above.</span></span> <span data-ttu-id="32314-260">El `DropDownRemoveProduct` **DropDownList** control también se rellena con los productos con el mismo enfoque.</span><span class="sxs-lookup"><span data-stu-id="32314-260">The `DropDownRemoveProduct`**DropDownList** control is also populated with products using the same approach.</span></span> <span data-ttu-id="32314-261">El usuario que pertenezca al rol "canEdit" selecciona el tipo de categoría y agrega los detalles del producto (**nombre**, **descripción**, **precio**, y **delarchivodeimagen**).</span><span class="sxs-lookup"><span data-stu-id="32314-261">The user belonging to the "canEdit" role selects the category type and adds product details (**Name**, **Description**, **Price**, and **Image File**).</span></span> <span data-ttu-id="32314-262">Cuando hace clic en el usuario que pertenezca al rol "canEdit" el **agregar producto** botón, el `AddProductButton_Click` se activa el controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="32314-262">When the user belonging to the "canEdit" role clicks the **Add Product** button, the `AddProductButton_Click` event handler is triggered.</span></span> <span data-ttu-id="32314-263">El `AddProductButton_Click` controlador de eventos que se encuentra en el archivo de código subyacente (*AdminPage.aspx.cs*) comprueba el archivo de imagen para asegurarse de que coincida con los tipos de archivo permitidos *(.gif*, *.png*, *.jpeg*, o *.jpg*).</span><span class="sxs-lookup"><span data-stu-id="32314-263">The `AddProductButton_Click` event handler located in the code-behind file (*AdminPage.aspx.cs*) checks the image file to make sure it matches the allowed file types *(.gif*, *.png*, *.jpeg*, or *.jpg*).</span></span> <span data-ttu-id="32314-264">A continuación, se guarda el archivo de imagen en una carpeta de la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="32314-264">Then, the image file is saved into a folder of the Wingtip Toys sample application.</span></span> <span data-ttu-id="32314-265">A continuación, se agrega el nuevo producto a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="32314-265">Next, the new product is added to the database.</span></span> <span data-ttu-id="32314-266">Para agregar un nuevo producto, una nueva instancia de la `AddProducts` clase se crea y denominada products.</span><span class="sxs-lookup"><span data-stu-id="32314-266">To accomplish adding a new product, a new instance of the `AddProducts` class is created and named products.</span></span> <span data-ttu-id="32314-267">El `AddProducts` clase tiene un método denominado `AddProduct`, y el objeto de productos, llama a este método para agregar productos a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="32314-267">The `AddProducts` class has a method named `AddProduct`, and the products object calls this method to add products to the database.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample15.cs)]

<span data-ttu-id="32314-268">Si el código agrega correctamente el nuevo producto a la base de datos, se vuelve a cargar la página con el valor de cadena de consulta `ProductAction=add`.</span><span class="sxs-lookup"><span data-stu-id="32314-268">If the code successfully adds the new product to the database, the page is reloaded with the query string value `ProductAction=add`.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample16.cs)]

<span data-ttu-id="32314-269">Cuando vuelve a cargar la página, se incluye la cadena de consulta en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="32314-269">When the page reloads, the query string is included in the URL.</span></span> <span data-ttu-id="32314-270">Volviendo a cargar la página, el usuario que pertenezca al rol "canEdit" puede ver inmediatamente las actualizaciones en el **DropDownList** a los controles de la *AdminPage.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="32314-270">By reloading the page, the user belonging to the "canEdit" role can immediately see the updates in the **DropDownList** controls on the *AdminPage.aspx* page.</span></span> <span data-ttu-id="32314-271">Además, mediante la inclusión de la cadena de consulta con la dirección URL, la página puede mostrar un mensaje de confirmación al usuario que pertenecen al rol "canEdit".</span><span class="sxs-lookup"><span data-stu-id="32314-271">Also, by including the query string with the URL, the page can display a success message to the user belonging to the "canEdit" role.</span></span>

<span data-ttu-id="32314-272">Cuando el *AdminPage.aspx* página recargas, el `Page_Load` se llama al evento.</span><span class="sxs-lookup"><span data-stu-id="32314-272">When the *AdminPage.aspx* page reloads, the `Page_Load` event is called.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample17.cs)]

<span data-ttu-id="32314-273">El `Page_Load` controlador de eventos comprueba el valor de cadena de consulta y determina si se debe mostrar un mensaje de confirmación.</span><span class="sxs-lookup"><span data-stu-id="32314-273">The `Page_Load` event handler checks the query string value and determines whether to show a success message.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="32314-274">Ejecutar la aplicación</span><span class="sxs-lookup"><span data-stu-id="32314-274">Running the Application</span></span>

<span data-ttu-id="32314-275">Puede ejecutar la aplicación ahora para ver cómo se puede agregar, eliminar y actualizar elementos en el carro de la compra.</span><span class="sxs-lookup"><span data-stu-id="32314-275">You can run the application now to see how you can add, delete, and update items in the shopping cart.</span></span> <span data-ttu-id="32314-276">El total del carro de la compra reflejará el costo total de todos los elementos en el carro de la compra.</span><span class="sxs-lookup"><span data-stu-id="32314-276">The shopping cart total will reflect the total cost of all items in the shopping cart.</span></span>

1. <span data-ttu-id="32314-277">En el Explorador de soluciones, presione **F5** para ejecutar la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="32314-277">In Solution Explorer, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="32314-278">El explorador se abre y muestra el *Default.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="32314-278">The browser opens and shows the *Default.aspx* page.</span></span>
2. <span data-ttu-id="32314-279">Haga clic en el **iniciarla** vínculo en la parte superior de la página.</span><span class="sxs-lookup"><span data-stu-id="32314-279">Click the **Log in** link at the top of the page.</span></span> 

    ![Pertenencia y administración - inicie sesión en el vínculo](membership-and-administration/_static/image2.png)

   <span data-ttu-id="32314-281">El *Login.aspx* se muestra la página.</span><span class="sxs-lookup"><span data-stu-id="32314-281">The *Login.aspx* page is displayed.</span></span>
3. <span data-ttu-id="32314-282">Use el siguiente nombre de usuario y la contraseña:</span><span class="sxs-lookup"><span data-stu-id="32314-282">Use the following user name and password:</span></span>  
   <span data-ttu-id="32314-283">Nombre de usuario: canEditUser@wingtiptoys.com</span><span class="sxs-lookup"><span data-stu-id="32314-283">User name: canEditUser@wingtiptoys.com</span></span>  
   <span data-ttu-id="32314-284">Contraseña: Pa$$word1</span><span class="sxs-lookup"><span data-stu-id="32314-284">Password: Pa$$word1</span></span> 

    ![Pertenencia y administración - inicie sesión en la página](membership-and-administration/_static/image3.png)
4. <span data-ttu-id="32314-286">Haga clic en el **iniciarla** situado cerca de la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="32314-286">Click the **Log in** button near the bottom of the page.</span></span>
5. <span data-ttu-id="32314-287">En la parte superior de la página siguiente, seleccione el **Admin** vínculo para ir a la *AdminPage.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="32314-287">At the top of the next page, select the **Admin** link to navigate to the *AdminPage.aspx* page.</span></span> 

    ![Pertenencia y administración - vínculo de administración](membership-and-administration/_static/image4.png)
6. <span data-ttu-id="32314-289">Para probar la validación de entrada, haga clic en el **agregar producto** botón sin agregar los detalles del producto.</span><span class="sxs-lookup"><span data-stu-id="32314-289">To test the input validation, click the **Add Product** button without adding any product details.</span></span> 

    ![Pertenencia y administración - página de administración](membership-and-administration/_static/image5.png)

   <span data-ttu-id="32314-291">Tenga en cuenta que se muestran los mensajes de campo obligatorio.</span><span class="sxs-lookup"><span data-stu-id="32314-291">Notice that the required field messages are displayed.</span></span>
7. <span data-ttu-id="32314-292">Agregue los detalles de un producto nuevo y, a continuación, haga clic en el **agregar producto** botón.</span><span class="sxs-lookup"><span data-stu-id="32314-292">Add the details for a new product, and then click the **Add Product** button.</span></span> 

    ![Pertenencia y administración - agregar producto](membership-and-administration/_static/image6.png)
8. <span data-ttu-id="32314-294">Seleccione **productos** desde el menú de navegación superior para ver el nuevo producto que agregó.</span><span class="sxs-lookup"><span data-stu-id="32314-294">Select **Products** from the top navigation menu to view the new product you added.</span></span> 

    ![Pertenencia y administración - mostrar el nuevo producto](membership-and-administration/_static/image7.png)
9. <span data-ttu-id="32314-296">Haga clic en el **administrador** para volver a la página de administración.</span><span class="sxs-lookup"><span data-stu-id="32314-296">Click the **Admin** link to return to the administration page.</span></span>
10. <span data-ttu-id="32314-297">En el **quitar producto** sección de la página, seleccione el nuevo producto que agregó en el **DropDownListBox**.</span><span class="sxs-lookup"><span data-stu-id="32314-297">In the **Remove Product** section of the page, select the new product you added in the **DropDownListBox**.</span></span>
11. <span data-ttu-id="32314-298">Haga clic en el **quitar producto** botón para quitar el nuevo producto de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32314-298">Click the **Remove Product** button to remove the new product from the application.</span></span> 

    ![Pertenencia y administración - Remove producto](membership-and-administration/_static/image8.png)
12. <span data-ttu-id="32314-300">Seleccione **productos** en el menú de navegación superior para confirmar que el producto se ha quitado.</span><span class="sxs-lookup"><span data-stu-id="32314-300">Select **Products** from the top navigation menu to confirm that the product has been removed.</span></span>
13. <span data-ttu-id="32314-301">Haga clic en **cerrar** que exista el modo de administración.</span><span class="sxs-lookup"><span data-stu-id="32314-301">Click **Log off** to exist administration mode.</span></span>   
    <span data-ttu-id="32314-302">Tenga en cuenta que el panel de navegación superior ya no muestra la **Admin** elemento de menú.</span><span class="sxs-lookup"><span data-stu-id="32314-302">Notice that the top navigation pane no longer shows the **Admin** menu item.</span></span>

## <a name="summary"></a><span data-ttu-id="32314-303">Resumen</span><span class="sxs-lookup"><span data-stu-id="32314-303">Summary</span></span>

<span data-ttu-id="32314-304">En este tutorial, ha agregado un rol personalizado y un usuario que pertenezca al rol personalizado, acceso restringido a la carpeta de administración y la página y proporciona navegación para el usuario que pertenezca al rol personalizado.</span><span class="sxs-lookup"><span data-stu-id="32314-304">In this tutorial, you added a custom role and a user belonging to the custom role, restricted access to the administration folder and page, and provided navigation for the user belonging to the custom role.</span></span> <span data-ttu-id="32314-305">Usa el enlace de modelos para rellenar un **DropDownList** control con datos.</span><span class="sxs-lookup"><span data-stu-id="32314-305">You used model binding to populate a **DropDownList** control with data.</span></span> <span data-ttu-id="32314-306">Se implementa el **FileUpload** control y los controles de validación.</span><span class="sxs-lookup"><span data-stu-id="32314-306">You implemented the **FileUpload** control and validation controls.</span></span> <span data-ttu-id="32314-307">Además, ha aprendido a agregar y quitar los productos de una base de datos.</span><span class="sxs-lookup"><span data-stu-id="32314-307">Also, you have learned how to add and remove products from a database.</span></span> <span data-ttu-id="32314-308">En el siguiente tutorial, obtendrá información sobre cómo implementar el enrutamiento de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="32314-308">In the next tutorial, you'll learn how to implement ASP.NET routing.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="32314-309">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="32314-309">Additional Resources</span></span>

<span data-ttu-id="32314-310">[Web.config - elemento authorization](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="32314-310">[Web.config - authorization Element](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="32314-311">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="32314-311">ASP.NET Identity</span></span>](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md)  
[<span data-ttu-id="32314-312">Implementar una aplicación de formularios Web ASP.NET segura con pertenencia, OAuth y SQL Database en un sitio Web de Azure</span><span class="sxs-lookup"><span data-stu-id="32314-312">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to an Azure Web Site</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="32314-313">Microsoft Azure - evaluación gratuita</span><span class="sxs-lookup"><span data-stu-id="32314-313">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

> [!div class="step-by-step"]
> <span data-ttu-id="32314-314">[Anterior](checkout-and-payment-with-paypal.md)
> [Siguiente](url-routing.md)</span><span class="sxs-lookup"><span data-stu-id="32314-314">[Previous](checkout-and-payment-with-paypal.md)
[Next](url-routing.md)</span></span>
