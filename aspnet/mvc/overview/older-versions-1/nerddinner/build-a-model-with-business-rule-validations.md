---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Crear un modelo con validaciones de reglas de negocios Microsoft Docs
author: rick-anderson
description: El paso 3 muestra cómo crear un modelo que podemos usar para consultar y actualizar la base de datos de nuestra aplicación NerdDinner.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 1a316e9051cf56cd4f1546336b334ace991c05b3
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541642"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="99a42-103">Crear un modelo con validaciones de regla de negocios</span><span class="sxs-lookup"><span data-stu-id="99a42-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="99a42-104">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="99a42-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="99a42-105">Descargar PDF</span><span class="sxs-lookup"><span data-stu-id="99a42-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="99a42-106">Este es el paso 3 de un tutorial gratuito de la [aplicación "NerdDinner"](introducing-the-nerddinner-tutorial.md) que describe cómo crear una aplicación web pequeña, pero completa, mediante ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="99a42-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="99a42-107">El paso 3 muestra cómo crear un modelo que podemos usar para consultar y actualizar la base de datos de nuestra aplicación NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="99a42-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="99a42-108">Si usa ASP.NET MVC 3, le recomendamos que siga los tutoriales [Introducción a MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) o [MVC Music Store.](../../older-versions/mvc-music-store/mvc-music-store-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="99a42-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="99a42-109">NerdDinner Paso 3: Construyendo el modelo</span><span class="sxs-lookup"><span data-stu-id="99a42-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="99a42-110">En un marco de modelo-vista-controlador el término "modelo" hace referencia a los objetos que representan los datos de la aplicación, así como la lógica de dominio correspondiente que integra la validación y las reglas de negocio con ella.</span><span class="sxs-lookup"><span data-stu-id="99a42-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="99a42-111">El modelo es en muchos sentidos el "corazón" de una aplicación basada en MVC, y como veremos más adelante impulsa fundamentalmente el comportamiento de la misma.</span><span class="sxs-lookup"><span data-stu-id="99a42-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="99a42-112">El marco de ASP.NET MVC admite el uso de cualquier tecnología de acceso a datos y los desarrolladores pueden elegir entre una variedad de opciones de datos de .NET enriquecidas para implementar sus modelos, incluidos: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM o simplemente ADO.NET DataReaders o DataSets sin procesar.</span><span class="sxs-lookup"><span data-stu-id="99a42-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="99a42-113">Para nuestra aplicación NerdDinner vamos a usar LINQ to SQLLINQ to SQL para crear un modelo simple que se corresponda bastante estrechamente con nuestro diseño de base de datos y agregue algunas reglas de negocio y lógica de validación personalizadas.</span><span class="sxs-lookup"><span data-stu-id="99a42-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="99a42-114">A continuación, implementaremos una clase de repositorio que ayuda a abstraer la implementación de persistencia de datos del resto de la aplicación y nos permite probarla unitariamente.</span><span class="sxs-lookup"><span data-stu-id="99a42-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="99a42-115">LINQ a SQL</span><span class="sxs-lookup"><span data-stu-id="99a42-115">LINQ to SQL</span></span>

<span data-ttu-id="99a42-116">LINQ to SQLLINQ to SQL es un ORM (asignador relacional de objetos) que se incluye como parte de .NET 3.5.</span><span class="sxs-lookup"><span data-stu-id="99a42-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="99a42-117">LINQ to SQLLINQ to SQL proporciona una manera sencilla de asignar tablas de base de datos a clases .NET con las que podemos codificar.</span><span class="sxs-lookup"><span data-stu-id="99a42-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="99a42-118">Para nuestra aplicación NerdDinner lo usaremos para asignar las tablas Dinners y RSVP dentro de nuestra base de datos a clases Dinner y RSVP.</span><span class="sxs-lookup"><span data-stu-id="99a42-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="99a42-119">Las columnas de las tablas Dinners y RSVP corresponderán a las propiedades de las clases Dinner y RSVP.</span><span class="sxs-lookup"><span data-stu-id="99a42-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="99a42-120">Cada objeto Dinner y RSVP representará una fila independiente dentro de las tablas Dinners o RSVP de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="99a42-121">LINQ to SQLLINQ to SQL nos permite evitar tener que construir manualmente instrucciones SQL para recuperar y actualizar objetos Dinner y RSVP con datos de base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="99a42-122">En su lugar, definiremos las clases Dinner y RSVP, cómo se asignan a/desde la base de datos y las relaciones entre ellas.</span><span class="sxs-lookup"><span data-stu-id="99a42-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="99a42-123">LINQ to SQLLINQ to SQL se encargará de generar la lógica de ejecución de SQL adecuada para usar en tiempo de ejecución cuando interactuemos y los usemos.</span><span class="sxs-lookup"><span data-stu-id="99a42-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="99a42-124">Podemos usar la compatibilidad con lenguaje LINQ dentro de VB y C- para escribir consultas expresivas que recuperan objetos Dinner y RSVP de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="99a42-125">Esto minimiza la cantidad de código de datos que necesitamos escribir y nos permite crear aplicaciones realmente limpias.</span><span class="sxs-lookup"><span data-stu-id="99a42-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="99a42-126">Agregar LINQ to SQL Classes a nuestro proyecto</span><span class="sxs-lookup"><span data-stu-id="99a42-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="99a42-127">Comenzaremos haciendo clic con el botón derecho en la carpeta "Modelos" dentro de nuestro proyecto y seleccionaremos el comando de menú **Agregar&gt;nuevo elemento:**</span><span class="sxs-lookup"><span data-stu-id="99a42-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="99a42-128">Aparecerá el cuadro de diálogo "Agregar nuevo elemento".</span><span class="sxs-lookup"><span data-stu-id="99a42-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="99a42-129">Filtraremos por la categoría "Datos" y seleccionaremos la plantilla "LINQ to SQL Classes" dentro de ella:</span><span class="sxs-lookup"><span data-stu-id="99a42-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="99a42-130">Nombraremos el elemento "NerdDinner" y haremos clic en el botón "Añadir".</span><span class="sxs-lookup"><span data-stu-id="99a42-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="99a42-131">Visual Studio agregará un archivo NerdDinner.dbml en nuestro directorio .Models y, a continuación, abrirá el diseñador relacional de objetos LINQ to SQLLINQ to SQL:</span><span class="sxs-lookup"><span data-stu-id="99a42-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="99a42-132">Creación de clases de modelo de datos con LINQ to SQLLINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="99a42-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="99a42-133">LINQ to SQLLINQ to SQL nos permite crear rápidamente clases de modelo de datos a partir del esquema de base de datos existente.</span><span class="sxs-lookup"><span data-stu-id="99a42-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="99a42-134">Para ello, abriremos la base de datos NerdDinner en el Explorador de servidores y seleccionaremos las tablas que queremos modelar en ella:</span><span class="sxs-lookup"><span data-stu-id="99a42-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="99a42-135">A continuación, podemos arrastrar las tablas a la superficie del diseñador LINQ to SQLLINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="99a42-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="99a42-136">Al hacerlo LINQ to SQLLINQ to SQL creará automáticamente clases Dinner y RSVP utilizando el esquema de las tablas (con propiedades de clase que se asignan a las columnas de la tabla de base de datos):</span><span class="sxs-lookup"><span data-stu-id="99a42-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="99a42-137">De forma predeterminada, el diseñador LINQ to SQLLINQ to SQL "pluraliza" automáticamente los nombres de tabla y columna cuando crea clases basadas en un esquema de base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="99a42-138">Por ejemplo: la tabla "Cenas" de nuestro ejemplo anterior dio como resultado una clase "Cena".</span><span class="sxs-lookup"><span data-stu-id="99a42-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="99a42-139">Esta nomenclatura de clase ayuda a que nuestros modelos sean coherentes con las convenciones de nomenclatura de .NET y, por lo general, me parece que hacer que el diseñador corrija esto sea conveniente (especialmente cuando se agregan muchas tablas).</span><span class="sxs-lookup"><span data-stu-id="99a42-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="99a42-140">Si no le gusta el nombre de una clase o propiedad que genera el diseñador, sin embargo, siempre puede reemplazarlo y cambiarlo a cualquier nombre que desee.</span><span class="sxs-lookup"><span data-stu-id="99a42-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="99a42-141">Puede hacerlo editando el nombre de entidad/propiedad en línea dentro del diseñador o modificándolo a través de la cuadrícula de propiedades.</span><span class="sxs-lookup"><span data-stu-id="99a42-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="99a42-142">De forma predeterminada, el diseñador LINQ to SQLLINQ to SQL también inspecciona las relaciones de clave principal y clave externa de las tablas y, en función de ellas, crea automáticamente las "asociaciones de relación" predeterminadas entre las diferentes clases de modelo que crea.</span><span class="sxs-lookup"><span data-stu-id="99a42-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="99a42-143">Por ejemplo, cuando arrastramos las tablas Dinners y RSVP al diseñador LINQ to SQLLINQ to SQL, se dedujo una asociación de relación entre los dos basándose en el hecho de que la tabla RSVP tenía una clave externa a la tabla Dinners (esto se indica mediante la flecha del diseñador):</span><span class="sxs-lookup"><span data-stu-id="99a42-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="99a42-144">La asociación anterior hará que LINQ to SQLLINQ to SQL agregue una propiedad "Dinner" fuertemente tipada a la clase RSVP que los desarrolladores pueden usar para tener acceso a la cena asociada a un RSVP determinado.</span><span class="sxs-lookup"><span data-stu-id="99a42-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="99a42-145">También hará que la clase Dinner tenga una propiedad de colección "RSVPs" que permite a los desarrolladores recuperar y actualizar objetos RSVP asociados a una cena determinada.</span><span class="sxs-lookup"><span data-stu-id="99a42-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="99a42-146">A continuación puede ver un ejemplo de intellisense dentro de Visual Studio cuando creamos un nuevo objeto RSVP y lo agregamos a una colección RSVPs de la cena.</span><span class="sxs-lookup"><span data-stu-id="99a42-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="99a42-147">Observe cómo LINQ to SQLLINQ to SQL agrega automáticamente una colección "RSVPs" en el objeto Dinner:</span><span class="sxs-lookup"><span data-stu-id="99a42-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="99a42-148">Al agregar el objeto RSVP a la colección RSVPs de la cena, le decimos a LINQ to SQLLINQ to SQL que asocie una relación de clave externa entre la fila Dinner y la fila RSVP de nuestra base de datos:</span><span class="sxs-lookup"><span data-stu-id="99a42-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="99a42-149">Si no le gusta cómo el diseñador ha modelado o nombrado una asociación de tabla, puede invalidarla.</span><span class="sxs-lookup"><span data-stu-id="99a42-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="99a42-150">Simplemente haga clic en la flecha de asociación dentro del diseñador y acceda a sus propiedades a través de la cuadrícula de propiedades para cambiarle el nombre, eliminarla o modificarla.</span><span class="sxs-lookup"><span data-stu-id="99a42-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="99a42-151">Para nuestra aplicación NerdDinner, sin embargo, las reglas de asociación predeterminadas funcionan bien para las clases de modelo de datos que estamos creando y solo podemos usar el comportamiento predeterminado.</span><span class="sxs-lookup"><span data-stu-id="99a42-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="99a42-152">NerdDinnerDataContext Clase</span><span class="sxs-lookup"><span data-stu-id="99a42-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="99a42-153">Visual Studio creará automáticamente clases .NET que representan los modelos y las relaciones de base de datos definidas mediante el diseñador LINQ to SQLLINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="99a42-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="99a42-154">También se genera una clase LINQ to SQL DataContext para cada archivo de diseñador LINQ to SQLLINQ to SQL agregado a la solución.</span><span class="sxs-lookup"><span data-stu-id="99a42-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="99a42-155">Dado que hemos denominado nuestro elemento de clase LINQ to SQLLINQ to SQL "NerdDinner", la clase DataContext creada se denominará "NerdDinnerDataContext".</span><span class="sxs-lookup"><span data-stu-id="99a42-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="99a42-156">Esta clase NerdDinnerDataContext es la forma principal en que interactuaremos con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="99a42-157">Nuestra clase NerdDinnerDataContext expone dos propiedades - "Dinners" y "RSVPs" - que representan las dos tablas que modelamos dentro de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="99a42-158">Podemos usar C- para escribir consultas LINQ en esas propiedades para consultar y recuperar objetos Dinner y RSVP de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="99a42-159">En el código siguiente se muestra cómo crear instancias de un objeto NerdDinnerDataContext y realizar una consulta LINQ en él para obtener una secuencia de Dinners que se producen en el futuro.</span><span class="sxs-lookup"><span data-stu-id="99a42-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="99a42-160">Visual Studio proporciona intellisense completo al escribir la consulta LINQ y los objetos devueltos desde ella están fuertemente tipados y también admiten intellisense:</span><span class="sxs-lookup"><span data-stu-id="99a42-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="99a42-161">Además de permitirnos consultar objetos Dinner y RSVP, un NerdDinnerDataContext también realiza un seguimiento automático de los cambios que posteriormente realizamos en los objetos Dinner y RSVP que recuperamos a través de él.</span><span class="sxs-lookup"><span data-stu-id="99a42-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="99a42-162">Podemos usar esta funcionalidad para guardar fácilmente los cambios en la base de datos, sin tener que escribir ningún código de actualización SQL explícito.</span><span class="sxs-lookup"><span data-stu-id="99a42-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="99a42-163">Por ejemplo, el código siguiente muestra cómo usar una consulta LINQ para recuperar un único objeto Dinner de la base de datos, actualizar dos de las propiedades Dinner y, a continuación, guardar los cambios en la base de datos:</span><span class="sxs-lookup"><span data-stu-id="99a42-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="99a42-164">El objeto NerdDinnerDataContext del código anterior realizaba un seguimiento automático de los cambios de propiedad realizados en el objeto Dinner que recuperamos de él.</span><span class="sxs-lookup"><span data-stu-id="99a42-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="99a42-165">Cuando llamamos al método "SubmitChanges()", ejecutará una instrucción "UPDATE" de SQL adecuada en la base de datos para conservar los valores actualizados.</span><span class="sxs-lookup"><span data-stu-id="99a42-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="99a42-166">Creación de una clase DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="99a42-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="99a42-167">Para aplicaciones pequeñas, a veces está bien hacer que los controladores trabajen directamente en una clase LINQ to SQL DataContext e incrustar consultas LINQ en los controladores.</span><span class="sxs-lookup"><span data-stu-id="99a42-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="99a42-168">Sin embargo, a medida que las aplicaciones se hacen más grandes, este enfoque se vuelve engorroso para mantener y probar.</span><span class="sxs-lookup"><span data-stu-id="99a42-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="99a42-169">También puede llevarnos a duplicar las mismas consultas LINQ en varios lugares.</span><span class="sxs-lookup"><span data-stu-id="99a42-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="99a42-170">Un enfoque que puede hacer que las aplicaciones sean más fáciles de mantener y probar es usar un patrón de "repositorio".</span><span class="sxs-lookup"><span data-stu-id="99a42-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="99a42-171">Una clase de repositorio ayuda a encapsular la lógica de consulta y persistencia de datos y abstrae los detalles de implementación de la persistencia de datos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="99a42-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="99a42-172">Además de hacer que el código de la aplicación sea más limpio, el uso de un patrón de repositorio puede facilitar el cambio de las implementaciones de almacenamiento de datos en el futuro, y puede ayudar a facilitar las pruebas unitarias de una aplicación sin necesidad de una base de datos real.</span><span class="sxs-lookup"><span data-stu-id="99a42-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="99a42-173">Para nuestra aplicación NerdDinner definiremos una clase DinnerRepository con la siguiente firma:</span><span class="sxs-lookup"><span data-stu-id="99a42-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="99a42-174">*Nota: Más adelante en este capítulo extraeremos una interfaz IDinnerRepository de esta clase y habilitaremos la inserción de dependencias con ella en nuestros controladores. Para empezar, sin embargo, vamos a empezar simple y simplemente trabajar directamente con la clase DinnerRepository.*</span><span class="sxs-lookup"><span data-stu-id="99a42-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="99a42-175">Para implementar esta clase, haga clic con el botón derecho en nuestra carpeta "Modelos" y elegiremos el comando de menú **Agregar&gt;nuevo elemento.**</span><span class="sxs-lookup"><span data-stu-id="99a42-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="99a42-176">Dentro del cuadro de diálogo "Agregar nuevo elemento" seleccionaremos la plantilla "Clase" y nombraremos el archivo "DinnerRepository.cs":</span><span class="sxs-lookup"><span data-stu-id="99a42-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="99a42-177">A continuación, podemos implementar nuestra clase DinnerRepository utilizando el siguiente código:</span><span class="sxs-lookup"><span data-stu-id="99a42-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="99a42-178">Recuperar, actualizar, insertar y eliminar mediante la clase DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="99a42-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="99a42-179">Ahora que hemos creado nuestra clase DinnerRepository, echemos un vistazo a algunos ejemplos de código que muestran tareas comunes que podemos hacer con ella:</span><span class="sxs-lookup"><span data-stu-id="99a42-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="99a42-180">Consultar ejemplos</span><span class="sxs-lookup"><span data-stu-id="99a42-180">Querying Examples</span></span>

<span data-ttu-id="99a42-181">El código siguiente recupera una sola cena con el valor DinnerID:</span><span class="sxs-lookup"><span data-stu-id="99a42-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="99a42-182">El código siguiente recupera todas las próximas cenas y bucles sobre ellos:</span><span class="sxs-lookup"><span data-stu-id="99a42-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="99a42-183">Insertar y actualizar ejemplos</span><span class="sxs-lookup"><span data-stu-id="99a42-183">Insert and Update Examples</span></span>

<span data-ttu-id="99a42-184">El código siguiente muestra cómo agregar dos cenas nuevas.</span><span class="sxs-lookup"><span data-stu-id="99a42-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="99a42-185">Las adiciones/modificaciones al repositorio no se confirman en la base de datos hasta que se llama al método "Save()" en ella.</span><span class="sxs-lookup"><span data-stu-id="99a42-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="99a42-186">LINQ to SQLLINQ to SQL ajusta automáticamente todos los cambios en una transacción de base de datos, por lo que todos los cambios se producen o ninguno de ellos cuando se guarda el repositorio:</span><span class="sxs-lookup"><span data-stu-id="99a42-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="99a42-187">El código siguiente recupera un objeto Dinner existente y modifica dos propiedades en él.</span><span class="sxs-lookup"><span data-stu-id="99a42-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="99a42-188">Los cambios se confirman en la base de datos cuando se llama al método "Save()" en nuestro repositorio:</span><span class="sxs-lookup"><span data-stu-id="99a42-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="99a42-189">El código siguiente recupera una cena y, a continuación, agrega un RSVP a ella.</span><span class="sxs-lookup"><span data-stu-id="99a42-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="99a42-190">Lo hace mediante la colección RSVPs en el objeto Dinner que LINQ to SQLLINQ to SQL creó para nosotros (porque hay una relación de clave principal/clave externa entre los dos de la base de datos).</span><span class="sxs-lookup"><span data-stu-id="99a42-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="99a42-191">Este cambio se conserva de nuevo a la base de datos como una nueva fila de tabla RSVP cuando se llama al método "Save()" en el repositorio:</span><span class="sxs-lookup"><span data-stu-id="99a42-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="99a42-192">Eliminar ejemplo</span><span class="sxs-lookup"><span data-stu-id="99a42-192">Delete Example</span></span>

<span data-ttu-id="99a42-193">El código siguiente recupera un objeto Dinner existente y, a continuación, lo marca para eliminarlo.</span><span class="sxs-lookup"><span data-stu-id="99a42-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="99a42-194">Cuando se llama al método "Save()" en el repositorio, se confirmará la eliminación en la base de datos:</span><span class="sxs-lookup"><span data-stu-id="99a42-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="99a42-195">Integración de validación y lógica de reglas de negocio con clases de modelos</span><span class="sxs-lookup"><span data-stu-id="99a42-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="99a42-196">La integración de la validación y la lógica de reglas de negocio es una parte clave de cualquier aplicación que funcione con datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="99a42-197">Validación de esquemas</span><span class="sxs-lookup"><span data-stu-id="99a42-197">Schema Validation</span></span>

<span data-ttu-id="99a42-198">Cuando las clases de modelo se definen mediante el diseñador LINQ to SQLLINQ to SQL, los tipos de datos de las propiedades de las clases de modelo de datos corresponden a los tipos de datos de la tabla de base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="99a42-199">Por ejemplo: si la columna "EventDate" de la tabla Dinners es un "datetime", la clase de modelo de datos creada por LINQ to SQLLINQ to SQL será de tipo "DateTime" (que es un tipo de datos .NET integrado).</span><span class="sxs-lookup"><span data-stu-id="99a42-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="99a42-200">Esto significa que obtendrá errores de compilación si intenta asignarle un entero o booleano desde el código y generará un error automáticamente si intenta convertir implícitamente un tipo de cadena no válido en él en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="99a42-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="99a42-201">LINQ to SQLLINQ to SQL también controlará automáticamente el escape de valores SQL cuando se usan cadenas, lo que le ayuda a protegerse contra ataques de inyección de SQL al usarlo.</span><span class="sxs-lookup"><span data-stu-id="99a42-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="99a42-202">Validación y lógica de reglas de negocio</span><span class="sxs-lookup"><span data-stu-id="99a42-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="99a42-203">La validación de esquemas es útil como primer paso, pero rara vez es suficiente.</span><span class="sxs-lookup"><span data-stu-id="99a42-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="99a42-204">La mayoría de los escenarios del mundo real requieren la capacidad de especificar una lógica de validación más completa que pueda abarcar varias propiedades, ejecutar código y, a menudo, tener conocimiento del estado de un modelo (por ejemplo: se está creando /updated/deleted, o dentro de un estado específico del dominio como "archivado").</span><span class="sxs-lookup"><span data-stu-id="99a42-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="99a42-205">Hay una variedad de patrones y marcos diferentes que se pueden usar para definir y aplicar reglas de validación a las clases de modelo, y hay varios marcos basados en .NET por ahí que se pueden usar para ayudar con esto.</span><span class="sxs-lookup"><span data-stu-id="99a42-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="99a42-206">Puede usar prácticamente cualquiera de ellos dentro de ASP.NET aplicaciones MVC.</span><span class="sxs-lookup"><span data-stu-id="99a42-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="99a42-207">Para los fines de nuestra aplicación NerdDinner, usaremos un patrón relativamente simple y directo donde exponemos una propiedad IsValid y un método GetRuleViolations() en nuestro objeto de modelo Dinner.</span><span class="sxs-lookup"><span data-stu-id="99a42-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="99a42-208">La propiedad IsValid devolverá true o false en función de si las reglas de validación y de negocio son válidas.</span><span class="sxs-lookup"><span data-stu-id="99a42-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="99a42-209">El método GetRuleViolations() devolverá una lista de errores de regla.</span><span class="sxs-lookup"><span data-stu-id="99a42-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="99a42-210">Implementaremos IsValid y GetRuleViolations() para nuestro modelo Dinner agregando una "clase parcial" a nuestro proyecto.</span><span class="sxs-lookup"><span data-stu-id="99a42-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="99a42-211">Las clases parciales se pueden usar para agregar métodos/propiedades/eventos a las clases mantenidas por un diseñador de VS (como la clase Dinner generada por el diseñador LINQ to SQLLINQ to SQL) y ayudar a evitar que la herramienta se meta con nuestro código.</span><span class="sxs-lookup"><span data-stu-id="99a42-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="99a42-212">Podemos agregar una nueva clase parcial a nuestro proyecto haciendo clic con el botón derecho en la carpeta Desmodelos y, a continuación, seleccionando el comando de menú "Agregar nuevo elemento".</span><span class="sxs-lookup"><span data-stu-id="99a42-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="99a42-213">A continuación, podemos elegir la plantilla "Clase" dentro del cuadro de diálogo "Agregar nuevo elemento" y nombrarlo Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="99a42-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="99a42-214">Al hacer clic en el botón "Agregar" se agregará un archivo Dinner.cs a nuestro proyecto y se abrirá dentro del IDE.</span><span class="sxs-lookup"><span data-stu-id="99a42-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="99a42-215">A continuación, podemos implementar un marco básico de aplicación de reglas/validación utilizando el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="99a42-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="99a42-216">Algunas notas sobre el código anterior:</span><span class="sxs-lookup"><span data-stu-id="99a42-216">A few notes about the above code:</span></span>

- <span data-ttu-id="99a42-217">La clase Dinner está precedida por una palabra clave "parcial", lo que significa que el código contenido en ella se combinará con la clase generada/mantenida por el diseñador LINQ to SQLLINQ to SQL y se compilará en una sola clase.</span><span class="sxs-lookup"><span data-stu-id="99a42-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="99a42-218">La clase RuleViolation es una clase auxiliar que agregaremos al proyecto que nos permite proporcionar más detalles sobre una infracción de regla.</span><span class="sxs-lookup"><span data-stu-id="99a42-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="99a42-219">El método Dinner.GetRuleViolations() hace que se evalúen nuestras reglas de validación y de negocio (las implementaremos en breve).</span><span class="sxs-lookup"><span data-stu-id="99a42-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="99a42-220">A continuación, devuelve una secuencia de RuleViolation objetos que proporcionan más detalles sobre los errores de regla.</span><span class="sxs-lookup"><span data-stu-id="99a42-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="99a42-221">El Dinner.IsValid propiedad proporciona una propiedad auxiliar conveniente que indica si el Dinner objeto tiene alguna RuleViolations activa.</span><span class="sxs-lookup"><span data-stu-id="99a42-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="99a42-222">Puede ser comprobado proactivamente por un desarrollador que usa el objeto Dinner en cualquier momento (y no genera una excepción).</span><span class="sxs-lookup"><span data-stu-id="99a42-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="99a42-223">El método parcial Dinner.OnValidate() es un gancho que LINQ to SQLLINQ to SQL proporciona que nos permite recibir una notificación cada vez que el objeto Dinner está a punto de persistirse en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="99a42-224">Nuestra implementación OnValidate() anterior garantiza que la cena no tenga RuleViolations antes de que se guarde.</span><span class="sxs-lookup"><span data-stu-id="99a42-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="99a42-225">Si está en un estado no válido, genera una excepción, lo que hará que LINQ to SQLLINQ to SQL anule la transacción.</span><span class="sxs-lookup"><span data-stu-id="99a42-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="99a42-226">Este enfoque proporciona un marco simple en el que podemos integrar la validación y las reglas de negocio.</span><span class="sxs-lookup"><span data-stu-id="99a42-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="99a42-227">Por ahora vamos a añadir las siguientes reglas a nuestro método GetRuleViolations():</span><span class="sxs-lookup"><span data-stu-id="99a42-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="99a42-228">Estamos usando la característica "yield return" de C- para devolver una secuencia de cualquier RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="99a42-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="99a42-229">Las primeras seis comprobaciones de reglas anteriores simplemente aplican que las propiedades de cadena en nuestra cena no pueden ser nulas o vacías.</span><span class="sxs-lookup"><span data-stu-id="99a42-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="99a42-230">La última regla es un poco más interesante, y llama a un método auxiliar PhoneValidator.IsValidNumber() que podemos agregar a nuestro proyecto para comprobar que el formato de número ContactPhone coincide con el país de la cena.</span><span class="sxs-lookup"><span data-stu-id="99a42-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="99a42-231">Podemos usar . Compatibilidad con expresiones regulares de NET para implementar este soporte de validación de teléfono.</span><span class="sxs-lookup"><span data-stu-id="99a42-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="99a42-232">A continuación se muestra una sencilla implementación de PhoneValidator que podemos agregar a nuestro proyecto que nos permite agregar comprobaciones de patrones Regex específicas del país:</span><span class="sxs-lookup"><span data-stu-id="99a42-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="99a42-233">Manejo de validación y violaciones de lógica empresarial</span><span class="sxs-lookup"><span data-stu-id="99a42-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="99a42-234">Ahora que hemos agregado el código de validación y regla de negocio anterior, cada vez que intentemos crear o actualizar una cena, nuestras reglas lógicas de validación se evaluarán y aplicarán.</span><span class="sxs-lookup"><span data-stu-id="99a42-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="99a42-235">Los desarrolladores pueden escribir código como el siguiente para determinar de forma proactiva si un objeto Dinner es válido y recuperar una lista de todas las infracciones en él sin generar excepciones:</span><span class="sxs-lookup"><span data-stu-id="99a42-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="99a42-236">Si intentamos guardar una cena en un estado no válido, se producirá una excepción cuando llamemos al método Save() en DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="99a42-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="99a42-237">Esto ocurre porque LINQ to SQLLINQ to SQL llama automáticamente a nuestro método parcial Dinner.OnValidate() antes de guardar los cambios de dinner y agregamos código a Dinner.OnValidate() para generar una excepción si existen infracciones de reglas en la cena.</span><span class="sxs-lookup"><span data-stu-id="99a42-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="99a42-238">Podemos detectar esta excepción y recuperar de forma reactiva una lista de las infracciones que se van a corregir:</span><span class="sxs-lookup"><span data-stu-id="99a42-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="99a42-239">Dado que nuestras reglas de validación y de negocio se implementan dentro de nuestra capa de modelo, y no dentro de la capa de interfaz de usuario, se aplicarán y usarán en todos los escenarios de nuestra aplicación.</span><span class="sxs-lookup"><span data-stu-id="99a42-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="99a42-240">Más adelante podemos cambiar o agregar reglas de negocio y hacer que todo el código que funciona con nuestros objetos Dinner las honre.</span><span class="sxs-lookup"><span data-stu-id="99a42-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="99a42-241">Tener la flexibilidad para cambiar las reglas de negocio en un solo lugar, sin que estos cambios se alimenten en toda la aplicación y la lógica de la interfaz de usuario, es un signo de una aplicación bien escrita y una ventaja que un marco MVC ayuda a fomentar.</span><span class="sxs-lookup"><span data-stu-id="99a42-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="99a42-242">siguiente paso</span><span class="sxs-lookup"><span data-stu-id="99a42-242">Next Step</span></span>

<span data-ttu-id="99a42-243">Ahora tenemos un modelo que podemos usar para consultar y actualizar nuestra base de datos.</span><span class="sxs-lookup"><span data-stu-id="99a42-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="99a42-244">Ahora vamos a agregar algunos controladores y vistas al proyecto que podemos usar para crear una experiencia de interfaz de usuario HTML a su alrededor.</span><span class="sxs-lookup"><span data-stu-id="99a42-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="99a42-245">[Anterior](create-a-database.md)
> [Siguiente](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="99a42-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
