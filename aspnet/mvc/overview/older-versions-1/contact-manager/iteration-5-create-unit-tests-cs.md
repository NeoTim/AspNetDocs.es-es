---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
title: '#5 de iteración: crear pruebas unitarias (C-) Microsoft Docs'
author: rick-anderson
description: En la quinta iteración, hacemos que nuestra aplicación sea más fácil de mantener y modificar agregando pruebas unitarias. Nos burlamos de nuestras clases de modelos de datos y creamos pruebas unitarias para...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 28ad8f80-b8a5-444e-b478-8b15a846060c
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
msc.type: authoredcontent
ms.openlocfilehash: c005a8ffc3b09c126d796f2feb74d402cb784aa2
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542357"
---
# <a name="iteration-5--create-unit-tests-c"></a><span data-ttu-id="0e21e-104">Iteración n.º 5: Crear pruebas unitarias (C#)</span><span class="sxs-lookup"><span data-stu-id="0e21e-104">Iteration #5 – Create unit tests (C#)</span></span>

<span data-ttu-id="0e21e-105">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="0e21e-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="0e21e-106">Descargar código</span><span class="sxs-lookup"><span data-stu-id="0e21e-106">Download Code</span></span>](iteration-5-create-unit-tests-cs/_static/contactmanager_5_cs1.zip)

> <span data-ttu-id="0e21e-107">En la quinta iteración, hacemos que nuestra aplicación sea más fácil de mantener y modificar agregando pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0e21e-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="0e21e-108">Nos burlamos de nuestras clases de modelo de datos y creamos pruebas unitarias para nuestros controladores y lógica de validación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="0e21e-109">Creación de una aplicación de administración de contactos ASP.NET MVC (C-)</span><span class="sxs-lookup"><span data-stu-id="0e21e-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="0e21e-110">En esta serie de tutoriales, creamos una aplicación de administración de contactos completa de principio a fin.</span><span class="sxs-lookup"><span data-stu-id="0e21e-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="0e21e-111">La aplicación Contact Manager le permite almacenar información de contacto (nombres, números de teléfono y direcciones de correo electrónico) para una lista de personas.</span><span class="sxs-lookup"><span data-stu-id="0e21e-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="0e21e-112">Creamos la aplicación en varias iteraciones.</span><span class="sxs-lookup"><span data-stu-id="0e21e-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="0e21e-113">Con cada iteración, mejoramos gradualmente la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="0e21e-114">El objetivo de este enfoque de iteración múltiple es permitirle comprender el motivo de cada cambio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="0e21e-115">#1 de iteración: cree la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="0e21e-116">En la primera iteración, creamos Contact Manager de la manera más sencilla posible.</span><span class="sxs-lookup"><span data-stu-id="0e21e-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="0e21e-117">Agregamos compatibilidad con operaciones básicas de base de datos: Crear, leer, actualizar y eliminar (CRUD).</span><span class="sxs-lookup"><span data-stu-id="0e21e-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="0e21e-118">Iteración #2 - Hacer que la aplicación se vea bien.</span><span class="sxs-lookup"><span data-stu-id="0e21e-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="0e21e-119">En esta iteración, mejoramos el aspecto de la aplicación modificando la página maestra de vista de ASP.NET MVC predeterminada y la hoja de estilos en cascada.</span><span class="sxs-lookup"><span data-stu-id="0e21e-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="0e21e-120">#3 de iteración: agregar validación de formulario.</span><span class="sxs-lookup"><span data-stu-id="0e21e-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="0e21e-121">En la tercera iteración, agregamos validación básica del formulario.</span><span class="sxs-lookup"><span data-stu-id="0e21e-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="0e21e-122">Evitamos que las personas envíen un formulario sin completar los campos de formulario obligatorios.</span><span class="sxs-lookup"><span data-stu-id="0e21e-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="0e21e-123">También validamos direcciones de correo electrónico y números de teléfono.</span><span class="sxs-lookup"><span data-stu-id="0e21e-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="0e21e-124">Iteración #4: haga que la aplicación se acople libremente.</span><span class="sxs-lookup"><span data-stu-id="0e21e-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="0e21e-125">En esta cuarta iteración, aprovechamos varios patrones de diseño de software para facilitar el mantenimiento y la modificación de la aplicación Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="0e21e-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="0e21e-126">Por ejemplo, refactorizamos nuestra aplicación para usar el patrón Repository y el patrón Dependency Injection.</span><span class="sxs-lookup"><span data-stu-id="0e21e-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="0e21e-127">Iteración #5: crear pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0e21e-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="0e21e-128">En la quinta iteración, hacemos que nuestra aplicación sea más fácil de mantener y modificar agregando pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0e21e-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="0e21e-129">Nos burlamos de nuestras clases de modelo de datos y creamos pruebas unitarias para nuestros controladores y lógica de validación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="0e21e-130">#6 de iteración: use el desarrollo controlado por pruebas.</span><span class="sxs-lookup"><span data-stu-id="0e21e-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="0e21e-131">En esta sexta iteración, agregamos nueva funcionalidad a nuestra aplicación escribiendo primero las pruebas unitarias y escribiendo código en las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0e21e-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="0e21e-132">En esta iteración, agregamos grupos de contactos.</span><span class="sxs-lookup"><span data-stu-id="0e21e-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="0e21e-133">de #7 iteración: agregue la funcionalidad DebAjax.</span><span class="sxs-lookup"><span data-stu-id="0e21e-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="0e21e-134">En la séptima iteración, mejoramos la capacidad de respuesta y el rendimiento de nuestra aplicación mediante la adición de compatibilidad con Ajax.</span><span class="sxs-lookup"><span data-stu-id="0e21e-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="0e21e-135">Esta iteración</span><span class="sxs-lookup"><span data-stu-id="0e21e-135">This Iteration</span></span>

<span data-ttu-id="0e21e-136">En la iteración anterior de la aplicación Contact Manager, refactorizamos la aplicación para que se acoplase de forma más flexible.</span><span class="sxs-lookup"><span data-stu-id="0e21e-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="0e21e-137">Separamos la aplicación en capas de controlador, servicio y repositorio distintas.</span><span class="sxs-lookup"><span data-stu-id="0e21e-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="0e21e-138">Cada capa interactúa con la capa debajo de ella a través de interfaces.</span><span class="sxs-lookup"><span data-stu-id="0e21e-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="0e21e-139">Hemos refactorizado la aplicación para facilitar el mantenimiento y la modificación de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="0e21e-140">Por ejemplo, si necesitamos usar una nueva tecnología de acceso a datos, simplemente podemos cambiar la capa del repositorio sin tocar el controlador o la capa de servicio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="0e21e-141">Al hacer que el Contact Manager se acopla libremente, hemos hecho que la aplicación sea más resistente al cambio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="0e21e-142">Pero, ¿qué sucede cuando necesitamos agregar una nueva característica a la aplicación Contact Manager?</span><span class="sxs-lookup"><span data-stu-id="0e21e-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="0e21e-143">O, ¿qué pasa cuando arreglamos un error?</span><span class="sxs-lookup"><span data-stu-id="0e21e-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="0e21e-144">Una triste, pero bien probada, verdad de escribir código es que cada vez que tocas código creas el riesgo de introducir nuevos errores.</span><span class="sxs-lookup"><span data-stu-id="0e21e-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="0e21e-145">Por ejemplo, un buen día, es posible que el administrador le pida que agregue una nueva característica al Gestor de contactos.</span><span class="sxs-lookup"><span data-stu-id="0e21e-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="0e21e-146">Quiere que agregues soporte para grupos de contacto.</span><span class="sxs-lookup"><span data-stu-id="0e21e-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="0e21e-147">Quiere que permita a los usuarios organizar sus contactos en grupos como Amigos, Negocios, etc.</span><span class="sxs-lookup"><span data-stu-id="0e21e-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="0e21e-148">Para implementar esta nueva característica, deberá modificar las tres capas de la aplicación Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="0e21e-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="0e21e-149">Deberá agregar nueva funcionalidad a los controladores, la capa de servicio y el repositorio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="0e21e-150">Tan pronto como empiece a modificar el código, corre el riesgo de interrumpir la funcionalidad que funcionaba antes.</span><span class="sxs-lookup"><span data-stu-id="0e21e-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="0e21e-151">Refactorizar nuestra aplicación en capas separadas, como hicimos en la iteración anterior, fue algo bueno.</span><span class="sxs-lookup"><span data-stu-id="0e21e-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="0e21e-152">Fue algo bueno porque nos permite hacer cambios en capas enteras sin tocar el resto de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="0e21e-153">Sin embargo, si desea que el código dentro de una capa sea más fácil de mantener y modificar, debe crear pruebas unitarias para el código.</span><span class="sxs-lookup"><span data-stu-id="0e21e-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="0e21e-154">Utilice una prueba unitaria para probar una unidad de código individual.</span><span class="sxs-lookup"><span data-stu-id="0e21e-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="0e21e-155">Estas unidades de código son más pequeñas que las capas de aplicación completas.</span><span class="sxs-lookup"><span data-stu-id="0e21e-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="0e21e-156">Normalmente, se usa una prueba unitaria para comprobar si un método determinado en el código se comporta de la manera esperada.</span><span class="sxs-lookup"><span data-stu-id="0e21e-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="0e21e-157">Por ejemplo, crearía una prueba unitaria para el método CreateContact() expuesto por la clase ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="0e21e-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="0e21e-158">Las pruebas unitarias para una aplicación funcionan igual que una red de seguridad.</span><span class="sxs-lookup"><span data-stu-id="0e21e-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="0e21e-159">Siempre que modifique código en una aplicación, puede ejecutar un conjunto de pruebas unitarias para comprobar si la modificación interrumpe la funcionalidad existente.</span><span class="sxs-lookup"><span data-stu-id="0e21e-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="0e21e-160">Las pruebas unitarias hacen que el código sea seguro de modificar.</span><span class="sxs-lookup"><span data-stu-id="0e21e-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="0e21e-161">Las pruebas unitarias hacen que todo el código de la aplicación sea más resistente al cambio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="0e21e-162">En esta iteración, agregamos pruebas unitarias a nuestra aplicación Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="0e21e-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="0e21e-163">De esta manera, en la siguiente iteración, podemos agregar grupos de contacto a nuestra aplicación sin preocuparse por interrumpir la funcionalidad existente.</span><span class="sxs-lookup"><span data-stu-id="0e21e-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="0e21e-164">Hay una variedad de marcos de pruebas unitarias que incluyen NUnit, xUnit.net y MbUnit.</span><span class="sxs-lookup"><span data-stu-id="0e21e-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="0e21e-165">En este tutorial, usamos el marco de pruebas unitarias incluido con Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="0e21e-166">Sin embargo, podría usar fácilmente uno de estos marcos alternativos.</span><span class="sxs-lookup"><span data-stu-id="0e21e-166">However, you could just as easily use one of these alternative frameworks.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="0e21e-167">Lo que se prueba</span><span class="sxs-lookup"><span data-stu-id="0e21e-167">What Gets Tested</span></span>

<span data-ttu-id="0e21e-168">En el mundo perfecto, todo su código estaría cubierto por pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0e21e-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="0e21e-169">En el mundo perfecto, tendrías la red de seguridad perfecta.</span><span class="sxs-lookup"><span data-stu-id="0e21e-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="0e21e-170">Podrá modificar cualquier línea de código de la aplicación y saber al instante, mediante la ejecución de las pruebas unitarias, si el cambio interrumpió la funcionalidad existente.</span><span class="sxs-lookup"><span data-stu-id="0e21e-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="0e21e-171">Sin embargo, no vivimos en un mundo perfecto.</span><span class="sxs-lookup"><span data-stu-id="0e21e-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="0e21e-172">En la práctica, al escribir pruebas unitarias, se concentra en escribir pruebas para la lógica de negocios (por ejemplo, lógica de validación).</span><span class="sxs-lookup"><span data-stu-id="0e21e-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="0e21e-173">En particular, *no* se escriben pruebas unitarias para la lógica de acceso a datos ni la lógica de vista.</span><span class="sxs-lookup"><span data-stu-id="0e21e-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="0e21e-174">Para ser útiles, las pruebas unitarias deben ejecutarse muy rápidamente.</span><span class="sxs-lookup"><span data-stu-id="0e21e-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="0e21e-175">Puede acumular fácilmente cientos (o incluso miles) de pruebas unitarias para una aplicación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="0e21e-176">Si las pruebas unitarias tardan mucho tiempo en ejecutarse, evitará ejecutarlas.</span><span class="sxs-lookup"><span data-stu-id="0e21e-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="0e21e-177">En otras palabras, las pruebas unitarias de larga duración son inútiles para fines de codificación diario.</span><span class="sxs-lookup"><span data-stu-id="0e21e-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="0e21e-178">Por este motivo, normalmente no se escriben pruebas unitarias para el código que interactúa con una base de datos.</span><span class="sxs-lookup"><span data-stu-id="0e21e-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="0e21e-179">Ejecutar cientos de pruebas unitarias en una base de datos activa sería demasiado lento.</span><span class="sxs-lookup"><span data-stu-id="0e21e-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="0e21e-180">En su lugar, se burla de la base de datos y escribe código que interactúa con la base de datos simulada (analizamos la simulación de una base de datos a continuación).</span><span class="sxs-lookup"><span data-stu-id="0e21e-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="0e21e-181">Por un motivo similar, normalmente no se escriben pruebas unitarias para las vistas.</span><span class="sxs-lookup"><span data-stu-id="0e21e-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="0e21e-182">Para probar una vista, debe girar hacia arriba un servidor web.</span><span class="sxs-lookup"><span data-stu-id="0e21e-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="0e21e-183">Dado que girar un servidor web es un proceso relativamente lento, no se recomienda crear pruebas unitarias para las vistas.</span><span class="sxs-lookup"><span data-stu-id="0e21e-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="0e21e-184">Si la vista contiene lógica complicada, debe considerar la posibilidad de mover la lógica a métodos auxiliares.</span><span class="sxs-lookup"><span data-stu-id="0e21e-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="0e21e-185">Puede escribir pruebas unitarias para los métodos auxiliares que se ejecutan sin poner en marcha un servidor web.</span><span class="sxs-lookup"><span data-stu-id="0e21e-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="0e21e-186">Aunque escribir pruebas para la lógica de acceso a datos o la lógica de vista no es una buena idea al escribir pruebas unitarias, estas pruebas pueden ser muy valiosas al crear pruebas funcionales o de integración.</span><span class="sxs-lookup"><span data-stu-id="0e21e-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="0e21e-187">ASP.NET MVC es el motor de vista de formularios Web Forms.</span><span class="sxs-lookup"><span data-stu-id="0e21e-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="0e21e-188">Aunque el motor de vista de formularios Web Forms depende de un servidor web, es posible que otros motores de vista no lo sean.</span><span class="sxs-lookup"><span data-stu-id="0e21e-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>

## <a name="using-a-mock-object-framework"></a><span data-ttu-id="0e21e-189">Uso de un marco de objetos ficticios</span><span class="sxs-lookup"><span data-stu-id="0e21e-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="0e21e-190">Al crear pruebas unitarias, casi siempre es necesario aprovechar un marco de trabajo de objeto sorte.</span><span class="sxs-lookup"><span data-stu-id="0e21e-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="0e21e-191">Un marco de trabajo de objetos falsos le permite crear simulaciones y códigos auxiliares para las clases de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="0e21e-192">Por ejemplo, puede usar un marco de trabajo de objeto sin fisios para generar una versión ficticia de la clase de repositorio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="0e21e-193">De este modo, puede utilizar la clase de repositorio simulado en lugar de la clase de repositorio real en las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0e21e-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="0e21e-194">El uso del repositorio ficticio le permite evitar la ejecución de código de base de datos al ejecutar una prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="0e21e-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="0e21e-195">Visual Studio no incluye un marco de objetos ficticios.</span><span class="sxs-lookup"><span data-stu-id="0e21e-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="0e21e-196">Sin embargo, hay varios marcos de objetos Mock comerciales y de código abierto disponibles para .NET Framework:</span><span class="sxs-lookup"><span data-stu-id="0e21e-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="0e21e-197">Moq - Este marco está disponible bajo la licencia BSD de código abierto.</span><span class="sxs-lookup"><span data-stu-id="0e21e-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="0e21e-198">Puede descargar Moq [https://code.google.com/p/moq/](https://code.google.com/p/moq/)desde .</span><span class="sxs-lookup"><span data-stu-id="0e21e-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="0e21e-199">Rhino Mocks - Este marco está disponible bajo la licencia BSD de código abierto.</span><span class="sxs-lookup"><span data-stu-id="0e21e-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="0e21e-200">Puede descargar Rhino Mocks desde [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span><span class="sxs-lookup"><span data-stu-id="0e21e-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="0e21e-201">Typemock Isolator - Este es un marco comercial.</span><span class="sxs-lookup"><span data-stu-id="0e21e-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="0e21e-202">Puede descargar una versión de prueba desde [http://www.typemock.com/](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="0e21e-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="0e21e-203">En este tutorial, decidí usar Moq.</span><span class="sxs-lookup"><span data-stu-id="0e21e-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="0e21e-204">Sin embargo, podría utilizar Rhino Mocks o Typemock Isolator con la misma facilidad para crear los objetos Mock para la aplicación Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="0e21e-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="0e21e-205">Antes de poder utilizar Moq, debe completar los siguientes pasos:</span><span class="sxs-lookup"><span data-stu-id="0e21e-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="0e21e-206">.</span><span class="sxs-lookup"><span data-stu-id="0e21e-206">.</span></span>
2. <span data-ttu-id="0e21e-207">Antes de descomprimir la descarga, asegúrese de hacer clic con el botón derecho en el archivo y haga clic en el botón **Desbloquear** (consulte la figura 1).</span><span class="sxs-lookup"><span data-stu-id="0e21e-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="0e21e-208">Descomprima la descarga.</span><span class="sxs-lookup"><span data-stu-id="0e21e-208">Unzip the download.</span></span>
4. <span data-ttu-id="0e21e-209">Agregue una referencia al ensamblaje Moq haciendo clic con el botón derecho en la carpeta Referencias del proyecto ContactManager.Tests y seleccionando **Agregar referencia**.</span><span class="sxs-lookup"><span data-stu-id="0e21e-209">Add a reference to the Moq assembly by right-clicking the References folder in the ContactManager.Tests project and selecting **Add Reference**.</span></span> <span data-ttu-id="0e21e-210">En la pestaña Examinar, vaya a la carpeta donde descomprimió Moq y seleccione el ensamblado Moq.dll.</span><span class="sxs-lookup"><span data-stu-id="0e21e-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="0e21e-211">Haga clic en el botón **Aceptar** .</span><span class="sxs-lookup"><span data-stu-id="0e21e-211">Click the **OK** button.</span></span>
5. <span data-ttu-id="0e21e-212">Después de completar estos pasos, la carpeta Referencias debe tener el aspecto de la figura 2.</span><span class="sxs-lookup"><span data-stu-id="0e21e-212">After you complete these steps, your References folder should look like Figure 2.</span></span>

<span data-ttu-id="0e21e-213">[![Desbloqueando Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0e21e-213">[![Unblocking Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span></span>

<span data-ttu-id="0e21e-214">**Figura 01**: Desbloqueenmo moq ([Haga clic para ver la imagen de tamaño completo](iteration-5-create-unit-tests-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="0e21e-214">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image2.png))</span></span>

<span data-ttu-id="0e21e-215">[![Referencias después de añadir Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="0e21e-215">[![References after adding Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span></span>

<span data-ttu-id="0e21e-216">**Figura 02**: Referencias después de agregar Moq([Haga clic para ver la imagen de tamaño completo](iteration-5-create-unit-tests-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="0e21e-216">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image4.png))</span></span>

## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="0e21e-217">Creación de pruebas unitarias para la capa de servicio</span><span class="sxs-lookup"><span data-stu-id="0e21e-217">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="0e21e-218">Vamos a empezar creando un conjunto de pruebas unitarias para nuestra capa de servicio de la aplicación Contact Manager s.</span><span class="sxs-lookup"><span data-stu-id="0e21e-218">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="0e21e-219">Usaremos estas pruebas para verificar nuestra lógica de validación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-219">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="0e21e-220">Cree una nueva carpeta denominada Modelos en el proyecto ContactManager.Tests.</span><span class="sxs-lookup"><span data-stu-id="0e21e-220">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="0e21e-221">A continuación, haga clic con el botón derecho en la carpeta Modelos y seleccione **Agregar, Nueva prueba**.</span><span class="sxs-lookup"><span data-stu-id="0e21e-221">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="0e21e-222">Aparece el cuadro de diálogo **Agregar nueva prueba** que se muestra en la Figura 3.</span><span class="sxs-lookup"><span data-stu-id="0e21e-222">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="0e21e-223">Seleccione la plantilla **Prueba unitaria** y asigne un nombre a la nueva ContactManagerServiceTest.cs de prueba.</span><span class="sxs-lookup"><span data-stu-id="0e21e-223">Select the **Unit Test** template and name your new test ContactManagerServiceTest.cs.</span></span> <span data-ttu-id="0e21e-224">Haga clic en el botón **Aceptar** para agregar la nueva prueba al proyecto de prueba.</span><span class="sxs-lookup"><span data-stu-id="0e21e-224">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="0e21e-225">En general, desea que la estructura de carpetas del proyecto de prueba coincida con la estructura de carpetas del proyecto MVC de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0e21e-225">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="0e21e-226">Por ejemplo, coloque las pruebas de controlador en una carpeta Controllers, las pruebas de modelo en una carpeta Models, etc.</span><span class="sxs-lookup"><span data-stu-id="0e21e-226">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>

<span data-ttu-id="0e21e-227">[![Modelos-ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="0e21e-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span></span>

<span data-ttu-id="0e21e-228">**Figura 03**: Modelos-ContactManagerServiceTest.cs([Haga clic para ver la imagen de tamaño completo](iteration-5-create-unit-tests-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="0e21e-228">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image6.png))</span></span>

<span data-ttu-id="0e21e-229">Inicialmente, queremos probar el método CreateContact() expuesto por la clase ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="0e21e-229">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="0e21e-230">Crearemos las siguientes cinco pruebas:</span><span class="sxs-lookup"><span data-stu-id="0e21e-230">We'll create the following five tests:</span></span>

- <span data-ttu-id="0e21e-231">CreateContact() - Pruebas que CreateContact() devuelve el valor true cuando se pasa un contacto válido al método.</span><span class="sxs-lookup"><span data-stu-id="0e21e-231">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="0e21e-232">CreateContactRequiredFirstName() - Comprueba que se agrega un mensaje de error al estado del modelo cuando se pasa un contacto con un nombre que falta al método CreateContact().</span><span class="sxs-lookup"><span data-stu-id="0e21e-232">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="0e21e-233">CreateContactRequiredLastName() - Comprueba que se agrega un mensaje de error al estado del modelo cuando se pasa un contacto con un apellido que falta al método CreateContact().</span><span class="sxs-lookup"><span data-stu-id="0e21e-233">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="0e21e-234">CreateContactInvalidPhone() - Comprueba que se agrega un mensaje de error al estado del modelo cuando se pasa un contacto con un número de teléfono no válido al método CreateContact().</span><span class="sxs-lookup"><span data-stu-id="0e21e-234">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="0e21e-235">CreateContactInvalidEmail(): comprueba que se agrega un mensaje de error al estado del modelo cuando se pasa un contacto con una dirección de correo electrónico no válida al método CreateContact().</span><span class="sxs-lookup"><span data-stu-id="0e21e-235">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="0e21e-236">La primera prueba comprueba que un contacto válido no genera un error de validación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-236">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="0e21e-237">Las pruebas restantes comprueban cada una de las reglas de validación.</span><span class="sxs-lookup"><span data-stu-id="0e21e-237">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="0e21e-238">El código de estas pruebas se encuentra en el listado 1.</span><span class="sxs-lookup"><span data-stu-id="0e21e-238">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="0e21e-239">**Listado 1 - Modelos-ContactManagerServiceTest.cs**</span><span class="sxs-lookup"><span data-stu-id="0e21e-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample1.cs)]

<span data-ttu-id="0e21e-240">Dado que usamos la clase Contact en el listado 1, necesitamos agregar una referencia a Microsoft Entity Framework a nuestro proyecto de prueba.</span><span class="sxs-lookup"><span data-stu-id="0e21e-240">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="0e21e-241">Agregue una referencia al ensamblado System.Data.Entity.</span><span class="sxs-lookup"><span data-stu-id="0e21e-241">Add a reference to the System.Data.Entity assembly.</span></span>

<span data-ttu-id="0e21e-242">El listado 1 contiene un método denominado Initialize() que está decorado con el atributo [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="0e21e-242">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="0e21e-243">Este método se llama automáticamente antes de que se ejecute cada una de las pruebas unitarias (se llama 5 veces antes de cada una de las pruebas unitarias).</span><span class="sxs-lookup"><span data-stu-id="0e21e-243">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="0e21e-244">El método Initialize() crea un repositorio ficticio con la siguiente línea de código:</span><span class="sxs-lookup"><span data-stu-id="0e21e-244">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample2.cs)]

<span data-ttu-id="0e21e-245">Esta línea de código utiliza el marco Moq para generar un repositorio ficticio desde la interfaz IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="0e21e-245">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="0e21e-246">El repositorio ficticio se utiliza en lugar del EntityContactManagerRepository real para evitar el acceso a la base de datos cuando se ejecuta cada prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="0e21e-246">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="0e21e-247">El repositorio ficticio implementa los métodos de la interfaz IContactManagerRepository, pero los métodos no hacen nada realmente.</span><span class="sxs-lookup"><span data-stu-id="0e21e-247">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="0e21e-248">Cuando se utiliza el marco de \_trabajo Moq, hay una distinción entre mockRepository y \_mockRepository.Object.</span><span class="sxs-lookup"><span data-stu-id="0e21e-248">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="0e21e-249">El primero hace&lt;referencia a&gt; la clase Mock IContactManagerRepository que contiene métodos para especificar cómo se comportará el repositorio ficticio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-249">The former refers to the Mock&lt;IContactManagerRepository&gt; class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="0e21e-250">Este último hace referencia al repositorio ficticio real que implementa la interfaz IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="0e21e-250">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>

<span data-ttu-id="0e21e-251">El repositorio ficticio se utiliza en el método Initialize() al crear una instancia de la clase ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="0e21e-251">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="0e21e-252">Todas las pruebas unitarias individuales utilizan esta instancia de la ContactManagerService clase.</span><span class="sxs-lookup"><span data-stu-id="0e21e-252">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="0e21e-253">El listado 1 contiene cinco métodos que corresponden a cada una de las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0e21e-253">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="0e21e-254">Cada uno de estos métodos está decorado con el atributo [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="0e21e-254">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="0e21e-255">Al ejecutar las pruebas unitarias, se llama a cualquier método que tenga este atributo.</span><span class="sxs-lookup"><span data-stu-id="0e21e-255">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="0e21e-256">En otras palabras, cualquier método que esté decorado con el atributo [TestMethod] es una prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="0e21e-256">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="0e21e-257">La primera prueba unitaria, denominada CreateContact(), comprueba que al llamar a CreateContact() se devuelve el valor true cuando se pasa una instancia válida de la clase Contact al método.</span><span class="sxs-lookup"><span data-stu-id="0e21e-257">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="0e21e-258">La prueba crea una instancia de la clase Contact, llama al método CreateContact() y comprueba que CreateContact() devuelve el valor true.</span><span class="sxs-lookup"><span data-stu-id="0e21e-258">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="0e21e-259">Las pruebas restantes comprueban que cuando se llama al método CreateContact() con un contacto no válido, el método devuelve false y el mensaje de error de validación esperado se agrega al estado del modelo.</span><span class="sxs-lookup"><span data-stu-id="0e21e-259">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="0e21e-260">Por ejemplo, la prueba CreateContactRequiredFirstName() crea una instancia de la clase Contact con una cadena vacía para su propiedad FirstName.</span><span class="sxs-lookup"><span data-stu-id="0e21e-260">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="0e21e-261">A continuación, se llama al método CreateContact() con el contacto no válido.</span><span class="sxs-lookup"><span data-stu-id="0e21e-261">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="0e21e-262">Por último, la prueba comprueba que CreateContact() devuelve false y que el estado del modelo contiene el mensaje de error de validación esperado "Se requiere el nombre."</span><span class="sxs-lookup"><span data-stu-id="0e21e-262">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="0e21e-263">Puede ejecutar las pruebas unitarias en el listado 1 seleccionando la opción de menú **Prueba, Ejecutar, Todas las pruebas en solución (CTRL+R, A)**.</span><span class="sxs-lookup"><span data-stu-id="0e21e-263">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="0e21e-264">Los resultados de las pruebas se visualizan en la ventana Resultados de la prueba (consulte la figura 4).</span><span class="sxs-lookup"><span data-stu-id="0e21e-264">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>

<span data-ttu-id="0e21e-265">[![Resultados de la prueba](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0e21e-265">[![Test Results](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span></span>

<span data-ttu-id="0e21e-266">**Figura 04**: Resultados de la prueba ([Haga clic para ver la imagen de tamaño completo](iteration-5-create-unit-tests-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="0e21e-266">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image8.png))</span></span>

## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="0e21e-267">Creación de pruebas unitarias para controladores</span><span class="sxs-lookup"><span data-stu-id="0e21e-267">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="0e21e-268">La aplicación ASP.NETMVC controla el flujo de interacción del usuario.</span><span class="sxs-lookup"><span data-stu-id="0e21e-268">ASP.NETMVC application control the flow of user interaction.</span></span> <span data-ttu-id="0e21e-269">Al probar un controlador, desea probar si el controlador devuelve el resultado de la acción correcta y ver los datos.</span><span class="sxs-lookup"><span data-stu-id="0e21e-269">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="0e21e-270">También es posible que desee probar si un controlador interactúa con las clases de modelo de la manera esperada.</span><span class="sxs-lookup"><span data-stu-id="0e21e-270">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="0e21e-271">Por ejemplo, el listado 2 contiene dos pruebas unitarias para el método Create() del controlador de contacto.</span><span class="sxs-lookup"><span data-stu-id="0e21e-271">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="0e21e-272">La primera prueba unitaria comprueba que cuando se pasa un contacto válido al método Create(), el método Create() redirige a la acción Index.</span><span class="sxs-lookup"><span data-stu-id="0e21e-272">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="0e21e-273">En otras palabras, cuando se pasa un contacto válido, el método Create() debe devolver un RedirectToRouteResult que representa la acción Index.</span><span class="sxs-lookup"><span data-stu-id="0e21e-273">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="0e21e-274">No queremos probar la capa de servicio ContactManager cuando estamos probando la capa de controlador.</span><span class="sxs-lookup"><span data-stu-id="0e21e-274">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="0e21e-275">Por lo tanto, nos simulamos la capa de servicio con el siguiente código en el método Initialize:</span><span class="sxs-lookup"><span data-stu-id="0e21e-275">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample3.cs)]

<span data-ttu-id="0e21e-276">En la prueba unitaria CreateValidContact(), simulamos el comportamiento de llamar al método CreateContact() de la capa de servicio con la siguiente línea de código:</span><span class="sxs-lookup"><span data-stu-id="0e21e-276">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample4.cs)]

<span data-ttu-id="0e21e-277">Esta línea de código hace que el servicio ContactManager ficticio devuelva el valor true cuando se llama a su método CreateContact().</span><span class="sxs-lookup"><span data-stu-id="0e21e-277">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="0e21e-278">Al burlarnos de la capa de servicio, podemos probar el comportamiento de nuestro controlador sin necesidad de ejecutar ningún código en la capa de servicio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-278">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="0e21e-279">La segunda prueba unitaria comprueba que la acción Create() devuelve la vista Create cuando se pasa un contacto no válido al método.</span><span class="sxs-lookup"><span data-stu-id="0e21e-279">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="0e21e-280">Hacemos que el método CreateContact() de la capa de servicio devuelva el valor false con la siguiente línea de código:</span><span class="sxs-lookup"><span data-stu-id="0e21e-280">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample5.cs)]

<span data-ttu-id="0e21e-281">Si el método Create() se comporta como esperamos, debe devolver la vista Create cuando la capa de servicio devuelve el valor false.</span><span class="sxs-lookup"><span data-stu-id="0e21e-281">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="0e21e-282">De este modo, el controlador puede mostrar los mensajes de error de validación en la vista Crear y el usuario tiene la oportunidad de corregir las propiedades contactno no válidas.</span><span class="sxs-lookup"><span data-stu-id="0e21e-282">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>

<span data-ttu-id="0e21e-283">Si planea crear pruebas unitarias para los controladores, debe devolver nombres de vista explícitos de las acciones del controlador.</span><span class="sxs-lookup"><span data-stu-id="0e21e-283">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="0e21e-284">Por ejemplo, no devuelva una vista como esta:</span><span class="sxs-lookup"><span data-stu-id="0e21e-284">For example, do not return a view like this:</span></span>

<span data-ttu-id="0e21e-285">devolver View();</span><span class="sxs-lookup"><span data-stu-id="0e21e-285">return View();</span></span>

<span data-ttu-id="0e21e-286">En su lugar, devuelva la vista de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="0e21e-286">Instead, return the view like this:</span></span>

<span data-ttu-id="0e21e-287">return View("Create");</span><span class="sxs-lookup"><span data-stu-id="0e21e-287">return View("Create");</span></span>

<span data-ttu-id="0e21e-288">Si no es explícito al devolver una vista, la propiedad ViewResult.ViewName devuelve una cadena vacía.</span><span class="sxs-lookup"><span data-stu-id="0e21e-288">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>

<span data-ttu-id="0e21e-289">**Listado 2 - Controllers-ContactControllerTest.cs**</span><span class="sxs-lookup"><span data-stu-id="0e21e-289">**Listing 2 - Controllers\ContactControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample6.cs)]

## <a name="summary"></a><span data-ttu-id="0e21e-290">Resumen</span><span class="sxs-lookup"><span data-stu-id="0e21e-290">Summary</span></span>

<span data-ttu-id="0e21e-291">En esta iteración, hemos creado pruebas unitarias para nuestra aplicación Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="0e21e-291">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="0e21e-292">Podemos ejecutar estas pruebas unitarias en cualquier momento para comprobar que nuestra aplicación todavía se comporta de la manera que esperamos.</span><span class="sxs-lookup"><span data-stu-id="0e21e-292">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="0e21e-293">Las pruebas unitarias actúan como una red de seguridad para nuestra aplicación que nos permite modificar de forma segura nuestra aplicación en el futuro.</span><span class="sxs-lookup"><span data-stu-id="0e21e-293">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="0e21e-294">Creamos dos conjuntos de pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="0e21e-294">We created two sets of unit tests.</span></span> <span data-ttu-id="0e21e-295">En primer lugar, probamos nuestra lógica de validación mediante la creación de pruebas unitarias para nuestra capa de servicio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-295">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="0e21e-296">A continuación, probamos nuestra lógica de control de flujo mediante la creación de pruebas unitarias para nuestra capa de controlador.</span><span class="sxs-lookup"><span data-stu-id="0e21e-296">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="0e21e-297">Al probar nuestra capa de servicio, aislamos nuestras pruebas para nuestra capa de servicio de nuestra capa de repositorio burlándose de nuestra capa de repositorio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-297">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="0e21e-298">Al probar la capa de controlador, aislamos nuestras pruebas para nuestra capa de controlador burlándonos de la capa de servicio.</span><span class="sxs-lookup"><span data-stu-id="0e21e-298">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="0e21e-299">En la siguiente iteración, modificamos la aplicación Contact Manager para que admita grupos de contactos.</span><span class="sxs-lookup"><span data-stu-id="0e21e-299">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="0e21e-300">Agregaremos esta nueva funcionalidad a nuestra aplicación mediante un proceso de diseño de software llamado desarrollo controlado por pruebas.</span><span class="sxs-lookup"><span data-stu-id="0e21e-300">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0e21e-301">[Anterior](iteration-4-make-the-application-loosely-coupled-cs.md)
> [Siguiente](iteration-6-use-test-driven-development-cs.md)</span><span class="sxs-lookup"><span data-stu-id="0e21e-301">[Previous](iteration-4-make-the-application-loosely-coupled-cs.md)
[Next](iteration-6-use-test-driven-development-cs.md)</span></span>
