---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
title: 'Introducción a ASP.NET Web Pages: actualización de la base de datos | Microsoft Docs'
author: Rick-Anderson
description: Este tutorial muestra cómo actualizar la entrada de una base de datos existente (cambiar) al usar ASP.NET Web Pages (Razor). Supone que ha completado la serie th...
ms.author: riande
ms.date: 01/02/2018
ms.assetid: ac86ec9c-6b69-485b-b9e0-8b9127b13e6b
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
msc.type: authoredcontent
ms.openlocfilehash: 4542ad3ac3e321629bb4de3cd4df12c22ff6cb20
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/09/2019
ms.locfileid: "59414626"
---
# <a name="introducing-aspnet-web-pages---updating-database-data"></a><span data-ttu-id="e2d22-104">Introducción a ASP.NET Web Pages: actualización de la base de datos</span><span class="sxs-lookup"><span data-stu-id="e2d22-104">Introducing ASP.NET Web Pages - Updating Database Data</span></span>

<span data-ttu-id="e2d22-105">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="e2d22-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="e2d22-106">Este tutorial muestra cómo actualizar la entrada de una base de datos existente (cambiar) al usar ASP.NET Web Pages (Razor).</span><span class="sxs-lookup"><span data-stu-id="e2d22-106">This tutorial shows you how to update (change) an existing database entry when you use ASP.NET Web Pages (Razor).</span></span> <span data-ttu-id="e2d22-107">Supone que ha completado la serie a través de [introducción de datos por uso de formularios utilizando ASP.NET Web Pages](entering-data.md).</span><span class="sxs-lookup"><span data-stu-id="e2d22-107">It assumes you have completed the series through [Entering Data by Using Forms Using ASP.NET Web Pages](entering-data.md).</span></span>
> 
> <span data-ttu-id="e2d22-108">Lo que aprenderá:</span><span class="sxs-lookup"><span data-stu-id="e2d22-108">What you'll learn:</span></span>
> 
> - <span data-ttu-id="e2d22-109">Cómo seleccionar un registro individual en el `WebGrid` auxiliar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-109">How to select an individual record in the `WebGrid` helper.</span></span>
> - <span data-ttu-id="e2d22-110">Cómo leer un único registro de una base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-110">How to read a single record from a database.</span></span>
> - <span data-ttu-id="e2d22-111">Cómo cargar previamente un formulario con los valores del registro de base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-111">How to preload a form with values from the database record.</span></span>
> - <span data-ttu-id="e2d22-112">Cómo actualizar un registro existente en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-112">How to update an existing record in a database.</span></span>
> - <span data-ttu-id="e2d22-113">Cómo almacenar información en la página sin mostrarlo.</span><span class="sxs-lookup"><span data-stu-id="e2d22-113">How to store information in the page without displaying it.</span></span>
> - <span data-ttu-id="e2d22-114">Cómo usar un campo oculto para almacenar información.</span><span class="sxs-lookup"><span data-stu-id="e2d22-114">How to use a hidden field to store information.</span></span>
>   
> 
> <span data-ttu-id="e2d22-115">Características y tecnologías tratadas:</span><span class="sxs-lookup"><span data-stu-id="e2d22-115">Features/technologies discussed:</span></span>
> 
> - <span data-ttu-id="e2d22-116">El `WebGrid` auxiliar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-116">The `WebGrid` helper.</span></span>
> - <span data-ttu-id="e2d22-117">El código SQL `Update` comando.</span><span class="sxs-lookup"><span data-stu-id="e2d22-117">The SQL `Update` command.</span></span>
> - <span data-ttu-id="e2d22-118">El método `Database.Execute` .</span><span class="sxs-lookup"><span data-stu-id="e2d22-118">The `Database.Execute` method.</span></span>
> - <span data-ttu-id="e2d22-119">Campos ocultos (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="e2d22-119">Hidden fields (`<input type="hidden">`).</span></span>


## <a name="what-youll-build"></a><span data-ttu-id="e2d22-120">¿Qué va a crear</span><span class="sxs-lookup"><span data-stu-id="e2d22-120">What You'll Build</span></span>

<span data-ttu-id="e2d22-121">En el tutorial anterior, ha aprendido a agregar un registro a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-121">In the previous tutorial, you learned how to add a record to a database.</span></span> <span data-ttu-id="e2d22-122">En este caso, obtendrá información sobre cómo mostrar un registro para editarlo.</span><span class="sxs-lookup"><span data-stu-id="e2d22-122">Here, you'll learn how to display a record for editing.</span></span> <span data-ttu-id="e2d22-123">En el *películas* página, actualizará la `WebGrid` auxiliar para que muestre que TI un **editar** vínculo situado junto a cada película:</span><span class="sxs-lookup"><span data-stu-id="e2d22-123">In the *Movies* page, you'll update the `WebGrid` helper so that it displays an **Edit** link next to each movie:</span></span>

![WebGrid mostrar como un vínculo "Editar" para cada película](updating-data/_static/image1.png)

<span data-ttu-id="e2d22-125">Al hacer clic en el **editar** vínculo le lleva a una página distinta, donde la información de películas ya está en un formulario:</span><span class="sxs-lookup"><span data-stu-id="e2d22-125">When you click the **Edit** link, it takes you to a different page, where the movie information is already in a form:</span></span>

![Editar página de la película que muestra la película se puedan editar](updating-data/_static/image2.png)

<span data-ttu-id="e2d22-127">Puede cambiar cualquiera de los valores.</span><span class="sxs-lookup"><span data-stu-id="e2d22-127">You can change any of the values.</span></span> <span data-ttu-id="e2d22-128">Al enviar los cambios, el código de la página actualiza la base de datos y lo devuelve a la lista de películas.</span><span class="sxs-lookup"><span data-stu-id="e2d22-128">When you submit the changes, the code in the page updates the database and takes you back to the movie listing.</span></span>

<span data-ttu-id="e2d22-129">Esta parte del proceso funciona casi exactamente igual que el *AddMovie.cshtml* página creada en el tutorial anterior, por lo que gran parte de este tutorial le resultarán familiar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-129">This part of the process works almost exactly like the *AddMovie.cshtml* page you created in the previous tutorial, so much of this tutorial will be familiar.</span></span>

<span data-ttu-id="e2d22-130">Hay varias maneras podría implementar una forma de editar una película individual.</span><span class="sxs-lookup"><span data-stu-id="e2d22-130">There are several ways you could implement a way to edit an individual movie.</span></span> <span data-ttu-id="e2d22-131">Se ha elegido el enfoque mostrado porque es fácil de implementar y fácil de entender.</span><span class="sxs-lookup"><span data-stu-id="e2d22-131">The approach shown was chosen because it's easy to implement and easy to understand.</span></span>

## <a name="adding-an-edit-link-to-the-movie-listing"></a><span data-ttu-id="e2d22-132">Agregar un vínculo de edición a la lista de películas</span><span class="sxs-lookup"><span data-stu-id="e2d22-132">Adding an Edit Link to the Movie Listing</span></span>

<span data-ttu-id="e2d22-133">Para empezar, actualizará la *películas* página para que cada película en la lista también contiene un **editar** vínculo.</span><span class="sxs-lookup"><span data-stu-id="e2d22-133">To begin, you'll update the *Movies* page so that each movie listing also contains an **Edit** link.</span></span>

<span data-ttu-id="e2d22-134">Abra el *Movies.cshtml* archivo.</span><span class="sxs-lookup"><span data-stu-id="e2d22-134">Open the *Movies.cshtml* file.</span></span>

<span data-ttu-id="e2d22-135">En el cuerpo de la página, cambie la `WebGrid` marcado mediante la adición de una columna.</span><span class="sxs-lookup"><span data-stu-id="e2d22-135">In the body of the page, change the `WebGrid` markup by adding a column.</span></span> <span data-ttu-id="e2d22-136">Aquí está el marcado modificado:</span><span class="sxs-lookup"><span data-stu-id="e2d22-136">Here's the modified markup:</span></span>

[!code-html[Main](updating-data/samples/sample1.html?highlight=6)]

<span data-ttu-id="e2d22-137">Esta es la nueva columna:</span><span class="sxs-lookup"><span data-stu-id="e2d22-137">The new column is this one:</span></span>

[!code-html[Main](updating-data/samples/sample2.html)]

<span data-ttu-id="e2d22-138">El objetivo de esta columna es mostrar un vínculo (`<a>` elemento) cuyo texto dice "Editar".</span><span class="sxs-lookup"><span data-stu-id="e2d22-138">The point of this column is to show a link (`<a>` element) whose text says "Edit".</span></span> <span data-ttu-id="e2d22-139">Lo que tenemos es crear un vínculo con el siguiente aspecto cuando se ejecuta la página, con el `id` valor diferente para cada película:</span><span class="sxs-lookup"><span data-stu-id="e2d22-139">What we're after is to create a link that looks like the following when the page runs, with the `id` value different for each movie:</span></span>

[!code-css[Main](updating-data/samples/sample3.css)]

<span data-ttu-id="e2d22-140">Este vínculo invocará una página denominada *EditMovie*, y pasará la cadena de consulta `?id=7` a esa página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-140">This link will invoke a page named *EditMovie*, and it will pass the query string `?id=7` to that page.</span></span>

<span data-ttu-id="e2d22-141">La sintaxis para la nueva columna puede parecer un poco compleja, pero es solo que reúne varios elementos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-141">The syntax for the new column might look a bit complex, but that's only because it puts together several elements.</span></span> <span data-ttu-id="e2d22-142">Cada elemento individual es sencillo.</span><span class="sxs-lookup"><span data-stu-id="e2d22-142">Each individual element is straightforward.</span></span> <span data-ttu-id="e2d22-143">Si concentrarse en la que solo el `<a>` elemento, vea este marcado:</span><span class="sxs-lookup"><span data-stu-id="e2d22-143">If you concentrate on just the `<a>` element, you see this markup:</span></span>

[!code-html[Main](updating-data/samples/sample4.html)]

<span data-ttu-id="e2d22-144">Conocimientos sobre el funcionamiento de la cuadrícula: la cuadrícula muestra las filas, uno para cada registro de base de datos, y muestra las columnas para cada campo en el registro de base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-144">Some background about how the grid works: the grid displays rows, one for each database record, and it displays columns for each field in the database record.</span></span> <span data-ttu-id="e2d22-145">Mientras se está construyendo cada fila de cuadrícula, la `item` objeto contiene el registro de base de datos (elemento) para esa fila.</span><span class="sxs-lookup"><span data-stu-id="e2d22-145">While each grid row is being constructed, the `item` object contains the database record (item) for that row.</span></span> <span data-ttu-id="e2d22-146">Esta disposición proporciona una forma en el código para obtener los datos para esa fila.</span><span class="sxs-lookup"><span data-stu-id="e2d22-146">This arrangement gives you a way in code to get at the data for that row.</span></span> <span data-ttu-id="e2d22-147">Eso es lo que ve aquí: la expresión `item.ID` es obtener el valor de Id. del elemento de base de datos actual.</span><span class="sxs-lookup"><span data-stu-id="e2d22-147">That's what you see here: the expression `item.ID` is getting the ID value of the current database item.</span></span> <span data-ttu-id="e2d22-148">Se podría obtener cualquiera de los valores de la base de datos (título, género o año) la misma manera mediante `item.Title`, `item.Genre`, o `item.Year`.</span><span class="sxs-lookup"><span data-stu-id="e2d22-148">You could get any of the database values (title, genre, or year) the same way by using `item.Title`, `item.Genre`, or `item.Year`.</span></span>

<span data-ttu-id="e2d22-149">La expresión `"~/EditMovie?id=@item.ID` combina la parte modificable de la dirección URL de destino (`~/EditMovie?id=`) con este identificador dinámicamente derivada.</span><span class="sxs-lookup"><span data-stu-id="e2d22-149">The expression `"~/EditMovie?id=@item.ID` combines the hard-coded part of the target URL (`~/EditMovie?id=`) with this dynamically derived ID.</span></span> <span data-ttu-id="e2d22-150">(Se vio la `~` operador en el tutorial anterior; es un operador de ASP.NET que representa la raíz del sitio Web actual.)</span><span class="sxs-lookup"><span data-stu-id="e2d22-150">(You saw the `~` operator in the previous tutorial; it's an ASP.NET operator that represents the current website root.)</span></span>

<span data-ttu-id="e2d22-151">El resultado es que esta parte del marcado en la columna simplemente genera algo parecido al siguiente marcado en tiempo de ejecución:</span><span class="sxs-lookup"><span data-stu-id="e2d22-151">The result is that this part of the markup in the column simply produces something like the following markup at run time:</span></span>

[!code-xml[Main](updating-data/samples/sample5.xml)]

<span data-ttu-id="e2d22-152">Naturalmente, el valor real de `id` será diferente para cada fila.</span><span class="sxs-lookup"><span data-stu-id="e2d22-152">Naturally, the actual value of `id` will be different for each row.</span></span>

## <a name="creating-a-custom-display-for-a-grid-column"></a><span data-ttu-id="e2d22-153">Crear una visualización personalizada para una columna de cuadrícula</span><span class="sxs-lookup"><span data-stu-id="e2d22-153">Creating a Custom Display for a Grid Column</span></span>

<span data-ttu-id="e2d22-154">Ahora volvamos a la columna de cuadrícula.</span><span class="sxs-lookup"><span data-stu-id="e2d22-154">Now back to the grid column.</span></span> <span data-ttu-id="e2d22-155">Las tres columnas originalmente había en la cuadrícula muestra solo valores de datos (título, género y año).</span><span class="sxs-lookup"><span data-stu-id="e2d22-155">The three columns you originally had in the grid displayed only data values (title, genre, and year).</span></span> <span data-ttu-id="e2d22-156">Especificar esta pantalla, pasando el nombre de la columna de base de datos &mdash; por ejemplo, `grid.Column("Title")`.</span><span class="sxs-lookup"><span data-stu-id="e2d22-156">You specified this display by passing the name of the database column &mdash; for example, `grid.Column("Title")`.</span></span>

<span data-ttu-id="e2d22-157">Esta nueva **editar** columna vínculo es diferente.</span><span class="sxs-lookup"><span data-stu-id="e2d22-157">This new **Edit** link column is different.</span></span> <span data-ttu-id="e2d22-158">En lugar de especificar un nombre de columna, que está pasando un `format` parámetro.</span><span class="sxs-lookup"><span data-stu-id="e2d22-158">Instead of specifying a column name, you're passing a `format` parameter.</span></span> <span data-ttu-id="e2d22-159">Este parámetro le permite definir el marcado que el `WebGrid` auxiliar se representará junto con el `item` valor para mostrar los datos de columna en negrita o verde o en el formato que desee.</span><span class="sxs-lookup"><span data-stu-id="e2d22-159">This parameter lets you define markup that the `WebGrid` helper will render along with the `item` value to display the column data as bold or green or in whatever format that you want.</span></span> <span data-ttu-id="e2d22-160">Por ejemplo, si deseara que el título aparece en negrita, podría crear una columna como en este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e2d22-160">For example, if you wanted the title to appear bold, you could create a column like this example:</span></span>

[!code-html[Main](updating-data/samples/sample6.html)]

<span data-ttu-id="e2d22-161">(Los diversos `@` caracteres que veas en el `format` propiedad marcar la transición entre el marcado y un valor de código.)</span><span class="sxs-lookup"><span data-stu-id="e2d22-161">(The various `@` characters you see in the `format` property mark the transition between markup and a code value.)</span></span>

<span data-ttu-id="e2d22-162">Una vez que sepa sobre el `format` propiedad, resulta más fácil de entender cómo la nueva **editar** elaborado columna vínculo:</span><span class="sxs-lookup"><span data-stu-id="e2d22-162">Once you know about the `format` property, it's easier to understand how the new **Edit** link column is put together:</span></span>

[!code-html[Main](updating-data/samples/sample7.html)]

<span data-ttu-id="e2d22-163">Consta de la columna *sólo* del marcado que representa el vínculo, además de cierta información (identificador) que se extrae de la base de datos registro para la fila.</span><span class="sxs-lookup"><span data-stu-id="e2d22-163">The column consists *only* of the markup that renders the link, plus some information (the ID) that's extracted from the database record for the row.</span></span>

> [!TIP]
> 
> **<span data-ttu-id="e2d22-164">Parámetros con nombre y parámetros posicionales para un método</span><span class="sxs-lookup"><span data-stu-id="e2d22-164">Named Parameters and Positional Parameters for a Method</span></span>**
> 
> <span data-ttu-id="e2d22-165">Muchas veces cuando se ha llamado a un método y parámetros que se pasan a él, simplemente ha enumerado los valores de parámetros separados por comas.</span><span class="sxs-lookup"><span data-stu-id="e2d22-165">Many times when you've called a method and passed parameters to it, you've simply listed the parameter values separated by commas.</span></span> <span data-ttu-id="e2d22-166">A continuación se muestran un par de ejemplos:</span><span class="sxs-lookup"><span data-stu-id="e2d22-166">Here are a couple of examples:</span></span>
> 
> `db.Execute(insertCommand, title, genre, year)`
> 
> `Validation.RequireField("title", "You must enter a title")`
> 
> <span data-ttu-id="e2d22-167">No lo hemos mencionado el problema cuando vio primero este código, pero en cada caso, está pasando los parámetros a los métodos en un orden específico &mdash; es decir, el orden en que los parámetros se definen en ese método.</span><span class="sxs-lookup"><span data-stu-id="e2d22-167">We didn't mention the issue when you first saw this code, but in each case, you're passing parameters to the methods in a specific order &mdash; namely, the order in which the parameters are defined in that method.</span></span> <span data-ttu-id="e2d22-168">Para `db.Execute` y `Validation.RequireFields`, si se combina el orden de los valores pasados, obtendría un mensaje de error cuando se ejecuta la página, o al menos algunos resultados extraños.</span><span class="sxs-lookup"><span data-stu-id="e2d22-168">For `db.Execute` and `Validation.RequireFields`, if you mixed up the order of the values you pass, you'd get an error message when the page runs, or at least some strange results.</span></span> <span data-ttu-id="e2d22-169">Claramente, tendrá que saber el orden para pasar los parámetros.</span><span class="sxs-lookup"><span data-stu-id="e2d22-169">Clearly, you have to know the order to pass the parameters in.</span></span> <span data-ttu-id="e2d22-170">(En WebMatrix, IntelliSense puede ayudarle a aprender a averiguar el nombre, tipo y orden de los parámetros.)</span><span class="sxs-lookup"><span data-stu-id="e2d22-170">(In WebMatrix, IntelliSense can help you learn figure out the name, type, and order of the parameters.)</span></span>
> 
> <span data-ttu-id="e2d22-171">Como alternativa para pasar valores en orden, puede usar *parámetros con nombre*.</span><span class="sxs-lookup"><span data-stu-id="e2d22-171">As an alternative to passing values in order, you can use *named parameters*.</span></span> <span data-ttu-id="e2d22-172">(Pasar parámetros en orden se conoce como utilización *parámetros posicionales*.) Para los parámetros con nombre, se incluye explícitamente el nombre del parámetro al pasar su valor.</span><span class="sxs-lookup"><span data-stu-id="e2d22-172">(Passing parameters in order is known as using *positional parameters*.) For named parameters, you explicitly include the name of the parameter when passing its value.</span></span> <span data-ttu-id="e2d22-173">Se ha usado los parámetros con nombre ya un número de veces en estos tutoriales.</span><span class="sxs-lookup"><span data-stu-id="e2d22-173">You've used named parameters already a number of times in these tutorials.</span></span> <span data-ttu-id="e2d22-174">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e2d22-174">For example:</span></span>
> 
> [!code-csharp[Main](updating-data/samples/sample8.cs)]
> 
> <span data-ttu-id="e2d22-175">y</span><span class="sxs-lookup"><span data-stu-id="e2d22-175">and</span></span>
> 
> [!code-css[Main](updating-data/samples/sample9.css)]
> 
> <span data-ttu-id="e2d22-176">Parámetros con nombre son útiles para un par de situaciones, especialmente cuando un método toma el número de parámetros.</span><span class="sxs-lookup"><span data-stu-id="e2d22-176">Named parameters are handy for a couple of situations, especially when a method takes many parameters.</span></span> <span data-ttu-id="e2d22-177">Uno es cuando desea pasar solo uno o dos parámetros, pero no son los valores que van a pasar entre las posiciones de primera en la lista de parámetros.</span><span class="sxs-lookup"><span data-stu-id="e2d22-177">One is when you want to pass only one or two parameters, but the values you want to pass are not among the first positions in the parameter list.</span></span> <span data-ttu-id="e2d22-178">Otra situación es cuando desea que el código sea más legible, pasando los parámetros en el orden en que más sentido para usted.</span><span class="sxs-lookup"><span data-stu-id="e2d22-178">Another situation is when you want to make your code more readable by passing the parameters in the order that makes the most sense to you.</span></span>
> 
> <span data-ttu-id="e2d22-179">Obviamente, para usar parámetros con nombre, tendrá que conocer los nombres de los parámetros.</span><span class="sxs-lookup"><span data-stu-id="e2d22-179">Obviously, to use named parameters, you have to know the names of the parameters.</span></span> <span data-ttu-id="e2d22-180">WebMatrix IntelliSense puede *mostrar* los nombres, pero no puede actualmente rellenarlo para usted.</span><span class="sxs-lookup"><span data-stu-id="e2d22-180">WebMatrix IntelliSense can *show* you the names, but it cannot currently fill them in for you.</span></span>


## <a name="creating-the-edit-page"></a><span data-ttu-id="e2d22-181">Creación de la página de edición</span><span class="sxs-lookup"><span data-stu-id="e2d22-181">Creating the Edit Page</span></span>

<span data-ttu-id="e2d22-182">Ahora puede crear el *EditMovie* página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-182">Now you can create the *EditMovie* page.</span></span> <span data-ttu-id="e2d22-183">Cuando los usuarios hacen clic los **editar** vínculo, terminará en esta página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-183">When users click the **Edit** link, they'll end up on this page.</span></span>

<span data-ttu-id="e2d22-184">Cree una página denominada *EditMovie.cshtml* y sustituir lo que aparece en el archivo con el siguiente marcado:</span><span class="sxs-lookup"><span data-stu-id="e2d22-184">Create a page named *EditMovie.cshtml* and replace what's in the file with the following markup:</span></span>

[!code-cshtml[Main](updating-data/samples/sample10.cshtml)]

<span data-ttu-id="e2d22-185">Este marcado y el código es similar a lo que tiene en el *AddMovie* página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-185">This markup and code is similar to what you have in the *AddMovie* page.</span></span> <span data-ttu-id="e2d22-186">Hay una pequeña diferencia en el texto para el botón Enviar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-186">There's a small difference in the text for the submit button.</span></span> <span data-ttu-id="e2d22-187">Igual que con el *AddMovie* página, hay un `Html.ValidationSummary` llamada que se mostrará los errores de validación si existe alguna.</span><span class="sxs-lookup"><span data-stu-id="e2d22-187">As with the *AddMovie* page, there's an `Html.ValidationSummary` call that will display validation errors if there are any.</span></span> <span data-ttu-id="e2d22-188">Esta vez nos estamos omitiendo las llamadas a `Validation.Message`, ya que los errores se mostrarán en el resumen de validación.</span><span class="sxs-lookup"><span data-stu-id="e2d22-188">This time we're leaving out calls to `Validation.Message`, since errors will be displayed in the validation summary.</span></span> <span data-ttu-id="e2d22-189">Como se indicó en el tutorial anterior, puede usar el resumen de validación y los mensajes de error individuales en diversas combinaciones.</span><span class="sxs-lookup"><span data-stu-id="e2d22-189">As noted in the previous tutorial, you can use the validation summary and the individual error messages in various combinations.</span></span>

<span data-ttu-id="e2d22-190">Observe nuevamente que la `method` atributo de la `<form>` elemento está establecido en `post`.</span><span class="sxs-lookup"><span data-stu-id="e2d22-190">Notice again that the `method` attribute of the `<form>` element is set to `post`.</span></span> <span data-ttu-id="e2d22-191">Igual que con el *AddMovie.cshtml* página, esta página realiza cambios en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-191">As with the *AddMovie.cshtml* page, this page makes changes to the database.</span></span> <span data-ttu-id="e2d22-192">Por lo tanto, debe realizar este formulario un `POST` operación.</span><span class="sxs-lookup"><span data-stu-id="e2d22-192">Therefore, this form should perform a `POST` operation.</span></span> <span data-ttu-id="e2d22-193">(Para obtener más información sobre la diferencia entre `GET` y `POST` operaciones, vea el [GET, POST y HTTP verbo seguridad](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) sidebar en el tutorial en formularios HTML.)</span><span class="sxs-lookup"><span data-stu-id="e2d22-193">(For more about the difference between `GET` and `POST` operations, see the [GET, POST, and HTTP Verb Safety](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) sidebar in the tutorial on HTML forms.)</span></span>

<span data-ttu-id="e2d22-194">Como se vio en un tutorial anterior, el `value` se establecen los atributos de los cuadros de texto con el código de Razor para cargarlas.</span><span class="sxs-lookup"><span data-stu-id="e2d22-194">As you saw in an earlier tutorial, the `value` attributes of the text boxes are being set with Razor code in order to preload them.</span></span> <span data-ttu-id="e2d22-195">Esta vez, sin embargo, usa variables como `title` y `genre` para esa tarea en lugar de `Request.Form["title"]`:</span><span class="sxs-lookup"><span data-stu-id="e2d22-195">This time, though, you're using variables like `title` and `genre` for that task instead of `Request.Form["title"]`:</span></span>

`<input type="text" name="title" value="@title" />`

<span data-ttu-id="e2d22-196">Como antes, este marcado se cargar previamente los valores del cuadro de texto con los valores de la película.</span><span class="sxs-lookup"><span data-stu-id="e2d22-196">As before, this markup will preload the text box values with the movie values.</span></span> <span data-ttu-id="e2d22-197">Verá en breve por qué es útil para usar variables en este momento en lugar de usar el `Request` objeto.</span><span class="sxs-lookup"><span data-stu-id="e2d22-197">You'll see in a moment why it's handy to use variables this time instead of using the `Request` object.</span></span>

<span data-ttu-id="e2d22-198">También hay un `<input type="hidden">` elemento en esta página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-198">There's also a `<input type="hidden">` element on this page.</span></span> <span data-ttu-id="e2d22-199">Este elemento almacena el identificador de película sin hacerlo visible en la página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-199">This element stores the movie ID without making it visible on the page.</span></span> <span data-ttu-id="e2d22-200">El identificador se pasa inicialmente a la página mediante utilizando un valor de cadena de consulta (`?id=7` o similar en la dirección URL).</span><span class="sxs-lookup"><span data-stu-id="e2d22-200">The ID is initially passed to the page by using a query string value (`?id=7` or similar in the URL).</span></span> <span data-ttu-id="e2d22-201">Al colocar el valor de identificador en un campo oculto, puede asegurarse de que está disponible cuando se envía, incluso si ya no tiene acceso a la dirección URL original que se ha invocado la página con el formulario.</span><span class="sxs-lookup"><span data-stu-id="e2d22-201">By putting the ID value into a hidden field, you can make sure that it's available when the form is submitted, even if you no longer have access to the original URL that the page was invoked with.</span></span>

<span data-ttu-id="e2d22-202">A diferencia de la *AddMovie* página, el código para el *EditMovie* página tiene dos funciones distintas.</span><span class="sxs-lookup"><span data-stu-id="e2d22-202">Unlike the *AddMovie* page, the code for the *EditMovie* page has two distinct functions.</span></span> <span data-ttu-id="e2d22-203">La primera función es que cuando se muestra la página por primera vez (y *sólo* , a continuación,), el código obtiene el identificador de película de la cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="e2d22-203">The first function is that when the page is displayed for the first time (and *only* then), the code gets the movie ID from the query string.</span></span> <span data-ttu-id="e2d22-204">El código, a continuación, usa el identificador para leer la película fuera de la base de datos correspondiente y mostrar (cargar previamente), en los cuadros de texto.</span><span class="sxs-lookup"><span data-stu-id="e2d22-204">The code then uses the ID to read the corresponding movie out of the database and display (preload) it in the text boxes.</span></span>

<span data-ttu-id="e2d22-205">La segunda función es que cuando el usuario hace clic en el **enviar cambios** botón, el código tiene que leer los valores de los cuadros de texto y validarlos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-205">The second function is that when the user clicks the **Submit Changes** button, the code has to read the values of the text boxes and validate them.</span></span> <span data-ttu-id="e2d22-206">El código también tiene que actualizar el elemento de la base de datos con los nuevos valores.</span><span class="sxs-lookup"><span data-stu-id="e2d22-206">The code also has to update the database item with the new values.</span></span> <span data-ttu-id="e2d22-207">Esta técnica es similar a agregar un registro, como se vio en *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="e2d22-207">This technique is similar to adding a record, as you saw in *AddMovie*.</span></span>

## <a name="adding-code-to-read-a-single-movie"></a><span data-ttu-id="e2d22-208">Agregar código para leer una película única</span><span class="sxs-lookup"><span data-stu-id="e2d22-208">Adding Code to Read a Single Movie</span></span>

<span data-ttu-id="e2d22-209">Para llevar a cabo la primera función, agregue este código a la parte superior de la página:</span><span class="sxs-lookup"><span data-stu-id="e2d22-209">To perform the first function, add this code to the top of the page:</span></span>

[!code-cshtml[Main](updating-data/samples/sample11.cshtml)]

<span data-ttu-id="e2d22-210">La mayor parte de este código es dentro de un bloque que se inicia `if(!IsPost)`.</span><span class="sxs-lookup"><span data-stu-id="e2d22-210">Most of this code is inside a block that starts `if(!IsPost)`.</span></span> <span data-ttu-id="e2d22-211">El `!` operador significa "no", por lo que significa que la expresión *si esta solicitud no es un envío de post*, que es una forma indirecta de decir *si esta solicitud es la primera vez que se ha ejecutado esta página*.</span><span class="sxs-lookup"><span data-stu-id="e2d22-211">The `!` operator means "not," so the expression means *if this request is not a post submission*, which is an indirect way of saying *if this request is the first time that this page has been run*.</span></span> <span data-ttu-id="e2d22-212">Como se indicó anteriormente, este código debe ejecutarse *sólo* la primera vez que se ejecuta la página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-212">As noted earlier, this code should run *only* the first time the page runs.</span></span> <span data-ttu-id="e2d22-213">Si no incluye el código en `if(!IsPost)`, que se ejecute cada vez que se invoca la página, si la primera vez o en respuesta a un botón, haga clic en.</span><span class="sxs-lookup"><span data-stu-id="e2d22-213">If you didn't enclose the code in `if(!IsPost)`, it would run every time the page is invoked, whether the first time or in response to a button click.</span></span>

<span data-ttu-id="e2d22-214">Tenga en cuenta que el código incluye un `else` bloquear este momento.</span><span class="sxs-lookup"><span data-stu-id="e2d22-214">Notice that the code includes an `else` block this time.</span></span> <span data-ttu-id="e2d22-215">Como hemos dicho cuando introdujimos `if` bloques, a veces desea ejecutar código alternativo si la condición de prueba no es cierto.</span><span class="sxs-lookup"><span data-stu-id="e2d22-215">As we said when we introduced `if` blocks, sometimes you want to run alternative code if the condition you're testing isn't true.</span></span> <span data-ttu-id="e2d22-216">Ese es el caso aquí.</span><span class="sxs-lookup"><span data-stu-id="e2d22-216">That's the case here.</span></span> <span data-ttu-id="e2d22-217">Si se pasa la condición (es decir, si el identificador pasado a la página es correcto), lee una fila de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-217">If the condition passes (that is, if the ID passed to the page is ok), you read a row from the database.</span></span> <span data-ttu-id="e2d22-218">Sin embargo, si no pasa la condición, el `else` bloque se ejecuta y el código establece un mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="e2d22-218">However, if the condition doesn't pass, the `else` block runs and the code sets an error message.</span></span>

## <a name="validating-a-value-passed-to-the-page"></a><span data-ttu-id="e2d22-219">Validar un valor pasado a la página</span><span class="sxs-lookup"><span data-stu-id="e2d22-219">Validating a Value Passed to the Page</span></span>

<span data-ttu-id="e2d22-220">El código usa `Request.QueryString["id"]` para obtener el identificador que se pasa a la página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-220">The code uses `Request.QueryString["id"]` to get the ID that's passed to the page.</span></span> <span data-ttu-id="e2d22-221">El código se asegura de que realmente se pasó un valor para el identificador.</span><span class="sxs-lookup"><span data-stu-id="e2d22-221">The code makes sure that a value was actually passed for the ID.</span></span> <span data-ttu-id="e2d22-222">Si se pasa ningún valor, el código establece un error de validación.</span><span class="sxs-lookup"><span data-stu-id="e2d22-222">If no value was passed, the code sets a validation error.</span></span>

<span data-ttu-id="e2d22-223">Este código muestra otra forma de validar la información.</span><span class="sxs-lookup"><span data-stu-id="e2d22-223">This code shows a different way to validate information.</span></span> <span data-ttu-id="e2d22-224">En el tutorial anterior, ha trabajado con la `Validation` auxiliar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-224">In the previous tutorial, you worked with the `Validation` helper.</span></span> <span data-ttu-id="e2d22-225">Registra los campos para validar y ASP.NET hizo la validación automáticamente y muestra los errores mediante el uso de `Html.ValidationMessage` y `Html.ValidationSummary`.</span><span class="sxs-lookup"><span data-stu-id="e2d22-225">You registered fields to validate, and ASP.NET automatically did the validation and displayed errors by using `Html.ValidationMessage` and `Html.ValidationSummary`.</span></span> <span data-ttu-id="e2d22-226">En este caso, sin embargo, realmente no está validando proporcionados por el usuario.</span><span class="sxs-lookup"><span data-stu-id="e2d22-226">In this case, however, you're not really validating user input.</span></span> <span data-ttu-id="e2d22-227">En su lugar, que se está validando un valor que se pasó a la página desde cualquier parte.</span><span class="sxs-lookup"><span data-stu-id="e2d22-227">Instead, you're validating a value that was passed to the page from elsewhere.</span></span> <span data-ttu-id="e2d22-228">El `Validation` auxiliar no hará eso por usted.</span><span class="sxs-lookup"><span data-stu-id="e2d22-228">The `Validation` helper doesn't do that for you.</span></span>

<span data-ttu-id="e2d22-229">Por lo tanto, compruebe el valor usted mismo, por probarlo con `if(!Request.QueryString["ID"].IsEmpty()`).</span><span class="sxs-lookup"><span data-stu-id="e2d22-229">Therefore, you check the value yourself, by testing it with `if(!Request.QueryString["ID"].IsEmpty()`).</span></span> <span data-ttu-id="e2d22-230">Si hay un problema, puede mostrar el error mediante `Html.ValidationSummary`, tal y como hizo con la `Validation` auxiliar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-230">If there's a problem, you can display the error by using `Html.ValidationSummary`, as you did with the `Validation` helper.</span></span> <span data-ttu-id="e2d22-231">Para ello, llame a `Validation.AddFormError` y pasarle un mensaje para mostrar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-231">To do that, you call `Validation.AddFormError` and pass it a message to display.</span></span> `Validation.AddFormError` <span data-ttu-id="e2d22-232">es un método integrado que le permite definir mensajes personalizados que se enlazan con ya está familiarizado con el sistema de validación.</span><span class="sxs-lookup"><span data-stu-id="e2d22-232">is a built-in method that lets you define custom messages that tie in with the validation system you're already familiar with.</span></span> <span data-ttu-id="e2d22-233">(Más adelante en este tutorial hablaremos acerca de cómo realizar este proceso de validación de un poco más robusto.)</span><span class="sxs-lookup"><span data-stu-id="e2d22-233">(Later in this tutorial we'll talk about how to make this validation process a little more robust.)</span></span>

<span data-ttu-id="e2d22-234">Después de asegurarse de que hay un identificador para la película, el código lee la base de datos, buscando sólo un elemento de la base de datos única.</span><span class="sxs-lookup"><span data-stu-id="e2d22-234">After making sure that there's an ID for the movie, the code reads the database, looking for only a single database item.</span></span> <span data-ttu-id="e2d22-235">(Probablemente haya observado el patrón general para las operaciones de base de datos: abra la base de datos, defina una instrucción SQL y ejecute la instrucción.) Esta vez, el código SQL `Select` instrucción incluye `WHERE ID = @0`.</span><span class="sxs-lookup"><span data-stu-id="e2d22-235">(You probably have noticed the general pattern for database operations: open the database, define a SQL statement, and run the statement.) This time, the SQL `Select` statement includes `WHERE ID = @0`.</span></span> <span data-ttu-id="e2d22-236">Dado que el identificador es único, se puede devolver un único registro.</span><span class="sxs-lookup"><span data-stu-id="e2d22-236">Because the ID is unique, only one record can be returned.</span></span>

<span data-ttu-id="e2d22-237">La consulta se realiza mediante `db.QuerySingle` (no `db.Query`, tal y como se ha usado para la lista de películas), y el código coloca el resultado en el `row` variable.</span><span class="sxs-lookup"><span data-stu-id="e2d22-237">The query is performed by using `db.QuerySingle` (not `db.Query`, as you used for the movie listing), and the code puts the result into the `row` variable.</span></span> <span data-ttu-id="e2d22-238">El nombre `row` es arbitrario; puede designar las variables que desee.</span><span class="sxs-lookup"><span data-stu-id="e2d22-238">The name `row` is arbitrary; you can name the variables anything you like.</span></span> <span data-ttu-id="e2d22-239">Las variables que se inicializan en la parte superior, a continuación, se rellenan con los detalles de la película para que estos valores se pueden mostrar en los cuadros de texto.</span><span class="sxs-lookup"><span data-stu-id="e2d22-239">The variables initialized at the top are then filled with the movie details so that these values can be displayed in the text boxes.</span></span>

## <a name="testing-the-edit-page-so-far"></a><span data-ttu-id="e2d22-240">Probar la página de edición (hasta)</span><span class="sxs-lookup"><span data-stu-id="e2d22-240">Testing the Edit Page (So Far)</span></span>

<span data-ttu-id="e2d22-241">Si desea probar la página, ejecute el *películas* página ahora y haga clic en un **editar** vínculo situado junto a cualquier película.</span><span class="sxs-lookup"><span data-stu-id="e2d22-241">If you'd like to test your page, run the *Movies* page now and click an **Edit** link next to any movie.</span></span> <span data-ttu-id="e2d22-242">Verá el *EditMovie* rellena página con los detalles para la película seleccionada:</span><span class="sxs-lookup"><span data-stu-id="e2d22-242">You'll see the *EditMovie* page with the details filled in for the movie you selected:</span></span>

![Editar página de la película que muestra la película se puedan editar](updating-data/_static/image3.png)

<span data-ttu-id="e2d22-244">Tenga en cuenta que la dirección URL de la página incluye algo parecido a `?id=10` (u otro número).</span><span class="sxs-lookup"><span data-stu-id="e2d22-244">Notice that the URL of the page includes something like `?id=10` (or some other number).</span></span> <span data-ttu-id="e2d22-245">Hasta ahora ha probado que **editar** vínculos en el *película* página de trabajo, que la página está leyendo el identificador de la cadena de consulta y que la base de datos de consulta para obtener un registro de película único funciona.</span><span class="sxs-lookup"><span data-stu-id="e2d22-245">So far you've tested that **Edit** links in the *Movie* page work, that your page is reading the ID from the query string, and that the database query to get a single movie record is working.</span></span>

<span data-ttu-id="e2d22-246">Puede cambiar la información de la película, pero no ocurre nada al hacer clic en **enviar cambios**.</span><span class="sxs-lookup"><span data-stu-id="e2d22-246">You can change the movie information, but nothing happens when you click **Submit Changes**.</span></span>

## <a name="adding-code-to-update-the-movie-with-the-users-changes"></a><span data-ttu-id="e2d22-247">Agregar código para actualizar la película con los cambios del usuario</span><span class="sxs-lookup"><span data-stu-id="e2d22-247">Adding Code to Update the Movie with the User's Changes</span></span>

<span data-ttu-id="e2d22-248">En el *EditMovie.cshtml* , para implementar la segunda función (Guardar cambios), agregue el código siguiente justo dentro de la llave de cierre de la `@` bloque.</span><span class="sxs-lookup"><span data-stu-id="e2d22-248">In the *EditMovie.cshtml* file, to implement the second function (saving changes), add the following code just inside the closing brace of the `@` block.</span></span> <span data-ttu-id="e2d22-249">(Si no está seguro de exactamente dónde debe colocar el código, puede mirar la [el código completo de la página Editar película](#Complete_Page_Listing_for_EditMovie) que aparece al final de este tutorial.)</span><span class="sxs-lookup"><span data-stu-id="e2d22-249">(If you're not sure exactly where to put the code, you can look at the [complete code listing for the Edit Movie page](#Complete_Page_Listing_for_EditMovie) that appears at the end of this tutorial.)</span></span>

[!code-csharp[Main](updating-data/samples/sample12.cs)]

<span data-ttu-id="e2d22-250">De nuevo, este marcado y el código es similar al código de *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="e2d22-250">Again, this markup and code is similar to the code in *AddMovie*.</span></span> <span data-ttu-id="e2d22-251">El código está en un `if(IsPost)` bloquear, dado que este código se ejecuta solo cuando el usuario hace clic en el **enviar cambios** botón &mdash; es decir, cuando (y sólo cuando) se ha registrado el formulario.</span><span class="sxs-lookup"><span data-stu-id="e2d22-251">The code is in an `if(IsPost)` block, because this code runs only when the user clicks the **Submit Changes** button &mdash; that is, when (and only when) the form has been posted.</span></span> <span data-ttu-id="e2d22-252">En este caso, no usa una prueba como `if(IsPost && Validation.IsValid())`, es decir, no es combinar ambas pruebas mediante el uso de and.</span><span class="sxs-lookup"><span data-stu-id="e2d22-252">In this case, you're not using a test like `if(IsPost && Validation.IsValid())`— that is, you're not combining both tests by using AND.</span></span> <span data-ttu-id="e2d22-253">En esta página, determina primero si hay un envío de formulario (`if(IsPost)`) y registrar solo los campos para la validación.</span><span class="sxs-lookup"><span data-stu-id="e2d22-253">In this page, you first determine whether there's a form submission (`if(IsPost)`), and only then register the fields for validation.</span></span> <span data-ttu-id="e2d22-254">A continuación, puede probar los resultados de validación (`if(Validation.IsValid()`).</span><span class="sxs-lookup"><span data-stu-id="e2d22-254">Then you can test the validation results (`if(Validation.IsValid()`).</span></span> <span data-ttu-id="e2d22-255">El flujo es ligeramente diferente a la de la *AddMovie.cshtml* página, pero el efecto es el mismo.</span><span class="sxs-lookup"><span data-stu-id="e2d22-255">The flow is slightly different than in the *AddMovie.cshtml* page, but the effect is the same.</span></span>

<span data-ttu-id="e2d22-256">Obtener los valores de los cuadros de texto mediante `Request.Form["title"]` y un código similar para los demás `<input>` elementos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-256">You get the values of the text boxes by using `Request.Form["title"]` and similar code for the other `<input>` elements.</span></span> <span data-ttu-id="e2d22-257">Tenga en cuenta que esta vez, el código obtiene el identificador de película fuera del campo oculto (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="e2d22-257">Notice that this time, the code gets the movie ID out of the hidden field (`<input type="hidden">`).</span></span> <span data-ttu-id="e2d22-258">Cuando la página se ha ejecutado la primera vez, el código tiene el identificador de la cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="e2d22-258">When the page ran the first time, the code got the ID out of the query string.</span></span> <span data-ttu-id="e2d22-259">Obtiene el valor del campo oculto para asegurarse de que está obteniendo el Id. de la película que aparecía originalmente, en caso de que la cadena de consulta se modifica de alguna manera desde entonces.</span><span class="sxs-lookup"><span data-stu-id="e2d22-259">You get the value from the hidden field to make sure that you're getting the ID of the movie that was originally displayed, in case the query string was somehow altered since then.</span></span>

<span data-ttu-id="e2d22-260">La diferencia entre lo realmente importante la *AddMovie* código y este código es que en este código usa la instrucción SQL `Update` instrucción en lugar de la `Insert Into` instrucción.</span><span class="sxs-lookup"><span data-stu-id="e2d22-260">The really important difference between the *AddMovie* code and this code is that in this code you use the SQL `Update` statement instead of the `Insert Into` statement.</span></span> <span data-ttu-id="e2d22-261">El ejemplo siguiente muestra la sintaxis de SQL `Update` instrucción:</span><span class="sxs-lookup"><span data-stu-id="e2d22-261">The following example shows the syntax of the SQL `Update` statement:</span></span>

`UPDATE table SET col1="value", col2="value", col3="value" ... WHERE ID = value`

<span data-ttu-id="e2d22-262">Puede especificar las columnas en cualquier orden, y no necesariamente deben actualizar todas las columnas durante un `Update` operación.</span><span class="sxs-lookup"><span data-stu-id="e2d22-262">You can specify any columns in any order, and you don't necessarily have to update every column during an `Update` operation.</span></span> <span data-ttu-id="e2d22-263">(No se puede actualizar el Id. de sí mismo, porque en vigor que desea guardar el registro como un nuevo registro, y que no se permite para un `Update` operación.)</span><span class="sxs-lookup"><span data-stu-id="e2d22-263">(You cannot update the ID itself, because that would in effect save the record as a new record, and that's not allowed for an `Update` operation.)</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="e2d22-264">**Importante** el `Where` cláusula con el Id. es muy importante, ya que es la manera en que la base de datos sabe qué base de datos de registro que desea actualizar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-264">**Important** The `Where` clause with the ID is very important, because that's how the database knows which database record you want to update.</span></span> <span data-ttu-id="e2d22-265">Si lo dejó el `Where` cláusula, la base de datos actualizaría *cada* registros en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-265">If you left off the `Where` clause, the database would update *every* record in the database.</span></span> <span data-ttu-id="e2d22-266">En la mayoría de los casos, eso sería un desastre.</span><span class="sxs-lookup"><span data-stu-id="e2d22-266">In most cases, that would be a disaster.</span></span>


<span data-ttu-id="e2d22-267">En el código, se pasan los valores para actualizar a la instrucción SQL mediante el uso de marcadores de posición.</span><span class="sxs-lookup"><span data-stu-id="e2d22-267">In the code, the values to update are passed to the SQL statement by using placeholders.</span></span> <span data-ttu-id="e2d22-268">Repita lo que hemos dicho antes: por motivos de seguridad, *sólo* usar marcadores de posición para pasar valores a una instrucción SQL.</span><span class="sxs-lookup"><span data-stu-id="e2d22-268">To repeat what we've said before: for security reasons, *only* use placeholders to pass values to a SQL statement.</span></span>

<span data-ttu-id="e2d22-269">Después de que el código usa `db.Execute` para ejecutar el `Update` instrucción, redirige a la página de lista, donde puede ver los cambios.</span><span class="sxs-lookup"><span data-stu-id="e2d22-269">After the code uses `db.Execute` to run the `Update` statement, it redirects back to the listing page, where you can see the changes.</span></span>

> [!TIP] 
> 
> **<span data-ttu-id="e2d22-270">Instrucciones de SQL diferente, distintos métodos</span><span class="sxs-lookup"><span data-stu-id="e2d22-270">Different SQL Statements, Different Methods</span></span>**
> 
> <span data-ttu-id="e2d22-271">Es posible que haya observado que utiliza métodos ligeramente diferentes para ejecutar instrucciones SQL diferentes.</span><span class="sxs-lookup"><span data-stu-id="e2d22-271">You might have noticed that you use slightly different methods to run different SQL statements.</span></span> <span data-ttu-id="e2d22-272">Para ejecutar un `Select` que potencialmente consulta devuelve varios registros, usar el `Query` método.</span><span class="sxs-lookup"><span data-stu-id="e2d22-272">To run a `Select` query that potentially returns multiple records, you use the `Query` method.</span></span> <span data-ttu-id="e2d22-273">Para ejecutar un `Select` consulta que sabe que devolverá sólo un elemento de la base de datos, utilice el `QuerySingle` método.</span><span class="sxs-lookup"><span data-stu-id="e2d22-273">To run a `Select` query that you know will return only one database item, you use the `QuerySingle` method.</span></span> <span data-ttu-id="e2d22-274">Para ejecutar comandos que realizar cambios, pero que no devuelven los elementos de la base de datos, utilice el `Execute` método.</span><span class="sxs-lookup"><span data-stu-id="e2d22-274">To run commands that make changes but that don't return database items, you use the `Execute` method.</span></span>
> 
> <span data-ttu-id="e2d22-275">Tendrá que tienen métodos diferentes debido a que cada una de ellas devuelve resultados diferentes, como ya vimos en la diferencia entre `Query` y `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="e2d22-275">You have to have different methods because each of them returns different results, as you saw already in the difference between `Query` and `QuerySingle`.</span></span> <span data-ttu-id="e2d22-276">(El `Execute` método realmente devuelve un valor también &mdash; es decir, el número de filas de la base de datos que se vieron afectados por el comando &mdash; pero se ha estado omitiendo que hasta ahora.)</span><span class="sxs-lookup"><span data-stu-id="e2d22-276">(The `Execute` method actually returns a value also &mdash; namely, the number of database rows that were affected by the command &mdash; but you've been ignoring that so far.)</span></span>
> 
> <span data-ttu-id="e2d22-277">Por supuesto, el `Query` podría devolver una única fila de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-277">Of course, the `Query` method might return only one database row.</span></span> <span data-ttu-id="e2d22-278">Sin embargo, ASP.NET siempre trata los resultados de la `Query` método como una colección.</span><span class="sxs-lookup"><span data-stu-id="e2d22-278">However, ASP.NET always treats the results of the `Query` method as a collection.</span></span> <span data-ttu-id="e2d22-279">Incluso si el método devuelve una sola fila, deberá extraer esa única fila de la colección.</span><span class="sxs-lookup"><span data-stu-id="e2d22-279">Even if the method returns just one row, you have to extract that single row from the collection.</span></span> <span data-ttu-id="e2d22-280">Por lo tanto, en situaciones donde se *saber* obtendrá una única fila, es un poco más conveniente usar `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="e2d22-280">Therefore, in situations where you *know* you'll get back only one row, it's a bit more convenient to use `QuerySingle`.</span></span>
> 
> <span data-ttu-id="e2d22-281">Hay algunos otros métodos que realizan determinados tipos de operaciones de base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-281">There are a few other methods that perform specific types of database operations.</span></span> <span data-ttu-id="e2d22-282">Puede encontrar una lista de métodos de la base de datos en el [referencia rápida de ASP.NET Web Pages API](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span><span class="sxs-lookup"><span data-stu-id="e2d22-282">You can find a listing of database methods in the [ASP.NET Web Pages API Quick Reference](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span></span>


## <a name="making-validation-for-the-id-more-robust"></a><span data-ttu-id="e2d22-283">Realizar la validación de Id. de más sólida</span><span class="sxs-lookup"><span data-stu-id="e2d22-283">Making Validation for the ID More Robust</span></span>

<span data-ttu-id="e2d22-284">La primera vez que se ejecuta la página, obtendrá el identificador de película de la cadena de consulta para que puedan ir obtener esa película de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-284">The first time that the page runs, you get the movie ID from the query string so that you can go get that movie from the database.</span></span> <span data-ttu-id="e2d22-285">Se ha asegurado de que realmente se ha producido un valor para ir a buscar, que lo hizo utilizando este código:</span><span class="sxs-lookup"><span data-stu-id="e2d22-285">You made sure that there actually was a value to go look for, which you did by using this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample13.cs)]

<span data-ttu-id="e2d22-286">Utilice este código para asegurarse de que si un usuario llega a la *EditMovies* página sin seleccionar primero una película en el *películas* página, la página mostrará un mensaje de error descriptivo.</span><span class="sxs-lookup"><span data-stu-id="e2d22-286">You used this code to make sure that if a user gets to the *EditMovies* page without first selecting a movie in the *Movies* page, the page would display a user-friendly error message.</span></span> <span data-ttu-id="e2d22-287">(En caso contrario, los usuarios vería un error que probablemente confundirían a ellos).</span><span class="sxs-lookup"><span data-stu-id="e2d22-287">(Otherwise, users would see an error that would probably just confuse them.)</span></span>

<span data-ttu-id="e2d22-288">Sin embargo, esta validación no es muy eficaz.</span><span class="sxs-lookup"><span data-stu-id="e2d22-288">However, this validation isn't very robust.</span></span> <span data-ttu-id="e2d22-289">La página también se puede invocar con estos errores:</span><span class="sxs-lookup"><span data-stu-id="e2d22-289">The page might also be invoked with these errors:</span></span>

- <span data-ttu-id="e2d22-290">El identificador no es un número.</span><span class="sxs-lookup"><span data-stu-id="e2d22-290">The ID isn't a number.</span></span> <span data-ttu-id="e2d22-291">Por ejemplo, se pudo invocar la página con una dirección URL como `http://localhost:nnnnn/EditMovie?id=abc`.</span><span class="sxs-lookup"><span data-stu-id="e2d22-291">For example, the page could be invoked with a URL like `http://localhost:nnnnn/EditMovie?id=abc`.</span></span>
- <span data-ttu-id="e2d22-292">El identificador es un número, pero hace referencia a una película que no existe (por ejemplo, `http://localhost:nnnnn/EditMovie?id=100934`).</span><span class="sxs-lookup"><span data-stu-id="e2d22-292">The ID is a number, but it references a movie that doesn't exist (for example, `http://localhost:nnnnn/EditMovie?id=100934`).</span></span>

<span data-ttu-id="e2d22-293">Si siente curiosidad por ver los errores resultantes de estas direcciones URL, ejecute el *películas* página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-293">If you're curious to see the errors that result from these URLs, run the *Movies* page.</span></span> <span data-ttu-id="e2d22-294">Seleccione una película para editar y, a continuación, cambie la dirección URL de la *EditMovie* página a una dirección URL que contiene un es un carácter alfabético, identificador o el identificador de una película inexistentes.</span><span class="sxs-lookup"><span data-stu-id="e2d22-294">Select a movie to edit, and then change the URL of the *EditMovie* page to a URL that contains an alphabetic ID or the ID of a non-existent movie.</span></span>

<span data-ttu-id="e2d22-295">¿Qué debe hacer?</span><span class="sxs-lookup"><span data-stu-id="e2d22-295">So what should you do?</span></span> <span data-ttu-id="e2d22-296">La primera corrección es asegurarse de que no sólo es un identificador pasa a la página, pero que el identificador es un entero.</span><span class="sxs-lookup"><span data-stu-id="e2d22-296">The first fix is to make sure that not only is an ID passed to the page, but that the ID is an integer.</span></span> <span data-ttu-id="e2d22-297">Cambiar el código para el `!IsPost` prueba sea similar a este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e2d22-297">Change the code for the `!IsPost` test to look like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample14.cs)]

<span data-ttu-id="e2d22-298">Ha agregado una segunda condición para la `IsEmpty` prueba, vinculado con `&&` (AND lógico):</span><span class="sxs-lookup"><span data-stu-id="e2d22-298">You've added a second condition to the `IsEmpty` test, linked with `&&` (logical AND):</span></span>

[!code-csharp[Main](updating-data/samples/sample15.cs)]

<span data-ttu-id="e2d22-299">Es posible que recuerde de la [Introducción a la programación de ASP.NET Web Pages](../introducing-razor-syntax-c.md) tutorial que métodos como `AsBool` un `AsInt` convertir una cadena de caracteres en algún otro tipo de datos.</span><span class="sxs-lookup"><span data-stu-id="e2d22-299">You might remember from the [Introduction to ASP.NET Web Pages Programming](../introducing-razor-syntax-c.md) tutorial that methods like `AsBool` an `AsInt` convert a character string to some other data type.</span></span> <span data-ttu-id="e2d22-300">El `IsInt` método (y otros, como `IsBool` y `IsDateTime`) son similares.</span><span class="sxs-lookup"><span data-stu-id="e2d22-300">The `IsInt` method (and others, like `IsBool` and `IsDateTime`) are similar.</span></span> <span data-ttu-id="e2d22-301">Sin embargo, probar solo si se *puede* convertir la cadena, sin tener que realizar la conversión.</span><span class="sxs-lookup"><span data-stu-id="e2d22-301">However, they test only whether you *can* convert the string, without actually performing the conversion.</span></span> <span data-ttu-id="e2d22-302">Así que aquí esencialmente se está diciendo *si el valor de cadena de consulta se puede convertir en un entero de...* .</span><span class="sxs-lookup"><span data-stu-id="e2d22-302">So here you're essentially saying *If the query string value can be converted to an integer ...*.</span></span>

<span data-ttu-id="e2d22-303">El posible problema está buscando una película que no existe.</span><span class="sxs-lookup"><span data-stu-id="e2d22-303">The other potential problem is looking for a movie that doesn't exist.</span></span> <span data-ttu-id="e2d22-304">El código para obtener una película es similar a este código:</span><span class="sxs-lookup"><span data-stu-id="e2d22-304">The code to get a movie looks like this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample16.cs)]

<span data-ttu-id="e2d22-305">Si se pasa un `movieId` valor para el `QuerySingle` método que no se corresponde con una película real, se devuelve nada, y las instrucciones que siguen (por ejemplo, `title=row.Title`) producirán errores.</span><span class="sxs-lookup"><span data-stu-id="e2d22-305">If you pass a `movieId` value to the `QuerySingle` method that doesn't correspond to an actual movie, nothing is returned and the statements that follow (for example, `title=row.Title`) result in errors.</span></span>

<span data-ttu-id="e2d22-306">Nuevo hay una solución fácil.</span><span class="sxs-lookup"><span data-stu-id="e2d22-306">Again there's an easy fix.</span></span> <span data-ttu-id="e2d22-307">Si el `db.QuerySingle` método no devuelve ningún resultado, el `row` variable será null.</span><span class="sxs-lookup"><span data-stu-id="e2d22-307">If the `db.QuerySingle` method returns no results, the `row` variable will be null.</span></span> <span data-ttu-id="e2d22-308">Por lo que puede comprobar si el `row` variable es null antes de intentar obtener valores a partir de él.</span><span class="sxs-lookup"><span data-stu-id="e2d22-308">So you can check whether the `row` variable is null before you try to get values from it.</span></span> <span data-ttu-id="e2d22-309">El código siguiente agrega un `if` bloque alrededor de las instrucciones que obtienen los valores de la `row` objeto:</span><span class="sxs-lookup"><span data-stu-id="e2d22-309">The following code adds an `if` block around the statements that get the values out of the `row` object:</span></span>

[!code-csharp[Main](updating-data/samples/sample17.cs)]

<span data-ttu-id="e2d22-310">Con estas dos pruebas de validación adicional, la página se vuelve más infalible.</span><span class="sxs-lookup"><span data-stu-id="e2d22-310">With these two additional validation tests, the page becomes more bullet-proof.</span></span> <span data-ttu-id="e2d22-311">El código completo para el `!IsPost` rama ahora es similar a este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e2d22-311">The complete code for the `!IsPost` branch now looks like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample18.cs)]

<span data-ttu-id="e2d22-312">Se le tenga en cuenta una vez más que esta tarea es un buen uso de un `else` bloque.</span><span class="sxs-lookup"><span data-stu-id="e2d22-312">We'll note once more that this task is a good use for an `else` block.</span></span> <span data-ttu-id="e2d22-313">Si no pasan las pruebas, el `else` conjunto de bloques de mensajes de error.</span><span class="sxs-lookup"><span data-stu-id="e2d22-313">If the tests don't pass, the `else` blocks set error messages.</span></span>

## <a name="adding-a-link-to-return-to-the-movies-page"></a><span data-ttu-id="e2d22-314">Agregar un vínculo para volver a la página de películas</span><span class="sxs-lookup"><span data-stu-id="e2d22-314">Adding a Link to Return to the Movies Page</span></span>

<span data-ttu-id="e2d22-315">Es un detalle final y útil agregar un vínculo a la *películas* página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-315">A final and helpful detail is to add a link back to the *Movies* page.</span></span> <span data-ttu-id="e2d22-316">En el flujo normal de eventos, los usuarios se iniciarán en el *películas* página y haga clic en un **editar** vínculo.</span><span class="sxs-lookup"><span data-stu-id="e2d22-316">In the ordinary flow of events, users will start at the *Movies* page and click an **Edit** link.</span></span> <span data-ttu-id="e2d22-317">Esto les lleva a la *EditMovie* página, donde puede editar la película y haga clic en el botón.</span><span class="sxs-lookup"><span data-stu-id="e2d22-317">That brings them to the *EditMovie* page, where they can edit the movie and click the button.</span></span> <span data-ttu-id="e2d22-318">Una vez que el código procesa el cambio, redirige a la *películas* página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-318">After the code processes the change, it redirects back to the *Movies* page.</span></span>

<span data-ttu-id="e2d22-319">Pero:</span><span class="sxs-lookup"><span data-stu-id="e2d22-319">However:</span></span>

- <span data-ttu-id="e2d22-320">El usuario puede decidir no cambia nada.</span><span class="sxs-lookup"><span data-stu-id="e2d22-320">The user might decide not to change anything.</span></span>
- <span data-ttu-id="e2d22-321">El usuario puede aparecer en esta página sin hacer clic en un **editar** vincular en el *películas* página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-321">The user might have gotten to this page without first clicking an **Edit** link in the *Movies* page.</span></span>

<span data-ttu-id="e2d22-322">En cualquier caso, desea que sea fácil para que puedan volver a la lista principal.</span><span class="sxs-lookup"><span data-stu-id="e2d22-322">Either way, you want to make it easy for them to return to the main listing.</span></span> <span data-ttu-id="e2d22-323">Es una solución fácil &mdash; agregue el marcado siguiente justo después del cierre `</form>` etiqueta en el marcado:</span><span class="sxs-lookup"><span data-stu-id="e2d22-323">It's an easy fix &mdash; add the following markup just after the closing `</form>` tag in the markup:</span></span>

[!code-html[Main](updating-data/samples/sample19.html)]

<span data-ttu-id="e2d22-324">Este marcado utiliza la misma sintaxis para un `<a>` elemento que ha visto en otro lugar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-324">This markup uses the same syntax for an `<a>` element that you've seen elsewhere.</span></span> <span data-ttu-id="e2d22-325">La dirección URL incluye `~` significa "" raíz"del sitio Web.</span><span class="sxs-lookup"><span data-stu-id="e2d22-325">The URL includes `~` to mean "root of the website."</span></span>

## <a name="testing-the-movie-update-process"></a><span data-ttu-id="e2d22-326">Probar el proceso de actualización de la película</span><span class="sxs-lookup"><span data-stu-id="e2d22-326">Testing the Movie Update Process</span></span>

<span data-ttu-id="e2d22-327">Ahora puede probar.</span><span class="sxs-lookup"><span data-stu-id="e2d22-327">Now you can test.</span></span> <span data-ttu-id="e2d22-328">Ejecute el *películas* página y haga clic en **editar** junto a una película.</span><span class="sxs-lookup"><span data-stu-id="e2d22-328">Run the *Movies* page, and click **Edit** next to a movie.</span></span> <span data-ttu-id="e2d22-329">Cuando el *EditMovie* aparece en la página, realizar cambios en la película y haga clic en **enviar cambios**.</span><span class="sxs-lookup"><span data-stu-id="e2d22-329">When the *EditMovie* page appears, make changes to the movie and click **Submit Changes**.</span></span> <span data-ttu-id="e2d22-330">Cuando aparezca la lista de películas, asegúrese de que se muestran los cambios.</span><span class="sxs-lookup"><span data-stu-id="e2d22-330">When the movie listing appears, make sure that your changes are shown.</span></span>

<span data-ttu-id="e2d22-331">Para asegurarse de que la validación funciona, haga clic en **editar** otra película.</span><span class="sxs-lookup"><span data-stu-id="e2d22-331">To make sure that validation is working, click **Edit** for another movie.</span></span> <span data-ttu-id="e2d22-332">Cuando llegue a la *EditMovie* página, desactive la **género** campo (o **año** campo, o ambos) y vuelva a enviar los cambios.</span><span class="sxs-lookup"><span data-stu-id="e2d22-332">When you get to the *EditMovie* page, clear the **Genre** field (or **Year** field, or both) and try to submit your changes.</span></span> <span data-ttu-id="e2d22-333">Verá un error, como cabría esperar:</span><span class="sxs-lookup"><span data-stu-id="e2d22-333">You'll see an error, as you'd expect:</span></span>

![Editar página de la película que muestra los errores de validación](updating-data/_static/image4.png)

<span data-ttu-id="e2d22-335">Haga clic en el **volver a la lista de películas** vínculo para abandonar los cambios y volver a la *películas* página.</span><span class="sxs-lookup"><span data-stu-id="e2d22-335">Click the **Return to movie listing** link to abandon your changes and return to the *Movies* page.</span></span>

## <a name="coming-up-next"></a><span data-ttu-id="e2d22-336">Próxima</span><span class="sxs-lookup"><span data-stu-id="e2d22-336">Coming Up Next</span></span>

<span data-ttu-id="e2d22-337">En el siguiente tutorial, verá cómo eliminar un registro de la película.</span><span class="sxs-lookup"><span data-stu-id="e2d22-337">In the next tutorial, you'll see how to delete a movie record.</span></span>

## <a name="complete-listing-for-movie-page-updated-with-edit-links"></a><span data-ttu-id="e2d22-338">Lista completa de la página de película (actualizada con vínculos de edición)</span><span class="sxs-lookup"><span data-stu-id="e2d22-338">Complete Listing for Movie Page (Updated with Edit Links)</span></span>

[!code-cshtml[Main](updating-data/samples/sample20.cshtml)]

<a id="Complete_Page_Listing_for_EditMovie"></a>
## <a name="complete-page-listing-for-edit-movie-page"></a><span data-ttu-id="e2d22-339">Lista de página para editar página de la película completa</span><span class="sxs-lookup"><span data-stu-id="e2d22-339">Complete Page Listing for Edit Movie Page</span></span>

[!code-cshtml[Main](updating-data/samples/sample21.cshtml)]

## <a name="additional-resources"></a><span data-ttu-id="e2d22-340">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="e2d22-340">Additional Resources</span></span>

- [<span data-ttu-id="e2d22-341">Introducción a la programación Web de ASP.NET mediante la sintaxis de Razor</span><span class="sxs-lookup"><span data-stu-id="e2d22-341">Introduction to ASP.NET Web Programming by Using the Razor Syntax</span></span>](../../getting-started/introducing-razor-syntax-c.md)
- <span data-ttu-id="e2d22-342">[Instrucción UPDATE de SQL](http://www.w3schools.com/sql/sql_update.asp) en el sitio W3Schools</span><span class="sxs-lookup"><span data-stu-id="e2d22-342">[SQL UPDATE Statement](http://www.w3schools.com/sql/sql_update.asp) on the W3Schools site</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e2d22-343">[Anterior](entering-data.md)
> [Siguiente](deleting-data.md)</span><span class="sxs-lookup"><span data-stu-id="e2d22-343">[Previous](entering-data.md)
[Next](deleting-data.md)</span></span>
