---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: Desarrollo de aplicaciones ASP.NET con Azure Active Directory | Microsoft Docs
author: Rick-Anderson
description: Herramientas de Microsoft ASP.NET para Azure Active Directory simplifica habilitar la autenticación para aplicaciones web hospedadas en Azure. Puede usar Azure Authenti...
ms.author: riande
ms.date: 08/14/2014
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 7f0e569458c9a294cc281b86e731c2fda48768be
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/01/2019
ms.locfileid: "57027852"
---
<a name="developing-aspnet-apps-with-azure-active-directory"></a><span data-ttu-id="2d505-104">Desarrollo de aplicaciones ASP.NET con Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="2d505-104">Developing ASP.NET Apps with Azure Active Directory</span></span>
====================
<span data-ttu-id="2d505-105">by [Rick Anderson]((https://twitter.com/RickAndMSFT))</span><span class="sxs-lookup"><span data-stu-id="2d505-105">by [Rick Anderson]((https://twitter.com/RickAndMSFT))</span></span>

<span data-ttu-id="2d505-106">Herramientas de Microsoft ASP.NET para Azure Active Directory simplifica al habilitar la autenticación para aplicaciones web hospedadas en [Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="2d505-106">Microsoft ASP.NET tools for Azure Active Directory simplifies enabling authentication for web apps hosted on [Azure](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="2d505-107">Puede usar la autenticación de Azure para autenticar a los usuarios de Office 365 de su organización, las cuentas corporativas sincronizadas desde Active Directory local o los usuarios creados en su propio dominio personalizado de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="2d505-107">You can use Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Azure Active Directory domain.</span></span> <span data-ttu-id="2d505-108">Habilitar la autenticación de Windows Azure configura la aplicación para autenticar usuarios mediante una sola [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) inquilino.</span><span class="sxs-lookup"><span data-stu-id="2d505-108">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>

<span data-ttu-id="2d505-109">Este tutorial le mostrará cómo crear una aplicación ASP.NET que está configurada para inicio de sesión con [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="2d505-109">This tutorial will show you how to create an ASP.NET application that is configured for sign-on with [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span></span> <span data-ttu-id="2d505-110">También obtendrá información sobre cómo llamar a Graph API para obtener información sobre el usuario ha iniciado sesión actualmente y cómo implementar la aplicación en Azure.</span><span class="sxs-lookup"><span data-stu-id="2d505-110">You will also learn how to call the Graph API to get information about the currently signed-in user and how to deploy the application to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="2d505-111">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="2d505-111">Prerequisites</span></span>

1. <span data-ttu-id="2d505-112">[Visual Studio Express 2013 para Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) o [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span><span class="sxs-lookup"><span data-stu-id="2d505-112">[Visual Studio Express 2013 for Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) or [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span></span>
2. <span data-ttu-id="2d505-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) -se requiere actualización 3 o posterior.</span><span class="sxs-lookup"><span data-stu-id="2d505-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) - Update 3 or higher is required.</span></span>
3. <span data-ttu-id="2d505-114">Una cuenta de Azure.</span><span class="sxs-lookup"><span data-stu-id="2d505-114">An Azure account.</span></span> <span data-ttu-id="2d505-115">[Haga clic aquí](https://azure.microsoft.com/pricing/free-trial/) para una evaluación gratuita si ya no tiene una cuenta.</span><span class="sxs-lookup"><span data-stu-id="2d505-115">[Click here](https://azure.microsoft.com/pricing/free-trial/) for a free trial if you do not already have an account.</span></span>

## <a name="add-a-global-administrator-to-your-active-directory"></a><span data-ttu-id="2d505-116">Agregar un administrador Global en Active Directory</span><span class="sxs-lookup"><span data-stu-id="2d505-116">Add a Global Administrator to your Active Directory</span></span>

1. <span data-ttu-id="2d505-117">Inicie sesión en el [Portal de administración de Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="2d505-117">Sign in to the [Azure Management Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="2d505-118">Todas las cuentas de Azure contienen un **directorio predeterminado** : haga clic en él, a continuación, haga clic en el **usuarios** ficha en la parte superior de la página (consulte la imagen siguiente).</span><span class="sxs-lookup"><span data-stu-id="2d505-118">All Azure accounts contain a **Default Directory** -- click on it, then click the **Users** tab at the top of the page (see image below).</span></span>
3. <span data-ttu-id="2d505-119">Haga clic en Agregar usuario.</span><span class="sxs-lookup"><span data-stu-id="2d505-119">Click Add User.</span></span>
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. <span data-ttu-id="2d505-120">Crear un nuevo usuario con el **administrador Global** rol.</span><span class="sxs-lookup"><span data-stu-id="2d505-120">Create a new user with the **Global Administrator** role.</span></span> <span data-ttu-id="2d505-121">Haga clic en **usuarios** en el menú superior y, a continuación, haga clic en el **Agregar usuario** botón en la barra de comandos.</span><span class="sxs-lookup"><span data-stu-id="2d505-121">Click **Users** from the top menu, and then click the **Add User** button on the command bar.</span></span>
5. <span data-ttu-id="2d505-122">En el **Agregar usuario** cuadro de diálogo, escriba un nombre para el nuevo usuario y, a continuación, haga clic en la flecha derecha.</span><span class="sxs-lookup"><span data-stu-id="2d505-122">In the **Add User** dialog, enter a name for the new user and then click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. <span data-ttu-id="2d505-123">Escriba el nombre de usuario y establezca el rol en **administrador Global**.</span><span class="sxs-lookup"><span data-stu-id="2d505-123">Enter the user name and set the role to **Global Administrator**.</span></span> <span data-ttu-id="2d505-124">Los administradores globales requieren una dirección de correo electrónico alternativa para fines de recuperación de contraseña.</span><span class="sxs-lookup"><span data-stu-id="2d505-124">Global administrators require an alternate email address for password recovery purposes.</span></span> <span data-ttu-id="2d505-125">Cuando haya terminado, haga clic en la flecha derecha.</span><span class="sxs-lookup"><span data-stu-id="2d505-125">After you're finished, click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. <span data-ttu-id="2d505-126">En la siguiente página del cuadro de diálogo, haga clic en **crear**.</span><span class="sxs-lookup"><span data-stu-id="2d505-126">On the next page of the dialog, click **Create**.</span></span> <span data-ttu-id="2d505-127">Se creó para el nuevo usuario una contraseña temporal y se mostrará en el cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="2d505-127">A temporary password will be created for the new user and displayed in the dialog.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)

   <span data-ttu-id="2d505-128">Guardar la contraseña, se le pedirá que cambie la contraseña tras el primer registro en.</span><span class="sxs-lookup"><span data-stu-id="2d505-128">Save the password, you will be required to change the password after the first log in.</span></span> <span data-ttu-id="2d505-129">La siguiente imagen muestra la nueva cuenta de administrador.</span><span class="sxs-lookup"><span data-stu-id="2d505-129">The following image shows the new admin account.</span></span> <span data-ttu-id="2d505-130">Debe usar Azure Active Directory para iniciar sesión en su aplicación, no la cuenta de Microsoft también se muestran en esta página.</span><span class="sxs-lookup"><span data-stu-id="2d505-130">You must use the Azure Active Directory to log into your app, not the Microsoft account also shown on this page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a><span data-ttu-id="2d505-131">Crear una aplicación ASP.NET</span><span class="sxs-lookup"><span data-stu-id="2d505-131">Create an ASP.NET Application</span></span>

<span data-ttu-id="2d505-132">Los pasos siguientes usan [Visual Studio Express 2013 para Web](https://www.microsoft.com/download/details.aspx?id=40747)y requiere [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span><span class="sxs-lookup"><span data-stu-id="2d505-132">The following steps use [Visual Studio Express 2013 for Web](https://www.microsoft.com/download/details.aspx?id=40747), and requires [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span></span>

1. <span data-ttu-id="2d505-133">En Visual Studio, haga clic en **archivo** y, a continuación, **nuevo proyecto**.</span><span class="sxs-lookup"><span data-stu-id="2d505-133">In Visual Studio, click **File** and then **New Project**.</span></span> <span data-ttu-id="2d505-134">En el **nuevo proyecto** cuadro de diálogo, seleccione la Web de Visual C# del proyecto en el menú izquierdo y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="2d505-134">On the **New Project** dialog, select the Visual C# Web project from the left menu and click **OK**.</span></span> <span data-ttu-id="2d505-135">También puede desactivar la **agregar Application Insights al proyecto** si no desea la funcionalidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2d505-135">You may also want to uncheck the **Add Application Insights to Project** if you don't want the functionality for your application.</span></span>
2. <span data-ttu-id="2d505-136">En el **nuevo proyecto ASP.NET** cuadro de diálogo, seleccione **MVC**y, a continuación, haga clic en **Cambiar autenticación**.</span><span class="sxs-lookup"><span data-stu-id="2d505-136">In the **New ASP.NET Project** dialog, select **MVC**, and then click **Change Authentication**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. <span data-ttu-id="2d505-137">En el **Cambiar autenticación** cuadro de diálogo, seleccione **cuentas organizativas**.</span><span class="sxs-lookup"><span data-stu-id="2d505-137">On the **Change Authentication** dialog, select **Organizational Accounts**.</span></span> <span data-ttu-id="2d505-138">Estas opciones pueden utilizarse para registrar automáticamente la aplicación con Azure AD, además de configurar automáticamente su aplicación para la integración con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2d505-138">These options can be used to automatically register your application with Azure AD as well as automatically configure your application to integrate with Azure AD.</span></span> <span data-ttu-id="2d505-139">No tiene que usar el **Cambiar autenticación** cuadro de diálogo para registrar y configurar la aplicación, pero facilita en gran medida.</span><span class="sxs-lookup"><span data-stu-id="2d505-139">You don't have to use the **Change Authentication** dialog to register and configure your application, but it makes it much easier.</span></span> <span data-ttu-id="2d505-140">Si utiliza Visual Studio 2012 por ejemplo, puede registrar la aplicación en el Portal de administración de Azure manualmente y actualizar su configuración para integrar con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2d505-140">If you are using Visual Studio 2012 for example, you can still manually register the application in the Azure Management Portal and update its configuration to integrate with Azure AD.</span></span>
   <span data-ttu-id="2d505-141">En los menús de lista desplegable, seleccione **nube: organización única** y **inicio de sesión único, leer datos de directorio**.</span><span class="sxs-lookup"><span data-stu-id="2d505-141">In the drop-down menus, select **Cloud - Single Organization** and **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="2d505-142">Escriba el dominio de su directorio de Azure AD, por ejemplo (en las imágenes siguientes) *aricka0yahoo.onmicrosoft.com*y, a continuación, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="2d505-142">Enter the domain for your Azure AD directory, for example (in the images below) *aricka0yahoo.onmicrosoft.com*, and then click **OK**.</span></span> <span data-ttu-id="2d505-143">Puede obtener el nombre de dominio desde la ficha dominios para el directorio predeterminado en el portal de azure (consulte la siguiente imagen abajo).</span><span class="sxs-lookup"><span data-stu-id="2d505-143">You can get the domain name from the Domains tab for the Default Directory on the azure portal (see the next image down).</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)

   <span data-ttu-id="2d505-144">La siguiente imagen muestra el nombre de dominio desde el portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="2d505-144">The following image shows the domain name from the Azure portal.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)

    > [!NOTE]
    > <span data-ttu-id="2d505-145">Opcionalmente, puede configurar el URI de Id. de aplicación que se registrará en Azure AD, haga clic en **más opciones**.</span><span class="sxs-lookup"><span data-stu-id="2d505-145">You can optionally configure the Application ID URI that will be registered in Azure AD by clicking **More Options**.</span></span> <span data-ttu-id="2d505-146">El URI de Id. de aplicación es el identificador único para una aplicación, que se registra en Azure AD y utilizado por la aplicación para identificarse al comunicarse con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2d505-146">The App ID URI is the unique identifier for an application, which is registered in Azure AD and used by the application to identify itself when communicating with Azure AD.</span></span> <span data-ttu-id="2d505-147">Para obtener más información sobre el URI de Id. de aplicación y otras propiedades de las aplicaciones registradas, consulte [en este tema](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span><span class="sxs-lookup"><span data-stu-id="2d505-147">For more information about the App ID URI and other properties of registered applications, see [this topic](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span></span> <span data-ttu-id="2d505-148">Al hacer clic en la casilla de verificación debajo del campo de URI de Id. de aplicación, también puede sobrescribir un registro existente en Azure AD que usa el mismo URI de Id. de aplicación.</span><span class="sxs-lookup"><span data-stu-id="2d505-148">By clicking the checkbox below the App ID URI field, you can also choose to overwrite an existing registration in Azure AD that uses the same App ID URI.</span></span>
4. <span data-ttu-id="2d505-149">Después de hacer clic **Aceptar**, aparecerá un cuadro de diálogo Inicio de sesión y deberá iniciar sesión con una cuenta de administrador Global (no la cuenta Microsoft asociada con su suscripción).</span><span class="sxs-lookup"><span data-stu-id="2d505-149">After clicking **OK**, a sign-in dialog will appear, and you'll need to sign in using a Global Administrator account (not the Microsoft account associated with your subscription).</span></span> <span data-ttu-id="2d505-150">Si anteriormente creó una nueva cuenta de administrador, le pedirá que cambie la contraseña y, a continuación, iníciela con la nueva contraseña.</span><span class="sxs-lookup"><span data-stu-id="2d505-150">If you created a new Administrator account earlier, you'll be required to change the password and then sign in again using the new password.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. <span data-ttu-id="2d505-151">Una vez se haya autenticado correctamente, el **nuevo proyecto ASP.NET** cuadro de diálogo mostrará la opción de autenticación (**organizativo** ) y el directorio donde será la nueva aplicación registrada (*aricka0yahoo.onmicrosoft.com* en la imagen siguiente).</span><span class="sxs-lookup"><span data-stu-id="2d505-151">After you've successfully authenticated, the **New ASP.NET Project** dialog will show your authentication choice (**Organizational** ) and the directory where the new application will be registered (*aricka0yahoo.onmicrosoft.com* in the image below).</span></span> <span data-ttu-id="2d505-152">Debajo de esta información, seleccione la casilla **Host en la nube**.</span><span class="sxs-lookup"><span data-stu-id="2d505-152">Below this information, select the checkbox labeled **Host in the cloud**.</span></span> <span data-ttu-id="2d505-153">Si se activa esta casilla, el proyecto se aprovisionará como una aplicación web de Azure y se habilitarán para la publicación fácil más adelante.</span><span class="sxs-lookup"><span data-stu-id="2d505-153">If this checkbox is selected, the project will be provisioned as an Azure web app and will be enabled for easy publishing later.</span></span> <span data-ttu-id="2d505-154">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="2d505-154">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. <span data-ttu-id="2d505-155">El **configurar el sitio Web Azure** aparecerá cuadro de diálogo con un nombre de sitio generado automáticamente y región.</span><span class="sxs-lookup"><span data-stu-id="2d505-155">The **Configure Azure Website** dialog will appear, using an auto-generated site name and region.</span></span> <span data-ttu-id="2d505-156">Tenga en cuenta también la cuenta que ha iniciado sesión actualmente en el cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="2d505-156">Also note the account you're currently signed into in the dialog.</span></span> <span data-ttu-id="2d505-157">Desea asegurarse de que esta cuenta es aquella que está conectada su suscripción de Azure, normalmente una cuenta de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2d505-157">You want to make sure that this account is the one that your Azure subscription is attached to, typically a Microsoft account.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2d505-158">Este proyecto requiere una base de datos.</span><span class="sxs-lookup"><span data-stu-id="2d505-158">This project requires a database.</span></span> <span data-ttu-id="2d505-159">Deberá seleccionar una de las bases de datos existentes o crear uno nuevo.</span><span class="sxs-lookup"><span data-stu-id="2d505-159">You need to select one of your existing databases, or create a new one.</span></span> <span data-ttu-id="2d505-160">Una base de datos es necesario porque el proyecto ya usa un archivo de base de datos local para almacenar una pequeña cantidad de datos de configuración de autenticación.</span><span class="sxs-lookup"><span data-stu-id="2d505-160">A database is required because the project already uses a local database file to store a small amount of authentication configuration data.</span></span> <span data-ttu-id="2d505-161">Al implementar la aplicación en un sitio Web de Azure, esta base de datos no se empaqueta con la implementación, por lo que deberá elegir una que sea accesible en la nube.</span><span class="sxs-lookup"><span data-stu-id="2d505-161">When you deploy the application to an Azure Website, this database isn't packaged with the deployment, so you need to choose one that's accessible in the cloud.</span></span> <span data-ttu-id="2d505-162">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="2d505-162">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. <span data-ttu-id="2d505-163">Se creará el proyecto y las opciones de autenticación y las opciones de aplicación web se configurarán automáticamente con el proyecto.</span><span class="sxs-lookup"><span data-stu-id="2d505-163">The project will be created, and your authentication options and web app options will be automatically configured with the project.</span></span> <span data-ttu-id="2d505-164">Una vez que haya completado este proceso, ejecute el proyecto localmente presionando **^ F5**.</span><span class="sxs-lookup"><span data-stu-id="2d505-164">Once this process has completed, run the project locally by pressing **^F5**.</span></span> <span data-ttu-id="2d505-165">Se le pedirá que inicie sesión con su cuenta profesional.</span><span class="sxs-lookup"><span data-stu-id="2d505-165">You will be required to sign in using your organizational account.</span></span> <span data-ttu-id="2d505-166">Proporcione el nombre de usuario y la contraseña de la cuenta que creó anteriormente y haga clic en **inicie sesión en**.</span><span class="sxs-lookup"><span data-stu-id="2d505-166">Provide the username and password for the account you created earlier and click **Sign in**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. <span data-ttu-id="2d505-167">Después de iniciar sesión correctamente, mostrará el sitio de ASP.NET que se ha autenticado al mostrar el nombre de usuario en la esquina superior derecha de la página.</span><span class="sxs-lookup"><span data-stu-id="2d505-167">After successful sign in, the ASP.NET site will show that you've authenticated by displaying the username in the top right corner of the page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)

   <span data-ttu-id="2d505-168">Si se produce un error: Valor no puede ser nulo ni estar vacío.</span><span class="sxs-lookup"><span data-stu-id="2d505-168">If you get the error: Value cannot be null or empty.</span></span> <span data-ttu-id="2d505-169">Nombre de parámetro: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="2d505-169">Parameter name: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span></span>

   <span data-ttu-id="2d505-170">Consulte la [depurar](#dbg) sección al final del tutorial.</span><span class="sxs-lookup"><span data-stu-id="2d505-170">see the [debug](#dbg) section at the end of the tutorial.</span></span>

## <a name="basics-of-the-graph-api"></a><span data-ttu-id="2d505-171">Aspectos básicos de la API Graph</span><span class="sxs-lookup"><span data-stu-id="2d505-171">Basics of the Graph API</span></span>

<span data-ttu-id="2d505-172">[La API Graph](https://msdn.microsoft.com/library/azure/hh974476.aspx) es la interfaz de programación utilizada para realizar CRUD y otras operaciones en objetos de directorio de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2d505-172">[The Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) is the programmatic interface used to perform CRUD and other operations on objects in your Azure AD directory.</span></span> <span data-ttu-id="2d505-173">Si selecciona una opción de cuenta de organización para la autenticación al crear un nuevo proyecto en Visual Studio 2013, la aplicación ya se configurarán para llamar a Graph API.</span><span class="sxs-lookup"><span data-stu-id="2d505-173">If you select an Organizational Account option for authentication when creating a new project in Visual Studio 2013, your application will already be configured to call the Graph API.</span></span> <span data-ttu-id="2d505-174">Brevemente, esta sección muestra cómo funciona la API Graph.</span><span class="sxs-lookup"><span data-stu-id="2d505-174">This section briefly shows you how the Graph API works.</span></span>

1. <span data-ttu-id="2d505-175">En la aplicación en ejecución, haga clic en el nombre del usuario con sesión iniciada en la parte superior derecha de la página.</span><span class="sxs-lookup"><span data-stu-id="2d505-175">In your running application, click on the name of the signed-in user at the top right of the page.</span></span> <span data-ttu-id="2d505-176">Esto le llevará a la página de perfil de usuario, que es una acción en el controlador Home.</span><span class="sxs-lookup"><span data-stu-id="2d505-176">This will take you to the User Profile page, which is an action on the Home Controller.</span></span> <span data-ttu-id="2d505-177">Observará que la tabla contiene información de usuario acerca de la cuenta de administrador que creó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="2d505-177">You'll notice that the table contains user information about the administrator account you created earlier.</span></span> <span data-ttu-id="2d505-178">Esta información se almacena en el directorio y se llama a la API Graph para recuperar esta información cuando se carga la página.</span><span class="sxs-lookup"><span data-stu-id="2d505-178">This information is stored in your directory, and the Graph API is called to retrieve this information when the page loads.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. <span data-ttu-id="2d505-179">Vuelva a Visual Studio y expanda el **controladores** carpeta y, a continuación, abra el **HomeController.cs** archivo.</span><span class="sxs-lookup"><span data-stu-id="2d505-179">Go back to Visual Studio and expand the **Controllers** folder and then open the **HomeController.cs** file.</span></span> <span data-ttu-id="2d505-180">Verá un **UserProfile()** acción que contiene código para recuperar un token y, a continuación, llamar a Graph API.</span><span class="sxs-lookup"><span data-stu-id="2d505-180">You'll see a **UserProfile()** action that contains code to retrieve a token and then call the Graph API.</span></span> <span data-ttu-id="2d505-181">Este código se duplica a continuación:</span><span class="sxs-lookup"><span data-stu-id="2d505-181">This code is duplicated below:</span></span>

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    <span data-ttu-id="2d505-182">Para llamar a Graph API, primero deberá recuperar un token.</span><span class="sxs-lookup"><span data-stu-id="2d505-182">To call the Graph API, you first need to retrieve a token.</span></span> <span data-ttu-id="2d505-183">Cuando se recupera el token, se debe anexar a su valor de cadena en el encabezado de autorización para todas las solicitudes posteriores a la API Graph.</span><span class="sxs-lookup"><span data-stu-id="2d505-183">When the token is retrieved, its string value must be appended in the Authorization header for all subsequent requests to the Graph API.</span></span> <span data-ttu-id="2d505-184">La mayoría del código anterior controla los detalles de autenticarse en Azure AD para obtener un token, con el token para realizar una llamada a Graph API y, a continuación, transformar la respuesta para que se pueden presentar en la vista.</span><span class="sxs-lookup"><span data-stu-id="2d505-184">Most of the code above handles the details of authenticating to Azure AD to get a token, using the token to make a call to the Graph API, and then transforming the response so that it can be presented in the View.</span></span>

    <span data-ttu-id="2d505-185">La parte más relevante para la discusión es la siguiente línea resaltada: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span><span class="sxs-lookup"><span data-stu-id="2d505-185">The most relevant portion for discussion is the following highlighted line: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span></span> <span data-ttu-id="2d505-186">Esta línea representa el nombre del usuario, que se ha deserializado desde la respuesta JSON y se presenta en la vista.</span><span class="sxs-lookup"><span data-stu-id="2d505-186">This line represents the name of the user, which has been deserialized from the JSON response and is presented in the View.</span></span>

    <span data-ttu-id="2d505-187">Se puede llamar a Graph API mediante HttpClient y controlar los datos sin procesar por sí mismo, pero una manera más fácil es usar el [biblioteca de cliente de Graph que está disponible a través de NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span><span class="sxs-lookup"><span data-stu-id="2d505-187">You can call the Graph API using HttpClient and handle the raw data yourself, but an easier way is to use the [Graph Client Library which is available via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span></span> <span data-ttu-id="2d505-188">La biblioteca cliente controla las solicitudes HTTP sin formato y la transformación de los datos devueltos por usted y hace que sea mucho más fácil trabajar con la API Graph en un entorno. NET.</span><span class="sxs-lookup"><span data-stu-id="2d505-188">The Client Library handles the raw HTTP requests and the transformation of the returned data for you, and makes it much easier to work with the Graph API in a .NET environment.</span></span> <span data-ttu-id="2d505-189">Consulte los ejemplos de código relacionados de Graph API de [GitHub.](https://github.com/AzureADSamples)</span><span class="sxs-lookup"><span data-stu-id="2d505-189">See the related Graph API code samples on [GitHub.](https://github.com/AzureADSamples)</span></span>

## <a name="deploy-the-application-to-azure"></a><span data-ttu-id="2d505-190">Implementar la aplicación en Azure</span><span class="sxs-lookup"><span data-stu-id="2d505-190">Deploy the Application to Azure</span></span>

<span data-ttu-id="2d505-191">Los pasos siguientes le mostrará cómo implementar la aplicación en Azure.</span><span class="sxs-lookup"><span data-stu-id="2d505-191">The following steps will show you how to deploy the application to Azure.</span></span> <span data-ttu-id="2d505-192">En los pasos anteriores, se ha conectado el nuevo proyecto con una aplicación web en Azure, para que esté listo para publicarse en unos pocos pasos.</span><span class="sxs-lookup"><span data-stu-id="2d505-192">In the earlier steps, you connected your new project with a web app on Azure, so it's ready to be published in just a few steps.</span></span>

1. <span data-ttu-id="2d505-193">En Visual Studio, haga doble clic en el proyecto y seleccione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="2d505-193">In Visual Studio, right-click on the project and select **Publish**.</span></span> <span data-ttu-id="2d505-194">El **publicación Web** aparecerá el cuadro de diálogo con cada configuración que ya ha configurado.</span><span class="sxs-lookup"><span data-stu-id="2d505-194">The **Publish Web** dialog will appear with each setting already configured.</span></span> <span data-ttu-id="2d505-195">Haga clic en el **siguiente** botón para ir a la **configuración** página.</span><span class="sxs-lookup"><span data-stu-id="2d505-195">Click on the **Next** button to go to the **Settings** page.</span></span> <span data-ttu-id="2d505-196">Se le pedirá autenticarse; Asegúrese de que se autentique con su cuenta de suscripción de Azure (normalmente una cuenta de Microsoft) y no la cuenta de organización que creó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="2d505-196">You may be prompted to authenticate; make sure you authenticate using your Azure subscription account (typically a Microsoft account) and not the organizational account you created earlier.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. <span data-ttu-id="2d505-197">Compruebe el **Habilitar autenticación organizativa** opción.</span><span class="sxs-lookup"><span data-stu-id="2d505-197">Check the **Enable Organizational Authentication** option.</span></span> <span data-ttu-id="2d505-198">En el **dominio** , escriba el dominio para su directorio.</span><span class="sxs-lookup"><span data-stu-id="2d505-198">In the **Domain** field, enter the domain for your directory.</span></span> <span data-ttu-id="2d505-199">Desde el **nivel de acceso** lista desplegable, seleccione **inicio de sesión único, leer datos de directorio**.</span><span class="sxs-lookup"><span data-stu-id="2d505-199">From the **Access Level** drop-down, select **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="2d505-200">Observará que la anterior base de datos que ya se rellena en el **bases de datos** sección.</span><span class="sxs-lookup"><span data-stu-id="2d505-200">You'll notice that the previous database you used is already populated in the **Databases** section.</span></span> <span data-ttu-id="2d505-201">Haga clic en **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="2d505-201">Click **Publish**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. <span data-ttu-id="2d505-202">Visual Studio empezará a implementar su sitio Web y, a continuación, aparecerá una nueva ventana del explorador.</span><span class="sxs-lookup"><span data-stu-id="2d505-202">Visual Studio will begin deploying your website, and then a new browser window will appear.</span></span> <span data-ttu-id="2d505-203">Se le pedirá autenticarse una vez más a su directorio.</span><span class="sxs-lookup"><span data-stu-id="2d505-203">You may be prompted to authenticate to your directory once again.</span></span> <span data-ttu-id="2d505-204">Una vez que se ha autenticado, se le redirigirá al sitio Web recién publicado en Azure.</span><span class="sxs-lookup"><span data-stu-id="2d505-204">Once you've authenticated, you'll be redirected to your newly published website on Azure.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="2d505-205">Depuración de la aplicación</span><span class="sxs-lookup"><span data-stu-id="2d505-205">Debugging the app</span></span>

<span data-ttu-id="2d505-206">Si recibe el error siguiente: Valor no puede ser nulo ni estar vacío.</span><span class="sxs-lookup"><span data-stu-id="2d505-206">If you get the following error: Value cannot be null or empty.</span></span> <span data-ttu-id="2d505-207">Nombre de parámetro: linkText</span><span class="sxs-lookup"><span data-stu-id="2d505-207">Parameter name: linkText</span></span>

![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)


<span data-ttu-id="2d505-208">Reemplace el código en el *Views\Shared\\_LoginPartial.cshtml* archivo por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="2d505-208">Replace the code in the *Views\Shared\\_LoginPartial.cshtml* file with the following:</span></span>

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

<span data-ttu-id="2d505-209">Después de ejecutar la aplicación, si "Usuario Null" muestra en el usuario que ha iniciado sesión, cierre la sesión y vuelva a iniciarla con la cuenta de Active Directory que creó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="2d505-209">After running the app, if the logged in user shows "Null User", sign out, and sign back in with the Active Directory account you created earlier.</span></span>

<span data-ttu-id="2d505-210">Un excelente tutorial seguir es de Rick Rainey [Deep Dive: Azure Websites y autenticación de organización con Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span><span class="sxs-lookup"><span data-stu-id="2d505-210">An excellent tutorial to follow is Rick Rainey's [Deep Dive: Azure Websites and Organizational Authentication using Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span></span>

## <a name="more-information"></a><span data-ttu-id="2d505-211">Más información</span><span class="sxs-lookup"><span data-stu-id="2d505-211">More Information</span></span>

- [<span data-ttu-id="2d505-212">Profundización: Azure Websites y autenticación de organización con Azure AD</span><span class="sxs-lookup"><span data-stu-id="2d505-212">Deep Dive: Azure Websites and Organizational Authentication using Azure AD</span></span>](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [<span data-ttu-id="2d505-213">Introducción a la API de Azure AD Graph</span><span class="sxs-lookup"><span data-stu-id="2d505-213">Azure AD Graph API Overview</span></span>](https://msdn.microsoft.com/library/azure/hh974476.aspx)
- [<span data-ttu-id="2d505-214">Escenarios de autenticación de Azure AD</span><span class="sxs-lookup"><span data-stu-id="2d505-214">Authentication Scenarios in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn499820.aspx)
- [<span data-ttu-id="2d505-215">Ejemplos de código de Azure AD en GitHub</span><span class="sxs-lookup"><span data-stu-id="2d505-215">Azure AD Code Samples on GitHub</span></span>](https://github.com/AzureADSamples)
