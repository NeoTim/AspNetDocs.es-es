---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Habilitar pruebas unitarias automatizadas | Microsoft Docs
author: microsoft
description: En el paso 12 se muestra cómo desarrollar un conjunto de pruebas unitarias automatizadas que comprueban la funcionalidad de NerdDinner y que nos dará la confianza para realizar cambios...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 09a7aa186605a6cce48ee94028425ded957c00d3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78435595"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="f015c-103">Habilitar las pruebas unitarias automatizadas</span><span class="sxs-lookup"><span data-stu-id="f015c-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="f015c-104">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="f015c-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="f015c-105">Descargar PDF</span><span class="sxs-lookup"><span data-stu-id="f015c-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="f015c-106">Este es el paso 12 de un [tutorial de aplicación "NerdDinner"](introducing-the-nerddinner-tutorial.md) gratuito en el que se explica cómo crear una aplicación web pequeña, pero completa, con ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="f015c-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="f015c-107">En el paso 12 se muestra cómo desarrollar un conjunto de pruebas unitarias automatizadas que comprueban la funcionalidad de NerdDinner y que nos dará la confianza de realizar cambios y mejoras en la aplicación en el futuro.</span><span class="sxs-lookup"><span data-stu-id="f015c-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="f015c-108">Si usa ASP.NET MVC 3, se recomienda seguir los tutoriales [de la introducción con MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) o MVC [Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="f015c-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="f015c-109">NerdDinner paso 12: pruebas unitarias</span><span class="sxs-lookup"><span data-stu-id="f015c-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="f015c-110">Vamos a desarrollar un conjunto de pruebas unitarias automatizadas que comprueban la funcionalidad de NerdDinner y que nos dará la confianza de realizar cambios y mejoras en la aplicación en el futuro.</span><span class="sxs-lookup"><span data-stu-id="f015c-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="f015c-111">¿Por qué prueba unitaria?</span><span class="sxs-lookup"><span data-stu-id="f015c-111">Why Unit Test?</span></span>

<span data-ttu-id="f015c-112">En la unidad en el trabajo de una mañana tiene un destello repentino de inspiración sobre una aplicación en la que está trabajando.</span><span class="sxs-lookup"><span data-stu-id="f015c-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="f015c-113">Observa que hay un cambio que puede implementar, lo que hará que la aplicación sea mucho mejor.</span><span class="sxs-lookup"><span data-stu-id="f015c-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="f015c-114">Podría tratarse de una refactorización que limpia el código, agrega una nueva característica o corrige un error.</span><span class="sxs-lookup"><span data-stu-id="f015c-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="f015c-115">La pregunta que le reparte cuando llega a su equipo es: "¿Qué es lo seguro que es hacer esta mejora?".</span><span class="sxs-lookup"><span data-stu-id="f015c-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="f015c-116">¿Qué ocurre si hacer el cambio tiene efectos secundarios o rompe algo?</span><span class="sxs-lookup"><span data-stu-id="f015c-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="f015c-117">El cambio podría ser sencillo y solo tardará unos minutos en implementarse, pero ¿qué ocurre si tardan horas en probar manualmente todos los escenarios de la aplicación?</span><span class="sxs-lookup"><span data-stu-id="f015c-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="f015c-118">¿Qué ocurre si olvida cubrir un escenario y una aplicación interrumpida entra en producción?</span><span class="sxs-lookup"><span data-stu-id="f015c-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="f015c-119">¿Merece realmente esta mejora el esfuerzo?</span><span class="sxs-lookup"><span data-stu-id="f015c-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="f015c-120">Las pruebas unitarias automatizadas pueden proporcionar una red de seguridad que le permita mejorar continuamente sus aplicaciones y evitar tener miedo al código en el que está trabajando.</span><span class="sxs-lookup"><span data-stu-id="f015c-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="f015c-121">Las pruebas automatizadas que comprueban la funcionalidad rápidamente le permiten codificar con confianza, y le permiten realizar mejoras que, de otro modo, podrían no sentirse cómodos.</span><span class="sxs-lookup"><span data-stu-id="f015c-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="f015c-122">También ayudan a crear soluciones que son más fáciles de mantener y tienen una duración más larga, lo que conduce a una rentabilidad mucho mayor de la inversión.</span><span class="sxs-lookup"><span data-stu-id="f015c-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="f015c-123">El marco de MVC de ASP.NET hace que sea más fácil y natural realizar pruebas unitarias de la funcionalidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f015c-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="f015c-124">También habilita un flujo de trabajo de desarrollo controlado por pruebas (TDD) que permite el desarrollo basado en pruebas primero.</span><span class="sxs-lookup"><span data-stu-id="f015c-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="f015c-125">Proyecto NerdDinner. tests</span><span class="sxs-lookup"><span data-stu-id="f015c-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="f015c-126">Cuando creamos la aplicación NerdDinner al principio de este tutorial, se le ha preguntado un cuadro de diálogo en el que se le pregunta si deseamos crear un proyecto de prueba unitaria para ir junto con el proyecto de aplicación:</span><span class="sxs-lookup"><span data-stu-id="f015c-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="f015c-127">Mantuvimos el botón de radio "sí, crear un proyecto de prueba unitaria" seleccionado, lo que dio lugar a que se agregara un proyecto "NerdDinner. tests" a nuestra solución:</span><span class="sxs-lookup"><span data-stu-id="f015c-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="f015c-128">El proyecto NerdDinner. tests hace referencia al ensamblado del proyecto de aplicación NerdDinner y nos permite agregar fácilmente las pruebas automatizadas que comprueban la funcionalidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f015c-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="f015c-129">Crear pruebas unitarias para nuestra clase de modelo cena</span><span class="sxs-lookup"><span data-stu-id="f015c-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="f015c-130">Vamos a agregar algunas pruebas al proyecto NerdDinner. tests que comprueban la clase cena que creamos cuando construimos nuestra capa de modelo.</span><span class="sxs-lookup"><span data-stu-id="f015c-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="f015c-131">Comenzaremos por crear una nueva carpeta en nuestro proyecto de prueba denominado "models", donde colocaremos las pruebas relacionadas con el modelo.</span><span class="sxs-lookup"><span data-stu-id="f015c-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="f015c-132">A continuación, hacemos clic con el botón derecho en la carpeta y elegimos el comando de menú **agregar&gt;nueva prueba** .</span><span class="sxs-lookup"><span data-stu-id="f015c-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="f015c-133">Se abrirá el cuadro de diálogo "Agregar nueva prueba".</span><span class="sxs-lookup"><span data-stu-id="f015c-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="f015c-134">Elegiremos crear una "prueba unitaria" y asignarle el nombre "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="f015c-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="f015c-135">Cuando hacemos clic en el botón "Aceptar", Visual Studio agregará (y abrirá) un archivo DinnerTest.cs al proyecto:</span><span class="sxs-lookup"><span data-stu-id="f015c-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="f015c-136">La plantilla de prueba unitaria de Visual Studio predeterminada tiene un montón de código de placa de caldera que me ha encontrado un poco confuso.</span><span class="sxs-lookup"><span data-stu-id="f015c-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="f015c-137">Vamos a limpiarlo para que solo contenga el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="f015c-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="f015c-138">El atributo [TestClass] de la clase DinnerTest anterior lo identifica como una clase que contendrá las pruebas, así como el código de inicialización y desmontaje de prueba opcional.</span><span class="sxs-lookup"><span data-stu-id="f015c-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="f015c-139">Podemos definir pruebas en ella agregando métodos públicos que tengan un atributo [TestMethod] en ellos.</span><span class="sxs-lookup"><span data-stu-id="f015c-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="f015c-140">A continuación se muestran las dos primeras pruebas que vamos a agregar a nuestra clase cena.</span><span class="sxs-lookup"><span data-stu-id="f015c-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="f015c-141">La primera prueba comprueba que nuestra cena no es válida si se crea una nueva cena sin que todas las propiedades se establezcan correctamente.</span><span class="sxs-lookup"><span data-stu-id="f015c-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="f015c-142">La segunda prueba comprueba que nuestra cena es válida cuando una cena tiene todas las propiedades establecidas con valores válidos:</span><span class="sxs-lookup"><span data-stu-id="f015c-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="f015c-143">Observará que los nombres de las pruebas son muy explícitos (y ligeramente detallados).</span><span class="sxs-lookup"><span data-stu-id="f015c-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="f015c-144">Estamos haciendo esto porque podríamos acabar creando cientos o miles de pruebas pequeñas, y queremos facilitar la determinación rápida de la intención y el comportamiento de cada uno de ellos (especialmente cuando se examina una lista de errores en un ejecutor de pruebas).</span><span class="sxs-lookup"><span data-stu-id="f015c-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="f015c-145">Los nombres de las pruebas deben tener el nombre de la funcionalidad que están probando.</span><span class="sxs-lookup"><span data-stu-id="f015c-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="f015c-146">Por encima, se usa un patrón de nomenclatura "Sustantivo\_debe\_verbo".</span><span class="sxs-lookup"><span data-stu-id="f015c-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="f015c-147">Vamos a estructurar las pruebas mediante el patrón de prueba "AAA", que significa "Arrange, Act, Assert":</span><span class="sxs-lookup"><span data-stu-id="f015c-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="f015c-148">Organizar: configurar la unidad que se está probando</span><span class="sxs-lookup"><span data-stu-id="f015c-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="f015c-149">Act: ejecute la unidad en pruebas y Capture los resultados</span><span class="sxs-lookup"><span data-stu-id="f015c-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="f015c-150">Assert: comprueba el comportamiento</span><span class="sxs-lookup"><span data-stu-id="f015c-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="f015c-151">Cuando escribimos pruebas, queremos evitar que las pruebas individuales hagan demasiado.</span><span class="sxs-lookup"><span data-stu-id="f015c-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="f015c-152">En su lugar, cada prueba debe comprobar un único concepto (lo que hará que sea mucho más fácil identificar la causa de los errores).</span><span class="sxs-lookup"><span data-stu-id="f015c-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="f015c-153">Una buena directriz es probar y solo tener una única instrucción Assert para cada prueba.</span><span class="sxs-lookup"><span data-stu-id="f015c-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="f015c-154">Si tiene más de una instrucción Assert en un método de prueba, asegúrese de que se usan para probar el mismo concepto.</span><span class="sxs-lookup"><span data-stu-id="f015c-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="f015c-155">En casos de duda, realice otra prueba.</span><span class="sxs-lookup"><span data-stu-id="f015c-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="f015c-156">Ejecutar pruebas</span><span class="sxs-lookup"><span data-stu-id="f015c-156">Running Tests</span></span>

<span data-ttu-id="f015c-157">Visual Studio 2008 Professional (y ediciones posteriores) incluye un ejecutor de pruebas integrado que se puede usar para ejecutar proyectos de prueba unitaria de Visual Studio en el IDE.</span><span class="sxs-lookup"><span data-stu-id="f015c-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="f015c-158">Podemos seleccionar el comando de menú **prueba-&gt;ejecutar-&gt;todas las pruebas en la solución** (o escribir Ctrl R, a) para ejecutar todas las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="f015c-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="f015c-159">O, como alternativa, se puede colocar el cursor dentro de una clase de prueba o un método de prueba concretos y usar las **pruebas test-&gt;Run-&gt;en el comando de menú contextual actual** (o escribir Ctrl R, t) para ejecutar un subconjunto de las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="f015c-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="f015c-160">Vamos a colocar el cursor dentro de la clase DinnerTest y escribir "Ctrl R, T" para ejecutar las dos pruebas recién definidas.</span><span class="sxs-lookup"><span data-stu-id="f015c-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="f015c-161">Cuando lo hagamos, aparecerá una ventana "Resultados de pruebas" en Visual Studio y veremos los resultados de la serie de pruebas que se muestran en ella:</span><span class="sxs-lookup"><span data-stu-id="f015c-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="f015c-162">*Nota: de forma predeterminada, la ventana Resultados de pruebas de VS no muestra la columna Nombre de clase. Para agregar esto, haga clic con el botón derecho en la ventana de Resultados de pruebas y use el comando de menú Agregar o quitar columnas.*</span><span class="sxs-lookup"><span data-stu-id="f015c-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="f015c-163">Nuestras dos pruebas han tardado solo una fracción de segundo en ejecutarse y, como puede ver, ambos pasan.</span><span class="sxs-lookup"><span data-stu-id="f015c-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="f015c-164">Ahora podemos continuar y aumentar su capacidad creando pruebas adicionales que comprueban validaciones de reglas específicas, así como abarcar los dos métodos auxiliares: IsUserHost () y IsUserRegistered (), que hemos agregado a la clase cena.</span><span class="sxs-lookup"><span data-stu-id="f015c-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="f015c-165">Tener todas estas pruebas en su lugar para la clase cena hará que sea mucho más fácil y seguro agregar nuevas reglas de negocio y validaciones en el futuro.</span><span class="sxs-lookup"><span data-stu-id="f015c-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="f015c-166">Podemos agregar la nueva lógica de regla a la cena y, en cuestión de segundos, comprobar que no ha interrumpido ninguna de nuestras funciones lógicas anteriores.</span><span class="sxs-lookup"><span data-stu-id="f015c-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="f015c-167">Observe que el uso de un nombre de prueba descriptivo facilita la comprensión rápida de lo que está comprobando cada prueba.</span><span class="sxs-lookup"><span data-stu-id="f015c-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="f015c-168">Recomiendo usar el comando **de menú herramientas-&gt;opciones** , abrir la pantalla herramientas de prueba-&gt;probar la configuración de ejecución y activar la casilla "hacer doble clic en un resultado de pruebas unitarias con errores o no concluyente" muestra el punto de error en la comprobación ".</span><span class="sxs-lookup"><span data-stu-id="f015c-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="f015c-169">Esto le permitirá hacer doble clic en un error en la ventana Resultados de pruebas y pasar inmediatamente al error de aserción.</span><span class="sxs-lookup"><span data-stu-id="f015c-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="f015c-170">Crear pruebas unitarias de DinnersController</span><span class="sxs-lookup"><span data-stu-id="f015c-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="f015c-171">Ahora vamos a crear algunas pruebas unitarias que comprueben la funcionalidad de DinnersController.</span><span class="sxs-lookup"><span data-stu-id="f015c-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="f015c-172">Comenzaremos haciendo clic con el botón derecho en la carpeta "Controllers" en nuestro proyecto de prueba y, a continuación, elegiremos el comando de menú **agregar&gt;nueva prueba** .</span><span class="sxs-lookup"><span data-stu-id="f015c-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="f015c-173">Vamos a crear una "prueba unitaria" y le asignaremos el nombre "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="f015c-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="f015c-174">Vamos a crear dos métodos de prueba que comprueban el método de acción Details () en DinnersController.</span><span class="sxs-lookup"><span data-stu-id="f015c-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="f015c-175">La primera comprobará que se devuelve una vista cuando se solicita una cena existente.</span><span class="sxs-lookup"><span data-stu-id="f015c-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="f015c-176">La segunda comprobará que se devuelve una vista "NotFound" cuando se solicita una cena no existente:</span><span class="sxs-lookup"><span data-stu-id="f015c-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="f015c-177">El código anterior compila Clean.</span><span class="sxs-lookup"><span data-stu-id="f015c-177">The above code compiles clean.</span></span> <span data-ttu-id="f015c-178">Sin embargo, cuando se ejecutan las pruebas, se produce un error:</span><span class="sxs-lookup"><span data-stu-id="f015c-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="f015c-179">Si observamos los mensajes de error, veremos que la razón por la que se produjo un error en las pruebas fue porque nuestra clase DinnersRepository no pudo conectarse a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="f015c-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="f015c-180">Nuestra aplicación NerdDinner usa una cadena de conexión a un archivo de SQL Server Express local que reside en el directorio \App\_data del proyecto de aplicación NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="f015c-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="f015c-181">Dado que nuestro proyecto NerdDinner. tests se compila y se ejecuta en un directorio diferente, el proyecto de aplicación, la ubicación de la ruta de acceso relativa de la cadena de conexión es incorrecta.</span><span class="sxs-lookup"><span data-stu-id="f015c-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="f015c-182">Para *solucionar este* problema, copie el archivo de base de datos de SQL Express en nuestro proyecto de prueba y, a continuación, agregue una cadena de conexión de prueba adecuada en el archivo app. config del proyecto de prueba.</span><span class="sxs-lookup"><span data-stu-id="f015c-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="f015c-183">Esto obtendría las pruebas anteriores desbloqueadas y en ejecución.</span><span class="sxs-lookup"><span data-stu-id="f015c-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="f015c-184">Sin embargo, el código de las pruebas unitarias que usan una base de datos real aporta una serie de desafíos.</span><span class="sxs-lookup"><span data-stu-id="f015c-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="f015c-185">De manera específica:</span><span class="sxs-lookup"><span data-stu-id="f015c-185">Specifically:</span></span>

- <span data-ttu-id="f015c-186">Reduce considerablemente el tiempo de ejecución de las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="f015c-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="f015c-187">Cuanto más tiempo se tarde en ejecutar las pruebas, menos probable es que se ejecuten con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="f015c-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="f015c-188">Lo ideal es que desee que las pruebas unitarias se ejecuten en segundos, y que sea algo que haga tan natural como compilar el proyecto.</span><span class="sxs-lookup"><span data-stu-id="f015c-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="f015c-189">Complica la lógica de instalación y limpieza en las pruebas.</span><span class="sxs-lookup"><span data-stu-id="f015c-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="f015c-190">Desea que cada prueba unitaria se aísle e independiente de otras (sin efectos secundarios o dependencias).</span><span class="sxs-lookup"><span data-stu-id="f015c-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="f015c-191">Al trabajar con una base de datos real, tiene que tener en cuenta el estado y restablecerla entre las pruebas.</span><span class="sxs-lookup"><span data-stu-id="f015c-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="f015c-192">Echemos un vistazo a un patrón de diseño denominado "inserción de dependencias" que puede ayudarnos a solucionar estos problemas y evitar la necesidad de usar una base de datos real con nuestras pruebas.</span><span class="sxs-lookup"><span data-stu-id="f015c-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="f015c-193">Inserción de dependencias</span><span class="sxs-lookup"><span data-stu-id="f015c-193">Dependency Injection</span></span>

<span data-ttu-id="f015c-194">En la actualidad, DinnersController está estrechamente "acoplada" a la clase DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="f015c-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="f015c-195">"Acoplamiento" hace referencia a una situación en la que una clase se basa explícitamente en otra clase para poder funcionar:</span><span class="sxs-lookup"><span data-stu-id="f015c-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="f015c-196">Dado que la clase DinnerRepository requiere acceso a una base de datos, la dependencia estrechamente acoplada que la clase DinnersController tiene en la DinnerRepository termina requiriendo tener una base de datos para que se puedan probar los métodos de acción DinnersController.</span><span class="sxs-lookup"><span data-stu-id="f015c-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="f015c-197">Podemos evitar esto empleando un modelo de diseño denominado "inserción de dependencias", que es un enfoque en el que las dependencias (como las clases de repositorio que proporcionan acceso a los datos) ya no se crean de forma implícita dentro de las clases que las utilizan.</span><span class="sxs-lookup"><span data-stu-id="f015c-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="f015c-198">En su lugar, las dependencias se pueden pasar explícitamente a la clase que las utiliza mediante argumentos de constructor.</span><span class="sxs-lookup"><span data-stu-id="f015c-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="f015c-199">Si las dependencias se definen mediante interfaces, tenemos la flexibilidad de pasar implementaciones de dependencias "falsas" para escenarios de prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="f015c-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="f015c-200">Esto nos permite crear implementaciones de dependencia específicas de la prueba que realmente no requieren acceso a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="f015c-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="f015c-201">Para ver esto en acción, vamos a implementar la inserción de dependencias con nuestro DinnersController.</span><span class="sxs-lookup"><span data-stu-id="f015c-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="f015c-202">Extracción de una interfaz IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="f015c-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="f015c-203">El primer paso es crear una nueva interfaz IDinnerRepository que encapsula el contrato del repositorio que nuestros controladores requieren para recuperar y actualizar las cenas.</span><span class="sxs-lookup"><span data-stu-id="f015c-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="f015c-204">Para definir este contrato de interfaz manualmente, haga clic con el botón derecho en la carpeta \Models y, a continuación, elija el comando de menú **&gt;agregar nuevo elemento** y cree una nueva interfaz denominada IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="f015c-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="f015c-205">Como alternativa, podemos usar las herramientas de refactorización integradas en Visual Studio Professional (y ediciones posteriores) para extraer y crear automáticamente una interfaz para nosotros de nuestra clase DinnerRepository existente.</span><span class="sxs-lookup"><span data-stu-id="f015c-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="f015c-206">Para extraer esta interfaz con VS, simplemente coloque el cursor en el editor de texto en la clase DinnerRepository y, a continuación, haga clic con el botón derecho y elija el comando de menú **refactorizar-&gt;extraer interfaz** :</span><span class="sxs-lookup"><span data-stu-id="f015c-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="f015c-207">Se abrirá el cuadro de diálogo "Extraer interfaz" y nos pedirá el nombre de la interfaz que se va a crear.</span><span class="sxs-lookup"><span data-stu-id="f015c-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="f015c-208">De forma predeterminada, se IDinnerRepository y se seleccionan automáticamente todos los métodos públicos de la clase DinnerRepository existente para agregarlos a la interfaz:</span><span class="sxs-lookup"><span data-stu-id="f015c-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="f015c-209">Cuando hacemos clic en el botón "Aceptar", Visual Studio agregará una nueva interfaz IDinnerRepository a nuestra aplicación:</span><span class="sxs-lookup"><span data-stu-id="f015c-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="f015c-210">Y nuestra clase DinnerRepository existente se actualizará para que implemente la interfaz:</span><span class="sxs-lookup"><span data-stu-id="f015c-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="f015c-211">Actualización de DinnersController para admitir la inserción de constructores</span><span class="sxs-lookup"><span data-stu-id="f015c-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="f015c-212">Ahora actualizaremos la clase DinnersController para usar la nueva interfaz.</span><span class="sxs-lookup"><span data-stu-id="f015c-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="f015c-213">Actualmente, DinnersController está codificado de forma rígida, de modo que su campo "dinnerRepository" siempre es una clase DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="f015c-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="f015c-214">Lo cambiaremos para que el campo "dinnerRepository" sea de tipo IDinnerRepository en lugar de DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="f015c-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="f015c-215">A continuación, vamos a agregar dos constructores DinnersController públicos.</span><span class="sxs-lookup"><span data-stu-id="f015c-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="f015c-216">Uno de los constructores permite pasar un IDinnerRepository como argumento.</span><span class="sxs-lookup"><span data-stu-id="f015c-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="f015c-217">El otro es un constructor predeterminado que usa nuestra implementación de DinnerRepository existente:</span><span class="sxs-lookup"><span data-stu-id="f015c-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="f015c-218">Dado que ASP.NET MVC crea clases de controlador de forma predeterminada mediante constructores predeterminados, nuestro DinnersController en tiempo de ejecución seguirá usando la clase DinnerRepository para realizar el acceso a los datos.</span><span class="sxs-lookup"><span data-stu-id="f015c-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="f015c-219">Ahora podemos actualizar nuestras pruebas unitarias para pasar una implementación de repositorio de cenas "falsa" mediante el constructor de parámetros.</span><span class="sxs-lookup"><span data-stu-id="f015c-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="f015c-220">Este repositorio de cenas "falso" no necesitará acceso a una base de datos real y, en su lugar, utilizará datos de ejemplo en memoria.</span><span class="sxs-lookup"><span data-stu-id="f015c-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="f015c-221">Crear la clase FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="f015c-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="f015c-222">Vamos a crear una clase FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="f015c-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="f015c-223">Comenzaremos por crear un directorio "falsificaciones" dentro del proyecto NerdDinner. tests y, a continuación, agregaremos una nueva clase FakeDinnerRepository a él (haga clic con el botón derecho en la carpeta y elija **Agregar-&gt;nueva clase**):</span><span class="sxs-lookup"><span data-stu-id="f015c-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="f015c-224">Actualizaremos el código para que la clase FakeDinnerRepository implemente la interfaz IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="f015c-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="f015c-225">A continuación, podemos hacer clic con el botón derecho en él y elegir el comando de menú contextual "implementar interfaz IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="f015c-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="f015c-226">Esto hará que Visual Studio agregue automáticamente todos los miembros de la interfaz IDinnerRepository a nuestra clase FakeDinnerRepository con implementaciones de "código auxiliar" predeterminadas:</span><span class="sxs-lookup"><span data-stu-id="f015c-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="f015c-227">A continuación, podemos actualizar la implementación de FakeDinnerRepository para que funcione fuera de una lista en memoria&lt;cena&gt; colección que se le ha pasado como argumento de constructor:</span><span class="sxs-lookup"><span data-stu-id="f015c-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="f015c-228">Ahora tenemos una implementación de IDinnerRepository falsa que no necesita una base de datos y que, en su lugar, puede trabajar con una lista en memoria de objetos de cenas.</span><span class="sxs-lookup"><span data-stu-id="f015c-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="f015c-229">Usar FakeDinnerRepository con pruebas unitarias</span><span class="sxs-lookup"><span data-stu-id="f015c-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="f015c-230">Vamos a volver a las pruebas unitarias de DinnersController que dieron error antes porque la base de datos no estaba disponible.</span><span class="sxs-lookup"><span data-stu-id="f015c-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="f015c-231">Podemos actualizar los métodos de prueba para usar un FakeDinnerRepository rellenado con datos de cenas en memoria de ejemplo para DinnersController mediante el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="f015c-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="f015c-232">Y ahora, cuando ejecutamos estas pruebas, ambos pasan:</span><span class="sxs-lookup"><span data-stu-id="f015c-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="f015c-233">Lo mejor de todo es que solo tardan una fracción de un segundo en ejecutarse y no requieren lógica complicada de instalación y limpieza.</span><span class="sxs-lookup"><span data-stu-id="f015c-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="f015c-234">Ahora podemos realizar pruebas unitarias de todo el código del método de acción DinnersController (incluido el listado, la paginación, los detalles, la creación, la actualización y la eliminación) sin necesidad de conectarse a una base de datos real.</span><span class="sxs-lookup"><span data-stu-id="f015c-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="f015c-235">**Tema secundario: marcos de inserción de dependencias**</span><span class="sxs-lookup"><span data-stu-id="f015c-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="f015c-236">La realización manual de la inserción de dependencias (como hemos superado) funciona bien, pero se hace más difícil de mantener a medida que aumenta el número de dependencias y componentes de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="f015c-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="f015c-237">Existen varios marcos de inserción de dependencias para .NET que pueden ayudar a proporcionar aún más flexibilidad de administración de dependencias.</span><span class="sxs-lookup"><span data-stu-id="f015c-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="f015c-238">Estos marcos de trabajo, a veces denominados "inversion of control" (IoC), proporcionan mecanismos que permiten un nivel adicional de compatibilidad de configuración para especificar y pasar dependencias a objetos en tiempo de ejecución (la mayoría de las veces se usa la inserción de constructores. ).</span><span class="sxs-lookup"><span data-stu-id="f015c-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="f015c-239">Algunos de los marcos de ejemplo de inserción de dependencias de OSS más populares en .NET son: AutoFac, Ninject, Spring.NET, StructureMap y Windsor.</span><span class="sxs-lookup"><span data-stu-id="f015c-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="f015c-240">ASP.NET MVC expone API de extensibilidad que permiten a los desarrolladores participar en la resolución y la creación de instancias de controladores, y lo que permite que los marcos de inserción de dependencias y de IoC estén perfectamente integrados dentro de este proceso.</span><span class="sxs-lookup"><span data-stu-id="f015c-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="f015c-241">El uso de un marco de DI/IOC también nos permite quitar el constructor predeterminado de nuestro DinnersController, que quitaría por completo el acoplamiento entre él y el DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="f015c-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="f015c-242">No vamos a usar un marco de inserción de dependencias/IOC con nuestra aplicación NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="f015c-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="f015c-243">Pero es algo que podríamos tener en cuenta en el futuro si la base de código y las funcionalidades de NerdDinner han crecido.</span><span class="sxs-lookup"><span data-stu-id="f015c-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="f015c-244">Crear pruebas unitarias de acción de edición</span><span class="sxs-lookup"><span data-stu-id="f015c-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="f015c-245">Ahora vamos a crear algunas pruebas unitarias que comprueben la funcionalidad de edición de DinnersController.</span><span class="sxs-lookup"><span data-stu-id="f015c-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="f015c-246">Comenzaremos probando la versión HTTP-GET de nuestra acción de edición:</span><span class="sxs-lookup"><span data-stu-id="f015c-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="f015c-247">Vamos a crear una prueba que comprueba que una vista respaldada por un objeto DinnerFormViewModel se representará cuando se solicite una cena válida:</span><span class="sxs-lookup"><span data-stu-id="f015c-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="f015c-248">Sin embargo, cuando se ejecuta la prueba, veremos que se produce un error porque se produce una excepción de referencia nula cuando el método Edit tiene acceso a la propiedad User.Identity.Name para realizar la comprobación cena. IsHostedBy ().</span><span class="sxs-lookup"><span data-stu-id="f015c-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="f015c-249">El objeto de usuario de la clase base del controlador encapsula los detalles sobre el usuario que ha iniciado sesión y lo rellena ASP.NET MVC cuando crea el controlador en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="f015c-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="f015c-250">Dado que estamos probando el DinnersController fuera de un entorno de servidor Web, no se establece el objeto de usuario (por lo tanto, la excepción de referencia nula).</span><span class="sxs-lookup"><span data-stu-id="f015c-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="f015c-251">Simular la propiedad User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="f015c-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="f015c-252">Los marcos ficticios facilitan la realización de pruebas, ya que permiten crear dinámicamente versiones falsas de objetos dependientes que admiten nuestras pruebas.</span><span class="sxs-lookup"><span data-stu-id="f015c-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="f015c-253">Por ejemplo, podemos utilizar un marco ficticio en nuestra prueba de acción de edición para crear dinámicamente un objeto de usuario que nuestro DinnersController puede usar para buscar un nombre de usuario simulado.</span><span class="sxs-lookup"><span data-stu-id="f015c-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="f015c-254">Esto evitará que se produzca una referencia nula cuando se ejecute la prueba.</span><span class="sxs-lookup"><span data-stu-id="f015c-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="f015c-255">Hay muchos marcos de trabajo ficticios de .NET que se pueden usar con ASP.NET MVC (puede ver una lista de ellos aquí: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="f015c-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="f015c-256">Para probar la aplicación NerdDinner, usaremos un marco ficticio de código abierto denominado "MOQ", que se puede descargar de forma gratuita desde [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="f015c-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="f015c-257">Una vez descargado, agregaremos una referencia en el proyecto NerdDinner. tests al ensamblado MOQ. dll:</span><span class="sxs-lookup"><span data-stu-id="f015c-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="f015c-258">Después, agregaremos un método auxiliar "CreateDinnersControllerAs (username)" a nuestra clase de prueba que toma un nombre de usuario como parámetro y que, a continuación, "simula" la propiedad User.Identity.Name en la instancia de DinnersController:</span><span class="sxs-lookup"><span data-stu-id="f015c-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="f015c-259">Por encima, se usa MOQ para crear un objeto ficticio que falsifica un objeto ControllerContext (que es lo que ASP.NET MVC pasa a las clases de controlador para exponer objetos en tiempo de ejecución como usuario, solicitud, respuesta y sesión).</span><span class="sxs-lookup"><span data-stu-id="f015c-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="f015c-260">Estamos llamando al método "SetupGet" en el simulacro para indicar que la propiedad HttpContext.User.Identity.Name de ControllerContext debe devolver la cadena de nombre de usuario pasada al método auxiliar.</span><span class="sxs-lookup"><span data-stu-id="f015c-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="f015c-261">Se puede simular cualquier número de métodos y propiedades de ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="f015c-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="f015c-262">Para ilustrar esto, también he agregado una llamada a SetupGet () para la propiedad request. IsAuthenticated (que realmente no es necesaria para las pruebas siguientes, pero que ayuda a ilustrar cómo se pueden simular las propiedades de la solicitud).</span><span class="sxs-lookup"><span data-stu-id="f015c-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="f015c-263">Cuando se hace, se asigna una instancia del simulacro ControllerContext a la DinnersController que el método auxiliar devuelve.</span><span class="sxs-lookup"><span data-stu-id="f015c-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="f015c-264">Ahora podemos escribir pruebas unitarias que utilicen este método auxiliar para probar escenarios de edición que impliquen a distintos usuarios:</span><span class="sxs-lookup"><span data-stu-id="f015c-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="f015c-265">Y ahora cuando se ejecutan las pruebas que superan:</span><span class="sxs-lookup"><span data-stu-id="f015c-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="f015c-266">Prueba de escenarios de UpdateModel ()</span><span class="sxs-lookup"><span data-stu-id="f015c-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="f015c-267">Hemos creado pruebas que cubren la versión HTTP-GET de la acción de edición.</span><span class="sxs-lookup"><span data-stu-id="f015c-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="f015c-268">Vamos a crear ahora algunas pruebas que comprueban la versión HTTP-POST de la acción de edición:</span><span class="sxs-lookup"><span data-stu-id="f015c-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="f015c-269">El nuevo escenario interesante de pruebas para nosotros es compatible con este método de acción es el uso del método auxiliar UpdateModel () en la clase base del controlador.</span><span class="sxs-lookup"><span data-stu-id="f015c-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="f015c-270">Usamos este método auxiliar para enlazar valores de envío de formulario a nuestra instancia de objeto cena.</span><span class="sxs-lookup"><span data-stu-id="f015c-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="f015c-271">A continuación se muestran dos pruebas que muestran cómo se pueden proporcionar valores publicados de formulario para que los use el método auxiliar UpdateModel ().</span><span class="sxs-lookup"><span data-stu-id="f015c-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="f015c-272">Haremos esto creando y rellenando un objeto FormCollection y, a continuación, asígnelo a la propiedad "ValueProvider" en el controlador.</span><span class="sxs-lookup"><span data-stu-id="f015c-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="f015c-273">La primera prueba comprueba que, si se guarda correctamente, el explorador se redirige a la acción de detalles.</span><span class="sxs-lookup"><span data-stu-id="f015c-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="f015c-274">La segunda prueba comprueba que, cuando se publica una entrada no válida, la acción vuelve a mostrar la vista de edición con un mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="f015c-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="f015c-275">Realización de pruebas</span><span class="sxs-lookup"><span data-stu-id="f015c-275">Testing Wrap-Up</span></span>

<span data-ttu-id="f015c-276">Hemos tratado los conceptos básicos implicados en las clases de controlador de pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="f015c-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="f015c-277">Podemos usar estas técnicas para crear fácilmente cientos de pruebas simples que comprueban el comportamiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f015c-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="f015c-278">Dado que nuestras pruebas de modelo y controlador no requieren una base de datos real, son muy rápidas y fáciles de ejecutar.</span><span class="sxs-lookup"><span data-stu-id="f015c-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="f015c-279">Podremos ejecutar cientos de pruebas automatizadas en solo unos segundos y obtener comentarios de inmediato sobre si un cambio que hemos realizado ha roto algo.</span><span class="sxs-lookup"><span data-stu-id="f015c-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="f015c-280">Esto le ayudará a proporcionarnos la confianza de mejorar, refactorizar y refinar la aplicación continuamente.</span><span class="sxs-lookup"><span data-stu-id="f015c-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="f015c-281">Hemos tratado las pruebas como el último tema de este capítulo, pero no porque las pruebas son algo que debería hacer al final de un proceso de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="f015c-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="f015c-282">Por el contrario, debe escribir pruebas automatizadas lo antes posible en el proceso de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="f015c-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="f015c-283">Esto le permite obtener comentarios inmediatos a medida que desarrolla, le ayuda a pensar de forma exhaustiva en los escenarios de casos de uso de su aplicación y le guía para diseñar la aplicación con capas limpias y acoplamiento en mente.</span><span class="sxs-lookup"><span data-stu-id="f015c-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="f015c-284">En un capítulo posterior del libro se tratará el desarrollo controlado por pruebas (TDD) y cómo usarlo con ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="f015c-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="f015c-285">TDD es una práctica de codificación iterativa en la que se escriben primero las pruebas que satisfará el código resultante.</span><span class="sxs-lookup"><span data-stu-id="f015c-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="f015c-286">Con TDD, cada característica se inicia creando una prueba que comprueba la funcionalidad que va a implementar.</span><span class="sxs-lookup"><span data-stu-id="f015c-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="f015c-287">Escribir la prueba unitaria primero ayuda a asegurarse de que comprende claramente la característica y cómo debe funcionar.</span><span class="sxs-lookup"><span data-stu-id="f015c-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="f015c-288">Solo después de escribir la prueba (y haber comprobado que se produce un error), se implementa la funcionalidad real que comprueba la prueba.</span><span class="sxs-lookup"><span data-stu-id="f015c-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="f015c-289">Dado que ya ha dedicado tiempo a pensar en el caso de uso de cómo debe funcionar la característica, tendrá una mejor comprensión de los requisitos y la mejor manera de implementarlos.</span><span class="sxs-lookup"><span data-stu-id="f015c-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="f015c-290">Cuando haya terminado la implementación, puede volver a ejecutar la prueba y obtener comentarios inmediatos sobre si la característica funciona correctamente.</span><span class="sxs-lookup"><span data-stu-id="f015c-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="f015c-291">Veremos más en el capítulo 10.</span><span class="sxs-lookup"><span data-stu-id="f015c-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="f015c-292">Paso siguiente</span><span class="sxs-lookup"><span data-stu-id="f015c-292">Next Step</span></span>

<span data-ttu-id="f015c-293">Algunos comentarios finales de resumen.</span><span class="sxs-lookup"><span data-stu-id="f015c-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f015c-294">[Anterior](use-ajax-to-implement-mapping-scenarios.md)
> [Siguiente](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="f015c-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
