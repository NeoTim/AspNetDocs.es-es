---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
title: Retirada y pago con PayPal | Microsoft Docs
author: Erikre
description: Esta serie de tutoriales aprenderá los conceptos básicos de la creación de una aplicación de formularios Web Forms ASP.NET con ASP.NET 4.5 y Microsoft Visual Studio Express 2013 para se...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 664ec95e-b0c9-4f43-a39f-798d0f2a7e08
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
msc.type: authoredcontent
ms.openlocfilehash: a0895c2246bc08f50645a865ce2dfffecfbb56a6
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/09/2019
ms.locfileid: "59391161"
---
# <a name="checkout-and-payment-with-paypal"></a><span data-ttu-id="c30d7-103">Finalización de la compra y pago con PayPal</span><span class="sxs-lookup"><span data-stu-id="c30d7-103">Checkout and Payment with PayPal</span></span>

<span data-ttu-id="c30d7-104">por [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="c30d7-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="c30d7-105">[Descargar el proyecto de ejemplo de Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) o [descargar eBook (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="c30d7-105">[Download Wingtip Toys Sample Project (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="c30d7-106">Esta serie de tutoriales aprenderá los conceptos básicos de la creación de una aplicación de formularios Web Forms ASP.NET con ASP.NET 4.5 y Microsoft Visual Studio Express 2013 para Web.</span><span class="sxs-lookup"><span data-stu-id="c30d7-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="c30d7-107">Un Visual Studio 2013 [proyecto con código fuente de C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) está disponible para acompañar esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="c30d7-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>


<span data-ttu-id="c30d7-108">Este tutorial describe cómo modificar la aplicación de ejemplo Wingtip Toys para incluir la autorización del usuario, registro y el pago con PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-108">This tutorial describes how to modify the Wingtip Toys sample application to include user authorization, registration, and payment using PayPal.</span></span> <span data-ttu-id="c30d7-109">Solo los usuarios que iniciaron sesión tendrá autorización para adquirir productos.</span><span class="sxs-lookup"><span data-stu-id="c30d7-109">Only users who are logged in will have authorization to purchase products.</span></span> <span data-ttu-id="c30d7-110">Funcionalidad de registro de usuario integradas de la plantilla de proyecto de ASP.NET 4.5 Web Forms ya incluye gran parte de lo que necesita.</span><span class="sxs-lookup"><span data-stu-id="c30d7-110">The ASP.NET 4.5 Web Forms project template's built-in user registration functionality already includes much of what you need.</span></span> <span data-ttu-id="c30d7-111">Agregará funcionalidad de finalización de Express de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-111">You will add PayPal Express Checkout functionality.</span></span> <span data-ttu-id="c30d7-112">En este tutorial se usa el programador de PayPal probar el entorno, por lo que no se transferirá ningún fondos reales.</span><span class="sxs-lookup"><span data-stu-id="c30d7-112">In this tutorial you be using the PayPal developer testing environment, so no actual funds will be transferred.</span></span> <span data-ttu-id="c30d7-113">Al final del tutorial, probará la aplicación mediante la selección de productos que se va a agregar al carro de la compra, al hacer clic en el botón checkout y transferencia de datos en el sitio web de PayPal pruebas.</span><span class="sxs-lookup"><span data-stu-id="c30d7-113">At the end of the tutorial, you will test the application by selecting products to add to the shopping cart, clicking the checkout button, and transferring data to the PayPal testing web site.</span></span> <span data-ttu-id="c30d7-114">En el sitio web de la prueba PayPal se confirme su información de pago y envío y, a continuación, volver a la aplicación de ejemplo Wingtip Toys local para confirmar y completar la compra.</span><span class="sxs-lookup"><span data-stu-id="c30d7-114">On the PayPal testing web site, you will confirm your shipping and payment information and then return to the local Wingtip Toys sample application to confirm and complete the purchase.</span></span>

<span data-ttu-id="c30d7-115">Hay varios procesadores de pago de terceros con experiencia que se especializan en la compra en línea que abordan la escalabilidad y seguridad.</span><span class="sxs-lookup"><span data-stu-id="c30d7-115">There are several experienced third-party payment processors that specialize in online shopping that address scalability and security.</span></span> <span data-ttu-id="c30d7-116">Los desarrolladores de ASP.NET deben considerar las ventajas de utilizar una solución de pago de terceros antes de implementar una cesta y solución de compra.</span><span class="sxs-lookup"><span data-stu-id="c30d7-116">ASP.NET developers should consider the advantages of utilizing a third party payment solution before implementing a shopping and purchasing solution.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c30d7-117">La aplicación de ejemplo Wingtip Toys se diseñó para que se muestran los conceptos específicos de ASP.NET y las características disponibles para los desarrolladores web ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c30d7-117">The Wingtip Toys sample application was designed to shown specific ASP.NET concepts and features available to ASP.NET web developers.</span></span> <span data-ttu-id="c30d7-118">Esta aplicación de ejemplo no se optimizó para todas las circunstancias posibles con respecto a la escalabilidad y seguridad.</span><span class="sxs-lookup"><span data-stu-id="c30d7-118">This sample application was not optimized for all possible circumstances in regard to scalability and security.</span></span>


## <a name="what-youll-learn"></a><span data-ttu-id="c30d7-119">Lo que aprenderá:</span><span class="sxs-lookup"><span data-stu-id="c30d7-119">What you'll learn:</span></span>

- <span data-ttu-id="c30d7-120">Cómo restringir el acceso a páginas específicas de una carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-120">How to restrict access to specific pages in a folder.</span></span>
- <span data-ttu-id="c30d7-121">Cómo crear un carro de compra conocido de un carro de compra anónimo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-121">How to create a known shopping cart from an anonymous shopping cart.</span></span>
- <span data-ttu-id="c30d7-122">Cómo habilitar SSL para el proyecto.</span><span class="sxs-lookup"><span data-stu-id="c30d7-122">How to enable SSL for the project.</span></span>
- <span data-ttu-id="c30d7-123">Cómo agregar un proveedor de OAuth para el proyecto.</span><span class="sxs-lookup"><span data-stu-id="c30d7-123">How to add an OAuth provider to the project.</span></span>
- <span data-ttu-id="c30d7-124">Cómo usar PayPal para comprar productos usando el entorno de pruebas de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-124">How to use PayPal to purchase products using the PayPal testing environment.</span></span>
- <span data-ttu-id="c30d7-125">Cómo mostrar detalles de PayPal en un **DetailsView** control.</span><span class="sxs-lookup"><span data-stu-id="c30d7-125">How to display details from PayPal in a **DetailsView** control.</span></span>
- <span data-ttu-id="c30d7-126">Cómo actualizar la base de datos de la aplicación Wingtip Toys con información obtenida de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-126">How to update the database of the Wingtip Toys application with details obtained from PayPal.</span></span>

## <a name="adding-order-tracking"></a><span data-ttu-id="c30d7-127">Agregar seguimiento de pedidos</span><span class="sxs-lookup"><span data-stu-id="c30d7-127">Adding Order Tracking</span></span>

<span data-ttu-id="c30d7-128">En este tutorial, creará dos nuevas clases para realizar un seguimiento de los datos del pedido que ha creado un usuario.</span><span class="sxs-lookup"><span data-stu-id="c30d7-128">In this tutorial, you'll create two new classes to track data from the order a user has created.</span></span> <span data-ttu-id="c30d7-129">Las clases realizará el seguimiento de datos con respecto a la información de envío, total de compra y la confirmación de pago.</span><span class="sxs-lookup"><span data-stu-id="c30d7-129">The classes will track data regarding shipping information, purchase total, and payment confirmation.</span></span>

### <a name="add-the-order-and-orderdetail-model-classes"></a><span data-ttu-id="c30d7-130">Agregar el orden y las clases de modelo OrderDetail</span><span class="sxs-lookup"><span data-stu-id="c30d7-130">Add the Order and OrderDetail Model Classes</span></span>

<span data-ttu-id="c30d7-131">Anteriormente en esta serie de tutoriales, se ha definido el esquema para las categorías, productos, y elementos del carro de la compra mediante la creación de la `Category`, `Product`, y `CartItem` clases en el *modelos* carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-131">Earlier in this tutorial series, you defined the schema for categories, products, and shopping cart items by creating the `Category`, `Product`, and `CartItem` classes in the *Models* folder.</span></span> <span data-ttu-id="c30d7-132">Ahora agregará dos nuevas clases para definir el esquema para el pedido de producto y los detalles del pedido.</span><span class="sxs-lookup"><span data-stu-id="c30d7-132">Now you will add two new classes to define the schema for the product order and the details of the order.</span></span>

1. <span data-ttu-id="c30d7-133">En el **modelos** carpeta, agregue una nueva clase denominada *Order.cs*.</span><span class="sxs-lookup"><span data-stu-id="c30d7-133">In the **Models** folder, add a new class named *Order.cs*.</span></span>   
   <span data-ttu-id="c30d7-134">El nuevo archivo de clase se muestra en el editor.</span><span class="sxs-lookup"><span data-stu-id="c30d7-134">The new class file is displayed in the editor.</span></span>
2. <span data-ttu-id="c30d7-135">Reemplace el código predeterminado con lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-135">Replace the default code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample1.cs)]
3. <span data-ttu-id="c30d7-136">Agregar un *OrderDetail.cs* clase a la *modelos* carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-136">Add an *OrderDetail.cs* class to the *Models* folder.</span></span>
4. <span data-ttu-id="c30d7-137">Reemplace el código predeterminado con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-137">Replace the default code with the following code:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample2.cs)]

<span data-ttu-id="c30d7-138">El `Order` y `OrderDetail` clases contienen el esquema para definir la información de orden utilizada para adquirir y envío.</span><span class="sxs-lookup"><span data-stu-id="c30d7-138">The `Order` and `OrderDetail` classes contain the schema to define the order information used for purchasing and shipping.</span></span>

<span data-ttu-id="c30d7-139">Además, deberá actualizar la clase de contexto de base de datos que administra las clases de entidad y que proporciona acceso a datos en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c30d7-139">In addition, you will need to update the database context class that manages the entity classes and that provides data access to the database.</span></span> <span data-ttu-id="c30d7-140">Para ello, agregará el orden recién creado y `OrderDetail` las clases de modelo `ProductContext` clase.</span><span class="sxs-lookup"><span data-stu-id="c30d7-140">To do this, you will add the newly created Order and `OrderDetail` model classes to `ProductContext` class.</span></span>

1. <span data-ttu-id="c30d7-141">En **el Explorador de soluciones**, busque y abra el *ProductContext.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-141">In **Solution Explorer**, find and open the *ProductContext.cs* file.</span></span>
2. <span data-ttu-id="c30d7-142">Agregue el código resaltado a la *ProductContext.cs* archivo tal como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="c30d7-142">Add the highlighted code to the *ProductContext.cs* file as shown below:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample3.cs?highlight=14-15)]

<span data-ttu-id="c30d7-143">Como se mencionó anteriormente en esta serie de tutoriales, el código en el *ProductContext.cs* archivo agrega el `System.Data.Entity` espacio de nombres para que tengan acceso a toda la funcionalidad núcleo de Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="c30d7-143">As mentioned previously in this tutorial series, the code in the *ProductContext.cs* file adds the `System.Data.Entity` namespace so that you have access to all the core functionality of the Entity Framework.</span></span> <span data-ttu-id="c30d7-144">Esta funcionalidad incluye la capacidad de consultar, insertar, actualizar y eliminar datos trabajando con objetos fuertemente tipados.</span><span class="sxs-lookup"><span data-stu-id="c30d7-144">This functionality includes the capability to query, insert, update, and delete data by working with strongly typed objects.</span></span> <span data-ttu-id="c30d7-145">El código anterior en el `ProductContext` clase agrega acceso de Entity Framework recién agregada `Order` y `OrderDetail` clases.</span><span class="sxs-lookup"><span data-stu-id="c30d7-145">The above code in the `ProductContext` class adds Entity Framework access to the newly added `Order` and `OrderDetail` classes.</span></span>

## <a name="adding-checkout-access"></a><span data-ttu-id="c30d7-146">Agregar acceso de desprotección</span><span class="sxs-lookup"><span data-stu-id="c30d7-146">Adding Checkout Access</span></span>

<span data-ttu-id="c30d7-147">La aplicación de ejemplo Wingtip Toys permite a los usuarios anónimos revisar y agregar productos a un carro de la compra.</span><span class="sxs-lookup"><span data-stu-id="c30d7-147">The Wingtip Toys sample application allows anonymous users to review and add products to a shopping cart.</span></span> <span data-ttu-id="c30d7-148">Sin embargo, cuando los usuarios anónimos eligen los productos que se agregan a la cesta de compra, debe iniciar sesión en el sitio.</span><span class="sxs-lookup"><span data-stu-id="c30d7-148">However, when anonymous users choose to purchase the products they added to the shopping cart, they must log on to the site.</span></span> <span data-ttu-id="c30d7-149">Una vez que ha iniciado sesión, puede tener acceso a las páginas restringidas de la aplicación Web que controlan la desprotección y el proceso de compra.</span><span class="sxs-lookup"><span data-stu-id="c30d7-149">Once they have logged on, they can access the restricted pages of the Web application that handle the checkout and purchase process.</span></span> <span data-ttu-id="c30d7-150">Estas páginas restringidas se encuentran en el *desprotección* carpeta de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c30d7-150">These restricted pages are contained in the *Checkout* folder of the application.</span></span>

### <a name="add-a-checkout-folder-and-pages"></a><span data-ttu-id="c30d7-151">Agregue una carpeta de desprotección y páginas</span><span class="sxs-lookup"><span data-stu-id="c30d7-151">Add a Checkout Folder and Pages</span></span>

<span data-ttu-id="c30d7-152">Ahora creará el *desprotección* carpeta y las páginas que los clientes verán durante el proceso de pago.</span><span class="sxs-lookup"><span data-stu-id="c30d7-152">You will now create the *Checkout* folder and the pages in it that the customer will see during the checkout process.</span></span> <span data-ttu-id="c30d7-153">Estas páginas se actualizará más adelante en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c30d7-153">You will update these pages later in this tutorial.</span></span>

1. <span data-ttu-id="c30d7-154">Haga clic en el nombre del proyecto (**Wingtip Toys**) en **el Explorador de soluciones** y seleccione **agregar una nueva carpeta**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-154">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add a New Folder**.</span></span> 

    ![Retirada y pago con PayPal - nueva carpeta](checkout-and-payment-with-paypal/_static/image1.png)
2. <span data-ttu-id="c30d7-156">Nombre de la nueva carpeta *desprotección*.</span><span class="sxs-lookup"><span data-stu-id="c30d7-156">Name the new folder *Checkout*.</span></span>
3. <span data-ttu-id="c30d7-157">Haga clic en el *desprotección* carpeta y, a continuación, seleccione **agregar**-&gt;**nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-157">Right-click the *Checkout* folder and then select **Add**-&gt;**New Item**.</span></span> 

    ![Desprotección y el pago con PayPal: nuevo elemento](checkout-and-payment-with-paypal/_static/image2.png)
4. <span data-ttu-id="c30d7-159">Se abrirá el cuadro de diálogo **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-159">The **Add New Item** dialog box is displayed.</span></span>
5. <span data-ttu-id="c30d7-160">Seleccione el **Visual C#**  - &gt; **Web** grupo de plantillas de la izquierda.</span><span class="sxs-lookup"><span data-stu-id="c30d7-160">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="c30d7-161">A continuación, en el panel central, seleccione **formulario Web Forms con página maestra**y asígnele el nombre *CheckoutStart.aspx*.</span><span class="sxs-lookup"><span data-stu-id="c30d7-161">Then, from the middle pane, select **Web Form with Master Page**and name it *CheckoutStart.aspx*.</span></span> 

    ![Retirada y pago con PayPal - Agregar nuevo elemento de cuadro de diálogo](checkout-and-payment-with-paypal/_static/image3.png)
6. <span data-ttu-id="c30d7-163">Como antes, seleccione el *Site.Master* archivo como la página maestra.</span><span class="sxs-lookup"><span data-stu-id="c30d7-163">As before, select the *Site.Master* file as the master page.</span></span>
7. <span data-ttu-id="c30d7-164">Agregue las siguientes páginas adicionales para el *desprotección* carpeta siguiendo los mismos pasos anteriores:</span><span class="sxs-lookup"><span data-stu-id="c30d7-164">Add the following additional pages to the *Checkout* folder using the same steps above:</span></span>   

    - <span data-ttu-id="c30d7-165">CheckoutReview.aspx</span><span class="sxs-lookup"><span data-stu-id="c30d7-165">CheckoutReview.aspx</span></span>
    - <span data-ttu-id="c30d7-166">CheckoutComplete.aspx</span><span class="sxs-lookup"><span data-stu-id="c30d7-166">CheckoutComplete.aspx</span></span>
    - <span data-ttu-id="c30d7-167">CheckoutCancel.aspx</span><span class="sxs-lookup"><span data-stu-id="c30d7-167">CheckoutCancel.aspx</span></span>
    - <span data-ttu-id="c30d7-168">CheckoutError.aspx</span><span class="sxs-lookup"><span data-stu-id="c30d7-168">CheckoutError.aspx</span></span>

### <a name="add-a-webconfig-file"></a><span data-ttu-id="c30d7-169">Agregue un archivo Web.config</span><span class="sxs-lookup"><span data-stu-id="c30d7-169">Add a Web.config File</span></span>

<span data-ttu-id="c30d7-170">Al agregar una nueva *Web.config* del archivo a la *desprotección* carpeta, podrá restringir el acceso a todas las páginas contenidas en la carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-170">By adding a new *Web.config* file to the *Checkout* folder, you will be able to restrict access to all the pages contained in the folder.</span></span>

1. <span data-ttu-id="c30d7-171">Haga clic en el *desprotección* carpeta y seleccione **agregar**  - &gt; **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-171">Right-click the *Checkout* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="c30d7-172">Se abrirá el cuadro de diálogo **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-172">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="c30d7-173">Seleccione el **Visual C#**  - &gt; **Web** grupo de plantillas de la izquierda.</span><span class="sxs-lookup"><span data-stu-id="c30d7-173">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="c30d7-174">A continuación, en el panel central, seleccione **archivo de configuración Web**, acepte el nombre predeterminado de *Web.config*y, a continuación, seleccione **agregar**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-174">Then, from the middle pane, select **Web Configuration File**, accept the default name of *Web.config*, and then select **Add**.</span></span>
3. <span data-ttu-id="c30d7-175">Reemplace el contenido XML del *Web.config* archivo por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-175">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample4.xml)]
4. <span data-ttu-id="c30d7-176">Guardar el *Web.config* archivo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-176">Save the *Web.config* file.</span></span>

<span data-ttu-id="c30d7-177">El *Web.config* archivo Especifica que todos los usuarios desconocidos de la aplicación Web deben ser deniega el acceso a las páginas contenidas en el *desprotección* carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-177">The *Web.config* file specifies that all unknown users of the Web application must be denied access to the pages contained in the *Checkout* folder.</span></span> <span data-ttu-id="c30d7-178">Sin embargo, si el usuario ha registrado una cuenta y haya iniciado sesión, que será un usuario conocido y tendrá acceso a las páginas de la *desprotección* carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-178">However, if the user has registered an account and is logged on, they will be a known user and will have access to the pages in the *Checkout* folder.</span></span>

<span data-ttu-id="c30d7-179">Es importante tener en cuenta que la configuración de ASP.NET sigue una jerarquía, donde cada *Web.config* archivo aplica valores de configuración a la carpeta que se encuentra y a todos los directorios secundarios debajo de él.</span><span class="sxs-lookup"><span data-stu-id="c30d7-179">It's important to note that ASP.NET configuration follows a hierarchy, where each *Web.config* file applies configuration settings to the folder that it is in and to all of the child directories below it.</span></span>

<a id="SSLWebForms"></a>
## <a name="enable-ssl-for-the-project"></a><span data-ttu-id="c30d7-180">Habilitar SSL para el proyecto</span><span class="sxs-lookup"><span data-stu-id="c30d7-180">Enable SSL for the Project</span></span>

 <span data-ttu-id="c30d7-181">Capa de Sockets seguros (SSL) es un protocolo definido para permitir que los servidores Web y los clientes Web comunicarse de forma más segura mediante el uso de cifrado.</span><span class="sxs-lookup"><span data-stu-id="c30d7-181">Secure Sockets Layer (SSL) is a protocol defined to allow Web servers and Web clients to communicate more securely through the use of encryption.</span></span> <span data-ttu-id="c30d7-182">Cuando no se usa SSL, los datos enviados entre el cliente y el servidor está abiertos a cualquier persona con acceso físico a la red de rastreo de paquetes.</span><span class="sxs-lookup"><span data-stu-id="c30d7-182">When SSL is not used, data sent between the client and server is open to packet sniffing by anyone with physical access to the network.</span></span> <span data-ttu-id="c30d7-183">Además, varios esquemas de autenticación habituales no son seguras a través de HTTP sin formato.</span><span class="sxs-lookup"><span data-stu-id="c30d7-183">Additionally, several common authentication schemes are not secure over plain HTTP.</span></span> <span data-ttu-id="c30d7-184">En concreto, la autenticación básica y autenticación mediante formularios envían credenciales no cifradas.</span><span class="sxs-lookup"><span data-stu-id="c30d7-184">In particular, Basic authentication and forms authentication send unencrypted credentials.</span></span> <span data-ttu-id="c30d7-185">Para que sea seguro, estos esquemas de autenticación deben usar SSL.</span><span class="sxs-lookup"><span data-stu-id="c30d7-185">To be secure, these authentication schemes must use SSL.</span></span> 

1. <span data-ttu-id="c30d7-186">En **el Explorador de soluciones**, haga clic en el **WingtipToys** del proyecto, a continuación, presione **F4** para mostrar el **propiedades** ventana.</span><span class="sxs-lookup"><span data-stu-id="c30d7-186">In **Solution Explorer**, click the **WingtipToys** project, then press **F4** to display the **Properties** window.</span></span>
2. <span data-ttu-id="c30d7-187">Cambio **SSL habilitado** a `true`.</span><span class="sxs-lookup"><span data-stu-id="c30d7-187">Change **SSL Enabled** to `true`.</span></span>
3. <span data-ttu-id="c30d7-188">Copia el **dirección URL de SSL** para que pueda usar más adelante.</span><span class="sxs-lookup"><span data-stu-id="c30d7-188">Copy the **SSL URL** so you can use it later.</span></span>   
 <span data-ttu-id="c30d7-189">La dirección URL de SSL será `https://localhost:44300/` a menos que haya creado previamente los sitios Web SSL (como se muestra a continuación).</span><span class="sxs-lookup"><span data-stu-id="c30d7-189">The SSL URL will be `https://localhost:44300/` unless you've previously created SSL Web Sites (as shown below).</span></span>   
    ![Propiedades del proyecto](checkout-and-payment-with-paypal/_static/image4.png)
4. <span data-ttu-id="c30d7-191">En **el Explorador de soluciones**, haga clic en el **WingtipToys** del proyecto y haga clic en **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-191">In **Solution Explorer**, right click the **WingtipToys** project and click **Properties**.</span></span>
5. <span data-ttu-id="c30d7-192">En el panel izquierdo, haga clic en **Web**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-192">In the left tab, click **Web**.</span></span>
6. <span data-ttu-id="c30d7-193">Cambiar el **dirección Url del proyecto** para usar el **dirección URL de SSL** que guardó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c30d7-193">Change the **Project Url** to use the **SSL URL** that you saved earlier.</span></span>   
    ![Propiedades del proyecto Web](checkout-and-payment-with-paypal/_static/image5.png)
7. <span data-ttu-id="c30d7-195">Guarde la página presionando **CTRL+S**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-195">Save the page by pressing **CTRL+S**.</span></span>
8. <span data-ttu-id="c30d7-196">Presione **Ctrl+F5** para ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c30d7-196">Press **Ctrl+F5** to run the application.</span></span> <span data-ttu-id="c30d7-197">Visual Studio mostrará una opción para que pueda evitar advertencias de SSL.</span><span class="sxs-lookup"><span data-stu-id="c30d7-197">Visual Studio will display an option to allow you to avoid SSL warnings.</span></span>
9. <span data-ttu-id="c30d7-198">Haga clic en **Sí** para confiar en el certificado SSL de IIS Express y continuar.</span><span class="sxs-lookup"><span data-stu-id="c30d7-198">Click **Yes** to trust the IIS Express SSL certificate and continue.</span></span>   
    ![Detalles del certificado SSL de IIS Express](checkout-and-payment-with-paypal/_static/image6.png)  
 <span data-ttu-id="c30d7-200">Se muestra una advertencia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="c30d7-200">A Security Warning is displayed.</span></span>
10. <span data-ttu-id="c30d7-201">Haga clic en **Sí** para instalar el certificado en el host local.</span><span class="sxs-lookup"><span data-stu-id="c30d7-201">Click **Yes** to install the certificate to your localhost.</span></span>   
    ![Cuadro de diálogo de advertencia de seguridad](checkout-and-payment-with-paypal/_static/image7.png)  
 <span data-ttu-id="c30d7-203">Se mostrará la ventana del explorador.</span><span class="sxs-lookup"><span data-stu-id="c30d7-203">The browser window will be displayed.</span></span>

<span data-ttu-id="c30d7-204">Ahora puede probar fácilmente la aplicación Web localmente mediante SSL.</span><span class="sxs-lookup"><span data-stu-id="c30d7-204">You can now easily test your Web application locally using SSL.</span></span>

<a id="OAuthWebForms"></a>
## <a name="add-an-oauth-20-provider"></a><span data-ttu-id="c30d7-205">Agregar un proveedor de OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="c30d7-205">Add an OAuth 2.0 Provider</span></span>

<span data-ttu-id="c30d7-206">ASP.NET Web Forms proporciona opciones mejoradas para la pertenencia y autenticación.</span><span class="sxs-lookup"><span data-stu-id="c30d7-206">ASP.NET Web Forms provides enhanced options for membership and authentication.</span></span> <span data-ttu-id="c30d7-207">Estas mejoras incluyen OAuth.</span><span class="sxs-lookup"><span data-stu-id="c30d7-207">These enhancements include OAuth.</span></span> <span data-ttu-id="c30d7-208">OAuth es un protocolo abierto que ofrece autorización segura en un método estándar sencillo de aplicaciones web, móviles y de escritorio.</span><span class="sxs-lookup"><span data-stu-id="c30d7-208">OAuth is an open protocol that allows secure authorization in a simple and standard method from web, mobile, and desktop applications.</span></span> <span data-ttu-id="c30d7-209">La plantilla de formularios Web Forms de ASP.NET utiliza OAuth para exponer Facebook, Twitter, Google y Microsoft como proveedores de autenticación.</span><span class="sxs-lookup"><span data-stu-id="c30d7-209">The ASP.NET Web Forms template uses OAuth to expose Facebook, Twitter, Google and Microsoft as authentication providers.</span></span> <span data-ttu-id="c30d7-210">Aunque este tutorial solo utiliza Google como proveedor de autenticación, puede modificar fácilmente el código para usar cualquiera de los proveedores.</span><span class="sxs-lookup"><span data-stu-id="c30d7-210">Although this tutorial uses only Google as the authentication provider, you can easily modify the code to use any of the providers.</span></span> <span data-ttu-id="c30d7-211">Los pasos para implementar otros proveedores son muy similares a los pasos que verá en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c30d7-211">The steps to implement other providers are very similar to the steps you will see in this tutorial.</span></span>

<span data-ttu-id="c30d7-212">Además de la autenticación, el tutorial utilizará también funciones para implementar la autorización.</span><span class="sxs-lookup"><span data-stu-id="c30d7-212">In addition to authentication, the tutorial will also use roles to implement authorization.</span></span> <span data-ttu-id="c30d7-213">Solo los usuarios que agregue a la `canEdit` rol podrá cambiar los datos (crear, editar o eliminar contactos).</span><span class="sxs-lookup"><span data-stu-id="c30d7-213">Only those users you add to the `canEdit` role will be able to change data (create, edit, or delete contacts).</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c30d7-214">Las aplicaciones de Windows Live aceptan sólo una dirección URL en directo para un sitio Web en funcionamiento, por lo que no puede usar una dirección URL del sitio Web local para probar los inicios de sesión.</span><span class="sxs-lookup"><span data-stu-id="c30d7-214">Windows Live applications only accept a live URL for a working website, so you cannot use a local website URL for testing logins.</span></span>


<span data-ttu-id="c30d7-215">Los pasos siguientes, podrá agregar un proveedor de autenticación de Google.</span><span class="sxs-lookup"><span data-stu-id="c30d7-215">The following steps will allow you to add a Google authentication provider.</span></span>

1. <span data-ttu-id="c30d7-216">Abra el *aplicación\_Start\Startup.Auth.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-216">Open the *App\_Start\Startup.Auth.cs* file.</span></span>
2. <span data-ttu-id="c30d7-217">Quite los caracteres de comentario de la `app.UseGoogleAuthentication()` método para que el método aparece como sigue:</span><span class="sxs-lookup"><span data-stu-id="c30d7-217">Remove the comment characters from the `app.UseGoogleAuthentication()` method so that the method appears as follows:</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample5.cs)]
3. <span data-ttu-id="c30d7-218">Navegue hasta la [Google Developers Console](https://console.developers.google.com/).</span><span class="sxs-lookup"><span data-stu-id="c30d7-218">Navigate to the [Google Developers Console](https://console.developers.google.com/).</span></span> <span data-ttu-id="c30d7-219">También necesitará iniciar sesión con su cuenta de correo electrónico del desarrollador de Google (gmail.com).</span><span class="sxs-lookup"><span data-stu-id="c30d7-219">You will also need to sign-in with your Google developer email account (gmail.com).</span></span> <span data-ttu-id="c30d7-220">Si no tiene una cuenta de Google, seleccione el **crear una cuenta** vínculo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-220">If you do not have a Google account, select the **Create an account** link.</span></span>   
   <span data-ttu-id="c30d7-221">A continuación, verá el **Google Developers Console**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-221">Next, you'll see the **Google Developers Console**.</span></span>   
    ![Consola de desarrolladores de Google](checkout-and-payment-with-paypal/_static/image8.png)
4. <span data-ttu-id="c30d7-223">Haga clic en el **crear proyecto** botón y escriba un nombre de proyecto y el identificador (que puede usar los valores predeterminados).</span><span class="sxs-lookup"><span data-stu-id="c30d7-223">Click the **Create Project** button and enter a project name and ID (you can use the default values).</span></span> <span data-ttu-id="c30d7-224">A continuación, haga clic en el **casilla de verificación de acuerdo** y **crear** botón.</span><span class="sxs-lookup"><span data-stu-id="c30d7-224">Then, click the **agreement checkbox** and the **Create** button.</span></span>  

    ![Google: nuevo proyecto](checkout-and-payment-with-paypal/_static/image9.png)

   <span data-ttu-id="c30d7-226">En unos segundos se creará el nuevo proyecto y el explorador mostrará la nueva página de proyectos.</span><span class="sxs-lookup"><span data-stu-id="c30d7-226">In a few seconds the new project will be created and your browser will display the new projects page.</span></span>
5. <span data-ttu-id="c30d7-227">En el panel izquierdo, haga clic en **API &amp; auth**y, a continuación, haga clic en **credenciales**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-227">In the left tab, click **APIs &amp; auth**, and then click **Credentials**.</span></span>
6. <span data-ttu-id="c30d7-228">Haga clic en el **crear nuevo Id. de cliente** en **OAuth**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-228">Click the **Create New Client ID** under **OAuth**.</span></span>   
   <span data-ttu-id="c30d7-229">El **crear Id. de cliente** se mostrará el cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-229">The **Create Client ID** dialog will be displayed.</span></span>   
    ![Google - crear Id. de cliente](checkout-and-payment-with-paypal/_static/image10.png)
7. <span data-ttu-id="c30d7-231">En el **crear Id. de cliente** cuadro de diálogo, mantenga el valor predeterminado **aplicación Web** para el tipo de aplicación.</span><span class="sxs-lookup"><span data-stu-id="c30d7-231">In the **Create Client ID** dialog, keep the default **Web application** for the application type.</span></span>
8. <span data-ttu-id="c30d7-232">Establecer el **orígenes de JavaScript autorizados** a la dirección URL de SSL que usó anteriormente en este tutorial (`https://localhost:44300/` a menos que haya creado a otros proyectos SSL).</span><span class="sxs-lookup"><span data-stu-id="c30d7-232">Set the **Authorized JavaScript Origins** to the SSL URL you used earlier in this tutorial (`https://localhost:44300/` unless you've created other SSL projects).</span></span>   
   <span data-ttu-id="c30d7-233">Esta dirección URL es el origen de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c30d7-233">This URL is the origin for your application.</span></span> <span data-ttu-id="c30d7-234">Para este ejemplo, debe proporcionar solo la dirección URL de prueba de localhost.</span><span class="sxs-lookup"><span data-stu-id="c30d7-234">For this sample, you will only enter the localhost test URL.</span></span> <span data-ttu-id="c30d7-235">Sin embargo, puede especificar varias direcciones URL para tener en cuenta para localhost y producción.</span><span class="sxs-lookup"><span data-stu-id="c30d7-235">However, you can enter multiple URLs to account for localhost and production.</span></span>
9. <span data-ttu-id="c30d7-236">Establecer el **URI de redireccionamiento autorizado** al siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-236">Set the **Authorized Redirect URI** to the following:</span></span> 

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample6.html)]

   <span data-ttu-id="c30d7-237">Este valor es el URI que utiliza ASP.NET OAuth para comunicarse con el servidor de OAuth de google.</span><span class="sxs-lookup"><span data-stu-id="c30d7-237">This value is the URI that ASP.NET OAuth users to communicate with the google OAuth server.</span></span> <span data-ttu-id="c30d7-238">Recuerde que la dirección URL de SSL que usó anteriormente ( `https://localhost:44300/` a menos que haya creado a otros proyectos SSL).</span><span class="sxs-lookup"><span data-stu-id="c30d7-238">Remember the SSL URL you used above (    `https://localhost:44300/` unless you've created other SSL projects).</span></span>
10. <span data-ttu-id="c30d7-239">Haga clic en el **crear Id. de cliente** botón.</span><span class="sxs-lookup"><span data-stu-id="c30d7-239">Click the **Create Client ID** button.</span></span>
11. <span data-ttu-id="c30d7-240">En el menú izquierdo de la consola de desarrolladores de Google, haga clic en el **pantalla de consentimiento** elemento de menú, a continuación, establezca el nombre de producto y la dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="c30d7-240">On the left menu of the Google Developers Console, click the **Consent screen** menu item, then set your email address and product name.</span></span> <span data-ttu-id="c30d7-241">Cuando haya completado el formulario, haga clic en **guardar**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-241">When you have completed the form, click **Save**.</span></span>
12. <span data-ttu-id="c30d7-242">Haga clic en el **API** elemento de menú, desplácese hacia abajo y haga clic en el **desactivar** situado junto a **Google + API**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-242">Click the **APIs** menu item, scroll down and click the **off** button next to **Google+ API**.</span></span>   
    <span data-ttu-id="c30d7-243">Acepta esta opción permitirá a la API de Google +.</span><span class="sxs-lookup"><span data-stu-id="c30d7-243">Accepting this option will enable the Google+ API.</span></span>
13. <span data-ttu-id="c30d7-244">También debe actualizar el **Microsoft.Owin** versión 3.0.0 del paquete NuGet.</span><span class="sxs-lookup"><span data-stu-id="c30d7-244">You must also update the **Microsoft.Owin** NuGet package to version 3.0.0.</span></span>   
    <span data-ttu-id="c30d7-245">Desde el **herramientas** menú, seleccione **Administrador de paquetes de NuGet** y, a continuación, seleccione **administrar paquetes de NuGet para la solución**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-245">From the **Tools** menu, select **NuGet Package Manager** and then select **Manage NuGet Packages for Solution**.</span></span>  
    <span data-ttu-id="c30d7-246">Desde el **administrar paquetes de NuGet** ventana, buscar y actualizar la **Microsoft.Owin** paquete a la versión 3.0.0.</span><span class="sxs-lookup"><span data-stu-id="c30d7-246">From the **Manage NuGet Packages** window, find and update the **Microsoft.Owin** package to version 3.0.0.</span></span>
14. <span data-ttu-id="c30d7-247">En Visual Studio, actualice el `UseGoogleAuthentication` método de la *Startup.Auth.cs* página copiando y pegando el **Id. de cliente** y **secreto de cliente** al método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-247">In Visual Studio, update the `UseGoogleAuthentication` method of the *Startup.Auth.cs* page by copying and pasting the **Client ID** and **Client Secret** into the method.</span></span> <span data-ttu-id="c30d7-248">El **Id. de cliente** y **secreto de cliente** son ejemplos de valores que se muestran a continuación y no funcionará.</span><span class="sxs-lookup"><span data-stu-id="c30d7-248">The **Client ID** and **Client Secret** values shown below are samples and will not work.</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample7.cs?highlight=64-65)]
15. <span data-ttu-id="c30d7-249">Presione **CTRL+F5** para compilar y ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c30d7-249">Press **CTRL+F5** to build and run the application.</span></span> <span data-ttu-id="c30d7-250">Haga clic en el **iniciarla** vínculo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-250">Click the **Log in** link.</span></span>
16. <span data-ttu-id="c30d7-251">En **utilice otro servicio para iniciar sesión**, haga clic en **Google**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-251">Under **Use another service to log in**, click **Google**.</span></span>  
    ![Iniciar sesión](checkout-and-payment-with-paypal/_static/image11.png)
17. <span data-ttu-id="c30d7-253">Si tiene que escribir sus credenciales, se le redirigirá al sitio de google donde especificará sus credenciales.</span><span class="sxs-lookup"><span data-stu-id="c30d7-253">If you need to enter your credentials, you will be redirected to the google site where you will enter your credentials.</span></span>  
    ![Google: inicio de sesión](checkout-and-payment-with-paypal/_static/image12.png)
18. <span data-ttu-id="c30d7-255">Después de escribir sus credenciales, se le pedirá para conceder permisos a la aplicación web que acaba de crear.</span><span class="sxs-lookup"><span data-stu-id="c30d7-255">After you enter your credentials, you will be prompted to give permissions to the web application you just created.</span></span>  
    ![Cuenta de servicio de proyecto predeterminada](checkout-and-payment-with-paypal/_static/image13.png)
19. <span data-ttu-id="c30d7-257">Haga clic en **acepte**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-257">Click **Accept**.</span></span> <span data-ttu-id="c30d7-258">Se le redirigirá ahora a la **registrar** página de la **WingtipToys** aplicación donde puede registrar su cuenta de Google.</span><span class="sxs-lookup"><span data-stu-id="c30d7-258">You will now be redirected back to the **Register** page of the **WingtipToys** application where you can register your Google account.</span></span>  
    ![Registrar con su cuenta de Google](checkout-and-payment-with-paypal/_static/image14.png)
20. <span data-ttu-id="c30d7-260">Tiene la opción de cambiar el nombre de registro de correo electrónico local utilizado para la cuenta de Gmail, pero generalmente deseará mantener el alias de correo electrónico predeterminada (es decir, lo que se usó para la autenticación).</span><span class="sxs-lookup"><span data-stu-id="c30d7-260">You have the option of changing the local email registration name used for your Gmail account, but you generally want to keep the default email alias (that is, the one you used for authentication).</span></span> <span data-ttu-id="c30d7-261">Haga clic en **iniciarla** como se indicó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c30d7-261">Click **Log in** as shown above.</span></span>

### <a name="modifying-login-functionality"></a><span data-ttu-id="c30d7-262">Modificar la funcionalidad de inicio de sesión</span><span class="sxs-lookup"><span data-stu-id="c30d7-262">Modifying Login Functionality</span></span>

<span data-ttu-id="c30d7-263">Como se mencionó anteriormente en esta serie de tutoriales, gran parte de la funcionalidad de registro de usuario se ha incluido en la plantilla de formularios Web Forms de ASP.NET de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="c30d7-263">As previously mentioned in this tutorial series, much of the user registration functionality has been included in the ASP.NET Web Forms template by default.</span></span> <span data-ttu-id="c30d7-264">Ahora, modificará el valor predeterminado *Login.aspx* y *Register.aspx* páginas para llamar a la `MigrateCart` método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-264">Now you will modify the default *Login.aspx* and *Register.aspx* pages to call the `MigrateCart` method.</span></span> <span data-ttu-id="c30d7-265">El `MigrateCart` método asocia un usuario recién registrado en un carro de compra anónimo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-265">The `MigrateCart` method associates a newly logged in user with an anonymous shopping cart.</span></span> <span data-ttu-id="c30d7-266">Al asociar el usuario y carro de la compra, la aplicación de ejemplo Wingtip Toys será capaz de mantener el carro de la compra del usuario entre las visitas.</span><span class="sxs-lookup"><span data-stu-id="c30d7-266">By associating the user and shopping cart, the Wingtip Toys sample application will be able to maintain the shopping cart of the user between visits.</span></span>

1. <span data-ttu-id="c30d7-267">En **el Explorador de soluciones**, busque y abra el *cuenta* carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-267">In **Solution Explorer**, find and open the *Account* folder.</span></span>
2. <span data-ttu-id="c30d7-268">Modificar la página de código subyacente denominada *Login.aspx.cs* para incluir el código resaltado en amarillo, para que aparezca como sigue:</span><span class="sxs-lookup"><span data-stu-id="c30d7-268">Modify the code-behind page named *Login.aspx.cs* to include the code highlighted in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample8.cs?highlight=41-43)]
3. <span data-ttu-id="c30d7-269">Guardar el *Login.aspx.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-269">Save the *Login.aspx.cs* file.</span></span>

<span data-ttu-id="c30d7-270">Por ahora, puede omitir la advertencia de que no hay ninguna definición para el `MigrateCart` método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-270">For now, you can ignore the warning that there is no definition for the `MigrateCart` method.</span></span> <span data-ttu-id="c30d7-271">Va a agregar, un poco más adelante en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c30d7-271">You will be adding it a bit later in this tutorial.</span></span>

<span data-ttu-id="c30d7-272">El *Login.aspx.cs* archivo de código subyacente admite un método de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="c30d7-272">The *Login.aspx.cs* code-behind file supports a LogIn method.</span></span> <span data-ttu-id="c30d7-273">Mediante la inspección de la página Login.aspx, verá que esta página incluye un botón "Iniciar sesión" que, cuando haga clic en los desencadenadores del `LogIn` controlador en el código subyacente.</span><span class="sxs-lookup"><span data-stu-id="c30d7-273">By inspecting the Login.aspx page, you'll see that this page includes a "Log in" button that when click triggers the `LogIn` handler on the code-behind.</span></span>

<span data-ttu-id="c30d7-274">Cuando el `Login` método en el *Login.aspx.cs* se denomina una nueva instancia de la cesta denominado `usersShoppingCart` se crea.</span><span class="sxs-lookup"><span data-stu-id="c30d7-274">When the `Login` method on the *Login.aspx.cs* is called, a new instance of the shopping cart named `usersShoppingCart` is created.</span></span> <span data-ttu-id="c30d7-275">El identificador del carro de la compra (GUID) se recupera y se establece en el `cartId` variable.</span><span class="sxs-lookup"><span data-stu-id="c30d7-275">The ID of the shopping cart (a GUID) is retrieved and set to the `cartId` variable.</span></span> <span data-ttu-id="c30d7-276">A continuación, la `MigrateCart` método se llama, pasando tanto el `cartId` y el nombre del usuario ha iniciado la sesión a este método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-276">Then, the `MigrateCart` method is called, passing both the `cartId` and the name of the logged-in user to this method.</span></span> <span data-ttu-id="c30d7-277">Cuando se migra el carro de la compra, el GUID utilizado para identificar el carro de la compra anónimo se reemplaza por el nombre de usuario.</span><span class="sxs-lookup"><span data-stu-id="c30d7-277">When the shopping cart is migrated, the GUID used to identify the anonymous shopping cart is replaced with the user name.</span></span>

<span data-ttu-id="c30d7-278">Además de modificar el *Login.aspx.cs* archivo de código subyacente para migrar el carro de la compra cuando el usuario inicia sesión, también debe modificar el *archivo de código subyacente Register.aspx.cs* para migrar el carro de la compra Cuando el usuario crea una nueva cuenta y se inicia sesión.</span><span class="sxs-lookup"><span data-stu-id="c30d7-278">In addition to modifying the *Login.aspx.cs* code-behind file to migrate the shopping cart when the user logs in, you must also modify the *Register.aspx.cs code-behind file* to migrate the shopping cart when the user creates a new account and logs in.</span></span>

1. <span data-ttu-id="c30d7-279">En el *cuenta* carpeta, abra el archivo de código subyacente denominado *Register.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="c30d7-279">In the *Account* folder, open the code-behind file named *Register.aspx.cs*.</span></span>
2. <span data-ttu-id="c30d7-280">Modifique el archivo de código subyacente incluyendo el código en amarillo, para que aparezca como sigue:</span><span class="sxs-lookup"><span data-stu-id="c30d7-280">Modify the code-behind file by including the code in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample9.cs?highlight=28-32)]
3. <span data-ttu-id="c30d7-281">Guardar el *Register.aspx.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-281">Save the *Register.aspx.cs* file.</span></span> <span data-ttu-id="c30d7-282">Una vez más, pasar por alto la advertencia sobre el `MigrateCart` método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-282">Once again, ignore the warning about the `MigrateCart` method.</span></span>

<span data-ttu-id="c30d7-283">Tenga en cuenta que el código usado en el `CreateUser_Click` controlador de eventos es muy similar al código que usó en el `LogIn` método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-283">Notice that the code you used in the `CreateUser_Click` event handler is very similar to the code you used in the `LogIn` method.</span></span> <span data-ttu-id="c30d7-284">Cuando el usuario se registra o se inicia sesión en el sitio, una llamada a la `MigrateCart` método se realizará.</span><span class="sxs-lookup"><span data-stu-id="c30d7-284">When the user registers or logs in to the site, a call to the `MigrateCart` method will be made.</span></span>

## <a name="migrating-the-shopping-cart"></a><span data-ttu-id="c30d7-285">Migrar el carro de la compra</span><span class="sxs-lookup"><span data-stu-id="c30d7-285">Migrating the Shopping Cart</span></span>

<span data-ttu-id="c30d7-286">Ahora que tiene el proceso de inicio de sesión y registro actualizado, puede agregar el código para migrar el uso de carro de la compra el `MigrateCart` método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-286">Now that you have the log-in and registration process updated, you can add the code to migrate the shopping cart using the `MigrateCart` method.</span></span>

1. <span data-ttu-id="c30d7-287">En **el Explorador de soluciones**, busque el *lógica* carpeta y abra el *ShoppingCartActions.cs* archivo de clase.</span><span class="sxs-lookup"><span data-stu-id="c30d7-287">In **Solution Explorer**, find the *Logic* folder and open the *ShoppingCartActions.cs* class file.</span></span>
2. <span data-ttu-id="c30d7-288">Agregue el código resaltado en amarillo en el código existente en el *ShoppingCartActions.cs* archivo, por lo que el código en el *ShoppingCartActions.cs* archivo aparece como sigue:</span><span class="sxs-lookup"><span data-stu-id="c30d7-288">Add the code highlighted in yellow to the existing code in the *ShoppingCartActions.cs* file, so that the code in the *ShoppingCartActions.cs* file appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample10.cs?highlight=215-224)]

<span data-ttu-id="c30d7-289">El `MigrateCart` método usa el cartId existente para buscar el carro de la compra del usuario.</span><span class="sxs-lookup"><span data-stu-id="c30d7-289">The `MigrateCart` method uses the existing cartId to find the shopping cart of the user.</span></span> <span data-ttu-id="c30d7-290">A continuación, el código recorre en bucle todos los elementos del carro de la compra y reemplaza el `CartId` propiedad (según lo especificado por el `CartItem` esquema) con el nombre de usuario que inició sesión.</span><span class="sxs-lookup"><span data-stu-id="c30d7-290">Next, the code loops through all the shopping cart items and replaces the `CartId` property (as specified by the `CartItem` schema) with the logged-in user name.</span></span>

### <a name="updating-the-database-connection"></a><span data-ttu-id="c30d7-291">Actualización de la conexión de base de datos</span><span class="sxs-lookup"><span data-stu-id="c30d7-291">Updating the Database Connection</span></span>

<span data-ttu-id="c30d7-292">Si está siguiendo este tutorial utilizando la **creados previamente** Wingtip Toys aplicación de ejemplo, debe volver a crear la base de datos de pertenencia predeterminado.</span><span class="sxs-lookup"><span data-stu-id="c30d7-292">If you are following this tutorial using the **prebuilt** Wingtip Toys sample application, you must recreate the default membership database.</span></span> <span data-ttu-id="c30d7-293">Al modificar la cadena de conexión de forma predeterminada, la base de datos de pertenencia se creará la próxima vez que se ejecuta la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c30d7-293">By modifying the default connection string, the membership database will be created the next time the application runs.</span></span>

1. <span data-ttu-id="c30d7-294">Abra el *Web.config* archivo en la raíz del proyecto.</span><span class="sxs-lookup"><span data-stu-id="c30d7-294">Open the *Web.config* file at the root of the project.</span></span>
2. <span data-ttu-id="c30d7-295">Actualice la cadena de conexión predeterminado para que aparezca como sigue:</span><span class="sxs-lookup"><span data-stu-id="c30d7-295">Update the default connection string so that it appears as follows:</span></span>   

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample11.xml)]

<a id="PayPalWebForms"></a>
## <a name="integrating-paypal"></a><span data-ttu-id="c30d7-296">La integración de PayPal</span><span class="sxs-lookup"><span data-stu-id="c30d7-296">Integrating PayPal</span></span>

<span data-ttu-id="c30d7-297">PayPal es una plataforma de facturación basada en web que acepte pagos por los comercios en línea.</span><span class="sxs-lookup"><span data-stu-id="c30d7-297">PayPal is a web-based billing platform that accepts payments by online merchants.</span></span> <span data-ttu-id="c30d7-298">A continuación, en este tutorial se explica cómo integrar la funcionalidad de PayPal Express desprotección en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c30d7-298">This tutorial next explains how to integrate PayPal's Express Checkout functionality into your application.</span></span> <span data-ttu-id="c30d7-299">Desprotección Express permite a los clientes usar PayPal para pagar los elementos que se hayan agregado a su carro de la compra.</span><span class="sxs-lookup"><span data-stu-id="c30d7-299">Express Checkout allows your customers to use PayPal to pay for the items they have added to their shopping cart.</span></span>

### <a name="create-paypal-test-accounts"></a><span data-ttu-id="c30d7-300">Crear cuentas de prueba de PayPal</span><span class="sxs-lookup"><span data-stu-id="c30d7-300">Create PayPal Test Accounts</span></span>

<span data-ttu-id="c30d7-301">Para usar el entorno de pruebas de PayPal, debe crear y comprobar una cuenta de prueba para desarrolladores.</span><span class="sxs-lookup"><span data-stu-id="c30d7-301">To use the PayPal testing environment, you must create and verify a developer test account.</span></span> <span data-ttu-id="c30d7-302">Usará la cuenta de prueba para desarrolladores para crear un comprador de cuenta de prueba y una cuenta de prueba de vendedor.</span><span class="sxs-lookup"><span data-stu-id="c30d7-302">You will use the developer test account to create a buyer test account and a seller test account.</span></span> <span data-ttu-id="c30d7-303">Las credenciales de cuenta de prueba para desarrolladores también permitirá la aplicación de ejemplo Wingtip Toys tener acceso al entorno de prueba de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-303">The developer test account credentials also will allow the Wingtip Toys sample application to access the PayPal testing environment.</span></span>

1. <span data-ttu-id="c30d7-304">En un explorador, vaya a los desarrolladores de PayPal probar sitio:</span><span class="sxs-lookup"><span data-stu-id="c30d7-304">In a browser, navigate to the PayPal developer testing site:</span></span>   
    [https://developer.paypal.com](https://developer.paypal.com/)
2. <span data-ttu-id="c30d7-305">Si no tienes una cuenta de desarrollador de PayPal, cree una nueva cuenta haciendo **Sign Up**y siga los pasos de registro.</span><span class="sxs-lookup"><span data-stu-id="c30d7-305">If you don't have a PayPal developer account, create a new account by clicking **Sign Up**and following the sign up steps.</span></span> <span data-ttu-id="c30d7-306">Si tiene una cuenta de desarrollador de PayPal, inicie sesión haciendo **en el registro**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-306">If you have an existing PayPal developer account, sign in by clicking **Log In**.</span></span> <span data-ttu-id="c30d7-307">Necesitará la cuenta de desarrollador de PayPal para probar la aplicación de ejemplo Wingtip Toys más adelante en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c30d7-307">You will need your PayPal developer account to test the Wingtip Toys sample application later in this tutorial.</span></span>
3. <span data-ttu-id="c30d7-308">Si solo se ha registrado para la cuenta de desarrollador de PayPal, deberá comprobar su cuenta de desarrollador de PayPal con PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-308">If you have just signed up for your PayPal developer account, you may need to verify your PayPal developer account with PayPal.</span></span> <span data-ttu-id="c30d7-309">Puede comprobar su cuenta siguiendo los pasos que PayPal enviada a su cuenta de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="c30d7-309">You can verify your account by following the steps that PayPal sent to your email account.</span></span> <span data-ttu-id="c30d7-310">Una vez que haya comprobado la cuenta de desarrollador de PayPal, inicie sesión en el sitio de pruebas de los desarrolladores PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-310">Once you have verified your PayPal developer account, log back into the PayPal developer testing site.</span></span>
4. <span data-ttu-id="c30d7-311">Después de que ha iniciado la sesión el sitio para desarrolladores de PayPal con su cuenta de desarrollador de PayPal, deberá crear una cuenta de prueba de comprador de PayPal si no lo hace ya tiene uno.</span><span class="sxs-lookup"><span data-stu-id="c30d7-311">After you are logged in to the PayPal developer site with your PayPal developer account you need to create a PayPal buyer test account if you don't already have one.</span></span> <span data-ttu-id="c30d7-312">Para crear una cuenta de prueba de comprador en el sitio de PayPal, haga clic en el **aplicaciones** pestaña y, a continuación, haga clic en **cuentas de espacio aislado**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-312">To create a buyer test account, on the PayPal site click the **Applications** tab and then click **Sandbox accounts**.</span></span>   
 <span data-ttu-id="c30d7-313">El **cuentas de prueba de espacio aislado** se muestra la página.</span><span class="sxs-lookup"><span data-stu-id="c30d7-313">The **Sandbox test accounts** page is shown.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="c30d7-314">El sitio para desarrolladores de PayPal ya proporciona una cuenta de comerciante de prueba.</span><span class="sxs-lookup"><span data-stu-id="c30d7-314">The PayPal Developer site already provides a merchant test account.</span></span>

    ![Pago con PayPal - cuentas de prueba de espacio aislado y envío](checkout-and-payment-with-paypal/_static/image15.png)
5. <span data-ttu-id="c30d7-316">En la página de cuentas de prueba de recinto de seguridad, haga clic en **crear cuenta**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-316">On the Sandbox test accounts page, click **Create Account**.</span></span>
6. <span data-ttu-id="c30d7-317">En el **crear cuenta de prueba** página Elegir un comprador de correo electrónico de la cuenta de prueba y la contraseña de su elección.</span><span class="sxs-lookup"><span data-stu-id="c30d7-317">On the **Create test account** page choose a buyer test account email and password of your choice.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="c30d7-318">Necesitará las direcciones de correo electrónico de comprador y la contraseña para probar la aplicación de ejemplo Wingtip Toys al final de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c30d7-318">You will need the buyer email addresses and password to test the Wingtip Toys sample application at the end of this tutorial.</span></span>

    ![Pago con PayPal - cuentas de prueba de espacio aislado y envío](checkout-and-payment-with-paypal/_static/image16.png)
7. <span data-ttu-id="c30d7-320">Crear la cuenta de prueba de comprador haciendo clic en el **crear cuenta** botón.</span><span class="sxs-lookup"><span data-stu-id="c30d7-320">Create the buyer test account by clicking the **Create Account** button.</span></span>  
 <span data-ttu-id="c30d7-321">El **cuentas de prueba de espacio aislado** se muestra la página.</span><span class="sxs-lookup"><span data-stu-id="c30d7-321">The **Sandbox Test accounts** page is displayed.</span></span> 

    ![Retirada y pago con PayPal - cuentas de PayPal](checkout-and-payment-with-paypal/_static/image17.png)
8. <span data-ttu-id="c30d7-323">En el **cuentas de prueba de espacio aislado** página, haga clic en el **facilitador** cuentas de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="c30d7-323">On the **Sandbox test accounts** page, click the **facilitator** email account.</span></span>  
    <span data-ttu-id="c30d7-324">**Perfil** y **notificación** opciones que aparecen.</span><span class="sxs-lookup"><span data-stu-id="c30d7-324">**Profile** and **Notification** options appear.</span></span>
9. <span data-ttu-id="c30d7-325">Seleccione el **perfil** opción y, después, haga clic en **las credenciales de la API** para ver sus credenciales de la API para la cuenta de comerciante de prueba.</span><span class="sxs-lookup"><span data-stu-id="c30d7-325">Select the **Profile** option, then click **API credentials** to view your API credentials for the merchant test account.</span></span>
10. <span data-ttu-id="c30d7-326">Copiar las credenciales de la API de prueba en el Bloc de notas.</span><span class="sxs-lookup"><span data-stu-id="c30d7-326">Copy the TEST API credentials to notepad.</span></span>

<span data-ttu-id="c30d7-327">Necesitará las credenciales de la API clásica de prueba mostradas (Username, Password y firma) para realizar llamadas de API de la aplicación de ejemplo Wingtip Toys en el entorno de pruebas de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-327">You will need your displayed Classic TEST API credentials (Username, Password, and Signature) to make API calls from the Wingtip Toys sample application to the PayPal testing environment.</span></span> <span data-ttu-id="c30d7-328">Agregará las credenciales en el paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="c30d7-328">You will add the credentials in the next step.</span></span>

### <a name="add-paypal-class-and-api-credentials"></a><span data-ttu-id="c30d7-329">Agregar clase de PayPal y las credenciales de la API</span><span class="sxs-lookup"><span data-stu-id="c30d7-329">Add PayPal Class and API Credentials</span></span>

<span data-ttu-id="c30d7-330">Colocará la mayoría del código de PayPal en una sola clase.</span><span class="sxs-lookup"><span data-stu-id="c30d7-330">You will place the majority of the PayPal code into a single class.</span></span> <span data-ttu-id="c30d7-331">Esta clase contiene los métodos usados para comunicarse con PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-331">This class contains the methods used to communicate with PayPal.</span></span> <span data-ttu-id="c30d7-332">Además, agregará sus credenciales de PayPal a esta clase.</span><span class="sxs-lookup"><span data-stu-id="c30d7-332">Also, you will add your PayPal credentials to this class.</span></span>

1. <span data-ttu-id="c30d7-333">En la aplicación de ejemplo Wingtip Toys dentro de Visual Studio, haga clic en el **lógica** carpeta y, a continuación, seleccione **agregar**  - &gt; **nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-333">In the Wingtip Toys sample application within Visual Studio, right-click the **Logic** folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="c30d7-334">Se abrirá el cuadro de diálogo **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-334">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="c30d7-335">En **Visual C#** desde el **instalado** panel de la izquierda, seleccione **código**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-335">Under **Visual C#** from the **Installed** pane on the left, select **Code**.</span></span>
3. <span data-ttu-id="c30d7-336">En el panel central, seleccione **clase**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-336">From the middle pane, select **Class**.</span></span> <span data-ttu-id="c30d7-337">Esta nueva clase el nombre **PayPalFunctions.cs**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-337">Name this new class **PayPalFunctions.cs**.</span></span>
4. <span data-ttu-id="c30d7-338">Haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-338">Click **Add**.</span></span>  
   <span data-ttu-id="c30d7-339">El nuevo archivo de clase se muestra en el editor.</span><span class="sxs-lookup"><span data-stu-id="c30d7-339">The new class file is displayed in the editor.</span></span>
5. <span data-ttu-id="c30d7-340">Reemplace el código predeterminado con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-340">Replace the default code with the following code:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample12.cs)]
6. <span data-ttu-id="c30d7-341">Agregue las credenciales de la API de comerciante (Username, Password y firma) que se ha mostrado anteriormente en este tutorial para que puedan realizar llamadas de función en el entorno de prueba de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-341">Add the Merchant API credentials (Username, Password, and Signature) that you displayed earlier in this tutorial so that you can make function calls to the PayPal testing environment.</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample13.cs)]

> [!NOTE] 
> 
> <span data-ttu-id="c30d7-342">En esta aplicación de ejemplo simplemente va a agregar las credenciales a un archivo de C# (. cs).</span><span class="sxs-lookup"><span data-stu-id="c30d7-342">In this sample application you are simply adding credentials to a C# file (.cs).</span></span> <span data-ttu-id="c30d7-343">Sin embargo, en una solución implementada, debe considerar sus credenciales en un archivo de configuración de cifrado.</span><span class="sxs-lookup"><span data-stu-id="c30d7-343">However, in a implemented solution, you should consider encrypting your credentials in a configuration file.</span></span>


<span data-ttu-id="c30d7-344">La clase NVPAPICaller contiene la mayor parte de la funcionalidad de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-344">The NVPAPICaller class contains the majority of the PayPal functionality.</span></span> <span data-ttu-id="c30d7-345">El código de la clase proporciona los métodos necesarios para realizar una prueba de compra desde el entorno de pruebas de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-345">The code in the class provides the methods needed to make a test purchase from the PayPal testing environment.</span></span> <span data-ttu-id="c30d7-346">Las tres funciones de PayPal siguientes se utilizan para realizar compras:</span><span class="sxs-lookup"><span data-stu-id="c30d7-346">The following three PayPal functions are used to make purchases:</span></span>

- `SetExpressCheckout` <span data-ttu-id="c30d7-347">función</span><span class="sxs-lookup"><span data-stu-id="c30d7-347">function</span></span>
- `GetExpressCheckoutDetails` <span data-ttu-id="c30d7-348">función</span><span class="sxs-lookup"><span data-stu-id="c30d7-348">function</span></span>
- `DoExpressCheckoutPayment` <span data-ttu-id="c30d7-349">función</span><span class="sxs-lookup"><span data-stu-id="c30d7-349">function</span></span>

<span data-ttu-id="c30d7-350">El `ShortcutExpressCheckout` método recopila los detalles de producto y la información de compra de prueba de la cesta y llama a la `SetExpressCheckout` función PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-350">The `ShortcutExpressCheckout` method collects the test purchase information and product details from the shopping cart and calls the `SetExpressCheckout` PayPal function.</span></span> <span data-ttu-id="c30d7-351">El `GetCheckoutDetails` método confirma los detalles de la compra y llama a la `GetExpressCheckoutDetails` PayPal función antes de realizar la compra de prueba.</span><span class="sxs-lookup"><span data-stu-id="c30d7-351">The `GetCheckoutDetails` method confirms purchase details and calls the `GetExpressCheckoutDetails` PayPal function before making the test purchase.</span></span> <span data-ttu-id="c30d7-352">El `DoCheckoutPayment` método completa la compra de prueba desde el entorno de pruebas mediante una llamada a la `DoExpressCheckoutPayment` función PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-352">The `DoCheckoutPayment` method completes the test purchase from the testing environment by calling the `DoExpressCheckoutPayment` PayPal function.</span></span> <span data-ttu-id="c30d7-353">El código restante es compatible con los métodos de PayPal y proceso, como la codificación de cadenas, descodificación de cadenas, matrices de procesamiento y determinar las credenciales.</span><span class="sxs-lookup"><span data-stu-id="c30d7-353">The remaining code supports the PayPal methods and process, such as encoding strings, decoding strings, processing arrays, and determining credentials.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c30d7-354">PayPal permite incluir detalles de la compra opcional según [especificación de API de PayPal](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span><span class="sxs-lookup"><span data-stu-id="c30d7-354">PayPal allows you to include optional purchase details based on [PayPal's API specification](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span></span> <span data-ttu-id="c30d7-355">Al extender el código de la aplicación de ejemplo Wingtip Toys, puede incluir detalles de localización, descripciones de productos, impuestos, un número de servicio al cliente, así como muchos otros campos opcionales.</span><span class="sxs-lookup"><span data-stu-id="c30d7-355">By extending the code in the Wingtip Toys sample application, you can include localization details, product descriptions, tax, a customer service number, as well as many other optional fields.</span></span>


<span data-ttu-id="c30d7-356">Tenga en cuenta que las direcciones URL de retorno y cancelación que se especifican en el **ShortcutExpressCheckout** método usa un número de puerto.</span><span class="sxs-lookup"><span data-stu-id="c30d7-356">Notice that the return and cancel URLs that are specified in the **ShortcutExpressCheckout** method use a port number.</span></span>

[!code-html[Main](checkout-and-payment-with-paypal/samples/sample14.html)]

<span data-ttu-id="c30d7-357">Cuando Visual Web Developer ejecuta un proyecto web mediante SSL, normalmente se usa el puerto 44300 para el servidor web.</span><span class="sxs-lookup"><span data-stu-id="c30d7-357">When Visual Web Developer runs a web project using SSL, commonly the port 44300 is used for the web server.</span></span> <span data-ttu-id="c30d7-358">Como se indicó anteriormente, el número de puerto es 44300.</span><span class="sxs-lookup"><span data-stu-id="c30d7-358">As shown above, the port number is 44300.</span></span> <span data-ttu-id="c30d7-359">Al ejecutar la aplicación, podría ver un número de puerto diferente.</span><span class="sxs-lookup"><span data-stu-id="c30d7-359">When you run the application, you could see a different port number.</span></span> <span data-ttu-id="c30d7-360">Sus necesidades de número de puerto debe establecerse correctamente en el código para que pueda correcta ejecutan la aplicación de ejemplo Wingtip Toys al final de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c30d7-360">Your port number needs to be correctly set in the code so that you can successful run the Wingtip Toys sample application at the end of this tutorial.</span></span> <span data-ttu-id="c30d7-361">La siguiente sección de este tutorial explica cómo recuperar el número de puerto del host local y actualice la clase de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-361">The next section of this tutorial explains how to retrieve the local host port number and update the PayPal class.</span></span>

### <a name="update-the-localhost-port-number-in-the-paypal-class"></a><span data-ttu-id="c30d7-362">Actualizar el número de puerto de host local en la clase de PayPal</span><span class="sxs-lookup"><span data-stu-id="c30d7-362">Update the LocalHost Port Number in the PayPal Class</span></span>

<span data-ttu-id="c30d7-363">La aplicación de ejemplo Wingtip Toys compras de productos, vaya a la página de prueba de PayPal y volver a la instancia local de la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c30d7-363">The Wingtip Toys sample application purchases products by navigating to the PayPal testing site and returning to your local instance of the Wingtip Toys sample application.</span></span> <span data-ttu-id="c30d7-364">Para disponer de PayPal volver a la dirección URL correcta, deberá especificar el número de puerto de la ejecución localmente la aplicación en el código de PayPal mencionado anteriormente de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-364">In order to have PayPal return to the correct URL, you need to specify the port number of the locally running sample application in the PayPal code mentioned above.</span></span>

1. <span data-ttu-id="c30d7-365">Haga clic en el nombre del proyecto (**WingtipToys**) en **el Explorador de soluciones** y seleccione **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-365">Right-click the project name (**WingtipToys**) in **Solution Explorer** and select **Properties**.</span></span>
2. <span data-ttu-id="c30d7-366">En la columna izquierda, seleccione el **Web** ficha.</span><span class="sxs-lookup"><span data-stu-id="c30d7-366">In the left column, select the **Web** tab.</span></span>
3. <span data-ttu-id="c30d7-367">Recuperar el número de puerto desde el **dirección Url del proyecto** cuadro.</span><span class="sxs-lookup"><span data-stu-id="c30d7-367">Retrieve the port number from the **Project Url** box.</span></span>
4. <span data-ttu-id="c30d7-368">Si es necesario, actualice el `returnURL` y `cancelURL` en la clase de PayPal (`NVPAPICaller`) en el *PayPalFunctions.cs* archivo que se usará el número de puerto de la aplicación web:</span><span class="sxs-lookup"><span data-stu-id="c30d7-368">If needed, update the `returnURL` and `cancelURL` in the PayPal class (`NVPAPICaller`) in the *PayPalFunctions.cs* file to use the port number of your web application:</span></span>   

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample15.html?highlight=1-2)]

<span data-ttu-id="c30d7-369">Ahora el código que agregó hará coincidir el puerto esperado para la aplicación Web local.</span><span class="sxs-lookup"><span data-stu-id="c30d7-369">Now the code that you added will match the expected port for your local Web application.</span></span> <span data-ttu-id="c30d7-370">PayPal podrá volver a la dirección URL correcta en el equipo local.</span><span class="sxs-lookup"><span data-stu-id="c30d7-370">PayPal will be able to return to the correct URL on your local machine.</span></span>

### <a name="add-the-paypal-checkout-button"></a><span data-ttu-id="c30d7-371">Agregar el botón Checkout PayPal</span><span class="sxs-lookup"><span data-stu-id="c30d7-371">Add the PayPal Checkout Button</span></span>

<span data-ttu-id="c30d7-372">Ahora que las funciones principales de PayPal se agregaron a la aplicación de ejemplo, puede empezar a agregar el marcado y el código necesario para llamar a estas funciones.</span><span class="sxs-lookup"><span data-stu-id="c30d7-372">Now that the primary PayPal functions have been added to the sample application, you can begin adding the markup and code needed to call these functions.</span></span> <span data-ttu-id="c30d7-373">En primer lugar, debe agregar el botón checkout que verá el usuario en la página del carro de la compra.</span><span class="sxs-lookup"><span data-stu-id="c30d7-373">First, you must add the checkout button that the user will see on the shopping cart page.</span></span>

1. <span data-ttu-id="c30d7-374">Abra el *ShoppingCart.aspx* archivo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-374">Open the *ShoppingCart.aspx* file.</span></span>
2. <span data-ttu-id="c30d7-375">Desplácese hasta la parte inferior del archivo y busque el `<!--Checkout Placeholder -->` comentario.</span><span class="sxs-lookup"><span data-stu-id="c30d7-375">Scroll to the bottom of the file and find the `<!--Checkout Placeholder -->` comment.</span></span>
3. <span data-ttu-id="c30d7-376">Reemplace el comentario con un `ImageButton` controlar de manera que la marca de seguridad se sustituye por las siguientes:</span><span class="sxs-lookup"><span data-stu-id="c30d7-376">Replace the comment with an `ImageButton` control so that the mark up is replaced as follows:</span></span>  

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample16.aspx)]
4. <span data-ttu-id="c30d7-377">En el *ShoppingCart.aspx.cs* archivo, después el `UpdateBtn_Click` controlador de eventos cerca del final del archivo, agregue el `CheckOutBtn_Click` controlador de eventos:</span><span class="sxs-lookup"><span data-stu-id="c30d7-377">In the *ShoppingCart.aspx.cs* file, after the `UpdateBtn_Click` event handler near the end of the file, add the `CheckOutBtn_Click` event handler:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample17.cs)]
5. <span data-ttu-id="c30d7-378">También en el *ShoppingCart.aspx.cs* , agregue una referencia a la `CheckoutBtn`, de modo que el nuevo botón de imagen se hace referencia como sigue:</span><span class="sxs-lookup"><span data-stu-id="c30d7-378">Also in the *ShoppingCart.aspx.cs* file, add a reference to the `CheckoutBtn`, so that the new image button is referenced as follows:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample18.cs?highlight=18)]
6. <span data-ttu-id="c30d7-379">Guarde los cambios en ambos el *ShoppingCart.aspx* archivo y la *ShoppingCart.aspx.cs* archivo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-379">Save your changes to both the *ShoppingCart.aspx* file and the *ShoppingCart.aspx.cs* file.</span></span>
7. <span data-ttu-id="c30d7-380">En el menú, seleccione **depurar**-&gt;**WingtipToys compilar**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-380">From the menu, select **Debug**-&gt;**Build WingtipToys**.</span></span>  
   <span data-ttu-id="c30d7-381">Se volverá a generar el proyecto con la recién agregada **ImageButton** control.</span><span class="sxs-lookup"><span data-stu-id="c30d7-381">The project will be rebuilt with the newly added **ImageButton** control.</span></span>

### <a name="send-purchase-details-to-paypal"></a><span data-ttu-id="c30d7-382">Enviar detalles de la compra a PayPal</span><span class="sxs-lookup"><span data-stu-id="c30d7-382">Send Purchase Details to PayPal</span></span>

<span data-ttu-id="c30d7-383">Cuando el usuario hace clic en el **desprotección** botón en la página del carro de la compra (*ShoppingCart.aspx*), comenzará el proceso de compra.</span><span class="sxs-lookup"><span data-stu-id="c30d7-383">When the user clicks the **Checkout** button on the shopping cart page (*ShoppingCart.aspx*), they'll begin the purchase process.</span></span> <span data-ttu-id="c30d7-384">El código siguiente llama a la primera función de PayPal necesitada para comprar productos.</span><span class="sxs-lookup"><span data-stu-id="c30d7-384">The following code calls the first PayPal function needed to purchase products.</span></span>

1. <span data-ttu-id="c30d7-385">Desde el *desprotección* carpeta, abra el archivo de código subyacente denominado *CheckoutStart.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="c30d7-385">From the *Checkout* folder, open the code-behind file named *CheckoutStart.aspx.cs*.</span></span>   
   <span data-ttu-id="c30d7-386">Asegúrese de abrir el archivo de código subyacente.</span><span class="sxs-lookup"><span data-stu-id="c30d7-386">Be sure to open the code-behind file.</span></span>
2. <span data-ttu-id="c30d7-387">Reemplace el código existente por el siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-387">Replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample19.cs)]

<span data-ttu-id="c30d7-388">Cuando el usuario de la aplicación hace clic en el **desprotección** botón en la página del carro de la compra, el explorador se le remitirá a la *CheckoutStart.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="c30d7-388">When the user of the application clicks the **Checkout** button on the shopping cart page, the browser will navigate to the *CheckoutStart.aspx* page.</span></span> <span data-ttu-id="c30d7-389">Cuando el *CheckoutStart.aspx* , se carga la página el `ShortcutExpressCheckout` se llama al método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-389">When the *CheckoutStart.aspx* page loads, the `ShortcutExpressCheckout` method is called.</span></span> <span data-ttu-id="c30d7-390">En este momento, el usuario se transfiere al sitio web de prueba PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-390">At this point, the user is transferred to the PayPal testing web site.</span></span> <span data-ttu-id="c30d7-391">En el sitio de PayPal, el usuario escribe sus credenciales de PayPal, revisa los detalles de la compra, acepta el contrato de PayPal y devuelve a la aplicación de ejemplo Wingtip Toys donde el `ShortcutExpressCheckout` método se completa.</span><span class="sxs-lookup"><span data-stu-id="c30d7-391">On the PayPal site, the user enters their PayPal credentials, reviews the purchase details, accepts the PayPal agreement and returns to the Wingtip Toys sample application where the `ShortcutExpressCheckout` method completes.</span></span> <span data-ttu-id="c30d7-392">Cuando el `ShortcutExpressCheckout` método se haya completado, se le redirigirá al usuario la *CheckoutReview.aspx* página especificada en el `ShortcutExpressCheckout` método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-392">When the `ShortcutExpressCheckout` method is complete, it will redirect the user to the *CheckoutReview.aspx* page specified in the `ShortcutExpressCheckout` method.</span></span> <span data-ttu-id="c30d7-393">Esto permite al usuario revisar los detalles del pedido desde dentro de la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c30d7-393">This allows the user to review the order details from within the Wingtip Toys sample application.</span></span>

### <a name="review-order-details"></a><span data-ttu-id="c30d7-394">Revisar los detalles de pedido</span><span class="sxs-lookup"><span data-stu-id="c30d7-394">Review Order Details</span></span>

<span data-ttu-id="c30d7-395">Después de volver de PayPal, el *CheckoutReview.aspx* página de la aplicación de ejemplo Wingtip Toys muestra los detalles del pedido.</span><span class="sxs-lookup"><span data-stu-id="c30d7-395">After returning from PayPal, the *CheckoutReview.aspx* page of the Wingtip Toys sample application displays the order details.</span></span> <span data-ttu-id="c30d7-396">Esta página permite al usuario revisar los detalles del pedido antes de adquirir los productos.</span><span class="sxs-lookup"><span data-stu-id="c30d7-396">This page allows the user to review the order details before purchasing the products.</span></span> <span data-ttu-id="c30d7-397">El *CheckoutReview.aspx* página se debe crear como sigue:</span><span class="sxs-lookup"><span data-stu-id="c30d7-397">The *CheckoutReview.aspx* page must be created as follows:</span></span>

1. <span data-ttu-id="c30d7-398">En el *desprotección* carpeta, abra la página denominada *CheckoutReview.aspx*.</span><span class="sxs-lookup"><span data-stu-id="c30d7-398">In the *Checkout* folder, open the page named *CheckoutReview.aspx*.</span></span>
2. <span data-ttu-id="c30d7-399">Reemplace el marcado existente por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-399">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample20.aspx)]
3. <span data-ttu-id="c30d7-400">Abra la página de código subyacente denominada *CheckoutReview.aspx.cs* y reemplace el código existente con lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-400">Open the code-behind page named *CheckoutReview.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample21.cs)]

<span data-ttu-id="c30d7-401">El **DetailsView** control se usa para mostrar los detalles del pedido que se han devuelto de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-401">The **DetailsView** control is used to display the order details that have been returned from PayPal.</span></span> <span data-ttu-id="c30d7-402">Además, el código anterior guarda los detalles del pedido a la base de datos de Wingtip Toys como un `OrderDetail` objeto.</span><span class="sxs-lookup"><span data-stu-id="c30d7-402">Also, the above code saves the order details to the Wingtip Toys database as an `OrderDetail` object.</span></span> <span data-ttu-id="c30d7-403">Cuando el usuario hace clic en el **completar pedido** botón, se les redirigirá a la *CheckoutComplete.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="c30d7-403">When the user clicks on the **Complete Order** button, they are redirected to the *CheckoutComplete.aspx* page.</span></span>

> [!NOTE] 
> 
> **<span data-ttu-id="c30d7-404">Sugerencia</span><span class="sxs-lookup"><span data-stu-id="c30d7-404">Tip</span></span>**
> 
> <span data-ttu-id="c30d7-405">En el marcado de la *CheckoutReview.aspx* página, observe que la `<ItemStyle>` etiqueta a la que se usa para cambiar el estilo de los elementos dentro de la **DetailsView** control cerca de la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="c30d7-405">In the markup of the *CheckoutReview.aspx* page, notice that the `<ItemStyle>` tag is used to change the style of the items within the **DetailsView** control near the bottom of the page.</span></span> <span data-ttu-id="c30d7-406">Mediante la visualización de la página en **vista de diseño** (seleccionando **diseño** en la esquina inferior izquierda de Visual Studio), a continuación, seleccione el **DetailsView** control y seleccionando el  **Etiqueta inteligente** (el icono de flecha en la parte superior derecha del control), podrá ver el **DetailsView tareas**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-406">By viewing the page in **Design View** (by selecting **Design** at the lower left corner of Visual Studio), then selecting the **DetailsView** control, and selecting the **Smart Tag** (the arrow icon at the top right of the control), you will be able to see the **DetailsView Tasks**.</span></span>
> 
> ![Desprotección y el pago con PayPal: editar campos](checkout-and-payment-with-paypal/_static/image18.png)
> 
> <span data-ttu-id="c30d7-408">Seleccionando **editar campos**, **campos** aparecerá el cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-408">By selecting **Edit Fields**, the **Fields** dialog box will appear.</span></span> <span data-ttu-id="c30d7-409">En este cuadro de diálogo puede controlar fácilmente las propiedades visuales, tales como **ItemStyle**, de la **DetailsView** control.</span><span class="sxs-lookup"><span data-stu-id="c30d7-409">In this dialog box you can easily control the visual properties, such as **ItemStyle**, of the **DetailsView** control.</span></span>
> 
> ![Pago con PayPal - cuadro de diálogo campos y envío](checkout-and-payment-with-paypal/_static/image19.png)


### <a name="complete-purchase"></a><span data-ttu-id="c30d7-411">Completar la compra</span><span class="sxs-lookup"><span data-stu-id="c30d7-411">Complete Purchase</span></span>

<span data-ttu-id="c30d7-412">*CheckoutComplete.aspx* página realiza la compra de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-412">*CheckoutComplete.aspx* page makes the purchase from PayPal.</span></span> <span data-ttu-id="c30d7-413">Como se mencionó anteriormente, el usuario debe hacer clic en el **completar pedido** botón antes de la aplicación se le remitirá a la *CheckoutComplete.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="c30d7-413">As mentioned above, the user must click on the **Complete Order** button before the application will navigate to the *CheckoutComplete.aspx* page.</span></span>

1. <span data-ttu-id="c30d7-414">En el *desprotección* carpeta, abra la página denominada *CheckoutComplete.aspx*.</span><span class="sxs-lookup"><span data-stu-id="c30d7-414">In the *Checkout* folder, open the page named *CheckoutComplete.aspx*.</span></span>
2. <span data-ttu-id="c30d7-415">Reemplace el marcado existente por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-415">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample22.aspx)]
3. <span data-ttu-id="c30d7-416">Abra la página de código subyacente denominada *CheckoutComplete.aspx.cs* y reemplace el código existente con lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-416">Open the code-behind page named *CheckoutComplete.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample23.cs)]

<span data-ttu-id="c30d7-417">Cuando el *CheckoutComplete.aspx* se carga la página, el `DoCheckoutPayment` se llama al método.</span><span class="sxs-lookup"><span data-stu-id="c30d7-417">When the *CheckoutComplete.aspx* page is loaded, the `DoCheckoutPayment` method is called.</span></span> <span data-ttu-id="c30d7-418">Como se mencionó anteriormente, el `DoCheckoutPayment` método completa la compra desde el entorno de pruebas de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-418">As mentioned earlier, the `DoCheckoutPayment` method completes the purchase from the PayPal testing environment.</span></span> <span data-ttu-id="c30d7-419">Una vez completada la compra del pedido, PayPal el *CheckoutComplete.aspx* página muestra una transacción de pago `ID` al comprador.</span><span class="sxs-lookup"><span data-stu-id="c30d7-419">Once PayPal has completed the purchase of the order, the *CheckoutComplete.aspx* page displays a payment transaction `ID` to the purchaser.</span></span>

### <a name="handle-cancel-purchase"></a><span data-ttu-id="c30d7-420">Controlar Cancelar compra</span><span class="sxs-lookup"><span data-stu-id="c30d7-420">Handle Cancel Purchase</span></span>

<span data-ttu-id="c30d7-421">Si el usuario decide cancelar la compra, se dirigirá a la *CheckoutCancel.aspx* donde verá que se ha cancelado su orden de página.</span><span class="sxs-lookup"><span data-stu-id="c30d7-421">If the user decides to cancel the purchase, they will be directed to the *CheckoutCancel.aspx* page where they will see that their order has been cancelled.</span></span>

1. <span data-ttu-id="c30d7-422">Abra la página llamada *CheckoutCancel.aspx* en el *desprotección* carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-422">Open the page named *CheckoutCancel.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="c30d7-423">Reemplace el marcado existente por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-423">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample24.aspx)]

### <a name="handle-purchase-errors"></a><span data-ttu-id="c30d7-424">Controlar los errores de compra</span><span class="sxs-lookup"><span data-stu-id="c30d7-424">Handle Purchase Errors</span></span>

<span data-ttu-id="c30d7-425">Errores durante el proceso de compra se controlarán mediante la *CheckoutError.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="c30d7-425">Errors during the purchase process will be handled by the *CheckoutError.aspx* page.</span></span> <span data-ttu-id="c30d7-426">El código subyacente de la *CheckoutStart.aspx* página, el *CheckoutReview.aspx* página y el *CheckoutComplete.aspx* cada página le redireccionará a la  *CheckoutError.aspx* página si se produce un error.</span><span class="sxs-lookup"><span data-stu-id="c30d7-426">The code-behind of the *CheckoutStart.aspx* page, the *CheckoutReview.aspx* page, and the *CheckoutComplete.aspx* page will each redirect to the *CheckoutError.aspx* page if an error occurs.</span></span>

1. <span data-ttu-id="c30d7-427">Abra la página llamada *CheckoutError.aspx* en el *desprotección* carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-427">Open the page named *CheckoutError.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="c30d7-428">Reemplace el marcado existente por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c30d7-428">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample25.aspx)]

<span data-ttu-id="c30d7-429">El *CheckoutError.aspx* página se muestra con los detalles del error cuando se produce un error durante el proceso de pago.</span><span class="sxs-lookup"><span data-stu-id="c30d7-429">The *CheckoutError.aspx* page is displayed with the error details when an error occurs during the checkout process.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="c30d7-430">Ejecutar la aplicación</span><span class="sxs-lookup"><span data-stu-id="c30d7-430">Running the Application</span></span>

<span data-ttu-id="c30d7-431">Ejecute la aplicación para ver cómo comprar productos.</span><span class="sxs-lookup"><span data-stu-id="c30d7-431">Run the application to see how to purchase products.</span></span> <span data-ttu-id="c30d7-432">Tenga en cuenta que va a ejecutar en el PayPal entorno de pruebas.</span><span class="sxs-lookup"><span data-stu-id="c30d7-432">Note that you will be running in the PayPal testing environment.</span></span> <span data-ttu-id="c30d7-433">No se está intercambiando dinero real.</span><span class="sxs-lookup"><span data-stu-id="c30d7-433">No actual money is being exchanged.</span></span>

1. <span data-ttu-id="c30d7-434">Asegúrese de que todos los archivos se guardan en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c30d7-434">Make sure all your files are saved in Visual Studio.</span></span>
2. <span data-ttu-id="c30d7-435">Abra un explorador Web y vaya a [ https://developer.paypal.com ](https://developer.paypal.com/).</span><span class="sxs-lookup"><span data-stu-id="c30d7-435">Open a Web browser and navigate to [https://developer.paypal.com](https://developer.paypal.com/).</span></span>
3. <span data-ttu-id="c30d7-436">Inicie sesión con su cuenta de desarrollador de PayPal que creó anteriormente en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="c30d7-436">Login with your PayPal developer account that you created earlier in this tutorial.</span></span>  
   <span data-ttu-id="c30d7-437">Espacio aislado de desarrollador de PayPal, deberá haber iniciado sesión en [ https://developer.paypal.com ](https://developer.paypal.com/) para probar la desprotección de express.</span><span class="sxs-lookup"><span data-stu-id="c30d7-437">For PayPal's developer sandbox, you need to be logged in at [https://developer.paypal.com](https://developer.paypal.com/) to test express checkout.</span></span> <span data-ttu-id="c30d7-438">Esto solo se aplica a sandbox de PayPal las pruebas, no al entorno de producción de PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-438">This only applies to PayPal's sandbox testing, not to PayPal's live environment.</span></span>
4. <span data-ttu-id="c30d7-439">En Visual Studio, presione **F5** para ejecutar la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c30d7-439">In Visual Studio, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="c30d7-440">Una vez que vuelve a generar la base de datos, el explorador se abrirá y mostrará el *Default.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="c30d7-440">After the database rebuilds, the browser will open and show the *Default.aspx* page.</span></span>
5. <span data-ttu-id="c30d7-441">Agregar tres productos distintos al carro de la compra seleccionando la categoría de producto, por ejemplo, "Automóviles" y, a continuación, haga clic en **agregar al carro** junto a cada producto.</span><span class="sxs-lookup"><span data-stu-id="c30d7-441">Add three different products to the shopping cart by selecting the product category, such as "Cars" and then clicking **Add to Cart** next to each product.</span></span>  
   <span data-ttu-id="c30d7-442">Carro de la compra mostrará el producto que ha seleccionado.</span><span class="sxs-lookup"><span data-stu-id="c30d7-442">The shopping cart will display the product you have selected.</span></span>
6. <span data-ttu-id="c30d7-443">Haga clic en el **PayPal** botón Desproteger.</span><span class="sxs-lookup"><span data-stu-id="c30d7-443">Click the **PayPal** button to checkout.</span></span> 

    ![Carro de la desprotección y el pago con PayPal.](checkout-and-payment-with-paypal/_static/image20.png)

   <span data-ttu-id="c30d7-445">Extrayendo del repositorio es necesario que tenga una cuenta de usuario para la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c30d7-445">Checking out will require that you have a user account for the Wingtip Toys sample application.</span></span>
7. <span data-ttu-id="c30d7-446">Haga clic en el **Google** vínculo a la derecha de la página para iniciar sesión con una cuenta de correo electrónico de gmail.com existente.</span><span class="sxs-lookup"><span data-stu-id="c30d7-446">Click the **Google** link on the right of the page to log in with an existing gmail.com email account.</span></span>  
   <span data-ttu-id="c30d7-447">Si no tiene una cuenta de gmail.com, puede crear uno para realizar pruebas en [www.gmail.com](https://www.gmail.com/).</span><span class="sxs-lookup"><span data-stu-id="c30d7-447">If you do not have a gmail.com account, you can create one for testing purposes at [www.gmail.com](https://www.gmail.com/).</span></span> <span data-ttu-id="c30d7-448">También puede usar una cuenta local estándar, haga clic en "Register".</span><span class="sxs-lookup"><span data-stu-id="c30d7-448">You can also use a standard local account by clicking "Register".</span></span> 

    ![Inicie sesión desprotección y el pago con PayPal.](checkout-and-payment-with-paypal/_static/image21.png)
8. <span data-ttu-id="c30d7-450">Inicie sesión con su cuenta de gmail y la contraseña.</span><span class="sxs-lookup"><span data-stu-id="c30d7-450">Sign in with your gmail account and password.</span></span> 

    ![Retirada y pago con PayPal - inicio de sesión de Gmail](checkout-and-payment-with-paypal/_static/image22.png)
9. <span data-ttu-id="c30d7-452">Haga clic en el **iniciarla** botón registrar su cuenta de gmail con su nombre de usuario de aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c30d7-452">Click the **Log in** button to register your gmail account with your Wingtip Toys sample application user name.</span></span> 

    ![Retirada y pago con PayPal - registro de cuenta](checkout-and-payment-with-paypal/_static/image23.png)
10. <span data-ttu-id="c30d7-454">En el sitio de prueba de PayPal, agregue su **comprador** enviar por correo electrónico a la dirección y la contraseña que creó anteriormente en este tutorial, a continuación, haga clic en el **sesión** botón.</span><span class="sxs-lookup"><span data-stu-id="c30d7-454">On the PayPal test site, add your **buyer** email address and password that you created earlier in this tutorial, then click the **Log In** button.</span></span> 

    ![Retirada y pago con PayPal - inicio de sesión PayPal](checkout-and-payment-with-paypal/_static/image24.png)
11. <span data-ttu-id="c30d7-456">Aceptar la directiva de PayPal y haga clic en el **Acepto y continuar** botón.</span><span class="sxs-lookup"><span data-stu-id="c30d7-456">Agree to the PayPal policy and click the **Agree and Continue** button.</span></span>  
    <span data-ttu-id="c30d7-457">Tenga en cuenta que esta página solo muestra la primera vez que use esta cuenta PayPal.</span><span class="sxs-lookup"><span data-stu-id="c30d7-457">Note that this page is only displayed the first time you use this PayPal account.</span></span> <span data-ttu-id="c30d7-458">Nuevamente, observe que se trata de una cuenta de prueba, no se intercambia dinero real.</span><span class="sxs-lookup"><span data-stu-id="c30d7-458">Again note that this is a test account, no real money is exchanged.</span></span> 

    ![Retirada y pago con PayPal - directiva de PayPal](checkout-and-payment-with-paypal/_static/image25.png)
12. <span data-ttu-id="c30d7-460">Revise la información de pedido en la comprobación de página de revisión del entorno y haga clic en de PayPal **continuar**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-460">Review the order information on the PayPal testing environment review page and click **Continue**.</span></span> 

    ![Pago con PayPal - revise la información y envío](checkout-and-payment-with-paypal/_static/image26.png)
13. <span data-ttu-id="c30d7-462">En el *CheckoutReview.aspx* página, compruebe la cantidad del pedido y ver la dirección de envío generado.</span><span class="sxs-lookup"><span data-stu-id="c30d7-462">On the *CheckoutReview.aspx* page, verify the order amount and view the generated shipping address.</span></span> <span data-ttu-id="c30d7-463">A continuación, haga clic en el **completar pedido** botón.</span><span class="sxs-lookup"><span data-stu-id="c30d7-463">Then, click the **Complete Order** button.</span></span> 

    ![Pago con PayPal: revisión de pedidos y envío](checkout-and-payment-with-paypal/_static/image27.png)
14. <span data-ttu-id="c30d7-465">El **CheckoutComplete.aspx** página se muestra con un identificador de transacción de pago.</span><span class="sxs-lookup"><span data-stu-id="c30d7-465">The **CheckoutComplete.aspx** page is displayed with a payment transaction ID.</span></span> 

    ![Retirada y pago con PayPal - desprotección completa](checkout-and-payment-with-paypal/_static/image28.png)

<a id="ReviewDBWebForms"></a>
## <a name="reviewing-the-database"></a><span data-ttu-id="c30d7-467">Revisión de la base de datos</span><span class="sxs-lookup"><span data-stu-id="c30d7-467">Reviewing the Database</span></span>

<span data-ttu-id="c30d7-468">Al revisar los datos actualizados en la base de datos de aplicación de ejemplo Wingtip Toys después de ejecutar la aplicación, puede ver que la aplicación registrada correctamente la compra de los productos.</span><span class="sxs-lookup"><span data-stu-id="c30d7-468">By reviewing the updated data in the Wingtip Toys sample application database after running the application, you can see that the application successfully recorded the purchase of the products.</span></span>

<span data-ttu-id="c30d7-469">Puede inspeccionar los datos contenidos en el *Wingtiptoys.mdf* archivo de base de datos mediante el uso de la **Database Explorer** ventana (**Explorador de servidores** ventana de Visual Studio) al igual que anteriormente en esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="c30d7-469">You can inspect the data contained in the *Wingtiptoys.mdf* database file by using the **Database Explorer** window (**Server Explorer** window in Visual Studio) as you did earlier in this tutorial series.</span></span>

1. <span data-ttu-id="c30d7-470">Si todavía está abierto, cierre la ventana del explorador.</span><span class="sxs-lookup"><span data-stu-id="c30d7-470">Close the browser window if it is still open.</span></span>
2. <span data-ttu-id="c30d7-471">En Visual Studio, seleccione el **mostrar todos los archivos** situado en la parte superior de **el Explorador de soluciones** para que pueda expandir la **aplicación\_datos** carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-471">In Visual Studio, select the **Show All Files** icon at the top of **Solution Explorer** to allow you to expand the **App\_Data** folder.</span></span>
3. <span data-ttu-id="c30d7-472">Expanda el **aplicación\_datos** carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-472">Expand the **App\_Data** folder.</span></span>  
 <span data-ttu-id="c30d7-473">Es posible que deba seleccionar el **mostrar todos los archivos** icono de la carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-473">You may need to select the **Show All Files** icon for the folder.</span></span>
4. <span data-ttu-id="c30d7-474">Haga clic en el *Wingtiptoys.mdf* el archivo de base de datos y seleccione **abierto**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-474">Right-click the *Wingtiptoys.mdf* database file and select **Open**.</span></span>  
    <span data-ttu-id="c30d7-475">**Explorador de servidores** se muestra.</span><span class="sxs-lookup"><span data-stu-id="c30d7-475">**Server Explorer** is displayed.</span></span>
5. <span data-ttu-id="c30d7-476">Expanda el **tablas** carpeta.</span><span class="sxs-lookup"><span data-stu-id="c30d7-476">Expand the **Tables** folder.</span></span>
6. <span data-ttu-id="c30d7-477">Haga clic en el **pedidos**de tabla y seleccione **mostrar datos de tabla**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-477">Right-click the **Orders**table and select **Show Table Data**.</span></span>  
 <span data-ttu-id="c30d7-478">El **pedidos** se muestra la tabla.</span><span class="sxs-lookup"><span data-stu-id="c30d7-478">The **Orders** table is displayed.</span></span>
7. <span data-ttu-id="c30d7-479">Revise el **PaymentTransactionID** columna para confirmar transacciones correctas.</span><span class="sxs-lookup"><span data-stu-id="c30d7-479">Review the **PaymentTransactionID** column to confirm successful transactions.</span></span> 

    ![Pago con PayPal - base de datos de revisión y envío](checkout-and-payment-with-paypal/_static/image29.png)
8. <span data-ttu-id="c30d7-481">Cerrar la **pedidos** ventana de la tabla.</span><span class="sxs-lookup"><span data-stu-id="c30d7-481">Close the **Orders** table window.</span></span>
9. <span data-ttu-id="c30d7-482">En el Explorador de servidores, haga clic en el **OrderDetails** de tabla y seleccione **mostrar datos de tabla**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-482">In the Server Explorer, right-click the **OrderDetails** table and select **Show Table Data**.</span></span>
10. <span data-ttu-id="c30d7-483">Revise el `OrderId` y `Username` valores en el **OrderDetails** tabla.</span><span class="sxs-lookup"><span data-stu-id="c30d7-483">Review the `OrderId` and `Username` values in the **OrderDetails** table.</span></span> <span data-ttu-id="c30d7-484">Tenga en cuenta que estos valores coinciden con la `OrderId` y `Username` valores incluidos en el **pedidos** tabla.</span><span class="sxs-lookup"><span data-stu-id="c30d7-484">Note that these values match the `OrderId` and `Username` values included in the **Orders** table.</span></span>
11. <span data-ttu-id="c30d7-485">Cerrar la **OrderDetails** ventana de la tabla.</span><span class="sxs-lookup"><span data-stu-id="c30d7-485">Close the **OrderDetails** table window.</span></span>
12. <span data-ttu-id="c30d7-486">Haga clic en el archivo de base de datos de Wingtip Toys (*Wingtiptoys.mdf*) y seleccione **cerrar conexión**.</span><span class="sxs-lookup"><span data-stu-id="c30d7-486">Right-click the Wingtip Toys database file (*Wingtiptoys.mdf*) and select **Close Connection**.</span></span>
13. <span data-ttu-id="c30d7-487">Si no ve el **el Explorador de soluciones** ventana, haga clic en **el Explorador de soluciones** en la parte inferior de la **Explorador de servidores** ventana para mostrar el **el Explorador de soluciones**  nuevo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-487">If you do not see the **Solution Explorer** window, click **Solution Explorer** at the bottom of the **Server Explorer** window to show the **Solution Explorer** again.</span></span>

## <a name="summary"></a><span data-ttu-id="c30d7-488">Resumen</span><span class="sxs-lookup"><span data-stu-id="c30d7-488">Summary</span></span>

<span data-ttu-id="c30d7-489">En este tutorial, ha agregado order y esquemas de detalle de pedido para realizar un seguimiento de la compra de productos.</span><span class="sxs-lookup"><span data-stu-id="c30d7-489">In this tutorial you added order and order detail schemas to track the purchase of products.</span></span> <span data-ttu-id="c30d7-490">También se integra la funcionalidad de PayPal en la aplicación de ejemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c30d7-490">You also integrated PayPal functionality into the Wingtip Toys sample application.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="c30d7-491">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="c30d7-491">Additional Resources</span></span>

[<span data-ttu-id="c30d7-492">Información general sobre la configuración de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c30d7-492">ASP.NET Configuration Overview</span></span>](https://msdn.microsoft.com/library/ms178683(v=vs.100).aspx)  
[<span data-ttu-id="c30d7-493">Implementar una aplicación de formularios Web ASP.NET segura con pertenencia, OAuth y SQL Database en Azure App Service</span><span class="sxs-lookup"><span data-stu-id="c30d7-493">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="c30d7-494">Microsoft Azure - evaluación gratuita</span><span class="sxs-lookup"><span data-stu-id="c30d7-494">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

## <a name="disclaimer"></a><span data-ttu-id="c30d7-495">Declinación de responsabilidades</span><span class="sxs-lookup"><span data-stu-id="c30d7-495">Disclaimer</span></span>

<span data-ttu-id="c30d7-496">Este tutorial contiene código de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-496">This tutorial contains sample code.</span></span> <span data-ttu-id="c30d7-497">Este código de ejemplo se proporciona "tal cual" sin garantía de ningún tipo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-497">Such sample code is provided "as is" without warranty of any kind.</span></span> <span data-ttu-id="c30d7-498">En consecuencia, Microsoft no garantiza la precisión, integridad o la calidad del código de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-498">Accordingly, Microsoft does not guarantee the accuracy, integrity, or quality of the sample code.</span></span> <span data-ttu-id="c30d7-499">Usted acepta usar el código de ejemplo en su propia responsabilidad.</span><span class="sxs-lookup"><span data-stu-id="c30d7-499">You agree to use the sample code at your own risk.</span></span> <span data-ttu-id="c30d7-500">En ningún caso Microsoft será responsable para usted de ninguna manera cualquier código de ejemplo, contenido, incluyendo pero sin limitarse a algún error u omisión en cualquier código de ejemplo, contenido, o cualquier pérdida o daño de ningún tipo que se incurre por el uso del código de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="c30d7-500">Under no circumstances will Microsoft be liable to you in any way for any sample code, content, including but not limited to, any errors or omissions in any sample code, content, or any loss or damage of any kind incurred as a result of the use of any sample code.</span></span> <span data-ttu-id="c30d7-501">Por el presente documento se le notificará y quedará acepta indemnizar, guardar y almacenar frente y contra la pérdida de todo, notificaciones de pérdida, lesiones o daños de cualquier las ocasionados por incluidas, sin limitación, tipo o derivados de material que se registra, Microsoft transmitir, usar o se basan en incluir, pero no se limita a los puntos de vista expresados en él.</span><span class="sxs-lookup"><span data-stu-id="c30d7-501">You are hereby notified and do hereby agree to indemnify, save and hold Microsoft harmless from and against any and all loss, claims of loss, injury or damage of any kind including, without limitation, those occasioned by or arising from material that you post, transmit, use or rely on including, but not limited to, the views expressed therein.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c30d7-502">[Anterior](shopping-cart.md)
> [Siguiente](membership-and-administration.md)</span><span class="sxs-lookup"><span data-stu-id="c30d7-502">[Previous](shopping-cart.md)
[Next](membership-and-administration.md)</span></span>
