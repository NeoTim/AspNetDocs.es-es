---
title: Hospedaje de producción de ASP.NET Core SignalR y escalado
author: bradygaster
description: Obtenga información sobre cómo evitar el rendimiento y escalado de problemas en las aplicaciones que usan ASP.NET Core SignalR.
monikerRange: '>= aspnetcore-2.1'
ms.author: bradyg
ms.custom: mvc
ms.date: 11/28/2018
uid: signalr/scale
ms.openlocfilehash: 4ac4509acc89d0091a3757c7cfbc9981614f29ad
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/01/2019
ms.locfileid: "57037742"
---
# <a name="aspnet-core-signalr-hosting-and-scaling"></a><span data-ttu-id="56137-103">Hospedaje de ASP.NET Core SignalR y escalado</span><span class="sxs-lookup"><span data-stu-id="56137-103">ASP.NET Core SignalR hosting and scaling</span></span>

<span data-ttu-id="56137-104">Por [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), y [Tom Dykstra](https://github.com/tdykstra),</span><span class="sxs-lookup"><span data-stu-id="56137-104">By [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), and [Tom Dykstra](https://github.com/tdykstra),</span></span>

<span data-ttu-id="56137-105">En este artículo se explica de hospedaje y la escala para aplicaciones de alto tráfico que usan ASP.NET Core SignalR.</span><span class="sxs-lookup"><span data-stu-id="56137-105">This article explains hosting and scaling considerations for high-traffic apps that use ASP.NET Core SignalR.</span></span>

## <a name="tcp-connection-resources"></a><span data-ttu-id="56137-106">Recursos de la conexión TCP</span><span class="sxs-lookup"><span data-stu-id="56137-106">TCP connection resources</span></span>

<span data-ttu-id="56137-107">Se limita el número de conexiones TCP simultáneas que puede admitir un servidor web.</span><span class="sxs-lookup"><span data-stu-id="56137-107">The number of concurrent TCP connections that a web server can support is limited.</span></span> <span data-ttu-id="56137-108">Usan los clientes HTTP estándares *efímero* conexiones.</span><span class="sxs-lookup"><span data-stu-id="56137-108">Standard HTTP clients use *ephemeral* connections.</span></span> <span data-ttu-id="56137-109">Cuando el cliente pasa a estado inactivo y se vuelve a abrir más adelante, se pueden cerrar estas conexiones.</span><span class="sxs-lookup"><span data-stu-id="56137-109">These connections can be closed when the client goes idle and reopened later.</span></span> <span data-ttu-id="56137-110">Por otro lado, es una conexión SignalR *persistente*.</span><span class="sxs-lookup"><span data-stu-id="56137-110">On the other hand, a SignalR connection is *persistent*.</span></span> <span data-ttu-id="56137-111">Las conexiones de SignalR permanecen abierta, incluso cuando el cliente pasa a estado inactivo.</span><span class="sxs-lookup"><span data-stu-id="56137-111">SignalR connections stay open even when the client goes idle.</span></span> <span data-ttu-id="56137-112">En una aplicación con mucho tráfico que sirve a muchos clientes, estas conexiones persistentes pueden provocar que los servidores alcance su número máximo de conexiones.</span><span class="sxs-lookup"><span data-stu-id="56137-112">In a high-traffic app that serves many clients, these persistent connections can cause servers to hit their maximum number of connections.</span></span>

<span data-ttu-id="56137-113">Las conexiones persistentes también consumen memoria adicional, para realizar un seguimiento de cada conexión.</span><span class="sxs-lookup"><span data-stu-id="56137-113">Persistent connections also consume some additional memory, to track each connection.</span></span>

<span data-ttu-id="56137-114">Un uso intensivo de recursos relacionados con la conexión signalr puede afectar a otras aplicaciones web que se hospedan en el mismo servidor.</span><span class="sxs-lookup"><span data-stu-id="56137-114">The heavy use of connection-related resources by SignalR can affect other web apps that are hosted on the same server.</span></span> <span data-ttu-id="56137-115">Cuando SignalR se abre y contiene el último conexiones TCP disponibles, otras aplicaciones web en el mismo servidor también tienen no hay más conexiones disponibles para ellos.</span><span class="sxs-lookup"><span data-stu-id="56137-115">When SignalR opens and holds the last available TCP connections, other web apps on the same server also have no more connections available to them.</span></span>

<span data-ttu-id="56137-116">Si un servidor se ejecuta fuera de las conexiones, verá errores aleatorios de socket y errores de restablecimiento de conexión.</span><span class="sxs-lookup"><span data-stu-id="56137-116">If a server runs out of connections, you'll see random socket errors and connection reset errors.</span></span> <span data-ttu-id="56137-117">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="56137-117">For example:</span></span>

```
An attempt was made to access a socket in a way forbidden by its access permissions...
```

<span data-ttu-id="56137-118">Para evitar el uso de recursos de SignalR causando errores en otras aplicaciones web, ejecute SignalR en distintos servidores de las otras aplicaciones web.</span><span class="sxs-lookup"><span data-stu-id="56137-118">To keep SignalR resource usage from causing errors in other web apps, run SignalR on different servers than your other web apps.</span></span>

<span data-ttu-id="56137-119">Para evitar el uso de recursos de SignalR causando errores en una aplicación de SignalR, escale horizontalmente para limitar el número de conexiones de que un servidor tiene que administrar.</span><span class="sxs-lookup"><span data-stu-id="56137-119">To keep SignalR resource usage from causing errors in a SignalR app, scale out to limit the number of connections a server has to handle.</span></span>

## <a name="scale-out"></a><span data-ttu-id="56137-120">Escalar</span><span class="sxs-lookup"><span data-stu-id="56137-120">Scale out</span></span>

<span data-ttu-id="56137-121">Una aplicación que usa SignalR necesita realizar un seguimiento de todas sus conexiones, lo que crea problemas de una granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="56137-121">An app that uses SignalR needs to keep track of all its connections, which creates problems for a server farm.</span></span> <span data-ttu-id="56137-122">Agregar un servidor y obtiene nuevas conexiones que no conocen los demás servidores.</span><span class="sxs-lookup"><span data-stu-id="56137-122">Add a server, and it gets new connections that the other servers don't know about.</span></span> <span data-ttu-id="56137-123">Por ejemplo, no es consciente de las conexiones de los demás servidores SignalR en cada servidor en el diagrama siguiente.</span><span class="sxs-lookup"><span data-stu-id="56137-123">For example, SignalR on each server in the following diagram is unaware of the connections on the other servers.</span></span> <span data-ttu-id="56137-124">Cuando desea SignalR en uno de los servidores enviar un mensaje a todos los clientes, el mensaje sólo se dirige a los clientes conectados a ese servidor.</span><span class="sxs-lookup"><span data-stu-id="56137-124">When SignalR on one of the servers wants to send a message to all clients, the message only goes to the clients connected to that server.</span></span>

![El escalado sin un backplane SignalR](scale/_static/scale-no-backplane.png)

<span data-ttu-id="56137-126">Las opciones para solucionar este problema son las [Azure SignalR Service](#azure-signalr-service) y [Redis backplane](#redis-backplane).</span><span class="sxs-lookup"><span data-stu-id="56137-126">The options for solving this problem are the [Azure SignalR Service](#azure-signalr-service) and [Redis backplane](#redis-backplane).</span></span>

## <a name="azure-signalr-service"></a><span data-ttu-id="56137-127">Servicio Azure SignalR</span><span class="sxs-lookup"><span data-stu-id="56137-127">Azure SignalR Service</span></span>

<span data-ttu-id="56137-128">Azure SignalR Service es un servidor proxy en lugar de como un backplane.</span><span class="sxs-lookup"><span data-stu-id="56137-128">The Azure SignalR Service is a proxy rather than a backplane.</span></span> <span data-ttu-id="56137-129">Cada vez que un cliente inicia una conexión al servidor, se redirige el cliente para conectarse al servicio.</span><span class="sxs-lookup"><span data-stu-id="56137-129">Each time a client initiates a connection to the server, the client is redirected to connect to the service.</span></span> <span data-ttu-id="56137-130">Este proceso se ilustra en el diagrama siguiente:</span><span class="sxs-lookup"><span data-stu-id="56137-130">That process is illustrated in the following diagram:</span></span>

![Establecer una conexión a Azure SignalR Service](scale/_static/azure-signalr-service-one-connection.png)

<span data-ttu-id="56137-132">El resultado es que el servicio administra todas las conexiones de cliente, mientras que cada servidor necesita solo un pequeño número constante de las conexiones al servicio, tal como se muestra en el diagrama siguiente:</span><span class="sxs-lookup"><span data-stu-id="56137-132">The result is that the service manages all of the client connections, while each server needs only a small constant number of connections to the service, as shown in the following diagram:</span></span>

![Clientes conectados al servicio, los servidores conectados al servicio](scale/_static/azure-signalr-service-multiple-connections.png)

<span data-ttu-id="56137-134">Este enfoque de escalado tiene varias ventajas respecto a la alternativa de backplane de Redis:</span><span class="sxs-lookup"><span data-stu-id="56137-134">This approach to scale-out has several advantages over the Redis backplane alternative:</span></span>

* <span data-ttu-id="56137-135">Sesiones permanentes, también conocidas como [afinidad del cliente](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), no es necesario, porque los clientes se redirigen inmediatamente a Azure SignalR Service cuando se conectan.</span><span class="sxs-lookup"><span data-stu-id="56137-135">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is not required, because clients are immediately redirected to the Azure SignalR Service when they connect.</span></span>
* <span data-ttu-id="56137-136">Una aplicación puede escalar horizontalmente de SignalR en función del número de mensajes enviados, mientras que el servicio Azure SignalR se escala automáticamente para administrar cualquier número de conexiones.</span><span class="sxs-lookup"><span data-stu-id="56137-136">A SignalR app can scale out based on the number of messages sent, while the Azure SignalR Service automatically scales to handle any number of connections.</span></span> <span data-ttu-id="56137-137">Por ejemplo, podría haber miles de clientes, pero si solo se envían algunos mensajes por segundo, la aplicación de SignalR no tendrá que escalar horizontalmente a varios servidores para controlar las conexiones a sí mismos.</span><span class="sxs-lookup"><span data-stu-id="56137-137">For example, there could be thousands of clients, but if only a few messages per second are sent, the SignalR app won't need to scale out to multiple servers just to handle the connections themselves.</span></span>
* <span data-ttu-id="56137-138">Una aplicación de SignalR que no utilice muchos más recursos de conexión que una aplicación web sin SignalR.</span><span class="sxs-lookup"><span data-stu-id="56137-138">A SignalR app won't use significantly more connection resources than a web app without SignalR.</span></span>

<span data-ttu-id="56137-139">Por estas razones, se recomienda Azure SignalR Service para todas las aplicaciones de ASP.NET Core SignalR hospedadas en Azure, como App Service, las máquinas virtuales y contenedores.</span><span class="sxs-lookup"><span data-stu-id="56137-139">For these reasons, we recommend the Azure SignalR Service for all ASP.NET Core SignalR apps hosted on Azure, including App Service, VMs, and containers.</span></span>

<span data-ttu-id="56137-140">Para obtener más información, consulte el [documentación de Azure SignalR Service](/azure/azure-signalr/signalr-overview).</span><span class="sxs-lookup"><span data-stu-id="56137-140">For more information see the [Azure SignalR Service documentation](/azure/azure-signalr/signalr-overview).</span></span>

## <a name="redis-backplane"></a><span data-ttu-id="56137-141">Backplane de Redis</span><span class="sxs-lookup"><span data-stu-id="56137-141">Redis backplane</span></span>

<span data-ttu-id="56137-142">[Redis](https://redis.io/) es un almacén de pares clave-valor en memoria que admite un sistema de mensajería con un modelo de publicación/suscripción.</span><span class="sxs-lookup"><span data-stu-id="56137-142">[Redis](https://redis.io/) is an in-memory key-value store that supports a messaging system with a publish/subscribe model.</span></span> <span data-ttu-id="56137-143">El backplane SignalR Redis usa la característica de pub/sub para reenviar los mensajes a otros servidores.</span><span class="sxs-lookup"><span data-stu-id="56137-143">The SignalR Redis backplane uses the pub/sub feature to forward messages to other servers.</span></span> <span data-ttu-id="56137-144">Cuando un cliente realiza una conexión, la información de conexión se pasa al backplane.</span><span class="sxs-lookup"><span data-stu-id="56137-144">When a client makes a connection, the connection information is passed to the backplane.</span></span> <span data-ttu-id="56137-145">Cuando un servidor desea enviar un mensaje a todos los clientes, envía al backplane.</span><span class="sxs-lookup"><span data-stu-id="56137-145">When a server wants to send a message to all clients, it sends to the backplane.</span></span> <span data-ttu-id="56137-146">El backplane sabe conectados todos los clientes y que los servidores que están incluidas en.</span><span class="sxs-lookup"><span data-stu-id="56137-146">The backplane knows all connected clients and which servers they're on.</span></span> <span data-ttu-id="56137-147">Envía el mensaje a todos los clientes a través de sus respectivos servidores.</span><span class="sxs-lookup"><span data-stu-id="56137-147">It sends the message to all clients via their respective servers.</span></span> <span data-ttu-id="56137-148">Este proceso se ilustra en el diagrama siguiente:</span><span class="sxs-lookup"><span data-stu-id="56137-148">This process is illustrated in the following diagram:</span></span>

![Backplane, mensaje enviado desde un servidor a todos los clientes de Redis](scale/_static/redis-backplane.png)

<span data-ttu-id="56137-150">El backplane de Redis es el enfoque recomendado de escalabilidad horizontal para aplicaciones hospedadas en su propia infraestructura.</span><span class="sxs-lookup"><span data-stu-id="56137-150">The Redis backplane is the recommended scale-out approach for apps hosted on your own infrastructure.</span></span> <span data-ttu-id="56137-151">Azure SignalR Service no es una opción práctica para su uso en producción con aplicaciones locales debido a la latencia de la conexión entre su centro de datos y un centro de datos de Azure.</span><span class="sxs-lookup"><span data-stu-id="56137-151">Azure SignalR Service isn't a practical option for production use with on-premises apps due to connection latency between your data center and an Azure data center.</span></span>

<span data-ttu-id="56137-152">Las ventajas de Azure SignalR Service se ha indicado anteriormente son las desventajas de la placa de Redis:</span><span class="sxs-lookup"><span data-stu-id="56137-152">The Azure SignalR Service advantages noted earlier are disadvantages for the Redis backplane:</span></span>

* <span data-ttu-id="56137-153">Sesiones permanentes, también conocidas como [afinidad del cliente](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), es necesario.</span><span class="sxs-lookup"><span data-stu-id="56137-153">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is required.</span></span> <span data-ttu-id="56137-154">Una vez que se inicia una conexión en un servidor, la conexión debe permanecer en ese servidor.</span><span class="sxs-lookup"><span data-stu-id="56137-154">Once a connection is initiated on a server, the connection has to stay on that server.</span></span>
* <span data-ttu-id="56137-155">Una aplicación de SignalR debe escalar horizontalmente basada en el número de clientes, incluso si algunos de los mensajes se envíen.</span><span class="sxs-lookup"><span data-stu-id="56137-155">A SignalR app must scale out based on number of clients even if few messages are being sent.</span></span>
* <span data-ttu-id="56137-156">Una aplicación de SignalR usa significativamente más recursos de conexión que una aplicación web sin SignalR.</span><span class="sxs-lookup"><span data-stu-id="56137-156">A SignalR app uses significantly more connection resources than a web app without SignalR.</span></span>

## <a name="next-steps"></a><span data-ttu-id="56137-157">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="56137-157">Next steps</span></span>

<span data-ttu-id="56137-158">Para obtener más información, vea los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="56137-158">For more information, see the following resources:</span></span>

* [<span data-ttu-id="56137-159">Documentación de Azure SignalR Service</span><span class="sxs-lookup"><span data-stu-id="56137-159">Azure SignalR Service documentation</span></span>](/azure/azure-signalr/signalr-overview)
* [<span data-ttu-id="56137-160">Configurar un backplane de Redis</span><span class="sxs-lookup"><span data-stu-id="56137-160">Set up a Redis backplane</span></span>](xref:signalr/redis-backplane)
