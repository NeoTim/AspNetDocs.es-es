---
uid: web-pages/overview/security/16-adding-security-and-membership
title: Agregar seguridad y pertenencia a ASP.NET Web Pages (Razor) sitio | Microsoft Docs
author: Rick-Anderson
description: Este capítulo muestra cómo proteger su sitio Web para que algunas de las páginas solo están disponibles para las personas que inicie sesión. (También verá cómo crear páginas tha...
ms.author: riande
ms.date: 02/24/2014
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: 0be3e767a42939a3c343f6d4a730eb1d9a6b367c
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/06/2019
ms.locfileid: "65112374"
---
# <a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="307a5-104">Agregar seguridad y pertenencia a un sitio Web de ASP.NET Pages (Razor)</span><span class="sxs-lookup"><span data-stu-id="307a5-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>

<span data-ttu-id="307a5-105">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="307a5-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="307a5-106">En este artículo se explica cómo proteger un sitio Web de ASP.NET Web Pages (Razor) para que algunas de las páginas solo están disponibles para las personas que inicie sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="307a5-107">(También verá cómo crear las páginas que cualquiera puede tener acceso.)</span><span class="sxs-lookup"><span data-stu-id="307a5-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="307a5-108">**Lo que aprenderá:**</span><span class="sxs-lookup"><span data-stu-id="307a5-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="307a5-109">Cómo crear un sitio Web que tiene una página de registro y una página de inicio de sesión de manera que para algunas páginas puede limitar el acceso a solo los miembros.</span><span class="sxs-lookup"><span data-stu-id="307a5-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="307a5-110">Cómo crear páginas públicas y miembro.</span><span class="sxs-lookup"><span data-stu-id="307a5-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="307a5-111">Cómo definir los roles, que son grupos que tienen permisos de seguridad diferente en su sitio, y cómo asignar usuarios a un rol.</span><span class="sxs-lookup"><span data-stu-id="307a5-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="307a5-112">Cómo usar CAPTCHA para evitar que programas automatizados (bots) de creación de cuentas de miembro.</span><span class="sxs-lookup"><span data-stu-id="307a5-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="307a5-113">Estas son las características ASP.NET incorporadas en el artículo:</span><span class="sxs-lookup"><span data-stu-id="307a5-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="307a5-114">El WebMatrix **Starter Site** plantilla.</span><span class="sxs-lookup"><span data-stu-id="307a5-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="307a5-115">El `WebSecurity` auxiliar y `Roles` clase.</span><span class="sxs-lookup"><span data-stu-id="307a5-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="307a5-116">El `ReCaptcha` auxiliar.</span><span class="sxs-lookup"><span data-stu-id="307a5-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="307a5-117">Versiones de software que se usa en el tutorial</span><span class="sxs-lookup"><span data-stu-id="307a5-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="307a5-118">ASP.NET Web Pages (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="307a5-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="307a5-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="307a5-119">WebMatrix 3</span></span>
> - <span data-ttu-id="307a5-120">ASP.NET Web Helpers Library</span><span class="sxs-lookup"><span data-stu-id="307a5-120">ASP.NET Web Helpers Library</span></span>

<span data-ttu-id="307a5-121">Puede configurar su sitio Web para que los usuarios pueden iniciar sesión en él &#8212; es decir, para que el sitio admite *pertenencia*.</span><span class="sxs-lookup"><span data-stu-id="307a5-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="307a5-122">Esto puede ser útil por diversos motivos.</span><span class="sxs-lookup"><span data-stu-id="307a5-122">This can be useful for many reasons.</span></span> <span data-ttu-id="307a5-123">Por ejemplo, el sitio puede tener páginas que deben estar disponibles solo a los miembros.</span><span class="sxs-lookup"><span data-stu-id="307a5-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="307a5-124">En algunos casos, es posible que necesite los usuarios inicien sesión con el fin de enviar comentarios o deje un comentario.</span><span class="sxs-lookup"><span data-stu-id="307a5-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="307a5-125">Incluso si su sitio Web admite la pertenencia, los usuarios no son necesariamente necesarios para iniciar sesión antes de utilizar algunas de las páginas en el sitio.</span><span class="sxs-lookup"><span data-stu-id="307a5-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="307a5-126">Los usuarios que no ha iniciado sesión en el que se conocen como *a los usuarios anónimos*.</span><span class="sxs-lookup"><span data-stu-id="307a5-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="307a5-127">Un usuario puede registrar en su sitio Web y, a continuación, puede iniciar sesión en el sitio.</span><span class="sxs-lookup"><span data-stu-id="307a5-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="307a5-128">El sitio Web requiere un nombre de usuario (dirección de correo electrónico) y una contraseña para confirmar que los usuarios son quienes dicen ser.</span><span class="sxs-lookup"><span data-stu-id="307a5-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="307a5-129">Este proceso de inicio de sesión y confirmar la identidad de un usuario se conoce como *autenticación*.</span><span class="sxs-lookup"><span data-stu-id="307a5-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="307a5-130">Puede establecer la seguridad y pertenencia de maneras diferentes:</span><span class="sxs-lookup"><span data-stu-id="307a5-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="307a5-131">Si está usando WebMatrix, una forma sencilla consiste en crear como nuevo sitio basado en la **Starter Site** plantilla.</span><span class="sxs-lookup"><span data-stu-id="307a5-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="307a5-132">Esta plantilla ya está configurada para la seguridad y pertenencia y ya tiene una página de registro, una página de inicio de sesión y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="307a5-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="307a5-133">El sitio creado mediante la plantilla también tiene una opción para permitir que los usuarios iniciar sesión con un sitio externo, como Facebook, Google o Twitter.</span><span class="sxs-lookup"><span data-stu-id="307a5-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="307a5-134">Si desea agregar seguridad a un sitio existente, o si no desea utilizar el **Starter Site** plantilla, puede crear su propia página de registro, página de inicio de sesión y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="307a5-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="307a5-135">En este artículo se centra en la primera opción &mdash; cómo agregar seguridad mediante la **Starter Site** plantilla.</span><span class="sxs-lookup"><span data-stu-id="307a5-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="307a5-136">También proporciona información básica sobre cómo implementar su propia seguridad y, a continuación, se proporcionan vínculos para obtener más información sobre cómo hacerlo.</span><span class="sxs-lookup"><span data-stu-id="307a5-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="307a5-137">También hay información sobre cómo habilitar los inicios de sesión externos, como se describe con más detalle en otro artículo.</span><span class="sxs-lookup"><span data-stu-id="307a5-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="307a5-138">Creación de seguridad de sitio Web mediante la plantilla de sitio de inicio</span><span class="sxs-lookup"><span data-stu-id="307a5-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="307a5-139">En WebMatrix, puede usar el **Starter Site** plantilla para crear un sitio Web que contiene lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="307a5-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="307a5-140">Una base de datos que se usa para almacenar los nombres de usuario y contraseñas para los miembros.</span><span class="sxs-lookup"><span data-stu-id="307a5-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="307a5-141">Una página de registro donde pueden registrar los usuarios anónimos de (nuevos).</span><span class="sxs-lookup"><span data-stu-id="307a5-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="307a5-142">Una página de inicio de sesión y cierre de sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-142">A login and logout page.</span></span>
- <span data-ttu-id="307a5-143">Una página de restablecimiento y recuperación de contraseña.</span><span class="sxs-lookup"><span data-stu-id="307a5-143">A password recovery and reset page.</span></span>

<span data-ttu-id="307a5-144">El siguiente procedimiento describe cómo crear el sitio y configurarlo.</span><span class="sxs-lookup"><span data-stu-id="307a5-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="307a5-145">Inicie WebMatrix y en el **inicio rápido** página, seleccione **sitio desde plantilla**.</span><span class="sxs-lookup"><span data-stu-id="307a5-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="307a5-146">Seleccione el **Starter Site** plantilla y, a continuación, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="307a5-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="307a5-147">WebMatrix crea un nuevo sitio.</span><span class="sxs-lookup"><span data-stu-id="307a5-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="307a5-148">En el panel izquierdo, haga clic en el **archivos** selector de área de trabajo.</span><span class="sxs-lookup"><span data-stu-id="307a5-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="307a5-149">En la carpeta raíz de su sitio Web, abra el  *\_AppStart.cshtml* archivo, que es un archivo especial que se usa para contener la configuración global.</span><span class="sxs-lookup"><span data-stu-id="307a5-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="307a5-150">Contiene algunas instrucciones que están comentadas utilizando el `//` caracteres:</span><span class="sxs-lookup"><span data-stu-id="307a5-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="307a5-151">Estas instrucciones se configuración el `WebMail` auxiliar, que se puede usar para enviar correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="307a5-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="307a5-152">El sistema de pertenencia puede utilizar el correo electrónico para enviar mensajes de confirmación cuando los usuarios registrar o cuando desee cambiar sus contraseñas.</span><span class="sxs-lookup"><span data-stu-id="307a5-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="307a5-153">(Por ejemplo, una vez que los usuarios registrar, reciben un correo electrónico que incluye un vínculo que puede hacer clic con el fin de finalizar el proceso de registro.)</span><span class="sxs-lookup"><span data-stu-id="307a5-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="307a5-154">Envío de correo electrónico requiere acceso a un servidor SMTP, como se describe en [agregando un correo electrónico a un sitio de ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202899).</span><span class="sxs-lookup"><span data-stu-id="307a5-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="307a5-155">Va a almacenar la configuración de correo electrónico en este central  *\_AppStart.cshtml* archivo para que no tiene que escriba el código varias veces en cada página que puede enviar correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="307a5-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="307a5-156">(No es necesario configurar SMTP para configurar una base de datos de registro; sólo necesita una configuración de SMTP si desea validar a los usuarios de sus alias de correo electrónico y permitir que los usuarios restablecer una contraseña olvidada).</span><span class="sxs-lookup"><span data-stu-id="307a5-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="307a5-157">Quite las instrucciones quitando `//` delante de cada uno de ellos.</span><span class="sxs-lookup"><span data-stu-id="307a5-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="307a5-158">Si no desea configurar correo electrónico de confirmación, puede omitir este paso y el paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="307a5-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="307a5-159">Si no se establecen los valores de SMTP, la nueva cuenta está inmediatamente disponible sin un correo electrónico de confirmación.</span><span class="sxs-lookup"><span data-stu-id="307a5-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="307a5-160">Modifique la siguiente configuración de correo electrónico en el código:</span><span class="sxs-lookup"><span data-stu-id="307a5-160">Modify the following email-related settings in the code:</span></span>

   - <span data-ttu-id="307a5-161">Establecer `WebMail.SmtpServer` en el nombre del servidor SMTP que tienen acceso a.</span><span class="sxs-lookup"><span data-stu-id="307a5-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
   - <span data-ttu-id="307a5-162">Deje `WebMail.EnableSsl` establecido en `true`.</span><span class="sxs-lookup"><span data-stu-id="307a5-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="307a5-163">Esta configuración protege las credenciales que se envían al servidor SMTP mediante su cifrado.</span><span class="sxs-lookup"><span data-stu-id="307a5-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
   - <span data-ttu-id="307a5-164">Establecer `WebMail.UserName` al nombre de usuario de la cuenta del servidor SMTP.</span><span class="sxs-lookup"><span data-stu-id="307a5-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
   - <span data-ttu-id="307a5-165">Establecer `WebMail.Password` a la contraseña de la cuenta del servidor SMTP.</span><span class="sxs-lookup"><span data-stu-id="307a5-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
   - <span data-ttu-id="307a5-166">Establecer `WebMail.From` a su propia dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="307a5-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="307a5-167">Se trata de la dirección de correo electrónico que se envía el mensaje desde.</span><span class="sxs-lookup"><span data-stu-id="307a5-167">This is the email address that the message is sent from.</span></span>

     > [!NOTE] 
     > 
     > <span data-ttu-id="307a5-168">**Sugerencia** para obtener más información sobre los valores de estas propiedades, vea [configuración de correo electrónico](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) en [personalizar el comportamiento de todo el sitio para ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span><span class="sxs-lookup"><span data-stu-id="307a5-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="307a5-169">Guarde y cierre  *\_AppStart.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="307a5-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="307a5-170">Ejecute el *Default.cshtml* página en un explorador.</span><span class="sxs-lookup"><span data-stu-id="307a5-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![security-membership-2](16-adding-security-and-membership/_static/image1.png)

   > [!NOTE]
   > <span data-ttu-id="307a5-172">Si ve un error que indica que una propiedad debe ser una instancia de `ExtendedMembershipProvider`, el sitio podría no estar configurado para usar el sistema de pertenencia de ASP.NET Web Pages (SimpleMembership).</span><span class="sxs-lookup"><span data-stu-id="307a5-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="307a5-173">A veces esto puede ocurrir si el servidor de un proveedor de hospedaje está configurado de forma diferente a su servidor local.</span><span class="sxs-lookup"><span data-stu-id="307a5-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="307a5-174">Para solucionar este problema, agregue el siguiente elemento a la carpeta del sitio *Web.config* archivo:</span><span class="sxs-lookup"><span data-stu-id="307a5-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
   > 
   > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
   > 
   > <span data-ttu-id="307a5-175">Agregue este elemento como elemento secundario de la `<configuration>` elemento y del mismo nivel que el `<system.web>` elemento.</span><span class="sxs-lookup"><span data-stu-id="307a5-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="307a5-176">En la esquina superior derecha de la página, haga clic en el **registrar** vínculo.</span><span class="sxs-lookup"><span data-stu-id="307a5-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="307a5-177">El *Register.cshtml* se muestra la página.</span><span class="sxs-lookup"><span data-stu-id="307a5-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="307a5-178">Escriba un nombre de usuario y contraseña y, a continuación, haga clic en **registrar**.</span><span class="sxs-lookup"><span data-stu-id="307a5-178">Enter a user name and password and then click **Register**.</span></span>

    ![security-membership-3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="307a5-180">Al crear el sitio Web desde el **Starter Site** plantilla, una base de datos denominada *StarterSite.sdf* se creó en el sitio *aplicación\_datos* carpeta.</span><span class="sxs-lookup"><span data-stu-id="307a5-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="307a5-181">Durante el registro, la información de usuario se agrega a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="307a5-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="307a5-182">Si establece los valores de SMTP, se envía un mensaje a la dirección de correo electrónico que usó para finalizar el registro.</span><span class="sxs-lookup"><span data-stu-id="307a5-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![security-membership-4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="307a5-184">Vaya a su programa de correo electrónico y busque el mensaje, que tendrá el código de confirmación y un hipervínculo al sitio.</span><span class="sxs-lookup"><span data-stu-id="307a5-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="307a5-185">Haga clic en el hipervínculo para activar su cuenta.</span><span class="sxs-lookup"><span data-stu-id="307a5-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="307a5-186">El hipervínculo de confirmación, abre una página de confirmación de registro.</span><span class="sxs-lookup"><span data-stu-id="307a5-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![security-membership-5](16-adding-security-and-membership/_static/image4.png)
13. <span data-ttu-id="307a5-188">Haga clic en el **inicio de sesión** vincular y, a continuación, inicie sesión con la cuenta que se ha registrado.</span><span class="sxs-lookup"><span data-stu-id="307a5-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

      <span data-ttu-id="307a5-189">Después de iniciar sesión, el **inicio de sesión** y **registrar** vínculos se reemplazan por un **Logout** vínculo.</span><span class="sxs-lookup"><span data-stu-id="307a5-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="307a5-190">El nombre de inicio de sesión se muestra como un vínculo.</span><span class="sxs-lookup"><span data-stu-id="307a5-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="307a5-191">(El vínculo le permite ir a una página donde puede cambiar la contraseña.)</span><span class="sxs-lookup"><span data-stu-id="307a5-191">(The link lets you go to a page where you can change your password.)</span></span>

      ![security-membership-6](16-adding-security-and-membership/_static/image5.png)

      > [!NOTE]
      > <span data-ttu-id="307a5-193">De forma predeterminada, las páginas web ASP.NET enviar credenciales al servidor en texto no cifrado (como texto legible).</span><span class="sxs-lookup"><span data-stu-id="307a5-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="307a5-194">Un sitio de producción debe utilizar HTTP seguro (https://, también se conoce como el *capa de sockets seguros* o SSL) para cifrar información confidencial que se intercambia con el servidor.</span><span class="sxs-lookup"><span data-stu-id="307a5-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="307a5-195">Puede que correo electrónico requiere los mensajes se envíen mediante SSL estableciendo `WebMail.EnableSsl=true` del ejemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="307a5-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="307a5-196">Para obtener más información acerca de SSL, consulte [asegurar las comunicaciones Web: Certificados SSL y https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span><span class="sxs-lookup"><span data-stu-id="307a5-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="307a5-197">Funcionalidad de pertenencia adicionales en el sitio</span><span class="sxs-lookup"><span data-stu-id="307a5-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="307a5-198">El sitio contiene otra funcionalidad que permite a los usuarios administrar sus cuentas.</span><span class="sxs-lookup"><span data-stu-id="307a5-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="307a5-199">Los usuarios pueden hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="307a5-199">Users can do the following:</span></span>

- <span data-ttu-id="307a5-200">Cambiar sus contraseñas.</span><span class="sxs-lookup"><span data-stu-id="307a5-200">Change their passwords.</span></span> <span data-ttu-id="307a5-201">Después de iniciar sesión, pueden hacer clic en el nombre de usuario (que es un vínculo).</span><span class="sxs-lookup"><span data-stu-id="307a5-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="307a5-202">Esto lleva a una página donde puede crear una nueva contraseña (*Account/ChangePassword.cshtml*).</span><span class="sxs-lookup"><span data-stu-id="307a5-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="307a5-203">Recuperar una contraseña olvidada.</span><span class="sxs-lookup"><span data-stu-id="307a5-203">Recover a forgotten password.</span></span> <span data-ttu-id="307a5-204">En la página de inicio de sesión, hay un vínculo (**¿olvidó su contraseña?**) que lleva a los usuarios a una página (*Account/ForgotPassword.cshtml*) donde puede escribir una dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="307a5-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="307a5-205">El sitio envía un mensaje de correo electrónico que tiene un vínculo que puede hacer clic con el fin de establecer una contraseña nueva (*Account/PasswordReset.cshtml*).</span><span class="sxs-lookup"><span data-stu-id="307a5-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="307a5-206">También puede permitir que los usuarios también pueden inicien sesión mediante un sitio externo, como se explica más adelante.</span><span class="sxs-lookup"><span data-stu-id="307a5-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="307a5-207">Creación de una página solo para miembros</span><span class="sxs-lookup"><span data-stu-id="307a5-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="307a5-208">Por el momento, cualquier persona puede ir a cualquier página en su sitio Web.</span><span class="sxs-lookup"><span data-stu-id="307a5-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="307a5-209">Pero puede ser conveniente tener páginas que están disponibles solo para las personas que han iniciado sesión (es decir, a los miembros).</span><span class="sxs-lookup"><span data-stu-id="307a5-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="307a5-210">ASP.NET permite crear páginas que se pueden acceder únicamente por miembros que ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="307a5-211">Normalmente, si los usuarios anónimos intentan tener acceso a una página solo para miembros, se redirige a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="307a5-212">En este procedimiento, creará una carpeta que contendrá las páginas que solo están disponibles para los usuarios conectados.</span><span class="sxs-lookup"><span data-stu-id="307a5-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="307a5-213">En la raíz del sitio, cree una nueva carpeta.</span><span class="sxs-lookup"><span data-stu-id="307a5-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="307a5-214">(En la cinta de opciones, haga clic en la flecha situada debajo de **New** y, a continuación, elija **nueva carpeta**.)</span><span class="sxs-lookup"><span data-stu-id="307a5-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="307a5-215">Nombre de la nueva carpeta *miembros*.</span><span class="sxs-lookup"><span data-stu-id="307a5-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="307a5-216">Dentro de la *miembros* carpeta, cree una nueva página y lo ha denominado *MembersInformation.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="307a5-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="307a5-217">Reemplace el contenido existente por el código y el marcado siguiente:</span><span class="sxs-lookup"><span data-stu-id="307a5-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="307a5-218">Este código comprueba la `IsAuthenticated` propiedad de la `WebSecurity` object, que devuelve `true` si el usuario ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="307a5-219">Si el usuario no ha iniciado sesión, el código llama a `Response.Redirect` para enviar al usuario el *Login.cshtml* página en el *cuenta* carpeta.</span><span class="sxs-lookup"><span data-stu-id="307a5-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="307a5-220">La dirección URL de la redirección incluye un `returnUrl` consultar el valor de cadena que utiliza `Request.Url.LocalPath` para establecer la ruta de acceso de la página actual.</span><span class="sxs-lookup"><span data-stu-id="307a5-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="307a5-221">Si establece la `returnUrl` valor en la cadena de consulta similar al siguiente (y si la dirección URL de retorno es una ruta de acceso local), la página de inicio de sesión devolverá los usuarios a esta página después de iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="307a5-222">El código también establece  *\_SiteLayout.cshtml* página como su página de diseño.</span><span class="sxs-lookup"><span data-stu-id="307a5-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="307a5-223">(Para obtener más información acerca de las páginas de diseño, vea [crear un diseño coherente en sitios de ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202891).)</span><span class="sxs-lookup"><span data-stu-id="307a5-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="307a5-224">Ejecute el sitio Web.</span><span class="sxs-lookup"><span data-stu-id="307a5-224">Run the site.</span></span> <span data-ttu-id="307a5-225">Si ha iniciado todavía, haga clic en el **Logout** situado en la parte superior de la página.</span><span class="sxs-lookup"><span data-stu-id="307a5-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="307a5-226">En el explorador, solicite la página */miembros/MembersInformation*.</span><span class="sxs-lookup"><span data-stu-id="307a5-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="307a5-227">Por ejemplo, la dirección URL podría ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="307a5-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="307a5-228">(El número de puerto (38366) probablemente será diferente en la dirección URL.)</span><span class="sxs-lookup"><span data-stu-id="307a5-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="307a5-229">Se le redirigirá a la *Login.cshtml* página, porque no se inició sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
7. <span data-ttu-id="307a5-230">Inicie sesión con la cuenta que creó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="307a5-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="307a5-231">Se le redirigirá a la *MembersInformation* página.</span><span class="sxs-lookup"><span data-stu-id="307a5-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="307a5-232">Dado que ha iniciado sesión, este tiempo verá el contenido de página.</span><span class="sxs-lookup"><span data-stu-id="307a5-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="307a5-233">Para proteger el acceso a varias páginas, puede hacer esto:</span><span class="sxs-lookup"><span data-stu-id="307a5-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="307a5-234">Agregar la comprobación de seguridad en cada página.</span><span class="sxs-lookup"><span data-stu-id="307a5-234">Add the security check to each page.</span></span>
- <span data-ttu-id="307a5-235">Crear un  *\_PageStart.cshtml* página en la carpeta donde tenga las páginas protegidas y agregar la comprobación de seguridad no existe.</span><span class="sxs-lookup"><span data-stu-id="307a5-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="307a5-236">El  *\_PageStart.cshtml* página actúa como un tipo de página global para todas las páginas en la carpeta.</span><span class="sxs-lookup"><span data-stu-id="307a5-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="307a5-237">Esta técnica se explica con más detalle en [personalizar el comportamiento de todo el sitio para ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span><span class="sxs-lookup"><span data-stu-id="307a5-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="307a5-238">Creación de seguridad para grupos de usuarios (funciones)</span><span class="sxs-lookup"><span data-stu-id="307a5-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="307a5-239">Si el sitio tiene muchos miembros, no es eficaz para comprobar los permisos para cada usuario individualmente antes de permitirles ver una página.</span><span class="sxs-lookup"><span data-stu-id="307a5-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="307a5-240">En su lugar, lo que puede hacer es crear grupos, o *roles*, que pertenecen los miembros individuales.</span><span class="sxs-lookup"><span data-stu-id="307a5-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="307a5-241">A continuación, puede comprobar los permisos basados en rol.</span><span class="sxs-lookup"><span data-stu-id="307a5-241">You can then check permissions based on role.</span></span> <span data-ttu-id="307a5-242">En esta sección, creará un &quot;admin&quot; rol y, a continuación, cree una página que se puede acceder a los usuarios que están en (que pertenecen a) ese rol.</span><span class="sxs-lookup"><span data-stu-id="307a5-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="307a5-243">El sistema de pertenencia ASP.NET está configurado para admitir roles.</span><span class="sxs-lookup"><span data-stu-id="307a5-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="307a5-244">Sin embargo, a diferencia de registro de pertenencia y el inicio de sesión, el **Starter Site** plantilla no contiene páginas que le ayudarán a administración roles.</span><span class="sxs-lookup"><span data-stu-id="307a5-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="307a5-245">(Administración de roles es una tarea administrativa, en lugar de una tarea de usuario). Sin embargo, puede agregar grupos directamente en la base de datos de pertenencia en WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="307a5-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="307a5-246">En WebMatrix, haga clic en el **bases de datos** selector de área de trabajo.</span><span class="sxs-lookup"><span data-stu-id="307a5-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="307a5-247">En el panel izquierdo, abra el *StarterSite.sdf* nodo, abra el **tablas** nodo y, a continuación, haga doble clic en el *páginas Web\_Roles* tabla.</span><span class="sxs-lookup"><span data-stu-id="307a5-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![security-membership-7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="307a5-249">Agregue un rol denominado &quot;admin&quot;.</span><span class="sxs-lookup"><span data-stu-id="307a5-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="307a5-250">El *RoleId* campo se rellena automáticamente.</span><span class="sxs-lookup"><span data-stu-id="307a5-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="307a5-251">(Es la clave principal y se estableció para ser un campo de identificación, como se explica en [Introducción al trabajo con una base de datos en sitios de ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202893).)</span><span class="sxs-lookup"><span data-stu-id="307a5-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="307a5-252">Tome nota de lo que es el valor para el *RoleId* campo.</span><span class="sxs-lookup"><span data-stu-id="307a5-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="307a5-253">(Si se trata de la primera función que se va a definir, será 1.)</span><span class="sxs-lookup"><span data-stu-id="307a5-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![security-membership-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="307a5-255">Cerrar la *páginas Web\_Roles* tabla.</span><span class="sxs-lookup"><span data-stu-id="307a5-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="307a5-256">Abra el *UserProfile* tabla.</span><span class="sxs-lookup"><span data-stu-id="307a5-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="307a5-257">Tome nota de la *UserId* valor de uno o varios de los usuarios en la tabla y, luego, cierre la tabla.</span><span class="sxs-lookup"><span data-stu-id="307a5-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="307a5-258">Abra el *páginas Web\_UserInRoles* de tabla y escriba un *UserID* y un *RoleID* valor en la tabla.</span><span class="sxs-lookup"><span data-stu-id="307a5-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="307a5-259">Por ejemplo, para colocar el usuario 2 en la &quot;admin&quot; rol, debe especificar estos valores:</span><span class="sxs-lookup"><span data-stu-id="307a5-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![security-membership-9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="307a5-261">Cerrar la *páginas Web\_UsersInRoles* tabla.</span><span class="sxs-lookup"><span data-stu-id="307a5-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="307a5-262">Ahora que tiene roles definidos, puede configurar una página que se puede acceder a los usuarios que están en ese rol.</span><span class="sxs-lookup"><span data-stu-id="307a5-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="307a5-263">En la carpeta raíz del sitio Web, cree una nueva página denominada *AdminError.cshtml* y reemplace el contenido existente por el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="307a5-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="307a5-264">Se trata de la página que se redirigen a usuarios si no se permiten el acceso a una página.</span><span class="sxs-lookup"><span data-stu-id="307a5-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="307a5-265">En la carpeta raíz del sitio Web, cree una nueva página denominada *AdminOnly.cshtml* y reemplace el código existente por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="307a5-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="307a5-266">El `Roles.IsUserInRole` devuelve del método `true` si el usuario actual es un miembro del rol especificado (en este caso, la función "admin").</span><span class="sxs-lookup"><span data-stu-id="307a5-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="307a5-267">Ejecute *Default.cshtml* en un explorador, pero no iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="307a5-268">(Si ya ha iniciado sesión, cerrar sesión.)</span><span class="sxs-lookup"><span data-stu-id="307a5-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="307a5-269">En la barra de direcciones del explorador, agregue *AdminOnly* en la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="307a5-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="307a5-270">(En otras palabras, solicitar el *AdminOnly.cshtml* archivo.) Se le redirigirá a la *AdminError.cshtml* página, porque actualmente no se inició sesión como un usuario en el &quot;admin&quot; rol.</span><span class="sxs-lookup"><span data-stu-id="307a5-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="307a5-271">Vuelva a *Default.cshtml* e inicie sesión como el usuario ha agregado a la &quot;admin&quot; rol.</span><span class="sxs-lookup"><span data-stu-id="307a5-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="307a5-272">Vaya a *AdminOnly.cshtml* página.</span><span class="sxs-lookup"><span data-stu-id="307a5-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="307a5-273">Esta vez verá la página.</span><span class="sxs-lookup"><span data-stu-id="307a5-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="307a5-274">Impide que los programas automatizados unirse a su sitio Web</span><span class="sxs-lookup"><span data-stu-id="307a5-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="307a5-275">La página de inicio de sesión no detendrá programas automatizados (a veces se denomina *web robots* o *bots*) desde el registro con su sitio Web.</span><span class="sxs-lookup"><span data-stu-id="307a5-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="307a5-276">Este procedimiento describe cómo habilitar una prueba de ReCaptcha para la página de registro.</span><span class="sxs-lookup"><span data-stu-id="307a5-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="307a5-278">Registrar su sitio Web en ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span><span class="sxs-lookup"><span data-stu-id="307a5-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="307a5-279">Cuando haya completado el registro, obtendrá una clave pública y una clave privada.</span><span class="sxs-lookup"><span data-stu-id="307a5-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="307a5-280">Agregue la ASP.NET Web Helpers Library a su sitio Web, como se describe en [las aplicaciones auxiliares de la instalación en un sitio de ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=252372), si no lo ha hecho ya.</span><span class="sxs-lookup"><span data-stu-id="307a5-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="307a5-281">En el *cuenta* carpeta, abra el archivo denominado *Register.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="307a5-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="307a5-282">En el código en la parte superior de la página, busque las siguientes líneas y quite la marca de comentario ellos mediante la eliminación de la `//` caracteres de comentario:</span><span class="sxs-lookup"><span data-stu-id="307a5-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="307a5-283">Reemplace `PRIVATE_KEY` con su propia clave privada de ReCaptcha.</span><span class="sxs-lookup"><span data-stu-id="307a5-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="307a5-284">En el marcado de la página, quite el `@*` y `*@` caracteres de comentarios de alrededor de las líneas siguientes en el marcado de página:</span><span class="sxs-lookup"><span data-stu-id="307a5-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="307a5-285">Reemplace `PUBLIC_KEY` con su clave.</span><span class="sxs-lookup"><span data-stu-id="307a5-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="307a5-286">Si aún no ha quitado ya, quite el `<div>` elemento que contiene el texto que comienza con "Para habilitar la comprobación CAPTCHA...".</span><span class="sxs-lookup"><span data-stu-id="307a5-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="307a5-287">(Quitar toda la `<div>` elemento y su contenido.)</span><span class="sxs-lookup"><span data-stu-id="307a5-287">(Remove the entire `<div>` element and its contents.)</span></span>

9. <span data-ttu-id="307a5-288">Ejecute *Default.cshtml* en un explorador.</span><span class="sxs-lookup"><span data-stu-id="307a5-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="307a5-289">Si ha iniciado en el sitio, haga clic en el **Logout** vínculo.</span><span class="sxs-lookup"><span data-stu-id="307a5-289">If you're logged into the site, click the **Logout** link.</span></span>
10. <span data-ttu-id="307a5-290">Haga clic en el **registrar** vincular y probar el registro mediante la prueba CAPTCHA.</span><span class="sxs-lookup"><span data-stu-id="307a5-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

     ![security-membership-10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="307a5-292">Para obtener más información sobre la `ReCaptcha` auxiliares, consulte [utilizando un CATPCHA para evitar que programas automatizada (Bots) de uso de su sitio Web de ASP.NET](https://go.microsoft.com/fwlink/?LinkId=251967).</span><span class="sxs-lookup"><span data-stu-id="307a5-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="307a5-293">Permitir a los usuarios iniciar sesión con un sitio externo</span><span class="sxs-lookup"><span data-stu-id="307a5-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="307a5-294">El **Starter Site** plantilla incluye código y marcado que permite a los usuarios iniciar sesión con Facebook, Windows Live, Twitter, Google o Yahoo.</span><span class="sxs-lookup"><span data-stu-id="307a5-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="307a5-295">De forma predeterminada, esta funcionalidad no está habilitada.</span><span class="sxs-lookup"><span data-stu-id="307a5-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="307a5-296">El procedimiento general para el uso de permitir que los usuarios inicien sesión mediante estos proveedores externos es esto:</span><span class="sxs-lookup"><span data-stu-id="307a5-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="307a5-297">Decida cuál de los sitios externos que desea admitir.</span><span class="sxs-lookup"><span data-stu-id="307a5-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="307a5-298">Si es necesario, vaya a ese sitio y configurar una aplicación de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="307a5-299">(Por ejemplo, que debe hacer esto con el fin de permitir inicios de sesión de Facebook).</span><span class="sxs-lookup"><span data-stu-id="307a5-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="307a5-300">En su sitio, configure el proveedor.</span><span class="sxs-lookup"><span data-stu-id="307a5-300">In your site, configure the provider.</span></span> <span data-ttu-id="307a5-301">En la mayoría de los casos, solo tiene comentarios de parte del código en el  *\_AppStart.cshtml* archivo.</span><span class="sxs-lookup"><span data-stu-id="307a5-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="307a5-302">Agregue el marcado para la página de registro que permite a los usuarios vínculo al sitio externo para el registro.</span><span class="sxs-lookup"><span data-stu-id="307a5-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="307a5-303">Normalmente, puede copiar el marcado que necesita y cambia ligeramente el texto.</span><span class="sxs-lookup"><span data-stu-id="307a5-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="307a5-304">Puede encontrar instrucciones paso a paso en el tema [habilitar inicio de sesión desde sitios externos en un sitio de ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=251969).</span><span class="sxs-lookup"><span data-stu-id="307a5-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="307a5-305">Después de que un usuario inicia sesión desde otro sitio, el usuario vuelve a su sitio y *asocia* ese inicio de sesión con su sitio.</span><span class="sxs-lookup"><span data-stu-id="307a5-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="307a5-306">De hecho, esto crea una entrada de pertenencia en el sitio para el inicio de sesión del usuario externo.</span><span class="sxs-lookup"><span data-stu-id="307a5-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="307a5-307">Esto le permite usar las funciones normales de pertenencia (por ejemplo, los roles) con el inicio de sesión externo.</span><span class="sxs-lookup"><span data-stu-id="307a5-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="307a5-308">Adición de seguridad a un sitio Web existente</span><span class="sxs-lookup"><span data-stu-id="307a5-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="307a5-309">El procedimiento descrito anteriormente en este artículo se basa en el uso de la **Starter Site** plantilla como base para la seguridad del sitio Web.</span><span class="sxs-lookup"><span data-stu-id="307a5-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="307a5-310">Si no resulta práctico para iniciar desde el **Starter Site** plantilla o para copiar las páginas relevantes de un sitio basado en esa plantilla, puede implementar el mismo tipo de seguridad en su propio sitio mediante la codificación por sí mismo.</span><span class="sxs-lookup"><span data-stu-id="307a5-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="307a5-311">Crear los mismos tipos de páginas, registro, inicio de sesión etc. — y, a continuación, usar clases y las aplicaciones auxiliares para configurar la pertenencia.</span><span class="sxs-lookup"><span data-stu-id="307a5-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="307a5-312">El proceso básico que se describe en la entrada de blog [la manera más sencilla de implementar la seguridad de ASP.NET Razor](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span><span class="sxs-lookup"><span data-stu-id="307a5-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="307a5-313">La mayoría del trabajo se realiza mediante los siguientes métodos y propiedades de la `WebSecurity` auxiliar:</span><span class="sxs-lookup"><span data-stu-id="307a5-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="307a5-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="307a5-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="307a5-315">Estos métodos le permiten determinar si alguien ya está registrado y registrarlos.</span><span class="sxs-lookup"><span data-stu-id="307a5-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="307a5-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="307a5-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="307a5-317">Esta propiedad le permite determinar si el usuario actual ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="307a5-318">Esto es útil para redirigir a los usuarios a una página de inicio de sesión si aún no han iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="307a5-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="307a5-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="307a5-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="307a5-320">Estos métodos, inicie sesión un usuario o la reducción horizontal.</span><span class="sxs-lookup"><span data-stu-id="307a5-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="307a5-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="307a5-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="307a5-322">Esta propiedad es útil para mostrar ha iniciado sesión nombre del usuario actual (si el usuario ha iniciado sesión).</span><span class="sxs-lookup"><span data-stu-id="307a5-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="307a5-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="307a5-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="307a5-324">Este método es útil si configuró la confirmación por correo electrónico para el registro.</span><span class="sxs-lookup"><span data-stu-id="307a5-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="307a5-325">(Los detalles se describen en la entrada de blog [usando la característica de confirmación para la seguridad de ASP.NET Web Pages](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span><span class="sxs-lookup"><span data-stu-id="307a5-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="307a5-326">Para administrar roles, puede usar el [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) y [pertenencia](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) clases, como se describe en la entrada de blog.</span><span class="sxs-lookup"><span data-stu-id="307a5-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="307a5-327">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="307a5-327">Additional Resources</span></span>

- [<span data-ttu-id="307a5-328">Personalizar el comportamiento de todo el sitio</span><span class="sxs-lookup"><span data-stu-id="307a5-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="307a5-329">Proteger las comunicaciones Web: Certificados SSL y https://</span><span class="sxs-lookup"><span data-stu-id="307a5-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="307a5-330">[LA manera más sencilla de implementar la seguridad de ASP.NET Razor](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) y [usando la característica de confirmación para la seguridad de ASP.NET Web Pages](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span><span class="sxs-lookup"><span data-stu-id="307a5-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="307a5-331">Estos son entradas de blog que describen cómo implementar las características de pertenencia ASP.NET sin usar el **Starter Site** plantilla.</span><span class="sxs-lookup"><span data-stu-id="307a5-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="307a5-332">Habilitar el inicio de sesión desde sitios externos en un sitio de ASP.NET Web Pages</span><span class="sxs-lookup"><span data-stu-id="307a5-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="307a5-333">[Referencia de API de clase WebSecurity](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="307a5-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="307a5-334">[Referencia de API de clase SimpleRoleProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="307a5-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="307a5-335">[Referencia de API de clase SimpleMembershipProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="307a5-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
