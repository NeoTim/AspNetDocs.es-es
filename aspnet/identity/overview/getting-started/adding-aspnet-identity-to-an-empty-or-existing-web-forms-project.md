---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Agregar ASP.NET Identity a un proyecto de formularios Web Forms vacío o existente-ASP.NET 4. x
author: raquelsa
description: En este tutorial se muestra cómo agregar ASP.NET Identity (el sistema de pertenencia a ASP.NET) a una aplicación de ASP.NET. Al crear un nuevo formulario Web Forms o MVC...
ms.author: riande
ms.date: 01/22/2019
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 8e82951d57f0b8052ee3f6530a7470be7d030206
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78471979"
---
# <a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="389b9-104">Agregar ASP.NET Identity a un proyecto de formularios Web Forms vacío o existente</span><span class="sxs-lookup"><span data-stu-id="389b9-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>

> <span data-ttu-id="389b9-105">En este tutorial se muestra cómo agregar [ASP.net Identity](introduction-to-aspnet-identity.md) (el nuevo sistema de pertenencia para ASP.net) a una aplicación de ASP.net.</span><span class="sxs-lookup"><span data-stu-id="389b9-105">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="389b9-106">Al crear un nuevo proyecto de formularios Web Forms o MVC en Visual Studio 2017 RTM con cuentas individuales, Visual Studio instalará todos los paquetes necesarios y agregará automáticamente todas las clases necesarias.</span><span class="sxs-lookup"><span data-stu-id="389b9-106">When you create a new Web Forms or MVC project in Visual Studio 2017 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="389b9-107">En este tutorial se ilustran los pasos para agregar compatibilidad con ASP.NET Identity a su proyecto de formularios Web Forms existente o a un nuevo proyecto vacío.</span><span class="sxs-lookup"><span data-stu-id="389b9-107">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="389b9-108">Describiré todos los paquetes de NuGet que necesita instalar y las clases que debe agregar.</span><span class="sxs-lookup"><span data-stu-id="389b9-108">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="389b9-109">Usaremos los formularios Web Forms de ejemplo para registrar nuevos usuarios e iniciar sesión mientras resaltan todas las API principales de punto de entrada para la autenticación y administración de usuarios.</span><span class="sxs-lookup"><span data-stu-id="389b9-109">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="389b9-110">Este ejemplo usará la implementación predeterminada de ASP.NET Identity para el almacenamiento de datos SQL que se basa en Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="389b9-110">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="389b9-111">En este tutorial, usaremos LocalDB para la base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="389b9-111">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 

## <a name="get-started-with-aspnet-identity"></a><span data-ttu-id="389b9-112">Introducción a ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="389b9-112">Get started with ASP.NET Identity</span></span>

1. <span data-ttu-id="389b9-113">Empiece por instalar y ejecutar [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="389b9-113">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span></span>
2. <span data-ttu-id="389b9-114">Seleccione **nuevo proyecto** en la página de inicio, o bien, puede usar el menú, seleccionar **archivo**y, a continuación, **nuevo proyecto**.</span><span class="sxs-lookup"><span data-stu-id="389b9-114">Select **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="389b9-115">En el panel izquierdo, expanda **Visual C#** , seleccione **Web**y, a continuación, **ASP.NET Web Application (.NET Framework)** .</span><span class="sxs-lookup"><span data-stu-id="389b9-115">In the left pane, expand **Visual C#**, then select **Web**, then **ASP.NET Web Application (.Net Framework)**.</span></span> <span data-ttu-id="389b9-116">Asigne al proyecto el nombre "WebFormsIdentity" y seleccione **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="389b9-116">Name your project "WebFormsIdentity" and select **OK**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image17.png)
4. <span data-ttu-id="389b9-117">En el cuadro de diálogo **nuevo proyecto ASP.net** , seleccione la plantilla **vacía** .</span><span class="sxs-lookup"><span data-stu-id="389b9-117">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="389b9-118">Observe que el botón **cambiar autenticación** está deshabilitado y no se proporciona compatibilidad con la autenticación en esta plantilla.</span><span class="sxs-lookup"><span data-stu-id="389b9-118">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="389b9-119">Las plantillas de Web Forms, MVC y Web API le permiten seleccionar el enfoque de autenticación.</span><span class="sxs-lookup"><span data-stu-id="389b9-119">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span>

## <a name="add-identity-packages-to-your-app"></a><span data-ttu-id="389b9-120">Agregar paquetes de identidades a la aplicación</span><span class="sxs-lookup"><span data-stu-id="389b9-120">Add Identity packages to your app</span></span>

<span data-ttu-id="389b9-121">En Explorador de soluciones, haga clic con el botón derecho en el proyecto y seleccione **administrar paquetes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="389b9-121">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="389b9-122">Busque e instale el paquete **Microsoft. Aspnet. Identity. EntityFramework** .</span><span class="sxs-lookup"><span data-stu-id="389b9-122">Search for and install the **Microsoft.AspNet.Identity.EntityFramework** package.</span></span> 
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image15.png)
  
<span data-ttu-id="389b9-123">Tenga en cuenta que este paquete instalará los paquetes de dependencia: **EntityFramework** y **Microsoft ASP.net principal de identidad**.</span><span class="sxs-lookup"><span data-stu-id="389b9-123">Note that this package will install the dependency packages: **EntityFramework** and **Microsoft ASP.NET Identity Core**.</span></span>

## <a name="add-a-web-form-to-register-users"></a><span data-ttu-id="389b9-124">Agregar un formulario web para registrar usuarios</span><span class="sxs-lookup"><span data-stu-id="389b9-124">Add a web form to register users</span></span>

1. <span data-ttu-id="389b9-125">En **Explorador de soluciones**, haga clic con el botón secundario en el proyecto, seleccione **Agregar**y, a continuación, **formulario web**.</span><span class="sxs-lookup"><span data-stu-id="389b9-125">In **Solution Explorer**, right-click your project and select **Add**, and then **Web Form**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="389b9-126">En el cuadro de diálogo **especificar nombre para el elemento** , asigne un nombre al nuevo formulario Web Forms **y, después**, seleccione **Aceptar** .</span><span class="sxs-lookup"><span data-stu-id="389b9-126">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then select **OK**</span></span>
3. <span data-ttu-id="389b9-127">Reemplace el marcado en el archivo *Register. aspx* generado con el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="389b9-127">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="389b9-128">Los cambios de código aparecen resaltados.</span><span class="sxs-lookup"><span data-stu-id="389b9-128">The code changes are highlighted.</span></span> 

    [!code-html[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="389b9-129">Se trata simplemente de una versión simplificada del archivo *Register. aspx* que se crea al crear un nuevo proyecto de formularios Web Forms de ASP.net.</span><span class="sxs-lookup"><span data-stu-id="389b9-129">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="389b9-130">El marcado anterior agrega campos de formulario y un botón para registrar un nuevo usuario.</span><span class="sxs-lookup"><span data-stu-id="389b9-130">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="389b9-131">Abra el archivo *Register.aspx.CS* y reemplace el contenido del archivo por el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="389b9-131">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="389b9-132">El código anterior es una versión simplificada del archivo *Register.aspx.CS* que se crea al crear un nuevo proyecto de formularios Web Forms de ASP.net.</span><span class="sxs-lookup"><span data-stu-id="389b9-132">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="389b9-133">La clase *IdentityUser* es la implementación predeterminada de EntityFramework de la interfaz *IUser* .</span><span class="sxs-lookup"><span data-stu-id="389b9-133">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="389b9-134">La interfaz *IUser* es la interfaz mínima para un usuario en ASP.net Identity Core.</span><span class="sxs-lookup"><span data-stu-id="389b9-134">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="389b9-135">La clase *UserStore* es la implementación predeterminada de EntityFramework de un almacén de usuario.</span><span class="sxs-lookup"><span data-stu-id="389b9-135">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="389b9-136">Esta clase implementa las interfaces mínimas de ASP.NET Identity Core: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* y *IUserRoleStore*.</span><span class="sxs-lookup"><span data-stu-id="389b9-136">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="389b9-137">La clase *UserManager* expone las API relacionadas con el usuario, que guardarán automáticamente los cambios en el *UserStore*.</span><span class="sxs-lookup"><span data-stu-id="389b9-137">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="389b9-138">La clase *IdentityResult* representa el resultado de una operación de identidad.</span><span class="sxs-lookup"><span data-stu-id="389b9-138">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="389b9-139">En **Explorador de soluciones**, haga clic con el botón derecho en el proyecto y seleccione **Agregar**, **agregue la carpeta ASP.net** y, a continuación, **\_datos**de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="389b9-139">In **Solution Explorer**, right-click your project and select **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="389b9-140">Abra el archivo *Web. config* y agregue una entrada de cadena de conexión para la base de datos que se utilizará para almacenar información de usuario.</span><span class="sxs-lookup"><span data-stu-id="389b9-140">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="389b9-141">La base de datos se creará en tiempo de ejecución por EntityFramework para las entidades de identidad.</span><span class="sxs-lookup"><span data-stu-id="389b9-141">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="389b9-142">La cadena de conexión es similar a la que se crea cuando se crea un nuevo proyecto de formularios Web Forms.</span><span class="sxs-lookup"><span data-stu-id="389b9-142">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="389b9-143">El código resaltado muestra el marcado que debe agregar:</span><span class="sxs-lookup"><span data-stu-id="389b9-143">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="389b9-144">Para Visual Studio 2015 o posterior, reemplace `(localdb)\v11.0` por `(localdb)\MSSQLLocalDB` en la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="389b9-144">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="389b9-145">Haga clic con el botón derecho en archivo *Register. aspx* en el proyecto y seleccione **establecer como página de inicio**.</span><span class="sxs-lookup"><span data-stu-id="389b9-145">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="389b9-146">Presione Ctrl + F5 para compilar y ejecutar la aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="389b9-146">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="389b9-147">Escriba un nombre de usuario y una contraseña nuevos y, a continuación, seleccione **registrar**.</span><span class="sxs-lookup"><span data-stu-id="389b9-147">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="389b9-148">ASP.NET Identity admite la validación y en este ejemplo puede comprobar el comportamiento predeterminado en los validadores de usuario y contraseña que proceden del paquete principal de identidades.</span><span class="sxs-lookup"><span data-stu-id="389b9-148">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="389b9-149">El validador predeterminado para el usuario (`UserValidator`) tiene una propiedad `AllowOnlyAlphanumericUserNames` que tiene un valor predeterminado establecido en `true`.</span><span class="sxs-lookup"><span data-stu-id="389b9-149">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="389b9-150">El validador predeterminado de contraseña (`MinimumLengthValidator`) garantiza que la contraseña tiene al menos 6 caracteres.</span><span class="sxs-lookup"><span data-stu-id="389b9-150">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="389b9-151">Estos validadores son propiedades de `UserManager` que se pueden invalidar si desea tener validación personalizada,</span><span class="sxs-lookup"><span data-stu-id="389b9-151">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verify-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="389b9-152">Compruebe la base de datos de identidad de LocalDb y las tablas generadas por Entity Framework</span><span class="sxs-lookup"><span data-stu-id="389b9-152">Verify the LocalDb Identity database and tables generated by Entity Framework</span></span>

1. <span data-ttu-id="389b9-153">En el menú **Ver** , seleccione **Explorador de servidores**.</span><span class="sxs-lookup"><span data-stu-id="389b9-153">In the **View** menu, select **Server Explorer**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="389b9-154">Expanda **DefaultConnection (WebFormsIdentity)** , expanda **tablas**, haga clic con el botón secundario en **AspNetUsers** y, a continuación, seleccione **Mostrar datos de tabla**.</span><span class="sxs-lookup"><span data-stu-id="389b9-154">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right-click **AspNetUsers** and then select **Show Table Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configure-the-application-for-owin-authentication"></a><span data-ttu-id="389b9-155">Configuración de la aplicación para la autenticación OWIN</span><span class="sxs-lookup"><span data-stu-id="389b9-155">Configure the application for OWIN authentication</span></span>

<span data-ttu-id="389b9-156">En este momento, solo se ha agregado compatibilidad con la creación de usuarios.</span><span class="sxs-lookup"><span data-stu-id="389b9-156">At this point we have only added support for creating users.</span></span> <span data-ttu-id="389b9-157">Ahora, vamos a mostrar cómo se puede Agregar la autenticación para iniciar sesión con un usuario.</span><span class="sxs-lookup"><span data-stu-id="389b9-157">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="389b9-158">ASP.NET Identity usa el middleware de autenticación de Microsoft OWIN para la autenticación de formularios.</span><span class="sxs-lookup"><span data-stu-id="389b9-158">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="389b9-159">La autenticación de cookies OWIN es una cookie y un mecanismo de autenticación basado en notificaciones que se puede usar en cualquier plataforma hospedada en [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) o IIS.</span><span class="sxs-lookup"><span data-stu-id="389b9-159">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="389b9-160">Con este modelo, se pueden usar los mismos paquetes de autenticación en varios marcos, incluidos ASP.NET MVC y Web Forms.</span><span class="sxs-lookup"><span data-stu-id="389b9-160">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="389b9-161">Para obtener más información sobre Project Katana y cómo ejecutar middleware en un host independiente, vea [Introducción con el proyecto Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="389b9-161">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="install-authentication-packages-to-your-application"></a><span data-ttu-id="389b9-162">Instalación de paquetes de autenticación en la aplicación</span><span class="sxs-lookup"><span data-stu-id="389b9-162">Install authentication packages to your application</span></span>

1. <span data-ttu-id="389b9-163">En Explorador de soluciones, haga clic con el botón derecho en el proyecto y seleccione **administrar paquetes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="389b9-163">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="389b9-164">Busque e instale el paquete ***Microsoft. Aspnet. Identity. Owin*** .</span><span class="sxs-lookup"><span data-stu-id="389b9-164">Search for and install the ***Microsoft.AspNet.Identity.Owin*** package.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image16.png)

2. <span data-ttu-id="389b9-165">Busque e instale el paquete ***Microsoft. Owin. host. SystemWeb*** .</span><span class="sxs-lookup"><span data-stu-id="389b9-165">Search for and install the ***Microsoft.Owin.Host.SystemWeb*** package.</span></span>

    > [!NOTE]
    > <span data-ttu-id="389b9-166">El paquete **Microsoft. Aspnet. Identity. Owin** contiene un conjunto de clases de extensión Owin para administrar y configurar el middleware de autenticación Owin que van a consumir los paquetes de ASP.net Identity Core.</span><span class="sxs-lookup"><span data-stu-id="389b9-166">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>
    > <span data-ttu-id="389b9-167">El paquete **Microsoft. Owin. host. SystemWeb** contiene un servidor Owin que permite que las aplicaciones basadas en Owin se ejecuten en IIS mediante la canalización de solicitudes de ASP.net.</span><span class="sxs-lookup"><span data-stu-id="389b9-167">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="389b9-168">Para obtener más información, consulte [middleware de OWIN en la canalización integrada de IIS](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="389b9-168">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="add-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="389b9-169">Agregar clases de configuración de inicio y autenticación de OWIN</span><span class="sxs-lookup"><span data-stu-id="389b9-169">Add OWIN startup and authentication configuration classes</span></span>

1. <span data-ttu-id="389b9-170">En **Explorador de soluciones**, haga clic con el botón derecho en el proyecto, seleccione **Agregar**y, a continuación, **Agregar nuevo elemento**.</span><span class="sxs-lookup"><span data-stu-id="389b9-170">In **Solution Explorer**, right-click your project, select **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="389b9-171">En el cuadro de diálogo Buscar cuadro de texto, escriba "*Owin*".</span><span class="sxs-lookup"><span data-stu-id="389b9-171">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="389b9-172">Asigne a la clase el nombre "*Startup*" y seleccione **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="389b9-172">Name the class "*Startup*" and select **Add**.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="389b9-173">En el archivo Startup.cs, agregue el código resaltado que se muestra a continuación para configurar la autenticación de cookies OWIN.</span><span class="sxs-lookup"><span data-stu-id="389b9-173">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="389b9-174">Esta clase contiene el atributo `OwinStartup` para especificar la clase de inicio OWIN.</span><span class="sxs-lookup"><span data-stu-id="389b9-174">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="389b9-175">Cada aplicación OWIN tiene una clase de inicio donde se especifican los componentes de la canalización de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="389b9-175">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="389b9-176">Consulte [detección de clases de inicio de OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) para obtener más información sobre este modelo.</span><span class="sxs-lookup"><span data-stu-id="389b9-176">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="add-web-forms-for-registering-and-signing-in-users"></a><span data-ttu-id="389b9-177">Agregar formularios Web Forms para registrarse e iniciar sesión en los usuarios</span><span class="sxs-lookup"><span data-stu-id="389b9-177">Add web forms for registering and signing in users</span></span>

1. <span data-ttu-id="389b9-178">Abra el archivo *Register.aspx.CS* y agregue el código siguiente que inicia sesión en el usuario cuando el registro se realiza correctamente.</span><span class="sxs-lookup"><span data-stu-id="389b9-178">Open the *Register.aspx.cs* file and add the following code which signs in the user when registration succeeds.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="389b9-179">Como ASP.NET Identity y la autenticación de cookies OWIN son sistema basado en notificaciones, el marco de trabajo requiere que el desarrollador de la aplicación genere un [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) para el usuario.</span><span class="sxs-lookup"><span data-stu-id="389b9-179">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="389b9-180">ClaimsIdentity contiene información sobre todas las notificaciones para el usuario, como los roles a los que pertenece el usuario.</span><span class="sxs-lookup"><span data-stu-id="389b9-180">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="389b9-181">También puede agregar más notificaciones para el usuario en esta fase.</span><span class="sxs-lookup"><span data-stu-id="389b9-181">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="389b9-182">Puede iniciar sesión en el usuario mediante AuthenticationManager desde OWIN y llamando a `SignIn` y pasando el ClaimsIdentity como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="389b9-182">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="389b9-183">Este código iniciará la sesión del usuario y generará también una cookie.</span><span class="sxs-lookup"><span data-stu-id="389b9-183">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="389b9-184">Esta llamada es análoga a [FormAuthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) que usa el módulo [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="389b9-184">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="389b9-185">En **Explorador de soluciones**, haga clic con el botón secundario en el proyecto, seleccione **Agregar**y, a continuación, **formulario web**.</span><span class="sxs-lookup"><span data-stu-id="389b9-185">In **Solution Explorer**, right-click your project, select **Add**, and then **Web Form**.</span></span> <span data-ttu-id="389b9-186">Asigne un nombre al **Inicio de sesión**de formulario Web.</span><span class="sxs-lookup"><span data-stu-id="389b9-186">Name the web form **Login**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="389b9-187">Reemplace el contenido del archivo *login. aspx* con el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="389b9-187">Replace the contents of the *Login.aspx* file with the following code:</span></span>

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="389b9-188">Reemplace el contenido del archivo *login.aspx.CS* por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="389b9-188">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="389b9-189">En el `Page_Load` ahora se comprueba el estado del usuario actual y se realiza una acción en función de su estado de `Context.User.Identity.IsAuthenticated`.</span><span class="sxs-lookup"><span data-stu-id="389b9-189">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>
    >   <span data-ttu-id="389b9-190">**Mostrar el nombre de usuario con sesión iniciada** : el marco de identidad de Microsoft ASP.net ha agregado métodos de extensión en [System. Security. principal. IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) que le permite obtener los `UserName` y `UserId` del usuario que ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="389b9-190">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="389b9-191">Estos métodos de extensión se definen en el ensamblado de `Microsoft.AspNet.Identity.Core`.</span><span class="sxs-lookup"><span data-stu-id="389b9-191">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="389b9-192">Estos métodos de extensión son el reemplazo de [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="389b9-192">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="389b9-193">Método de inicio de sesión: `This` método reemplaza el método de `CreateUser_Click` anterior en este ejemplo y ahora inicia la sesión del usuario después de crear correctamente el usuario.</span><span class="sxs-lookup"><span data-stu-id="389b9-193">SignIn method: `This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >   <span data-ttu-id="389b9-194">El marco OWIN de Microsoft ha agregado métodos de extensión en `System.Web.HttpContext` que le permite obtener una referencia a un `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="389b9-194">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="389b9-195">Estos métodos de extensión se definen en `Microsoft.Owin.Host.SystemWeb` ensamblado.</span><span class="sxs-lookup"><span data-stu-id="389b9-195">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="389b9-196">La clase `OwinContext` expone una propiedad `IAuthenticationManager` que representa la funcionalidad de middleware de autenticación disponible en la solicitud actual.</span><span class="sxs-lookup"><span data-stu-id="389b9-196">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span> <span data-ttu-id="389b9-197">Puede iniciar sesión en el usuario mediante el `AuthenticationManager` desde OWIN y llamando a `SignIn` y pasando el `ClaimsIdentity` como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="389b9-197">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn` and passing in the `ClaimsIdentity` as shown above.</span></span> <span data-ttu-id="389b9-198">Dado que ASP.NET Identity y la autenticación de cookies OWIN son un sistema basado en notificaciones, el marco de trabajo requiere que la aplicación genere un `ClaimsIdentity` para el usuario.</span><span class="sxs-lookup"><span data-stu-id="389b9-198">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="389b9-199">El `ClaimsIdentity` contiene información sobre todas las notificaciones para el usuario, como los roles a los que pertenece el usuario.</span><span class="sxs-lookup"><span data-stu-id="389b9-199">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="389b9-200">También puede agregar más notificaciones para el usuario en esta fase, este código iniciará la sesión del usuario y generará también una cookie.</span><span class="sxs-lookup"><span data-stu-id="389b9-200">You can also add more claims for the user at this stage This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="389b9-201">Esta llamada es análoga a [FormAuthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) que usa el módulo [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="389b9-201">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="389b9-202">`SignOut` método: obtiene una referencia al `AuthenticationManager` desde OWIN y llama a `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="389b9-202">`SignOut` method: Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="389b9-203">Es análogo al método [FormsAuthentication. SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) usado por el módulo [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="389b9-203">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="389b9-204">Presione **Ctrl + F5** para compilar y ejecutar la aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="389b9-204">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="389b9-205">Escriba un nombre de usuario y una contraseña nuevos y, a continuación, seleccione **registrar**.</span><span class="sxs-lookup"><span data-stu-id="389b9-205">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="389b9-206">Nota: en este momento, el nuevo usuario se crea y se inicia sesión.</span><span class="sxs-lookup"><span data-stu-id="389b9-206">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="389b9-207">Seleccione el botón **Cerrar sesión** .</span><span class="sxs-lookup"><span data-stu-id="389b9-207">Select the **Log out** button.</span></span> <span data-ttu-id="389b9-208">Se le redirigirá al formulario de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="389b9-208">You are redirected to the Log in form.</span></span>
7. <span data-ttu-id="389b9-209">Escriba un nombre de usuario o una contraseña no válidos y seleccione el botón **iniciar sesión** .</span><span class="sxs-lookup"><span data-stu-id="389b9-209">Enter an invalid user name or password and select the **Log in** button.</span></span> 
   <span data-ttu-id="389b9-210">El método `UserManager.Find` devolverá null y se mostrará el mensaje de error: " *nombre de usuario o contraseña no válidos* ".</span><span class="sxs-lookup"><span data-stu-id="389b9-210">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
