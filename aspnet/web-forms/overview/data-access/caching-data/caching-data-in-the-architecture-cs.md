---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
title: Almacenamiento en caché de datos en la arquitectura (C#) | Microsoft Docs
author: rick-anderson
description: En el tutorial anterior hemos aprendido a aplicar el almacenamiento en caché en la capa de presentación. En este tutorial se aprenderá cómo aprovechar las ventajas de nuestro architectu capas...
ms.author: riande
ms.date: 05/30/2007
ms.assetid: d29a7c41-0628-4a23-9dfc-bfea9c6c1054
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
msc.type: authoredcontent
ms.openlocfilehash: 3971140aa7a6c829287e74df804694c19e34adcf
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/01/2019
ms.locfileid: "57028052"
---
<a name="caching-data-in-the-architecture-c"></a><span data-ttu-id="dae6e-104">Almacenar datos en caché en la arquitectura (C#)</span><span class="sxs-lookup"><span data-stu-id="dae6e-104">Caching Data in the Architecture (C#)</span></span>
====================
<span data-ttu-id="dae6e-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="dae6e-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="dae6e-106">[Descargue la aplicación de ejemplo](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) o [descargar PDF](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="dae6e-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) or [Download PDF](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span></span>

> <span data-ttu-id="dae6e-107">En el tutorial anterior hemos aprendido a aplicar el almacenamiento en caché en la capa de presentación.</span><span class="sxs-lookup"><span data-stu-id="dae6e-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="dae6e-108">En este tutorial, aprenderá cómo aprovechar las ventajas de nuestra arquitectura por capas para almacenar datos en caché de la capa de lógica empresarial.</span><span class="sxs-lookup"><span data-stu-id="dae6e-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="dae6e-109">Para hacerlo mediante la extensión de la arquitectura para incluir una capa de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-109">We do this by extending the architecture to include a Caching Layer.</span></span>


## <a name="introduction"></a><span data-ttu-id="dae6e-110">Introducción</span><span class="sxs-lookup"><span data-stu-id="dae6e-110">Introduction</span></span>

<span data-ttu-id="dae6e-111">Como hemos visto en el tutorial anterior, el almacenamiento en caché los datos de origen ObjectDataSource s es tan sencillo como configurar un par de propiedades.</span><span class="sxs-lookup"><span data-stu-id="dae6e-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="dae6e-112">Por desgracia, ObjectDataSource aplica el almacenamiento en caché en la capa de presentación, que se acopla estrechamente con las directivas de almacenamiento en caché con la página ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="dae6e-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="dae6e-113">Uno de los motivos para la creación de una arquitectura por capas es permitirle tales acoplamientos interrumpir.</span><span class="sxs-lookup"><span data-stu-id="dae6e-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="dae6e-114">La capa de lógica empresarial, por ejemplo, separa la lógica de negocios desde las páginas ASP.NET, mientras que la capa de acceso a datos desacopla los detalles de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="dae6e-115">Esta separación de los detalles de acceso de datos y la lógica empresarial es preferida, en parte, porque hace que el sistema sea más legible, más fácil de mantener y más flexible para cambiar.</span><span class="sxs-lookup"><span data-stu-id="dae6e-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="dae6e-116">También se permite para la división de mano de obra de un desarrollador que trabaja en la capa de presentación t debe estar familiarizado con los detalles de s de la base de datos con el fin de hacer su trabajo y conocimiento del dominio.</span><span class="sxs-lookup"><span data-stu-id="dae6e-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="dae6e-117">Desacoplamiento de la directiva de caché de la capa de presentación ofrece ventajas similares.</span><span class="sxs-lookup"><span data-stu-id="dae6e-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="dae6e-118">En este tutorial aumentaremos nuestra arquitectura debe incluir un *capa de almacenamiento en caché* (o CL para abreviar) que emplea nuestra directiva de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="dae6e-119">La capa de almacenamiento en caché incluirá un `ProductsCL` clase que proporciona acceso a la información de producto con métodos como `GetProducts()`, `GetProductsByCategoryID(categoryID)`, y así sucesivamente, que, cuando se invoca, le primer intento para recuperar los datos de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="dae6e-120">Si la memoria caché está vacía, estos métodos se invocarán adecuado `ProductsBLL` método BLL, que se obtendría a su vez los datos de la capa DAL.</span><span class="sxs-lookup"><span data-stu-id="dae6e-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="dae6e-121">El `ProductsCL` métodos almacenar en caché los datos recuperados de BLL antes de devolverlo.</span><span class="sxs-lookup"><span data-stu-id="dae6e-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="dae6e-122">Como se muestra en la figura 1, la CL se encuentra entre la presentación y capas de lógica de negocios.</span><span class="sxs-lookup"><span data-stu-id="dae6e-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>


![El almacenamiento en caché de capa (CL) es otra capa en nuestra arquitectura](caching-data-in-the-architecture-cs/_static/image1.png)

<span data-ttu-id="dae6e-124">**Figura 1**: El almacenamiento en caché de capa (CL) es otra capa en nuestra arquitectura</span><span class="sxs-lookup"><span data-stu-id="dae6e-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>


## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="dae6e-125">Paso 1: Creación de clases de capa de almacenamiento en caché</span><span class="sxs-lookup"><span data-stu-id="dae6e-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="dae6e-126">En este tutorial crearemos un CL muy simple con una sola clase `ProductsCL` que tiene solo un puñado de métodos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="dae6e-127">Creación de una capa de almacenamiento en caché completa para toda la aplicación necesitaría crear `CategoriesCL`, `EmployeesCL`, y `SuppliersCL` clases y proporcionar un método en estas clases de la capa de almacenamiento en caché para cada método de acceso o la modificación de datos en la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="dae6e-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="dae6e-128">Al igual que con las BLL y DAL, la capa de almacenamiento en caché lo ideal es que debe implementarse como un proyecto de biblioteca de clases independiente; Sin embargo, se implementará como una clase en el `App_Code` carpeta.</span><span class="sxs-lookup"><span data-stu-id="dae6e-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="dae6e-129">Para clases independientes claramente la CL más de las clases de DAL y BLL, s permiten crear una nueva subcarpeta en el `App_Code` carpeta.</span><span class="sxs-lookup"><span data-stu-id="dae6e-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="dae6e-130">Haga doble clic en el `App_Code` carpeta en el Explorador de soluciones, elija la nueva carpeta y el nombre de la nueva carpeta `CL`.</span><span class="sxs-lookup"><span data-stu-id="dae6e-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="dae6e-131">Después de crear esta carpeta, agregar a ella, una nueva clase denominada `ProductsCL.cs`.</span><span class="sxs-lookup"><span data-stu-id="dae6e-131">After creating this folder, add to it a new class named `ProductsCL.cs`.</span></span>


![Agregar una carpeta nueva denominada CL y una clase denominada ProductsCL.cs](caching-data-in-the-architecture-cs/_static/image2.png)

<span data-ttu-id="dae6e-133">**Figura 2**: Agregue una nueva carpeta denominada `CL` y una clase denominada `ProductsCL.cs`</span><span class="sxs-lookup"><span data-stu-id="dae6e-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.cs`</span></span>


<span data-ttu-id="dae6e-134">El `ProductsCL` clase debe incluir el mismo conjunto de métodos de acceso y de modificación de datos que se encuentra en su clase de capa de lógica empresarial correspondiente (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="dae6e-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="dae6e-135">En lugar de crear todos estos métodos, intente crear de let s aquí un par para hacerse una idea de los patrones utilizados por la CL.</span><span class="sxs-lookup"><span data-stu-id="dae6e-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="dae6e-136">En concreto, vamos a agregar el `GetProducts()` y `GetProductsByCategoryID(categoryID)` métodos en el paso 3 y un `UpdateProduct` sobrecarga en el paso 4.</span><span class="sxs-lookup"><span data-stu-id="dae6e-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="dae6e-137">Puede agregar el resto `ProductsCL` métodos y `CategoriesCL`, `EmployeesCL`, y `SuppliersCL` clases en su tiempo libre.</span><span class="sxs-lookup"><span data-stu-id="dae6e-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="dae6e-138">Paso 2: Leer y escribir en la caché de datos</span><span class="sxs-lookup"><span data-stu-id="dae6e-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="dae6e-139">ObjectDataSource característica explorado internamente en el tutorial anterior, usa la caché de datos ASP.NET para almacenar los datos recuperados de BLL.</span><span class="sxs-lookup"><span data-stu-id="dae6e-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="dae6e-140">La caché de datos también se puede acceder mediante programación desde las clases de código subyacente de las páginas ASP.NET o desde las clases en la arquitectura de s aplicación web.</span><span class="sxs-lookup"><span data-stu-id="dae6e-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="dae6e-141">Para leer y escribir en la caché de datos de una clase de código subyacente de s de página ASP.NET, utilice el siguiente patrón:</span><span class="sxs-lookup"><span data-stu-id="dae6e-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample1.cs)]

<span data-ttu-id="dae6e-142">El [ `Cache` clase](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [ `Insert` método](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) tiene un número de sobrecargas.</span><span class="sxs-lookup"><span data-stu-id="dae6e-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="dae6e-143">`Cache["key"] = value` y `Cache.Insert(key, value)` son sinónimos y ambos agregan un elemento a la memoria caché utilizando la clave especificada sin una expiración definido.</span><span class="sxs-lookup"><span data-stu-id="dae6e-143">`Cache["key"] = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="dae6e-144">Normalmente, desea especificar una fecha de expiración al agregar un elemento a la caché, ya sea como una dependencia, una basada en tiempo de expiración o ambos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="dae6e-145">Utilice uno de los otros `Insert` sobrecargas del método s para proporcionar información de dependencia o basado en tiempo de caducidad.</span><span class="sxs-lookup"><span data-stu-id="dae6e-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="dae6e-146">La capa de almacenamiento en caché s métodos deben comprobar primero si los datos solicitados se están en la memoria caché y, si es así, vuelve a partir de ahí.</span><span class="sxs-lookup"><span data-stu-id="dae6e-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="dae6e-147">Si los datos solicitados no están en la memoria caché, debe invocarse el método BLL adecuado.</span><span class="sxs-lookup"><span data-stu-id="dae6e-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="dae6e-148">Su valor devuelto se debe almacenar en caché y, a continuación, se devuelve, como se muestra en el siguiente diagrama de secuencia.</span><span class="sxs-lookup"><span data-stu-id="dae6e-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>


![Los métodos de capa de almacenamiento en caché s devuelven los datos de la memoria caché si lo s disponible](caching-data-in-the-architecture-cs/_static/image3.png)

<span data-ttu-id="dae6e-150">**Figura 3**: Los métodos de capa de almacenamiento en caché s devuelven los datos de la memoria caché si lo s disponible</span><span class="sxs-lookup"><span data-stu-id="dae6e-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>


<span data-ttu-id="dae6e-151">La secuencia que se muestra en la figura 3 se realiza en las clases de CL con el siguiente patrón:</span><span class="sxs-lookup"><span data-stu-id="dae6e-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample2.cs)]

<span data-ttu-id="dae6e-152">En este caso, *tipo* es el tipo de datos que se almacenan en la memoria caché `Northwind.ProductsDataTable`, por ejemplo mientras *clave* es la clave que identifica el elemento de caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="dae6e-153">Si el elemento con los valores especificados *clave* no está en la memoria caché, a continuación, *instancia* será `null` y los datos se recuperan desde el método BLL adecuado y se agregará a la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-153">If the item with the specified *key* is not in the cache, then *instance* will be `null` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="dae6e-154">En el momento `return instance` se alcanza, *instancia* contiene una referencia a los datos, ya sea desde la memoria caché o extraído de la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="dae6e-154">By the time `return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="dae6e-155">Asegúrese de usar el patrón anterior al obtener acceso a datos de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="dae6e-156">El siguiente patrón, que, a primera vista, parece equivalente, contiene una diferencia sutil que presenta una condición de carrera.</span><span class="sxs-lookup"><span data-stu-id="dae6e-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="dae6e-157">Las condiciones de carrera son difíciles de depurar porque revelarse a sí mismos esporádicamente y son difíciles de reproducir.</span><span class="sxs-lookup"><span data-stu-id="dae6e-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample3.cs)]

<span data-ttu-id="dae6e-158">La diferencia en este segundo fragmento de código incorrecto es que en lugar de almacenar una referencia al elemento almacenado en caché en una variable local, la caché de datos se accede directamente en la instrucción condicional *y* en el `return`.</span><span class="sxs-lookup"><span data-stu-id="dae6e-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `return`.</span></span> <span data-ttu-id="dae6e-159">Imagine que cuando se alcanza este código, `Cache["key"]` no es`null`, pero antes la `return` se alcanza la instrucción, el sistema desaloja *clave* desde la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-159">Imagine that when this code is reached, `Cache["key"]` is non-`null`, but before the `return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="dae6e-160">En este caso excepcional, el código devolverá una `null` valor en lugar de un objeto del tipo esperado.</span><span class="sxs-lookup"><span data-stu-id="dae6e-160">In this rare case, the code will return a `null` value rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="dae6e-161">La caché de datos es segura para subprocesos, para que no la necesidad de t para sincronizar el acceso de subproceso para simple lecturas o escrituras.</span><span class="sxs-lookup"><span data-stu-id="dae6e-161">The data cache is thread-safe, so you don t need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="dae6e-162">Sin embargo, si necesita realizar varias operaciones en los datos en la memoria caché que deben ser atómicas, es responsable de implementar un bloqueo o algún otro mecanismo para garantizar la seguridad para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="dae6e-163">Consulte [sincronizar el acceso a la memoria caché de ASP.NET](http://www.ddj.com/184406369) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="dae6e-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>


<span data-ttu-id="dae6e-164">Puede expulsar mediante programación un elemento de la caché de datos mediante el [ `Remove` método](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) así:</span><span class="sxs-lookup"><span data-stu-id="dae6e-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample4.cs)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="dae6e-165">Paso 3: Devolver información del producto desde la`ProductsCL`clase</span><span class="sxs-lookup"><span data-stu-id="dae6e-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="dae6e-166">Para este tutorial permite s implementar dos métodos para devolver información del producto desde la `ProductsCL` clase: `GetProducts()` y `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="dae6e-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="dae6e-167">Al igual que con el `ProductsBL` clase en la capa de lógica empresarial, el `GetProducts()` método en la CL devuelve información acerca de todos los productos como un `Northwind.ProductsDataTable` objeto, mientras que `GetProductsByCategoryID(categoryID)` devuelve todos los productos de una categoría especificada.</span><span class="sxs-lookup"><span data-stu-id="dae6e-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="dae6e-168">El código siguiente muestra una parte de los métodos de la `ProductsCL` clase:</span><span class="sxs-lookup"><span data-stu-id="dae6e-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-cs/samples/sample5.vb)]

<span data-ttu-id="dae6e-169">En primer lugar, tenga en cuenta la `DataObject` y `DataObjectMethodAttribute` atributos aplicados a las clases y métodos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="dae6e-170">Estos atributos proporcionan información para el ObjectDataSource wizard s, que indica qué clases y métodos deben aparecer en los pasos del asistente s.</span><span class="sxs-lookup"><span data-stu-id="dae6e-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="dae6e-171">Puesto que los métodos y clases de CL se tendrá acceso desde un origen ObjectDataSource en la capa de presentación, he agregado estos atributos para mejorar la experiencia en tiempo de diseño.</span><span class="sxs-lookup"><span data-stu-id="dae6e-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="dae6e-172">Vuelva a consultar el [crear una capa de lógica empresarial](../introduction/creating-a-business-logic-layer-cs.md) tutorial para obtener una descripción más exhaustiva sobre estos atributos y sus efectos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="dae6e-173">En el `GetProducts()` y `GetProductsByCategoryID(categoryID)` métodos, los datos devueltos por la `GetCacheItem(key)` método se asigna a una variable local.</span><span class="sxs-lookup"><span data-stu-id="dae6e-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="dae6e-174">El `GetCacheItem(key)` método, que se examinarán en breve, devuelve un elemento determinado de la memoria caché según lo especificado *clave*.</span><span class="sxs-lookup"><span data-stu-id="dae6e-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="dae6e-175">Si no se encuentran ningún dichos datos en memoria caché, se recupera de la correspondiente `ProductsBLL` método de clase y, a continuación, se agrega a la caché mediante el `AddCacheItem(key, value)` método.</span><span class="sxs-lookup"><span data-stu-id="dae6e-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="dae6e-176">El `GetCacheItem(key)` y `AddCacheItem(key, value)` métodos de interfaz con la memoria caché de datos, leer y escribir valores, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="dae6e-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="dae6e-177">El `GetCacheItem(key)` método es más sencillo de los dos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="dae6e-178">Simplemente devuelve el valor de la clase de caché con el pasar de *clave*:</span><span class="sxs-lookup"><span data-stu-id="dae6e-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample6.cs)]

<span data-ttu-id="dae6e-179">`GetCacheItem(key)` no utiliza *clave* valor tal como lo suministró, sino más bien llamadas la `GetCacheKey(key)` método, que devuelve el *clave* van precedidas de ProductsCache-.</span><span class="sxs-lookup"><span data-stu-id="dae6e-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="dae6e-180">El `MasterCacheKeyArray`, que contiene la cadena ProductsCache, también se usa por la `AddCacheItem(key, value)` método, como veremos en breve.</span><span class="sxs-lookup"><span data-stu-id="dae6e-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="dae6e-181">De una clase de código subyacente ASP.NET página s, se puede acceder la caché de datos mediante el `Page` clase s [ `Cache` propiedad](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)y permite una sintaxis similar a `Cache["key"] = value`, como se describe en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="dae6e-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache["key"] = value`, as discussed in Step 2.</span></span> <span data-ttu-id="dae6e-182">Desde una clase dentro de la arquitectura, la caché de datos puede obtenerse mediante `HttpRuntime.Cache` o `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="dae6e-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="dae6e-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)de entrada de blog [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notas de la ventaja de ligeramente el rendimiento de utilizar `HttpRuntime` en lugar de `HttpContext.Current`; por lo tanto, `ProductsCL` usa `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="dae6e-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="dae6e-184">Si la arquitectura se implementa mediante proyectos de biblioteca de clases, a continuación, deberá agregar una referencia a la `System.Web` ensamblado para poder usar el [HttpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) y [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) clases.</span><span class="sxs-lookup"><span data-stu-id="dae6e-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [HttpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>


<span data-ttu-id="dae6e-185">Si el elemento no se encuentra en la memoria caché, el `ProductsCL` métodos de la clase s obtener los datos de la capa BLL y agréguelo a la caché mediante el `AddCacheItem(key, value)` método.</span><span class="sxs-lookup"><span data-stu-id="dae6e-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="dae6e-186">Para agregar *valor* podríamos usar el código siguiente, que utiliza una expiración de tiempo de 60 segundos a la memoria caché:</span><span class="sxs-lookup"><span data-stu-id="dae6e-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample7.cs)]

<span data-ttu-id="dae6e-187">`DateTime.Now.AddSeconds(CacheDuration)` Especifica la expiración basada en tiempo de 60 segundos en el futuro mientras [ `System.Web.Caching.Cache.NoSlidingExpiration` ](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) no indica que existen s ninguna fecha de expiración variable.</span><span class="sxs-lookup"><span data-stu-id="dae6e-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="dae6e-188">Mientras este `Insert` sobrecarga del método tiene parámetros para ambos absoluta de entrada y el plazo de expiración, solo puede proporcionar uno de los dos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="dae6e-189">Si intenta especificar un tiempo absoluto y un intervalo de tiempo, el `Insert` método producirá una `ArgumentException` excepción.</span><span class="sxs-lookup"><span data-stu-id="dae6e-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="dae6e-190">Esta implementación de la `AddCacheItem(key, value)` método actualmente tiene algunas limitaciones.</span><span class="sxs-lookup"><span data-stu-id="dae6e-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="dae6e-191">Comenzaremos abordar y solucionar estos problemas en el paso 4.</span><span class="sxs-lookup"><span data-stu-id="dae6e-191">We'll address and overcome these issues in Step 4.</span></span>


## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="dae6e-192">Paso 4: Invalidar la memoria caché cuando los datos es modificado a través de la arquitectura</span><span class="sxs-lookup"><span data-stu-id="dae6e-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="dae6e-193">Junto con los métodos de recuperación de datos, debe proporcionar los mismos métodos que BLL para insertar, actualizar y eliminar datos de la capa de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="dae6e-194">Los métodos de modificación de datos de CL s no modifican los datos en caché, pero en su lugar se llame al método de modificación de datos correspondiente de BLL s y, a continuación, invalidar la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="dae6e-195">Como hemos visto en el tutorial anterior, este comportamiento es el mismo que el origen ObjectDataSource se aplica cuando se habilitan las características de almacenamiento en caché y su `Insert`, `Update`, o `Delete` los métodos se invocan.</span><span class="sxs-lookup"><span data-stu-id="dae6e-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="dae6e-196">La siguiente `UpdateProduct` sobrecarga ilustra cómo implementar los métodos de modificación de datos en la CL:</span><span class="sxs-lookup"><span data-stu-id="dae6e-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample8.cs)]

<span data-ttu-id="dae6e-197">Se invoca la modificación de datos correspondiente método de la capa de lógica empresarial, pero antes de devolver su respuesta es necesario invalidar la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="dae6e-198">Desafortunadamente, lo que invalida la memoria caché no es sencillo porque la `ProductsCL` clase s `GetProducts()` y `GetProductsByCategoryID(categoryID)` métodos cada agregan elementos a la memoria caché con claves diferentes y el `GetProductsByCategoryID(categoryID)` método agrega un elemento de caché diferente para cada uno único *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="dae6e-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="dae6e-199">Al invalidar la memoria caché, es necesario quitar *todas* de los elementos que se han agregado por el `ProductsCL` clase.</span><span class="sxs-lookup"><span data-stu-id="dae6e-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="dae6e-200">Esto puede realizarse mediante la asociación de un *la dependencia de caché* con cada elemento agregado a la memoria caché en el `AddCacheItem(key, value)` método.</span><span class="sxs-lookup"><span data-stu-id="dae6e-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="dae6e-201">En general, una dependencia de caché puede ser otro elemento en la memoria caché, un archivo en el sistema de archivos o datos de una base de datos de Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dae6e-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="dae6e-202">Cuando la dependencia cambia o se quita de la memoria caché, los elementos de la memoria caché está asociado automáticamente se expulsan de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="dae6e-203">Para este tutorial, queremos crear un elemento adicional en la memoria caché que actúa como una dependencia de caché para todos los elementos agregados a través del `ProductsCL` clase.</span><span class="sxs-lookup"><span data-stu-id="dae6e-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="dae6e-204">De este modo, todos estos elementos pueden quitarse de la memoria caché quitando la dependencia de caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="dae6e-205">Actualización de s Let el `AddCacheItem(key, value)` está asociado con una dependencia de caché único método para que cada elemento se agrega a la memoria caché a través de este método:</span><span class="sxs-lookup"><span data-stu-id="dae6e-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample9.cs)]

<span data-ttu-id="dae6e-206">`MasterCacheKeyArray` es una matriz de cadenas que contiene un valor único, ProductsCache.</span><span class="sxs-lookup"><span data-stu-id="dae6e-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="dae6e-207">En primer lugar, un elemento de caché se agrega a la memoria caché y asigna la fecha y hora actuales.</span><span class="sxs-lookup"><span data-stu-id="dae6e-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="dae6e-208">Si ya existe un elemento de la caché, se actualiza.</span><span class="sxs-lookup"><span data-stu-id="dae6e-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="dae6e-209">A continuación, se crea una dependencia de caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="dae6e-210">El [ `CacheDependency` clase](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) constructor s tiene un número de sobrecargas, pero lo que se usan aquí espera dos `string` entradas de la matriz.</span><span class="sxs-lookup"><span data-stu-id="dae6e-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `string` array inputs.</span></span> <span data-ttu-id="dae6e-211">La primera de ellas especifica el conjunto de archivos que se usará como dependencias.</span><span class="sxs-lookup"><span data-stu-id="dae6e-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="dae6e-212">Puesto que no queremos t desea utilizar las dependencias basadas en archivos, un valor de `null` se usa para el primer parámetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="dae6e-212">Since we don t want to use any file-based dependencies, a value of `null` is used for the first input parameter.</span></span> <span data-ttu-id="dae6e-213">El segundo parámetro de entrada especifica el conjunto de claves de caché que se usarán como dependencias.</span><span class="sxs-lookup"><span data-stu-id="dae6e-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="dae6e-214">Aquí especificamos nuestra dependencia única, `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="dae6e-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="dae6e-215">El `CacheDependency` , a continuación, se pasa a la `Insert` método.</span><span class="sxs-lookup"><span data-stu-id="dae6e-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="dae6e-216">Con esta modificación `AddCacheItem(key, value)`, invaliding la memoria caché es tan sencilla como eliminar la dependencia.</span><span class="sxs-lookup"><span data-stu-id="dae6e-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample10.cs)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="dae6e-217">Paso 5: Llamar a la capa de almacenamiento en caché desde la capa de presentación</span><span class="sxs-lookup"><span data-stu-id="dae6e-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="dae6e-218">Los métodos y clases de s de capa de almacenamiento en caché pueden usarse para trabajar con datos mediante las técnicas se ve examina a lo largo de estos tutoriales.</span><span class="sxs-lookup"><span data-stu-id="dae6e-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="dae6e-219">Para ilustrar cómo trabajar con datos almacenados en caché, guardar los cambios realizados en el `ProductsCL` clase y, a continuación, abra el `FromTheArchitecture.aspx` página en el `Caching` carpeta y agregue un control GridView.</span><span class="sxs-lookup"><span data-stu-id="dae6e-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="dae6e-220">En la etiqueta inteligente s GridView, cree un nuevo origen ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="dae6e-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="dae6e-221">En el paso del asistente s primero debería ver el `ProductsCL` de clase como una de las opciones de la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="dae6e-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>


<span data-ttu-id="dae6e-222">[![La clase ProductsCL se incluye en la lista desplegable de objeto de negocio](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="dae6e-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span></span>

<span data-ttu-id="dae6e-223">**Figura 4**: El `ProductsCL` clase se incluye en la lista desplegable de objeto de negocio ([haga clic aquí para ver imagen en tamaño completo](caching-data-in-the-architecture-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="dae6e-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image6.png))</span></span>


<span data-ttu-id="dae6e-224">Después de seleccionar `ProductsCL`, haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="dae6e-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="dae6e-225">La lista desplegable en la ficha Seleccionar tiene dos elementos - `GetProducts()` y `GetProductsByCategoryID(categoryID)` y la pestaña de actualización tiene el mero `UpdateProduct` sobrecargar.</span><span class="sxs-lookup"><span data-stu-id="dae6e-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="dae6e-226">Elija la `GetProducts()` método desde la ficha Seleccionar y `UpdateProducts` método desde la pestaña de la actualización y haga clic en Finalizar.</span><span class="sxs-lookup"><span data-stu-id="dae6e-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>


<span data-ttu-id="dae6e-227">[![Se enumeran los métodos de la clase ProductsCL s en el cuadro desplegable enumera](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="dae6e-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span></span>

<span data-ttu-id="dae6e-228">**Figura 5**: El `ProductsCL` en las listas de la lista desplegable se enumeran los métodos de clase s ([haga clic aquí para ver imagen en tamaño completo](caching-data-in-the-architecture-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="dae6e-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image9.png))</span></span>


<span data-ttu-id="dae6e-229">Después de completar el asistente, Visual Studio establecerá la s ObjectDataSource `OldValuesParameterFormatString` propiedad `original_{0}` y agregue los campos correspondientes en el control GridView.</span><span class="sxs-lookup"><span data-stu-id="dae6e-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="dae6e-230">Cambiar el `OldValuesParameterFormatString` propiedad a su valor predeterminado, `{0}`y configurar el control GridView para admitir la paginación, ordenación y edición.</span><span class="sxs-lookup"><span data-stu-id="dae6e-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="dae6e-231">Puesto que el `UploadProducts` sobrecarga utilizada por el CL acepta únicamente el nombre de producto modificada s y precio, limitar el control GridView para que solo estos campos son editables.</span><span class="sxs-lookup"><span data-stu-id="dae6e-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="dae6e-232">En el tutorial anterior, hemos definido una clase GridView para incluir campos para el `ProductName`, `CategoryName`, y `UnitPrice` campos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="dae6e-233">No dude en replicar este formato y la estructura, en cuyo caso la s GridView y ObjectDataSource declarativa marcado debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="dae6e-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](caching-data-in-the-architecture-cs/samples/sample11.aspx)]

<span data-ttu-id="dae6e-234">En este momento tenemos una página que usa la capa de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="dae6e-235">Para ver la memoria caché en acción, establecer puntos de interrupción el `ProductsCL` clase s `GetProducts()` y `UpdateProduct` métodos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="dae6e-236">Visite la página en un explorador y recorrer el código cuando la ordenación y paginación con el fin de ver los datos extraen de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="dae6e-237">A continuación, actualizar un registro y observe que invalida la memoria caché y, por lo tanto, se recupera de la capa BLL cuando se vuelve a enlazar los datos en GridView.</span><span class="sxs-lookup"><span data-stu-id="dae6e-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="dae6e-238">La capa de almacenamiento en caché proporcionada en la descarga que acompaña este artículo no está completa.</span><span class="sxs-lookup"><span data-stu-id="dae6e-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="dae6e-239">Contiene solo una clase `ProductsCL`, que sólo dispone de una serie de métodos.</span><span class="sxs-lookup"><span data-stu-id="dae6e-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="dae6e-240">Además, una sola página ASP.NET usa el CL (`~/Caching/FromTheArchitecture.aspx`) todos los demás aún hacen referencia a la capa BLL directamente.</span><span class="sxs-lookup"><span data-stu-id="dae6e-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="dae6e-241">Si planea usar un CL en la aplicación, todas las llamadas desde la capa de presentación deben ir a la CL, lo que requeriría que las clases de CL s y los métodos que tratan esas clases y métodos en la capa BLL utilizado actualmente por la capa de presentación.</span><span class="sxs-lookup"><span data-stu-id="dae6e-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>


## <a name="summary"></a><span data-ttu-id="dae6e-242">Resumen</span><span class="sxs-lookup"><span data-stu-id="dae6e-242">Summary</span></span>

<span data-ttu-id="dae6e-243">Aunque el almacenamiento en caché se puede aplicar en la capa de presentación con ASP.NET 2.0 s SqlDataSource y ObjectDataSource controles, lo ideal es que las responsabilidades de almacenamiento en caché podría delegarse a un nivel independiente en la arquitectura.</span><span class="sxs-lookup"><span data-stu-id="dae6e-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="dae6e-244">En este tutorial, creamos una capa de almacenamiento en caché que se encuentra entre la capa de presentación y la capa de lógica empresarial.</span><span class="sxs-lookup"><span data-stu-id="dae6e-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="dae6e-245">La capa de almacenamiento en caché debe proporcionar el mismo conjunto de clases y métodos que existen en el nivel de lógica empresarial y se llaman desde la capa de presentación.</span><span class="sxs-lookup"><span data-stu-id="dae6e-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="dae6e-246">Los ejemplos de la capa de almacenamiento en caché, analizamos en este y los tutoriales anteriores se mostró *carga reactiva*.</span><span class="sxs-lookup"><span data-stu-id="dae6e-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="dae6e-247">La carga reactiva, los datos se cargan en la memoria caché solo cuando se realiza una solicitud para los datos y falta que los datos de la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="dae6e-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="dae6e-248">También pueden ser datos *proactivamente cargado* en la memoria caché, una técnica que carga los datos en la memoria caché antes de que realmente es necesario.</span><span class="sxs-lookup"><span data-stu-id="dae6e-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="dae6e-249">En el siguiente tutorial, veremos un ejemplo de carga automático cuando nos centramos en cómo almacenar valores estáticos en la memoria caché al iniciarse la aplicación.</span><span class="sxs-lookup"><span data-stu-id="dae6e-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="dae6e-250">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="dae6e-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="dae6e-251">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="dae6e-251">About the Author</span></span>

<span data-ttu-id="dae6e-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros sobre ASP/ASP.NET y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), trabaja con tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="dae6e-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="dae6e-253">Scott trabaja como consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="dae6e-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="dae6e-254">Su último libro es [*SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="dae6e-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="dae6e-255">Puede ponerse en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="dae6e-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="dae6e-256">o a través de su blog, que puede encontrarse en [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="dae6e-256">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="dae6e-257">Agradecimientos especiales a</span><span class="sxs-lookup"><span data-stu-id="dae6e-257">Special Thanks To</span></span>

<span data-ttu-id="dae6e-258">Esta serie de tutoriales ha sido revisada por muchos revisores útiles.</span><span class="sxs-lookup"><span data-stu-id="dae6e-258">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="dae6e-259">Revisor de clientes potencial para este tutorial era Teresa Murph.</span><span class="sxs-lookup"><span data-stu-id="dae6e-259">Lead reviewer for this tutorial was Teresa Murph.</span></span> <span data-ttu-id="dae6e-260">¿Está interesado en leer mi próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="dae6e-260">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="dae6e-261">Si es así, envíeme una línea en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="dae6e-261">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="dae6e-262">[Anterior](caching-data-with-the-objectdatasource-cs.md)
> [Siguiente](caching-data-at-application-startup-cs.md)</span><span class="sxs-lookup"><span data-stu-id="dae6e-262">[Previous](caching-data-with-the-objectdatasource-cs.md)
[Next](caching-data-at-application-startup-cs.md)</span></span>
