---
uid: web-pages/overview/ui-layouts-and-themes/18-customizing-site-wide-behavior
title: Personalizar el comportamiento de todo el sitio para sitios de ASP.NET Web Pages (Razor) | Microsoft Docs
author: Rick-Anderson
description: En este capítulo se explica cómo establecer la configuración en todo el sitio web o en una carpeta completa, en lugar de simplemente en una página.
ms.author: riande
ms.date: 02/17/2014
ms.assetid: e158bed7-226f-4275-b02e-7553bd58c669
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/18-customizing-site-wide-behavior
msc.type: authoredcontent
ms.openlocfilehash: f05e05f725d9209bce283ce18659ae5efe4de2ee
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78515251"
---
# <a name="customizing-site-wide-behavior-for-aspnet-web-pages-razor-sites"></a><span data-ttu-id="b4166-103">Personalización del comportamiento en todo el sitio para sitios de ASP.NET Web Pages (Razor)</span><span class="sxs-lookup"><span data-stu-id="b4166-103">Customizing Site-Wide Behavior for ASP.NET Web Pages (Razor) Sites</span></span>

<span data-ttu-id="b4166-104">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="b4166-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="b4166-105">En este artículo se explica cómo crear la configuración del sitio para las páginas en un sitio web de ASP.NET Web Pages (Razor).</span><span class="sxs-lookup"><span data-stu-id="b4166-105">This article explains how to make site-side settings for pages in an ASP.NET Web Pages (Razor) website.</span></span>
> 
> <span data-ttu-id="b4166-106">Temas que se abordarán:</span><span class="sxs-lookup"><span data-stu-id="b4166-106">What you'll learn:</span></span>
> 
> - <span data-ttu-id="b4166-107">Cómo ejecutar código que le permite establecer valores (valores globales o valores auxiliares) para todas las páginas de un sitio.</span><span class="sxs-lookup"><span data-stu-id="b4166-107">How to run code that lets you set values (global values or helper settings) for all pages in a site.</span></span>
> - <span data-ttu-id="b4166-108">Cómo ejecutar código que le permite establecer los valores de todas las páginas de una carpeta.</span><span class="sxs-lookup"><span data-stu-id="b4166-108">How to run code that lets you set values for all pages in a folder.</span></span>
> - <span data-ttu-id="b4166-109">Cómo ejecutar código antes y después de que se cargue una página.</span><span class="sxs-lookup"><span data-stu-id="b4166-109">How to run code before and after a page loads.</span></span>
> - <span data-ttu-id="b4166-110">Cómo enviar errores a una página de error central.</span><span class="sxs-lookup"><span data-stu-id="b4166-110">How to send errors to a central error page.</span></span>
> - <span data-ttu-id="b4166-111">Cómo agregar autenticación a todas las páginas de una carpeta.</span><span class="sxs-lookup"><span data-stu-id="b4166-111">How to add authentication to all pages in a folder.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="b4166-112">Versiones de software usadas en el tutorial</span><span class="sxs-lookup"><span data-stu-id="b4166-112">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="b4166-113">ASP.NET Web Pages (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="b4166-113">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="b4166-114">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="b4166-114">WebMatrix 3</span></span>
> - <span data-ttu-id="b4166-115">Biblioteca de aplicaciones auxiliares Web de ASP.NET (paquete NuGet)</span><span class="sxs-lookup"><span data-stu-id="b4166-115">ASP.NET Web Helpers Library (NuGet package)</span></span>
>   
> 
> <span data-ttu-id="b4166-116">Este tutorial también funciona con ASP.NET Web Pages 3 y Visual Studio 2013 (o Visual Studio Express 2013 para web), salvo que no se puede usar la biblioteca de aplicaciones auxiliares Web de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b4166-116">This tutorial also works with ASP.NET Web Pages 3 and Visual Studio 2013 (or Visual Studio Express 2013 for Web), except you cannot use the ASP.NET Web Helpers Library.</span></span>

<a id="Adding_Website_Startup_Code"></a>
## <a name="adding-website-startup-code-for-aspnet-web-pages"></a><span data-ttu-id="b4166-117">Agregar código de inicio del sitio web para ASP.NET Web Pages</span><span class="sxs-lookup"><span data-stu-id="b4166-117">Adding Website Startup Code for ASP.NET Web Pages</span></span>

<span data-ttu-id="b4166-118">En gran parte del código que se escribe en ASP.NET Web Pages, una página individual puede contener todo el código necesario para esa página.</span><span class="sxs-lookup"><span data-stu-id="b4166-118">For much of the code that you write in ASP.NET Web Pages, an individual page can contain all the code that's required for that page.</span></span> <span data-ttu-id="b4166-119">Por ejemplo, si una página envía un mensaje de correo electrónico, es posible colocar todo el código para esa operación en una sola página.</span><span class="sxs-lookup"><span data-stu-id="b4166-119">For example, if a page sends an email message, it's possible to put all the code for that operation in a single page.</span></span> <span data-ttu-id="b4166-120">Esto puede incluir el código para inicializar la configuración para enviar correo electrónico (es decir, para el servidor SMTP) y para enviar el mensaje de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="b4166-120">This can include the code to initialize the settings for sending email (that is, for the SMTP server) and for sending the email message.</span></span>

<span data-ttu-id="b4166-121">Sin embargo, en algunas situaciones, puede que desee ejecutar código antes de que se ejecute cualquier página del sitio.</span><span class="sxs-lookup"><span data-stu-id="b4166-121">However, in some situations, you might want to run some code before any page on the site runs.</span></span> <span data-ttu-id="b4166-122">Esto resulta útil para establecer los valores que se pueden usar en cualquier parte del sitio (denominados *valores globales*). Por ejemplo, algunas aplicaciones auxiliares requieren que proporcione valores como la configuración de correo electrónico o las claves de cuenta.</span><span class="sxs-lookup"><span data-stu-id="b4166-122">This is useful for setting values that can be used anywhere in the site (referred to as *global values*.) For example, some helpers require you to provide values like email settings or account keys.</span></span> <span data-ttu-id="b4166-123">Puede ser útil para mantener esta configuración en valores globales.</span><span class="sxs-lookup"><span data-stu-id="b4166-123">It can be handy to keep these settings in global values.</span></span>

<span data-ttu-id="b4166-124">Para ello, puede crear una página denominada *\_AppStart. cshtml* en la raíz del sitio.</span><span class="sxs-lookup"><span data-stu-id="b4166-124">You can do this by creating a page named *\_AppStart.cshtml* in the root of the site.</span></span> <span data-ttu-id="b4166-125">Si esta página existe, se ejecuta la primera vez que se solicita una página del sitio.</span><span class="sxs-lookup"><span data-stu-id="b4166-125">If this page exists, it runs the first time any page in the site is requested.</span></span> <span data-ttu-id="b4166-126">Por lo tanto, es un buen lugar para ejecutar código con el fin de establecer valores globales.</span><span class="sxs-lookup"><span data-stu-id="b4166-126">Therefore, it's a good place to run code to set global values.</span></span> <span data-ttu-id="b4166-127">(Dado que *\_AppStart. cshtml* tiene un prefijo de subrayado, ASP.net no enviará la página a un explorador aunque los usuarios la soliciten directamente).</span><span class="sxs-lookup"><span data-stu-id="b4166-127">(Because *\_AppStart.cshtml* has an underscore prefix, ASP.NET won't send the page to a browser even if users request it directly.)</span></span>

<span data-ttu-id="b4166-128">En el diagrama siguiente se muestra cómo funciona la página de *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="b4166-128">The following diagram shows how the *\_AppStart.cshtml* page works.</span></span> <span data-ttu-id="b4166-129">Cuando llega una solicitud para una página y se trata de la primera solicitud de cualquier página del sitio, ASP.NET comprueba primero si existe una página de *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="b4166-129">When a request comes in for a page, and if this is the first request for any page in the site, ASP.NET first checks whether a *\_AppStart.cshtml* page exists.</span></span> <span data-ttu-id="b4166-130">En ese caso, se ejecuta cualquier código de la página *\_AppStart. cshtml* y, a continuación, se ejecuta la página solicitada.</span><span class="sxs-lookup"><span data-stu-id="b4166-130">If so, any code in the *\_AppStart.cshtml* page runs, and then the requested page runs.</span></span>

![[imagen]](18-customizing-site-wide-behavior/_static/image1.jpg)

## <a name="setting-global-values-for-your-website"></a><span data-ttu-id="b4166-132">Establecer valores globales para el sitio web</span><span class="sxs-lookup"><span data-stu-id="b4166-132">Setting Global Values for Your Website</span></span>

1. <span data-ttu-id="b4166-133">En la carpeta raíz de un sitio web de WebMatrix, cree un archivo denominado *\_AppStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="b4166-133">In the root folder of a WebMatrix website, create a file named *\_AppStart.cshtml*.</span></span> <span data-ttu-id="b4166-134">El archivo debe estar en la raíz del sitio.</span><span class="sxs-lookup"><span data-stu-id="b4166-134">The file must be in the root of the site.</span></span>
2. <span data-ttu-id="b4166-135">Reemplace el contenido existente por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-135">Replace the existing content with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample1.cshtml)]

    <span data-ttu-id="b4166-136">Este código almacena un valor en el Diccionario de `AppState`, que está disponible automáticamente para todas las páginas del sitio.</span><span class="sxs-lookup"><span data-stu-id="b4166-136">This code stores a value in the `AppState` dictionary, which is automatically available to all pages in the site.</span></span> <span data-ttu-id="b4166-137">Tenga en cuenta que el archivo *\_AppStart. cshtml* no tiene ningún marcado.</span><span class="sxs-lookup"><span data-stu-id="b4166-137">Notice that the *\_AppStart.cshtml* file does not have any markup in it.</span></span> <span data-ttu-id="b4166-138">La página ejecutará el código y, a continuación, redirigirá a la página que se solicitó originalmente.</span><span class="sxs-lookup"><span data-stu-id="b4166-138">The page will run the code and then redirect to the page that was originally requested.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b4166-139">Tenga cuidado al colocar el código en el archivo *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="b4166-139">Be careful when you put code in the *\_AppStart.cshtml* file.</span></span> <span data-ttu-id="b4166-140">Si se produce algún error en el código del archivo *\_AppStart. cshtml* , el sitio web no se iniciará.</span><span class="sxs-lookup"><span data-stu-id="b4166-140">If any errors occur in code in the *\_AppStart.cshtml* file, the website won't start.</span></span>
3. <span data-ttu-id="b4166-141">En la carpeta raíz, cree una nueva página denominada *AppName. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="b4166-141">In the root folder, create a new page named *AppName.cshtml*.</span></span>
4. <span data-ttu-id="b4166-142">Reemplace el marcado y el código predeterminados por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-142">Replace the default markup and code with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample2.html)]

    <span data-ttu-id="b4166-143">Este código extrae el valor del objeto `AppState` que estableció en la página *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="b4166-143">This code extracts the value from the `AppState` object that you set in the *\_AppStart.cshtml* page.</span></span>
5. <span data-ttu-id="b4166-144">Ejecute la página *AppName. cshtml* en un explorador.</span><span class="sxs-lookup"><span data-stu-id="b4166-144">Run the *AppName.cshtml* page in a browser.</span></span> <span data-ttu-id="b4166-145">(Asegúrese de que la página esté seleccionada en el área de trabajo **archivos** antes de ejecutarla). La página muestra el valor global.</span><span class="sxs-lookup"><span data-stu-id="b4166-145">(Make sure the page is selected in the **Files** workspace before you run it.) The page displays the global value.</span></span> 

    ![[imagen]](18-customizing-site-wide-behavior/_static/image2.jpg)

<a id="Setting_Values_For_Helpers"></a>
## <a name="setting-values-for-helpers"></a><span data-ttu-id="b4166-147">Establecer valores para aplicaciones auxiliares</span><span class="sxs-lookup"><span data-stu-id="b4166-147">Setting Values for Helpers</span></span>

<span data-ttu-id="b4166-148">Un buen uso para el archivo *\_AppStart. cshtml* es establecer los valores de las aplicaciones auxiliares que se usan en el sitio y que se deben inicializar.</span><span class="sxs-lookup"><span data-stu-id="b4166-148">A good use for the *\_AppStart.cshtml* file is to set values for helpers that you use in your site and that have to be initialized.</span></span> <span data-ttu-id="b4166-149">Algunos ejemplos típicos son la configuración de correo electrónico de la aplicación auxiliar de `WebMail` y las claves privadas y públicas de la aplicación auxiliar de `ReCaptcha`.</span><span class="sxs-lookup"><span data-stu-id="b4166-149">Typical examples are email settings for the `WebMail` helper and the private and public keys for the `ReCaptcha` helper.</span></span> <span data-ttu-id="b4166-150">En casos como estos, puede establecer los valores una vez en el *\_AppStart. cshtml* y, a continuación, ya están establecidos para todas las páginas del sitio.</span><span class="sxs-lookup"><span data-stu-id="b4166-150">In cases like these, you can set the values once in the *\_AppStart.cshtml* and then they're already set for all the pages in your site.</span></span>

<span data-ttu-id="b4166-151">En este procedimiento se muestra cómo establecer la configuración de `WebMail` globalmente.</span><span class="sxs-lookup"><span data-stu-id="b4166-151">This procedure shows you how to set `WebMail` settings globally.</span></span> <span data-ttu-id="b4166-152">(Para obtener más información acerca del uso de la aplicación auxiliar de `WebMail`, consulte [Agregar correo electrónico a un sitio de ASP.NET Web pages](../getting-started/11-adding-email-to-your-web-site.md)).</span><span class="sxs-lookup"><span data-stu-id="b4166-152">(For more information about using the `WebMail` helper, see [Adding Email to an ASP.NET Web Pages Site](../getting-started/11-adding-email-to-your-web-site.md).)</span></span>

1. <span data-ttu-id="b4166-153">Agregue la biblioteca de aplicaciones auxiliares Web de ASP.NET a su sitio web, tal como se describe en [instalación de aplicaciones auxiliares en un sitio de ASP.NET Web pages](https://go.microsoft.com/fwlink/?LinkId=252372), si aún no lo ha hecho.</span><span class="sxs-lookup"><span data-stu-id="b4166-153">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already added it.</span></span>
2. <span data-ttu-id="b4166-154">Si aún no tiene un archivo *\_AppStart. cshtml* , en la carpeta raíz de un sitio web, cree un archivo denominado *\_AppStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="b4166-154">If you don't already have a *\_AppStart.cshtml* file, in the root folder of a website create a file named *\_AppStart.cshtml*.</span></span>
3. <span data-ttu-id="b4166-155">Agregue la siguiente configuración de `WebMail` al archivo *\_AppStart. cshtml* :</span><span class="sxs-lookup"><span data-stu-id="b4166-155">Add the following `WebMail` settings to the *\_AppStart.cshtml* file:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample3.cshtml?highlight=2-7)]

    <span data-ttu-id="b4166-156">Modifique la siguiente configuración relacionada con el correo electrónico en el código:</span><span class="sxs-lookup"><span data-stu-id="b4166-156">Modify the following email related settings in the code:</span></span>

   - <span data-ttu-id="b4166-157">Establezca `your-SMTP-host` en el nombre del servidor SMTP al que tenga acceso.</span><span class="sxs-lookup"><span data-stu-id="b4166-157">Set `your-SMTP-host` to the name of the SMTP server that you have access to.</span></span>
   - <span data-ttu-id="b4166-158">Establezca `your-user-name-here` en el nombre de usuario de la cuenta del servidor SMTP.</span><span class="sxs-lookup"><span data-stu-id="b4166-158">Set `your-user-name-here` to the user name for your SMTP server account.</span></span>
   - <span data-ttu-id="b4166-159">Establezca `your-account-password` en la contraseña de la cuenta del servidor SMTP.</span><span class="sxs-lookup"><span data-stu-id="b4166-159">Set `your-account-password` to the password for your SMTP server account.</span></span>
   - <span data-ttu-id="b4166-160">Establezca `your-email-address-here` en su propia dirección de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="b4166-160">Set `your-email-address-here` to your own email address.</span></span> <span data-ttu-id="b4166-161">Esta es la dirección de correo electrónico desde la que se envía el mensaje.</span><span class="sxs-lookup"><span data-stu-id="b4166-161">This is the email address that the message is sent from.</span></span> <span data-ttu-id="b4166-162">(Algunos proveedores de correo electrónico no permiten especificar una dirección de `From` diferente y usarán su nombre de usuario como dirección `From`).</span><span class="sxs-lookup"><span data-stu-id="b4166-162">(Some email providers don't let you specify a different `From` address and will use your user name as the `From` address.)</span></span>

     <span data-ttu-id="b4166-163">Para obtener más información acerca de la configuración de SMTP, consulte Configuración del [correo](https://go.microsoft.com/fwlink/?LinkID=202899#configuring_email_settings) electrónico en el artículo [envío de correo electrónico desde un sitio de ASP.NET Web pages (Razor)](https://go.microsoft.com/fwlink/?LinkID=202899) y [problemas con el envío de correo electrónico](https://go.microsoft.com/fwlink/?LinkId=253001#email) en la [Guía de solución de problemas de ASP.NET Web pages (Razor)](https://go.microsoft.com/fwlink/?LinkId=253001).</span><span class="sxs-lookup"><span data-stu-id="b4166-163">For more information about SMTP settings, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202899#configuring_email_settings) in the article [Sending Email from an ASP.NET Web Pages (Razor) Site](https://go.microsoft.com/fwlink/?LinkID=202899) and [Issues with Sending Email](https://go.microsoft.com/fwlink/?LinkId=253001#email) in the [ASP.NET Web Pages (Razor) Troubleshooting Guide](https://go.microsoft.com/fwlink/?LinkId=253001).</span></span>
4. <span data-ttu-id="b4166-164">Guarde el archivo *\_AppStart. cshtml* y ciérrelo.</span><span class="sxs-lookup"><span data-stu-id="b4166-164">Save the *\_AppStart.cshtml* file and close it.</span></span>
5. <span data-ttu-id="b4166-165">En la carpeta raíz de un sitio web, cree una nueva página denominada *TestEmail. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="b4166-165">In the root folder of a website, create new page named *TestEmail.cshtml*.</span></span>
6. <span data-ttu-id="b4166-166">Reemplace el contenido existente por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-166">Replace the existing content with the following:</span></span> 

     [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample4.cshtml)]
7. <span data-ttu-id="b4166-167">Ejecute la página *TestEmail. cshtml* en un explorador.</span><span class="sxs-lookup"><span data-stu-id="b4166-167">Run the *TestEmail.cshtml* page in a browser.</span></span>
8. <span data-ttu-id="b4166-168">Rellene los campos para enviarse un mensaje de correo electrónico y, a continuación, haga clic en **Enviar**.</span><span class="sxs-lookup"><span data-stu-id="b4166-168">Fill in the fields to send yourself an email message and then click **Send**.</span></span>
9. <span data-ttu-id="b4166-169">Compruebe su correo electrónico para asegurarse de que ha recibido el mensaje.</span><span class="sxs-lookup"><span data-stu-id="b4166-169">Check your email to make sure you've gotten the message.</span></span>

<span data-ttu-id="b4166-170">La parte importante de este ejemplo es que la configuración que no suele cambiar, como el nombre del servidor SMTP y las credenciales de correo electrónico, se establece en el archivo *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="b4166-170">The important part of this example is that the settings that you don't usually change — like the name of your SMTP server and your email credentials — are set in the *\_AppStart.cshtml* file.</span></span> <span data-ttu-id="b4166-171">De este modo, no tendrá que volver a configurarlos en cada página en la que envíe el correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="b4166-171">That way you don't need to set them again in each page where you send email.</span></span> <span data-ttu-id="b4166-172">(Sin embargo, si por alguna razón necesita cambiar esta configuración, puede establecerla individualmente en una página). En la página, solo se establecen los valores que normalmente cambian cada vez, como el destinatario y el cuerpo del mensaje de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="b4166-172">(Although if for some reason you need to change those settings, you can set them individually in a page.) In the page, you only set the values that typically change each time, like the recipient and the body of the email message.</span></span>

<a id="Running_Code_Before_and_After"></a>
## <a name="running-code-before-and-after-files-in-a-folder"></a><span data-ttu-id="b4166-173">Ejecutar código antes y después de los archivos de una carpeta</span><span class="sxs-lookup"><span data-stu-id="b4166-173">Running Code Before and After Files in a Folder</span></span>

<span data-ttu-id="b4166-174">Del mismo modo que puede usar *\_AppStart. cshtml* para escribir código antes de que se ejecuten las páginas del sitio, puede escribir código que se ejecute antes (y después) cualquier página de una carpeta determinada que se ejecute.</span><span class="sxs-lookup"><span data-stu-id="b4166-174">Just like you can use *\_AppStart.cshtml* to write code before pages in the site run, you can write code that runs before (and after) any page in a particular folder run.</span></span> <span data-ttu-id="b4166-175">Esto resulta útil para cosas como establecer la misma página de diseño para todas las páginas de una carpeta, o para comprobar que un usuario ha iniciado sesión antes de ejecutar una página en la carpeta.</span><span class="sxs-lookup"><span data-stu-id="b4166-175">This is useful for things like setting the same layout page for all the pages in a folder, or for checking that a user is logged in before running a page in the folder.</span></span>

<span data-ttu-id="b4166-176">En el caso de las páginas de carpetas concretas, puede crear código en un archivo denominado *\_PageStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="b4166-176">For pages in particular folders, you can create code in a file named *\_PageStart.cshtml*.</span></span> <span data-ttu-id="b4166-177">En el diagrama siguiente se muestra cómo funciona la página *\_PageStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="b4166-177">The following diagram shows how the *\_PageStart.cshtml* page works.</span></span> <span data-ttu-id="b4166-178">Cuando llega una solicitud para una página, ASP.NET busca primero una página de *\_AppStart. cshtml* y la ejecuta.</span><span class="sxs-lookup"><span data-stu-id="b4166-178">When a request comes in for a page, ASP.NET first checks for a *\_AppStart.cshtml* page and runs that.</span></span> <span data-ttu-id="b4166-179">A continuación, ASP.NET comprueba si hay una\_página de *PageStart. cshtml* y, en caso afirmativo, la ejecuta.</span><span class="sxs-lookup"><span data-stu-id="b4166-179">Then ASP.NET checks whether there's a *\_PageStart.cshtml* page, and if so, runs that.</span></span> <span data-ttu-id="b4166-180">A continuación, ejecuta la página solicitada.</span><span class="sxs-lookup"><span data-stu-id="b4166-180">It then runs the requested page.</span></span>

<span data-ttu-id="b4166-181">Dentro de la página *\_PageStart. cshtml* , puede especificar dónde desea que se ejecute la página solicitada, incluyendo un método `RunPage`.</span><span class="sxs-lookup"><span data-stu-id="b4166-181">Inside the *\_PageStart.cshtml* page, you can specify where during processing you want the requested page to run by including a `RunPage` method.</span></span> <span data-ttu-id="b4166-182">Esto le permite ejecutar código antes de que se ejecute la página solicitada y, después, otra vez.</span><span class="sxs-lookup"><span data-stu-id="b4166-182">This lets you run code before the requested page runs and then again after it.</span></span> <span data-ttu-id="b4166-183">Si no incluye `RunPage`, se ejecuta todo el código de *\_PageStart. cshtml* y, a continuación, la página solicitada se ejecuta automáticamente.</span><span class="sxs-lookup"><span data-stu-id="b4166-183">If you don't include `RunPage`, all the code in *\_PageStart.cshtml* runs, and then the requested page runs automatically.</span></span>

![[imagen]](18-customizing-site-wide-behavior/_static/image3.jpg)

<span data-ttu-id="b4166-185">ASP.NET permite crear una jerarquía de archivos *\_PageStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="b4166-185">ASP.NET lets you create a hierarchy of *\_PageStart.cshtml* files.</span></span> <span data-ttu-id="b4166-186">Puede colocar un *\_archivo PageStart. cshtml* en la raíz del sitio y en cualquier subcarpeta.</span><span class="sxs-lookup"><span data-stu-id="b4166-186">You can put a *\_PageStart.cshtml* file in the root of the site and in any subfolder.</span></span> <span data-ttu-id="b4166-187">Cuando se solicita una página, se ejecuta la *\_archivo PageStart. cshtml* en el nivel superior (más cercano a la raíz del sitio), seguido del *\_archivo PageStart. cshtml* en la subcarpeta siguiente, y así sucesivamente en la estructura de la subcarpeta hasta que la solicitud llega a la carpeta que contiene la página solicitada.</span><span class="sxs-lookup"><span data-stu-id="b4166-187">When a page is requested, the *\_PageStart.cshtml* file at the top-most level (nearest to the site root) runs, followed by the *\_PageStart.cshtml* file in the next subfolder, and so on down the subfolder structure until the request reaches the folder that contains the requested page.</span></span> <span data-ttu-id="b4166-188">Una vez que se han ejecutado todos los archivos *\_PageStart. cshtml* correspondientes, se ejecuta la página solicitada.</span><span class="sxs-lookup"><span data-stu-id="b4166-188">After all the applicable *\_PageStart.cshtml* files have run, the requested page runs.</span></span>

<span data-ttu-id="b4166-189">Por ejemplo, podría tener la siguiente combinación de *\_archivos PageStart. cshtml* y el archivo *default. cshtml* :</span><span class="sxs-lookup"><span data-stu-id="b4166-189">For example, you might have the following combination of *\_PageStart.cshtml* files and *Default.cshtml* file:</span></span>

[!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample5.cshtml)]

[!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample6.cshtml)]

[!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample7.cshtml)]

<span data-ttu-id="b4166-190">Al ejecutar */MyFolder/default.cshtml*, verá lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-190">When you run */myfolder/default.cshtml*, you'll see the following:</span></span>

[!code-console[Main](18-customizing-site-wide-behavior/samples/sample8.cmd)]

## <a name="running-initialization-code-for-all-pages-in-a-folder"></a><span data-ttu-id="b4166-191">Ejecutar código de inicialización para todas las páginas de una carpeta</span><span class="sxs-lookup"><span data-stu-id="b4166-191">Running Initialization Code for All Pages in a Folder</span></span>

<span data-ttu-id="b4166-192">Un buen uso de *\_archivos PageStart. cshtml* es inicializar la misma página de diseño para todos los archivos de una sola carpeta.</span><span class="sxs-lookup"><span data-stu-id="b4166-192">A good use for *\_PageStart.cshtml* files is to initialize the same layout page for all files in a single folder.</span></span>

1. <span data-ttu-id="b4166-193">En la carpeta raíz, cree una nueva carpeta denominada *InitPages*.</span><span class="sxs-lookup"><span data-stu-id="b4166-193">In the root folder, create a new folder named *InitPages*.</span></span>
2. <span data-ttu-id="b4166-194">En la carpeta *InitPages* de su sitio web, cree un archivo denominado *\_PageStart. cshtml* y reemplace el marcado y el código predeterminados por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-194">In the *InitPages* folder of your website, create a file named *\_PageStart.cshtml* and replace the default markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample9.cshtml)]
3. <span data-ttu-id="b4166-195">En la raíz del sitio web, cree una carpeta denominada *Shared*.</span><span class="sxs-lookup"><span data-stu-id="b4166-195">In the root of the website, create a folder named *Shared*.</span></span>
4. <span data-ttu-id="b4166-196">En la carpeta *compartida* , cree un archivo denominado *\_Layout1. cshtml* y reemplace el marcado y el código predeterminados por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-196">In the *Shared* folder, create a file named *\_Layout1.cshtml* and replace the default markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample10.cshtml)]
5. <span data-ttu-id="b4166-197">En la carpeta *InitPages* , cree un archivo denominado *Content1. cshtml* y reemplace el contenido existente por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-197">In the *InitPages* folder, create a file named *Content1.cshtml* and replace the existing content with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample11.html)]
6. <span data-ttu-id="b4166-198">En la carpeta *InitPages* , cree otro archivo denominado *Content2. cshtml* y reemplace el marcado predeterminado por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-198">In the *InitPages* folder, create another file named *Content2.cshtml* and replace the default markup with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample12.html)]
7. <span data-ttu-id="b4166-199">Ejecute *Content1. cshtml* en un explorador.</span><span class="sxs-lookup"><span data-stu-id="b4166-199">Run *Content1.cshtml* in a browser.</span></span> 

    ![[imagen]](18-customizing-site-wide-behavior/_static/image4.jpg)

    <span data-ttu-id="b4166-201">Cuando se ejecuta la página *Content1. cshtml* , el archivo *\_PageStart. cshtml* establece `Layout` y también establece `PageData["MyBackground"]` en un color.</span><span class="sxs-lookup"><span data-stu-id="b4166-201">When the *Content1.cshtml* page runs, the *\_PageStart.cshtml* file sets `Layout` and also sets `PageData["MyBackground"]` to a color.</span></span> <span data-ttu-id="b4166-202">En *Content1. cshtml*, se aplican el diseño y el color.</span><span class="sxs-lookup"><span data-stu-id="b4166-202">In *Content1.cshtml*, the layout and color are applied.</span></span>
8. <span data-ttu-id="b4166-203">Mostrar *Content2. cshtml* en un explorador.</span><span class="sxs-lookup"><span data-stu-id="b4166-203">Display *Content2.cshtml* in a browser.</span></span> 

    <span data-ttu-id="b4166-204">El diseño es el mismo, ya que ambas páginas usan la misma página de diseño y el mismo color que se inicializaron en *\_PageStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="b4166-204">The layout is the same, because both pages use the same layout page and color as initialized in *\_PageStart.cshtml*.</span></span>

## <a name="using-_pagestartcshtml-to-handle-errors"></a><span data-ttu-id="b4166-205">Uso de \_PageStart. cshtml para controlar errores</span><span class="sxs-lookup"><span data-stu-id="b4166-205">Using \_PageStart.cshtml to Handle Errors</span></span>

<span data-ttu-id="b4166-206">Otro buen uso de la *\_archivo PageStart. cshtml* es crear una manera de controlar los errores de programación (excepciones) que pueden producirse en cualquier página *. cshtml* de una carpeta.</span><span class="sxs-lookup"><span data-stu-id="b4166-206">Another good use for the *\_PageStart.cshtml* file is to create a way to handle programming errors (exceptions) that might occur in any *.cshtml* page in a folder.</span></span> <span data-ttu-id="b4166-207">En este ejemplo se muestra una manera de hacerlo.</span><span class="sxs-lookup"><span data-stu-id="b4166-207">This example shows you one way to do this.</span></span>

1. <span data-ttu-id="b4166-208">En la carpeta raíz, cree una carpeta denominada *InitCatch*.</span><span class="sxs-lookup"><span data-stu-id="b4166-208">In the root folder, create a folder named *InitCatch*.</span></span>
2. <span data-ttu-id="b4166-209">En la carpeta *InitCatch* de su sitio web, cree un archivo denominado *\_PageStart. cshtml* y reemplace el marcado y el código existentes por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-209">In the *InitCatch* folder of your website, create a file named *\_PageStart.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample13.cshtml)]

    <span data-ttu-id="b4166-210">En este código, intente ejecutar la página solicitada explícitamente llamando al método `RunPage` dentro de un bloque `try`.</span><span class="sxs-lookup"><span data-stu-id="b4166-210">In this code, you try running the requested page explicitly by calling the `RunPage` method inside a `try` block.</span></span> <span data-ttu-id="b4166-211">Si se produce algún error de programación en la página solicitada, se ejecuta el código dentro del bloque `catch`.</span><span class="sxs-lookup"><span data-stu-id="b4166-211">If any programming errors occur in the requested page, the code inside the `catch` block runs.</span></span> <span data-ttu-id="b4166-212">En este caso, el código redirige a una página (*error. cshtml*) y pasa el nombre del archivo que experimentó el error como parte de la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="b4166-212">In this case, the code redirects to a page (*Error.cshtml*) and passes the name of the file that experienced the error as part of the URL.</span></span> <span data-ttu-id="b4166-213">(Creará la página en breve).</span><span class="sxs-lookup"><span data-stu-id="b4166-213">(You'll create the page shortly.)</span></span>
3. <span data-ttu-id="b4166-214">En la carpeta *InitCatch* de su sitio web, cree un archivo denominado *Exception. cshtml* y reemplace el marcado y el código existentes por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-214">In the *InitCatch* folder of your website, create a file named *Exception.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample14.cshtml)]

    <span data-ttu-id="b4166-215">Para los fines de este ejemplo, lo que está haciendo en esta página es la creación deliberada de un error al intentar abrir un archivo de base de datos que no existe.</span><span class="sxs-lookup"><span data-stu-id="b4166-215">For purposes of this example, what you're doing in this page is deliberately creating an error by trying to open a database file that doesn't exist.</span></span>
4. <span data-ttu-id="b4166-216">En la carpeta raíz, cree un archivo denominado *error. cshtml* y reemplace el marcado y el código existentes por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-216">In the root folder, create a file named *Error.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample15.html)]

    <span data-ttu-id="b4166-217">En esta página, la expresión `@Request["source"]` obtiene el valor de la dirección URL y lo muestra.</span><span class="sxs-lookup"><span data-stu-id="b4166-217">In this page, the expression `@Request["source"]` gets the value out of the URL and displays it.</span></span>
5. <span data-ttu-id="b4166-218">En la barra de herramientas, haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="b4166-218">In the toolbar, click **Save**.</span></span>
6. <span data-ttu-id="b4166-219">Ejecute *Exception. cshtml* en un explorador.</span><span class="sxs-lookup"><span data-stu-id="b4166-219">Run *Exception.cshtml* in a browser.</span></span> 

    ![[imagen]](18-customizing-site-wide-behavior/_static/image5.jpg)

    <span data-ttu-id="b4166-221">Dado que se produce un error en *Exception. cshtml*, la página *\_PageStart. cshtml* redirige al archivo *error. cshtml* , que muestra el mensaje.</span><span class="sxs-lookup"><span data-stu-id="b4166-221">Because an error occurs in *Exception.cshtml*, the *\_PageStart.cshtml* page redirects to the *Error.cshtml* file, which displays the message.</span></span>

    <span data-ttu-id="b4166-222">Para obtener más información sobre las excepciones, vea [Introducción a la programación de ASP.NET Web pages mediante la sintaxis Razor](https://go.microsoft.com/fwlink/?LinkID=251587).</span><span class="sxs-lookup"><span data-stu-id="b4166-222">For more information about exceptions, see [Introduction to ASP.NET Web Pages Programming Using the Razor Syntax](https://go.microsoft.com/fwlink/?LinkID=251587).</span></span>

<a id="Using__PageStart.cshtml_to_Restrict_Folder_Access"></a>
## <a name="using-_pagestartcshtml-to-restrict-folder-access"></a><span data-ttu-id="b4166-223">Usar \_PageStart. cshtml para restringir el acceso a las carpetas</span><span class="sxs-lookup"><span data-stu-id="b4166-223">Using \_PageStart.cshtml to Restrict Folder Access</span></span>

<span data-ttu-id="b4166-224">También puede usar el archivo *\_PageStart. cshtml* para restringir el acceso a todos los archivos de una carpeta.</span><span class="sxs-lookup"><span data-stu-id="b4166-224">You can also use the *\_PageStart.cshtml* file to restrict access to all the files in a folder.</span></span>

1. <span data-ttu-id="b4166-225">En WebMatrix, cree un nuevo sitio web con la opción **sitio a partir de plantilla** .</span><span class="sxs-lookup"><span data-stu-id="b4166-225">In WebMatrix, create a new website using the **Site From Template** option.</span></span>
2. <span data-ttu-id="b4166-226">En plantillas disponibles, seleccione **sitio de inicio**.</span><span class="sxs-lookup"><span data-stu-id="b4166-226">From the available templates, select **Starter Site**.</span></span>
3. <span data-ttu-id="b4166-227">En la carpeta raíz, cree una carpeta denominada *AuthenticatedContent*.</span><span class="sxs-lookup"><span data-stu-id="b4166-227">In the root folder, create a folder named *AuthenticatedContent*.</span></span>
4. <span data-ttu-id="b4166-228">En la carpeta *AuthenticatedContent* , cree un archivo denominado *\_PageStart. cshtml* y reemplace el marcado y el código existentes por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-228">In the *AuthenticatedContent* folder, create a file named *\_PageStart.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample16.cshtml)]

    <span data-ttu-id="b4166-229">El código comienza evitando que se almacenen en caché todos los archivos de la carpeta.</span><span class="sxs-lookup"><span data-stu-id="b4166-229">The code starts by preventing all files in the folder from being cached.</span></span> <span data-ttu-id="b4166-230">(Esto es necesario para escenarios como equipos públicos, donde no desea que las páginas almacenadas en caché de un usuario estén disponibles para el siguiente usuario). A continuación, el código determina si el usuario ha iniciado sesión en el sitio para que pueda ver cualquiera de las páginas de la carpeta.</span><span class="sxs-lookup"><span data-stu-id="b4166-230">(This is required for scenarios like public computers, where you don't want one user's cached pages to be available to the next user.) Next, the code determines whether the user has signed in to the site before they can view any of the pages in the folder.</span></span> <span data-ttu-id="b4166-231">Si el usuario no ha iniciado sesión, el código redirige a la página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="b4166-231">If the user is not signed in, the code redirects to the login page.</span></span> <span data-ttu-id="b4166-232">La página de inicio de sesión puede devolver al usuario a la página que se solicitó originalmente si incluye un valor de cadena de consulta denominado `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="b4166-232">The login page can return the user to the page that was originally requested if you include a query string value named `ReturnUrl`.</span></span>
5. <span data-ttu-id="b4166-233">Cree una nueva página en la carpeta *AuthenticatedContent* denominada *Page. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="b4166-233">Create a new page in the *AuthenticatedContent* folder named *Page.cshtml*.</span></span>
6. <span data-ttu-id="b4166-234">Reemplace el marcado predeterminado por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b4166-234">Replace the default markup with the following:</span></span>  

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample17.cshtml)]
7. <span data-ttu-id="b4166-235">Ejecute *Page. cshtml* en un explorador.</span><span class="sxs-lookup"><span data-stu-id="b4166-235">Run *Page.cshtml* in a browser.</span></span> <span data-ttu-id="b4166-236">El código le redirige a una página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="b4166-236">The code redirects you to a login page.</span></span> <span data-ttu-id="b4166-237">Debe registrarse antes de iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="b4166-237">You must register before logging in.</span></span> <span data-ttu-id="b4166-238">Después de haber registrado y iniciado sesión, puede navegar a la página y ver su contenido.</span><span class="sxs-lookup"><span data-stu-id="b4166-238">After you've registered and logged in, you can navigate to the page and view its contents.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="b4166-239">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="b4166-239">Additional Resources</span></span>

[<span data-ttu-id="b4166-240">Introducción a la programación de ASP.NET Web Pages mediante la sintaxis Razor</span><span class="sxs-lookup"><span data-stu-id="b4166-240">Introduction to ASP.NET Web Pages Programming Using the Razor Syntax</span></span>](https://go.microsoft.com/fwlink/?LinkID=251587)
