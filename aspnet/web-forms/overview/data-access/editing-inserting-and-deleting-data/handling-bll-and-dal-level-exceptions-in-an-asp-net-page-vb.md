---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb
title: Control de excepciones de nivel BLL y DAL en una página ASP.NET (VB) | Microsoft Docs
author: rick-anderson
description: En este tutorial, veremos cómo mostrar un mensaje de error informativo y sencillo debe producir una excepción durante la operación de inserción, actualización o delete de...
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 129d4338-1315-4f40-89b5-2b84b807707d
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb
msc.type: authoredcontent
ms.openlocfilehash: 86b8bb00e83f311d311a51a747086356833a8c93
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/01/2019
ms.locfileid: "57060922"
---
<a name="handling-bll--and-dal-level-exceptions-in-an-aspnet-page-vb"></a><span data-ttu-id="9c80b-103">Controlar las excepciones de nivel BLL y DAL en una página de ASP.NET (VB)</span><span class="sxs-lookup"><span data-stu-id="9c80b-103">Handling BLL- and DAL-Level Exceptions in an ASP.NET Page (VB)</span></span>
====================
<span data-ttu-id="9c80b-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9c80b-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9c80b-105">[Descargue la aplicación de ejemplo](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_VB.exe) o [descargar PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/datatutorial18vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9c80b-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/datatutorial18vb1.pdf)</span></span>

> <span data-ttu-id="9c80b-106">En este tutorial, veremos cómo mostrar un mensaje informativo y sencillo error se debe producir una excepción durante una inserción, la actualización o la operación de eliminación de un control Web de datos ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9c80b-106">In this tutorial we will see how to display a friendly, informative error message should an exception occur during an insert, update, or delete operation of an ASP.NET data Web control.</span></span>


## <a name="introduction"></a><span data-ttu-id="9c80b-107">Introducción</span><span class="sxs-lookup"><span data-stu-id="9c80b-107">Introduction</span></span>

<span data-ttu-id="9c80b-108">Trabajar con datos desde una aplicación web ASP.NET con una arquitectura en capas de aplicación implica los siguientes tres pasos generales:</span><span class="sxs-lookup"><span data-stu-id="9c80b-108">Working with data from an ASP.NET web application using a tiered application architecture involves the following three general steps:</span></span>

1. <span data-ttu-id="9c80b-109">Determinar qué método de la capa de lógica empresarial debe invocarse y valores de parámetro what para pasarla.</span><span class="sxs-lookup"><span data-stu-id="9c80b-109">Determine what method of the Business Logic Layer needs to be invoked and what parameter values to pass it.</span></span> <span data-ttu-id="9c80b-110">Los valores de parámetro pueden ser codificado, asignado mediante programación o escrito por el usuario.</span><span class="sxs-lookup"><span data-stu-id="9c80b-110">The parameter values can be hard coded, programmatically-assigned, or inputs entered by the user.</span></span>
2. <span data-ttu-id="9c80b-111">Invoque al método.</span><span class="sxs-lookup"><span data-stu-id="9c80b-111">Invoke the method.</span></span>
3. <span data-ttu-id="9c80b-112">Procesar los resultados.</span><span class="sxs-lookup"><span data-stu-id="9c80b-112">Process the results.</span></span> <span data-ttu-id="9c80b-113">Al llamar a un método BLL que devuelve datos, esto puede implicar el enlace de datos a un control Web de datos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-113">When calling a BLL method that returns data, this may involve binding the data to a data Web control.</span></span> <span data-ttu-id="9c80b-114">Para los métodos BLL que modifican datos, esto puede incluir realizar alguna acción según un valor devuelto o controlar correctamente cualquier excepción que se produjeron en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="9c80b-114">For BLL methods that modify data, this may include performing some action based on a return value or gracefully handling any exception that arose in Step 2.</span></span>

<span data-ttu-id="9c80b-115">Como hemos visto en el [tutorial anterior](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md), ObjectDataSource y los controles Web de datos proporcionan puntos de extensibilidad para los pasos 1 y 3.</span><span class="sxs-lookup"><span data-stu-id="9c80b-115">As we saw in the [previous tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md), both the ObjectDataSource and the data Web controls provide extensibility points for Steps 1 and 3.</span></span> <span data-ttu-id="9c80b-116">El control GridView, por ejemplo, se activa su `RowUpdating` eventos antes de asignar sus valores de campo a su ObjectDataSource `UpdateParameters` colección; su `RowUpdated` evento se desencadena después de que el origen ObjectDataSource ha finalizado la operación.</span><span class="sxs-lookup"><span data-stu-id="9c80b-116">The GridView, for example, fires its `RowUpdating` event prior to assigning its field values to its ObjectDataSource's `UpdateParameters` collection; its `RowUpdated` event is raised after the ObjectDataSource has completed the operation.</span></span>

<span data-ttu-id="9c80b-117">Ya hemos examinado los eventos que se activan durante el paso 1 y han visto cómo se puede usar para personalizar los parámetros de entrada o cancelar la operación.</span><span class="sxs-lookup"><span data-stu-id="9c80b-117">We've already examined the events that fire during Step 1 and have seen how they can be used to customize the input parameters or cancel the operation.</span></span> <span data-ttu-id="9c80b-118">En este tutorial, centraremos nuestra atención a los eventos que activan una vez completada la operación.</span><span class="sxs-lookup"><span data-stu-id="9c80b-118">In this tutorial we'll turn our attention to the events that fire after the operation has completed.</span></span> <span data-ttu-id="9c80b-119">Con estos controladores de eventos posteriores al nivel que se puede, entre otras cosas, determinar si se produjo una excepción durante la operación y lo maneje debidamente, mostrar un mensaje de error informativo y sencillo en la pantalla, en lugar de con el estándar de ASP.NET predeterminado página de excepciones.</span><span class="sxs-lookup"><span data-stu-id="9c80b-119">With these post-level event handlers we can, among other things, determine if an exception occurred during the operation and handle it gracefully, displaying a friendly, informative error message on the screen rather than defaulting to the standard ASP.NET exception page.</span></span>

<span data-ttu-id="9c80b-120">Para ilustrar cómo trabajar con estos eventos posteriores al niveles, vamos a crear una página que enumera los productos en un control GridView editable.</span><span class="sxs-lookup"><span data-stu-id="9c80b-120">To illustrate working with these post-level events, let's create a page that lists the products in an editable GridView.</span></span> <span data-ttu-id="9c80b-121">Al actualizar un producto, si es una excepción provoca nuestro ASP.NET página mostrará un mensaje breve por encima del control GridView que explica que se ha producido un problema.</span><span class="sxs-lookup"><span data-stu-id="9c80b-121">When updating a product, if an exception is raised our ASP.NET page will display a short message above the GridView explaining that a problem has occurred.</span></span> <span data-ttu-id="9c80b-122">Comencemos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-122">Let's get started!</span></span>

## <a name="step-1-creating-an-editable-gridview-of-products"></a><span data-ttu-id="9c80b-123">Paso 1: Creación de un control GridView Editable de productos</span><span class="sxs-lookup"><span data-stu-id="9c80b-123">Step 1: Creating an Editable GridView of Products</span></span>

<span data-ttu-id="9c80b-124">En el tutorial anterior, creamos un control GridView editable con solo dos campos, `ProductName` y `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="9c80b-124">In the previous tutorial we created an editable GridView with just two fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="9c80b-125">Esto requiere la creación de una sobrecarga adicional para la `ProductsBLL` la clase `UpdateProduct` método, que solo acepta tres parámetros de entrada (nombre del producto, precio unitario e Id.) en oposición como un parámetro para cada campo de producto.</span><span class="sxs-lookup"><span data-stu-id="9c80b-125">This required creating an additional overload for the `ProductsBLL` class's `UpdateProduct` method, one that only accepted three input parameters (the product's name, unit price, and ID) as opposed a parameter for each product field.</span></span> <span data-ttu-id="9c80b-126">Para este tutorial, vamos a práctica esta técnica de nuevo, crear un control GridView editable que muestra el nombre del producto, cantidad por unidad, el precio por unidad y las unidades en existencias, pero solo permite el nombre, precio unitario y las unidades en existencias para editarse.</span><span class="sxs-lookup"><span data-stu-id="9c80b-126">For this tutorial, let's practice this technique again, creating an editable GridView that displays the product's name, quantity per unit, unit price, and units in stock, but only allows the name, unit price, and units in stock to be edited.</span></span>

<span data-ttu-id="9c80b-127">Para dar cabida a este escenario se necesitará otra sobrecarga de la `UpdateProduct` método, que acepta cuatro parámetros: el nombre del producto, precio unitario, las unidades en existencias y el identificador.</span><span class="sxs-lookup"><span data-stu-id="9c80b-127">To accommodate this scenario we'll need another overload of the `UpdateProduct` method, one that accepts four parameters: the product's name, unit price, units in stock, and ID.</span></span> <span data-ttu-id="9c80b-128">Agregue el método siguiente a la `ProductsBLL` clase:</span><span class="sxs-lookup"><span data-stu-id="9c80b-128">Add the following method to the `ProductsBLL` class:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample1.vb)]

<span data-ttu-id="9c80b-129">Con este método completa, ya estamos listos para crear la página ASP.NET que permite la edición de estos cuatro campos de producto en particular.</span><span class="sxs-lookup"><span data-stu-id="9c80b-129">With this method complete, we're ready to create the ASP.NET page that allows for editing these four particular product fields.</span></span> <span data-ttu-id="9c80b-130">Abra el `ErrorHandling.aspx` página en el `EditInsertDelete` carpeta y agregue un control GridView a la página a través del diseñador.</span><span class="sxs-lookup"><span data-stu-id="9c80b-130">Open the `ErrorHandling.aspx` page in the `EditInsertDelete` folder and add a GridView to the page through the Designer.</span></span> <span data-ttu-id="9c80b-131">Enlazar el control GridView a un nuevo origen ObjectDataSource, asignación el `Select()` método a la `ProductsBLL` la clase `GetProducts()` método y el `Update()` método a la `UpdateProduct` sobrecarga que acaba de crear.</span><span class="sxs-lookup"><span data-stu-id="9c80b-131">Bind the GridView to a new ObjectDataSource, mapping the `Select()` method to the `ProductsBLL` class's `GetProducts()` method and the `Update()` method to the `UpdateProduct` overload just created.</span></span>


<span data-ttu-id="9c80b-132">[![Utilice la sobrecarga del método UpdateProduct que acepta cuatro parámetros de entrada](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-132">[![Use the UpdateProduct Method Overload That Accepts Four Input Parameters](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image1.png)</span></span>

<span data-ttu-id="9c80b-133">**Figura 1**: Use la `UpdateProduct` método de sobrecarga que acepta cuatro parámetros de entrada ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-133">**Figure 1**: Use the `UpdateProduct` Method Overload That Accepts Four Input Parameters ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image3.png))</span></span>


<span data-ttu-id="9c80b-134">Esto creará un origen ObjectDataSource con una `UpdateParameters` colección con cuatro parámetros y un control GridView con un campo para cada uno de los campos de producto.</span><span class="sxs-lookup"><span data-stu-id="9c80b-134">This will create an ObjectDataSource with an `UpdateParameters` collection with four parameters and a GridView with a field for each of the product fields.</span></span> <span data-ttu-id="9c80b-135">Marcado declarativo de ObjectDataSource se asigna el `OldValuesParameterFormatString` el valor de propiedad `original_{0}`, lo que provocará una excepción dado que nuestra clase BLL no espera un parámetro de entrada denominado `original_productID` pasarse.</span><span class="sxs-lookup"><span data-stu-id="9c80b-135">The ObjectDataSource's declarative markup assigns the `OldValuesParameterFormatString` property the value `original_{0}`, which will cause an exception since our BLL class's don't expect an input parameter named `original_productID` to be passed in.</span></span> <span data-ttu-id="9c80b-136">No olvide quitar por completo esta configuración de la sintaxis declarativa (o se establece en el valor predeterminado, `{0}`).</span><span class="sxs-lookup"><span data-stu-id="9c80b-136">Don't forget to remove this setting altogether from the declarative syntax (or set it to the default value, `{0}`).</span></span>

<span data-ttu-id="9c80b-137">A continuación, reducir el control GridView para incluir solo el `ProductName`, `QuantityPerUnit`, `UnitPrice`, y `UnitsInStock` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="9c80b-137">Next, pare down the GridView to include only the `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` BoundFields.</span></span> <span data-ttu-id="9c80b-138">También puede aplicar cualquier formato de nivel de campo que considere necesario (por ejemplo, cambiar el `HeaderText` propiedades).</span><span class="sxs-lookup"><span data-stu-id="9c80b-138">Also feel free to apply any field-level formatting you deem necessary (such as changing the `HeaderText` properties).</span></span>

<span data-ttu-id="9c80b-139">En el tutorial anterior hemos visto cómo dar formato a la `UnitPrice` BoundField como una moneda en modo de solo lectura y en modo de edición.</span><span class="sxs-lookup"><span data-stu-id="9c80b-139">In the previous tutorial we looked at how to format the `UnitPrice` BoundField as a currency both in read-only mode and edit mode.</span></span> <span data-ttu-id="9c80b-140">Vamos a hacer el mismo aquí.</span><span class="sxs-lookup"><span data-stu-id="9c80b-140">Let's do the same here.</span></span> <span data-ttu-id="9c80b-141">Recuerde que esta configuración requerida del BoundField `DataFormatString` propiedad `{0:c}`, sus `HtmlEncode` propiedad a `false`y su `ApplyFormatInEditMode` a `true`, como se muestra en la figura 2.</span><span class="sxs-lookup"><span data-stu-id="9c80b-141">Recall that this required setting the BoundField's `DataFormatString` property to `{0:c}`, its `HtmlEncode` property to `false`, and its `ApplyFormatInEditMode` to `true`, as shown in Figure 2.</span></span>


<span data-ttu-id="9c80b-142">[![Configurar el UnitPrice BoundField a mostrar como moneda](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-142">[![Configure the UnitPrice BoundField to Display as a Currency](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image4.png)</span></span>

<span data-ttu-id="9c80b-143">**Figura 2**: Configurar la `UnitPrice` BoundField para mostrar como una moneda ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-143">**Figure 2**: Configure the `UnitPrice` BoundField to Display as a Currency ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image6.png))</span></span>


<span data-ttu-id="9c80b-144">Aplicar formato a la `UnitPrice` como una moneda en la interfaz de edición requiere la creación de un controlador de eventos para el control de GridView `RowUpdating` eventos que analiza la cadena con formato de moneda en un `decimal` valor.</span><span class="sxs-lookup"><span data-stu-id="9c80b-144">Formatting the `UnitPrice` as a currency in the editing interface requires creating an event handler for the GridView's `RowUpdating` event that parses the currency-formatted string into a `decimal` value.</span></span> <span data-ttu-id="9c80b-145">Recuerde que el `RowUpdating` controlador de eventos desde el último tutorial también se comprueba para asegurarse de que el usuario proporcionado un `UnitPrice` valor.</span><span class="sxs-lookup"><span data-stu-id="9c80b-145">Recall that the `RowUpdating` event handler from the last tutorial also checked to ensure that the user provided a `UnitPrice` value.</span></span> <span data-ttu-id="9c80b-146">Sin embargo, para este tutorial vamos a permitir que el usuario omitir el precio.</span><span class="sxs-lookup"><span data-stu-id="9c80b-146">However, for this tutorial let's allow the user to omit the price.</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample2.vb)]

<span data-ttu-id="9c80b-147">Nuestro GridView incluye un `QuantityPerUnit` BoundField, pero este BoundField debe ser solo para fines de presentación y no debe ser editable por el usuario.</span><span class="sxs-lookup"><span data-stu-id="9c80b-147">Our GridView includes a `QuantityPerUnit` BoundField, but this BoundField should be only for display purposes and should not be editable by the user.</span></span> <span data-ttu-id="9c80b-148">Para ello, basta con establecer 'BoundFields `ReadOnly` propiedad `true`.</span><span class="sxs-lookup"><span data-stu-id="9c80b-148">To arrange this, simply set the BoundFields' `ReadOnly` property to `true`.</span></span>


<span data-ttu-id="9c80b-149">[![Hacer el QuantityPerUnit BoundField de sólo lectura](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-149">[![Make the QuantityPerUnit BoundField Read-Only](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image7.png)</span></span>

<span data-ttu-id="9c80b-150">**Figura 3**: Realizar el `QuantityPerUnit` BoundField de solo lectura ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-150">**Figure 3**: Make the `QuantityPerUnit` BoundField Read-Only ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image9.png))</span></span>


<span data-ttu-id="9c80b-151">Por último, active la casilla Habilitar edición de etiquetas inteligentes de GridView.</span><span class="sxs-lookup"><span data-stu-id="9c80b-151">Finally, check the Enable Editing checkbox from the GridView's smart tag.</span></span> <span data-ttu-id="9c80b-152">Después de completar estos pasos el `ErrorHandling.aspx` Diseñador de la página debe ser similar a la figura 4.</span><span class="sxs-lookup"><span data-stu-id="9c80b-152">After completing these steps the `ErrorHandling.aspx` page's Designer should look similar to Figure 4.</span></span>


<span data-ttu-id="9c80b-153">[![Quite todos menos necesario BoundFields y comprobación de activación de la casilla de verificación de edición](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-153">[![Remove All But the Needed BoundFields and Check the Enable Editing Checkbox](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image10.png)</span></span>

<span data-ttu-id="9c80b-154">**Figura 4**: Quitar todos excepto los necesarios BoundFields y Active la casilla Habilitar de edición ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-154">**Figure 4**: Remove All But the Needed BoundFields and Check the Enable Editing Checkbox ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image12.png))</span></span>


<span data-ttu-id="9c80b-155">En este momento tenemos una lista de todos los productos `ProductName`, `QuantityPerUnit`, `UnitPrice`, y `UnitsInStock` campos; sin embargo, solo el `ProductName`, `UnitPrice`, y `UnitsInStock` se pueden editar los campos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-155">At this point we have a list of all of the products' `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` fields; however, only the `ProductName`, `UnitPrice`, and `UnitsInStock` fields can be edited.</span></span>


<span data-ttu-id="9c80b-156">[![Los usuarios ahora pueden editar fácilmente los nombres de los productos, precios y unidades en existencias campos](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-156">[![Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image13.png)</span></span>

<span data-ttu-id="9c80b-157">**Figura 5**: Los nombres a los usuarios puede ahora fácilmente editar los productos, precios y campos de unidades en existencias ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-157">**Figure 5**: Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image15.png))</span></span>


## <a name="step-2-gracefully-handling-dal-level-exceptions"></a><span data-ttu-id="9c80b-158">Paso 2: Controlar correctamente las excepciones de nivel de DAL</span><span class="sxs-lookup"><span data-stu-id="9c80b-158">Step 2: Gracefully Handling DAL-Level Exceptions</span></span>

<span data-ttu-id="9c80b-159">Aunque nuestro control GridView editable maravillosamente funciona cuando los usuarios escriben los valores válidos para el nombre del producto editado, precio y las unidades en existencias, escriba los valores no válidos produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="9c80b-159">While our editable GridView works wonderfully when users enter legal values for the edited product's name, price, and units in stock, entering illegal values results in an exception.</span></span> <span data-ttu-id="9c80b-160">Por ejemplo, si se omite el `ProductName` valor hace que un [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) que se produzca desde el `ProductName` propiedad en el `ProdcutsRow` clase tiene su `AllowDBNull` propiedad establecida en `false`; si el base de datos no está activo, un `SqlException` producirá el TableAdapter al intentar conectarse a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-160">For example, omitting the `ProductName` value causes a [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) to be thrown since the `ProductName` property in the `ProdcutsRow` class has its `AllowDBNull` property set to `false`; if the database is down, a `SqlException` will be thrown by the TableAdapter when attempting to connect to the database.</span></span> <span data-ttu-id="9c80b-161">Sin realizar ninguna acción, estas excepciones se propagan desde la capa de acceso a datos a la capa de lógica empresarial, a continuación, en la página ASP.NET y, finalmente, al tiempo de ejecución ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9c80b-161">Without taking any action, these exceptions bubble up from the Data Access Layer to the Business Logic Layer, then to the ASP.NET page, and finally to the ASP.NET runtime.</span></span>

<span data-ttu-id="9c80b-162">Dependiendo de cómo se configura la aplicación web y el hecho de que está visitando la aplicación desde `localhost`, una excepción no controlada puede dar lugar a una página de error de servidor genérico, un informe de error detallados o una página web fácil de usar.</span><span class="sxs-lookup"><span data-stu-id="9c80b-162">Depending on how your web application is configured and whether or not you're visiting the application from `localhost`, an unhandled exception can result in either a generic server-error page, a detailed error report, or a user-friendly web page.</span></span> <span data-ttu-id="9c80b-163">Consulte [Web el control de los errores de aplicación en ASP.NET](http://www.15seconds.com/issue/030102.htm) y [elemento customErrors](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) para obtener más información sobre cómo el tiempo de ejecución ASP.NET responde a una excepción no detectada.</span><span class="sxs-lookup"><span data-stu-id="9c80b-163">See [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) and the [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) for more information on how the ASP.NET runtime responds to an uncaught exception.</span></span>

<span data-ttu-id="9c80b-164">Figura 6 se muestra la pantalla al intentar actualizar un producto sin especificar el `ProductName` valor.</span><span class="sxs-lookup"><span data-stu-id="9c80b-164">Figure 6 shows the screen encountered when attempting to update a product without specifying the `ProductName` value.</span></span> <span data-ttu-id="9c80b-165">Éste es el predeterminado que se muestra el informe de error detallados cuando llegan a través de `localhost`.</span><span class="sxs-lookup"><span data-stu-id="9c80b-165">This is the default detailed error report displayed when coming through `localhost`.</span></span>


<span data-ttu-id="9c80b-166">[![Si se omite el nombre mostrará excepción los detalles de producto](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-166">[![Omitting the Product's Name Will Display Exception Details](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image16.png)</span></span>

<span data-ttu-id="9c80b-167">**Figura 6**: Si se omite nombre le mostrar detalles del producto de la excepción ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-167">**Figure 6**: Omitting the Product's Name Will Display Exception Details ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image18.png))</span></span>


<span data-ttu-id="9c80b-168">Aunque estos detalles de la excepción son útiles cuando se prueba una aplicación, presentar un usuario final con dicha pantalla en caso de una excepción es ideal.</span><span class="sxs-lookup"><span data-stu-id="9c80b-168">While such exception details are helpful when testing an application, presenting an end user with such a screen in the face of an exception is less than ideal.</span></span> <span data-ttu-id="9c80b-169">Un usuario final es probable que no sabe qué es un `NoNullAllowedException` es o por qué se produjo.</span><span class="sxs-lookup"><span data-stu-id="9c80b-169">An end user likely doesn't know what a `NoNullAllowedException` is or why it was caused.</span></span> <span data-ttu-id="9c80b-170">Un mejor enfoque es presentar al usuario un mensaje de más fácil de usar que explique que hubo problemas al intentar actualizar el producto.</span><span class="sxs-lookup"><span data-stu-id="9c80b-170">A better approach is to present the user with a more user-friendly message explaining that there were problems attempting to update the product.</span></span>

<span data-ttu-id="9c80b-171">Si se produce una excepción al realizar la operación, los eventos posteriores al niveles de ObjectDataSource y el control de datos Web proporcionan un medio para detectarlo y cancelar la excepción que se propague hasta el tiempo de ejecución ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9c80b-171">If an exception occurs when performing the operation, the post-level events in both the ObjectDataSource and the data Web control provide a means to detect it and cancel the exception from bubbling up to the ASP.NET runtime.</span></span> <span data-ttu-id="9c80b-172">En nuestro ejemplo, vamos a crear un controlador de eventos para el control de GridView `RowUpdated` eventos que determina si se ha desencadenado una excepción y, si es así, muestra los detalles de excepción en un control Web de la etiqueta.</span><span class="sxs-lookup"><span data-stu-id="9c80b-172">For our example, let's create an event handler for the GridView's `RowUpdated` event that determines if an exception has fired and, if so, displays the exception details in a Label Web control.</span></span>

<span data-ttu-id="9c80b-173">Empiece por agregar una etiqueta a la página ASP.NET, establecer su `ID` propiedad `ExceptionDetails` y borrarlos su `Text` propiedad.</span><span class="sxs-lookup"><span data-stu-id="9c80b-173">Start by adding a Label to the ASP.NET page, setting its `ID` property to `ExceptionDetails` and clearing out its `Text` property.</span></span> <span data-ttu-id="9c80b-174">Para dibujar los ojos del usuario a este mensaje, establecer su `CssClass` propiedad `Warning`, que es una clase CSS que se ha agregado a la `Styles.css` archivo en el tutorial anterior.</span><span class="sxs-lookup"><span data-stu-id="9c80b-174">In order to draw the user's eye to this message, set its `CssClass` property to `Warning`, which is a CSS class we added to the `Styles.css` file in the previous tutorial.</span></span> <span data-ttu-id="9c80b-175">Recuerde que esta clase CSS que hace que el texto de la etiqueta que se mostrará en una fuente roja, cursiva, negrita, extra grande.</span><span class="sxs-lookup"><span data-stu-id="9c80b-175">Recall that this CSS class causes the Label's text to be displayed in a red, italic, bold, extra large font.</span></span>


<span data-ttu-id="9c80b-176">[![Agregar un Control Web Label a la página](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-176">[![Add a Label Web Control to the Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image19.png)</span></span>

<span data-ttu-id="9c80b-177">**Figura 7**: Agregar un Control Web Label a la página ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-177">**Figure 7**: Add a Label Web Control to the Page ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image21.png))</span></span>


<span data-ttu-id="9c80b-178">Puesto que deseamos que este control sea visible solo inmediatamente después se ha producido una excepción, establezca su `Visible` propiedad en false en el `Page_Load` controlador de eventos:</span><span class="sxs-lookup"><span data-stu-id="9c80b-178">Since we want this Label Web control to be visible only immediately after an exception has occurred, set its `Visible` property to false in the `Page_Load` event handler:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample3.vb)]

<span data-ttu-id="9c80b-179">Con este código, en la primera visita de página y los postbacks subsiguientes del `ExceptionDetails` control tendrá su `Visible` propiedad establecida en `false`.</span><span class="sxs-lookup"><span data-stu-id="9c80b-179">With this code, on the first page visit and subsequent postbacks the `ExceptionDetails` control will have its `Visible` property set to `false`.</span></span> <span data-ttu-id="9c80b-180">En caso de una excepción de nivel DAL o BLL, que nos podemos detectar en el control de GridView `RowUpdated` controlador de eventos, estableceremos la `ExceptionDetails` del control `Visible` propiedad en true.</span><span class="sxs-lookup"><span data-stu-id="9c80b-180">In the face of a DAL- or BLL-level exception, which we can detect in the GridView's `RowUpdated` event handler, we will set the `ExceptionDetails` control's `Visible` property to true.</span></span> <span data-ttu-id="9c80b-181">Puesto que los controladores de eventos de control Web que se producen después de la `Page_Load` controlador de eventos del ciclo de vida de la página, se mostrará la etiqueta.</span><span class="sxs-lookup"><span data-stu-id="9c80b-181">Since Web control event handlers occur after the `Page_Load` event handler in the page lifecycle, the Label will be shown.</span></span> <span data-ttu-id="9c80b-182">Sin embargo, en la siguiente devolución, el `Page_Load` se restablecerá el controlador de eventos el `Visible` propiedad nuevo a `false`, ocultarla a vista de nuevo.</span><span class="sxs-lookup"><span data-stu-id="9c80b-182">However, on the next postback, the `Page_Load` event handler will revert the `Visible` property back to `false`, hiding it from view again.</span></span>

> [!NOTE]
> <span data-ttu-id="9c80b-183">Como alternativa, podríamos quitamos la necesidad de configuración de la `ExceptionDetails` del control `Visible` propiedad en `Page_Load` asignando su `Visible` propiedad `false` en la sintaxis declarativa y deshabilitar su estado de vista (estableciendo su `EnableViewState` propiedad `false`).</span><span class="sxs-lookup"><span data-stu-id="9c80b-183">Alternatively, we could remove the necessity for setting the `ExceptionDetails` control's `Visible` property in `Page_Load` by assigning its `Visible` property `false` in the declarative syntax and disabling its view state (setting its `EnableViewState` property to `false`).</span></span> <span data-ttu-id="9c80b-184">En un futuro tutorial, vamos a usar este enfoque alternativo.</span><span class="sxs-lookup"><span data-stu-id="9c80b-184">We'll use this alternative approach in a future tutorial.</span></span>


<span data-ttu-id="9c80b-185">Agregado el control de etiqueta, el siguiente paso es crear el controlador de eventos para el control de GridView `RowUpdated` eventos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-185">With the Label control added, our next step is to create the event handler for the GridView's `RowUpdated` event.</span></span> <span data-ttu-id="9c80b-186">Seleccione el control GridView en el diseñador, vaya a la ventana Propiedades y haga clic en el icono de rayo, muestran los eventos de GridView.</span><span class="sxs-lookup"><span data-stu-id="9c80b-186">Select the GridView in the Designer, go to the Properties window, and click the lightning bolt icon, listing the GridView's events.</span></span> <span data-ttu-id="9c80b-187">Ya debe haber una entrada no existe para el control de GridView `RowUpdating` eventos, como hemos creado un controlador de eventos para este evento anteriormente en este tutorial.</span><span class="sxs-lookup"><span data-stu-id="9c80b-187">There should already be an entry there for the GridView's `RowUpdating` event, as we created an event handler for this event earlier in this tutorial.</span></span> <span data-ttu-id="9c80b-188">Crear un controlador de eventos para el `RowUpdated` también el evento.</span><span class="sxs-lookup"><span data-stu-id="9c80b-188">Create an event handler for the `RowUpdated` event as well.</span></span>


![Crear un controlador de eventos para RowUpdated (evento de GridView)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image22.png)

<span data-ttu-id="9c80b-190">**Figura 8**: Crear un controlador de eventos para el control de GridView `RowUpdated` eventos</span><span class="sxs-lookup"><span data-stu-id="9c80b-190">**Figure 8**: Create an Event Handler for the GridView's `RowUpdated` Event</span></span>


> [!NOTE]
> <span data-ttu-id="9c80b-191">También puede crear el controlador de eventos a través de las listas desplegables en la parte superior del archivo de clase de código subyacente.</span><span class="sxs-lookup"><span data-stu-id="9c80b-191">You can also create the event handler through the drop-down lists at the top of the code-behind class file.</span></span> <span data-ttu-id="9c80b-192">Seleccione el control GridView en la lista desplegable de la izquierda y la `RowUpdated` eventos de uno en la derecha.</span><span class="sxs-lookup"><span data-stu-id="9c80b-192">Select the GridView from the drop-down list on the left and the `RowUpdated` event from the one on the right.</span></span>


<span data-ttu-id="9c80b-193">Creación de este controlador de eventos se agrega el código siguiente a la clase de código subyacente de la página ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="9c80b-193">Creating this event handler will add the following code to the ASP.NET page's code-behind class:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample4.vb)]

<span data-ttu-id="9c80b-194">Segundo parámetro de entrada de este controlador de eventos es un objeto de tipo [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), que tiene tres propiedades de interés para el control de excepciones:</span><span class="sxs-lookup"><span data-stu-id="9c80b-194">This event handler's second input parameter is an object of type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), which has three properties of interest for handling exceptions:</span></span>

- <span data-ttu-id="9c80b-195">`Exception` una referencia a la excepción; Si no se ha producido ninguna excepción, esta propiedad tendrá un valor de `null`</span><span class="sxs-lookup"><span data-stu-id="9c80b-195">`Exception` a reference to the thrown exception; if no exception has been thrown, this property will have a value of `null`</span></span>
- <span data-ttu-id="9c80b-196">`ExceptionHandled` un valor booleano que indica si se controló la excepción en el `RowUpdated` controlador de eventos; si `false` (valor predeterminado), la excepción se vuelve a producir, filtre hasta el tiempo de ejecución ASP.NET</span><span class="sxs-lookup"><span data-stu-id="9c80b-196">`ExceptionHandled` a Boolean value that indicates whether or not the exception was handled in the `RowUpdated` event handler; if `false` (the default), the exception is re-thrown, percolating up to the ASP.NET runtime</span></span>
- <span data-ttu-id="9c80b-197">`KeepInEditMode` Si establece en `true` la fila GridView editada permanece en modo de edición; si `false` (valor predeterminado), la fila GridView vuelve a su modo de solo lectura</span><span class="sxs-lookup"><span data-stu-id="9c80b-197">`KeepInEditMode` if set to `true` the edited GridView row remains in edit mode; if `false` (the default), the GridView row reverts back to its read-only mode</span></span>

<span data-ttu-id="9c80b-198">A continuación, nuestro código, debe comprobar para ver si `Exception` no `null`, lo que significa que se generó una excepción al realizar la operación.</span><span class="sxs-lookup"><span data-stu-id="9c80b-198">Our code, then, should check to see if `Exception` is not `null`, meaning that an exception was raised while performing the operation.</span></span> <span data-ttu-id="9c80b-199">Si esto es así, nos gustaría:</span><span class="sxs-lookup"><span data-stu-id="9c80b-199">If this is the case, we want to:</span></span>

- <span data-ttu-id="9c80b-200">Mostrar un mensaje descriptivo en el `ExceptionDetails` etiqueta</span><span class="sxs-lookup"><span data-stu-id="9c80b-200">Display a user-friendly message in the `ExceptionDetails` Label</span></span>
- <span data-ttu-id="9c80b-201">Indicar que se ha controlado la excepción</span><span class="sxs-lookup"><span data-stu-id="9c80b-201">Indicate that the exception was handled</span></span>
- <span data-ttu-id="9c80b-202">Mantener las filas del control GridView en modo de edición</span><span class="sxs-lookup"><span data-stu-id="9c80b-202">Keep the GridView row in edit mode</span></span>

<span data-ttu-id="9c80b-203">Este código lleva a cabo estos objetivos:</span><span class="sxs-lookup"><span data-stu-id="9c80b-203">This following code accomplishes these objectives:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample5.vb)]

<span data-ttu-id="9c80b-204">Este controlador de eventos comienza comprobando si `e.Exception` es `null`.</span><span class="sxs-lookup"><span data-stu-id="9c80b-204">This event handler begins by checking to see if `e.Exception` is `null`.</span></span> <span data-ttu-id="9c80b-205">Si no lo es, el `ExceptionDetails` la etiqueta `Visible` propiedad está establecida en `true` y su `Text` propiedad a "Se produjo un problema al actualizar el producto."</span><span class="sxs-lookup"><span data-stu-id="9c80b-205">If it's not, the `ExceptionDetails` Label's `Visible` property is set to `true` and its `Text` property to "There was a problem updating the product."</span></span> <span data-ttu-id="9c80b-206">Los detalles de la excepción que se ha producido residen en el `e.Exception` del objeto `InnerException` propiedad.</span><span class="sxs-lookup"><span data-stu-id="9c80b-206">The details of the actual exception that was thrown reside in the `e.Exception` object's `InnerException` property.</span></span> <span data-ttu-id="9c80b-207">Se examina la excepción interna y, si es de un tipo determinado, se anexa un mensaje adicional y útil a la `ExceptionDetails` la etiqueta `Text` propiedad.</span><span class="sxs-lookup"><span data-stu-id="9c80b-207">This inner exception is examined and, if it is of a particular type, an additional, helpful message is appended to the `ExceptionDetails` Label's `Text` property.</span></span> <span data-ttu-id="9c80b-208">Por último, el `ExceptionHandled` y `KeepInEditMode` propiedades se establecen en `true`.</span><span class="sxs-lookup"><span data-stu-id="9c80b-208">Lastly, the `ExceptionHandled` and `KeepInEditMode` properties are both set to `true`.</span></span>

<span data-ttu-id="9c80b-209">Figura 9 se muestra una captura de pantalla de esta página cuando se omite el nombre del producto; Figura 10 se muestran los resultados al especificar un valor ilegal `UnitPrice` valor (de -50).</span><span class="sxs-lookup"><span data-stu-id="9c80b-209">Figure 9 shows a screen shot of this page when omitting the name of the product; Figure 10 shows the results when entering an illegal `UnitPrice` value (-50).</span></span>


<span data-ttu-id="9c80b-210">[![El ProductName BoundField debe contener un valor](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-210">[![The ProductName BoundField Must Contain a Value](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image23.png)</span></span>

<span data-ttu-id="9c80b-211">**Figura 9**: El `ProductName` BoundField debe contener un valor ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-211">**Figure 9**: The `ProductName` BoundField Must Contain a Value ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image25.png))</span></span>


<span data-ttu-id="9c80b-212">[![Los valores de UnitPrice negativos no son permitidos](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-212">[![Negative UnitPrice Values are Not Allowed](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image26.png)</span></span>

<span data-ttu-id="9c80b-213">**Figura 10**: Negativo `UnitPrice` los valores no son permitido ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-213">**Figure 10**: Negative `UnitPrice` Values are Not Allowed ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image28.png))</span></span>


<span data-ttu-id="9c80b-214">Estableciendo el `e.ExceptionHandled` propiedad `true`, el `RowUpdated` controlador de eventos ha indicado que ha controlado la excepción.</span><span class="sxs-lookup"><span data-stu-id="9c80b-214">By setting the `e.ExceptionHandled` property to `true`, the `RowUpdated` event handler has indicated that it has handled the exception.</span></span> <span data-ttu-id="9c80b-215">Por lo tanto, no propaga la excepción hasta el tiempo de ejecución ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9c80b-215">Therefore, the exception won't propagate up to the ASP.NET runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="9c80b-216">Las figuras 9 y 10 muestran una forma correcta para controlar las excepciones generadas debido a la entrada del usuario no válido.</span><span class="sxs-lookup"><span data-stu-id="9c80b-216">Figures 9 and 10 show a graceful way to handle exceptions raised due to invalid user input.</span></span> <span data-ttu-id="9c80b-217">Lo ideal es que, sin embargo, este tipo de entrada no válido no superará nunca alcance la capa de lógica empresarial en primer lugar, como la página ASP.NET debe asegurarse de que las entradas del usuario son válidas antes de invocar el `ProductsBLL` la clase `UpdateProduct` método.</span><span class="sxs-lookup"><span data-stu-id="9c80b-217">Ideally, though, such invalid input will never reach the Business Logic Layer in the first place, as the ASP.NET page should ensure that the user's inputs are valid before invoking the `ProductsBLL` class's `UpdateProduct` method.</span></span> <span data-ttu-id="9c80b-218">En nuestro siguiente tutorial que veremos cómo agregar controles de validación a las interfaces de edición e inserción para asegurarse de que los datos enviados a la capa de lógica empresarial se ajusta a las reglas de negocios.</span><span class="sxs-lookup"><span data-stu-id="9c80b-218">In our next tutorial we'll see how to add validation controls to the editing and inserting interfaces to ensure that the data submitted to the Business Logic Layer conforms to the business rules.</span></span> <span data-ttu-id="9c80b-219">Los controles de validación no solo impiden que la invocación de la `UpdateProduct` método hasta que los datos proporcionados por el usuario es válidos, pero también proporcionan una experiencia de usuario más informativa para identificar problemas de entrada de datos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-219">The validation controls not only prevent the invocation of the `UpdateProduct` method until the user-supplied data is valid, but also provide a more informative user experience for identifying data entry problems.</span></span>


## <a name="step-3-gracefully-handling-bll-level-exceptions"></a><span data-ttu-id="9c80b-220">Paso 3: Controlar correctamente las excepciones de nivel BLL</span><span class="sxs-lookup"><span data-stu-id="9c80b-220">Step 3: Gracefully Handling BLL-Level Exceptions</span></span>

<span data-ttu-id="9c80b-221">Al insertar, actualizar o eliminar datos, la capa de acceso a datos puede producir una excepción en caso de un error relacionado con datos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-221">When inserting, updating, or deleting data, the Data Access Layer may throw an exception in the face of a data-related error.</span></span> <span data-ttu-id="9c80b-222">La base de datos puede estar sin conexión, es posible que una columna de tabla de base de datos necesarios no haya tenido un valor especificado o han infringido una restricción de nivel de tabla.</span><span class="sxs-lookup"><span data-stu-id="9c80b-222">The database may be offline, a required database table column might not have had a value specified, or a table-level constraint may have been violated.</span></span> <span data-ttu-id="9c80b-223">Además de las excepciones estrictamente relacionado con los datos, la capa de lógica empresarial puede usar excepciones para indicar cuándo se han infringido las reglas de negocios.</span><span class="sxs-lookup"><span data-stu-id="9c80b-223">In addition to strictly data-related exceptions, the Business Logic Layer can use exceptions to indicate when business rules have been violated.</span></span> <span data-ttu-id="9c80b-224">En el [crear una capa de lógica empresarial](../introduction/creating-a-business-logic-layer-vb.md) tutorial, por ejemplo, hemos agregado una comprobación de reglas de negocio a la versión original `UpdateProduct` sobrecargar.</span><span class="sxs-lookup"><span data-stu-id="9c80b-224">In the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial, for example, we added a business rule check to the original `UpdateProduct` overload.</span></span> <span data-ttu-id="9c80b-225">En concreto, si el usuario ha marcado un producto como discontinuo, hemos necesitado que el producto no sea el único proporcionado por su proveedor.</span><span class="sxs-lookup"><span data-stu-id="9c80b-225">Specifically, if the user was marking a product as discontinued, we required that the product not be the only one provided by its supplier.</span></span> <span data-ttu-id="9c80b-226">Si esta condición se ha infringido, un `ApplicationException` se ha producido.</span><span class="sxs-lookup"><span data-stu-id="9c80b-226">If this condition was violated, an `ApplicationException` was thrown.</span></span>

<span data-ttu-id="9c80b-227">Para el `UpdateProduct` sobrecarga creado en este tutorial, vamos a agregar una regla de negocios que prohíbe el `UnitPrice` arrastrándolo desde la que se establece en un valor nuevo que es más de dos veces el original `UnitPrice` valor.</span><span class="sxs-lookup"><span data-stu-id="9c80b-227">For the `UpdateProduct` overload created in this tutorial, let's add a business rule that prohibits the `UnitPrice` field from being set to a new value that's more than twice the original `UnitPrice` value.</span></span> <span data-ttu-id="9c80b-228">Para ello, ajuste el `UpdateProduct` sobrecarga para que se realiza esta comprobación y se produce un `ApplicationException` si se infringe la regla.</span><span class="sxs-lookup"><span data-stu-id="9c80b-228">To accomplish this, adjust the `UpdateProduct` overload so that it performs this check and throws an `ApplicationException` if the rule is violated.</span></span> <span data-ttu-id="9c80b-229">El método actualizado se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="9c80b-229">The updated method follows:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample6.vb)]

<span data-ttu-id="9c80b-230">Con este cambio, cualquier actualización de precios que es más de dos veces el precio existente producirá un `ApplicationException` que se produzca.</span><span class="sxs-lookup"><span data-stu-id="9c80b-230">With this change, any price update that is more than twice the existing price will cause an `ApplicationException` to be thrown.</span></span> <span data-ttu-id="9c80b-231">Al igual que la excepción generada desde la capa DAL, este se genera el BLL `ApplicationException` puede detectar y tratar en la GridView `RowUpdated` controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-231">Just like the exception raised from the DAL, this BLL-raised `ApplicationException` can be detected and handled in the GridView's `RowUpdated` event handler.</span></span> <span data-ttu-id="9c80b-232">De hecho, el `RowUpdated` código del controlador de eventos, que escribe, correctamente detectará esta excepción y mostrar el `ApplicationException`del `Message` valor de propiedad.</span><span class="sxs-lookup"><span data-stu-id="9c80b-232">In fact, the `RowUpdated` event handler's code, as written, will correctly detect this exception and display the `ApplicationException`'s `Message` property value.</span></span> <span data-ttu-id="9c80b-233">Figura 11 muestra una captura de pantalla cuando un usuario intenta actualizar el precio de Chai a 50,00 dólares, que es más del doble su precio actual de US $19,95.</span><span class="sxs-lookup"><span data-stu-id="9c80b-233">Figure 11 shows a screen shot when a user attempts to update the price of Chai to $50.00, which is more than double its current price of $19.95.</span></span>


<span data-ttu-id="9c80b-234">[![Las reglas de negocios no permitir bonificaciones que más del doble de precio de un producto](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="9c80b-234">[![The Business Rules Disallow Price Increases That More Than Double a Product's Price](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image29.png)</span></span>

<span data-ttu-id="9c80b-235">**Figura 11**: Las reglas de negocios bonificaciones de no permitir que más del doble de precio de un producto ([haga clic aquí para ver imagen en tamaño completo](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="9c80b-235">**Figure 11**: The Business Rules Disallow Price Increases That More Than Double a Product's Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image31.png))</span></span>


> [!NOTE]
> <span data-ttu-id="9c80b-236">Lo ideal es que se podrían refactorizar nuestras reglas de lógica de negocio fuera de la `UpdateProduct` sobrecargas del método y en un método común.</span><span class="sxs-lookup"><span data-stu-id="9c80b-236">Ideally our business logic rules would be refactored out of the `UpdateProduct` method overloads and into a common method.</span></span> <span data-ttu-id="9c80b-237">Esto queda como ejercicio para el lector.</span><span class="sxs-lookup"><span data-stu-id="9c80b-237">This is left as an exercise for the reader.</span></span>


## <a name="summary"></a><span data-ttu-id="9c80b-238">Resumen</span><span class="sxs-lookup"><span data-stu-id="9c80b-238">Summary</span></span>

<span data-ttu-id="9c80b-239">Durante la inserción, actualización y eliminación de las operaciones, el control de datos Web y el origen ObjectDataSource implicados activan eventos previos y posteriores al niveles que la operación real del delimitador.</span><span class="sxs-lookup"><span data-stu-id="9c80b-239">During inserting, updating, and deleting operations, both the data Web control and the ObjectDataSource involved fire pre- and post-level events that bookend the actual operation.</span></span> <span data-ttu-id="9c80b-240">Como hemos visto en este tutorial y la anterior, cuando se trabaja con un control GridView editable de GridView `RowUpdating` desencadena el evento, seguido de ObjectDataSource `Updating` eventos, momento en que se realiza el comando update de ObjectDataSource objeto subyacente.</span><span class="sxs-lookup"><span data-stu-id="9c80b-240">As we saw in this tutorial and the preceding one, when working with an editable GridView the GridView's `RowUpdating` event fires, followed by the ObjectDataSource's `Updating` event, at which point the update command is made to the ObjectDataSource's underlying object.</span></span> <span data-ttu-id="9c80b-241">Una vez completada la operación, de ObjectDataSource `Updated` desencadena el evento, seguido de GridView `RowUpdated` eventos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-241">After the operation has completed, the ObjectDataSource's `Updated` event fires, followed by the GridView's `RowUpdated` event.</span></span>

<span data-ttu-id="9c80b-242">Podemos crear controladores de eventos para los eventos de niveles previamente con el fin de personalizar los parámetros de entrada o para los eventos posteriores al niveles para inspeccionar y responder a los resultados de la operación.</span><span class="sxs-lookup"><span data-stu-id="9c80b-242">We can create event handlers for the pre-level events in order to customize the input parameters or for the post-level events in order to inspect and respond to the operation's results.</span></span> <span data-ttu-id="9c80b-243">Controladores de eventos posteriores al nivel se usan normalmente para detectar si se produjo una excepción durante la operación.</span><span class="sxs-lookup"><span data-stu-id="9c80b-243">Post-level event handlers are most commonly used to detect whether an exception occurred during the operation.</span></span> <span data-ttu-id="9c80b-244">En caso de una excepción, estos controladores de eventos posteriores a la de nivel, opcionalmente, pueden controlar la excepción por sí solos.</span><span class="sxs-lookup"><span data-stu-id="9c80b-244">In the face of an exception, these post-level event handlers can optionally handle the exception on their own.</span></span> <span data-ttu-id="9c80b-245">En este tutorial hemos visto cómo controlar la excepción mediante un mensaje de error descriptivo.</span><span class="sxs-lookup"><span data-stu-id="9c80b-245">In this tutorial we saw how to handle such an exception by displaying a friendly error message.</span></span>

<span data-ttu-id="9c80b-246">En el siguiente tutorial veremos cómo reducir la probabilidad de que las excepciones derivadas de los problemas de formato de datos (por ejemplo, escriba un valor negativo `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="9c80b-246">In the next tutorial we'll see how to lessen the likelihood of exceptions arising from data formatting issues (such as entering a negative `UnitPrice`).</span></span> <span data-ttu-id="9c80b-247">En concreto, echemos un vistazo cómo agregar controles de validación a las interfaces de edición e inserción.</span><span class="sxs-lookup"><span data-stu-id="9c80b-247">Specifically, we'll look at how to add validation controls to the editing and inserting interfaces.</span></span>

<span data-ttu-id="9c80b-248">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="9c80b-248">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="9c80b-249">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="9c80b-249">About the Author</span></span>

<span data-ttu-id="9c80b-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros sobre ASP/ASP.NET y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), trabaja con tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="9c80b-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9c80b-251">Scott trabaja como consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="9c80b-251">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9c80b-252">Su último libro es [*SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="9c80b-252">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9c80b-253">Puede ponerse en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9c80b-253">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="9c80b-254">o a través de su blog, que puede encontrarse en [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="9c80b-254">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="9c80b-255">Agradecimientos especiales a</span><span class="sxs-lookup"><span data-stu-id="9c80b-255">Special Thanks To</span></span>

<span data-ttu-id="9c80b-256">Esta serie de tutoriales ha sido revisada por muchos revisores útiles.</span><span class="sxs-lookup"><span data-stu-id="9c80b-256">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9c80b-257">Revisor de clientes potencial para este tutorial era Liz Shulok.</span><span class="sxs-lookup"><span data-stu-id="9c80b-257">Lead reviewer for this tutorial was Liz Shulok.</span></span> <span data-ttu-id="9c80b-258">¿Está interesado en leer mi próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="9c80b-258">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9c80b-259">Si es así, envíeme una línea en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9c80b-259">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9c80b-260">[Anterior](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)
> [Siguiente](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)</span><span class="sxs-lookup"><span data-stu-id="9c80b-260">[Previous](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)
[Next](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)</span></span>
