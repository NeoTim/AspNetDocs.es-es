---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
title: Proteger las cadenas de conexión y otra informaciónC#de configuración () | Microsoft Docs
author: rick-anderson
description: Una aplicación ASP.NET normalmente almacena información de configuración en un archivo Web. config. Algunos de estos datos son confidenciales y garantizan la protección. Por def...
ms.author: riande
ms.date: 08/03/2007
ms.assetid: ad8dd396-30f7-4abe-ac02-a0b84422e5be
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
msc.type: authoredcontent
ms.openlocfilehash: 15970bee1e990d3a139673efe12486e08f79814c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/06/2020
ms.locfileid: "78421075"
---
# <a name="protecting-connection-strings-and-other-configuration-information-c"></a><span data-ttu-id="bdb80-105">Proteger las cadenas de conexión y otros datos de configuración (C#)</span><span class="sxs-lookup"><span data-stu-id="bdb80-105">Protecting Connection Strings and Other Configuration Information (C#)</span></span>

<span data-ttu-id="bdb80-106">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="bdb80-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="bdb80-107">[Descargar código](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) o [Descargar PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="bdb80-107">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) or [Download PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span></span>

> <span data-ttu-id="bdb80-108">Una aplicación ASP.NET normalmente almacena información de configuración en un archivo Web. config.</span><span class="sxs-lookup"><span data-stu-id="bdb80-108">An ASP.NET application typically stores configuration information in a Web.config file.</span></span> <span data-ttu-id="bdb80-109">Algunos de estos datos son confidenciales y garantizan la protección.</span><span class="sxs-lookup"><span data-stu-id="bdb80-109">Some of this information is sensitive and warrants protection.</span></span> <span data-ttu-id="bdb80-110">De forma predeterminada, este archivo no se servirá al visitante de un sitio web, pero un administrador o un hacker puede tener acceso al sistema de archivos del servidor Web y ver el contenido del archivo.</span><span class="sxs-lookup"><span data-stu-id="bdb80-110">By default this file will not be served to a Web site visitor, but an administrator or a hacker may gain access to the Web server's file system and view the contents of the file.</span></span> <span data-ttu-id="bdb80-111">En este tutorial aprendemos que ASP.NET 2,0 nos permite proteger la información confidencial mediante el cifrado de las secciones del archivo Web. config.</span><span class="sxs-lookup"><span data-stu-id="bdb80-111">In this tutorial we learn that ASP.NET 2.0 allows us to protect sensitive information by encrypting sections of the Web.config file.</span></span>

## <a name="introduction"></a><span data-ttu-id="bdb80-112">Introducción</span><span class="sxs-lookup"><span data-stu-id="bdb80-112">Introduction</span></span>

<span data-ttu-id="bdb80-113">La información de configuración de las aplicaciones de ASP.NET normalmente se almacena en un archivo XML denominado `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-113">Configuration information for ASP.NET applications is commonly stored in an XML file named `Web.config`.</span></span> <span data-ttu-id="bdb80-114">En el transcurso de estos tutoriales hemos actualizado el `Web.config` unos pocos veces.</span><span class="sxs-lookup"><span data-stu-id="bdb80-114">Over the course of these tutorials we have updated the `Web.config` a handful of times.</span></span> <span data-ttu-id="bdb80-115">Al crear el `Northwind` conjunto de datos con tipo en el [primer tutorial](../introduction/creating-a-data-access-layer-cs.md), por ejemplo, la información de la cadena de conexión se agregó automáticamente a `Web.config` en la sección `<connectionStrings>`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-115">When creating the `Northwind` Typed DataSet in the [first tutorial](../introduction/creating-a-data-access-layer-cs.md), for example, connection string information was automatically added to `Web.config` in the `<connectionStrings>` section.</span></span> <span data-ttu-id="bdb80-116">Más adelante, en las [páginas maestras y](../introduction/master-pages-and-site-navigation-cs.md) en el tutorial de navegación del sitio, actualizamos de forma manual `Web.config`, agregando un elemento `<pages>` que indica que todas las páginas de ASP.net del proyecto deben usar el tema `DataWebControls`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-116">Later, in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, we manually updated `Web.config`, adding a `<pages>` element indicating that all of the ASP.NET pages in our project should use the `DataWebControls` Theme.</span></span>

<span data-ttu-id="bdb80-117">Dado que `Web.config` puede contener datos confidenciales, como cadenas de conexión, es importante que el contenido de `Web.config` se mantenga seguro y esté oculto de los visores no autorizados.</span><span class="sxs-lookup"><span data-stu-id="bdb80-117">Since `Web.config` may contain sensitive data such as connection strings, it is important that the contents of `Web.config` be kept safe and hidden from unauthorized viewers.</span></span> <span data-ttu-id="bdb80-118">De forma predeterminada, las solicitudes HTTP a un archivo con la extensión de `.config` se administran mediante el motor ASP.NET, que devuelve el mensaje *este tipo de página no es atendido* que se muestra en la figura 1.</span><span class="sxs-lookup"><span data-stu-id="bdb80-118">By default, any HTTP request to a file with the `.config` extension is handled by the ASP.NET engine, which returns the *This type of page is not served* message shown in Figure 1.</span></span> <span data-ttu-id="bdb80-119">Esto significa que los visitantes no pueden ver el contenido del `Web.config` archivo s simplemente escribiendo http://www.YourServer.com/Web.config en la barra de direcciones del explorador.</span><span class="sxs-lookup"><span data-stu-id="bdb80-119">This means that visitors cannot view your `Web.config` file s contents by simply entering http://www.YourServer.com/Web.config into their browser s Address bar.</span></span>

<span data-ttu-id="bdb80-120">[![visitar el archivo Web. config a través de un explorador devuelve un mensaje este tipo de página no es atendido](protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="bdb80-120">[![Visiting Web.config Through a Browser Returns a This type of page is not served Message](protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)</span></span>

<span data-ttu-id="bdb80-121">**Figura 1**: al visitar `Web.config` a través de un explorador se devuelve un mensaje que indica que este tipo de página no es atendido ([haga clic para ver la imagen de tamaño completo](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="bdb80-121">**Figure 1**: Visiting `Web.config` Through a Browser Returns a This type of page is not served Message ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span></span>

<span data-ttu-id="bdb80-122">Pero ¿qué ocurre si un atacante puede encontrar algún otro tipo de ataque que le permita ver el contenido del `Web.config` archivo?</span><span class="sxs-lookup"><span data-stu-id="bdb80-122">But what if an attacker is able to find some other exploit that allows her to view your `Web.config` file s contents?</span></span> <span data-ttu-id="bdb80-123">¿Qué puede hacer un atacante con esta información y qué pasos se pueden llevar a cabo para proteger aún más la información confidencial dentro de `Web.config`?</span><span class="sxs-lookup"><span data-stu-id="bdb80-123">What could an attacker do with this information, and what steps can be taken to further protect the sensitive information within `Web.config`?</span></span> <span data-ttu-id="bdb80-124">Afortunadamente, la mayoría de las secciones de `Web.config` no contienen información confidencial.</span><span class="sxs-lookup"><span data-stu-id="bdb80-124">Fortunately, most sections in `Web.config` do not contain sensitive information.</span></span> <span data-ttu-id="bdb80-125">¿Qué daño puede suponer un atacante si conoce el nombre del tema predeterminado que usan las páginas de ASP.NET?</span><span class="sxs-lookup"><span data-stu-id="bdb80-125">What harm can an attacker perpetrate if they know the name of the default Theme used by your ASP.NET pages?</span></span>

<span data-ttu-id="bdb80-126">No obstante, algunas secciones `Web.config` contienen información confidencial que puede incluir cadenas de conexión, nombres de usuario, contraseñas, nombres de servidor, claves de cifrado, etc.</span><span class="sxs-lookup"><span data-stu-id="bdb80-126">Certain `Web.config` sections, however, contain sensitive information that may include connection strings, user names, passwords, server names, encryption keys, and so forth.</span></span> <span data-ttu-id="bdb80-127">Esta información se encuentra normalmente en las siguientes secciones `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="bdb80-127">This information is typically found in the following `Web.config` sections:</span></span>

- `<appSettings>`
- `<connectionStrings>`
- `<identity>`
- `<sessionState>`

<span data-ttu-id="bdb80-128">En este tutorial, veremos técnicas para proteger la información de configuración confidencial.</span><span class="sxs-lookup"><span data-stu-id="bdb80-128">In this tutorial we will look at techniques for protecting such sensitive configuration information.</span></span> <span data-ttu-id="bdb80-129">Como veremos, la versión 2,0 de .NET Framework incluye un sistema de configuraciones protegidas que permite cifrar y descifrar las secciones de configuración seleccionadas mediante programación.</span><span class="sxs-lookup"><span data-stu-id="bdb80-129">As we will see, the .NET Framework version 2.0 includes a protected configurations system that makes programmatically encrypting and decrypting selected configuration sections a breeze.</span></span>

> [!NOTE]
> <span data-ttu-id="bdb80-130">En este tutorial se concluye con una mirada a las recomendaciones de Microsoft para conectarse a una base de datos desde una aplicación de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="bdb80-130">This tutorial concludes with a look at Microsoft s recommendations for connecting to a database from an ASP.NET application.</span></span> <span data-ttu-id="bdb80-131">Además de cifrar las cadenas de conexión, puede ayudar a proteger el sistema asegurándose de que se está conectando a la base de datos de manera segura.</span><span class="sxs-lookup"><span data-stu-id="bdb80-131">In addition to encrypting your connection strings, you can help harden your system by ensuring that you are connecting to the database in a secure fashion.</span></span>

## <a name="step-1-exploring-aspnet-20-s-protected-configuration-options"></a><span data-ttu-id="bdb80-132">Paso 1: explorar las opciones de configuración protegida de ASP.NET 2,0 s</span><span class="sxs-lookup"><span data-stu-id="bdb80-132">Step 1: Exploring ASP.NET 2.0 s Protected Configuration Options</span></span>

<span data-ttu-id="bdb80-133">ASP.NET 2,0 incluye un sistema de configuración protegida para cifrar y descifrar la información de configuración.</span><span class="sxs-lookup"><span data-stu-id="bdb80-133">ASP.NET 2.0 includes a protected configuration system for encrypting and decrypting configuration information.</span></span> <span data-ttu-id="bdb80-134">Esto incluye métodos en el .NET Framework que se pueden usar para cifrar o descifrar la información de configuración mediante programación.</span><span class="sxs-lookup"><span data-stu-id="bdb80-134">This includes methods in the .NET Framework that can be used to programmatically encrypt or decrypt configuration information.</span></span> <span data-ttu-id="bdb80-135">El sistema de configuración protegida utiliza el [modelo de proveedor](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), que permite a los desarrolladores elegir qué implementación criptográfica se usa.</span><span class="sxs-lookup"><span data-stu-id="bdb80-135">The protected configuration system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), which allows developers to choose what cryptographic implementation is used.</span></span>

<span data-ttu-id="bdb80-136">El .NET Framework se suministra con dos proveedores de configuración protegidos:</span><span class="sxs-lookup"><span data-stu-id="bdb80-136">The .NET Framework ships with two protected configuration providers:</span></span>

- <span data-ttu-id="bdb80-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) : usa el [algoritmo RSA](http://en.wikipedia.org/wiki/Rsa) asimétrico para el cifrado y el descifrado.</span><span class="sxs-lookup"><span data-stu-id="bdb80-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) - uses the asymmetric [RSA algorithm](http://en.wikipedia.org/wiki/Rsa) for encryption and decryption.</span></span>
- <span data-ttu-id="bdb80-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) : usa la API de protección de datos de Windows [(DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) para el cifrado y el descifrado.</span><span class="sxs-lookup"><span data-stu-id="bdb80-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) - uses the Windows [Data Protection API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) for encryption and decryption.</span></span>

<span data-ttu-id="bdb80-139">Dado que el sistema de configuración protegida implementa el modelo de diseño del proveedor, es posible crear su propio proveedor de configuración protegida y conectarlo a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bdb80-139">Since the protected configuration system implements the provider design pattern, it is possible to create your own protected configuration provider and plug it into your application.</span></span> <span data-ttu-id="bdb80-140">Vea [implementar un proveedor de configuración protegida](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) para obtener más información sobre este proceso.</span><span class="sxs-lookup"><span data-stu-id="bdb80-140">See [Implementing a Protected Configuration Provider](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) for more information on this process.</span></span>

<span data-ttu-id="bdb80-141">Los proveedores de RSA y DPAPI usan claves para sus rutinas de cifrado y descifrado, y estas claves se pueden almacenar en el nivel de equipo o de usuario.</span><span class="sxs-lookup"><span data-stu-id="bdb80-141">The RSA and DPAPI providers use keys for their encryption and decryption routines, and these keys can be stored at the machine- or user-level.</span></span> <span data-ttu-id="bdb80-142">Las claves de nivel de equipo son ideales para los escenarios en los que la aplicación web se ejecuta en su propio servidor dedicado o si hay varias aplicaciones en un servidor que necesitan compartir información cifrada.</span><span class="sxs-lookup"><span data-stu-id="bdb80-142">Machine-level keys are ideal for scenarios where the web application runs on its own dedicated server or if there are multiple applications on a server that need to share encrypted information.</span></span> <span data-ttu-id="bdb80-143">Las claves de nivel de usuario son una opción más segura en entornos de hospedaje compartidos donde otras aplicaciones del mismo servidor no deben ser capaces de descifrar las secciones de configuración protegidas de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bdb80-143">User-level keys are a more secure option in shared hosting environments where other applications on the same server should not be able to decrypt your application s protected configuration sections.</span></span>

<span data-ttu-id="bdb80-144">En este tutorial, nuestros ejemplos usarán el proveedor de DPAPI y las claves de nivel de equipo.</span><span class="sxs-lookup"><span data-stu-id="bdb80-144">In this tutorial our examples will use the DPAPI provider and machine-level keys.</span></span> <span data-ttu-id="bdb80-145">En concreto, veremos el cifrado de la sección `<connectionStrings>` en `Web.config`, aunque se puede usar el sistema de configuración protegida para cifrar la mayoría de las `Web.config` sección.</span><span class="sxs-lookup"><span data-stu-id="bdb80-145">Specifically, we will look at encrypting the `<connectionStrings>` section in `Web.config`, although the protected configuration system can be used to encrypt most any `Web.config` section.</span></span> <span data-ttu-id="bdb80-146">Para obtener información sobre el uso de claves de nivel de usuario o el uso del proveedor de RSA, consulte los recursos en la sección lecturas adicionales al final de este tutorial.</span><span class="sxs-lookup"><span data-stu-id="bdb80-146">For information on using user-level keys or using the RSA provider, consult the resources in the Further Readings section at the end of this tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="bdb80-147">Los proveedores `RSAProtectedConfigurationProvider` y `DPAPIProtectedConfigurationProvider` se registran en el archivo `machine.config` con los nombres de proveedor `RsaProtectedConfigurationProvider` y `DataProtectionConfigurationProvider`, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="bdb80-147">The `RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider` providers are registered in the `machine.config` file with the provider names `RsaProtectedConfigurationProvider` and `DataProtectionConfigurationProvider`, respectively.</span></span> <span data-ttu-id="bdb80-148">Al cifrar o descifrar la información de configuración, es necesario proporcionar el nombre de proveedor adecuado (`RsaProtectedConfigurationProvider` o `DataProtectionConfigurationProvider`) en lugar del nombre de tipo real (`RSAProtectedConfigurationProvider` y `DPAPIProtectedConfigurationProvider`).</span><span class="sxs-lookup"><span data-stu-id="bdb80-148">When encrypting or decrypting configuration information we will need to supply the appropriate provider name (`RsaProtectedConfigurationProvider` or `DataProtectionConfigurationProvider`) rather than the actual type name (`RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider`).</span></span> <span data-ttu-id="bdb80-149">Puede encontrar el archivo de `machine.config` en la carpeta `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-149">You can find the `machine.config` file in the `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG` folder.</span></span>

## <a name="step-2-programmatically-encrypting-and-decrypting-configuration-sections"></a><span data-ttu-id="bdb80-150">Paso 2: cifrado y descifrado de las secciones de configuración mediante programación</span><span class="sxs-lookup"><span data-stu-id="bdb80-150">Step 2: Programmatically Encrypting and Decrypting Configuration Sections</span></span>

<span data-ttu-id="bdb80-151">Con unas pocas líneas de código, se puede cifrar o descifrar una sección de configuración concreta mediante un proveedor especificado.</span><span class="sxs-lookup"><span data-stu-id="bdb80-151">With a few lines of code we can encrypt or decrypt a particular configuration section using a specified provider.</span></span> <span data-ttu-id="bdb80-152">El código, como veremos en breve, solo tiene que hacer referencia mediante programación a la sección de configuración adecuada, llamar a su método `ProtectSection` o `UnprotectSection` y, a continuación, llamar al método `Save` para conservar los cambios.</span><span class="sxs-lookup"><span data-stu-id="bdb80-152">The code, as we will see shortly, simply needs to programmatically reference the appropriate configuration section, call its `ProtectSection` or `UnprotectSection` method, and then call the `Save` method to persist the changes.</span></span> <span data-ttu-id="bdb80-153">Además, el .NET Framework incluye una utilidad de línea de comandos útil que puede cifrar y descifrar la información de configuración.</span><span class="sxs-lookup"><span data-stu-id="bdb80-153">Moreover, the .NET Framework includes a helpful command line utility that can encrypt and decrypt configuration information.</span></span> <span data-ttu-id="bdb80-154">Exploraremos esta utilidad de línea de comandos en el paso 3.</span><span class="sxs-lookup"><span data-stu-id="bdb80-154">We will explore this command line utility in Step 3.</span></span>

<span data-ttu-id="bdb80-155">Para ilustrar la protección de la información de configuración mediante programación, cree una página ASP.NET que incluya botones para cifrar y descifrar la sección `<connectionStrings>` en `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-155">To illustrate programmatically protecting configuration information, let s create an ASP.NET page that includes buttons for encrypting and decrypting the `<connectionStrings>` section in `Web.config`.</span></span>

<span data-ttu-id="bdb80-156">Para empezar, abra la página `EncryptingConfigSections.aspx` de la carpeta `AdvancedDAL`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-156">Start by opening the `EncryptingConfigSections.aspx` page in the `AdvancedDAL` folder.</span></span> <span data-ttu-id="bdb80-157">Arrastre un control TextBox desde el cuadro de herramientas hasta el diseñador, estableciendo su propiedad `ID` en `WebConfigContents`, su propiedad `TextMode` en `MultiLine`y sus propiedades `Width` y `Rows` en 95% y 15, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="bdb80-157">Drag a TextBox control from the Toolbox onto the Designer, setting its `ID` property to `WebConfigContents`, its `TextMode` property to `MultiLine`, and its `Width` and `Rows` properties to 95% and 15, respectively.</span></span> <span data-ttu-id="bdb80-158">Este control TextBox mostrará el contenido de `Web.config` nos permite ver rápidamente si el contenido está cifrado o no.</span><span class="sxs-lookup"><span data-stu-id="bdb80-158">This TextBox control will display the contents of `Web.config` allowing us to quickly see if the contents are encrypted or not.</span></span> <span data-ttu-id="bdb80-159">Por supuesto, en una aplicación real nunca desearía mostrar el contenido de `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-159">Of course, in a real application you would never want to display the contents of `Web.config`.</span></span>

<span data-ttu-id="bdb80-160">Debajo del cuadro de texto, agregue dos controles de botón denominados `EncryptConnStrings` y `DecryptConnStrings`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-160">Beneath the TextBox, add two Button controls named `EncryptConnStrings` and `DecryptConnStrings`.</span></span> <span data-ttu-id="bdb80-161">Establezca sus propiedades de texto para cifrar las cadenas de conexión y descifrar las cadenas de conexión.</span><span class="sxs-lookup"><span data-stu-id="bdb80-161">Set their Text properties to Encrypt Connection Strings and Decrypt Connection Strings .</span></span>

<span data-ttu-id="bdb80-162">En este momento, la pantalla debe tener un aspecto similar al de la figura 2.</span><span class="sxs-lookup"><span data-stu-id="bdb80-162">At this point your screen should look similar to Figure 2.</span></span>

<span data-ttu-id="bdb80-163">[![agregar un cuadro de texto y dos controles Web de botón a la página](protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="bdb80-163">[![Add a TextBox and Two Button Web Controls to the Page](protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)</span></span>

<span data-ttu-id="bdb80-164">**Figura 2**: agregar un cuadro de texto y dos controles Web de botón a la página ([haga clic para ver la imagen de tamaño completo](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="bdb80-164">**Figure 2**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span></span>

<span data-ttu-id="bdb80-165">A continuación, es necesario escribir código que cargue y muestre el contenido de `Web.config` en el cuadro de texto `WebConfigContents` cuando se cargue la página por primera vez.</span><span class="sxs-lookup"><span data-stu-id="bdb80-165">Next, we need to write code that loads and displays the contents of `Web.config` in the `WebConfigContents` TextBox when the page is first loaded.</span></span> <span data-ttu-id="bdb80-166">Agregue el código siguiente a la clase de código subyacente de la página.</span><span class="sxs-lookup"><span data-stu-id="bdb80-166">Add the following code to the page s code-behind class.</span></span> <span data-ttu-id="bdb80-167">Este código agrega un método denominado `DisplayWebConfig` y lo llama desde el controlador de eventos `Page_Load` cuando se `false``Page.IsPostBack`:</span><span class="sxs-lookup"><span data-stu-id="bdb80-167">This code adds a method named `DisplayWebConfig` and calls it from the `Page_Load` event handler when `Page.IsPostBack` is `false`:</span></span>

[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample1.cs)]

<span data-ttu-id="bdb80-168">El método `DisplayWebConfig` usa la [clase`File`](https://msdn.microsoft.com/library/system.io.file.aspx) para abrir el archivo `Web.config` de la aplicación, la [clase`StreamReader`](https://msdn.microsoft.com/library/system.io.streamreader.aspx) para leer su contenido en una cadena y la [clase`Path`](https://msdn.microsoft.com/library/system.io.path.aspx) para generar la ruta de acceso física al archivo `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-168">The `DisplayWebConfig` method uses the [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) to open the application s `Web.config` file, the [`StreamReader` class](https://msdn.microsoft.com/library/system.io.streamreader.aspx) to read its contents into a string, and the [`Path` class](https://msdn.microsoft.com/library/system.io.path.aspx) to generate the physical path to the `Web.config` file.</span></span> <span data-ttu-id="bdb80-169">Estas tres clases se encuentran en el [espacio de nombres`System.IO`](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="bdb80-169">These three classes are all found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="bdb80-170">Por consiguiente, tendrá que agregar una `using` `System.IO` instrucción en la parte superior de la clase de código subyacente o, como alternativa, prefijar estos nombres de clase con `System.IO.`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-170">Consequently, you will need to add a `using` `System.IO` statement to the top of the code-behind class or, alternatively, prefix these class names with `System.IO.` .</span></span>

<span data-ttu-id="bdb80-171">A continuación, es necesario agregar controladores de eventos para los dos controles de botón `Click` eventos y agregar el código necesario para cifrar y descifrar la sección `<connectionStrings>` mediante una clave de nivel de equipo con el proveedor DPAPI.</span><span class="sxs-lookup"><span data-stu-id="bdb80-171">Next, we need to add event handlers for the two Button controls `Click` events and add the necessary code to encrypt and decrypt the `<connectionStrings>` section using a machine-level key with the DPAPI provider.</span></span> <span data-ttu-id="bdb80-172">En el diseñador, haga doble clic en cada uno de los botones para agregar un `Click` controlador de eventos en la clase de código subyacente y, a continuación, agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="bdb80-172">From the Designer, double-click each of the Buttons to add a `Click` event handler in the code-behind class and then add the following code:</span></span>

[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample2.cs)]

<span data-ttu-id="bdb80-173">El código usado en los dos controladores de eventos es casi idéntico.</span><span class="sxs-lookup"><span data-stu-id="bdb80-173">The code used in the two event handlers is nearly identical.</span></span> <span data-ttu-id="bdb80-174">Ambos empiezan por obtener información sobre el archivo de `Web.config` de la aplicación actual a través del método [`WebConfigurationManager` de clase](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) s [`OpenWebConfiguration`](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx).</span><span class="sxs-lookup"><span data-stu-id="bdb80-174">They both start by getting information about the current application s `Web.config` file via the [`WebConfigurationManager` class](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) s [`OpenWebConfiguration` method](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx).</span></span> <span data-ttu-id="bdb80-175">Este método devuelve el archivo de configuración web para la ruta de acceso virtual especificada.</span><span class="sxs-lookup"><span data-stu-id="bdb80-175">This method returns the web configuration file for the specified virtual path.</span></span> <span data-ttu-id="bdb80-176">A continuación, se tiene acceso a la sección `Web.config` File s `<connectionStrings>` a través del [método](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx) [`Configuration` Class](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) s`GetSection(sectionName)`, que devuelve un objeto [`ConfigurationSection`](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) .</span><span class="sxs-lookup"><span data-stu-id="bdb80-176">Next, the `Web.config` file s `<connectionStrings>` section is accessed via the [`Configuration` class](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) s [`GetSection(sectionName)` method](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx), which returns a [`ConfigurationSection`](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) object.</span></span>

<span data-ttu-id="bdb80-177">El objeto `ConfigurationSection` incluye una [propiedad`SectionInformation`](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) que proporciona información adicional y funcionalidad relacionada con la sección de configuración.</span><span class="sxs-lookup"><span data-stu-id="bdb80-177">The `ConfigurationSection` object includes a [`SectionInformation` property](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) that provides additional information and functionality regarding the configuration section.</span></span> <span data-ttu-id="bdb80-178">Como se muestra en el código anterior, podemos determinar si la sección de configuración está cifrada mediante la comprobación de la propiedad `SectionInformation` propiedad `IsProtected`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-178">As the code above shows, we can determine whether the configuration section is encrypted by checking the `SectionInformation` property s `IsProtected` property.</span></span> <span data-ttu-id="bdb80-179">Además, la sección se puede cifrar o descifrar a través de los métodos `ProtectSection(provider)` y `UnprotectSection` de la propiedad `SectionInformation`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-179">Moreover, the section can be encrypted or decrypted via the `SectionInformation` property s `ProtectSection(provider)` and `UnprotectSection` methods.</span></span>

<span data-ttu-id="bdb80-180">El método `ProtectSection(provider)` acepta como entrada una cadena que especifica el nombre del proveedor de configuración protegida que se va a utilizar para el cifrado.</span><span class="sxs-lookup"><span data-stu-id="bdb80-180">The `ProtectSection(provider)` method accepts as input a string specifying the name of the protected configuration provider to use when encrypting.</span></span> <span data-ttu-id="bdb80-181">En el controlador de eventos `EncryptConnString` Button s pasamos DataProtectionConfigurationProvider al método `ProtectSection(provider)` para que se use el proveedor DPAPI.</span><span class="sxs-lookup"><span data-stu-id="bdb80-181">In the `EncryptConnString` Button s event handler we pass DataProtectionConfigurationProvider into the `ProtectSection(provider)` method so that the DPAPI provider is used.</span></span> <span data-ttu-id="bdb80-182">El método `UnprotectSection` puede determinar el proveedor que se usó para cifrar la sección de configuración y, por lo tanto, no requiere ningún parámetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="bdb80-182">The `UnprotectSection` method can determine the provider that was used to encrypt the configuration section and therefore does not require any input parameters.</span></span>

<span data-ttu-id="bdb80-183">Después de llamar al método `ProtectSection(provider)` o `UnprotectSection`, debe llamar al método `Configuration` Object s [`Save`](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) para conservar los cambios.</span><span class="sxs-lookup"><span data-stu-id="bdb80-183">After calling the `ProtectSection(provider)` or `UnprotectSection` method, you must call the `Configuration` object s [`Save` method](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) to persist the changes.</span></span> <span data-ttu-id="bdb80-184">Una vez que la información de configuración se ha cifrado o descifrado y se han guardado los cambios, llamamos `DisplayWebConfig` para cargar el contenido de `Web.config` actualizado en el control de cuadro de texto.</span><span class="sxs-lookup"><span data-stu-id="bdb80-184">Once the configuration information has been encrypted or decrypted and the changes saved, we call `DisplayWebConfig` to load the updated `Web.config` contents into the TextBox control.</span></span>

<span data-ttu-id="bdb80-185">Una vez que haya escrito el código anterior, pruébelo; para ello, visite la página `EncryptingConfigSections.aspx` a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="bdb80-185">Once you have entered the above code, test it by visiting the `EncryptingConfigSections.aspx` page through a browser.</span></span> <span data-ttu-id="bdb80-186">Debe ver inicialmente una página que muestra el contenido de `Web.config` con la sección `<connectionStrings>` que se muestra en texto sin formato (vea la figura 3).</span><span class="sxs-lookup"><span data-stu-id="bdb80-186">You should initially see a page that lists the contents of `Web.config` with the `<connectionStrings>` section displayed in plain-text (see Figure 3).</span></span>

<span data-ttu-id="bdb80-187">[![agregar un cuadro de texto y dos controles Web de botón a la página](protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="bdb80-187">[![Add a TextBox and Two Button Web Controls to the Page](protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)</span></span>

<span data-ttu-id="bdb80-188">**Figura 3**: agregar un cuadro de texto y dos controles Web de botón a la página ([haga clic para ver la imagen de tamaño completo](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="bdb80-188">**Figure 3**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span></span>

<span data-ttu-id="bdb80-189">Ahora haga clic en el botón cifrar cadenas de conexión.</span><span class="sxs-lookup"><span data-stu-id="bdb80-189">Now click the Encrypt Connection Strings button.</span></span> <span data-ttu-id="bdb80-190">Si la validación de solicitudes está habilitada, el marcado devuelto desde el cuadro de texto `WebConfigContents` producirá una `HttpRequestValidationException`, que muestra el mensaje, se detectó un valor de `Request.Form` potencialmente peligroso en el cliente.</span><span class="sxs-lookup"><span data-stu-id="bdb80-190">If request validation is enabled, the markup posted back from the `WebConfigContents` TextBox will produce an `HttpRequestValidationException`, which displays the message, A potentially dangerous `Request.Form` value was detected from the client.</span></span> <span data-ttu-id="bdb80-191">La validación de solicitudes, que está habilitada de forma predeterminada en ASP.NET 2,0, prohíbe los postbacks que incluyen código HTML descodificado y está diseñado para ayudar a evitar ataques de inyección de script.</span><span class="sxs-lookup"><span data-stu-id="bdb80-191">Request validation, which is enabled by default in ASP.NET 2.0, prohibits postbacks that include un-encoded HTML and is designed to help prevent script-injection attacks.</span></span> <span data-ttu-id="bdb80-192">Esta comprobación se puede deshabilitar en el nivel de página o de aplicación.</span><span class="sxs-lookup"><span data-stu-id="bdb80-192">This check can be disabled at the page- or application-level.</span></span> <span data-ttu-id="bdb80-193">Para desactivarla en esta página, establezca el valor de `ValidateRequest` en `false` en la Directiva `@Page`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-193">To turn it off for this page, set the `ValidateRequest` setting to `false` in the `@Page` directive.</span></span> <span data-ttu-id="bdb80-194">La Directiva de `@Page` se encuentra en la parte superior del marcado declarativo de la página.</span><span class="sxs-lookup"><span data-stu-id="bdb80-194">The `@Page` directive is found at the top of the page s declarative markup.</span></span>

[!code-aspx[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample3.aspx)]

<span data-ttu-id="bdb80-195">Para obtener más información sobre la validación de solicitudes, su finalidad, cómo deshabilitarla en el nivel de página y de aplicación, así como sobre cómo codificar el marcado HTML, consulte [solicitud de validación-prevención de ataques de scripts](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="bdb80-195">For more information on request validation, its purpose, how to disable it at the page- and application-level, as well as how to HTML encode markup, see [Request Validation - Preventing Script Attacks](../../../../whitepapers/request-validation.md).</span></span>

<span data-ttu-id="bdb80-196">Después de deshabilitar la validación de solicitudes para la página, intente hacer clic de nuevo en el botón cifrar cadenas de conexión.</span><span class="sxs-lookup"><span data-stu-id="bdb80-196">After disabling request validation for the page, try clicking the Encrypt Connection Strings button again.</span></span> <span data-ttu-id="bdb80-197">En el postback, se tendrá acceso al archivo de configuración y su `<connectionStrings>` sección se cifrará mediante el proveedor de DPAPI.</span><span class="sxs-lookup"><span data-stu-id="bdb80-197">On postback, the configuration file will be accessed and its `<connectionStrings>` section encrypted using the DPAPI provider.</span></span> <span data-ttu-id="bdb80-198">A continuación, el cuadro de texto se actualiza para mostrar el nuevo contenido de `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-198">The TextBox is then updated to display the new `Web.config` content.</span></span> <span data-ttu-id="bdb80-199">Como se muestra en la figura 4, la información `<connectionStrings>` está ahora cifrada.</span><span class="sxs-lookup"><span data-stu-id="bdb80-199">As Figure 4 shows, the `<connectionStrings>` information is now encrypted.</span></span>

<span data-ttu-id="bdb80-200">[![clic en el botón cifrar cadenas de conexión cifra la &lt;connectionString&gt;](protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="bdb80-200">[![Clicking the Encrypt Connection Strings Button Encrypts the &lt;connectionString&gt; Section](protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)</span></span>

<span data-ttu-id="bdb80-201">**Figura 4**: al hacer clic en el botón cifrar cadenas de conexión, se cifra la sección `<connectionString>` ([haga clic para ver la imagen de tamaño completo](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="bdb80-201">**Figure 4**: Clicking the Encrypt Connection Strings Button Encrypts the `<connectionString>` Section ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span></span>

<span data-ttu-id="bdb80-202">A continuación se muestra la sección `<connectionStrings>` cifrada generada en el equipo, aunque se ha quitado parte del contenido del elemento `<CipherData>` por motivos de brevedad:</span><span class="sxs-lookup"><span data-stu-id="bdb80-202">The encrypted `<connectionStrings>` section generated on my computer follows, although some of the content in the `<CipherData>` element has been removed for brevity:</span></span>

[!code-xml[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample4.xml)]

> [!NOTE]
> <span data-ttu-id="bdb80-203">El elemento `<connectionStrings>` especifica el proveedor que se usa para realizar el cifrado (`DataProtectionConfigurationProvider`).</span><span class="sxs-lookup"><span data-stu-id="bdb80-203">The `<connectionStrings>` element specifies the provider used to perform the encryption (`DataProtectionConfigurationProvider`).</span></span> <span data-ttu-id="bdb80-204">El método `UnprotectSection` usa esta información cuando se hace clic en el botón descifrar cadenas de conexión.</span><span class="sxs-lookup"><span data-stu-id="bdb80-204">This information is used by the `UnprotectSection` method when the Decrypt Connection Strings button is clicked.</span></span>

<span data-ttu-id="bdb80-205">Cuando se tiene acceso a la información de la cadena de conexión desde `Web.config`, ya sea mediante el código que se escribe, desde un control SqlDataSource o desde el código generado automáticamente a partir de los TableAdapters de nuestros conjuntos de datos con tipo, se descifra automáticamente.</span><span class="sxs-lookup"><span data-stu-id="bdb80-205">When the connection string information is accessed from `Web.config` - either by code we write, from a SqlDataSource control, or the auto-generated code from the TableAdapters in our Typed DataSets - it is automatically decrypted.</span></span> <span data-ttu-id="bdb80-206">En Resumen, no es necesario agregar ninguna lógica ni código adicional para descifrar la sección `<connectionString>` cifrada.</span><span class="sxs-lookup"><span data-stu-id="bdb80-206">In short, we do not need to add any extra code or logic to decrypt the encrypted `<connectionString>` section.</span></span> <span data-ttu-id="bdb80-207">Para demostrarlo, visite uno de los tutoriales anteriores en este momento, como el tutorial de pantalla simple de la sección informes básicos (`~/BasicReporting/SimpleDisplay.aspx`).</span><span class="sxs-lookup"><span data-stu-id="bdb80-207">To demonstrate this, visit one of the earlier tutorials at this time, such as the Simple Display tutorial from the Basic Reporting section (`~/BasicReporting/SimpleDisplay.aspx`).</span></span> <span data-ttu-id="bdb80-208">Como se muestra en la figura 5, el tutorial funciona exactamente como cabría esperar, lo que indica que la página ASP.NET está descifrando automáticamente la información de la cadena de conexión cifrada.</span><span class="sxs-lookup"><span data-stu-id="bdb80-208">As Figure 5 shows, the tutorial works exactly as we would expect it, indicating that the encrypted connection string information is being automatically decrypted by the ASP.NET page.</span></span>

<span data-ttu-id="bdb80-209">[![el nivel de acceso a datos descifra automáticamente la información de la cadena de conexión](protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="bdb80-209">[![The Data Access Layer Automatically Decrypts the Connection String Information](protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)</span></span>

<span data-ttu-id="bdb80-210">**Figura 5**: el nivel de acceso a datos descifra automáticamente la información de la cadena de conexión ([haga clic para ver la imagen de tamaño completo](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="bdb80-210">**Figure 5**: The Data Access Layer Automatically Decrypts the Connection String Information ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span></span>

<span data-ttu-id="bdb80-211">Para revertir la sección `<connectionStrings>` a su representación de texto sin formato, haga clic en el botón descifrar cadenas de conexión.</span><span class="sxs-lookup"><span data-stu-id="bdb80-211">To revert the `<connectionStrings>` section back to its plain-text representation, click the Decrypt Connection Strings button.</span></span> <span data-ttu-id="bdb80-212">En el postback, debería ver las cadenas de conexión en `Web.config` en texto sin formato.</span><span class="sxs-lookup"><span data-stu-id="bdb80-212">On postback you should see the connection strings in `Web.config` in plain-text.</span></span> <span data-ttu-id="bdb80-213">En este punto, la pantalla debe parecerse a la primera vez que visita esta página (vea la figura 3).</span><span class="sxs-lookup"><span data-stu-id="bdb80-213">At this point your screen should look like it did when first visiting this page (see in Figure 3).</span></span>

## <a name="step-3-encrypting-configuration-sections-usingaspnet_regiisexe"></a><span data-ttu-id="bdb80-214">Paso 3: cifrado de las secciones de configuración con`aspnet_regiis.exe`</span><span class="sxs-lookup"><span data-stu-id="bdb80-214">Step 3: Encrypting Configuration Sections Using`aspnet_regiis.exe`</span></span>

<span data-ttu-id="bdb80-215">El .NET Framework incluye una variedad de herramientas de línea de comandos en la carpeta `$WINDOWS$\Microsoft.NET\Framework\version\`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-215">The .NET Framework includes a variety of command line tools in the `$WINDOWS$\Microsoft.NET\Framework\version\` folder.</span></span> <span data-ttu-id="bdb80-216">En el tutorial [uso de dependencias de caché de SQL](../caching-data/using-sql-cache-dependencies-cs.md) , por ejemplo, analizamos el uso de la herramienta de línea de comandos `aspnet_regsql.exe` para agregar la infraestructura necesaria para las dependencias de caché de SQL.</span><span class="sxs-lookup"><span data-stu-id="bdb80-216">In the [Using SQL Cache Dependencies](../caching-data/using-sql-cache-dependencies-cs.md) tutorial, for instance, we looked at using the `aspnet_regsql.exe` command line tool to add the infrastructure necessary for SQL cache dependencies.</span></span> <span data-ttu-id="bdb80-217">Otra herramienta de línea de comandos útil en esta carpeta es la [herramienta de registro de IIS de ASP.net (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="bdb80-217">Another useful command line tool in this folder is the [ASP.NET IIS Registration tool (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span></span> <span data-ttu-id="bdb80-218">Como su nombre implica, la herramienta de registro de IIS de ASP.NET se usa principalmente para registrar una aplicación ASP.NET 2,0 con un servidor Web de Microsoft para profesionales, IIS.</span><span class="sxs-lookup"><span data-stu-id="bdb80-218">As its name implies, the ASP.NET IIS Registration tool is primarily used to register an ASP.NET 2.0 application with Microsoft s professional-grade Web server, IIS.</span></span> <span data-ttu-id="bdb80-219">Además de las características relacionadas con IIS, la herramienta de registro de IIS de ASP.NET también se puede usar para cifrar o descifrar secciones de configuración especificadas en `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="bdb80-219">In addition to its IIS-related features, the ASP.NET IIS Registration tool can also be used to encrypt or decrypt specified configuration sections in `Web.config`.</span></span>

<span data-ttu-id="bdb80-220">La siguiente instrucción muestra la sintaxis general usada para cifrar una sección de configuración con la herramienta de línea de comandos `aspnet_regiis.exe`:</span><span class="sxs-lookup"><span data-stu-id="bdb80-220">The following statement shows the general syntax used to encrypt a configuration section with the `aspnet_regiis.exe` command line tool:</span></span>

[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample5.cmd)]

<span data-ttu-id="bdb80-221">la *sección* es la sección de configuración para cifrar (como connectionStrings), el *directorio físico\_* es la ruta de acceso física completa al directorio raíz de la aplicación web y el *proveedor* es el nombre del proveedor de configuración protegida que se va a usar (por ejemplo, DataProtectionConfigurationProvider).</span><span class="sxs-lookup"><span data-stu-id="bdb80-221">*section* is the configuration section to encrypt (like connectionStrings ), the *physical\_directory* is the full, physical path to the web application s root directory, and *provider* is the name of the protected configuration provider to use (such as DataProtectionConfigurationProvider ).</span></span> <span data-ttu-id="bdb80-222">O bien, si la aplicación web está registrada en IIS, puede escribir la ruta de acceso virtual en lugar de la ruta de acceso física con la siguiente sintaxis:</span><span class="sxs-lookup"><span data-stu-id="bdb80-222">Alternatively, if the web application is registered in IIS you can enter the virtual path instead of the physical path using the following syntax:</span></span>

[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample6.cmd)]

<span data-ttu-id="bdb80-223">En el siguiente ejemplo de `aspnet_regiis.exe` se cifra la sección `<connectionStrings>` mediante el proveedor DPAPI con una clave de nivel de equipo:</span><span class="sxs-lookup"><span data-stu-id="bdb80-223">The following `aspnet_regiis.exe` example encrypts the `<connectionStrings>` section using the DPAPI provider with a machine-level key:</span></span>

[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample7.cmd)]

<span data-ttu-id="bdb80-224">Del mismo modo, la herramienta de línea de comandos `aspnet_regiis.exe` se puede usar para descifrar las secciones de configuración.</span><span class="sxs-lookup"><span data-stu-id="bdb80-224">Similarly, the `aspnet_regiis.exe` command line tool can be used to decrypt configuration sections.</span></span> <span data-ttu-id="bdb80-225">En lugar de usar el modificador `-pef`, use `-pdf` (o en lugar de `-pe`, use `-pd`).</span><span class="sxs-lookup"><span data-stu-id="bdb80-225">Instead of using the `-pef` switch, use `-pdf` (or instead of `-pe`, use `-pd`).</span></span> <span data-ttu-id="bdb80-226">Además, tenga en cuenta que el nombre del proveedor no es necesario al descifrar.</span><span class="sxs-lookup"><span data-stu-id="bdb80-226">Also, note that the provider name is not necessary when decrypting.</span></span>

[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample8.cmd)]

> [!NOTE]
> <span data-ttu-id="bdb80-227">Puesto que estamos usando el proveedor DPAPI, que usa claves específicas del equipo, debe ejecutar `aspnet_regiis.exe` desde el mismo equipo desde el que se atienden las páginas Web.</span><span class="sxs-lookup"><span data-stu-id="bdb80-227">Since we are using the DPAPI provider, which uses keys specific to the computer, you must run `aspnet_regiis.exe` from the same machine from which the web pages are being served.</span></span> <span data-ttu-id="bdb80-228">Por ejemplo, si ejecuta este programa de línea de comandos desde el equipo de desarrollo local y, a continuación, carga el archivo Web. config cifrado en el servidor de producción, el servidor de producción no podrá descifrar la información de la cadena de conexión desde que se cifró. usar claves específicas del equipo de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="bdb80-228">For example, if you run this command line program from your local development machine and then upload the encrypted Web.config file to the production server, the production server will not be able to decrypt the connection string information since it was encrypted using keys specific to your development machine.</span></span> <span data-ttu-id="bdb80-229">El proveedor RSA no tiene esta limitación, ya que es posible exportar las claves RSA a otra máquina.</span><span class="sxs-lookup"><span data-stu-id="bdb80-229">The RSA provider does not have this limitation as it is possible to export the RSA keys to another machine.</span></span>

## <a name="understanding-database-authentication-options"></a><span data-ttu-id="bdb80-230">Descripción de las opciones de autenticación de base de datos</span><span class="sxs-lookup"><span data-stu-id="bdb80-230">Understanding Database Authentication Options</span></span>

<span data-ttu-id="bdb80-231">Antes de que cualquier aplicación pueda emitir `SELECT`, `INSERT`, `UPDATE`o `DELETE` consultas a una base de datos de Microsoft SQL Server, la base de datos debe identificar primero al solicitante.</span><span class="sxs-lookup"><span data-stu-id="bdb80-231">Before any application can issue `SELECT`, `INSERT`, `UPDATE`, or `DELETE` queries to a Microsoft SQL Server database, the database first must identify the requestor.</span></span> <span data-ttu-id="bdb80-232">Este proceso se conoce como *autenticación* y SQL Server proporciona dos métodos de autenticación:</span><span class="sxs-lookup"><span data-stu-id="bdb80-232">This process is known as *authentication* and SQL Server provides two methods of authentication:</span></span>

- <span data-ttu-id="bdb80-233">**Autenticación de Windows** : el proceso en el que se ejecuta la aplicación se usa para comunicarse con la base de datos.</span><span class="sxs-lookup"><span data-stu-id="bdb80-233">**Windows Authentication** - the process under which the application is running is used to communicate with the database.</span></span> <span data-ttu-id="bdb80-234">Al ejecutar una aplicación de ASP.NET a través de Visual Studio 2005 s Servidor de desarrollo de ASP.NET, la aplicación ASP.NET asume la identidad del usuario que ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="bdb80-234">When running an ASP.NET application through Visual Studio 2005 s ASP.NET Development Server, the ASP.NET application assumes the identity of the currently logged on user.</span></span> <span data-ttu-id="bdb80-235">En el caso de las aplicaciones de ASP.NET en Microsoft Internet Information Server (IIS), las aplicaciones de ASP.NET normalmente suponen la identidad de `domainName``\MachineName` o `domainName``\NETWORK SERVICE`, aunque esto se puede personalizar.</span><span class="sxs-lookup"><span data-stu-id="bdb80-235">For ASP.NET applications on Microsoft Internet Information Server (IIS), ASP.NET applications usually assume the identity of `domainName``\MachineName` or `domainName``\NETWORK SERVICE`, although this can be customized.</span></span>
- <span data-ttu-id="bdb80-236">**Autenticación de SQL** : los valores de ID. de usuario y contraseña se proporcionan como credenciales para la autenticación.</span><span class="sxs-lookup"><span data-stu-id="bdb80-236">**SQL Authentication** - a user ID and password values are supplied as credentials for authentication.</span></span> <span data-ttu-id="bdb80-237">Con la autenticación de SQL, el ID. de usuario y la contraseña se proporcionan en la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="bdb80-237">With SQL authentication, the user ID and password are provided in the connection string.</span></span>

<span data-ttu-id="bdb80-238">La autenticación de Windows es preferible a la autenticación de SQL porque es más segura.</span><span class="sxs-lookup"><span data-stu-id="bdb80-238">Windows authentication is preferred over SQL authentication because it is more secure.</span></span> <span data-ttu-id="bdb80-239">Con la autenticación de Windows, la cadena de conexión es gratuita de un nombre de usuario y una contraseña, y si el servidor Web y el servidor de base de datos residen en dos equipos diferentes, las credenciales no se envían a través de la red en texto sin formato.</span><span class="sxs-lookup"><span data-stu-id="bdb80-239">With Windows authentication the connection string is free from a username and password and if the web server and database server reside on two different machines, the credentials are not sent over the network in plain-text.</span></span> <span data-ttu-id="bdb80-240">Sin embargo, con la autenticación de SQL, las credenciales de autenticación están codificadas de forma rígida en la cadena de conexión y se transmiten desde el servidor Web al servidor de bases de datos en texto sin formato.</span><span class="sxs-lookup"><span data-stu-id="bdb80-240">With SQL authentication, however, the authentication credentials are hard-coded in the connection string and are transmitted from the web server to the database server in plain-text.</span></span>

<span data-ttu-id="bdb80-241">Estos tutoriales han usado la autenticación de Windows.</span><span class="sxs-lookup"><span data-stu-id="bdb80-241">These tutorials have used Windows authentication.</span></span> <span data-ttu-id="bdb80-242">Para saber qué modo de autenticación se está usando, inspeccione la cadena de conexión.</span><span class="sxs-lookup"><span data-stu-id="bdb80-242">You can tell what authentication mode is being used by inspecting the connection string.</span></span> <span data-ttu-id="bdb80-243">La cadena de conexión de `Web.config` para nuestros tutoriales ha sido:</span><span class="sxs-lookup"><span data-stu-id="bdb80-243">The connection string in `Web.config` for our tutorials has been:</span></span>

`Data Source=.\SQLEXPRESS; AttachDbFilename=|DataDirectory|\NORTHWND.MDF; Integrated Security=True; User Instance=True`

<span data-ttu-id="bdb80-244">La seguridad integrada = true y la falta de un nombre de usuario y contraseña indican que se está usando la autenticación de Windows.</span><span class="sxs-lookup"><span data-stu-id="bdb80-244">The Integrated Security=True and lack of a username and password indicate that Windows authentication is being used.</span></span> <span data-ttu-id="bdb80-245">En algunas cadenas de conexión, se usa el término conexión de confianza = sí o Integrated Security = SSPI en lugar de Integrated Security = true, pero los tres indican el uso de la autenticación de Windows.</span><span class="sxs-lookup"><span data-stu-id="bdb80-245">In some connection strings the term Trusted Connection=Yes or Integrated Security=SSPI is used instead of Integrated Security=True, but all three indicate the use of Windows authentication.</span></span>

<span data-ttu-id="bdb80-246">En el ejemplo siguiente se muestra una cadena de conexión que usa la autenticación de SQL.</span><span class="sxs-lookup"><span data-stu-id="bdb80-246">The following example shows a connection string that uses SQL authentication.</span></span> <span data-ttu-id="bdb80-247">Anote las credenciales incrustadas en la cadena de conexión:</span><span class="sxs-lookup"><span data-stu-id="bdb80-247">Note the credentials embedded within the connection string:</span></span>

`Server=serverName; Database=Northwind; uid=userID; pwd=password`

<span data-ttu-id="bdb80-248">Imagine que un atacante puede ver el archivo de `Web.config` de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bdb80-248">Imagine that an attacker is able to view your application s `Web.config` file.</span></span> <span data-ttu-id="bdb80-249">Si usa la autenticación de SQL para conectarse a una base de datos a la que se puede tener acceso a través de Internet, el atacante puede utilizar esta cadena de conexión para conectarse a la base de datos a través de SQL Management Studio o desde páginas de ASP.NET en su propio sitio Web.</span><span class="sxs-lookup"><span data-stu-id="bdb80-249">If you use SQL authentication to connect to a database that is accessible over the Internet, the attacker can use this connection string to connect to your database through SQL Management Studio or from ASP.NET pages on their own website.</span></span> <span data-ttu-id="bdb80-250">Para ayudar a mitigar esta amenaza, cifre la información de la cadena de conexión en `Web.config` mediante el sistema de configuración protegida.</span><span class="sxs-lookup"><span data-stu-id="bdb80-250">To help mitigate this threat, encrypt the connection string information in `Web.config` using the protected configuration system.</span></span>

> [!NOTE]
> <span data-ttu-id="bdb80-251">Para obtener más información sobre los diferentes tipos de autenticación disponibles en SQL Server, vea [Building secure ASP.Net Applications: autenticación, autorización y comunicación segura](https://msdn.microsoft.com/library/aa302392.aspx).</span><span class="sxs-lookup"><span data-stu-id="bdb80-251">For more information on the different types of authentication available in SQL Server, see [Building Secure ASP.NET Applications: Authentication, Authorization, and Secure Communication](https://msdn.microsoft.com/library/aa302392.aspx).</span></span> <span data-ttu-id="bdb80-252">Para obtener más ejemplos de cadenas de conexión que ilustran las diferencias entre la sintaxis de autenticación de Windows y SQL, consulte [connectionStrings.com](http://www.connectionstrings.com/).</span><span class="sxs-lookup"><span data-stu-id="bdb80-252">For further connection string examples illustrating the differences between Windows and SQL authentication syntax, refer to [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>

## <a name="summary"></a><span data-ttu-id="bdb80-253">Resumen</span><span class="sxs-lookup"><span data-stu-id="bdb80-253">Summary</span></span>

<span data-ttu-id="bdb80-254">De forma predeterminada, no se puede tener acceso a los archivos con una extensión `.config` en una aplicación ASP.NET a través de un explorador.</span><span class="sxs-lookup"><span data-stu-id="bdb80-254">By default, files with a `.config` extension in an ASP.NET application cannot be accessed through a browser.</span></span> <span data-ttu-id="bdb80-255">Estos tipos de archivos no se devuelven porque pueden contener información confidencial, como cadenas de conexión de base de datos, nombres de usuario y contraseñas, etc.</span><span class="sxs-lookup"><span data-stu-id="bdb80-255">These types of files are not returned because they may contain sensitive information, such as database connection strings, usernames and passwords, and so on.</span></span> <span data-ttu-id="bdb80-256">El sistema de configuración protegido en .NET 2,0 ayuda a proteger aún más la información confidencial permitiendo el cifrado de las secciones de configuración especificadas.</span><span class="sxs-lookup"><span data-stu-id="bdb80-256">The protected configuration system in .NET 2.0 helps further protect sensitive information by allowing specified configuration sections to be encrypted.</span></span> <span data-ttu-id="bdb80-257">Hay dos proveedores de configuración protegidos integrados: uno que usa el algoritmo RSA y otro que usa la API de protección de datos de Windows (DPAPI).</span><span class="sxs-lookup"><span data-stu-id="bdb80-257">There are two built-in protected configuration providers: one that uses the RSA algorithm and one that uses the Windows Data Protection API (DPAPI).</span></span>

<span data-ttu-id="bdb80-258">En este tutorial, hemos examinado cómo cifrar y descifrar los valores de configuración mediante el proveedor de DPAPI.</span><span class="sxs-lookup"><span data-stu-id="bdb80-258">In this tutorial we looked at how to encrypt and decrypt configuration settings using the DPAPI provider.</span></span> <span data-ttu-id="bdb80-259">Esto se puede realizar mediante programación, como vimos en el paso 2, así como a través de la herramienta de línea de comandos `aspnet_regiis.exe`, que se trató en el paso 3.</span><span class="sxs-lookup"><span data-stu-id="bdb80-259">This can be accomplished both programmatically, as we saw in Step 2, as well as through the `aspnet_regiis.exe` command line tool, which was covered in Step 3.</span></span> <span data-ttu-id="bdb80-260">Para obtener más información sobre el uso de claves de nivel de usuario o el uso del proveedor de RSA en su lugar, vea los recursos en la sección de lecturas adicionales.</span><span class="sxs-lookup"><span data-stu-id="bdb80-260">For more information on using user-level keys or using the RSA provider instead, see the resources in the Further Reading section.</span></span>

<span data-ttu-id="bdb80-261">¡ Feliz programación!</span><span class="sxs-lookup"><span data-stu-id="bdb80-261">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="bdb80-262">Información adicional</span><span class="sxs-lookup"><span data-stu-id="bdb80-262">Further Reading</span></span>

<span data-ttu-id="bdb80-263">Para obtener más información sobre los temas descritos en este tutorial, consulte los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="bdb80-263">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="bdb80-264">Creación de una aplicación de ASP.NET segura: autenticación, autorización y comunicación segura</span><span class="sxs-lookup"><span data-stu-id="bdb80-264">Building Secure ASP.NET Application: Authentication, Authorization, and Secure Communication</span></span>](https://msdn.microsoft.com/library/aa302392.aspx)
- [<span data-ttu-id="bdb80-265">Cifrar la información de configuración en aplicaciones ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="bdb80-265">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="bdb80-266">Cifrado de los valores de `Web.config` en ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="bdb80-266">Encrypting `Web.config` Values in ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/archive/2006/01/09/434893.aspx)
- [<span data-ttu-id="bdb80-267">Cómo: cifrar secciones de configuración en ASP.NET 2,0 con DPAPI</span><span class="sxs-lookup"><span data-stu-id="bdb80-267">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using DPAPI</span></span>](https://msdn.microsoft.com/library/ms998280.aspx)
- [<span data-ttu-id="bdb80-268">Cómo: cifrar secciones de configuración en ASP.NET 2,0 mediante RSA</span><span class="sxs-lookup"><span data-stu-id="bdb80-268">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using RSA</span></span>](https://msdn.microsoft.com/library/ms998283.aspx)
- [<span data-ttu-id="bdb80-269">La API de configuración en .NET 2,0</span><span class="sxs-lookup"><span data-stu-id="bdb80-269">The Configuration API in .NET 2.0</span></span>](http://www.odetocode.com/Articles/418.aspx)
- [<span data-ttu-id="bdb80-270">Protección de datos de Windows</span><span class="sxs-lookup"><span data-stu-id="bdb80-270">Windows Data Protection</span></span>](https://msdn.microsoft.com/library/ms995355.aspx)

## <a name="about-the-author"></a><span data-ttu-id="bdb80-271">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="bdb80-271">About the Author</span></span>

<span data-ttu-id="bdb80-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros de ASP/ASP. net y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), ha estado trabajando con las tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="bdb80-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="bdb80-273">Scott funciona como consultor, profesor y redactor independiente.</span><span class="sxs-lookup"><span data-stu-id="bdb80-273">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="bdb80-274">Su último libro se [*enseña a ASP.NET 2,0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="bdb80-274">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="bdb80-275">Puede ponerse en contacto con usted en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="bdb80-275">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="bdb80-276">o a través de su blog, que encontrará en [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="bdb80-276">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="bdb80-277">Agradecimiento especial a</span><span class="sxs-lookup"><span data-stu-id="bdb80-277">Special Thanks To</span></span>

<span data-ttu-id="bdb80-278">Muchos revisores útiles revisaron esta serie de tutoriales.</span><span class="sxs-lookup"><span data-stu-id="bdb80-278">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="bdb80-279">Los revisores responsables de este tutorial eran Teresa Murphy y Randy Schmidt.</span><span class="sxs-lookup"><span data-stu-id="bdb80-279">Lead reviewers for this tutorial were Teresa Murphy and Randy Schmidt.</span></span> <span data-ttu-id="bdb80-280">¿Está interesado en revisar los próximos artículos de MSDN?</span><span class="sxs-lookup"><span data-stu-id="bdb80-280">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="bdb80-281">En caso afirmativo, suéltelo en [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="bdb80-281">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="bdb80-282">[Anterior](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
> [Siguiente](debugging-stored-procedures-cs.md)</span><span class="sxs-lookup"><span data-stu-id="bdb80-282">[Previous](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
[Next](debugging-stored-procedures-cs.md)</span></span>
