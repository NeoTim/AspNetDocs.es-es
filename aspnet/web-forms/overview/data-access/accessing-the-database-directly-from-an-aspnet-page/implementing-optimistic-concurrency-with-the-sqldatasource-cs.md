---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-cs
title: Implementar la simultaneidad optimista con SqlDataSource (C#) | Microsoft Docs
author: rick-anderson
description: En este tutorial revisaremos los aspectos básicos de control de simultaneidad optimista y, a continuación, explore cómo se implementa mediante el control SqlDataSource.
ms.author: riande
ms.date: 02/20/2007
ms.assetid: df999966-ac48-460e-b82b-4877a57d6ab9
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-cs
msc.type: authoredcontent
ms.openlocfilehash: dd2b44803f00f7e194e2c41f448d579865da58b6
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/06/2019
ms.locfileid: "65115116"
---
# <a name="implementing-optimistic-concurrency-with-the-sqldatasource-c"></a><span data-ttu-id="0a07a-103">Implementar la simultaneidad optimista con SqlDataSource (C#)</span><span class="sxs-lookup"><span data-stu-id="0a07a-103">Implementing Optimistic Concurrency with the SqlDataSource (C#)</span></span>

<span data-ttu-id="0a07a-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0a07a-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0a07a-105">[Descargue la aplicación de ejemplo](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_CS.exe) o [descargar PDF](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/datatutorial50cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="0a07a-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_CS.exe) or [Download PDF](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/datatutorial50cs1.pdf)</span></span>

> <span data-ttu-id="0a07a-106">En este tutorial revisaremos los aspectos básicos de control de simultaneidad optimista y, a continuación, explore cómo se implementa mediante el control SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0a07a-106">In this tutorial we review the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource control.</span></span>

## <a name="introduction"></a><span data-ttu-id="0a07a-107">Introducción</span><span class="sxs-lookup"><span data-stu-id="0a07a-107">Introduction</span></span>

<span data-ttu-id="0a07a-108">En el tutorial anterior, hemos visto cómo agregar, insertar, actualizar y eliminar capacidades para el control SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0a07a-108">In the preceding tutorial we examined how to add inserting, updating, and deleting capabilities to the SqlDataSource control.</span></span> <span data-ttu-id="0a07a-109">En resumen, para proporcionar estas características se necesita especificar correspondiente `INSERT`, `UPDATE`, o `DELETE` instrucción SQL en el control s `InsertCommand`, `UpdateCommand`, o `DeleteCommand` propiedades, junto con la correspondiente los parámetros en el `InsertParameters`, `UpdateParameters`, y `DeleteParameters` colecciones.</span><span class="sxs-lookup"><span data-stu-id="0a07a-109">In short, to provide these features we needed to specify the corresponding `INSERT`, `UPDATE`, or `DELETE` SQL statement in the control s `InsertCommand`, `UpdateCommand`, or `DeleteCommand` properties, along with the appropriate parameters in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span> <span data-ttu-id="0a07a-110">Aunque estas propiedades y las colecciones se pueden especificar manualmente, el botón de opciones avanzadas de s de Asistente para configurar origen de datos ofrece una generar `INSERT`, `UPDATE`, y `DELETE` casilla de verificación de las instrucciones que se creará automáticamente estas instrucciones según el `SELECT` instrucción.</span><span class="sxs-lookup"><span data-stu-id="0a07a-110">While these properties and collections can be specified manually, the Configure Data Source wizard s Advanced button offers a Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox that will auto-create these statements based on the `SELECT` statement.</span></span>

<span data-ttu-id="0a07a-111">Junto con la generar `INSERT`, `UPDATE`, y `DELETE` casilla de verificación de las instrucciones, el cuadro de diálogo Opciones de generación SQL avanzadas incluye una opción de usar simultaneidad optimista (consulte la figura 1).</span><span class="sxs-lookup"><span data-stu-id="0a07a-111">Along with the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox, the Advanced SQL Generation Options dialog box includes a Use optimistic concurrency option (see Figure 1).</span></span> <span data-ttu-id="0a07a-112">Cuando está activada, el `WHERE` cláusulas en el autogenerados `UPDATE` y `DELETE` se modifican las instrucciones para solo realizar la actualización o eliminación si la base de datos subyacente no se ha modificado desde que el usuario cargó por última vez los datos en la cuadrícula.</span><span class="sxs-lookup"><span data-stu-id="0a07a-112">When checked, the `WHERE` clauses in the autogenerated `UPDATE` and `DELETE` statements are modified to only perform the update or delete if the underlying database data hasn't been modified since the user last loaded the data into the grid.</span></span>

![Puede agregar compatibilidad con la simultaneidad optimista de la avanzada cuadro de diálogo Opciones de generación de SQL](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image1.gif)

<span data-ttu-id="0a07a-114">**Figura 1**: Puede agregar compatibilidad con la simultaneidad optimista de la avanzada cuadro de diálogo Opciones de generación de SQL</span><span class="sxs-lookup"><span data-stu-id="0a07a-114">**Figure 1**: You Can Add Optimistic Concurrency Support from the Advanced SQL Generation Options Dialog Box</span></span>

<span data-ttu-id="0a07a-115">En el [implementar simultaneidad optimista](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial se examinan los fundamentos del control de simultaneidad optimista y cómo agregarlo a ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="0a07a-115">Back in the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial we examined the fundamentals of optimistic concurrency control and how to add it to the ObjectDataSource.</span></span> <span data-ttu-id="0a07a-116">En este tutorial crearemos Retocar en las operaciones básicas de control de simultaneidad optimista y, a continuación, explore cómo implementarla mediante SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0a07a-116">In this tutorial we'll retouch on the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource.</span></span>

## <a name="a-recap-of-optimistic-concurrency"></a><span data-ttu-id="0a07a-117">Un resumen de la simultaneidad optimista</span><span class="sxs-lookup"><span data-stu-id="0a07a-117">A Recap of Optimistic Concurrency</span></span>

<span data-ttu-id="0a07a-118">Para las aplicaciones web que permiten a varios usuarios simultáneos para editar o eliminar los mismos datos, existe la posibilidad de que un usuario podría sobrescribir accidentalmente otra cambios s.</span><span class="sxs-lookup"><span data-stu-id="0a07a-118">For web applications that allow multiple, simultaneous users to edit or delete the same data, there exists a possibility that one user may accidentally overwrite another s changes.</span></span> <span data-ttu-id="0a07a-119">En el [implementar simultaneidad optimista](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial proporciona en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="0a07a-119">In the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial I provided the following example:</span></span>

<span data-ttu-id="0a07a-120">Imagine que dos usuarios, Jisun y Sam, visitan una página en una aplicación que permite a los visitantes actualizar y eliminar productos a través de un control GridView en ambos.</span><span class="sxs-lookup"><span data-stu-id="0a07a-120">Imagine that two users, Jisun and Sam, were both visiting a page in an application that allowed visitors to update and delete products through a GridView control.</span></span> <span data-ttu-id="0a07a-121">Haga clic en el botón Editar para Chai aproximadamente al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="0a07a-121">Both click the Edit button for Chai around the same time.</span></span> <span data-ttu-id="0a07a-122">Jisun cambia el nombre del producto a Chai té y hace clic en el botón Actualizar.</span><span class="sxs-lookup"><span data-stu-id="0a07a-122">Jisun changes the product name to Chai Tea and clicks the Update button.</span></span> <span data-ttu-id="0a07a-123">El resultado neto es un `UPDATE` instrucción que se envía a la base de datos, que establece *todas* de los campos actualizables de producto s (aunque Jisun solo actualiza un campo, `ProductName`).</span><span class="sxs-lookup"><span data-stu-id="0a07a-123">The net result is an `UPDATE` statement that is sent to the database, which sets *all* of the product s updateable fields (even though Jisun only updated one field, `ProductName`).</span></span> <span data-ttu-id="0a07a-124">En este momento, la base de datos tiene los valores de té Chai, la categoría Bebidas, los líquidos exóticas de proveedor, y así sucesivamente para este producto en particular.</span><span class="sxs-lookup"><span data-stu-id="0a07a-124">At this point in time, the database has the values Chai Tea, the category Beverages, the supplier Exotic Liquids, and so on for this particular product.</span></span> <span data-ttu-id="0a07a-125">Sin embargo, el control GridView en pantalla de Sam s sigue mostrando el nombre del producto en la fila GridView editable como Chai.</span><span class="sxs-lookup"><span data-stu-id="0a07a-125">However, the GridView on Sam s screen still shows the product name in the editable GridView row as Chai.</span></span> <span data-ttu-id="0a07a-126">Unos pocos segundos después de que se han realizado cambios de s Jisun, Sam actualizaciones de la categoría condimentos y hace clic en actualizar.</span><span class="sxs-lookup"><span data-stu-id="0a07a-126">A few seconds after Jisun s changes have been committed, Sam updates the category to Condiments and clicks Update.</span></span> <span data-ttu-id="0a07a-127">Esto da como resultado un `UPDATE` instrucción enviada a la base de datos que establece el nombre del producto a Chai, la `CategoryID` para el Id. de categoría condimentos correspondiente y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="0a07a-127">This results in an `UPDATE` statement sent to the database that sets the product name to Chai, the `CategoryID` to the corresponding Condiments category ID, and so on.</span></span> <span data-ttu-id="0a07a-128">Se han sobrescrito los cambios de s Jisun al nombre del producto.</span><span class="sxs-lookup"><span data-stu-id="0a07a-128">Jisun s changes to the product name have been overwritten.</span></span>

<span data-ttu-id="0a07a-129">Figura 2 ilustra esta interacción.</span><span class="sxs-lookup"><span data-stu-id="0a07a-129">Figure 2 illustrates this interaction.</span></span>

<span data-ttu-id="0a07a-130">[![Cuando dos usuarios simultáneamente actualizan un registro existe potencial s para un usuario s cambia esta opción para sobrescribir los otros elementos](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0a07a-130">[![When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image1.png)</span></span>

<span data-ttu-id="0a07a-131">**Figura 2**: Cuando dos usuarios simultáneamente actualización un registro existe s potencial para un usuario s los cambios en sobrescribir los otros s ([haga clic aquí para ver imagen en tamaño completo](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="0a07a-131">**Figure 2**: When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.png))</span></span>

<span data-ttu-id="0a07a-132">Para evitar que este escenario como el desarrollo, una forma de [control de simultaneidad](http://en.wikipedia.org/wiki/Concurrency_control) debe implementarse.</span><span class="sxs-lookup"><span data-stu-id="0a07a-132">To prevent this scenario from unfolding, a form of [concurrency control](http://en.wikipedia.org/wiki/Concurrency_control) must be implemented.</span></span> <span data-ttu-id="0a07a-133">[Simultaneidad optimista](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) el enfoque de este tutorial funciona en la suposición de que, aunque allí, puede producirse conflictos de simultaneidad cada ahora y, a continuación, la mayoría de las veces no surgen estos conflictos.</span><span class="sxs-lookup"><span data-stu-id="0a07a-133">[Optimistic concurrency](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) the focus of this tutorial works on the assumption that while there may be concurrency conflicts every now and then, the vast majority of the time such conflicts won't arise.</span></span> <span data-ttu-id="0a07a-134">Por lo tanto, si surge un conflicto, el control de simultaneidad optimista simplemente informa al usuario que su t de cambios puede se puede guardar porque otro usuario modificó los mismos datos.</span><span class="sxs-lookup"><span data-stu-id="0a07a-134">Therefore, if a conflict does arise, optimistic concurrency control simply informs the user that their changes can t be saved because another user has modified the same data.</span></span>

> [!NOTE]
> <span data-ttu-id="0a07a-135">Para las aplicaciones donde se supone que habrá muchos conflictos de simultaneidad o si este tipo de conflictos no es válidos, a continuación, el control de simultaneidad pesimista puede utilizarse en su lugar.</span><span class="sxs-lookup"><span data-stu-id="0a07a-135">For applications where it is assumed that there will be many concurrency conflicts or if such conflicts are not tolerable, then pessimistic concurrency control can be used instead.</span></span> <span data-ttu-id="0a07a-136">Vuelva a consultar el [implementar simultaneidad optimista](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial para obtener una explicación más completa en el control de simultaneidad pesimista.</span><span class="sxs-lookup"><span data-stu-id="0a07a-136">Refer back to the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial for a more thorough discussion on pessimistic concurrency control.</span></span>

<span data-ttu-id="0a07a-137">Control de simultaneidad optimista funciona asegurándose de que el registro que se va a actualizar o eliminar tiene los mismos valores que tenía cuando se inició la actualización o eliminación de proceso.</span><span class="sxs-lookup"><span data-stu-id="0a07a-137">Optimistic concurrency control works by ensuring that the record being updated or deleted has the same values as it did when the updating or deleting process started.</span></span> <span data-ttu-id="0a07a-138">Por ejemplo, al hacer clic en el botón Editar de un control GridView editable, los valores del registro s se leen de la base de datos y muestran en cuadros de texto y otros controles Web.</span><span class="sxs-lookup"><span data-stu-id="0a07a-138">For example, when clicking the Edit button in an editable GridView, the record s values are read from the database and displayed in TextBoxes and other Web controls.</span></span> <span data-ttu-id="0a07a-139">Estos valores originales se guardan por el control GridView.</span><span class="sxs-lookup"><span data-stu-id="0a07a-139">These original values are saved by the GridView.</span></span> <span data-ttu-id="0a07a-140">Más adelante, cuando el usuario hace que sus cambios y hace clic en el botón de actualización, el `UPDATE` instrucción utilizada debe tener en cuenta los valores originales además de los valores nuevos y solo actualiza el registro de base de datos subyacente, si los valores que el usuario comenzó a editar el original son idénticos a los valores en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="0a07a-140">Later, after the user makes her changes and clicks the Update button, the `UPDATE` statement used must take into account the original values plus the new values and only update the underlying database record if the original values that the user started editing are identical to the values still in the database.</span></span> <span data-ttu-id="0a07a-141">Figura 3 muestra esta secuencia de eventos.</span><span class="sxs-lookup"><span data-stu-id="0a07a-141">Figure 3 depicts this sequence of events.</span></span>

<span data-ttu-id="0a07a-142">[![Para que la actualización o eliminación se realice correctamente, los valores originales deben ser iguales a los valores actuales de la base de datos](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="0a07a-142">[![For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.png)</span></span>

<span data-ttu-id="0a07a-143">**Figura 3**: Para la actualización o eliminación que sea un éxito, el Original valores debe ser igual que los valores actuales de la base de datos ([haga clic aquí para ver imagen en tamaño completo](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="0a07a-143">**Figure 3**: For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.png))</span></span>

<span data-ttu-id="0a07a-144">Hay varios enfoques para implementar la simultaneidad optimista (consulte [Peter A. Bromberg](http://www.eggheadcafe.com/articles/pbrombergresume.asp)del [lógica de actualización de concurrencia optimista](http://www.eggheadcafe.com/articles/20050719.asp) para un breve vistazo a una serie de opciones).</span><span class="sxs-lookup"><span data-stu-id="0a07a-144">There are various approaches to implementing optimistic concurrency (see [Peter A. Bromberg](http://www.eggheadcafe.com/articles/pbrombergresume.asp)'s [Optimistic Concurrency Updating Logic](http://www.eggheadcafe.com/articles/20050719.asp) for a brief look at a number of options).</span></span> <span data-ttu-id="0a07a-145">La técnica empleada por SqlDataSource (así como por los DataSets con tipo ADO.NET que se utiliza en la capa de acceso a datos) aumenta la `WHERE` cláusula para incluir una comparación de todos los valores originales.</span><span class="sxs-lookup"><span data-stu-id="0a07a-145">The technique used by the SqlDataSource (as well as by the ADO.NET Typed DataSets used in our Data Access Layer) augments the `WHERE` clause to include a comparison of all of the original values.</span></span> <span data-ttu-id="0a07a-146">La siguiente `UPDATE` instrucción, por ejemplo, actualiza el nombre y el precio de un producto sólo si los valores actuales de la base de datos son iguales a los valores que se recuperaron originalmente al actualizar el registro en el control GridView.</span><span class="sxs-lookup"><span data-stu-id="0a07a-146">The following `UPDATE` statement, for example, updates the name and price of a product only if the current database values are equal to the values that were originally retrieved when updating the record in the GridView.</span></span> <span data-ttu-id="0a07a-147">El `@ProductName` y `@UnitPrice` parámetros contienen los nuevos valores especificados por el usuario, mientras que `@original_ProductName` y `@original_UnitPrice` contienen los valores que se cargaron originalmente en el control GridView cuando se hace clic en el botón Editar:</span><span class="sxs-lookup"><span data-stu-id="0a07a-147">The `@ProductName` and `@UnitPrice` parameters contain the new values entered by the user, whereas `@original_ProductName` and `@original_UnitPrice` contain the values that were originally loaded into the GridView when the Edit button was clicked:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample1.sql)]

<span data-ttu-id="0a07a-148">Como veremos en este tutorial, la habilitación del control de simultaneidad optimista con SqlDataSource es tan sencillo como activar una casilla.</span><span class="sxs-lookup"><span data-stu-id="0a07a-148">As we'll see in this tutorial, enabling optimistic concurrency control with the SqlDataSource is as simple as checking a checkbox.</span></span>

## <a name="step-1-creating-a-sqldatasource-that-supports-optimistic-concurrency"></a><span data-ttu-id="0a07a-149">Paso 1: Crear un SqlDataSource que admite la simultaneidad optimista</span><span class="sxs-lookup"><span data-stu-id="0a07a-149">Step 1: Creating a SqlDataSource that Supports Optimistic Concurrency</span></span>

<span data-ttu-id="0a07a-150">Comience abriendo la `OptimisticConcurrency.aspx` página desde la `SqlDataSource` carpeta.</span><span class="sxs-lookup"><span data-stu-id="0a07a-150">Start by opening the `OptimisticConcurrency.aspx` page from the `SqlDataSource` folder.</span></span> <span data-ttu-id="0a07a-151">Arrastre un control SqlDataSource desde el cuadro de herramientas hasta el diseñador, la configuración de su `ID` propiedad `ProductsDataSourceWithOptimisticConcurrency`.</span><span class="sxs-lookup"><span data-stu-id="0a07a-151">Drag a SqlDataSource control from the Toolbox onto the Designer, settings its `ID` property to `ProductsDataSourceWithOptimisticConcurrency`.</span></span> <span data-ttu-id="0a07a-152">A continuación, haga clic en el vínculo Configurar origen de datos de la etiqueta inteligente del control s.</span><span class="sxs-lookup"><span data-stu-id="0a07a-152">Next, click on the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="0a07a-153">En la primera pantalla del asistente, elija para que funcione con el `NORTHWINDConnectionString` y haga clic en siguiente.</span><span class="sxs-lookup"><span data-stu-id="0a07a-153">From the first screen in the wizard, choose to work with the `NORTHWINDConnectionString` and click Next.</span></span>

<span data-ttu-id="0a07a-154">[![Elija para trabajar con el NORTHWINDConnectionString](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="0a07a-154">[![Choose to Work with the NORTHWINDConnectionString](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.png)</span></span>

<span data-ttu-id="0a07a-155">**Figura 4**: Elija para trabajar con el `NORTHWINDConnectionString` ([haga clic aquí para ver imagen en tamaño completo](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="0a07a-155">**Figure 4**: Choose to Work with the `NORTHWINDConnectionString` ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.png))</span></span>

<span data-ttu-id="0a07a-156">En este ejemplo se agregará un control GridView que permite a los usuarios editar el `Products` tabla.</span><span class="sxs-lookup"><span data-stu-id="0a07a-156">For this example we'll be adding a GridView that enables users to edit the `Products` table.</span></span> <span data-ttu-id="0a07a-157">Por lo tanto, en la configuración de la pantalla de la instrucción Select, elija el `Products` de tabla en la lista desplegable y seleccione el `ProductID`, `ProductName`, `UnitPrice`, y `Discontinued` columnas, como se muestra en la figura 5.</span><span class="sxs-lookup"><span data-stu-id="0a07a-157">Therefore, from the Configure the Select Statement screen, choose the `Products` table from the drop-down list and select the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` columns, as shown in Figure 5.</span></span>

<span data-ttu-id="0a07a-158">[![De la tabla Products, devolver el ProductID, ProductName, UnitPrice y las columnas no incluidas](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0a07a-158">[![From the Products Table, Return the ProductID, ProductName, UnitPrice, and Discontinued Columns](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.png)</span></span>

<span data-ttu-id="0a07a-159">**Figura 5**: Desde el `Products` de tabla, se devuelve el `ProductID`, `ProductName`, `UnitPrice`, y `Discontinued` columnas ([haga clic aquí para ver imagen en tamaño completo](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="0a07a-159">**Figure 5**: From the `Products` Table, Return the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` Columns ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.png))</span></span>

<span data-ttu-id="0a07a-160">Después de elegir las columnas, haga clic en el botón Opciones avanzadas para que aparezca el cuadro de diálogo Opciones de generación SQL avanzadas.</span><span class="sxs-lookup"><span data-stu-id="0a07a-160">After picking the columns, click the Advanced button to bring up the Advanced SQL Generation Options dialog box.</span></span> <span data-ttu-id="0a07a-161">Compruebe la generar `INSERT`, `UPDATE`, y `DELETE` instrucciones y utilice las casillas de verificación de la simultaneidad optimista y haga clic en Aceptar (consulte atrás en la figura 1 para una captura de pantalla).</span><span class="sxs-lookup"><span data-stu-id="0a07a-161">Check the Generate `INSERT`, `UPDATE`, and `DELETE` statements and Use optimistic concurrency checkboxes and click OK (refer back to Figure 1 for a screenshot).</span></span> <span data-ttu-id="0a07a-162">Complete el Asistente haciendo clic en siguiente y luego en Finalizar.</span><span class="sxs-lookup"><span data-stu-id="0a07a-162">Complete the wizard by clicking Next, then Finish.</span></span>

<span data-ttu-id="0a07a-163">Después de completar el Asistente para configurar orígenes de datos, dedique un momento a examinar los resultados `DeleteCommand` y `UpdateCommand` propiedades y el `DeleteParameters` y `UpdateParameters` colecciones.</span><span class="sxs-lookup"><span data-stu-id="0a07a-163">After completing the Configure Data Source wizard, take a moment to examine the resulting `DeleteCommand` and `UpdateCommand` properties and the `DeleteParameters` and `UpdateParameters` collections.</span></span> <span data-ttu-id="0a07a-164">La manera más fácil de hacerlo es hacer clic en la ficha de origen en la esquina inferior izquierda para ver la sintaxis declarativa de s de página.</span><span class="sxs-lookup"><span data-stu-id="0a07a-164">The easiest way to do this is to click on the Source tab in the lower left corner to see the page s declarative syntax.</span></span> <span data-ttu-id="0a07a-165">Allí encontrará un `UpdateCommand` valor:</span><span class="sxs-lookup"><span data-stu-id="0a07a-165">There you will find an `UpdateCommand` value of:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample2.sql)]

<span data-ttu-id="0a07a-166">Con siete parámetros en el `UpdateParameters` colección:</span><span class="sxs-lookup"><span data-stu-id="0a07a-166">With seven parameters in the `UpdateParameters` collection:</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample3.aspx)]

<span data-ttu-id="0a07a-167">De forma similar, el `DeleteCommand` propiedad y `DeleteParameters` colección debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="0a07a-167">Similarly, the `DeleteCommand` property and `DeleteParameters` collection should look like the following:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample4.sql)]

[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample5.aspx)]

<span data-ttu-id="0a07a-168">Además de ampliar la `WHERE` cláusulas de la `UpdateCommand` y `DeleteCommand` propiedades (y agregar los parámetros adicionales a las colecciones de parámetros respectivos), seleccionar el uso optimista de opción de simultaneidad ajusta a otras dos propiedades:</span><span class="sxs-lookup"><span data-stu-id="0a07a-168">In addition to augmenting the `WHERE` clauses of the `UpdateCommand` and `DeleteCommand` properties (and adding the additional parameters to the respective parameter collections), selecting the Use optimistic concurrency option adjusts two other properties:</span></span>

- <span data-ttu-id="0a07a-169">Los cambios del [ `ConflictDetection` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) desde `OverwriteChanges` (valor predeterminado) para `CompareAllValues`</span><span class="sxs-lookup"><span data-stu-id="0a07a-169">Changes the [`ConflictDetection` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) from `OverwriteChanges` (the default) to `CompareAllValues`</span></span>
- <span data-ttu-id="0a07a-170">Los cambios del [ `OldValuesParameterFormatString` propiedad](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) desde {0} (valor predeterminado) a original\_ {0} .</span><span class="sxs-lookup"><span data-stu-id="0a07a-170">Changes the [`OldValuesParameterFormatString` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) from {0} (the default) to original\_{0} .</span></span>

<span data-ttu-id="0a07a-171">Cuando los datos de control Web invoca la s SqlDataSource `Update()` o `Delete()` método, pasa en los valores originales.</span><span class="sxs-lookup"><span data-stu-id="0a07a-171">When the data Web control invokes the SqlDataSource s `Update()` or `Delete()` method, it passes in the original values.</span></span> <span data-ttu-id="0a07a-172">Si la s SqlDataSource `ConflictDetection` propiedad está establecida en `CompareAllValues`, estos valores originales se agregan al comando.</span><span class="sxs-lookup"><span data-stu-id="0a07a-172">If the SqlDataSource s `ConflictDetection` property is set to `CompareAllValues`, these original values are added to the command.</span></span> <span data-ttu-id="0a07a-173">El `OldValuesParameterFormatString` propiedad proporciona el patrón de nomenclatura que se usan para estos parámetros de valor original.</span><span class="sxs-lookup"><span data-stu-id="0a07a-173">The `OldValuesParameterFormatString` property provides the naming pattern used for these original value parameters.</span></span> <span data-ttu-id="0a07a-174">El Asistente para configurar orígenes de datos usa original\_ {0} y los nombres de cada parámetro original en el `UpdateCommand` y `DeleteCommand` propiedades y `UpdateParameters` y `DeleteParameters` colecciones según corresponda.</span><span class="sxs-lookup"><span data-stu-id="0a07a-174">The Configure Data Source wizard uses original\_{0} and names each original parameter in the `UpdateCommand` and `DeleteCommand` properties and `UpdateParameters` and `DeleteParameters` collections accordingly.</span></span>

> [!NOTE]
> <span data-ttu-id="0a07a-175">Puesto que nos re no usa la s de control SqlDataSource insertar funcionalidades, no dude en quitar el `InsertCommand` propiedad y su `InsertParameters` colección.</span><span class="sxs-lookup"><span data-stu-id="0a07a-175">Since we re not using the SqlDataSource control s inserting capabilities, feel free to remove the `InsertCommand` property and its `InsertParameters` collection.</span></span>

## <a name="correctly-handlingnullvalues"></a><span data-ttu-id="0a07a-176">Para controlar correctamente`NULL`valores</span><span class="sxs-lookup"><span data-stu-id="0a07a-176">Correctly Handling`NULL`Values</span></span>

<span data-ttu-id="0a07a-177">Por desgracia, aumentada `UPDATE` y `DELETE` instrucciones genera automáticamente el Asistente para configurar origen de datos cuando se utiliza simultaneidad optimista es *no* funcionan con los registros que contienen `NULL` valores.</span><span class="sxs-lookup"><span data-stu-id="0a07a-177">Unfortunately, the augmented `UPDATE` and `DELETE` statements autogenerated by the Configure Data Source wizard when using optimistic concurrency do *not* work with records that contain `NULL` values.</span></span> <span data-ttu-id="0a07a-178">Para ver por qué, considere la posibilidad de nuestro s SqlDataSource `UpdateCommand`:</span><span class="sxs-lookup"><span data-stu-id="0a07a-178">To see why, consider our SqlDataSource s `UpdateCommand`:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample6.sql)]

<span data-ttu-id="0a07a-179">El `UnitPrice` columna en el `Products` tabla puede tener `NULL` valores.</span><span class="sxs-lookup"><span data-stu-id="0a07a-179">The `UnitPrice` column in the `Products` table can have `NULL` values.</span></span> <span data-ttu-id="0a07a-180">Si tiene un registro determinado un `NULL` valor `UnitPrice`, el `WHERE` parte de la cláusula `[UnitPrice] = @original_UnitPrice` le *siempre* se evalúan como False porque `NULL = NULL` siempre devuelve False.</span><span class="sxs-lookup"><span data-stu-id="0a07a-180">If a particular record has a `NULL` value for `UnitPrice`, the `WHERE` clause portion `[UnitPrice] = @original_UnitPrice` will *always* evaluate to False because `NULL = NULL` always returns False.</span></span> <span data-ttu-id="0a07a-181">Por lo tanto, los registros que contienen `NULL` valores no se pueden modificar ni eliminar, como el `UPDATE` y `DELETE` instrucciones `WHERE` cláusulas no devuelven ninguna fila para actualizar o eliminar.</span><span class="sxs-lookup"><span data-stu-id="0a07a-181">Therefore, records that contain `NULL` values cannot be edited or deleted, as the `UPDATE` and `DELETE` statements `WHERE` clauses won't return any rows to update or delete.</span></span>

> [!NOTE]
> <span data-ttu-id="0a07a-182">Este error se notificó primero a Microsoft en junio de 2004 en [SqlDataSource genera SQL las instrucciones incorrectas](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) y al parecer está programada se ha solucionado en la próxima versión de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0a07a-182">This bug was first reported to Microsoft in June of 2004 in [SqlDataSource Generates Incorrect SQL Statements](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) and is reportedly scheduled to be fixed in the next version of ASP.NET.</span></span>

<span data-ttu-id="0a07a-183">Para solucionar este problema, tenemos que actualizar manualmente el `WHERE` cláusulas tanto en el `UpdateCommand` y `DeleteCommand` las propiedades de **todos los** columnas que pueden tener `NULL` valores.</span><span class="sxs-lookup"><span data-stu-id="0a07a-183">To fix this, we have to manually update the `WHERE` clauses in both the `UpdateCommand` and `DeleteCommand` properties for **all** columns that can have `NULL` values.</span></span> <span data-ttu-id="0a07a-184">En general, cambiar `[ColumnName] = @original_ColumnName` para:</span><span class="sxs-lookup"><span data-stu-id="0a07a-184">In general, change `[ColumnName] = @original_ColumnName` to:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample7.sql)]

<span data-ttu-id="0a07a-185">Esta modificación se puede realizar directamente mediante el marcado declarativo, mediante las opciones UpdateQuery o DeleteQuery desde la ventana Propiedades, o a través de la actualización y eliminar las pestañas en la especificación de una instrucción SQL personalizada o la opción de procedimiento almacenado en los datos de configuración Asistente de origen.</span><span class="sxs-lookup"><span data-stu-id="0a07a-185">This modification can be made directly through the declarative markup, via the UpdateQuery or DeleteQuery options from the Properties window, or through the UPDATE and DELETE tabs in the Specify a custom SQL statement or stored procedure option in the Configure Data Source wizard.</span></span> <span data-ttu-id="0a07a-186">Nuevamente, esta modificación debe efectuarse en *cada* columna en el `UpdateCommand` y `DeleteCommand` s `WHERE` cláusula que pueda contener `NULL` valores.</span><span class="sxs-lookup"><span data-stu-id="0a07a-186">Again, this modification must be made for *every* column in the `UpdateCommand` and `DeleteCommand` s `WHERE` clause that can contain `NULL` values.</span></span>

<span data-ttu-id="0a07a-187">Si se aplica a nuestro ejemplo da como resultado la siguiente modificada `UpdateCommand` y `DeleteCommand` valores:</span><span class="sxs-lookup"><span data-stu-id="0a07a-187">Applying this to our example results in the following modified `UpdateCommand` and `DeleteCommand` values:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample8.sql)]

## <a name="step-2-adding-a-gridview-with-edit-and-delete-options"></a><span data-ttu-id="0a07a-188">Paso 2: Agregar un control GridView con Editar y opciones de eliminación</span><span class="sxs-lookup"><span data-stu-id="0a07a-188">Step 2: Adding a GridView with Edit and Delete Options</span></span>

<span data-ttu-id="0a07a-189">Con SqlDataSource configurado para admitir la simultaneidad optimista, todo lo que queda es agregar un control Web de datos a la página que utiliza este control de simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="0a07a-189">With the SqlDataSource configured to support optimistic concurrency, all that remains is to add a data Web control to the page that utilizes this concurrency control.</span></span> <span data-ttu-id="0a07a-190">Para este tutorial, permiten s Agregar un control GridView que proporciona ambos edición y la funcionalidad de eliminación.</span><span class="sxs-lookup"><span data-stu-id="0a07a-190">For this tutorial, let s add a GridView that provides both edit and delete functionality.</span></span> <span data-ttu-id="0a07a-191">Para ello, arrastre un control GridView del cuadro de herramientas en el diseñador y el conjunto de sus `ID` a `Products`.</span><span class="sxs-lookup"><span data-stu-id="0a07a-191">To accomplish this, drag a GridView from the Toolbox onto the Designer and set its `ID` to `Products`.</span></span> <span data-ttu-id="0a07a-192">En la etiqueta inteligente s GridView, enlazarlo a la `ProductsDataSourceWithOptimisticConcurrency` control SqlDataSource agregado en el paso 1.</span><span class="sxs-lookup"><span data-stu-id="0a07a-192">From the GridView s smart tag, bind it to the `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource control added in Step 1.</span></span> <span data-ttu-id="0a07a-193">Por último, compruebe las opciones Habilitar edición y habilitar la eliminación de la etiqueta inteligente.</span><span class="sxs-lookup"><span data-stu-id="0a07a-193">Finally, check the Enable Editing and Enable Deleting options from the smart tag.</span></span>

<span data-ttu-id="0a07a-194">[![Enlazar el control GridView a SqlDataSource y habilitar la edición y eliminación](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="0a07a-194">[![Bind the GridView to the SqlDataSource and Enable Editing and Deleting](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.png)</span></span>

<span data-ttu-id="0a07a-195">**Figura 6**: Enlazar el control GridView a SqlDataSource y Habilitar edición y eliminación ([haga clic aquí para ver imagen en tamaño completo](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="0a07a-195">**Figure 6**: Bind the GridView to the SqlDataSource and Enable Editing and Deleting ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image10.png))</span></span>

<span data-ttu-id="0a07a-196">Después de agregar el control GridView, configurar su apariencia mediante la eliminación de la `ProductID` BoundField, cambiar el `ProductName` BoundField s `HeaderText` propiedad al producto y actualice el `UnitPrice` BoundField para que su `HeaderText` es propiedad simplemente precio.</span><span class="sxs-lookup"><span data-stu-id="0a07a-196">After adding the GridView, configure its appearance by removing the `ProductID` BoundField, changing the `ProductName` BoundField s `HeaderText` property to Product, and updating the `UnitPrice` BoundField so that its `HeaderText` property is simply Price.</span></span> <span data-ttu-id="0a07a-197">Idealmente, d mejoramos la interfaz de edición para incluir un control RequiredFieldValidator para el `ProductName` valor y un control CompareValidator para los `UnitPrice` valor (para asegurarse de que un valor numérico con el formato correcto de s).</span><span class="sxs-lookup"><span data-stu-id="0a07a-197">Ideally, we d enhance the editing interface to include a RequiredFieldValidator for the `ProductName` value and a CompareValidator for the `UnitPrice` value (to ensure it s a properly formatted numeric value).</span></span> <span data-ttu-id="0a07a-198">Hacer referencia a la [personalizar la interfaz de modificación de datos](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial para una información más detallada sobre la personalización de las operaciones de asignación GridView interfaz de edición.</span><span class="sxs-lookup"><span data-stu-id="0a07a-198">Refer to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial for a more in-depth look at customizing the GridView s editing interface.</span></span>

> [!NOTE]
> <span data-ttu-id="0a07a-199">GridView debe estar habilitado el estado de vista de s puesto que los valores originales que se pasan desde el control GridView de SqlDataSource son almacenados en la vista estado.</span><span class="sxs-lookup"><span data-stu-id="0a07a-199">The GridView s view state must be enabled since the original values passed from the GridView to the SqlDataSource are stored in view state.</span></span>

<span data-ttu-id="0a07a-200">Después de realizar estas modificaciones en el control GridView, el marcado declarativo de GridView y SqlDataSource debe ser similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="0a07a-200">After making these modifications to the GridView, the GridView and SqlDataSource declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample9.aspx)]

<span data-ttu-id="0a07a-201">Para ver el control de simultaneidad optimista en acción, abra dos ventanas del explorador y cargar la `OptimisticConcurrency.aspx` página en ambos.</span><span class="sxs-lookup"><span data-stu-id="0a07a-201">To see the optimistic concurrency control in action, open two browser windows and load the `OptimisticConcurrency.aspx` page in both.</span></span> <span data-ttu-id="0a07a-202">Haga clic en los botones de edición para el primer producto de los dos exploradores.</span><span class="sxs-lookup"><span data-stu-id="0a07a-202">Click on the Edit buttons for the first product in both browsers.</span></span> <span data-ttu-id="0a07a-203">En un explorador, cambie el nombre de producto y haga clic en actualizar.</span><span class="sxs-lookup"><span data-stu-id="0a07a-203">In one browser, change the product name and click Update.</span></span> <span data-ttu-id="0a07a-204">El explorador se postback y GridView volverá a su modo de edición previamente, que muestra el nuevo nombre de producto para el registro que acaba de modificar.</span><span class="sxs-lookup"><span data-stu-id="0a07a-204">The browser will postback and the GridView will return to its pre-editing mode, showing the new product name for the record just edited.</span></span>

<span data-ttu-id="0a07a-205">En la segunda ventana del explorador, cambie el precio (pero deje el nombre del producto como su valor original) y haga clic en actualizar.</span><span class="sxs-lookup"><span data-stu-id="0a07a-205">In the second browser window, change the price (but leave the product name as its original value) and click Update.</span></span> <span data-ttu-id="0a07a-206">En el postback, la cuadrícula se devuelve al modo de edición previamente, pero no se registra el cambio en el precio.</span><span class="sxs-lookup"><span data-stu-id="0a07a-206">On postback, the grid returns to its pre-editing mode, but the change to the price is not recorded.</span></span> <span data-ttu-id="0a07a-207">El segundo explorador muestra el mismo valor que la primera de ellas en el nuevo nombre de producto con el precio anterior.</span><span class="sxs-lookup"><span data-stu-id="0a07a-207">The second browser shows the same value as the first one the new product name with the old price.</span></span> <span data-ttu-id="0a07a-208">Se perdieron los cambios realizados en la segunda ventana del explorador.</span><span class="sxs-lookup"><span data-stu-id="0a07a-208">The changes made in the second browser window were lost.</span></span> <span data-ttu-id="0a07a-209">Además, los cambios se han perdido silenciosamente en su lugar, porque se ha producido ninguna excepción o mensaje que indica que acaba de producirse una infracción de simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="0a07a-209">Moreover, the changes were lost rather quietly, as there was no exception or message indicating that a concurrency violation just occurred.</span></span>

<span data-ttu-id="0a07a-210">[![Los cambios en la segunda ventana del explorador se perdieron en modo silencioso](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="0a07a-210">[![The Changes in the Second Browser Window Were Silently Lost](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image11.png)</span></span>

<span data-ttu-id="0a07a-211">**Figura 7**: Los cambios en el segundo explorador ventana se silenciosamente perdieron ([haga clic aquí para ver imagen en tamaño completo](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="0a07a-211">**Figure 7**: The Changes in the Second Browser Window Were Silently Lost ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image12.png))</span></span>

<span data-ttu-id="0a07a-212">La razón de por qué no se confirmaron los cambios del explorador s segundo fue que la `UPDATE` instrucción s `WHERE` cláusula filtran todos los registros y, por tanto, no afectó a ninguna fila.</span><span class="sxs-lookup"><span data-stu-id="0a07a-212">The reason why the second browser s changes were not committed was because the `UPDATE` statement s `WHERE` clause filtered out all records and therefore did not affect any rows.</span></span> <span data-ttu-id="0a07a-213">Permiten s mirar el `UPDATE` instrucción de nuevo:</span><span class="sxs-lookup"><span data-stu-id="0a07a-213">Let s look at the `UPDATE` statement again:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample10.sql)]

<span data-ttu-id="0a07a-214">Cuando la segunda ventana del explorador actualiza el registro, el nombre original del producto especificado en el `WHERE` cláusula t coincidencia con el nombre de producto existente (ya que se ha cambiado el primer explorador).</span><span class="sxs-lookup"><span data-stu-id="0a07a-214">When the second browser window updates the record, the original product name specified in the `WHERE` clause doesn t match up with the existing product name (since it was changed by the first browser).</span></span> <span data-ttu-id="0a07a-215">Por lo tanto, la instrucción `[ProductName] = @original_ProductName` devuelve False y el `UPDATE` no afecta a todos los registros.</span><span class="sxs-lookup"><span data-stu-id="0a07a-215">Therefore, the statement `[ProductName] = @original_ProductName` returns False, and the `UPDATE` does not affect any records.</span></span>

> [!NOTE]
> <span data-ttu-id="0a07a-216">Eliminar trabajos de la misma manera.</span><span class="sxs-lookup"><span data-stu-id="0a07a-216">Delete works in the same manner.</span></span> <span data-ttu-id="0a07a-217">Con dos ventanas del explorador abiertas, empiece por edición de un producto determinado con uno y, a continuación, guarde sus cambios.</span><span class="sxs-lookup"><span data-stu-id="0a07a-217">With two browser windows open, start by editing a given product with one, and then saving its changes.</span></span> <span data-ttu-id="0a07a-218">Después de guardar los cambios en un explorador, haga clic en el botón Eliminar para el mismo producto en el otro.</span><span class="sxs-lookup"><span data-stu-id="0a07a-218">After saving the changes in the one browser, click the Delete button for the same product in the other.</span></span> <span data-ttu-id="0a07a-219">Puesto que el original don valores t coincidan en el `DELETE` instrucción s `WHERE` cláusula, la eliminación silenciosa genera un error.</span><span class="sxs-lookup"><span data-stu-id="0a07a-219">Since the original values don t match up in the `DELETE` statement s `WHERE` clause, the delete silently fails.</span></span>

<span data-ttu-id="0a07a-220">Desde la perspectiva de s del usuario final en la segunda ventana del explorador, tras hacer clic en el botón Actualizar la cuadrícula se devuelve al modo de edición previamente, pero sus cambios se han perdido.</span><span class="sxs-lookup"><span data-stu-id="0a07a-220">From the end user s perspective in the second browser window, after clicking the Update button the grid returns to the pre-editing mode, but their changes were lost.</span></span> <span data-ttu-id="0a07a-221">Sin embargo, hay s ningún indicador visual que no seguir los cambios.</span><span class="sxs-lookup"><span data-stu-id="0a07a-221">However, there s no visual feedback that their changes didn't stick.</span></span> <span data-ttu-id="0a07a-222">Lo ideal es que, si cambia de un usuario s se pierden a una infracción de simultaneidad, d envíeles una notificación y, quizás, mantenga la cuadrícula en modo de edición.</span><span class="sxs-lookup"><span data-stu-id="0a07a-222">Ideally, if a user s changes are lost to a concurrency violation, we d notify them and, perhaps, keep the grid in edit mode.</span></span> <span data-ttu-id="0a07a-223">Permiten s vistazo a cómo realizar esta tarea.</span><span class="sxs-lookup"><span data-stu-id="0a07a-223">Let s look at how to accomplish this.</span></span>

## <a name="step-3-determining-when-a-concurrency-violation-has-occurred"></a><span data-ttu-id="0a07a-224">Paso 3: Determinar cuándo se ha producido una infracción de simultaneidad</span><span class="sxs-lookup"><span data-stu-id="0a07a-224">Step 3: Determining When a Concurrency Violation Has Occurred</span></span>

<span data-ttu-id="0a07a-225">Puesto que una infracción de simultaneidad rechaza los cambios que ha realizado uno, sería bueno avisar al usuario cuando se ha producido una infracción de simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="0a07a-225">Since a concurrency violation rejects the changes one has made, it would be nice to alert the user when a concurrency violation has occurred.</span></span> <span data-ttu-id="0a07a-226">Para avisar al usuario, s permiten agregar un control Web de la etiqueta a la parte superior de la página llamada `ConcurrencyViolationMessage` cuyo `Text` propiedad muestra el mensaje siguiente: Ha intentado actualizar o eliminar un registro que se ha actualizado simultáneamente por otro usuario.</span><span class="sxs-lookup"><span data-stu-id="0a07a-226">To alert the user, let s add a Label Web control to the top of the page named `ConcurrencyViolationMessage` whose `Text` property displays the following message: You have attempted to update or delete a record that was simultaneously updated by another user.</span></span> <span data-ttu-id="0a07a-227">Revise los cambios del otro usuario y la actualización de puesta al día o eliminar.</span><span class="sxs-lookup"><span data-stu-id="0a07a-227">Please review the other user's changes and then redo your update or delete.</span></span> <span data-ttu-id="0a07a-228">Establecer el control de etiqueta s `CssClass` propiedad a la advertencia, que es una clase CSS definida en `Styles.css` que muestra texto en una fuente roja, cursiva, negrita y grande.</span><span class="sxs-lookup"><span data-stu-id="0a07a-228">Set the Label control s `CssClass` property to Warning, which is a CSS class defined in `Styles.css` that displays text in a red, italic, bold, and large font.</span></span> <span data-ttu-id="0a07a-229">Por último, establezca la etiqueta s `Visible` y `EnableViewState` propiedades a `false`.</span><span class="sxs-lookup"><span data-stu-id="0a07a-229">Finally, set the Label s `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="0a07a-230">Esto ocultará la etiqueta excepto solo esas devoluciones de datos que se establece explícitamente su `Visible` propiedad `true`.</span><span class="sxs-lookup"><span data-stu-id="0a07a-230">This will hide the Label except for only those postbacks where we explicitly set its `Visible` property to `true`.</span></span>

<span data-ttu-id="0a07a-231">[![Agregar un Control etiqueta a la página para mostrar la advertencia](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0a07a-231">[![Add a Label Control to the Page to Display the Warning](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image13.png)</span></span>

<span data-ttu-id="0a07a-232">**Figura 8**: Agregar un Control etiqueta a la página para mostrar la advertencia ([haga clic aquí para ver imagen en tamaño completo](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="0a07a-232">**Figure 8**: Add a Label Control to the Page to Display the Warning ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image14.png))</span></span>

<span data-ttu-id="0a07a-233">Al realizar una actualización o eliminación, la s GridView `RowUpdated` y `RowDeleted` controladores de eventos se activan después de su control de origen de datos haya realizado la actualización solicitada o delete.</span><span class="sxs-lookup"><span data-stu-id="0a07a-233">When performing an update or delete, the GridView s `RowUpdated` and `RowDeleted` event handlers fire after its data source control has performed the requested update or delete.</span></span> <span data-ttu-id="0a07a-234">Podemos determinar el número de filas afectado por la operación de estos controladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="0a07a-234">We can determine how many rows were affected by the operation from these event handlers.</span></span> <span data-ttu-id="0a07a-235">Si cero filas afectadas, queremos mostrar el `ConcurrencyViolationMessage` etiqueta.</span><span class="sxs-lookup"><span data-stu-id="0a07a-235">If zero rows were affected, we want to display the `ConcurrencyViolationMessage` Label.</span></span>

<span data-ttu-id="0a07a-236">Cree un controlador de eventos para ambos el `RowUpdated` y `RowDeleted` eventos y agregue el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="0a07a-236">Create an event handler for both the `RowUpdated` and `RowDeleted` events and add the following code:</span></span>

[!code-csharp[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample11.cs)]

<span data-ttu-id="0a07a-237">En ambos controladores de eventos comprobamos la `e.AffectedRows` propiedad y, si es igual a 0, establezca el `ConcurrencyViolationMessage` etiqueta s `Visible` propiedad `true`.</span><span class="sxs-lookup"><span data-stu-id="0a07a-237">In both event handlers we check the `e.AffectedRows` property and, if it equals 0, set the `ConcurrencyViolationMessage` Label s `Visible` property to `true`.</span></span> <span data-ttu-id="0a07a-238">En el `RowUpdated` controlador de eventos, se instruir a GridView para permanecer en modo de edición estableciendo el `KeepInEditMode` propiedad en true.</span><span class="sxs-lookup"><span data-stu-id="0a07a-238">In the `RowUpdated` event handler, we also instruct the GridView to stay in edit mode by setting the `KeepInEditMode` property to true.</span></span> <span data-ttu-id="0a07a-239">Al hacerlo, debemos enlazar los datos a la cuadrícula para que los demás datos de usuario s se cargan en la interfaz de edición.</span><span class="sxs-lookup"><span data-stu-id="0a07a-239">In doing so, we need to rebind the data to the grid so that the other user s data is loaded into the editing interface.</span></span> <span data-ttu-id="0a07a-240">Esto se logra mediante una llamada a la s GridView `DataBind()` método.</span><span class="sxs-lookup"><span data-stu-id="0a07a-240">This is accomplished by calling the GridView s `DataBind()` method.</span></span>

<span data-ttu-id="0a07a-241">Como se muestra en la figura 9, estos dos controladores de eventos, se muestra un mensaje muy notable siempre que se produzca una infracción de simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="0a07a-241">As Figure 9 shows, with these two event handlers, a very noticeable message is displayed whenever a concurrency violation occurs.</span></span>

<span data-ttu-id="0a07a-242">[![Se muestra un mensaje en caso de una infracción de simultaneidad](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="0a07a-242">[![A Message is Displayed in the Face of a Concurrency Violation](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image15.png)</span></span>

<span data-ttu-id="0a07a-243">**Figura 9**: Se muestra un mensaje en caso de una infracción de simultaneidad ([haga clic aquí para ver imagen en tamaño completo](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="0a07a-243">**Figure 9**: A Message is Displayed in the Face of a Concurrency Violation ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image16.png))</span></span>

## <a name="summary"></a><span data-ttu-id="0a07a-244">Resumen</span><span class="sxs-lookup"><span data-stu-id="0a07a-244">Summary</span></span>

<span data-ttu-id="0a07a-245">Al crear una aplicación web donde simultánea de varios usuarios pueden estar editando los mismos datos, es importante tener en cuenta las opciones de control de simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="0a07a-245">When creating a web application where multiple, concurrent users may be editing the same data, it is important to consider concurrency control options.</span></span> <span data-ttu-id="0a07a-246">De forma predeterminada, los controles Web de los datos de ASP.NET y controles de origen de datos no emplean cualquier control de simultaneidad.</span><span class="sxs-lookup"><span data-stu-id="0a07a-246">By default, the ASP.NET data Web controls and data source controls do not employ any concurrency control.</span></span> <span data-ttu-id="0a07a-247">Como hemos visto en este tutorial, implementar el control de simultaneidad optimista con SqlDataSource es relativamente rápido y sencillo.</span><span class="sxs-lookup"><span data-stu-id="0a07a-247">As we saw in this tutorial, implementing optimistic concurrency control with the SqlDataSource is relatively quick and easy.</span></span> <span data-ttu-id="0a07a-248">SqlDataSource controla la mayoría de los diversos preparativos para la adición de aumentada `WHERE` cláusulas a la autogenerados `UPDATE` y `DELETE` , pero no hay instrucciones son algunas sutilezas en el control de `NULL` valor columnas, como se describe en el Para controlar correctamente `NULL` sección de valores.</span><span class="sxs-lookup"><span data-stu-id="0a07a-248">The SqlDataSource handles most of the legwork for your adding augmented `WHERE` clauses to the autogenerated `UPDATE` and `DELETE` statements but there are a few subtleties in handling `NULL` value columns, as discussed in the Correctly Handling `NULL` Values section.</span></span>

<span data-ttu-id="0a07a-249">En este tutorial concluye nuestro examen de SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="0a07a-249">This tutorial concludes our examination of the SqlDataSource.</span></span> <span data-ttu-id="0a07a-250">Nuestros tutoriales restantes volverá a trabajar con datos mediante el origen ObjectDataSource y arquitectura en capas.</span><span class="sxs-lookup"><span data-stu-id="0a07a-250">Our remaining tutorials will return to working with data using the ObjectDataSource and tiered architecture.</span></span>

<span data-ttu-id="0a07a-251">Feliz programación.</span><span class="sxs-lookup"><span data-stu-id="0a07a-251">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="0a07a-252">Acerca del autor</span><span class="sxs-lookup"><span data-stu-id="0a07a-252">About the Author</span></span>

<span data-ttu-id="0a07a-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de siete libros sobre ASP/ASP.NET y fundador de [4GuysFromRolla.com](http://www.4guysfromrolla.com), trabaja con tecnologías Web de Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="0a07a-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0a07a-254">Scott trabaja como consultor independiente, instructor y escritor.</span><span class="sxs-lookup"><span data-stu-id="0a07a-254">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0a07a-255">Su último libro es [*SAM enseñar a usted mismo ASP.NET 2.0 en 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="0a07a-255">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="0a07a-256">Puede ponerse en [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0a07a-256">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="0a07a-257">o a través de su blog, que puede encontrarse en [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="0a07a-257">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0a07a-258">[Anterior](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)
> [Siguiente](querying-data-with-the-sqldatasource-control-vb.md)</span><span class="sxs-lookup"><span data-stu-id="0a07a-258">[Previous](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)
[Next](querying-data-with-the-sqldatasource-control-vb.md)</span></span>
